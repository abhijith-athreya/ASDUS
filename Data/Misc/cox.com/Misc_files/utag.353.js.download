//~~tv:20064.20160630
//~~tc:Fix issue with localstorage not being available

/* Modified copy of json2.js (no need for parse function)*/
/* https://github.com/douglascrockford/JSON-js */
if(typeof JSON!=='object'){JSON={};}
(function(){'use strict';var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(n){return n<10?'0'+n:n;}
function this_value(){return this.valueOf();}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+ f(this.getUTCDate())+'T'+ f(this.getUTCHours())+':'+ f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};Boolean.prototype.toJSON=this_value;Number.prototype.toJSON=this_value;String.prototype.toJSON=this_value;}
var gap,indent,meta,rep;function quote(string){rx_escapable.lastIndex=0;return rx_escapable.test(string)?'"'+string.replace(rx_escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'};JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}
}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}}());


//tealium universal tag - utag.sender.20064 ut4.0.201804231715, Copyright 2018 Tealium.com Inc. All Rights Reserved.
try{
(function(id,loader,u){
  try{u=utag.o[loader].sender[id]={}}catch(e){u=utag.sender[id]};
  u.ev={'all':1};
  u.server_domain = "tealiumiq.com";
  u.server_prefix = "";
  u.tag_config_server = "//datacloud.tealiumiq.com/cox/main/2/i.gif";
  u.tag_config_sampling = "100" || "100";
  // In debug mode, always in sample group
  if ( utag.cfg.utagdb ) {
    u.tag_config_sampling = "100";
  }
  u.tag_config_region = "default" || "default";
  u.region = "";
  u.performance_timing_count = 0;
  u.account = utag.cfg.utid.split("/")[0];
  u.profile = "" || utag.cfg.utid.split("/")[1];
 
  // Handle VPC custom-collect.tealiumiq.com data collection endpoint
  if ( u.tag_config_server.indexOf( "-collect." + u.server_domain ) > 1 ) {
    u.server_prefix = u.tag_config_server.split( "collect." + u.server_domain )[0]; 
    if ( u.tag_config_server.indexOf( "/i.gif" ) < 0 ) { 
      u.tag_config_server = "https://" + [ u.server_prefix + "collect." + u.server_domain, u.account, u.profile, "2", "i.gif" ].join("/");
    }
  }

  // Auto-build the endpoint for Tealium Collect
  if ( u.tag_config_server === "" ) {
    if ( u.tag_config_region === "default" ) {
      u.tag_config_server = "https://" + [ u.server_prefix + "collect." + u.server_domain, u.account, u.profile, "2", "i.gif" ].join("/");
    } else {
      u.tag_config_server = "https://" + [ u.server_prefix + "collect-" + u.tag_config_region + "." + u.server_domain, u.account, u.profile, "2", "i.gif" ].join("/");
    }
  }

  // For those who fill out collect.tealiumiq.com and then choose a specific region
  if ( u.tag_config_region !== "default" && u.tag_config_server.indexOf( u.server_prefix + "collect." + u.server_domain ) > 0 ) {
    u.tag_config_server = u.tag_config_server.replace( u.server_prefix + "collect." + u.server_domain, u.server_prefix + "collect-" + u.tag_config_region + "." + u.server_domain );
    u.region = u.tag_config_region;
  }
  
  u.data_enrichment="none";
  u.profile_specific_vid = 0;
  u.enrichment_polling = 1;
  u.enrichment_polling_delay = 1000;
  u.do_enrichment = function(){};
  var q = u.tag_config_server.indexOf("?");
  if(q>0 && (q+1)==u.tag_config_server.length){
    // utag.DB("DataCloud config error. Trailing ? in URL")
    u.tag_config_server = u.tag_config_server.replace("?","");
  }
  u.server_list = u.tag_config_server.split("|");
  u.enrichment_enabled = {};
  u.get_account_profile = function(s){
    var p = s.substring( s.indexOf( u.server_domain ) ).split("/");
    return p;
  }

  // Should only call this function when u.tag_config_sampling < 100
  u.is_in_sample_group = function( b ) {
    var group = "100";

    // Automatically in sampling group if the sampling value is 100% or not defined at all
    if ( u.tag_config_sampling === "" || u.tag_config_sampling === "100" ) {
      return true
    }
    
    // Check or set cookie (cookie should survive across visits)
    if ( b["cp.utag_main_dc_group"] ) {
      group = b["cp.utag_main_dc_group"]; 
    } else {
      // group = random number 1..100
      group = Math.floor(Math.random() * 100) + 1;
      // set cookie
      utag.loader.SC( "utag_main", {"dc_group": group} );
    }

    // Return true if this visitor in sampling group
    if ( parseInt( group ) <= parseInt( u.tag_config_sampling ) ) {
      return true
    } else {
      return false
    }
    
  }

  u.get_performance_timing = function( b ) {
    var t, timing;
    var data = {};

    function subtract( val1, val2 ){
      var difference = 0;
      if ( val1 > val2 ) {
        difference = val1 - val2;
      }
      return difference;
    }

    if ( typeof localStorage != "undefined" && JSON.parse && window.performance && window.performance.timing ) {
      t = window.performance.timing;
      // Read existing local storage data and add to data layer
      timing = localStorage.getItem("tealium_timing");
      // Only get this info on the first event for this page
      if ( timing !== null && timing !== "{}" && typeof b !== "undefined" && u.performance_timing_count === 0 ) {
        utag.ut.merge(b, utag.ut.flatten({timing : JSON.parse(timing)}), 1);
      }
    } else {
      return;
    }

    // Get current URL timing data into local storage.  Or setTimeout and do recursive call if data not there yet
    u.performance_timing_count++;
    for ( var k in t ) {
      // Some data might not be ready yet, wait and request again
      // Only try 20 times max
      if ( ( k.indexOf("dom") === 0 || k.indexOf("load") === 0 ) && t[k] === 0 && u.performance_timing_count < 20 ) {
        setTimeout( u.get_performance_timing, 1000 );
      }
    }

    // Write current page performance data to local storage for retrieval on next page
    data["domain"] = location.hostname + "";
    data["pathname"] = location.pathname + "";
    data["query_string"] = ("" + location.search).substring(1);
    data["timestamp"] = (new Date()).getTime();
    data["dns"] = subtract( t.domainLookupEnd, t.domainLookupStart );
    data["connect"] = subtract( t.connectEnd, t.connectStart );
    data["response"] = subtract( t.responseEnd, t.responseStart );
    data["dom_loading_to_interactive"] = subtract( t.domInteractive, t.domLoading );
    data["dom_interactive_to_complete"] = subtract( t.domComplete, t.domInteractive );
    data["load"] = subtract( t.loadEventEnd, t.loadEventStart );
    data["time_to_first_byte"] = subtract( t.responseStart, t.connectEnd );
    data["front_end"] = subtract( t.loadEventStart, t.responseEnd );
    data["fetch_to_response"] = subtract( t.responseStart, t.fetchStart );
    data["fetch_to_complete"] = subtract( t.domComplete, t.fetchStart );
    data["fetch_to_interactive"] = subtract( t.domInteractive, t.fetchStart );

    try{
      localStorage.setItem( "tealium_timing", JSON.stringify( data ) );
    }catch(e){utag.DB(e)}

  }

  u.map={};
  u.extend=[function(a,b){ try{ if((b['_isCampCodeLink']=='1'&&typeof b['campaignCodeInternal']!='undefined'&&b['campaignCodeInternal']!='')){try{b['campaignCodeInternal']=utag.ut.qp(b['_linkObject'].attr("href")).campcode}catch(e){};try{b['campaignCodeInternalList']=[b.campaignCodeInternal]}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['cp.utag_main_offer_origin_cart_add']=='undefined'){utag.loader.SC('utag_main',{'offer_origin_cart_add':'unknown'+';exp-session'});b['cp.utag_main_offer_origin_cart_add']='unknown';}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if(1){try{b['_offer_origin_section']=utag.loader.RC('utag_main')['offer_origin']}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('cartAdd')>-1&&typeof b['_offer_origin_section']!='undefined'&&b['_offer_origin_section']!='')){utag.loader.SC('utag_main',{'offer_origin_cart_add':b['_offer_origin_section']+';exp-session'});b['cp.utag_main_offer_origin_cart_add']=b['_offer_origin_section'];}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if(1){try{b['cp.utag_main_offer_origin']=utag.loader.RC('utag_main')['offer_origin']}catch(e){};try{b['cp.utag_main_offer_origin_cart_add']=utag.loader.RC('utag_main')['offer_origin_cart_add']}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(1){try{b['_ccat']=[]}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(b['purchaseStep']=='order'||b['purchaseStep']=='gig shop order'){try{b['_cartMetrics']=Math.round(b.productTotalOfferMRC).toString() + ":" + Math.round(b.productDepositAmount).toString() + ":" + Math.round(b.productTotalDueNow).toString()}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b,c,d){ try{ if(b['purchaseStep']=='checkout'||b['purchaseStep']=='order'||b['purchaseStep']=='features'||b['purchaseStep']=='gig shop order'){c=[b['productTotalPSUs'],b['_productTotalUptierPSUs'],b['_productTotalNewPSUs']];b['_productTotalPSURatio']=c.join(':')} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((b['dom.domain']=='www.cox.com'&&b['pageName'].toString().indexOf('testing-for-performance')>-1)||(typeof b['pageType']=='undefined'&&b['_utag_event']=='view'&&b['pageName']!='cox:res:shop:session-timeout'&&b['pageName']!='cox:res:shop:grid')||(typeof b['pageType']!='undefined'&&b['pageType']==''&&b['_utag_event']=='view')||(typeof b['pageName']!='undefined'&&b['pageName'].toString().indexOf('pega-test')>-1)){b['sc_account']='cox-avalanche-dev'} } catch(e){ utag.DB(e) }  },
function(a,b,c,d){ try{ if((typeof b['orderSavedCartStatus']!='undefined'&&b['orderSavedCartStatus']!=''&&typeof b['orderSavedCartStatusOriginator']!='undefined'&&b['orderSavedCartStatusOriginator']!='')){c=[b['orderSavedCartStatus'],b['orderSavedCartStatusOriginator']];b['_savedCartStatus']=c.join(':')} } catch(e){ utag.DB(e) }  },
function(a,b,c,d){ try{ if((typeof b['cbVisitorGEMSServiceability']!='undefined'&&b['cbVisitorGEMSServiceability']!=''&&typeof b['cbHasActiveICOMS']!='undefined'&&b['cbHasActiveICOMS']!='')){c=[b['cbHasActiveICOMS'],b['cbVisitorGEMSServiceability']];b['_moveCBServiceType']=c.join(':')} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['searchTerm']!='undefined'&&b['searchTerm']!=''){try{b['sc_events']=u.addEvent('event5')}catch(e){};b['_searchPagePlusOne']='+1';try{b['_finalSearchTerm']=jQuery.trim(b.searchTerm.replace(/\+|%2B/g, ' '))}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('cartAdd')>-1&&typeof b['_hasCart']=='undefined')){try{b['sc_events']=u.addEvent('scOpen')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('cartAdd')>-1)){try{b['sc_events']=u.addEvent("scAdd")}catch(e){};b['_productMRCCartAdd']=b['productMRC'];b['_addToCartDate']=b['_formattedDate'];b['_cartAdd_productPSU']=b['productPSU'];b['_cartAdd_productMRCSavings']=b['productMRCSavings'];b['_productOfferName']=b['productOfferName'];b['_cartadd_productBundleDiscount']=b['_productBundleDiscountPortion'];b['_cartadd_productNewPSU']=b['_productNewPSU'];b['_cartadd_productUptierPSU']=b['_productUptierPSU']} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('cartSave')>-1)){try{b['sc_events']=u.addEvent("event27")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('cartSwap')>-1)){try{b['sc_events']=u.addEvent("event26")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('productView')>-1)){try{b['sc_events']=u.addEvent("prodView")}catch(e){};b['_productViewedPlusOne']='+1'} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(b['purchaseStep']=='checkout'){b['_productMRCCheckout']=b['productMRC'];b['_checkout_productPSU']=b['productPSU'];b['_checkout_productMRCSavings']=b['productMRCSavings'];b['_productOfferName']=b['productOfferName'];b['_checkout_productBundleDiscount']=b['_productBundleDiscountPortion'];b['_checkout_productNewPSU']=b['_productNewPSU'];b['_checkout_productUptierPSU']=b['_productUptierPSU']} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['shopFilterUsed']!='undefined'&&b['shopFilterUsed']!=''){try{b['sc_events']=u.addEvent("event60")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(b['purchaseStep']=='order'||b['purchaseStep']=='gig shop order'){b['_order_productOfferMRC']=b['productOfferMRC'];b['_order_productOfferMRCSavings']=b['productMRCSavings'];b['_order_productOfferMonths']=b['productOfferMonths'];b['_order_productOneTimeCharge']=b['productOneTimeCharge'];b['_order_productInstallChargePro']=b['productInstallChargePro'];b['_order_productInstallChargeSelfDropShip']=b['productInstallChargeSelfDropShip'];b['_order_productInstallChargeSelfPickUp']=b['productInstallChargeSelfPickUp'];b['_order_productInstallChargeProSavings']=b['productInstallChargeProSavings'];b['_order_productInstallChargeSelfDropShipSavings']=b['productInstallChargeSelfDropShipSavings'];b['_order_productInstallChargeSelfPickUpSavings']=b['productInstallChargeSelfPickUpSavings'];b['_order_productOneTimeChargeSavings']=b['productOneTimeChargeSavings'];b['_order_productBundleDiscountMonths']=b['productBundleDiscountMonths'];b['_order_productBundleDiscount']=b['_productBundleDiscountPortion'];b['_order_productMRCSavings']=b['productMRCSavings'];b['_order_productInstallCharge']=b['productInstallCharge'];b['_order_productPSU']=b['productPSU'];b['_order_productInstallChargeSavings']=b['productInstallChargeSavings'];b['_productOfferName']=b['productOfferName'];b['_order_productDepositAmount']=b['_productDepositAmountPortion'];b['_order_productTotalDueNowPortion']=b['_productTotalDueNowPortion'];b['_order_productNewPSU']=b['_productNewPSU'];b['_order_productUptierPSU']=b['_productUptierPSU']} } catch(e){ utag.DB(e) }  },
function(a,b){
// Used to be (prior to 10/24/2016) b.pageName == "cox:res:shop:shop" || b.pageType == "mktg" || b.pageType == "myaccount"

if(b.purchaseStep == "shop" &&
   b.productOfferID && b.productOfferMonths && b.productOfferMRC && b.productOfferName && b.productOfferSavings) {
  b._productOffersShown = [];
  for(var c=0; c < b.productOfferID.length; c++) {
    var tmp = [b['cp.utag_main_offer_origin_cart_add']];
    tmp.push(b.productOfferID[c]);
    tmp.push(b.productOfferName[c]);
    tmp.push(b.productOfferMRC[c]);
    tmp.push(b.productOfferMonths[c]);
    tmp.push(b.productOfferSavings[c]);
    b._productOffersShown.push(tmp.join(':'));
  } 
  b._productOffersShown = b._productOffersShown.join(',');
} 

if (typeof b._productOffersShown !== 'undefined') {
  if (purchaseStep == "shop") {u.addEvent('event35');}
  // if (b.pageType == "mktg") {u.addEvent('event90');}  
  // if (b.pageType == "myaccount") {u.addEvent('event93');}  
} 
},
function(a,b){
if((b.purchaseStep == "checkout" || b.purchaseStep == "order" || b.purchaseStep == 'gig shop order' || b.eventNames.indexOf("cartAdd") >= 0) &&
   b.productOfferID && b.productOfferMonths && b.productOfferMRC && b.productOfferName && b.productOfferSavings) {
  b._productOfferSelected = [];
  for(var c=0; c < b.productOfferID.length; c++) {
    var tmp = [b['cp.utag_main_offer_origin_cart_add']];
    tmp.push(b.productOfferID[c]);
    tmp.push(b.productOfferName[c]);
    tmp.push(b.productOfferMRC[c]);
    tmp.push(b.productOfferMonths[c]);
    tmp.push(b.productOfferSavings[c]);
    b._productOfferSelected.push(tmp.join(':'));
  } 
  b._productOfferSelected = b._productOfferSelected.join(',');
} 

if (typeof b._productOfferSelected !== 'undefined') {
  if(b.eventNames.indexOf("cartAdd") >= 0) {u.addEvent("event38");}
} 
},
function(a,b){
if(b.eventNames == 'siteError' && b.formID && b.formErrorFields && b.formErrorValues) {
  b._formErrors = [];
  for(var c=0; c < b.formErrorFields.length; c++) {
    var tmp = [];
    tmp.push(b.formID);
    tmp.push(b.formErrorFields[c]);
    tmp.push(b.formErrorValues[c]);
    b._formErrors.push(tmp.join(':'));
  }
}
},
function(a,b){
if(b.eventNames && b.eventNames.indexOf('cartAdd') > -1 && b.productOfferID && b.productOfferName && b.productOfferMRC && b.productOfferMonths && b.productOfferSavings) {
  b._crossSellingDrivers = [b['cp.utag_main_offer_origin']];
  for(var c=0; c < b.productOfferID.length; c++) {
    var tmp = [];
    tmp.push(b.productOfferID instanceof Array && b.productOfferID[c] ? b.productOfferID[c] : 'null');
    tmp.push(b.productOfferName instanceof Array && b.productOfferName[c] ? b.productOfferName[c] : 'null');
    tmp.push(b.productOfferMRC instanceof Array && b.productOfferMRC[c] ? b.productOfferMRC[c] : 'null');
    tmp.push(b.productOfferMonths instanceof Array && b.productOfferMonths[c] ? b.productOfferMonths[c] : 'null');
    tmp.push(b.productOfferSavings instanceof Array && b.productOfferSavings[c] ? b.productOfferSavings[c] : 'null');
    b._crossSellingDrivers.push(tmp.join(':'));
  }
  b._crossSellingDrivers = b._crossSellingDrivers.join('_');
}
},
function(a,b){ try{ if(b['cp.utag_main_scid_referrer']=='1'){try{b['sc_events']=u.addEvent("event20")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(b['dom.query_string'].toString().indexOf('sc_id=')<0){utag.loader.SC('utag_main',{'scid_referrer':'0'+';exp-session'});b['cp.utag_main_scid_referrer']='0';}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if(b['dom.query_string'].toString().toLowerCase().indexOf('sc_id='.toLowerCase())>-1){utag.loader.SC('utag_main',{'scid_referrer':'1'+';exp-session'});b['cp.utag_main_scid_referrer']='1';}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('toolComplete')>-1)){try{b['sc_events']=u.addEvent('event7')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['campaign']!='undefined'&&typeof b['campaign']!='undefined'&&b['campaign']!='')){try{b['sc_events']=u.addEvent('event17')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('offerExpanded')>-1&&typeof b['nextAccordionSection']!='undefined'&&b['nextAccordionSection']!='')){try{b['_void']=b._cprod.push(b.nextAccordionSection)}catch(e){};try{b['_void']=b._cyfOfferExpandedEvent_tmp.push('1')}catch(e){};try{b['_void']=b._cyfOfferCompletedEvent_tmp.push('0')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('offerExpanded')>-1&&typeof b['thisAccordionSection']!='undefined'&&b['thisAccordionSection']!='')){try{b['_void']=b._cprod.push(b.thisAccordionSection)}catch(e){};try{b['_void']=b._cyfOfferExpandedEvent_tmp.push('0')}catch(e){};try{b['_void']=b._cyfOfferCompletedEvent_tmp.push('1')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['_cyfOfferCompletedEvent_tmp']!='undefined'&&b['_cyfOfferCompletedEvent_tmp'].toString().indexOf('1')>-1)){b['_cyfOfferCompletedEvent']=b['_cyfOfferCompletedEvent_tmp']} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['_cyfOfferExpandedEvent_tmp']!='undefined'&&b['_cyfOfferExpandedEvent_tmp'].toString().indexOf('1')>-1)){b['_cyfOfferExpandedEvent']=b['_cyfOfferExpandedEvent_tmp']} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['qp.srchkw']!='undefined'&&b['qp.srchkw']!=''){try{b['qp.srchkw']=b['qp.srchkw'].replace(/\+/g, ' ')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['qp.srchcampaign']!='undefined'&&b['qp.srchcampaign']!=''){try{b['qp.srchcampaign']=b['qp.srchcampaign'].replace(/\+/g, ' ')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b,c,d){ try{ if((typeof b['qp.srchcampaign']!='undefined'&&b['qp.srchcampaign']!=''&&b['_utag_event']=='view')||(typeof b['qp.srchkw']!='undefined'&&b['qp.srchkw']!=''&&b['_utag_event']=='view')){c=[b['qp.srchcampaign'],b['qp.srchkw']];for(d=0;d<c.length;d++){if(typeof c[d]=='undefined'||c[d]=='')c[d]='unknown'};b['_ppcParameters']=c.join(':')} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['_ppcParameters']!='undefined'&&b['_ppcParameters']!=''){try{b['sc_events']=u.addEvent("event91")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){
// !!!NOTICE!!! calling "return false" in "All Tags" extension does not suppress the tracking call
if(b.eventNames == "autotrack" && b['pageName'].indexOf("myconnection") >= 0)
  return false
},
function(a,b){
b._pageLoadTime = '';
if (typeof(performance) !== 'undefined' && typeof(performance.timing) == 'object') {
	var timing = performance.timing;
	
	// fall back to less accurate milestones
	var startTime = performance.timing.redirectStart ||
			performance.timing.fetchStart ||
			performance.timing.requestStart;
	var endTime = performance.timing.domContentLoadedEventEnd ||
			performance.timing.domInteractive ||
			performance.timing.domComplete ||
			performance.timing.loadEventComplete;
	
	if (startTime && endTime && (startTime < endTime)) {
		b._pageLoadTime = (endTime - startTime);
	        // cut off data points at 10 minutes
	        if (b._pageLoadTime > 600000) {
	           b._pageLoadTime = 'data not available';
	        }
	}
} else {
	b._pageLoadTime = 'data not available';
}

},
function(a,b){
if(b["ut.event"] == 'view') {
  for(var i=0; i < jQuery(("div[data-reporting-id*='alert:']")).length; i++){
    b._cprod.push(jQuery.trim($(("div[data-reporting-id*='alert:']")).attr('data-reporting-id')));
    b._alertEvent = '1';
  }
}
},
function(a,b){ try{ if(typeof b['qp.directhit']!='undefined'&&b['qp.directhit']!=''){try{b['sc_events']=u.addEvent('event145')}catch(e){};b['_searchPagePlusOne']='+1';try{b['_finalSearchTerm']=jQuery.trim(b["qp.kw"].replace(/\+|%2B/g, ' '))}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b,c,d){ try{ if((typeof b['modemMyWifi']!='undefined'&&b['modemMyWifi']!=''&&typeof b['modemModelNumber']!='undefined'&&b['modemModelNumber']!=''&&typeof b['modemSerialNumber']!='undefined'&&b['modemSerialNumber']!='')){c=[b['modemMyWifi'],b['modemModelNumber'],b['modemSerialNumber']];b['_myWiFiModem']=c.join(':')} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['selfHelpName']!='undefined'&&b['selfHelpName']!=''&&b['eventNames']!='selfHelp')){try{b['sc_events']=u.addEvent('event47')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){
// list3 evar 
b._scFormError = (function(w, utag, b, a, type, field_id, form_id, error_id) {
  if (utag.ut.typeOf(w.udoFormErrors) === 'array' && w.udoFormErrors.length > 0) {
    a = [];
    for (var i = 0; i < w.udoFormErrors.length; i++) {
      type = 'client';
      field_id = w.jQuery(w.udoFormErrors[i]['element']).attr('id') || 'unknown';
      field_id = field_id.replace(/:/g, '');
      field_id = field_id.replace(/,/g, '');
      form_id = w.jQuery('#' + field_id).closest('form').attr('id') || 'unknown';
      form_id = form_id.replace(/:/g, '');
      form_id = form_id.replace(/,/g, '');
      error_id = w.udoFormErrors[i]['method'] || 'unknown';
      error_id = error_id.replace(/:/g, '');
      error_id = error_id.replace(/,/g, '');
      a.push(type + ':' + form_id + ':' + field_id + ':' + error_id);
    }
    w.udoFormErrors = [];
    return a.join(',');
  } else if (utag.ut.typeOf(b.eventNames) === 'string' && b.eventNames.indexOf('serverFormError') > -1 && utag.ut.typeOf(b.formError) === 'array') {
    a = [];
    for (var i = 0; i < b.formError.length; i++) {
      type = 'server';
      field_id = 'unknown';
      field_id = field_id.replace(/:/g, '');
      field_id = field_id.replace(/,/g, '');
      form_id = 'unknown';
      form_id = form_id.replace(/:/g, '');
      form_id = form_id.replace(/,/g, '');
      error_id = b.formError[i] || 'unknown';
      error_id = error_id.replace(/:/g, '');
      error_id = error_id.replace(/,/g, '');
      a.push(type + ':' + form_id + ':' + field_id + ':' + error_id);
    }
    return a.join(',');
  } else {
    return undefined;
  }
}(window, window.utag, b));


if (utag.ut.typeOf(b._scFormError) === 'string') {
  if (b._scFormError.substr(0, 6) === 'server') {
    if(b._scFormError == sessionStorage.getItem('serverError')){
      //return false;
      // OLEG: commented out return false above and added 1 line below
      u.addEvent(['event147']);
    }else{
      sessionStorage.setItem('serverError', b._scFormError);
      u.addEvent(['event147']);
    }
  } else if (b._scFormError.substr(0, 6) === 'client') {
    if(b._scFormError == sessionStorage.getItem('clientError')){
      //return false;
      // OLEG: commented out return false above and added 1 line below
      u.addEvent(['event146']);
    }else{
      sessionStorage.setItem('clientError', b._scFormError);
      u.addEvent(['event146']);
    }
  }
}
},
function(a,b){ try{ if(1){try{b['adobeMarketingCloudID']=utag.data.adobeMarketingCloudID = (s.visitor.getMarketingCloudVisitorID() || '')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){
try {
  if(s.tealium_added_Visitor_function === 1){
    u.addEvent('event148')
  }
} catch (e) {}

},
function(a,b,c,d){ try{ if((typeof b['urlState']!='undefined'&&b['urlState']!=''&&typeof b['urlCity']!='undefined'&&b['urlCity']!='')){c=[b['urlState'],b['urlCity']];b['_urlLocation']=c.join(':')} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['depositCalculatedDeposit']=='undefined'){b['depositCalculatedDeposit']='unknown'} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['depositEstimatedDeposit']=='undefined'){b['depositEstimatedDeposit']='unknown'} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['depositPayNowDeposit']=='undefined'){b['depositPayNowDeposit']='unknown'} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['depositRequired']=='undefined'){b['depositRequired']='unknown'} } catch(e){ utag.DB(e) }  },
function(a,b,c,d){ try{ if(b['eventNames']=='checkoutDeposit'||(typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('orderDeposit')>-1)){c=[b['depositRequired'],b['depositEstimatedDeposit'],b['depositCalculatedDeposit'],b['depositPayNowDeposit']];b['_depositMetrics']=c.join(':')} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((b['depositRequired']=='true'&&b['eventNames']=='checkoutDeposit')){try{b['sc_events']=u.addEvent('event160')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((b['depositEstimatedDeposit']!='unknown'&&b['eventNames']=='checkoutDeposit')){try{b['sc_events']=u.addEvent('event158')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((b['depositCalculatedDeposit']!='unknown'&&b['eventNames']=='checkoutDeposit')){try{b['sc_events']=u.addEvent('event159')}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){
// only on checkout installation page, figure out the Self Install Available, this will be a number between 1 and 4.
if(b.pageName === 'cox:res:shop:checkout-installation' && b._utag_event == 'view'){
  b._selfInstallAvailable = 0;
  if(typeof b.serviceableCodes !== 'undefined'){
    b._allowedServiceCodes = ["SELF_INSTALL_CABLE_YES", "SELF_INSTALL_CHSI_YES", "SELF_INSTALL_TELEPHONE_YES", "SELF_INSTALL_HOMESECURITY_YES"];
    for (var i=0; i<b._allowedServiceCodes.length; i++){
      if(b.serviceableCodes.indexOf(b._allowedServiceCodes[i]) > -1){
	b._selfInstallAvailable++;
      }
    }
  }
  // then figure out the Self Install Presented, this will be a number between 0 and 2
  b._selfInstallPresented = 0;
    // OLD ECOM (prior to 5/6/2017 release
    // b._selfInstallPresented += (jQuery('fieldset.installation div[data-automation-id="installation-InstallationOption.SelfShip"]').length > 0 ? 1 : 0);
    // b._selfInstallPresented += (jQuery('fieldset.installation div[data-automation-id="installation-InstallationOption.SelfPickup"]').length > 0 ? 1 : 0);
  b._selfInstallPresented += (jQuery('form.check-out-installation input[value="InstallationOption.SelfPickup"]').length > 0 ? 1 : 0);
  b._selfInstallPresented += (jQuery('form.check-out-installation input[value="InstallationOption.SelfShip"]').length > 0 ? 1 : 0);
   
  
  // on checkout Self Install Ordered is always unknown
  b._selfInstallOrdered = 'unknown';
  
  // Self Install will look something like 1:2:unknown and will go to eVar21
  b._selfInstall = 
    b._selfInstallAvailable + ':' +
    b._selfInstallPresented + ':' + 
    b._selfInstallOrdered;
  
  // store the data in session storage so we can use it on the confirmation page
  sessionStorage.setItem('_selfInstall', b._selfInstall);

  // set event 155 when user reaches Self Install page and utag.view is used
  u.addEvent("event61");
  
  // set event 155 when Self Install is Available
  if(b._selfInstallAvailable > 0){
    u.addEvent("event155");
  }

  // set event 156 when Self Install is Presented
  if(b._selfInstallPresented > 0){
    u.addEvent("event156");
  }  
  
}

// now when we get to the order page
if(b.purchaseStep === 'order'){
  // temporally pull the information from session storage
  b._selfInstall_temp = sessionStorage.getItem('_selfInstall').split(':');
  // build up the same two variables from Checkout
  b._selfInstallAvailable = b._selfInstall_temp[0];
  b._selfInstallPresented = b._selfInstall_temp[1];
  //remove the temporary variable
  delete b._selfInstall_temp
    
    // default the Self Install Ordered to zero
    b._selfInstallOrdered = 0;
  // loop through products lookinf ro SELF_INSTALL_ and if you find a match set Self Install Ordered to one
  for (var i=0; i<b.productID.length; i++){
    if(b.productID[i].indexOf('SELF_INSTALL_') > -1){
      b._selfInstallOrdered = 1;
    }
  }
  
  //build up Self Install for evar21 again
  b._selfInstall = 
    b._selfInstallAvailable + ':' +
    b._selfInstallPresented + ':' + 
    b._selfInstallOrdered;
  
  // set event 157 when Self Install is Ordered
  if(b._selfInstallOrdered > 0){
    u.addEvent("event157");
  }
}
},
function(a,b){ try{ if(typeof b['interface']=='undefined'){b['interface']='web'} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('paperlessSignUp')>-1&&b['eventNames'].toString().indexOf('paperlessSignUpFail')<0)){try{b['sc_events']=u.addEvent("event101")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('paperlessSignUpFail')>-1)){try{b['sc_events']=u.addEvent("event102")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('billPay')>-1&&b['eventNames'].toString().indexOf('billPayFail')<0)){try{b['sc_events']=u.addEvent("event95")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('billPayFail')>-1)){try{b['sc_events']=u.addEvent("event103")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b,c,d){ try{ if(typeof b['userGuid']!='undefined'&&b['userGuid']!=''||typeof b['profileGuid']!='undefined'&&b['profileGuid']!=''||typeof b['accountGuid']!='undefined'&&b['accountGuid']!=''||typeof b['impersonateeUserGuid']!='undefined'&&b['impersonateeUserGuid']!=''){c=[b['userGuid'],b['profileGuid'],b['accountGuid'],b['impersonateeUserGuid']];b['_cbGuid']=c.join(':')} } catch(e){ utag.DB(e) }  },
function(a,b,c,d){ try{ if((typeof b['dumUsage']!='undefined'&&typeof b['dumLimit']!='undefined'&&typeof b['dumUtilization']!='undefined'&&typeof b['dumDaysLeft']!='undefined')){c=[b['dumUsage'],b['dumLimit'],b['dumUtilization'],b['dumDaysLeft']];b['_dumFinal']=c.join(':')} } catch(e){ utag.DB(e) }  },
function(a,b,c,d){c=['_productOfferName','_scFormError','productFindingMethod','_productOfferSelected','campaign','campaignCodeInternal','campaignCodeInternalList','_finalSearchTerm'];for(d=0;d<c.length;d++){try{b[c[d]] = (b[c[d]] instanceof Array || b[c[d]] instanceof Object) ? b[c[d]] : b[c[d]].toString().toLowerCase()}catch(e){}}},
function(a,b){
function addLoadEvent(func) {
    var oldonload = window.onload;
    if (typeof window.onload != 'function') {
        window.onload = func;
    } else {
        window.onload = function() {
            if (oldonload) {
                oldonload();
            }
            func();
        };
    }
}

utag.onload_flag = utag.onload_flag || {};
if (!utag.onload_flag[id]) {
    if (document.readyState != "complete") {
        addLoadEvent(function() {
            utag.view(utag_data, null, [id]);
        });
        return false;
    }
    utag.onload_flag[id] = 1;
}
},
function(a,b){ try{ if(typeof b['qp.retrieveCartEmail']!='undefined'&&b['qp.retrieveCartEmail']!=''){b['_retrieveCart']='1'} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('easyPaySignUp')>-1&&b['eventNames'].toString().indexOf('easyPaySignUpFail')<0)){try{b['sc_events']=u.addEvent("event177")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('easyPaySignUpFail')>-1)){try{b['sc_events']=u.addEvent("event178")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('paperSignUp')>-1&&b['eventNames'].toString().indexOf('paperSignUpFail')<0)){try{b['sc_events']=u.addEvent("event179")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('paperSignUpFail')>-1)){try{b['sc_events']=u.addEvent("event180")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['selfHelpName']!='undefined'&&b['selfHelpName'].toString().indexOf('idm:registration:start')>-1)){try{b['sc_events']=u.addEvent("event169")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['selfHelpName']!='undefined'&&b['selfHelpName'].toString().indexOf('idm:registration:complete')>-1)){try{b['sc_events']=u.addEvent("event170")}catch(e){}} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(typeof b['cp.utag_main_offerOriginPage']=='undefined'){utag.loader.SC('utag_main',{'offerOriginPage':'unknown'+';exp-session'});b['cp.utag_main_offerOriginPage']='unknown';}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if(typeof b['cp.utag_main_offerOriginModal']=='undefined'){utag.loader.SC('utag_main',{'offerOriginModal':'unknown'+';exp-session'});b['cp.utag_main_offerOriginModal']='unknown';}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if(typeof b['cp.utag_main_offerOriginAction']=='undefined'){utag.loader.SC('utag_main',{'offerOriginAction':'page'+';exp-session'});b['cp.utag_main_offerOriginAction']='page';}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if(b['purchaseStep']=='shop'||b['purchaseStep']=='byob'||b['purchaseStep']=='campaign'||b['purchaseStep']=='offer'||b['purchaseStep']=='grid'||b['purchaseStep']=='myaccount'||b['purchaseStep']=='ibill'||b['purchaseStep']=='support'||b['purchaseStep']=='upgrade'||b['purchaseStep']=='phonetools'||b['purchaseStep']=='mktg'||b['pageName']=='cox:res:homelife:homelife-advisor'){utag.loader.SC('utag_main',{'offerOriginPage':b['pageName']+';exp-session'});b['cp.utag_main_offerOriginPage']=b['pageName'];}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if(typeof b['offerOriginModal']!='undefined'){utag.loader.SC('utag_main',{'offerOriginModal':b['offerOriginModal']+';exp-session'});b['cp.utag_main_offerOriginModal']=b['offerOriginModal'];}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if(typeof b['offerOriginAction']!='undefined'){utag.loader.SC('utag_main',{'offerOriginAction':b['offerOriginAction']+';exp-session'});b['cp.utag_main_offerOriginAction']=b['offerOriginAction'];}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&typeof b['_offerOriginPageModalActionTemp']!='undefined'&&b['_offerOriginPageModalActionTemp']!=''&&b['eventNames'].toString().indexOf('cartAdd')>-1&&b['purchaseStep']=='features')){b['_offerOriginPageModalAction']=b['_offerOriginPageModalActionTemp']} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['eventNames']!='undefined'&&b['eventNames'].toString().indexOf('cartAdd')>-1&&typeof b['purchaseStep']!='undefined'&&b['purchaseStep']=='features')){utag.loader.SC('utag_main',{'offerOriginAction':'page'+';exp-session'});b['cp.utag_main_offerOriginAction']='page';}} catch(e){ utag.DB(e) } },
function(a,b){ try{ if((typeof b['pageName']!='undefined'&&b['_utag_event']=='view')){b['pageOrModalName']=b['pageName']} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((typeof b['modalName']!='undefined'&&b['_utag_event']=='link')){b['pageOrModalName']=b['modalName']} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if(1){
if(b['serviceableCodes'] && b['serviceableCodes'].length > 0){
        // format for selected codes: 'PRISMCODE', 'SELF_INSTALL'
        var all_codes = b['serviceableCodes'], desired = ['PRISMCODE'], captured = [];

	function capture(a,b){
	  a = a.split(',');
	  for(var i in a){
	    for(var j in b){
	      checkIfThere(a[i],b[j])
	    }
	  }
	  return removeDupesFrom(upperCase(captured)).join(',');
	}

	function checkIfThere(c,d){
	    if(c.toLowerCase().indexOf(d.toLowerCase()) > -1){
	      captured.push(c);
	    }    
	}

	function removeDupesFrom(a){
	  return a.filter(function(item, pos) {
	    return a.indexOf(item) == pos;
	  })
	}

	function upperCase(a){
	  return a.map(function(n){return n.toUpperCase()})
	}

	b['serviceableCodesSelected'] = capture(all_codes,desired)
	// map to eVar 65
}

} } catch(e){ utag.DB(e) }  }];

  u.send=function(a,b,c,d,e,f){
    if(u.ev[a]||typeof u.ev["all"]!="undefined"){
      u.make_enrichment_request = false;

      for(c=0;c<u.extend.length;c++){try{d=u.extend[c](a,b);if(d==false)return}catch(e){}};

      // If not in our sampling group, then exit (do not fire tag)
      if ( !u.is_in_sample_group( b ) ) {
        return false
      }
      u.get_performance_timing( b );

      for (var i = 0; i < u.server_list.length; i++){
        // Adjust server based on region -- if cookie found, use this
        if ( b["cp.utag_main_dc_region"] ){
          u.region = b["cp.utag_main_dc_region"];
          u.server_list[i] = u.server_list[i].replace("datacloud.","datacloud-" + u.region + ".");
          u.server_list[i] = u.server_list[i].replace("collect.","collect-" + u.region + ".");
        }
        if ( u.enrichment_enabled[i] !== false ){
          u.enrichment_enabled[u.server_list[i]] = true
        }
      }

      // For multiple server locations, need unique vid values for each
      if ( u.server_list.length > 1 ){
        u.profile_specific_vid = 1;
      }
      u.data = utag.datacloud || {};

      u.data["loader.cfg"]={};
      for(d in utag.loader.GV(utag.loader.cfg)){
        if(utag.loader.cfg[d].load && utag.loader.cfg[d].send){
           utag.loader.cfg[d].executed = 1;
        }else{
           utag.loader.cfg[d].executed = 0;
        }
        u.data["loader.cfg"][d]=utag.loader.GV(utag.loader.cfg[d]);
      }
        
      //u.data.cfg=utag.cfg;
      u.data.data=b;
      /* Re-encode items in "qp." params */
      for(d in u.data.data){
        if((d+'').indexOf("qp.")==0){
          u.data.data[d]=encodeURIComponent(u.data.data[d]);
        }else if((d+'').indexOf("va.")==0){
          /* Remove visitor attributes */
          delete u.data.data[d]
        }
      }

      /* Visit Number and Event Count -- event count starts over with each visit */
      if( !b["cp.utag_main_dc_event"] ){
        b["cp.utag_main_dc_visit"] = (1 + ( b["cp.utag_main_dc_visit"]?parseInt(b["cp.utag_main_dc_visit"]):0 )) + '';
      }
      b["cp.utag_main_dc_event"] = (1 + ( b["cp.utag_main_dc_event"]?parseInt(b["cp.utag_main_dc_event"]):0 )) + '';
      utag.loader.SC("utag_main", {"dc_visit": b["cp.utag_main_dc_visit"] , "dc_event": b["cp.utag_main_dc_event"] + ";exp-session"});

      /* Update global data layer for Visitor Attribute check */
      utag.data["cp.utag_main_dc_visit"] = b["cp.utag_main_dc_visit"];
      utag.data["cp.utag_main_dc_event"] = b["cp.utag_main_dc_event"];

      var dt = new Date();
      /* Send browser info */
      u.data.browser = {};
      try{
        u.data.browser["height"] = window.innerHeight || document.body.clientHeight;
        u.data.browser["width"] = window.innerWidth || document.body.clientWidth;
        u.data.browser["screen_height"] = screen.height;
        u.data.browser["screen_width"] = screen.width;
        u.data.browser["timezone_offset"] = dt.getTimezoneOffset();
      }catch(e){utag.DB(e)}

      u.data["event"]=a+'';
      u.data["post_time"]=dt.getTime();

      /* Audience Stream Data Layer Enrichment */
      if( u.data_enrichment == "frequent" || u.data_enrichment == "infrequent" ){

        u.visit_num = b["cp.utag_main_dc_visit"];

        if( parseInt(u.visit_num) > 1 && b["cp.utag_main_dc_event"] == "1"){
          u.enrichment_polling = 2;
        }

        try{
          u.va_update = parseInt(localStorage.getItem("tealium_va_update") || 0);
        }catch(e){utag.DB(e)}

        u.visitor_id = u.visitor_id || b["cp.utag_main_v_id"];
        if( ( u.data_enrichment == "frequent" && !(u.visit_num == "1" && b["cp.utag_main_dc_event"] == "1" ) ) ||
            ( u.data_enrichment == "infrequent" && parseInt(u.visit_num) > 1 && parseInt(b["cp.utag_main_dc_event"]) <= 5 && u.visit_num != u.va_update )){
          u.make_enrichment_request = true;
        }else if(b._corder){
          u.make_enrichment_request = true;
          u.enrichment_polling = 3;
          u.enrichment_polling_delay = 4000;
        }

        u.visitor_service_request = function(t, server){
          var s = "https://" + u.server_prefix + "visitor-service" + (u.region?"-"+u.region:"") + "." + u.server_domain;
          var p = u.get_account_profile( server );
          (function(p){
            // declare multiple functions with dynamic local storage key -- multiple enrichments in same domain
            var prefix = "tealium_va";
            var key = "_" + p[1] + "_" + p[2];
            
            utag.ut["writeva"+p[2]] = function(o){
              utag.DB("Visitor Attributes: " + prefix + key);
              utag.DB(o)
              var str = JSON.stringify(o);
              if(str!="{}" && str!=""){
                try{
                  localStorage.setItem('tealium_va_update', utag.data["cp.utag_main_dc_visit"]);
                  // for utag.js v4.38 or earlier
                  localStorage.setItem( prefix, str);
                  // dynamic location in localstorage (utag.js 4.39 or later)
                  localStorage.setItem( prefix + key, str);
                }catch(e){utag.DB(e)}
                
                if (typeof tealium_enrichment == "function"){
                  tealium_enrichment(o, prefix + key);
                }
              }
            }
          }( p.slice(0) ))

          var vid = u.visitor_id;
          if( u.profile_specific_vid == 1 ){
            vid += p[2]; 
          }
          utag.ut.loader({ id: "tealium_visitor_service_353"+p[2], src: s+"/"+p[1]+"/"+p[2]+"/"+vid+"?callback=utag.ut%5B%22writeva"+p[2]+"%22%5D&rnd="+t });
        }

        u.do_enrichment = function(server, enrichment_polling, enrichment_polling_delay){
          // utag.js 4.27 or later is required
          if( typeof utag.ut.loader!="undefined" ){
            // additional attempts for visitor enrichment
            for(var i=0;i<enrichment_polling;i++){
              setTimeout(function(){ u.visitor_service_request((new Date).getTime(), server) }, i*enrichment_polling_delay+1 );
            }
          }
        }
      }
      var json_string;
      var regExpReplace = new RegExp( u.visitor_id, "g" );
      
      if(window.FormData){
        // modern browsers
        function postData(server_index, enrichment_polling, enrichment_polling_delay){

          if ( server_index+1 > u.server_list.length ){
            return;
          }
          var xhr = new XMLHttpRequest();
          var server = u.server_list[server_index];
          var formData = new FormData();
          xhr.addEventListener('readystatechange', function() {
            if( xhr.readyState === 3 ) {
              try {
                u.region = xhr.getResponseHeader("X-Region") || u.region || "";
              } catch(res_error) {
                utag.DB(res_error);
                u.region = u.region || "";
              }

              if(u.region)utag.loader.SC("utag_main", {"dc_region": u.region+ ";exp-session"});
              utag.DB("dc_region:"+u.region);
            }else if( xhr.readyState === 4 ) {
              // do secondary call for multiple server locations
              postData(server_index+1, enrichment_polling, enrichment_polling_delay);
              if( u.make_enrichment_request && u.enrichment_enabled[server] )u.do_enrichment( server, enrichment_polling, enrichment_polling_delay );
            }
          });
          xhr.open('post', u.server_list[server_index], true);
          xhr.withCredentials = true;
          json_string = JSON.stringify(u.data);
          if( u.profile_specific_vid == 1 ){
            json_string = json_string.replace( regExpReplace, u.visitor_id + u.get_account_profile(server)[2] );
          }
          formData.append("data", json_string);
          xhr.send(formData);
        }

        postData(0, u.enrichment_polling, u.enrichment_polling_delay);
        
      }else{
        // fallback (old browsers)
        for (var i = 0; i < u.server_list.length; i++){
          (function(i, enrichment_polling, enrichment_polling_delay){
            var server = u.server_list[i];
            setTimeout( function(){
              json_string = JSON.stringify(u.data);
              if( u.profile_specific_vid == 1 ){
                json_string = json_string.replace( regExpReplace, u.visitor_id + u.get_account_profile(server)[2] );
              }
              var img = new Image();
              img.src = server +'?data='+encodeURIComponent(json_string);
              if( u.make_enrichment_request && u.enrichment_enabled[server] )u.do_enrichment( server, enrichment_polling, enrichment_polling_delay );
            }, i*700 );
          }(i, u.enrichment_polling, u.enrichment_polling_delay))
        }
      }
    }
  }
  try{utag.o[loader].loader.LOAD(id)}catch(e){utag.loader.LOAD(id)}
})('353','cox.main');
}catch(e){ utag.DB(e) }
//end tealium universal tag
