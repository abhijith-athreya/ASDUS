!function e(t,n,o){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return r(n?n:e)},d,d.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){(function(e){!function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof n&&"object"==typeof t)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function t(e){return function(){return Y.apply(e,arguments)}}function n(e){return e===Object(e)}function o(e){return"[object StopIteration]"===ne(e)||e instanceof z}function r(e,t){if(F&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(oe)){for(var n=[],o=t;o;o=o.source)o.stack&&n.unshift(o.stack);n.unshift(e.stack);var r=n.join("\n"+oe+"\n");e.stack=i(r)}}function i(e){for(var t=e.split("\n"),n=[],o=0;o<t.length;++o){var r=t[o];c(r)||s(r)||!r||n.push(r)}return n.join("\n")}function s(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function a(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var o=/.*@(.+):(\d+)$/.exec(e);return o?[o[1],Number(o[2])]:void 0}function c(e){var t=a(e);if(!t)return!1;var n=t[0],o=t[1];return n===G&&o>=K&&ae>=o}function u(){if(F)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],o=a(n);if(!o)return;return G=o[0],o[1]}}function d(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack),e.apply(e,arguments)}}function l(e){return e instanceof h?e:w(e)?T(e):x(e)}function f(){function e(e){t=e,i.source=e,Q(n,function(t,n){H(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,o=void 0}var t,n=[],o=[],r=J(f.prototype),i=J(h.prototype);if(i.promiseDispatch=function(e,r,i){var s=X(arguments);n?(n.push(s),"when"===r&&i[1]&&o.push(i[1])):H(function(){t.promiseDispatch.apply(t,s)})},i.valueOf=function(){if(n)return i;var e=v(t);return y(e)&&(t=e),e},i.inspect=function(){return t?t.inspect():{state:"pending"}},l.longStackSupport&&F)try{throw new Error}catch(s){i.stack=s.stack.substring(s.stack.indexOf("\n")+1)}return r.promise=i,r.resolve=function(n){t||e(l(n))},r.fulfill=function(n){t||e(x(n))},r.reject=function(n){t||e(S(n))},r.notify=function(e){t||Q(o,function(t,n){H(function(){n(e)})},void 0)},r}function p(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=f();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function g(e){return p(function(t,n){for(var o=0,r=e.length;r>o;o++)l(e[o]).then(t,n)})}function h(e,t,n){void 0===t&&(t=function(e){return S(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var o=J(h.prototype);if(o.promiseDispatch=function(n,r,i){var s;try{s=e[r]?e[r].apply(o,i):t.call(o,r,i)}catch(a){s=S(a)}n&&n(s)},o.inspect=n,n){var r=n();"rejected"===r.state&&(o.exception=r.reason),o.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?o:e.value}}return o}function m(e,t,n,o){return l(e).then(t,n,o)}function v(e){if(y(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function y(e){return n(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function w(e){return n(e)&&"function"==typeof e.then}function b(e){return y(e)&&"pending"===e.inspect().state}function k(e){return!y(e)||"fulfilled"===e.inspect().state}function E(e){return y(e)&&"rejected"===e.inspect().state}function _(){re.length=0,ie.length=0,se||(se=!0)}function I(e,t){se&&(ie.push(e),re.push(t&&"undefined"!=typeof t.stack?t.stack:"(no stack) "+t))}function A(e){if(se){var t=$(ie,e);-1!==t&&(ie.splice(t,1),re.splice(t,1))}}function S(e){var t=h({when:function(t){return t&&A(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return I(t,e),t}function x(e){return h({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return te(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function T(e){var t=f();return H(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function O(e){return h({isDef:function(){}},function(t,n){return L(e,t,n)},function(){return l(e).inspect()})}function R(e,t,n){return l(e).spread(t,n)}function N(e){return function(){function t(e,t){var s;if("undefined"==typeof StopIteration){try{s=n[e](t)}catch(a){return S(a)}return s.done?l(s.value):m(s.value,r,i)}try{s=n[e](t)}catch(a){return o(a)?l(a.value):S(a)}return m(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"next"),i=t.bind(t,"throw");return r()}}function C(e){l.done(l.async(e)())}function D(e){throw new z(e)}function P(e){return function(){return R([this,j(arguments)],function(t,n){return e.apply(t,n)})}}function L(e,t,n){return l(e).dispatch(t,n)}function j(e){return m(e,function(e){var t=0,n=f();return Q(e,function(o,r,i){var s;y(r)&&"fulfilled"===(s=r.inspect()).state?e[i]=s.value:(++t,m(r,function(o){e[i]=o,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:i,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function U(e){return m(e,function(e){return e=Z(e,l),m(j(Z(e,function(e){return m(e,W,W)})),function(){return e})})}function M(e){return l(e).allSettled()}function q(e,t){return l(e).then(void 0,void 0,t)}function B(e,t){return l(e).nodeify(t)}var F=!1;try{throw new Error}catch(V){F=!!V.stack}var G,z,K=u(),W=function(){},H=function(){function t(){for(;n.next;){n=n.next;var e=n.task;n.task=void 0;var o=n.domain;o&&(n.domain=void 0,o.enter());try{e()}catch(i){if(s)throw o&&o.exit(),setTimeout(t,0),o&&o.enter(),i;setTimeout(function(){throw i},0)}o&&o.exit()}r=!1}var n={task:void 0,next:null},o=n,r=!1,i=void 0,s=!1;if(H=function(t){o=o.next={task:t,domain:s&&e.domain,next:null},r||(r=!0,i())},"undefined"!=typeof e&&e.nextTick)s=!0,i=function(){e.nextTick(t)};else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){i=c,a.port1.onmessage=t,t()};var c=function(){a.port2.postMessage(0)};i=function(){setTimeout(t,0),c()}}else i=function(){setTimeout(t,0)};return H}(),Y=Function.call,X=t(Array.prototype.slice),Q=t(Array.prototype.reduce||function(e,t){var n=0,o=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=o)throw new TypeError}for(;o>n;n++)n in this&&(t=e(t,this[n],n));return t}),$=t(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),Z=t(Array.prototype.map||function(e,t){var n=this,o=[];return Q(n,function(r,i,s){o.push(e.call(t,i,s,n))},void 0),o}),J=Object.create||function(e){function t(){}return t.prototype=e,new t},ee=t(Object.prototype.hasOwnProperty),te=Object.keys||function(e){var t=[];for(var n in e)ee(e,n)&&t.push(n);return t},ne=t(Object.prototype.toString);z="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var oe="From previous event:";l.resolve=l,l.nextTick=H,l.longStackSupport=!1,l.defer=f,f.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):e.resolve(arguments.length>2?X(arguments,1):n)}},l.Promise=p,l.promise=p,p.race=g,p.all=j,p.reject=S,p.resolve=l,l.passByCopy=function(e){return e},h.prototype.passByCopy=function(){return this},l.join=function(e,t){return l(e).join(t)},h.prototype.join=function(e){return l([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},l.race=g,h.prototype.race=function(){return this.then(l.race)},l.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(e,t,n){function o(t){try{return"function"==typeof e?e(t):t}catch(n){return S(n)}}function i(e){if("function"==typeof t){r(e,a);try{return t(e)}catch(n){return S(n)}}return S(e)}function s(e){return"function"==typeof n?n(e):e}var a=this,c=f(),u=!1;return H(function(){a.promiseDispatch(function(e){u||(u=!0,c.resolve(o(e)))},"when",[function(e){u||(u=!0,c.resolve(i(e)))}])}),a.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=s(e)}catch(o){if(n=!0,!l.onerror)throw o;l.onerror(o)}n||c.notify(t)}]),c.promise},l.when=m,h.prototype.thenResolve=function(e){return this.then(function(){return e})},l.thenResolve=function(e,t){return l(e).thenResolve(t)},h.prototype.thenReject=function(e){return this.then(function(){throw e})},l.thenReject=function(e,t){return l(e).thenReject(t)},l.nearer=v,l.isPromise=y,l.isPromiseAlike=w,l.isPending=b,h.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=k,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=E,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var re=[],ie=[],se=!0;l.resetUnhandledRejections=_,l.getUnhandledReasons=function(){return re.slice()},l.stopUnhandledRejectionTracking=function(){_(),se=!1},_(),l.reject=S,l.fulfill=x,l.master=O,l.spread=R,h.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},l.async=N,l.spawn=C,l["return"]=D,l.promised=P,l.dispatch=L,h.prototype.dispatch=function(e,t){var n=this,o=f();return H(function(){n.promiseDispatch(o.resolve,e,t)}),o.promise},l.get=function(e,t){return l(e).dispatch("get",[t])},h.prototype.get=function(e){return this.dispatch("get",[e])},l.set=function(e,t,n){return l(e).dispatch("set",[t,n])},h.prototype.set=function(e,t){return this.dispatch("set",[e,t])},l.del=l["delete"]=function(e,t){return l(e).dispatch("delete",[t])},h.prototype.del=h.prototype["delete"]=function(e){return this.dispatch("delete",[e])},l.mapply=l.post=function(e,t,n){return l(e).dispatch("post",[t,n])},h.prototype.mapply=h.prototype.post=function(e,t){return this.dispatch("post",[e,t])},l.send=l.mcall=l.invoke=function(e,t){return l(e).dispatch("post",[t,X(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(e){return this.dispatch("post",[e,X(arguments,1)])},l.fapply=function(e,t){return l(e).dispatch("apply",[void 0,t])},h.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},l["try"]=l.fcall=function(e){return l(e).dispatch("apply",[void 0,X(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},l.fbind=function(e){var t=l(e),n=X(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(X(arguments))])}},h.prototype.fbind=function(){var e=this,t=X(arguments);return function(){return e.dispatch("apply",[this,t.concat(X(arguments))])}},l.keys=function(e){return l(e).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},l.all=j,h.prototype.all=function(){return j(this)},l.allResolved=d(U,"allResolved","allSettled"),h.prototype.allResolved=function(){return U(this)},l.allSettled=M,h.prototype.allSettled=function(){return this.then(function(e){return j(Z(e,function(e){function t(){return e.inspect()}return e=l(e),e.then(t,t)}))})},l.fail=l["catch"]=function(e,t){return l(e).then(void 0,t)},h.prototype.fail=h.prototype["catch"]=function(e){return this.then(void 0,e)},l.progress=q,h.prototype.progress=function(e){return this.then(void 0,void 0,e)},l.fin=l["finally"]=function(e,t){return l(e)["finally"](t)},h.prototype.fin=h.prototype["finally"]=function(e){return e=l(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},l.done=function(e,t,n,o){return l(e).done(t,n,o)},h.prototype.done=function(t,n,o){var i=function(e){H(function(){if(r(e,s),!l.onerror)throw e;l.onerror(e)})},s=t||n||o?this.then(t,n,o):this;"object"==typeof e&&e&&e.domain&&(i=e.domain.bind(i)),s.then(void 0,i)},l.timeout=function(e,t,n){return l(e).timeout(t,n)},h.prototype.timeout=function(e,t){var n=f(),o=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(o),n.resolve(e)},function(e){clearTimeout(o),n.reject(e)},n.notify),n.promise},l.delay=function(e,t){return void 0===t&&(t=e,e=void 0),l(e).delay(t)},h.prototype.delay=function(e){return this.then(function(t){var n=f();return setTimeout(function(){n.resolve(t)},e),n.promise})},l.nfapply=function(e,t){return l(e).nfapply(t)},h.prototype.nfapply=function(e){var t=f(),n=X(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},l.nfcall=function(e){var t=X(arguments,1);return l(e).nfapply(t)},h.prototype.nfcall=function(){var e=X(arguments),t=f();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},l.nfbind=l.denodeify=function(e){var t=X(arguments,1);return function(){var n=t.concat(X(arguments)),o=f();return n.push(o.makeNodeResolver()),l(e).fapply(n).fail(o.reject),o.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var e=X(arguments);return e.unshift(this),l.denodeify.apply(void 0,e)},l.nbind=function(e,t){var n=X(arguments,2);return function(){function o(){return e.apply(t,arguments)}var r=n.concat(X(arguments)),i=f();return r.push(i.makeNodeResolver()),l(o).fapply(r).fail(i.reject),i.promise}},h.prototype.nbind=function(){var e=X(arguments,0);return e.unshift(this),l.nbind.apply(void 0,e)},l.nmapply=l.npost=function(e,t,n){return l(e).npost(t,n)},h.prototype.nmapply=h.prototype.npost=function(e,t){var n=X(t||[]),o=f();return n.push(o.makeNodeResolver()),this.dispatch("post",[e,n]).fail(o.reject),o.promise},l.nsend=l.nmcall=l.ninvoke=function(e,t){var n=X(arguments,2),o=f();return n.push(o.makeNodeResolver()),l(e).dispatch("post",[t,n]).fail(o.reject),o.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(e){var t=X(arguments,1),n=f();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},l.nodeify=B,h.prototype.nodeify=function(e){return e?void this.then(function(t){H(function(){e(null,t)})},function(t){H(function(){e(t)})}):this};var ae=u();return l})}).call(this,e("_process"))},{_process:4}],2:[function(e,t,n){"use strict";var o={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};"undefined"!=typeof t&&t.exports&&(t.exports=o),"function"==typeof define&&define([],function(){return o}),o.cipher.aes=function(e){this._tables[0][0][0]||this._precompute();var t,n,r,i,s,a=this._tables[0][4],c=this._tables[1],u=e.length,d=1;if(4!==u&&6!==u&&8!==u)throw new o.exception.invalid("invalid aes key size");for(this._key=[i=e.slice(0),s=[]],t=u;4*u+28>t;t++)r=i[t-1],(t%u===0||8===u&&t%u===4)&&(r=a[r>>>24]<<24^a[r>>16&255]<<16^a[r>>8&255]<<8^a[255&r],t%u===0&&(r=r<<8^r>>>24^d<<24,d=d<<1^283*(d>>7))),i[t]=i[t-u]^r;for(n=0;t;n++,t--)r=i[3&n?t:t-4],s[n]=4>=t||4>n?r:c[0][a[r>>>24]]^c[1][a[r>>16&255]]^c[2][a[r>>8&255]]^c[3][a[255&r]]},o.cipher.aes.prototype={encrypt:function(e){return this._crypt(e,0)},decrypt:function(e){return this._crypt(e,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var e,t,n,o,r,i,s,a,c,u=this._tables[0],d=this._tables[1],l=u[4],f=d[4],p=[],g=[];for(e=0;256>e;e++)g[(p[e]=e<<1^283*(e>>7))^e]=e;for(t=n=0;!l[t];t^=o||1,n=g[n]||1)for(s=n^n<<1^n<<2^n<<3^n<<4,s=s>>8^255&s^99,l[t]=s,f[s]=t,i=p[r=p[o=p[t]]],c=16843009*i^65537*r^257*o^16843008*t,a=257*p[s]^16843008*s,e=0;4>e;e++)u[e][t]=a=a<<24^a>>>8,d[e][s]=c=c<<24^c>>>8;for(e=0;5>e;e++)u[e]=u[e].slice(0),d[e]=d[e].slice(0)},_crypt:function(e,t){if(4!==e.length)throw new o.exception.invalid("invalid aes block size");var n,r,i,s,a=this._key[t],c=e[0]^a[0],u=e[t?3:1]^a[1],d=e[2]^a[2],l=e[t?1:3]^a[3],f=a.length/4-2,p=4,g=[0,0,0,0],h=this._tables[t],m=h[0],v=h[1],y=h[2],w=h[3],b=h[4];for(s=0;f>s;s++)n=m[c>>>24]^v[u>>16&255]^y[d>>8&255]^w[255&l]^a[p],r=m[u>>>24]^v[d>>16&255]^y[l>>8&255]^w[255&c]^a[p+1],i=m[d>>>24]^v[l>>16&255]^y[c>>8&255]^w[255&u]^a[p+2],l=m[l>>>24]^v[c>>16&255]^y[u>>8&255]^w[255&d]^a[p+3],p+=4,c=n,u=r,d=i;for(s=0;4>s;s++)g[t?3&-s:s]=b[c>>>24]<<24^b[u>>16&255]<<16^b[d>>8&255]<<8^b[255&l]^a[p++],n=c,c=u,u=d,d=l,l=n;return g}},o.bitArray={bitSlice:function(e,t,n){return e=o.bitArray._shiftRight(e.slice(t/32),32-(31&t)).slice(1),void 0===n?e:o.bitArray.clamp(e,n-t)},extract:function(e,t,n){var o,r=Math.floor(-t-n&31);return o=-32&(t+n-1^t)?e[t/32|0]<<32-r^e[t/32+1|0]>>>r:e[t/32|0]>>>r,o&(1<<n)-1},concat:function(e,t){if(0===e.length||0===t.length)return e.concat(t);var n=e[e.length-1],r=o.bitArray.getPartial(n);return 32===r?e.concat(t):o.bitArray._shiftRight(t,r,0|n,e.slice(0,e.length-1))},bitLength:function(e){var t,n=e.length;return 0===n?0:(t=e[n-1],32*(n-1)+o.bitArray.getPartial(t))},clamp:function(e,t){if(32*e.length<t)return e;e=e.slice(0,Math.ceil(t/32));var n=e.length;return t=31&t,n>0&&t&&(e[n-1]=o.bitArray.partial(t,e[n-1]&2147483648>>t-1,1)),e},partial:function(e,t,n){return 32===e?t:(n?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(o.bitArray.bitLength(e)!==o.bitArray.bitLength(t))return!1;var n,r=0;for(n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r},_shiftRight:function(e,t,n,r){var i,s,a=0;for(void 0===r&&(r=[]);t>=32;t-=32)r.push(n),n=0;if(0===t)return r.concat(e);for(i=0;i<e.length;i++)r.push(n|e[i]>>>t),n=e[i]<<32-t;return a=e.length?e[e.length-1]:0,s=o.bitArray.getPartial(a),r.push(o.bitArray.partial(t+s&31,t+s>32?n:r.pop(),1)),r},_xor4:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]},byteswapM:function(e){var t,n,o=65280;for(t=0;t<e.length;++t)n=e[t],e[t]=n>>>24|n>>>8&o|(n&o)<<8|n<<24;return e}},o.codec.utf8String={fromBits:function(e){var t,n,r="",i=o.bitArray.bitLength(e);for(t=0;i/8>t;t++)0===(3&t)&&(n=e[t/4]),r+=String.fromCharCode(n>>>24),n<<=8;return decodeURIComponent(escape(r))},toBits:function(e){e=unescape(encodeURIComponent(e));var t,n=[],r=0;for(t=0;t<e.length;t++)r=r<<8|e.charCodeAt(t),3===(3&t)&&(n.push(r),r=0);return 3&t&&n.push(o.bitArray.partial(8*(3&t),r)),n}},o.codec.hex={fromBits:function(e){var t,n="";for(t=0;t<e.length;t++)n+=((0|e[t])+0xf00000000000).toString(16).substr(4);return n.substr(0,o.bitArray.bitLength(e)/4)},toBits:function(e){var t,n,r=[];for(e=e.replace(/\s|0x/g,""),n=e.length,e+="00000000",t=0;t<e.length;t+=8)r.push(0^parseInt(e.substr(t,8),16));return o.bitArray.clamp(r,4*n)}},o.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,n){var r,i="",s=0,a=o.codec.base64._chars,c=0,u=o.bitArray.bitLength(e);for(n&&(a=a.substr(0,62)+"-_"),r=0;6*i.length<u;)i+=a.charAt((c^e[r]>>>s)>>>26),6>s?(c=e[r]<<6-s,s+=26,r++):(c<<=6,s-=6);for(;3&i.length&&!t;)i+="=";return i},toBits:function(e,t){e=e.replace(/\s|=/g,"");var n,r,i=[],s=0,a=o.codec.base64._chars,c=0;for(t&&(a=a.substr(0,62)+"-_"),n=0;n<e.length;n++){if(r=a.indexOf(e.charAt(n)),0>r)throw new o.exception.invalid("this isn't base64!");s>26?(s-=26,i.push(c^r>>>s),c=r<<32-s):(s+=6,c^=r<<32-s)}return 56&s&&i.push(o.bitArray.partial(56&s,c,1)),i}},o.codec.base64url={fromBits:function(e){return o.codec.base64.fromBits(e,1,1)},toBits:function(e){return o.codec.base64.toBits(e,1)}},o.hash.sha256=function(e){this._key[0]||this._precompute(),e?(this._h=e._h.slice(0),this._buffer=e._buffer.slice(0),this._length=e._length):this.reset()},o.hash.sha256.hash=function(e){return(new o.hash.sha256).update(e).finalize()},o.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(e){"string"==typeof e&&(e=o.codec.utf8String.toBits(e));var t,n=this._buffer=o.bitArray.concat(this._buffer,e),r=this._length,i=this._length=r+o.bitArray.bitLength(e);for(t=512+r&-512;i>=t;t+=512)this._block(n.splice(0,16));return this},finalize:function(){var e,t=this._buffer,n=this._h;for(t=o.bitArray.concat(t,[o.bitArray.partial(1,1)]),e=t.length+2;15&e;e++)t.push(0);for(t.push(Math.floor(this._length/4294967296)),t.push(0|this._length);t.length;)this._block(t.splice(0,16));return this.reset(),n},_init:[],_key:[],_precompute:function(){function e(e){return 4294967296*(e-Math.floor(e))|0}var t,n=0,o=2;e:for(;64>n;o++){for(t=2;o>=t*t;t++)if(o%t===0)continue e;8>n&&(this._init[n]=e(Math.pow(o,.5))),this._key[n]=e(Math.pow(o,1/3)),n++}},_block:function(e){var t,n,o,r,i=e.slice(0),s=this._h,a=this._key,c=s[0],u=s[1],d=s[2],l=s[3],f=s[4],p=s[5],g=s[6],h=s[7];for(t=0;64>t;t++)16>t?n=i[t]:(o=i[t+1&15],r=i[t+14&15],n=i[15&t]=(o>>>7^o>>>18^o>>>3^o<<25^o<<14)+(r>>>17^r>>>19^r>>>10^r<<15^r<<13)+i[15&t]+i[t+9&15]|0),n=n+h+(f>>>6^f>>>11^f>>>25^f<<26^f<<21^f<<7)+(g^f&(p^g))+a[t],h=g,g=p,p=f,f=l+n|0,l=d,d=u,u=c,c=n+(u&d^l&(u^d))+(u>>>2^u>>>13^u>>>22^u<<30^u<<19^u<<10)|0;s[0]=s[0]+c|0,s[1]=s[1]+u|0,s[2]=s[2]+d|0,s[3]=s[3]+l|0,s[4]=s[4]+f|0,s[5]=s[5]+p|0,s[6]=s[6]+g|0,s[7]=s[7]+h|0}},o.mode.ccm={name:"ccm",encrypt:function(e,t,n,r,i){var s,a,c=t.slice(0),u=o.bitArray,d=u.bitLength(n)/8,l=u.bitLength(c)/8;if(i=i||64,r=r||[],7>d)throw new o.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;4>s&&l>>>8*s;s++);return 15-d>s&&(s=15-d),n=u.clamp(n,8*(15-s)),a=o.mode.ccm._computeTag(e,t,n,r,i,s),c=o.mode.ccm._ctrMode(e,c,n,a,i,s),u.concat(c.data,c.tag)},decrypt:function(e,t,n,r,i){i=i||64,r=r||[];var s,a,c=o.bitArray,u=c.bitLength(n)/8,d=c.bitLength(t),l=c.clamp(t,d-i),f=c.bitSlice(t,d-i);if(d=(d-i)/8,7>u)throw new o.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;4>s&&d>>>8*s;s++);if(15-u>s&&(s=15-u),n=c.clamp(n,8*(15-s)),l=o.mode.ccm._ctrMode(e,l,n,f,i,s),a=o.mode.ccm._computeTag(e,l.data,n,r,i,s),!c.equal(l.tag,a))throw new o.exception.corrupt("ccm: tag doesn't match");return l.data},_computeTag:function(e,t,n,r,i,s){var a,c,u,d=[],l=o.bitArray,f=l._xor4;if(i/=8,i%2||4>i||i>16)throw new o.exception.invalid("ccm: invalid tag length");if(r.length>4294967295||t.length>4294967295)throw new o.exception.bug("ccm: can't deal with 4GiB or more data");if(a=[l.partial(8,(r.length?64:0)|i-2<<2|s-1)],a=l.concat(a,n),a[3]|=l.bitLength(t)/8,a=e.encrypt(a),r.length)for(c=l.bitLength(r)/8,65279>=c?d=[l.partial(16,c)]:4294967295>=c&&(d=l.concat([l.partial(16,65534)],[c])),d=l.concat(d,r),u=0;u<d.length;u+=4)a=e.encrypt(f(a,d.slice(u,u+4).concat([0,0,0])));for(u=0;u<t.length;u+=4)a=e.encrypt(f(a,t.slice(u,u+4).concat([0,0,0])));return l.clamp(a,8*i)},_ctrMode:function(e,t,n,r,i,s){var a,c,u,d=o.bitArray,l=d._xor4,f=t.length,p=d.bitLength(t);if(u=d.concat([d.partial(8,s-1)],n).concat([0,0,0]).slice(0,4),r=d.bitSlice(l(r,e.encrypt(u)),0,i),!f)return{tag:r,data:[]};for(c=0;f>c;c+=4)u[3]++,a=e.encrypt(u),t[c]^=a[0],t[c+1]^=a[1],t[c+2]^=a[2],t[c+3]^=a[3];return{tag:r,data:d.clamp(t,p)}}},o.mode.ocb2={name:"ocb2",encrypt:function(e,t,n,r,i,s){if(128!==o.bitArray.bitLength(n))throw new o.exception.invalid("ocb iv must be 128 bits");var a,c,u,d,l=o.mode.ocb2._times2,f=o.bitArray,p=f._xor4,g=[0,0,0,0],h=l(e.encrypt(n)),m=[];for(r=r||[],i=i||64,a=0;a+4<t.length;a+=4)c=t.slice(a,a+4),g=p(g,c),m=m.concat(p(h,e.encrypt(p(h,c)))),h=l(h);return c=t.slice(a),u=f.bitLength(c),d=e.encrypt(p(h,[0,0,0,u])),c=f.clamp(p(c.concat([0,0,0]),d),u),g=p(g,p(c.concat([0,0,0]),d)),g=e.encrypt(p(g,p(h,l(h)))),r.length&&(g=p(g,s?r:o.mode.ocb2.pmac(e,r))),m.concat(f.concat(c,f.clamp(g,i)))},decrypt:function(e,t,n,r,i,s){if(128!==o.bitArray.bitLength(n))throw new o.exception.invalid("ocb iv must be 128 bits");i=i||64;var a,c,u,d,l=o.mode.ocb2._times2,f=o.bitArray,p=f._xor4,g=[0,0,0,0],h=l(e.encrypt(n)),m=o.bitArray.bitLength(t)-i,v=[];for(r=r||[],a=0;m/32>a+4;a+=4)c=p(h,e.decrypt(p(h,t.slice(a,a+4)))),g=p(g,c),v=v.concat(c),h=l(h);if(u=m-32*a,d=e.encrypt(p(h,[0,0,0,u])),c=p(d,f.clamp(t.slice(a),u).concat([0,0,0])),g=p(g,c),g=e.encrypt(p(g,p(h,l(h)))),r.length&&(g=p(g,s?r:o.mode.ocb2.pmac(e,r))),!f.equal(f.clamp(g,i),f.bitSlice(t,m)))throw new o.exception.corrupt("ocb: tag doesn't match");return v.concat(f.clamp(c,u))},pmac:function(e,t){var n,r,i=o.mode.ocb2._times2,s=o.bitArray,a=s._xor4,c=[0,0,0,0],u=e.encrypt([0,0,0,0]);for(u=a(u,i(i(u))),n=0;n+4<t.length;n+=4)u=i(u),c=a(c,e.encrypt(a(u,t.slice(n,n+4))));return r=t.slice(n),s.bitLength(r)<128&&(u=a(u,i(u)),r=s.concat(r,[-2147483648,0,0,0])),c=a(c,r),e.encrypt(a(i(a(u,i(u))),c))},_times2:function(e){return[e[0]<<1^e[1]>>>31,e[1]<<1^e[2]>>>31,e[2]<<1^e[3]>>>31,e[3]<<1^135*(e[0]>>>31)]}},o.mode.gcm={name:"gcm",encrypt:function(e,t,n,r,i){var s,a=t.slice(0),c=o.bitArray;return i=i||128,r=r||[],s=o.mode.gcm._ctrMode(!0,e,a,r,n,i),c.concat(s.data,s.tag)},decrypt:function(e,t,n,r,i){var s,a,c=t.slice(0),u=o.bitArray,d=u.bitLength(c);if(i=i||128,r=r||[],d>=i?(a=u.bitSlice(c,d-i),c=u.bitSlice(c,0,d-i)):(a=c,c=[]),s=o.mode.gcm._ctrMode(!1,e,c,r,n,i),!u.equal(s.tag,a))throw new o.exception.corrupt("gcm: tag doesn't match");return s.data},_galoisMultiply:function(e,t){var n,r,i,s,a,c,u=o.bitArray,d=u._xor4;for(s=[0,0,0,0],a=t.slice(0),n=0;128>n;n++){for(i=0!==(e[Math.floor(n/32)]&1<<31-n%32),i&&(s=d(s,a)),c=0!==(1&a[3]),r=3;r>0;r--)a[r]=a[r]>>>1|(1&a[r-1])<<31;a[0]=a[0]>>>1,c&&(a[0]=a[0]^225<<24)}return s},_ghash:function(e,t,n){var r,i,s=n.length;for(r=t.slice(0),i=0;s>i;i+=4)r[0]^=4294967295&n[i],r[1]^=4294967295&n[i+1],r[2]^=4294967295&n[i+2],r[3]^=4294967295&n[i+3],r=o.mode.gcm._galoisMultiply(r,e);return r},_ctrMode:function(e,t,n,r,i,s){var a,c,u,d,l,f,p,g,h,m,v,y,w=o.bitArray;for(h=n.length,m=w.bitLength(n),v=w.bitLength(r),y=w.bitLength(i),a=t.encrypt([0,0,0,0]),96===y?(c=i.slice(0),c=w.concat(c,[1])):(c=o.mode.gcm._ghash(a,[0,0,0,0],i),c=o.mode.gcm._ghash(a,c,[0,0,Math.floor(y/4294967296),4294967295&y])),u=o.mode.gcm._ghash(a,[0,0,0,0],r),f=c.slice(0),p=u.slice(0),e||(p=o.mode.gcm._ghash(a,u,n)),l=0;h>l;l+=4)f[3]++,d=t.encrypt(f),n[l]^=d[0],n[l+1]^=d[1],n[l+2]^=d[2],n[l+3]^=d[3];return n=w.clamp(n,m),e&&(p=o.mode.gcm._ghash(a,u,n)),g=[Math.floor(v/4294967296),4294967295&v,Math.floor(m/4294967296),4294967295&m],p=o.mode.gcm._ghash(a,p,g),d=t.encrypt(c),p[0]^=d[0],p[1]^=d[1],p[2]^=d[2],p[3]^=d[3],{tag:w.bitSlice(p,0,s),data:n}}},o.misc.hmac=function(e,t){this._hash=t=t||o.hash.sha256;var n,r=[[],[]],i=t.prototype.blockSize/32;for(this._baseHash=[new t,new t],e.length>i&&(e=t.hash(e)),n=0;i>n;n++)r[0][n]=909522486^e[n],r[1][n]=1549556828^e[n];this._baseHash[0].update(r[0]),this._baseHash[1].update(r[1]),this._resultHash=new t(this._baseHash[0])},o.misc.hmac.prototype.encrypt=o.misc.hmac.prototype.mac=function(e){if(this._updated)throw new o.exception.invalid("encrypt on already updated hmac called!");return this.update(e),this.digest(e)},o.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1},o.misc.hmac.prototype.update=function(e){this._updated=!0,this._resultHash.update(e)},o.misc.hmac.prototype.digest=function(){var e=this._resultHash.finalize(),t=new this._hash(this._baseHash[1]).update(e).finalize();return this.reset(),t},o.misc.pbkdf2=function(e,t,n,r,i){if(n=n||1e3,0>r||0>n)throw o.exception.invalid("invalid params to pbkdf2");"string"==typeof e&&(e=o.codec.utf8String.toBits(e)),"string"==typeof t&&(t=o.codec.utf8String.toBits(t)),i=i||o.misc.hmac;var s,a,c,u,d,l=new i(e),f=[],p=o.bitArray;for(d=1;32*f.length<(r||1);d++){for(s=a=l.encrypt(p.concat(t,[d])),c=1;n>c;c++)for(a=l.encrypt(a),u=0;u<a.length;u++)s[u]^=a[u];f=f.concat(s)}return r&&(f=p.clamp(f,r)),f},o.prng=function(e){this._pools=[new o.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=e,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80},o.prng.prototype={randomWords:function(e,t){var n,r,i=[],s=this.isReady(t);if(s===this._NOT_READY)throw new o.exception.notReady("generator isn't seeded");for(s&this._REQUIRES_RESEED&&this._reseedFromPools(!(s&this._READY)),n=0;e>n;n+=4)(n+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),r=this._gen4words(),i.push(r[0],r[1],r[2],r[3]);return this._gate(),i.slice(0,e)},setDefaultParanoia:function(e,t){if(0===e&&"Setting paranoia=0 will ruin your security; use it only for testing"!==t)throw"Setting paranoia=0 will ruin your security; use it only for testing";this._defaultParanoia=e},addEntropy:function(e,t,n){n=n||"user";var r,i,s,a,c=(new Date).valueOf(),u=this._robins[n],d=this.isReady(),l=0;switch(r=this._collectorIds[n],void 0===r&&(r=this._collectorIds[n]=this._collectorIdNext++),void 0===u&&(u=this._robins[n]=0),this._robins[n]=(this._robins[n]+1)%this._pools.length,typeof e){case"number":void 0===t&&(t=1),this._pools[u].update([r,this._eventId++,1,t,c,1,0|e]);break;case"object":if(a=Object.prototype.toString.call(e),"[object Uint32Array]"===a){for(s=[],i=0;i<e.length;i++)s.push(e[i]);e=s}else for("[object Array]"!==a&&(l=1),i=0;i<e.length&&!l;i++)"number"!=typeof e[i]&&(l=1);if(!l){if(void 0===t)for(t=0,i=0;i<e.length;i++)for(s=e[i];s>0;)t++,s>>>=1;this._pools[u].update([r,this._eventId++,2,t,c,e.length].concat(e))}break;case"string":void 0===t&&(t=e.length),this._pools[u].update([r,this._eventId++,3,t,c,e.length]),this._pools[u].update(e);break;default:l=1}if(l)throw new o.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[u]+=t,this._poolStrength+=t,d===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(e){var t=this._PARANOIA_LEVELS[void 0!==e?e:this._defaultParanoia];return this._strength&&this._strength>=t?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=t?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(e){var t=this._PARANOIA_LEVELS[e?e:this._defaultParanoia];return this._strength>=t?1:this._poolStrength>t?1:this._poolStrength/t},startCollectors:function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)},window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.addEventListener("touchmove",this._eventListener.touchCollector,!1);else{if(!document.attachEvent)throw new o.exception.bug("can't attach event");

document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.removeEventListener("touchmove",this._eventListener.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(e,t){this._callbacks[e][this._callbackI++]=t},removeEventListener:function(e,t){var n,o,r=this._callbacks[e],i=[];for(o in r)r.hasOwnProperty(o)&&r[o]===t&&i.push(o);for(n=0;n<i.length;n++)o=i[n],delete r[o]},_bind:function(e){var t=this;return function(){e.apply(t,arguments)}},_gen4words:function(){for(var e=0;4>e&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new o.cipher.aes(this._key)},_reseed:function(e){this._key=o.hash.sha256.hash(this._key.concat(e)),this._cipher=new o.cipher.aes(this._key);for(var t=0;4>t&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);},_reseedFromPools:function(e){var t,n=[],r=0;for(this._nextReseed=n[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,t=0;16>t;t++)n.push(4294967296*Math.random()|0);for(t=0;t<this._pools.length&&(n=n.concat(this._pools[t].finalize()),r+=this._poolEntropy[t],this._poolEntropy[t]=0,e||!(this._reseedCount&1<<t));t++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new o.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=r,r>this._strength&&(this._strength=r),this._reseedCount++,this._reseed(n)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(e){var t,n;try{t=e.x||e.clientX||e.offsetX||0,n=e.y||e.clientY||e.offsetY||0}catch(r){t=0,n=0}0!=t&&0!=n&&o.random.addEntropy([t,n],2,"mouse"),this._addCurrentTimeToEntropy(0)},_touchCollector:function(e){var t=e.touches[0]||e.changedTouches[0],n=t.pageX||t.clientX,r=t.pageY||t.clientY;o.random.addEntropy([n,r],1,"touch"),this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(e){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?o.random.addEntropy(window.performance.now(),e,"loadtime"):o.random.addEntropy((new Date).valueOf(),e,"loadtime")},_accelerometerCollector:function(e){var t=e.accelerationIncludingGravity.x||e.accelerationIncludingGravity.y||e.accelerationIncludingGravity.z;if(window.orientation){var n=window.orientation;"number"==typeof n&&o.random.addEntropy(n,1,"accelerometer")}t&&o.random.addEntropy(t,2,"accelerometer"),this._addCurrentTimeToEntropy(0)},_fireEvent:function(e,t){var n,r=o.random._callbacks[e],i=[];for(n in r)r.hasOwnProperty(n)&&i.push(r[n]);for(n=0;n<i.length;n++)i[n](t)}},o.random=new o.prng(6),function(){function e(){return null}try{var n,r,i;if("undefined"!=typeof t&&t.exports&&(r=e())&&r.randomBytes)n=r.randomBytes(128),n=new Uint32Array(new Uint8Array(n).buffer),o.random.addEntropy(n,1024,"crypto.randomBytes");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(i=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(i);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)return;window.msCrypto.getRandomValues(i)}o.random.addEntropy(i,1024,"crypto.getRandomValues")}}catch(s){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(s))}}(),o.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},_encrypt:function(e,t,n,r){n=n||{},r=r||{};var i,s,a,c=o.json,u=c._add({iv:o.random.randomWords(4,0)},c.defaults);if(c._add(u,n),a=u.adata,"string"==typeof u.salt&&(u.salt=o.codec.base64.toBits(u.salt)),"string"==typeof u.iv&&(u.iv=o.codec.base64.toBits(u.iv)),!o.mode[u.mode]||!o.cipher[u.cipher]||"string"==typeof e&&u.iter<=100||64!==u.ts&&96!==u.ts&&128!==u.ts||128!==u.ks&&192!==u.ks&&256!==u.ks||u.iv.length<2||u.iv.length>4)throw new o.exception.invalid("json encrypt: invalid parameters");return"string"==typeof e?(i=o.misc.cachedPbkdf2(e,u),e=i.key.slice(0,u.ks/32),u.salt=i.salt):o.ecc&&e instanceof o.ecc.elGamal.publicKey&&(i=e.kem(),u.kemtag=i.tag,e=i.key.slice(0,u.ks/32)),"string"==typeof t&&(t=o.codec.utf8String.toBits(t)),"string"==typeof a&&(u.adata=a=o.codec.utf8String.toBits(a)),s=new o.cipher[u.cipher](e),c._add(r,u),r.key=e,u.ct=o.mode[u.mode].encrypt(s,t,u.iv,a,u.ts),u},encrypt:function(e,t,n,r){var i=o.json,s=i._encrypt.apply(i,arguments);return i.encode(s)},_decrypt:function(e,t,n,r){n=n||{},r=r||{};var i,s,a,c=o.json,u=c._add(c._add(c._add({},c.defaults),t),n,!0),d=u.adata;if("string"==typeof u.salt&&(u.salt=o.codec.base64.toBits(u.salt)),"string"==typeof u.iv&&(u.iv=o.codec.base64.toBits(u.iv)),!o.mode[u.mode]||!o.cipher[u.cipher]||"string"==typeof e&&u.iter<=100||64!==u.ts&&96!==u.ts&&128!==u.ts||128!==u.ks&&192!==u.ks&&256!==u.ks||!u.iv||u.iv.length<2||u.iv.length>4)throw new o.exception.invalid("json decrypt: invalid parameters");return"string"==typeof e?(s=o.misc.cachedPbkdf2(e,u),e=s.key.slice(0,u.ks/32),u.salt=s.salt):o.ecc&&e instanceof o.ecc.elGamal.secretKey&&(e=e.unkem(o.codec.base64.toBits(u.kemtag)).slice(0,u.ks/32)),"string"==typeof d&&(d=o.codec.utf8String.toBits(d)),a=new o.cipher[u.cipher](e),i=o.mode[u.mode].decrypt(a,u.ct,u.iv,d,u.ts),c._add(r,u),r.key=e,1===n.raw?i:o.codec.utf8String.fromBits(i)},decrypt:function(e,t,n,r){var i=o.json;return i._decrypt(e,i.decode(t),n,r)},encode:function(e){var t,n="{",r="";for(t in e)if(e.hasOwnProperty(t)){if(!t.match(/^[a-z0-9]+$/i))throw new o.exception.invalid("json encode: invalid property name");switch(n+=r+'"'+t+'":',r=",",typeof e[t]){case"number":case"boolean":n+=e[t];break;case"string":n+='"'+escape(e[t])+'"';break;case"object":n+='"'+o.codec.base64.fromBits(e[t],0)+'"';break;default:throw new o.exception.bug("json encode: unsupported type")}}return n+"}"},decode:function(e){if(e=e.replace(/\s/g,""),!e.match(/^\{.*\}$/))throw new o.exception.invalid("json decode: this isn't json!");var t,n,r=e.replace(/^\{|\}$/g,"").split(/,/),i={};for(t=0;t<r.length;t++){if(!(n=r[t].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new o.exception.invalid("json decode: this isn't json!");n[3]?i[n[2]]=parseInt(n[3],10):n[4]?i[n[2]]=n[2].match(/^(ct|adata|salt|iv)$/)?o.codec.base64.toBits(n[4]):unescape(n[4]):n[5]&&(i[n[2]]="true"===n[5])}return i},_add:function(e,t,n){if(void 0===e&&(e={}),void 0===t)return e;var r;for(r in t)if(t.hasOwnProperty(r)){if(n&&void 0!==e[r]&&e[r]!==t[r])throw new o.exception.invalid("required parameter overridden");e[r]=t[r]}return e},_subtract:function(e,t){var n,o={};for(n in e)e.hasOwnProperty(n)&&e[n]!==t[n]&&(o[n]=e[n]);return o},_filter:function(e,t){var n,o={};for(n=0;n<t.length;n++)void 0!==e[t[n]]&&(o[t[n]]=e[t[n]]);return o}},o.encrypt=o.json.encrypt,o.decrypt=o.json.decrypt,o.misc._pbkdf2Cache={},o.misc.cachedPbkdf2=function(e,t){var n,r,i,s,a=o.misc._pbkdf2Cache;return t=t||{},s=t.iter||1e3,r=a[e]=a[e]||{},n=r[s]=r[s]||{firstSalt:t.salt&&t.salt.length?t.salt.slice(0):o.random.randomWords(2,0)},i=void 0===t.salt?n.firstSalt:t.salt,n[i]=n[i]||o.misc.pbkdf2(e,i,t.iter),{key:n[i].slice(0),salt:i.slice(0)}}},{}],3:[function(e,t,n){!function(e,n){"use strict";var o="0.7.8",r="",i="?",s="function",a="undefined",c="object",u="string",d="major",l="model",f="name",p="type",g="vendor",h="version",m="architecture",v="console",y="mobile",w="tablet",b="smarttv",k="wearable",E="embedded",_={extend:function(e,t){for(var n in t)-1!=="browser cpu device engine os".indexOf(n)&&t[n].length%2===0&&(e[n]=t[n].concat(e[n]));return e},has:function(e,t){return"string"==typeof e?-1!==t.toLowerCase().indexOf(e.toLowerCase()):!1},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e===u?e.split(".")[0]:n}},I={rgx:function(){for(var e,t,o,r,i,u,d,l=0,f=arguments;l<f.length&&!u;){var p=f[l],g=f[l+1];if(typeof e===a){e={};for(r in g)i=g[r],typeof i===c?e[i[0]]=n:e[i]=n}for(t=o=0;t<p.length&&!u;)if(u=p[t++].exec(this.getUA()))for(r=0;r<g.length;r++)d=u[++o],i=g[r],typeof i===c&&i.length>0?2==i.length?e[i[0]]=typeof i[1]==s?i[1].call(this,d):i[1]:3==i.length?e[i[0]]=typeof i[1]!==s||i[1].exec&&i[1].test?d?d.replace(i[1],i[2]):n:d?i[1].call(this,d,i[2]):n:4==i.length&&(e[i[0]]=d?i[3].call(this,d.replace(i[1],i[2])):n):e[i]=d?d:n;l+=2}return e},str:function(e,t){for(var o in t)if(typeof t[o]===c&&t[o].length>0){for(var r=0;r<t[o].length;r++)if(_.has(t[o][r],e))return o===i?n:o}else if(_.has(t[o],e))return o===i?n:o;return e}},A={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},S={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[f,h],[/\s(opr)\/([\w\.]+)/i],[[f,"Opera"],h],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],[f,h],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[f,"IE"],h],[/(edge)\/((\d+)?[\w\.]+)/i],[f,h],[/(yabrowser)\/([\w\.]+)/i],[[f,"Yandex"],h],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],h],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[f,h],[/(dolfin)\/([\w\.]+)/i],[[f,"Dolphin"],h],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[f,"Chrome"],h],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[h,[f,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[h,[f,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[h,[f,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[h,[f,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[h,f],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[f,[h,I.str,A.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[f,h],[/(navigator|netscape)\/([\w\.-]+)/i],[[f,"Netscape"],h],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[f,h]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,_.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[m,/ower/,"",_.lowerize]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[m,_.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[l,g,[p,w]],[/applecoremedia\/[\w\.]+ \((ipad)/],[l,[g,"Apple"],[p,w]],[/(apple\s{0,1}tv)/i],[[l,"Apple TV"],[g,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[g,l,[p,w]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[l,[g,"Amazon"],[p,w]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[l,I.str,A.device.amazon.model],[g,"Amazon"],[p,y]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[l,g,[p,y]],[/\((ip[honed|\s\w*]+);/i],[l,[g,"Apple"],[p,y]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[g,l,[p,y]],[/\(bb10;\s(\w+)/i],[l,[g,"BlackBerry"],[p,y]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[l,[g,"Asus"],[p,w]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[g,"Sony"],[l,"Xperia Tablet"],[p,w]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[g,"Sony"],[l,"Xperia Phone"],[p,y]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[g,l,[p,v]],[/android.+;\s(shield)\sbuild/i],[l,[g,"Nvidia"],[p,v]],[/(playstation\s[3portablevi]+)/i],[l,[g,"Sony"],[p,v]],[/(sprint\s(\w+))/i],[[g,I.str,A.device.sprint.vendor],[l,I.str,A.device.sprint.model],[p,y]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[g,l,[p,w]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[g,[l,/_/g," "],[p,y]],[/(nexus\s9)/i],[l,[g,"HTC"],[p,w]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[l,[g,"Microsoft"],[p,v]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[g,"Microsoft"],[p,y]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i],[l,[g,"Motorola"],[p,y]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[l,[g,"Motorola"],[p,w]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[g,"Samsung"],l,[p,w]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[g,"Samsung"],l,[p,y]],[/(samsung);smarttv/i],[g,l,[p,b]],[/\(dtv[\);].+(aquos)/i],[l,[g,"Sharp"],[p,b]],[/sie-(\w+)*/i],[l,[g,"Siemens"],[p,y]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[g,"Nokia"],l,[p,y]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[l,[g,"Acer"],[p,w]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[g,"LG"],l,[p,w]],[/(lg) netcast\.tv/i],[g,l,[p,b]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[l,[g,"LG"],[p,y]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[l,[g,"Lenovo"],[p,w]],[/linux;.+((jolla));/i],[g,l,[p,y]],[/((pebble))app\/[\d\.]+\s/i],[g,l,[p,k]],[/android.+;\s(glass)\s\d/i],[l,[g,"Google"],[p,k]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[l,/_/g," "],[g,"Xiaomi"],[p,y]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[p,_.lowerize],g,l]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[h,[f,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[f,h],[/rv\:([\w\.]+).*(gecko)/i],[h,f]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[f,h],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[f,[h,I.str,A.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[f,"Windows"],[h,I.str,A.os.windows.version]],[/\((bb)(10);/i],[[f,"BlackBerry"],h],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[f,h],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[f,"Symbian"],h],[/\((series40);/i],[f],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[f,"Firefox OS"],h],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[f,h],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[f,"Chromium OS"],h],[/(sunos)\s?([\w\.]+\d)*/i],[[f,"Solaris"],h],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[f,h],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[f,"iOS"],[h,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[f,"Mac OS"],[h,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[f,h]]},x=function(t,n){if(!(this instanceof x))return new x(t,n).getResult();var o=t||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:r),i=n?_.extend(S,n):S;return this.getBrowser=function(){var e=I.rgx.apply(this,i.browser);return e.major=_.major(e.version),e},this.getCPU=function(){return I.rgx.apply(this,i.cpu)},this.getDevice=function(){return I.rgx.apply(this,i.device)},this.getEngine=function(){return I.rgx.apply(this,i.engine)},this.getOS=function(){return I.rgx.apply(this,i.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return o},this.setUA=function(e){return o=e,this},this.setUA(o),this};x.VERSION=o,x.BROWSER={NAME:f,MAJOR:d,VERSION:h},x.CPU={ARCHITECTURE:m},x.DEVICE={MODEL:l,VENDOR:g,TYPE:p,CONSOLE:v,MOBILE:y,SMARTTV:b,TABLET:w,WEARABLE:k,EMBEDDED:E},x.ENGINE={NAME:f,VERSION:h},x.OS={NAME:f,VERSION:h},t.exports=x}(this)},{}],4:[function(e,t,n){function o(){d&&a&&(d=!1,a.length?u=a.concat(u):l=-1,u.length&&r())}function r(){if(!d){var e=setTimeout(o);d=!0;for(var t=u.length;t;){for(a=u,u=[];++l<t;)a&&a[l].run();l=-1,t=u.length}a=null,d=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function s(){}var a,c=t.exports={},u=[],d=!1,l=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new i(e,t)),1!==u.length||d||setTimeout(r,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=s,c.addListener=s,c.once=s,c.off=s,c.removeListener=s,c.removeAllListeners=s,c.emit=s,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],5:[function(e,t,n){"use strict";function o(e){w.publish("lightbox.requestShowErrorOnFatal");var t=v.defer(),n=A.runWorkflow("login","analytics-pageview",{loggingInfo:e.loggingInfo,optionalConfigs:e.optionalConfigs,allowSkip:!!e.allowSkip});return n.then(function(){t.resolve()}),t.promise}function r(){var e=v.defer();return b.isLoggedIn().then(function(t){var n=_.read("SWID");t?b.token.readAll().then(function(e){return b.invalidateTokens(e)})["finally"](function(){b.deleteAll("api")["finally"](function(){e.resolve({logging:{anon:!1,swid:n}})})}):e.reject({success:!0,anon:!1,error_codes:I.SESSION_NOT_ESTABLISHED,swid:n})}),e.promise}function i(e,t){w.publish("lightbox.requestShowErrorOnFatal");var n=v.defer(),o={optionalConfigs:t.optionalConfigs,loggingInfo:t.loggingInfo,allowSkip:!!t.allowSkip};return y.get(o,"optionalConfigs.providedProfile.region")&&(o.optionalConfigs.providedProfile.region=o.optionalConfigs.providedProfile.region.toUpperCase()),A.runWorkflow("register",void 0,y.assign(o,{skipSocial:!0})).then(function(){n.resolve()}),n.promise}function s(e,t){w.publish("lightbox.requestShowErrorOnFatal");var n=v.defer();return t={optionalConfigs:t.optionalConfigs,loggingInfo:t.loggingInfo,allowSkip:!!t.allowSkip},y.get(t,"optionalConfigs.providedProfile.region")&&(t.optionalConfigs.providedProfile.region=t.optionalConfigs.providedProfile.region.toUpperCase()),A.runWorkflow("register",void 0,t).then(function(){n.resolve()}),n.promise}function a(e){w.publish("lightbox.requestShowErrorOnFatal");var t=v.defer();return A.runWorkflow("updateProfile",void 0,{loggingInfo:e.loggingInfo,allowSkip:!!e.allowSkip}).then(function(){t.resolve()}),t.promise}function c(e){w.publish("lightbox.requestShowErrorOnFatal");var t=v.defer();return A.runWorkflow("recoverPassword",null,{loggingInfo:e.loggingInfo,fromAPI:!0,allowSkip:!!e.allowSkip}).then(function(){t.resolve()}),t.promise}function u(e){w.publish("lightbox.requestShowErrorOnFatal");var t=v.defer();return A.runWorkflow("recoverUsername",null,{loggingInfo:e.loggingInfo,fromAPI:!0,allowSkip:!!e.allowSkip}).then(function(){t.resolve()}),t.promise}function d(e){w.publish("lightbox.requestShowErrorOnFatal");var t=v.defer(),n={loggingInfo:e.loggingInfo,isStandalone:!0,allowSkip:!!e.allowSkip};return A.runWorkflow("reauth",null,n,!0).then(function(e){e.reauthSuccess?t.resolve({data:y.clone(e.guest)}):t.reject({success:!0,error_codes:I.UNKNOWN_ERROR})}),t.promise}function l(e){w.publish("lightbox.requestShowErrorOnFatal");var t=v.defer();return k.getSite().then(function(n){if((n.displayName||{}).enabled){var o=A.runWorkflow("updateDisplayName","prompt-reauth-if-low-trust",{loggingInfo:e.loggingInfo,allowSkip:!!e.allowSkip});o.then(function(){t.resolve()})}else t.reject({success:!0,error_codes:I.NOT_ENABLED})}),t.promise}function f(e,t){w.publish("lightbox.requestShowErrorOnFatal");var n=v.defer();return t?A.runWorkflow("newsletters",null,{promotionId:t,sourceName:e&&e.sourceName||null,loggingInfo:e.loggingInfo,pageName:"create-nrt",allowSkip:!!e.allowSkip}).then(function(){n.resolve()}):n.reject({success:!0,error_codes:I.INVALID_ARGUMENT}),n.promise}function p(e,t){w.publish("lightbox.requestShowErrorOnFatal");var n=v.defer(),o=A.runWorkflow("requestActivity",void 0,{activityCode:t,loggingInfo:e.loggingInfo,allowSkip:!!e.allowSkip});return o.then(function(){n.resolve()}),n.promise}function g(e){function t(){a.status="success"}function n(e){a.status="failure",a.failureCode=y.get(e,"failureCode")}function o(){"success"===a.status?r.resolve():r.reject("failure"===a.status?{error_codes:a.failureCode||"UNKNOWN_ERROR"}:{error_codes:"CANCEL_BY_USER"})}w.publish("lightbox.requestShowErrorOnFatal");var r=v.defer(),i=e.pairingCode,s=[],a={status:"pending"};return i?(w.publish("session-timer.pause"),s.push(w.subscribe("lightbox.hide",o)),s.push(w.subscribe("license-plate.link-success",t)),s.push(w.subscribe("license-plate.link-failure",n)),A.runWorkflow("licensePlate",null,{activationCode:i,authenticationFlow:e.authenticationFlow,loggingInfo:e.loggingInfo,showSuccessScreen:!!e.showSuccessScreen,deviceName:e.deviceName,allowSkip:!!e.allowSkip},!1)):r.reject({error_codes:"MISSING_PAIRING_CODE"}),r.promise["finally"](function(){w.publish("session-timer.unpause"),s.forEach(function(e){e()})}),r.promise}function h(e){var t=v.defer();return e.pairingCode?E.peek(e).then(function(e){t.resolve({data:e})},function(e){t.reject({error_codes:e})}):t.reject({error_codes:"MISSING_PAIRING_CODE"}),t.promise}function h(e){var t=v.defer();return e.pairingCode?E.peek(e).then(function(e){t.resolve({data:e})},function(e){t.reject({error_codes:e})}):t.reject({error_codes:"MISSING_PAIRING_CODE"}),t.promise}function m(e,t){var n=v.defer();w.publish("lightbox.requestShowErrorOnFatal");var o={optionalConfigs:t.optionalConfigs,loggingInfo:t.loggingInfo,allowSkip:!!t.allowSkip};return A.runWorkflow("adultVerification","analytics-flow-start",o,!0).then(function(e){var t={};t.guest=y.get(e,"guest"),t.isAdultVerified=y.get(e,"isAdultVerified")||!1,t.maxAttemptsExceeded=y.get(e,"maxAttemptsExceeded")||!1,t.quizRequired=y.get(e,"quizRequired")||!1,n.resolve({data:t})}),n.promise}t.exports={launchLicensePlate:g,getLicensePlateDataBag:h,launchLogin:o,logout:r,launchRegistration:i,launchSocialRegistration:s,launchProfile:a,launchResetPassword:c,launchRecoverUsername:u,launchReauth:d,launchDisplayName:l,launchNewsletters:f,launchRequestActivity:p,launchAdultVerification:m};var v=e("q"),y=e("utils"),w=e("messages"),b=e("session"),k=e("../components/outer/config"),E=e("../components/outer/license-plate"),_=(e("logger"),e("cookie")),I=e("./errors"),A=e("../outer/api-helper")},{"../components/outer/config":70,"../components/outer/license-plate":73,"../outer/api-helper":99,"./errors":6,cookie:9,logger:15,messages:16,q:1,session:"session",utils:36}],6:[function(e,t,n){"use strict";t.exports={NO_CONFIG_OPTIONS:"No configuration options provided",CONFIG_SET:"Configuration options have already been set",NO_CLIENT_ID:"clientId not provided",NO_RESPONDER_PAGE:"responderPage not provided",SESSION_ESTABLISHED:"Session already established",SESSION_NOT_ESTABLISHED:"Session not established",NOT_INITIALIZED:"Not initialized",ALREADY_INITIALIZED:"Already initialized",UNSUPPORTED_LOCALE:"Unsupported locale",NOT_IMPLEMENTED:"Not implemented",INVALID_ARGUMENT:"Invalid argument",FAILURE_BY_DESIGN:"FAILURE_BY_DESIGN",NOT_ENABLED:"Not enabled",NO_CALLBACK:"No Network Connect Callback URI passed",CALLBACK_MISMATCH:"Network Connect Callback URI does not match origin",INVALID_COOKIE_DOMAIN:"Provided cookieDomain is invalid",UNKNOWN_ERROR:"An unknown error occurred",PROFILE_UPDATE_INVALID:"PROFILE_UPDATE_INVALID"}},{}],7:[function(e,t,n){"use strict";function o(e){var t=0;for(var n in e){if(!/^[a-zA-Z0-9_]{1,30}$/.test(n))return!1;if(e[n].length>30)return!1;if(++t>10)return!1}return!0}function r(e,t){var n=(s.get(e,"optionalConfigs.sourceName"),s.get(t,"optionalConfigs.sourceName")),r={initial:s.get(e,"optionalConfigs.reporting")||{},override:s.get(t,"optionalConfigs.reporting")||{}};return!r.override.source&&n&&(r.override.source=n),r.combined=s.assign({},r.initial,r.override),o(r.combined)?r.combined:r.initial}function i(e,t){return{reporting:r(e,t),correlationId:t.correlationId}}var s=e("utils");t.exports={validate:o,getCombinedReporting:r,getLoggingInfo:i}},{utils:36}],8:[function(e,t,n){!function(){"use strict";t.exports="16317bffa31"}()},{}],9:[function(e,t,n){!function(){"use strict";function n(e){return i.getCookie(e)}function o(e,t,n,o,u,d){var l=!1;return c.test(n)&&(n=n.replace(c,""),l=!0),i.setCookie(e,t,n,o,u,d),l&&r(e,"www"+(/^\./.test(n)?n:"."+n),o||""),n||s.publish("log.send",{action_name:"log:cookie:write:nodomain",success:"false",process_time:0,info:{topHost:a},timestamp:new Date,error_codes:"UNKNOWN_ERROR",error_category:"UNKNOWN_ERROR",appid:"DTSS-DISNEYID-UI"}),!0}function r(e,t,n){return i.deleteCookie(e,t,n),t&&!c.test(t)&&i.deleteCookie(e,"www"+(/^\./.test(t)?"":".")+t,n),!0}var i=e("utils"),s=e("messages"),a=i.getQueryStringParams(document.location.href).topHost||document.location.host,c=/^\.?www/;t.exports={read:n,write:o,remove:r}}()},{messages:16,utils:36}],10:[function(e,t,n){!function(){"use strict";function n(){r.subscribe("debug.geoIP",function(e){i.ip=e}),r.subscribe("debug.country",function(e){i.country=e}),r.subscribe("debug.testProfileFlag",function(e){i.testProfileFlag=e}),r.subscribe("debug.clear",function(){i={}}),r.subscribe("debug.epcEnabled",function(e){i.epcEnabled=e})}var o=e("utils"),r=e("messages"),i={};t.exports={getGeoIP:function(){return o.get(i,"ip")},getCountry:function(){return o.get(i,"country")},getTestProfileFlag:function(){return o.get(i,"testProfileFlag")},getMarketingMode:function(){return o.getQueryStringParams(document.location.href).marketingMode},getEpcEnabled:function(){return o.get(i,"epcEnabled")},init:n},n()}()},{messages:16,utils:36}],11:[function(e,t,n){!function(){"use strict";function n(e){return a[s(e)]||"QA"}function o(e){return c[e]}function r(e){return!!e.match(/-(DEV|VALID|QA|STAGE|PROD)$/)}function i(e){var t=null;return(e||"").replace(/-(DEV|VALID|QA|STAGE|PROD)$/,function(e,n){t=n}),t}function s(e){var t=document.createElement("a");return t.setAttribute("href",e),""+t.hostname}t.exports={getEnvironmentFromUrl:n,getClientIdEnvironment:o,getClientIdSuffix:i,clientIdHasSuffix:r};var a=(e("utils"),{"127.0.0.1":"QA",localhost:"QA","did.registerdisney.go.com":"LOCAL","local.registerdisney.go.com":"LOCAL","ui-local.registerdisney.go.com":"LOCAL","dev.registerdisney.go.com":"DEV","qa.registerdisney.go.com":"QA","ui-qa.registerdisney.go.com":"QA","ui-stg.dark.registerdisney.go.com":"STAGE-DARK","stg.dark.registerdisney.go.com":"STAGE-DARK","stg.registerdisney.go.com":"STAGE","stg.cdn.registerdisney.go.com":"STAGE","val.registerdisney.go.com":"VALID","ui-val.registerdisney.go.com":"VALID","dark.registerdisney.go.com":"PROD-DARK","registerdisney.go.com":"PROD","cdn.registerdisney.go.com":"PROD"}),c={LOCAL:"QA",DEV:"DEV",VALID:"VALID",QA:"QA","STAGE-DARK":"STAGE",STAGE:"STAGE","PROD-DARK":"PROD",PROD:"PROD"}}()},{utils:36}],12:[function(e,t,n){!function(){"use strict";function e(e,t,n){"undefined"==typeof e[t]&&(e[t]=[]),e[t].push(n)}function n(e,t,n){if("undefined"!=typeof e[t]){var o=e[t].length;if("undefined"==typeof n)e[t]=[];else for(;o;)e[t][o-1]==n&&e[t].splice(o-1,1),o--}}function o(e,t){if(e=[].concat(e[t]||[]).concat(e["*"]||[]),e.length>0){var n=arguments.length>2?Array.prototype.slice.call(arguments,2):[];e.forEach(function(e){try{e.apply({eventName:t},n)}catch(t){setTimeout(function(){throw t},0)}})}}function r(t){var r=t.prototype||t,i={};return r.on=function(t,n){e.call(this,i,t,n)},r.off=function(e,t){n.call(this,i,e,t)},r.emit=function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(i),o.apply(this,e)},r.clear=function(){i={}},t}t.exports={emittable:r}}()},{}],13:[function(e,t,n){!function(){"use strict";t.exports=e("./event-emitter")}()},{"./event-emitter":12}],14:[function(e,t,n){!function(){"use strict";function n(e){var t=a.get(e,"error.errors"),n=a.get(e,"error.keyCategory"),o=!t||!n||!a.get(t,"length");return o?[]:t.filter(function(e){return e.category===n})}function o(e,t){return r(e,t)[0]}function r(e,t,n){return Array.isArray(e)?(Array.isArray(t)||(t=[t]),n&&!Array.isArray(n)&&(n=[n]),(e||[]).filter(function(e){return-1!==t.indexOf(e.code)&&(!n||-1!==n.indexOf(e.inputName))})):[]}function i(e){return Array.isArray(e)?e.map(function(e){return e.code+(e.inputName?":"+e.inputName:"")}):null}function s(e,t){return r(e,t).length>0}var a=e("utils");t.exports={getKeyErrors:n,find:o,findAll:r,getErrorCodes:i,containsErrorCode:s}}()},{utils:36}],15:[function(e,t,n){!function(){"use strict";var n={ERROR:5,WARN:4,INFO:3,DEBUG:2,LOG:1,OFF:0},o={ERROR:"color:#FC0C1B;background-color:#FFEFEF",WARN:"color:#5B3A06;background-color:#FFFBE6",INFO:"color:#363F47;background-color:#e1e9ff",DEBUG:"color:#444;background-color:#eee",LOG:"color:#000;background-color:transparent",DEFAULT:"color:#000;background-color:transparent;font-weight:",ONEID:"color:#2887b4;background-color:transparent;font-weight:bold"},r=(e("utils"),n.INFO),i=function(){},s=function(){function e(e){"undefined"==typeof n[e.toUpperCase()]?this.error("Invalid log level specified: ",e):Object.keys(n).forEach(function(t){e.toUpperCase()===t&&(r=n[t],s())})}function t(){var e;return Object.keys(n).forEach(function(t){r===n[t]&&(e=t)}),e}function s(){var e=c?"%c[OneID]%c %c[%s]%c: ":"[OneID] [%s]: ";for(var t in n)a[t.toLowerCase()]=c?r<=n[t]&&r!==n.OFF?window.console[t.toLowerCase()].bind(window.console,e,o["ONEID"],o["DEFAULT"],o[t],t,o["DEFAULT"]):i:r<=n[t]&&r!==n.OFF?window.console[t.toLowerCase()].bind(window.console,e,t):i}var a=this,c=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("firefox")>-1||e.indexOf("chrome")>-1}();this.setLogLevel=e,this.getLogLevel=t,this.LEVELS=n,s()};t.exports=new s}()},{utils:36}],16:[function(e,t,n){!function(){"use strict";function n(e){var t=Array.prototype.slice.call(arguments,1);"undefined"!=typeof s[e]&&i.clone(s[e]).forEach(function(e){e.callback.apply(null,t);

})}function o(e,t){if(!(t instanceof Function))throw new Error("callback must be a function");return s[e]||(s[e]=[]),s[e].push({callback:t,identifier:a}),function(e,t){return function(){if(Array.isArray(s[e]))for(var n=0;n<s[e].length;n++)if(s[e][n].identifier===t)return void s[e].splice(n,1)}}(e,a++)}function r(e,t){return e?void("undefined"!=typeof s[e]&&s[e].forEach(function(n,o){n.callback!==t&&t||s[e].splice(o,1)})):s={}}var i=e("../utils"),s=(e("logger"),{}),a=0;t.exports={publish:n,subscribe:o,unsubscribe:r}}()},{"../utils":36,logger:15}],17:[function(e,t,n){!function(){"use strict";function n(e,t){function a(e){function t(){function t(){f(),p=setTimeout(t,n.SATURATE_INTERVAL)}i.debug("aquiring mutex"),t(),g=!0,"function"==typeof e&&(i.debug("calling aquire success callback"),e())}i.log("Mutex#aquire"),setTimeout(function(){return c()?(i.debug("mutex is locked"),void l(function(){t(e)})):void t(e)},o(n.RANDOM_BASE,n.RANDOM_VARIANCE))}function c(){return null!==s.read(h)}function u(){return g===!0}function d(){i.log("Mutex#release"),u()&&(i.debug("releasing mutex"),clearTimeout(p),p=null,r.getCookieDomains().forEach(function(e){s.remove(h,e,m)}),s.remove(h,t,m),g=!1)}function l(e){function t(){return i.debug("wait timeout called"),c()?void setTimeout(t,n.WAIT_INTERVAL+r):(i.debug("mutex has been released"),e())}if("function"==typeof e){i.debug("wait called");var r=o(n.RANDOM_BASE,n.RANDOM_VARIANCE);i.debug("random variance is "+r),i.debug("wait timeout is "+n.WAIT_INTERVAL+r),t()}}function f(){i.debug("saturating mutex");var e=new Date((new Date).getTime()+n.EXPIRE_INTERVAL);s.write(h,"0",t,m,e)}this.aquire=a,this.release=d,this.wait=l,this.isLocked=c,this.isLockedByUs=u;var p,g,h="mtx"+r.crc32(e).toString(16),m="/";t=t||window.location.hostname}function o(e,t){return Math.floor(Math.random()*t+e)}t.exports=n;var r=e("utils"),i=e("logger"),s=e("cookie");n.SATURATE_INTERVAL=5e3,n.EXPIRE_INTERVAL=2e4,n.WAIT_INTERVAL=5e3,n.RANDOM_BASE=1e3,n.RANDOM_VARIANCE=1e3}()},{cookie:9,logger:15,utils:36}],18:[function(e,t,n){!function(){"use strict";var e=function(){};window.console=window.console||{},window.console.log=window.console.log||e,window.console.error=window.console.error||e,window.console.warn=window.console.warn||e,window.console.debug=window.console.debug||e,Object.defineProperty(Array.prototype,"reduceNative",{enumerable:!1,writable:!0,value:function(e){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var t,n=Object(this),o=n.length>>>0,r=0;if(2==arguments.length)t=arguments[1];else{for(;o>r&&!r in n;)r++;if(r>=o)throw new TypeError("Reduce of empty array with no initial value");t=n[r++]}for(;o>r;r++)r in n&&(t=e(t,n[r],r,n));return t}})}()},{}],19:[function(e,t,n){!function(){t.exports={CLIENT:"lightbox-client-window",LIGHTBOX:"lightbox-main-iframe",RESPONDER:"lightbox-responder",MIGRATION_RESPONDER:"lightbox-migration-responder",MOCK:"lightbox-mock-api"}}()},{}],20:[function(e,t,n){!function(){"use strict";t.exports=e("./postmessage-transport")}()},{"./postmessage-transport":21}],21:[function(e,t,n){!function(){"use strict";function n(e){this.name=e,this.emitter=b.emittable(Object.create(null)),this.initialized=!1,this.deferreds={},this.targets={},this.pendingTargets={},this.parents=[]}function o(){if(this.initialized)throw"Cannot attach new listeners once init() has been invoked";this.emitter.on.apply(this,arguments)}function r(){this.emitter.emit.apply(this,arguments)}function i(){y.log("PostMessageTransport#init"),this.initialized||(window.addEventListener("message",d.bind(this),!1),s.call(this),delete this.parents,this.initialized=!0)}function s(){y.log("PostMessageTransport#resolveParents");var e=this;e.parents.forEach(function(t){var n=Date.now(),o=e.targets[t];!function r(){clearTimeout(o.timeout),o.window.postMessage(JSON.stringify({type:"handshake",name:e.name}),o.origin),o.isReady===!1&&(Date.now()-n>E?(m(),e.emit("error","Parent window has not responded within 60 seconds")):o.timeout=setTimeout(r,50))}()})}function a(e,t){y.log("PostMessageTransport#registerChild: "+e);var n=v.defer();if(this.initialized)throw"Cannot attach child windows after init has been invoked";"undefined"==typeof this.targets[e]&&(this.targets[e]={origin:t,ready:n.promise},this.pendingTargets[e]=n)}function c(e,t,n){y.log("PostMessageTransport#registerParent: "+e);var o=v.defer();if(this.initialized)throw"Cannot attach parent windows after init has been invoked";if("undefined"==typeof this.targets[e]){var r={window:window.parent,origin:t,isReady:!1,ready:o.promise,timeout:null,opts:n};this.targets[e]=r,this.pendingTargets[e]=o,this.parents.push(e)}}function u(e,t,n,o){var r=this.targets[e];if("undefined"==typeof r)throw"Cannot postMessage to undefined window ["+e+"]";if(w.get(r,"opts.enforceMatchingApexDomain")){var i=w.getLocation(r.origin).hostname,s=window.location.hostname;if(w.getTLD(i)!==w.getTLD(s)&&!_.isWhitelisted(w.getTLD(i)))return}var a={type:"message",name:this.name,eventName:t,data:n};if("undefined"!=typeof o){var c=w.uuid();this.deferreds[c]=o,a.deferredUuid=c}r.ready.then(function(){r.window.postMessage(JSON.stringify(a),r.origin)})}function d(e){var t;try{t=JSON.parse(e.data)}catch(n){return}I.hasOwnProperty(t.type)&&I[t.type].call(this,e,t)}function l(e,t){y.log("PostMessageTransport#handleHandshakeAck");var n=this,o=n.targets[t.name];"undefined"!=typeof o&&(clearTimeout(o.timeout),o.window=e.source,o.isReady=!0,n.pendingTargets[t.name].resolve())}function f(e,t){y.log("PostMessageTransport#handleHandshake");var n=this,o=n.targets[t.name];"undefined"!=typeof o&&(o.window=e.source,n.pendingTargets[t.name].resolve(),o.window.postMessage(JSON.stringify({type:"handshakeAck",name:n.name}),o.origin))}function p(e,t){"undefined"!=typeof this.deferreds[t.deferredUuid]&&(this.deferreds[t.deferredUuid][t.action].call(null,t.data),delete this.deferreds[t.deferredUuid])}function g(e,t){var n=this;if("undefined"!=typeof t.name&&"undefined"!=typeof n.targets[t.name]){var o=n.targets[t.name];if(w.get(o,"opts.enforceMatchingApexDomain")){var r=w.getLocation(e.origin).hostname,i=window.location.hostname;if(w.getTLD(r)!==w.getTLD(i)&&!_.isWhitelisted(w.getTLD(r)))return}if("string"==typeof t.deferredUuid){var s=v.defer();s.promise.then(function(e){h(o.window,o.origin,t.deferredUuid,"resolve",e)},function(e){h(o.window,o.origin,t.deferredUuid,"reject",e)}),n.emit(t.eventName,t.data,s)}else n.emit(t.eventName,t.data)}}function h(e,t,n,o,r){var i={data:r,type:"deferred",deferredUuid:n,action:o};e.postMessage(JSON.stringify(i),t)}function m(){k.error("log:pmt-timeout",{conversation_id:w.uuid(),anon:!0,swid:"",error_codes:"UNKNOWN_ERROR",error_category:"UNKNOWN_ERROR"})}var v=e("../../../../assets/common/js/q"),y=e("logger"),w=e("../utils"),b=e("../event-emitter"),k=e("metrics"),E=6e4,_=e("./whitelist");t.exports=n;var I={handshake:f,handshakeAck:l,deferred:p,message:g};n.prototype.init=i,n.prototype.registerChild=a,n.prototype.registerParent=c,n.prototype.send=u,n.prototype.on=o,n.prototype.emit=r}()},{"../../../../assets/common/js/q":1,"../event-emitter":13,"../utils":36,"./whitelist":23,logger:15,metrics:63}],22:[function(e,t,n){"use strict";t.exports=["disney.com","go.com","abcnews.com","11abcnews.com","uol.com.br","disneybabble.com","disney.com.br","espn.com","espnfc.co.uk","espnfc.com","espnfc.com.ng","espnfcasia.com","espnfc.com.ar","espnfc.com.au","espnfc.in","espnfc.mx","espnfc.us","espnsoccernet.com","fivethirtyeight.com","dig.com","*.private","6abc.com","abc11.com","abc13.com","abc30.com","abc7.com","abc7chicago.com","abc7news.com","abc7ny.com","*.network","*.local","disneyplanet.net","adyax-dev.com","diznee.net","disney.com.br","disney.fr","disneyturkiye.com.tr","disney.be","disney.co.uk","disney.de","disney.it","disney.nl","disney.pl","disney.es","disneystore.com","wdpromedia.com","disneyvacations.com","espnqa.com","cricinfo.org","espn.in","espn.cl","espn.co.uk","espn.com.ar","espn.com.au","espn.com.co","espn.com.mx","espn.com.ve","espncricinfo.com","espndeportes.com","cricinfo.com","disneylandparis.fr","ilm.com","shanghaidisneyresort.com"]},{}],23:[function(e,t,n){"use strict";function o(e){return r.stringPatternMatch(e,i)}var r=e("utils"),i=e("./data");t.exports={isWhitelisted:o}},{"./data":22,utils:36}],24:[function(e,t,n){t.exports={fields:["email","firstName","gender","lastName","middleName","prefix","suffix","username","languagePreference","pronunciationName","address.billing","address.home","address.other","address.school","address.shipping","address.work","phone.day","phone.fax","phone.mobile","phone.night","displayName","proposedDisplayName","dateOfBirth","password"],disallowedFields:["email","username","address.other","phone.fax","dateOfBirth","password","displayName","region"],allowedAddressValues:["line1","line2","line3","city","stateProvince","postalCode","country","preferred"],allowedPhoneValues:["number","internationalPrefix","countryCode","extension","preferred"]}},{}],25:[function(e,t,n){!function(){"use strict";function n(e,t){var n,s=o.fields.filter(function(e){return o.disallowedFields.indexOf(e)<0}),a={data:{},required:{}},c="compliance.ageBands."+e.profile.ageBand+".UPDATE",u=i.get(t,c),d=r.dictionaryFromKey(e.profile.addresses,"type"),l=r.dictionaryFromKey(e.profile.phones,"type"),f=r.createDataTemplate(i.get(t,c+".addresses")),p=r.createDataTemplate(i.get(t,c+".phones")),g=i.get(t,"displayName"),h=i.get(g,"enabled");return s.forEach(function(t){n=(t.split(".")[1]||"").toUpperCase(),t.indexOf("address")>-1&&u.addresses?a=r.flatten({existingProfile:d,template:f,config:u.addresses.type,allowedValues:o.allowedAddressValues,fieldValue:t,editableProfile:a,type:n}):t.indexOf("phone")>-1&&u.phones?a=r.flatten({existingProfile:l,template:p,config:u.phones.type,allowedValues:o.allowedPhoneValues,fieldValue:t,editableProfile:a,type:n}):t.toLowerCase().indexOf("displayname")>-1&&h?a.data[t]=i.get(e,"displayName."+t):u[t]&&(a.data[t]=i.get(e,"profile."+t),a.required[t]=i.get(u,t).required||!1)}),a}var o=e("./fields.json"),r=e("./ppc-utils.js"),i=e("utils");t.exports={getEditableAndRequiredFields:n}}()},{"./fields.json":24,"./ppc-utils.js":26,utils:36}],26:[function(e,t,n){!function(){"use strict";function e(e,t){return e=e||[],e.reduceNative(function(e,n){return"undefined"==typeof e[n[t]]&&(e[n[t]]=n),e},{})}function n(e){if(e=e||{},e&&"EDITABLE"===e.editable){var t=e.type||{};return Object.keys(t).reduceNative(function(e,n){var o=t[n]||{};return e[n]=Object.keys(o).reduceNative(function(e,t){return"EDITABLE"===o[t].editable&&"type"!==t&&(e[t]=null),e},{}),e},{})}return null}function o(e){var t=e.existingProfile[e.type]||e.template[e.type]||e.template.DEFAULT||null,n=e.config[e.type]||e.config.DEFAULT||null;return t&&n&&Object.keys(t).forEach(function(o){if(e.allowedValues.indexOf(o)>-1){var r=e.fieldValue.split(".");r.push(o);var i=r.join(".");e.editableProfile.data[i]=t[o]||null,e.editableProfile.required[i]=(n[o]||{}).required||!1}}),e.editableProfile}t.exports={dictionaryFromKey:e,createDataTemplate:n,flatten:o}}()},{}],27:[function(e,t,n){!function(){"use strict";function e(e){return r[e]=(r[e]||0)+1,r[e]}function n(e){"undefined"==typeof e?r={}:r[e]=0}function o(e){return r[e]||0}var r={};t.exports={reset:n,increment:e,getCount:o}}()},{}],28:[function(e,t,n){var o=e("q"),r=e("utils"),i=e("config");t.exports=function(){var e=this,t=i.getGlobal(),n=r.get(t,"clientId"),s=r.get(t,"ui.environment");return o.fcall(function(){var t={};return t.clientIds=r.isEspnClientId(n)?r.getEspnWhitelist().map(function(e){return e+"-"+s}):[n],e.read().timeout(2e3)}).then(function(e){if(r.get(e,"token")){var t={};return t[n]=e.token,t}return(e||{}).tokens})}},{config:44,q:1,utils:36}],29:[function(e,t,n){!function(){"use strict";function e(e,t){this.start=e,this.end=t}t.exports=e;var n=1e3;e.prototype.getPercentElapsed=function(e){var t;return e instanceof Date?(t=this.end.getTime()-this.start.getTime(),(e.getTime()-this.start.getTime())/t):null},e.prototype.getSecondsRemaining=function(e){return e instanceof Date?(this.end.getTime()-e.getTime())/n:null},e.prototype.getDateAtPercent=function(e){var t=this.end.getTime()-this.start.getTime();return new Date(this.start.getTime()+e*t)},e.prototype.getDateNearestToMultipleOfSeconds=function(e){if(0>=e)return null;var t=(this.end.getTime()-this.start.getTime())/n,o=Math.ceil(t/e)*e;return new Date(this.start.getTime()+o*n)}}()},{}],30:[function(e,t,n){!function(){"use strict";t.exports={TRUST_EXPIRY:18e5,STATES:{low:0,high:1},IGNORED_REAUTH_AUTHENTICATORS:["facebook_token","google_token","google_token_v3","amazon_token","gamenetwork"]}}()},{}],31:[function(e,t,n){"use strict";function o(){return Function("/*@cc_on return 10===document.documentMode@*/")()}function r(){var e=navigator.userAgent.toLowerCase(),t=-1!==e.indexOf("android"),n=-1!==e.indexOf("chrome"),o=-1!==e.indexOf("windows phone");return t&&!n&&!o}function i(){return/(ipad|iphone|ipod)/gi.test(navigator.userAgent)}t.exports={isIE10:o,isAndroidBrowser:r,isIOS:i};!function(){try{for(var e,t=3,n=document.createElement("div"),o=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",o[0];);return t>4?t:e}catch(r){return 0}}()},{}],32:[function(e,t,n){"use strict";function o(e){for(var t=-1,n=0;n<e.length;n++)t=t>>>8^r[255&(t^e.charCodeAt(n))];return(-1^t)>>>0}t.exports=o;var r=function(){for(var e=new Array(256),t=0;t<e.length;t++){for(var n=t,o=0;8>o;o++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n>>>0}return e}()},{}],33:[function(e,t,n){"use strict";function o(e,t){var n,o=!1;return function(){return o===!1&&(o=!0,n=e.apply(t,arguments)),n}}function r(e,t,n){n="number"!=typeof n?1/0:n;var o=Object.create(null);return function(){var r=[].join.call(arguments,"-");return("undefined"==typeof o[r]||o[r].created+n<Date.now())&&(o[r]={created:Date.now(),value:e.apply(t,arguments)}),o[r].value}}function i(e,t,n){var o,r;return function(){var i=Date.now();return("undefined"==typeof o||i>=o)&&(o=i+n,r=e.apply(t,arguments),setTimeout(function(){o=void 0,r=void 0},n||0)),r}}function s(e,t,n){var o,r;return function(){r=arguments,o||(o=setTimeout(function(){o=null,e.apply(t,r),r=void 0},n))}}t.exports={once:o,memoize:r,debounceLeadingEdge:i,debounce:s}},{}],34:[function(e,t,n){"use strict";function o(){if(!a){a=!0;for(var e=0;e<s.length;e++)s[e].fn.call(window,s[e].ctx);s=[]}}function r(){"complete"===document.readyState&&o()}function i(e,t){return a?void setTimeout(function(){e(t)},1):(s.push({fn:e,ctx:t}),void("complete"===document.readyState||!document.attachEvent&&"interactive"===document.readyState?setTimeout(o,1):c||(document.addEventListener?(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1)):(document.attachEvent("onreadystatechange",r),window.attachEvent("onload",o)),c=!0)))}t.exports=i;var s=[],a=!1,c=!1},{}],35:[function(e,t,n){function o(){return["DTSS-DEV.ESPN.WEB","ESPN-AR.WEB","ESPN-CL.WEB","ESPN-CO.WEB","ESPN-COACHES","ESPN-CRICINFO.WEB","ESPN-CRICKETMONTHLY.WEB","ESPN-DEPORTES","ESPN-ESPNAPP.WIN","ESPN-ESPNARCADE","ESPN-ESPNCOM","ESPN-ESPNCONTESTS","ESPN-ESPNRADIO","ESPN-ESPNVIDEO","ESPN-ESPNW","ESPN-FANTASYEPRIZE","ESPN-FANTASYLM","ESPN-FC","ESPN-INSIDER","ESPN-MX.WEB","ESPN-ONESITE.WEB","ESPN-PASS.WEB","ESPN-UK","ESPN-VE.WEB","ESPN-XGAMES.WEB","ESPNCOM-ESPN.REGISTRATION","ESPN-TEST-A.WEB","ESPN-TEST-B.WEB","ESPN-TEST-C.WEB","ESPN-ATG-DEV.WEB"]}function r(){return["ESPN-ESPNAPP.IOS","ESPN-FANTASY.IOS","ESPN-ESPNAPP.AND","ESPN-FANTASY.AND","ESPN-FANT.STREAK.AND","ESPN-FANT.STREAK.IOS"]}function i(e){var t=(e||"").replace(/(-DEV|-QA|-STAGE|-VALID|-PROD)$/,"");return-1!==o().indexOf(t)}function s(e){var t=(e||"").replace(/(-DEV|-QA|-STAGE|-VALID|-PROD)$/,"");return-1!==r().indexOf(t)}t.exports={isWhitelisted:i,get:o,getMobile:r,isWhitelistedMobile:s}},{}],36:[function(e,t,n){"use strict";function o(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",o=0;o<e.length;){var r=[e.charCodeAt(o++),o<e.length?e.charCodeAt(o++):0,o<e.length?e.charCodeAt(o++):0],i=r[0]<<16|r[1]<<8|r[2];n+=t.charAt(i>>18&63),n+=t.charAt(i>>12&63),0===r[1]?n+="==":(n+=t.charAt(i>>6&63),n+=0===r[2]?"=":t.charAt(63&i))}return n}function r(e,t){return"string"==typeof t&&(t=[t]),(t||[]).some(function(t){t=t.split("*").join(".*"),t="^"+t+"$";var n=new RegExp(t);return n.test(e)})}function i(e,t,n){var o,r;for("string"==typeof t&&(t=t.split(".")),o=0,r=t.length-1;r>o;o++)("undefined"==typeof e[t[o]]||null===e[t[o]])&&(e[t[o]]={}),e=e[t[o]];return e[t[r]]=n,e}function s(e,t,n){for(n&&t.match(/^\[(\d+)\]/)&&(t="a"+t,e={a:e}),t=t.split(".");e&&t.length>0;){for(;n&&(""+t[0]).match(/.*\[\d+\]$/);)(""+t[0]).replace(/(.*)\[(\d+)\]$/,function(e,n,o){t.splice(0,1,n,parseInt(o,10))});e=e[t.splice(0,1)]}return 0===t.length?e:void 0}function a(e){var t,n={};return t=e?e.split("?")[1]:window.location.search.substr(1),t&&t.split("&").forEach(function(e){e=e.split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}),n}function c(e){var t,n,o=[];for(t in e)e.hasOwnProperty(t)&&e[t]&&(n=encodeURIComponent("object"==typeof e[t]?JSON.stringify(e[t]):e[t]),o.push(t+"="+n));return o.join("&")}function u(e){return e?document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+e+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")||null:null}function d(e,t,n,o,r,i){var s;return!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e)?!1:(s=e+"="+t,r&&r.constructor===Date&&(s+="; expires="+r.toUTCString()),n&&(s+="; domain="+n),o&&(s+="; path="+o),i&&(s+="; secure"),document.cookie=s,!0)}function l(e,t,n){return document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?"; domain="+t:"")+(n?"; path="+n:""),!0}function f(){return p()+p()+"-"+p()+"-"+p("4")+"-"+p((Math.floor(10*Math.random())%4+8).toString(16))+"-"+p()+p()+p()}function p(e){for(var t=Math.floor(65535*Math.random()).toString(16),n=4-t.length;n>0;n--)t="0"+t;return e=(""+e).substring(0,4),!isNaN(parseInt(e,16))&&e.length?e+t.substr(e.length):t}function g(e){var t;if(null===e||"object"!=typeof e)return e;if("[object Date]"===Object.prototype.toString.call(e))return new Date(e.getTime());try{t=new e.constructor}catch(n){return}for(var o in e)e.hasOwnProperty(o)&&(t[o]=g(e[o]));return t}function h(e){if(null!==e&&"object"==typeof e)Object.keys(e).forEach(function(t){e[t]=h(e[t])});else if("string"==typeof e)return e.trim();return e}function m(e){e.parentNode.removeChild(e)}function v(e){var t=[{}].concat([].slice.call(arguments));return b.apply(null,t)}function y(e,t){for(var n=[],o=e.parentNode;o&&o.tagName&&o.getAttribute;)n.push(o),o=o.parentNode;return n.filter(function(e){return e.classList.contains(t)})[0]}function w(e,t,n,o){n=void 0===n?/\s+/:n;var r,i=(o&&o.ownerDocument||document).createDocumentFragment(),s=t.split(n).map(function(t){return(o||document.body).querySelector(e+" [sequenceKey="+t+"]")}).filter(function(e){return e});s.forEach(function(e,t,n){var o;e&&(r=r||e.parentNode,e===n[n.length-1]&&r&&(o=document.createTextNode(" "),r.replaceChild(o,e)),i.appendChild(e),o&&o.parentNode&&o.parentNode.replaceChild(i,o))})}function b(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t,n=Object(e),o=!1,r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i){for(var s=Object.keys(Object(i)),a=0,c=s.length;c>a;a++){var u=s[a];try{var d=Object.getOwnPropertyDescriptor(i,u);void 0!==d&&d.enumerable&&(n[u]=i[u])}catch(l){o||(o=!0,t=l)}}if(o)throw t}}return n}function k(e,t){var n=new Date(e);return isNaN(parseInt(t,10))||0>t||!(e instanceof Date)?null:(n.setSeconds(e.getSeconds()+t),n)}function E(e){return e instanceof Date&&!isNaN(e.getTime())}function _(){var e=[],t=e.push;e.push=e.unshift=e.splice=function(){throw"not yet implemented for uniqueArray"};var n=function(t){return-1===e.indexOf(t)};return e.addOnce=function(o,r){return n(o)&&(t.call(e,o),"function"==typeof r&&r()),e.length},e}function I(e,t){var n={};for(var o in t)if(t.hasOwnProperty(o)){null!==e&&"object"==typeof e&&e.hasOwnProperty(o)||(n[o]=t[o]);var r=null!==t[o]&&null!==e[o]&&!Array.isArray(t[o])&&!Array.isArray(e[o])&&"object"==typeof t[o]&&"object"==typeof e[o];if(r){var i=I(e[o],t[o]);Object.keys(i).length>0&&(n[o]=i)}else(e[o]!==t[o]||Array.isArray(t[o]))&&(n[o]=t[o]);null===e[o]&&""===t[o]&&delete n[o]}return n}function A(e){return Array.isArray(e)?e.forEach(A):null!==e&&"object"==typeof e&&Object.keys(e).forEach(function(t){"$"===t[0]?delete e[t]:A(e[t])}),e}function S(e,t){e.attr("tabindex","0"),e.on("keypress",function(e){(32===e.keyCode||13===e.keyCode)&&t(e)})}function x(){try{return new $(navigator.userAgent).getOS()}catch(e){return navigator.platform}}function T(){return/(iphone|ipod|ipad).* os 8_/.test(navigator.userAgent.toLowerCase())}function O(){var e="(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)";return window.devicePixelRatio>1||window.matchMedia&&window.matchMedia(e).matches}function R(){var e={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return e.Android()||e.BlackBerry()||e.iOS()||e.Opera()||e.Windows()}};return e.any()}function N(){return"relative"===window.getComputedStyle(document.body).getPropertyValue("position")}function C(e){return{category:e.keyCategory,codes:(e.errors||[]).map(function(e){return e.code}).join(",")}}function D(e){return P(e,"AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN")}function P(e,t){return e&&(e.errors||[]).some(function(e){return e.code===t})}function L(e){e=e||{};var t=[];return Object.keys(e).forEach(function(n){var o=n,r=e[n];if(r||"number"==typeof r||"boolean"==typeof r){var i=Array.isArray(e[n])?e[n].join(","):e[n].toString();o+="("+i+")"}t.push(o)}),t.join(",")}function j(){function e(e,o,r){e.classList.add("no-animate"),e.style.height=n(e)+"px",setTimeout(function(){e.classList.remove("no-animate"),(r||function(){})()},0),o&&setTimeout(function(){t(e)},o)}function t(e){e.classList.add("no-animate"),e.style.height=null,setTimeout(function(){e.classList.remove("no-animate")},0)}function n(e){var t=e.offsetHeight;return t||(e.classList.add("state-calculating"),t=e.offsetHeight,e.classList.remove("state-calculating")),t}return{lock:e,unlock:t,measure:n}}function U(e){return"string"==typeof e?e.substring(0,6)+"...":void 0}function M(e){e=""+e;var t="",n=e.indexOf("@"),o=e.substring(0,n),r=e.substring(n);return t+=o.length>4?o.substring(0,3):o[0],t+="****",t+=r}function q(e){return"string"==typeof e&&e.length?J(e).toString(16):void 0}function B(e){var t={"AM-FACEBOOK":"facebook","AM-GOOGLE":"google"};return t[e]}function F(e,t){var n,o,r=this,i=function(){};i.prototype=this.prototype,n=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return r.apply(this,arguments)};for(o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);if(t)for(o in t)t.hasOwnProperty(o)&&(n[o]=t[o]);if(n.prototype=new i,n.__super__=r.prototype,e)for(o in e)e.hasOwnProperty(o)&&(n.prototype[o]=e[o]);return n.prototype.constructor=n,n}function V(e){var t=e.match(/[^.]+(?:\.com?(?:\.[a-z]{2})?|(?:\.[a-z]+))?$/i);return t&&t.length?t[0].replace(/:[0-9]+$/,""):void 0}function G(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);return t&&{protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]}}function z(e){return"[object Object]"===Object.prototype.toString.call(e)}function K(){var e=""+window.location.hostname,t=e.split("."),n=V(e),o=[];for(o.push(e);e!==n;)t.shift(),e=t.join("."),o.push(e);return o}function W(e){return Math.random()<=e}function H(){Array.prototype.forEach.call(document.querySelectorAll("section"),function(e){e.classList[e.childNodes.length?"remove":"add"]("section-empty")})}function Y(e,t){if(null===e||void 0===e)throw new TypeError("Find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n,o=Object(e),r=o.length,i=0;r>i;i++)if(n=o[i],t.call(null,n,i,o))return n;return void 0}function X(e){return e.reduceNative(function(e,t){return e.concat(Array.isArray(t)?X(t):t)},[])}function Q(e,t){for(var n;null!==(n=ee.exec(t));){var o=s(e,n[1]);t=t.replace(n[0],o||"")}return t}var $=e("../../../../assets/common/js/ua-parser"),Z=e("./browser-detection"),J=e("./crc32");t.exports={set:i,get:s,getQueryStringParams:a,buildQueryString:c,getCookie:u,setCookie:d,deleteCookie:l,uuid:f,clone:g,deepTrim:h,removeNode:m,immutableAssign:v,getParentByClassName:y,reorderElements:w,assign:b,expires:k,isValidDate:E,uniqueArray:_,objectDiff:I,filterAngularProperties:A,makeElementAccessible:S,crc32:J,isEspnClientId:e("./espn-whitelist").isWhitelisted,getEspnWhitelist:e("./espn-whitelist").get,curry:e("./curry"),promise:e("./promise"),url:e("./url"),isIE10:Z.isIE10,isAndroidBrowser:Z.isAndroidBrowser,isIOS:Z.isIOS,getOS:x,isIOS8:T,isRetina:O,isMobileDevice:R,docReady:e("./doc-ready"),getErrorCodesAndCategory:C,containsInvalidAccessTokenError:D,containsErrorCode:P,formatLogInfoBlock:L,maskToken:U,maskEmail:M,hashString:q,getSocialProviderFromNamespace:B,heightHelper:j(),extend:F,getTLD:V,getLocation:G,isObject:z,getCookieDomains:K,randomChance:W,hideEmptySections:H,find:Y,flattenArray:X,base64Encode:o,stringPatternMatch:r,isBodyPositionRelative:N,lowercaseObjectKeys:e("../../../utils/lowercase-object-keys"),interpolate:Q};var ee=/\$\{(.+?)\}/g},{"../../../../assets/common/js/ua-parser":3,"../../../utils/lowercase-object-keys":104,"./browser-detection":31,"./crc32":32,"./curry":33,"./doc-ready":34,"./espn-whitelist":35,"./promise":37,"./url":38}],37:[function(e,t,n){"use strict";function o(e,t){e.then(t,t)}function r(e,t){var n=[].slice.call(arguments,2);setTimeout(function(){e.reject.apply(e,n)},t)}function i(e,t,n){var o=null;return n="number"!=typeof n?0:n,function(){return null===o&&(o=e.apply(t,arguments),o["finally"](function(){setTimeout(function(){o=null},n)})),o}}t.exports={complete:o,timeout:r,cache:i}},{}],38:[function(e,t,n){"use strict";function o(e){return function(t){return r.href=t,r[e]}}var r=document.createElement("a");t.exports={getHostName:o("hostname")}},{}],39:[function(e,t,n){!function(){"use strict";function e(e,t){this.listeners[e]=this.listeners[e]||[],"function"==typeof t&&this.listeners[e].push(t)}function n(e,t){if("undefined"!=typeof this.listeners[e])if("undefined"==typeof t)this.listeners[e]=[];else for(var n=this.listeners[e].length;n;)t===this.listeners[e][n-1]&&this.listeners[e].splice(n-1,1),n--}function o(e){if("undefined"!=typeof this.listeners[e]&&this.listeners[e].length>0){var t=arguments.length>1?Array.prototype.slice.call(arguments,1):[];this.listeners[e].forEach(function(e){e.apply({},t)})}}function r(e){return function(){return this.listeners=this.listeners||{},e.apply(this,arguments),this}}t.exports={extend:function(t){t.prototype.on=r(e),t.prototype.off=r(n),t.prototype.emit=r(o)}}}()},{}],40:[function(e,t,n){"use strict";function o(e,t){this.history=[],e&&this.track(e,t)}function r(e,t){var n={};return t.forEach(function(t){var o=i.get(e,t.prop),r="function"==typeof t.format?t.format(o):o;n[t.prop]=i.clone(r)}),n}var i=e("utils");t.exports=o,o.prototype.track=function(e,t){var n=this;t=t||[],e.on("step-start",function(o){n.history.push({workflowName:e.name,stepName:o.name,data:r(o.data,t),started:Date.now(),properties:t})})},o.prototype.getTrail=function(){var e="";try{return this.history.reduceNative(function(e,t){return e+t.workflowName+"/"+t.stepName+">"},"")||""}catch(t){}return e},o.prototype.getData=function(){var e=this,t={},n="";try{n=e.history.reduceNative(function(e,n){t[n.workflowName]=t[n.workflowName]||r({},n.properties);var o=i.objectDiff(t[n.workflowName],n.data);return Object.keys(o).length>0&&(e+=JSON.stringify(o),t[n.workflowName]=n.data),e+=">"},"")||""}catch(o){}return n}},{utils:36}],41:[function(e,t,n){!function(){"use strict";function n(e){e=e||{},this.current=null,this.steps=[],this.names=[],this.handlers=[],this.callbacks={},this.invokedSteps=[],this.name=e.name||"Anonymous",a.debug("Workflow created: ",this.name)}function o(e){var t=this,n={};return this.handlers.push(n),{success:function(o){return n.success=function(n){this.step&&(e=this.step,t=this.workflow),t.run("function"==typeof o?o.apply(e):o,n)},this},failure:function(o){return n.failure=function(n){this.step&&(e=this.step,t=this.workflow),t.run("function"==typeof o?o.apply(e):o,n)},this},cancel:function(o){return n.cancel=function(n){this.step&&(e=this.step,t=this.workflow),t.run("function"==typeof o?o.apply(e):o,n)},this}}}function r(e){try{a.debug("  with data: ",i(s.clone(e)))}catch(t){}}function i(e){return Array.isArray(e)?e.forEach(i):null!==e&&"object"==typeof e&&Object.keys(e).forEach(function(t){/email|username|loginValue|password/i.test(t)&&(e[t]="*"),i(e[t])}),e}var s=e("utils"),a=e("logger"),c=e("./emitter");c.extend(n),n.prototype.step=function(e,t){var n=this;return t.internalName=[n.name,e].join("."),t.name=e,this.names.push(e),this.steps.push(t),o.call(this,t)},n.prototype.run=function(e,t){function n(){o.emit("step-end",{name:s.name,workflow:o,data:t})}var o=this,i=this.names.indexOf(e);(null===e||"undefined"==typeof e||-1===i)&&(i=0);var s=this.steps[i],c=this.handlers[i];if(["done","success","failure","cancel"].indexOf(e)>-1)return this.emit(e,t);o.emit("step-start",{name:s.name,workflow:o,data:t}),a.debug("Running step: ",s.internalName),r(t),this.invokedSteps.push(e),t=t||{};var u=s.start(t,this.name,{emit:this.emit.bind(this)});u.then(function(){n(),c.success.apply({workflow:o,step:s},arguments)}),u["catch"](function(){n(),c.failure.apply({workflow:o,step:s},arguments)}),u.progress(function(){n(),c.cancel.apply({workflow:o,step:s},arguments)}),this.current=s},n.prototype.mock=function(t,n){var o,r=this.names.indexOf(t),i=this.steps[r],a=this;-1!==r&&("string"==typeof n&&(n={result:n}),o=new(e("./step").extend({execute:function(){var e=this;setTimeout(function(){"function"==typeof n?n.apply(e,[i]):(e.data=s.assign(e.data,n.data||{}),e[n.result]())},0)}})),this.steps[r]=o,["success","failure","cancel"].forEach(function(e){a.handlers[r][e]&&(a.handlers[r][e]=a.handlers[r][e].bind({workflow:a,step:o}))}))},n.prototype.end=function(){this.current&&(this.current.end(),this.current=null)},n.extend=s.extend,t.exports=n}()},{"./emitter":39,"./step":42,logger:15,utils:36}],42:[function(e,t,n){!function(){"use strict";function n(e){this.live=!1,this.name="generic",this.initialize(e)}var o=e("./emitter"),r=e("q");o.extend(n),n.prototype.initialize=function(){},n.prototype.start=function(e,t,n){return this.deferred=r.defer(),this.workflow=n,this.data=e||{},this.workflowName=t||"",this.pre(),this.render(),this.execute(),this.live=!0,this.deferred.promise},n.prototype.end=function(){this.post(),this.data=null,this.live=!1,this.deferred=null},n.prototype.success=function(){this.post(),this.emit("success",this.data),this.deferred.resolve(this.data),this.live=!1},n.prototype.cancel=function(){this.post(),this.emit("cancel",this.data),this.deferred.notify(this.data),this.live=!1},n.prototype.failure=function(){this.post(),this.emit("failure",this.data),this.deferred.reject(this.data),this.live=!1},n.prototype.render=function(){},n.prototype.pre=function(){},n.prototype.execute=function(){},n.prototype.post=function(){},n.extend=e("utils").extend,t.exports=n}()},{"./emitter":39,q:1,utils:36}],43:[function(e,t,n){function o(e){return i.read().then(function(t){return t||r.apiKey(s.uuid(),e)})}var r=e("dao"),i=e("session.apiKey"),s=e("utils");t.exports={get:o}},{dao:54,"session.apiKey":"session.apiKey",utils:36
}],44:[function(e,t,n){!function(){"use strict";function n(e){N.site=R.clone(e)}function o(e){N.global=R.clone(e)}function r(e){N.dynamicConfig=R.clone(e)}function i(e){O.log("config#setMobileConfig"),N.mobile=R.clone(e)}function s(){return R.clone(R.get(N,"global"))}function a(){return R.clone(R.get(N,"site.data"))}function c(){return R.clone(R.get(N,"site.error"))}function u(e,t,n){var o,r,i,s,c=a(),u="PARTIAL"==n?"CREATE":n,d="compliance.ageBands."+t+"."+u,l="marketing."+t+"."+u,f="displayName";return o=R.get(c,d),r=R.get(c,l),i=R.get(c,f),s=T.profile.get(e,o),s.profile.phones=T.phones.get(e,o),s.profile.addresses=T.addresses.get(e,o,u),s.marketing=T.marketing.get(e,r,n,c.epcenabled),i&&(s.displayName=T.displayName.get(i,n)),s}function d(e){return R.get(a(),"activityPermissions")[e].map(function(e){return e.activityCode})}function l(e,t,n){O.log("config#getNewsletters");var o=T.newsletters.get(e,R.get(a(),"newsletters."+t))||{};return o[n]}function f(){return O.log("config#getUiConfig"),R.get(a(),"uiConfig")||{}}function p(){O.log("config#getFeatureRenderConfig");var e=(a(),R.get(f(),"features")||{}),t={};return t.interstitialConfig=R.get(e,"createInterstitial"),t.showInterstitial=R.get(t.interstitialConfig,"enabled"),t.carouselConfig=R.get(t.interstitialConfig,"carousel"),t.showCarousel=R.get(t.carouselConfig,"enabled"),t.showProductLogo=R.get(e,"productLogo.enabled"),t.showPrimaryValueProp=R.get(e,"valuePropositions.enabled")&&R.get(e,"valuePropositions.primary"),t.showSecondaryValueProp=R.get(e,"valuePropositions.enabled")&&R.get(e,"valuePropositions.secondary"),t.showProductValueArea=t.showProductLogo||t.showSecondaryValueProp,t.showMaskedDob=!(m()||!R.get(e,"inputMask.dateOfBirth")),t.showSelectDob=!(m()||R.get(e,"inputMask.dateOfBirth")),t}function g(){return R.get(N,"site.data.uiConfig.audience")||R.get(N,"site.data.uiConfig.adultAudience")}function h(){var e=g();return"string"==typeof e?"FF"===e:!e}function m(){return"PK"===R.get(N,"site.data.uiConfig.audience")}function v(){var e=R.get(N,"site.data.uiConfig.showDOB"),t=R.get(N,"site.data.uiConfig.adultAudience");return m()?!1:"undefined"!=typeof e?e:!t}function y(){return R.get(N,"site.data.clientInfo.carbonDomain")||"DISNEY"}function w(){var e=R.get(N,"site.data.accountMapping");return["AM-FACEBOOK","AM-GOOGLE"].some(function(t){return R.get(e,[t,"enabled"].join("."))===!0})}function b(e){var t=R.get(a(),"uiConfig.isCastMember");if(!t)return!1;var n=!1;return R.get(t,"contexts").forEach(function(t){t.context===e&&t.enabled&&(n=!0)}),n}function k(e,t,n){var o=R.get(N,"global.services.guestController.url"),r=R.get(N,"global.services.guestController.ha.support."+e);return r&&-1!=r.indexOf(t)&&(o=R.get(N,"global.services.guestController.ha.url")),o}function E(e,t){var n=a();t&&t.resolve(n)}function _(e){O.log("config#setClientConfigOverrides",e);for(var t in e)e.hasOwnProperty(t)&&R.set(N,"site.data."+t,e[t])}function I(){return!!R.get(a(),"enhancedLogin.allowMobileLogin.enabled")}function A(e){return!!R.get(N,"dynamicConfig.features."+e)}function S(){return O.log("config#isMobileSDK"),!!R.get(N,"mobile")}function x(){O.log("config#getMobileConfig");var e=R.get(N,"mobile");return e?R.clone(e):null}var T=e("./render"),O=e("logger"),R=e("utils"),N={};t.exports={setSite:n,setGlobal:o,setDynamicConfig:r,setMobileConfig:i,getGlobal:s,getNewsletters:l,getSite:a,getFeatureRenderConfig:p,getSiteConfigErrors:c,getRender:u,getSupportedActivities:d,getUiConfig:f,getAudience:g,isFamilyFriendly:h,isPrimaryKid:m,showDob:v,getCarbonDomain:y,isSocialEnabled:w,isCastMemberEnabled:b,getGuestControllerBaseUrl:k,getSiteMessageHandler:E,setClientConfigOverrides:_,isMobileVerificationEnabled:I,isDynamicConfigFeatureEnabled:A,isMobileSDK:S,getMobileConfig:x}}()},{"./render":47,logger:15,utils:36}],45:[function(e,t,n){!function(){"use strict";function n(e,t){function n(e,t,n){t="HOME"===t&&void 0===a[t]?"DEFAULT":t;var i,s=o.get(a[t],e);return s||(s={editable:"NOT_ALLOWED",required:!1}),i=r.getRules(s.editable,n),i.required=s.required,i}var s=o.get(t,"addresses"),a=o.get(t,"addresses.type")||{},c=o.get(e,"profile.addresses")||[],u={type:{},guid:{}};return Object.keys(a).forEach(function(e){var t="DEFAULT"===e?"HOME":e;u.type[t]=i.reduce(function(t,o){return t[o]=n(o,e,!1),t},{}),u.type[t].required=s.type[e].required,c.forEach(function(t){var o=!0,r={};i.forEach(function(e){r[e]=n(e,t.type,!!t[e]),"type"!==e&&"preferred"!==e&&r[e].visible===!0&&(o=!1)}),o===!1&&(u.guid[t.addressGuid]=r,u.guid[t.addressGuid].deletable=!a[e].required)})}),u}var o=e("../../../common/utils"),r=e("./utils"),i=["country","postalCode","line1","line2","line3","city","stateProvince","type","preferred"];t.exports={get:n}}()},{"../../../common/utils":36,"./utils":52}],46:[function(e,t,n){!function(){"use strict";function n(e,t){return{visible:o.get(e,"display."+t.toLowerCase()+".visible")||o.get(e,"display.default.visible"),enabled:e.enabled}}t.exports={get:n};var o=e("../../../common/utils")}()},{"../../../common/utils":36}],47:[function(e,t,n){!function(){"use strict";t.exports={profile:e("./profile"),phones:e("./phones"),addresses:e("./addresses"),marketing:e("./marketing"),newsletters:e("./newsletters"),displayName:e("./display-name")}}()},{"./addresses":45,"./display-name":46,"./marketing":48,"./newsletters":49,"./phones":50,"./profile":51}],48:[function(e,t,n){!function(){"use strict";function n(e,t,n,i){return r.splitLists(t,o.get(e,"marketing")||[],n,i)}var o=e("utils"),r=e("../../marketing/marketing-utils");t.exports={get:n}}()},{"../../marketing/marketing-utils":58,utils:36}],49:[function(e,t,n){!function(){"use strict";function n(e,t){return t=o(t),Object.keys(t).forEach(function(n){t[n]=i.splitLists(t[n],r.get(e,"marketing")||[],"CREATE")}),t}function o(e){var t={};return e=r.clone(e)||{},Object.keys(e).forEach(function(n){var o={};(e[n]||[]).forEach(function(e){o[e.name]={},o[e.name].proxySplitRules=["RECORDED","DONT_SHOW_RECORDED"],o[e.name].checked=e.checked,o[e.name].proxy={},e.lists.forEach(function(t){o[e.name].proxy[t.name]={checked:t.checked}})}),t[n]=o}),t}var r=e("utils"),i=e("../../marketing/marketing-utils");t.exports={get:n}}()},{"../../marketing/marketing-utils":58,utils:36}],50:[function(e,t,n){!function(){"use strict";function n(e,t){var n=o.get(t,"phones")||{},i=[],s=(o.get(e,"profile.phones")||[]).reduce(function(e,t){return e[t.type]=e[t.type]||[],e[t.type].push(t),e},{});return n.type||"EDITABLE"!==n.editable||(n.type={DEFAULT:{require:!1,editable:"EDITABLE"}}),Object.keys(o.get(n,"type")||{}).forEach(function(e){var t,a="DEFAULT"===e?"NIGHT":e;t="undefined"!=typeof o.get(n,"type."+e+".quantityMin")?o.get(n,"type."+e+".quantityMin"):"undefined"!=typeof o.get(n,"quantityMin")?o.get(n,"quantityMin"):1;for(var c=0;t>c;c++){var u=o.get(n,"type."+e+".number.editable")||o.get(n,"editable")||"EDITABLE",d=o.get(n,"type."+e+".required"),l=r.getRules(u,o.get(s[a],"length")>0);if((o.get(s[a],"length")||0)>0){var f=s[a].pop();l.phoneGuid=(f||{}).phoneGuid}l.type=a,l.required="undefined"!=typeof d?d:!1,l.visible&&i.push(l)}}),i}var o=e("../../../common/utils"),r=e("./utils");t.exports={get:n}}()},{"../../../common/utils":36,"./utils":52}],51:[function(e,t,n){!function(){"use strict";function n(e,t){var n={profile:{}};return Object.keys(t||{}).forEach(function(i){if("phones"!==i&&"addresses"!==i){var s=o.get(e,"profile."+i);n.profile[i]=r.getRules(t[i].editable,!!s),n.profile[i].required=t[i].required}}),n}var o=e("../../../common/utils"),r=e("./utils");t.exports={get:n}}()},{"../../../common/utils":36,"./utils":52}],52:[function(e,t,n){!function(){"use strict";function e(e,t){var n={};switch(e){case"EDITABLE":n.visible=!0,n.disabled=!1;break;case"NOT_EDITABLE":n.visible=!0,n.disabled=!0;break;case"WRITE_ONCE":n.visible=!0,n.disabled=!!t;break;case"NOT_ALLOWED":default:n.visible=!1,n.disabled=!0}return n}t.exports={getRules:e}}()},{}],53:[function(e,t,n){!function(){function n(e){return e?(e.then(function(e){fe.setSite(e.site),fe.setGlobal(e.global),fe.setDynamicConfig(e.dynamicConfig)}),te=e):void(te=null)}function o(){function e(){return Object.keys(r||{}).map(function(e){return[e,r[e]].map(encodeURIComponent).join("=")}).join("&")}var t=fe.getGlobal(),n=fe.getGuestControllerBaseUrl(this.method,this.path),o=se.get(t,"clientId"),r=se.clone(this.query)||{},i=ce.getMarketingMode(),s=ce.getEpcEnabled(),a=[];i&&a.push("epc"===i?"epc-override-set":"epc-override-unset"),s&&a.push("epc-enabled"),a.length&&(r.feature="string"==typeof r.feature?r.feature.split(",").concat(a).join(","):a.join(",")),this.path=[n,"client",o].join("/")+this.path,Object.keys(r).length>0&&(this.path+="?"+e())}function r(){this.query=this.query||{},this.query.langPref=this.query.langPref||a()}function i(){this.headers=se.assign(se.clone(ge),this.headers);var e=ce.getGeoIP();e?this.headers["x-forwarded-for"]=e:delete this.headers["x-forwarded-for"],this.headers["conversation-id"]=this.headers["conversation-id"]||se.uuid()}function s(){this.body=JSON.stringify(this.body)}function a(){return se.get(fe.getGlobal(),"language.preference")||"en-US"}function c(e){var t=["sourceName","templateName","affiliateName","siteID"];return Object.keys(e||{}).filter(function(e){return-1!==t.indexOf(e)}).reduceNative(function(t,n){return t.push(n+"="+e[n]),t},[]).join(",")}function u(e,t,n,a,c){function u(){return[r,o,i,s].forEach(function(e){e.apply(p)}),d()}function d(e,t){return ae.debug("dao#makeRequest executeRequest"),ne(p.method,p.path,p.body,p.headers,pe).then(l)["catch"](function(e){throw ae.error("dao#makeRequest executeRequest"),e})}function l(e){return ae.debug("dao#makeRequest complete"),re.resolve().then(function(){try{e.response=JSON.parse(e.response)}catch(t){}var n=new oe(e.response,e.status,e.headers);if(n.xhrFailureReason=e.xhrFailureReason,n.xhrTimeout=e.xhrTimeout,n.xhrReadyState=e.xhrReadyState,!n.isValid())throw n;return n}).then(f)["catch"](function(e){throw ae.error("dao#makeRequest complete"),e})}function f(e){return ae.debug("dao#makeRequest writeS2Data"),re.resolve().then(function(){var t=se.get(e,"data.s2");return t?(ae.debug("S2 present in GC response; write cookie"),de.write(t).then(function(){return e})["catch"](function(e){throw ae.error("dao#makeRequest s2.write"),e})):e})["catch"](function(e){throw ae.error("dao#makeRequest writeS2Data"),e})}ae.debug("dao#makeRequest");{var p={method:e,path:t,body:n,headers:a,query:c};se.get(a,"conversation-id"),se.get(a,"correlation-id")}return te?re.when(te).then(function(){return p}).then(u)["catch"](function(e){throw ae.error("dao#makeRequest"),e}):re.when(u())}function d(e){return null!==e&&"object"==typeof e&&0!==Object.keys(e).length?se.base64Encode(JSON.stringify(e)):void 0}function l(e){return u("POST","/guest/login",{loginValue:e.loginValue,password:e.password},{Authorization:e.authorization,"correlation-id":e.correlationId,"conversation-id":e.conversationId,"oneid-reporting":d(e.reporting)},{langPref:a()})}function f(e,t,n,o,r){return u("POST","/guest/login/on-behalf-of",{swid:t},{Authorization:"BEARER "+e,"conversation-id":n||se.uuid(),"correlation-id":o||se.uuid(),"oneid-reporting":d(r)})}function p(e,t,n,o,r){return u("GET","/guest/check-authorization/"+t,{},{Authorization:"BEARER "+e,"conversation-id":n||se.uuid(),"correlation-id":o||se.uuid(),"oneid-reporting":d(r)})}function g(e){var t={profile:e.profile,marketing:e.marketing,legalAssertions:e.legalAssertions,marketingSource:e.sourceName,campaign:e.campaign};return u("POST","/marketing",t,{Authorization:e.authorization,"correlation-id":e.correlationId,"conversation-id":e.conversationId,"oneid-reporting":d(e.reporting)},{langPref:a()})}function h(e){var t={profile:e.profile,marketing:e.marketing,legalAssertions:e.legalAssertions,marketingSource:e.sourceName};return u("POST","/marketing/profile",t,{Authorization:e.authorization,"correlation-id":e.correlationId,"conversation-id":e.conversationId,"oneid-reporting":d(e.reporting)},{langPref:a()})}function m(e){return u("POST","/license-plate/code/"+encodeURIComponent(e.activationCode)+"/activate",{refreshToken:e.refreshToken},{Authorization:e.authorization,"correlation-id":e.correlationId,"conversation-id":e.conversationId,"oneid-reporting":d(e.reporting)},{langPref:a()})}function v(e){return u("GET","/license-plate/code/"+e.pairingCode,null,{Authorization:e.authorization,"correlation-id":e.correlationId,"conversation-id":e.conversationId,"oneid-reporting":d(e.reporting)})}function y(e){var t={lookupValue:e.lookupValue};return e.referenceId&&(t.referenceId=e.referenceId),u("POST","/notification/resolve-mase",t,{Authorization:e.authorization,"correlation-id":e.correlationId,"conversation-id":e.conversationId},{langPref:a()})}function w(e){return u("POST","/notification/recover-username",{lookupValue:e.lookupValue},{Authorization:e.authorization,"correlation-id":e.correlationId,"conversation-id":e.conversationId,"oneid-reporting":d(e.reporting)},{langPref:a()})}function b(e){return u("POST","/notification/recover-password",{lookupValue:e.lookupValue},{Authorization:e.authorization,"correlation-id":e.correlationId,"conversation-id":e.conversationId,"oneid-reporting":d(e.reporting)},{langPref:a()})}function k(e,t,n,o){return u("POST","/clickback/make-primary/"+e,{},{Authorization:"BEARER "+t,"conversation-id":n,"correlation-id":o})}function E(e){return u("POST","/validate",e.params,{Authorization:e.authorization,"conversation-id":e.conversationId,"correlation-id":e.correlationId,"oneid-reporting":d(e.reporting)})}function _(e,t,n,o,r,i){return i=i||{},u("GET","/guest/"+e,{},{Authorization:"BEARER "+t,"conversation-id":n,"correlation-id":o,"oneid-reporting":d(r)},i)}function I(e,t,n,o,r){return u("GET","/guest/activity-permission/"+t,null,{Authorization:"BEARER "+n,"conversation-id":o,"correlation-id":r},{activityCode:e,langPref:a()})}function A(e,t,n,o){return u("GET","/guest/"+e+"/adult-verification-status/",null,{Authorization:"BEARER "+t,"correlation-id":n,"oneid-reporting":d(o)})}function S(e,t,n,o,r){return u("POST","/guest/"+t+"/adult-verification-ssn/",e,{Authorization:"BEARER "+n,"correlation-id":o,"oneid-reporting":d(r)})}function x(e,t,n,o,r){return u("POST","/guest/"+t+"/adult-verification-quiz/",e,{Authorization:"BEARER "+n,"correlation-id":o,"oneid-reporting":d(r)})}function T(e,t,n,o){var r={"conversation-id":e,"correlation-id":t,"oneid-reporting":d(n)};return o&&(r["g-recaptcha-response"]=o),u("POST","/api-key",null,r,null).then(function(e){var t=e.headers&&e.headers["api-key"]||e;if("string"==typeof t)return ue.write(t),t;throw e})["catch"](function(e){throw ae.error("dao#apiKey"),e})}function O(e,t,n,o,r){return u("POST","/guest/activity-permission/"+t,{activityCode:e},{Authorization:"BEARER "+n,"correlation-id":r,"conversation-id":o},{langPref:a()})}function R(e,t,n,o){return u("POST","/notification/parental-approval/"+e,null,{Authorization:"BEARER "+t,"correlation-id":o,"conversation-id":n},{langPref:a()})}function N(e,t,n,o,r,i,s){return e=se.clone(e),e.etag=o,u("POST","/guest/"+t,e,{Authorization:"BEARER "+n,"correlation-id":r,"conversation-id":i,"oneid-reporting":d(s)},{feature:"no-password-reuse"})}function C(e,t,n,o,r){return u("POST","/guest/login/social",e,{"correlation-id":n,"conversation-id":o,"oneid-reporting":d(r)},t?{oneClick:!0}:{})}function D(e,t,n,o){return u("POST","/guest/login/blue",{blueCookie:e},{"conversation-id":t||se.uuid(),"correlation-id":n||se.uuid(),"oneid-reporting":d(o)})}function P(e){var t=c(e.optionalConfigs);t&&se.set(e,"guest.profile.profileContext",t);var n=ce.getTestProfileFlag();return n&&se.set(e,"guest.profile.testProfileFlag","Y"),u("POST","/guest/register",e.guest,{Authorization:e.authorization,"correlation-id":e.correlationId,"conversation-id":e.conversationId,"oneid-reporting":d(e.reporting)},{autogeneratePassword:!e.guest.password,autogenerateUsername:!e.guest.profile.username})}function L(e,t,n,o){return u("POST","/guest/refresh-auth/"+e,{},{"conversation-id":t,"correlation-id":n,"oneid-reporting":d(o)})}function j(e,t,n,o,r,i,s,a){var c={accountMapping:{}};return c.accountMapping[e]={externalId:t,externalDisplayName:n},u("PUT","/guest/account-mapping/"+o,c,{Authorization:"BEARER "+r,"conversation-id":i,"correlation-id":s,"oneid-reporting":d(a)})}function U(e,t,n,o){return u("DELETE","/guest/"+e,{},{Authorization:"BEARER "+t,"conversation-id":n,"correlation-id":o})}function M(e){return u("POST","/notification/upgrade-nrt",{lookupValue:e.lookupValue},{Authorization:e.authorization,"conversation-id":e.conversationId,"correlation-id":e.correlationId},{langPref:a()})}function q(e,t,n,o){return u("POST","/guest/"+e+"/logout",{tokenAndClientIds:se.flattenArray([t])},{"conversation-id":n,"correlation-id":o})}function B(e,t,n){return ae.debug("dao#makeRequest recaptcha"),ie.publish("show-recaptcha-modal",e,t,n),re.Promise(function(e){var t=ie.subscribe("recaptcha-solved",function(n){e(n),t()})})}function F(e,t){return function(){ae.debug("Dao#apiKeyWrapper");for(var n={},o=0;o<t.length&&o<arguments.length;o++)n[t[o]]=arguments[o];n.conversationId=n.conversationId||se.uuid(),n.correlationId=n.correlationId||se.uuid();var r=n.reporting;return ue.read().then(function(e){return e||T(n.conversationId,n.correlationId,r)}).then(function(t){return e(se.assign(n,{authorization:"APIKEY "+t}))},function(t){if(ae.debug("Dao#apiKeyWrapper: apiKey() failed, calling recaptcha"),"FAILURE_BY_DESIGN"===se.get(t,"error.keyCategory")&&le.find(se.get(t,"error.errors"),"RATE_LIMITED"))return B(n.conversationId,n.correlationId,r).then(function(e){return T(n.conversationId,n.correlationId,r,e)}).then(function(t){return e(se.assign(n,{authorization:"APIKEY "+t}))});throw t}).then(function(t){return le.find(le.getKeyErrors(t),["API_KEY_INVALID","RATE_LIMITED"])?(ae.debug("Dao#apiKeyWrapper: response contains api-key error"),ue.write(null).then(function(){return T(n.conversationId,n.correlationId,r)})["catch"](function(e){if(ae.debug("Dao#apiKeyWrapper: apiKey() failed, calling recaptcha"),"FAILURE_BY_DESIGN"===se.get(e,"error.keyCategory")&&le.find(se.get(e,"error.errors"),"RATE_LIMITED"))return B(n.conversationId,n.correlationId,r).then(function(e){return T(n.conversationId,n.correlationId,r,e)});throw e}).then(function(t){return e(se.assign(n,{authorization:"APIKEY "+t})).then(function(e){if(le.find(le.getKeyErrors(e),["API_KEY_INVALID","RATE_LIMITED"]))throw e;return e})})):(t.headers["api-key"]&&ue.write(t.headers["api-key"]),t)},function(e){throw e})}}function V(e){return u("POST","/notification/otp/login",{loginValue:e.loginValue},{Authorization:e.authorization,"conversation-id":e.conversationId,"correlation-id":e.correlationId,"oneid-reporting":d(e.reporting)})}function G(e,t,n,o,r){return u("POST","/notification/otp/verification",{phoneGuid:e},{Authorization:"BEARER "+t,"conversation-id":n,"correlation-id":o,"oneid-reporting":d(r)})}function z(e){var t={};return"PHONE"===e.recoveryType.toUpperCase()?t.phoneGuid=e.data:t.lookupValue=e.data,u("POST","/notification/otp/recovery",t,{Authorization:e.authorization,"conversation-id":e.conversationId,"correlation-id":e.correlationId,"oneid-reporting":d(e.reporting)})}function K(e,t,n,o,r,i,s){return e=se.clone(e),e.etag=o,u("POST","/guest/"+t,e,{"send-mobile-verification":"true",Authorization:"BEARER "+n,"correlation-id":r,"conversation-id":i,"oneid-reporting":d(s)})}function W(e){return u("POST","/notification/otp/recovery",{phoneGuid:e.phoneGuid},{Authorization:e.authorization,"conversation-id":e.conversationId,"correlation-id":e.correlationId,"oneid-reporting":d(e.reporting)})}function H(e,t,n,o,r,i,s){return u("POST","/guest/"+n+"/verify/otp",{passcode:e,sessionId:t},{Authorization:"BEARER "+o,"conversation-id":r,"correlation-id":i,"oneid-reporting":d(s)})}function Y(e){return u("POST","/guest/login/otp",{passcode:e.passcode,sessionId:e.sessionId},{Authorization:e.authorization,"conversation-id":e.conversationId,"correlation-id":e.correlationId,"oneid-reporting":d(e.reporting)})}function X(e){return u("POST","/otp/redeem",{passcode:e.passcode,sessionId:e.sessionId},{Authorization:e.authorization,"conversation-id":e.conversationId,"correlation-id":e.correlationId,"oneid-reporting":d(e.reporting)})}function Q(e){return u("POST","/guest/recovery-methods",{loginValue:e.loginValue},{Authorization:e.authorization,"conversation-id":e.conversationId,"correlation-id":e.correlationId,"oneid-reporting":d(e.reporting)})}function $(e){return u("POST","/guest/login/recoveryToken",{recoveryToken:e.recoveryToken,swid:e.swid},{Authorization:e.authorization,"conversation-id":e.conversationId,"correlation-id":e.correlationId,"oneid-reporting":d(e.reporting)})}function Z(e,t,n,o,r,i){return u("POST","/clickback-token/change-password",{loginValue:e,newPassword:t},{Authorization:"BEARER "+n,"conversation-id":o,"correlation-id":r,"oneid-reporting":d(i)},{feature:"no-password-reuse"})}function J(e,t,n,o,r,i){return u("POST","/session/transfer/activate",{refreshToken:t,sessionTransferKey:n},{Authorization:"BEARER "+e,"conversation-id":o,"correlation-id":r,"oneid-reporting":d(i)},{})}function ee(e){return u("POST","/session/transfer/redeem",{sessionTransferKey:e.sessionTransferKey},{Authorization:e.authorization,"conversation-id":e.conversationId,"correlation-id":e.correlationId,"oneid-reporting":d(e.reporting)},{langPref:a()})}var te,ne=e("./request"),oe=e("./response"),re=e("q"),ie=e("messages"),se=e("utils"),ae=e("logger"),ce=e("debug"),ue=e("session.apiKey"),de=e("session.s2"),le=(e("api-key"),e("exceptions")),fe=e("config"),pe=(t.exports={apiKeyWrapper:F,makeRequest:u,authenticate:F(l,["loginValue","password","correlationId","conversationId","reporting"]),authenticateViaSocialNetwork:C,authenticateViaBlueCookie:D,validate:F(E,["params","conversationId","correlationId","reporting"]),getBySwid:_,updateBySwid:N,createAccountMappingBySwid:j,deleteBySwid:U,register:F(P,["guest","conversationId","correlationId","optionalConfigs","reporting"]),refreshAuthorization:L,notifyParentalApproval:R,notifyResolveMASE:F(y,["lookupValue","referenceId","conversationId","correlationId"]),notifyUpgradeNRT:F(M,["lookupValue","conversationId","correlationId"]),notifyRecoverUsername:F(w,["lookupValue","correlationId","conversationId","reporting"]),notifyRecoverPassword:F(b,["lookupValue","correlationId","conversationId","reporting"]),checkAuthorization:p,marketingOptionsGlobal:F(g,["profile","marketing","legalAssertions","sourceName","campaign","correlationId","conversationId","reporting"]),marketingOptionsGlobalProfile:F(h,["profile","marketing","legalAssertions","sourceName","correlationId","conversationId","reporting"]),clickbackMakePrimary:k,redeemLicensePlate:F(m,["activationCode","refreshToken","correlationId","conversationId","reporting"]),licensePlatePeek:F(v,["pairingCode","correlationId","conversationId","reporting"]),requestActivityPermission:O,checkActivityPermission:I,adultVerificationStatus:A,adultVerificationForm:S,adultVerificationQuiz:x,authenticateViaOboCookie:f,apiKey:T,configure:n,invalidateRefreshTokens:q,requestOtpAuthentication:F(V,["loginValue","conversationId","correlationId","reporting"]),requestOtpPhoneVerification:G,updatePhoneAndVerify:K,requestOtpRecovery:F(W,["phoneGuid","conversationId","correlationId","reporting"]),requestLoginRecoveryOtp:F(z,["recoveryType","data","conversationId","correlationId","reporting"]),verifyOtpCodeAuthentication:F(Y,["passcode","sessionId","conversationId","correlationId","reporting"]),verifyOtpCodePasswordRecover:F(X,["passcode","sessionId","conversationId","correlationId","reporting"]),verifyOtpCodePhoneVerification:H,getRecoveryMethods:F(Q,["loginValue","conversationId","correlationId","reporting"]),loginWithRecoveryToken:F($,["recoveryToken","swid","conversationId","correlationId","reporting"]),clickbackChangePassword:Z,activateSessionTransferKey:J,authenticateViaSessionTransferKey:F(ee,["sessionTransferKey","conversationId","correlationId","reporting"]),redeemOtpCode:F(X,["passcode","sessionId","conversationId","correlationId","reporting"])},3e4),ge={"Content-Type":"application/json","Cache-Control":"no-cache",Pragma:"no-cache",Expires:"-1"}}()},{"./request":55,"./response":56,"api-key":43,config:44,debug:10,exceptions:14,logger:15,messages:16,q:1,"session.apiKey":"session.apiKey","session.s2":"session.s2",utils:36}],54:[function(e,t,n){!function(){"use strict";t.exports=e("./dao")}()},{"./dao":53}],55:[function(e,t,n){function o(e,t,n,o,c){return i.debug("request#Request"),new s.Promise(function(s){function u(){i.debug("request#Request handleResponse");var e=h.statusText||"",n="response"in h?h.response:h.responseText,o=h.getAllResponseHeaders(),r=h.status;0===r&&(r=n?200:"file"===a(t).protocol?404:0),p(r,n,o,e)}function d(){i.debug("request#Request handleError"),p(-1,null,null,"","onerror")}function l(){i.debug("request#Request handleAbort"),p(-1,null,null,"","onabort")}function f(){i.debug("request#Request handleSetTimeout"),p(-1,null,null,"","setTimeout")}function p(e,t,n,o,a){i.debug("request#Request complete"),clearTimeout(g),s({status:e,response:t,headers:r(n),statusText:o,xhrFailureReason:a,xhrTimeout:h.timeout,xhrReadyState:h.readyState})}var g,h=new XMLHttpRequest;h.open(e,t,!0),Object.keys(o||{}).forEach(function(e){var t=o[e];"undefined"!=typeof t&&h.setRequestHeader((e||"").toLowerCase(),t)}),h.onload=u,h.onabort=l,h.onerror=d,h.send("undefined"!=typeof n?n:null),c&&(g=setTimeout(f,c))})}function r(e){return i.debug("request#parseHeaders"),(e||"").split("\n").map(function(e){var t=e.indexOf(":")||0;return[e.substr(0,t).trim(),e.substr(t+1).trim()]}).filter(function(e){return!!e[0]}).reduceNative(function(e,t){return e[t[0].toLowerCase()]=t[1],e},{})}var i=e("logger"),s=e("q");t.exports=o;var a=function(){i.debug("request#parseUrl");var e=document.createElement("a");return function(t){return e.href=t,{protocol:e.protocol,host:e.host,hostname:e.hostname,port:e.port,pathname:e.pathname,hash:e.hash,origin:e.origin||e.protocol+"//"+e.host,search:e.search}}}()},{logger:15,q:1}],56:[function(e,t,n){!function(){"use strict";function e(t,n,o){function r(){return n>=e.STATUS_INFORMATIONAL&&d(e.HEADER_CONTENT_TYPE)?n<e.STATUS_SERVER_ERROR&&0===d(e.HEADER_CONTENT_TYPE).split(e.DELIMITER_PARAMETER).indexOf(e.MEDIA_TYPE_JSON):!1}function i(){return n>=e.STATUS_CLIENT_ERROR&&n<e.STATUS_SERVER_ERROR}function s(){return t&&t.error?-1!==e.SERVER_ERRORS.indexOf(t.error.keyCategory):!1}function a(){return"number"!=typeof n||0>=n}function c(){return d(e.HEADER_ENTITY_TAG)||(t.data?t.data.etag:void 0)}function u(){return{responseData:t,contentTypeHeader:d(e.HEADER_CONTENT_TYPE)}}function d(e){var t;return"function"==typeof o&&(t=o(e)),Object.keys(o).forEach(function(n){n.toLowerCase()===e.toLowerCase()&&(t=o[n])}),t}this.data=null,this.error=null,this.isValid=r,this.status=n,this.isClientError=i,this.isServerError=s,this.isNetworkError=a,this.getIdentifier=c,this.getResponseDebug=u,this.headers=o,this.isValid()&&"object"==typeof t?(this.data=t.data||null,this.error=t.error||null):n>=e.STATUS_SERVER_ERROR&&t&&(this.error=t.error||null)}t.exports=e,e.DELIMITER_PARAMETER=";",e.MEDIA_TYPE_JSON="application/json",e.HEADER_ENTITY_TAG="ETag",e.HEADER_CONTENT_TYPE="Content-Type",e.STATUS_INFORMATIONAL=100,e.STATUS_CLIENT_ERROR=400,e.STATUS_SERVER_ERROR=500,e.SERVER_ERRORS=["GC_CODE_OR_CONFIG_ERROR","SYSTEM_UNAVAILABLE","UNKNOWN_ERROR","SERVICE_UNAVAILABLE"]}()},{}],57:[function(e,t,n){!function(){"use strict";function e(){return o}function n(e){return-1!==o.indexOf(e)}t.exports={get:e,isValid:n};var o=["ar-XX","da-DK","de-DE","en-AU","en-US","es-ES","es-LA","fi-FI","fr-FR","id-ID","it-IT","ja-JP","ko-KR","ms-MY","nl-NL","nn-NO","pl-PL","pt-BR","ru-RU","sv-SE","th-TH","tl-PH","vi-VN","zh-CN","zh-HK"]}()},{}],58:[function(e,t,n){!function(){"use strict";function n(e){return(e||[]).reduce(function(e,t){return e[t.code]=t.subscribed,e},{})}function o(e){return(e||[]).reduce(function(e,t){return t.textID&&(e[t.code]=t.textID),e},{})}function r(e,t){var n=Object.keys((t||{}).proxy||{});return 0===n.length&&n.push(e),n}function i(e){return(e||[]).reduce(function(e,t){return e[t.code]=t,e},{})}function s(e){return(v.get(e,"proxySplitRules")||[]).reduce(function(e,t){return e[t]=!0,e},{})}function a(e,t){return u(e||{}).forEach(function(n){-1===(t||[]).indexOf(n)&&p(e,n)}),e}function c(e,t){return(t||[]).forEach(function(t){p(e,t)}),e}function u(e){var t=[];return Object.keys(e||{}).forEach(function(n){e[n].proxy?Object.keys(e[n].proxy).forEach(function(e){t.push(e)}):t.push(n)}),t}function d(e){var t=Object.keys(e||{});return 0===t.length||t.every(function(t){return e[t].checked===!0})}function l(e){return Object.keys(e).map(function(t){return{name:t,data:e[t]}})}function f(e,t){Object.keys(e[t].proxy||{}).forEach(function(n){e[n]=e[t].proxy[n]}),delete e[t]}function p(e,t){function n(e,t){return-1!==Object.keys(e).indexOf(t)}e=e||{},Object.keys(e).forEach(function(o){e[o].proxy&&n(e[o].proxy,t)&&f(e,o)}),n(e,t)&&delete e[t]}function g(e){Object.keys(e||{}).forEach(function(t){e[t].checked=!1,e[t].proxy&&g(e[t].proxy)})}function h(e,t,n,o){var r=i(v.clone(t));return(e=v.clone(e))?("UPDATE"===n&&g(e),Object.keys(e).forEach(function(t){if(e[t].proxy){for(var i=!1,a=[],c=s(e[t]),u=l(e[t].proxy),d=0;d<u.length;d++)r.hasOwnProperty(u[d].name)&&(o?(i=!0,"PARTIAL"===n&&a.push(u[d].name)):((c.RECORDED||c.DECLINE&&u[d].data.checked===!1)&&(i=!0),c.DONT_SHOW_RECORDED&&a.push(u[d].name)));i===!0&&f(e,t),a.forEach(function(t){p(e,t)})}}),e):{}}function m(e,t){var n=i(t);return Object.keys(e).forEach(function(t){var o=e[t],r=v.get(n,[t,"subscribed"].join(".")),i="object"==typeof o;if(void 0!==r&&i&&(o.checked=r),o.proxy){var s;(l(o.proxy)||[]).forEach(function(e){var t=e.name,r=e.data;s?r.order<s&&(s=r.order):s=r.order,o.order=s,n.hasOwnProperty(t)&&(r.checked=v.get(n,[t,"subscribed"].join("."))===!0)}),i&&(o.checked=d(o.proxy))}}),e}var v=e("../../common/utils");t.exports={getOptInOptOutLists:n,getOptInOptOutTextIds:o,getListNames:r,getInclusionList:a,getExclusionList:c,getAllListNames:u,splitLists:h,applyMarketingValues:m}}()},{"../../common/utils":36}],59:[function(e,t,n){"use strict";var o=e("./config"),r=e("logger"),i=e("messages"),s=e("./metricsUtil"),a=e("utils");t.exports=function(){i.subscribe("metrics.log.send",function(e){var t=a.clone(e);s.throttle(t.action_name)||s.processLog(t).then(function(e){e=s.removeInvalidFields(e);var t=s.hasAllRequiredFields(e);t.valid?o.options.handleSendLogs(e):Array.isArray(t.missing)&&r.error('Missing required fields "'+t.missing.join(", ")+'"')})})}},{"./config":61,"./metricsUtil":65,logger:15,messages:16,utils:36}],60:[function(e,t,n){"use strict";function o(e,t,n){"string"==typeof e?i(c.assign({action_name:e,success:!n},c.clone(t||{}))):s.error('Invalid action name: "'+e+'." Must be of type string.')}function r(e,t){o(e,t,!0)}function i(e,t){a.publish("metrics.log.send",e,t)}var s=e("logger"),a=e("messages"),c=e("utils");t.exports={log:o,error:r,send:i}},{logger:15,messages:16,utils:36}],61:[function(e,t,n){"use strict";t.exports={webLogUrl:"//log.go.com/log",attributes:{},testClients:["DISNEYID-UI.TEST","DMA-DISMOVANY.XONELB"],options:{handleSendLogs:function(){}}}},{}],62:[function(e,t,n){"use strict";var o=50;t.exports={codes:{NOT_INITIALIZED:{category:"FAILURE_BY_DESIGN",code:"ONEID_NOT_YET_INITIALIZED"},SESSION_NOT_ESTABLISHED:{category:"FAILURE_BY_DESIGN",code:"SESSION_NOT_ESTABLISHED"},READ_TOKEN_FAILURE:{category:"UNKNOWN_ERROR",code:"READ_TOKEN_FAILURE"},UNKNOWN:{category:"UNKNOWN",code:"UNKNOWN_ERROR"}},throttling:{"api:setdonotdisturb":2,"api:getactivitystatus":2,"api:getguestdata":2,"api:getguestnewsletters":2,"api:getloggedinstatus":2,"api:gettruststatestatus":2,"api:init":2,"event:init":2,"log:ui:close":o},actions:{api:{forceTokenRefresh:"api:forcetokenrefresh",getActivityStatus:"api:getactivitystatus",getEditableProfileFields:"api:geteditableprofilefields",getGuest:"api:getguestdata",getGuestNewsletters:"api:getguestnewsletters",
getLoggedInStatus:"api:getloggedinstatus",getTrustStateStatus:"api:gettruststatestatus",getLicensePlateDataBag:"api:getLicensePlateDataBag",init:"api:init",launchAdultVerification:"api:launch:adultverification",launchDisplayName:"api:launch:displayname",launchLicensePlate:"api:launch:licenseplate",launchLogin:"api:launch:login",launchNewsletters:"api:launch:newsletters",launchProfile:"api:launch:profile",launchReauth:"api:launch:reauth",launchRecoverUsername:"api:launch:recoverusername",launchRegistration:"api:launch:registration",launchRequestActivity:"api:launch:requestactivity",launchResetPassword:"api:launch:resetpassword",launchSocialRegistration:"api:launch:socialregistration",logout:"api:logout",redeemLicensePlateCode:"api:redeemlicenseplatecode",doNotDisturb:"api:setdonotdisturb",setEditableProfileFields:"api:seteditableprofilefields"},event:{adultVerificationForm:"event:adultverificationform",adultVerificationStatus:"event:adultverificationstatus",adultVerificationQuiz:"event:adultverificationquiz",create:"event:create",createFB:"event:create:fb",createGoogle:"event:create:google",deactivateAccount:"event:deactivateaccount",deactivateAccountBlocked:"event:deactivateaccountblocked",dobInterstitial:"event:dobinterstitial",externalLink:"event:externallink",getrecoverymethods:"event:getrecoverymethods",init:"event:init",getPasswordRecoveryMethods:"event:getpasswordrecoverymethods",getLicensePlateDataBag:"event:getlicenseplatedatabag",licensePlateChangeAccount:"event:licenseplatechangeaccount",licensePlateRedeemed:"event:licenseplateredeemed",login:"event:login",loginBlue:"event:login:blue",loginFB:"event:login:fb",loginGoogle:"event:login:google",loginObo:"event:login:obo",loginSessionTransfer:"event:login:sessiontransfer",loginTouchId:"event:login:touchid",loginWithRecoveryToken:"event:login:otprecovery",logout:"event:logout",logoutAccountDeactivated:"event:logout:accountdeactivated",logoutApi:"event:logout:api",logoutGetGuest:"event:logout:getguest",logoutInit:"event:logout:init",logoutInOtherTab:"event:logout:loggedoutinothertab",logoutInvalidAccessAndRefreshToken:"event:logout:invalidaccessandrefreshtoken",logoutInvalidRefreshToken:"event:logout:invalidrefreshtoken",logoutPasswordAttemptsFailed:"event:logout:passwordattemptsfailed",logoutReauthChangeAccount:"event:logout:reauthchangeaccount",logoutRefreshFailed:"event:logout:refreshfailed",logoutTokenDataDeleted:"event:logout:tokendatadeleted",logoutUnknown:"event:logout:unknown",migration:"event:migration",newsletters:"event:newsletters",otpRecoverPasswordLogin:"event:login:otprecovery",otpResetPassword:"event:update:otpresetpassword",ppu:"event:ppu",preinit:"event:preinit",reauth:"event:reauth",recaptcha:"event:recaptcha",recoverUsername:"event:recoverusername",redeemOtpCode:"event:redeemOtpCode",refresh:"event:refresh",resetPassword:"event:resetpassword",requestOtpAuthentication:"event:requestOtpAuthentication",requestOtpEmail:"event:requestOtp:email",requestOtpSms:"event:requestOtp:sms",requestOtpPhoneVerification:"event:requestOtpPhoneVerification",requestOtpRecovery:"event:requestOtpRecovery",serviceError:"event:serviceerror",sessionTransferActivate:"event:sessiontransfer:activate",sessionTransferRedeem:"event:sessiontransfer:redeem",tokenRefresh:"event:token:refresh",update:"event:update",updateAddress:"event:update:address",updateDisplayName:"event:update:displayname",updatePhoneRequestOtpPhoneVerification:"event:updatePhoneRequestOtpPhoneVerification",updatePPU:"event:update:ppu",verifyOtpCodeAuthentication:"event:login:otp",verifyOtpCodePasswordRecover:"event:verifyOtpCodePasswordRecover",verifyOtpCodePhoneVerification:"event:verifyOtpCodePhoneVerification"}},validLogFields:["action_name","anon","appid","client_id","connection_type","context","conversation_id","correlation_id","direct_flow_version","error_category","error_codes","info","make_model","os","process_time","reporting","sdk_version","source","success","swid","timestamp","user_agent","unid","trace","trace_data"],requiredLogFields:["action_name","anon","client_id","appid","success","swid","timestamp"]}},{}],63:[function(e,t,n){"use strict";var o=e("./constants"),r=e("./attatchSubscribers"),i=e("./init"),s=e("./timed"),a=e("./basicLogTypes"),c=e("./config");t.exports={init:i,actions:o.actions,codes:o.codes,attachSubscribers:r,error:a.error,log:a.log,send:a.send,timed:s,setReportingProperties:function(e){c.attributes.reporting=e},setWebLogUrl:function(e){c.webLogUrl=e},setClientId:function(e){c.attributes.client_id=e}}},{"./attatchSubscribers":59,"./basicLogTypes":60,"./config":61,"./constants":62,"./init":64,"./timed":67}],64:[function(e,t,n){"use strict";var o=e("./config"),r=e("utils");t.exports=function(e,t){r.assign(o.attributes,e),"function"==typeof t&&(o.options.handleSendLogs=t)}},{"./config":61,utils:36}],65:[function(e,t,n){"use strict";function o(e){e=("string"==typeof e?e:"").toLowerCase();var t=d.throttling[e];return"number"==typeof t?!m.randomChance(t/100):!1}function r(e){var t=m.immutableAssign(m.get(u,"attributes.info")||{},m.get(e,"info")),n=m.immutableAssign(u.attributes||{},e),o=m.clone(m.get(n,"reporting")||m.get(u.attributes,"reporting")||{});return Object.keys(t)&&(n.info=t),"object"==typeof o&&(o.context&&(n.context=o.context,delete o.context),o.source&&(n.source=o.source,delete o.source),Object.keys(o).length?n.reporting=m.formatLogInfoBlock(o):delete n.reporting),n.hasOwnProperty("error_codes")&&"string"!=typeof n.error_codes&&!Array.isArray(n.error_codes)&&(n.error_codes=d.codes.UNKNOWN.code,n.error_category||(n.error_category=d.codes.UNKNOWN.category)),n.error_codes&&(Array.isArray(n.error_codes)&&(n.error_codes=n.error_codes.join()),n.error_codes=n.error_codes.replace(/\s/g,"_"),n.error_codes=s(i(n.error_codes)),n.error_codes&&!n.error_category&&(n.error_category="FAILURE_BY_DESIGN")),"number"!=typeof n.process_time&&(n.process_time=1),"boolean"!=typeof n.success&&(n.success=!0),n.success=n.success.toString(),n.timestamp=(new Date).toISOString(),n.conversation_id=n.conversation_id||m.uuid(),n.correlation_id=n.correlation_id||m.uuid(),h.allSettled([f.read(),p.read(),g.read()]).spread(function(e,t,o){var r=m.get(o,"value.unid");return"string"!=typeof n.swid&&(n.swid="rejected"===e.state?t.value.swid:e.value.token.swid),"boolean"!=typeof n.anon&&(n.anon=!/{/.test(n.swid)),n.anon=n.anon.toString(),r&&(n.unid=r),(n.action_name===d.actions.event.tokenRefresh||0===n.action_name.indexOf("log:"))&&(n.info=m.immutableAssign({cookieLength:t.value.cookieLength},n.info||{})),m.isObject(n.info)&&(n.info=m.formatLogInfoBlock(n.info)),n})}function i(e){var t=e.split(",");return t.sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0}),t}function s(e){var t=e.reduceNative(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[]);return t.join()}function a(e){if(!m.isObject(e)&&!Array.isArray(e))return e;var t=Object.keys(e).reduceNative(function(t,n){var o=e[n];return-1===d.validLogFields.indexOf(n)?t.invalid.push(n):t.valid[n]=o,t},{valid:{},invalid:[]});return t.invalid.length>0&&l.error("Invalid fields: {"+t.invalid.join(", ")+"} are not allowed in a metrics log."),t.valid}function c(e){if(!m.isObject(e)&&!Array.isArray(e))return{valid:!1,missing:[]};var t=d.requiredLogFields.reduceNative(function(t,n){return e.hasOwnProperty(n)||t.push(n),t},[]);return{valid:0===t.length,missing:t}}{var u=e("./config"),d=e("./constants"),l=(e("../outer/environment"),e("logger")),f=(e("messages"),e("session.token")),p=e("session.swid"),g=e("session.unid"),h=e("q"),m=e("utils");e("cookie")}t.exports={throttle:o,processLog:r,sortLog:i,dedup:s,removeInvalidFields:a,hasAllRequiredFields:c}},{"../outer/environment":71,"./config":61,"./constants":62,cookie:9,logger:15,messages:16,q:1,"session.swid":"session.swid","session.token":"session.token","session.unid":"session.unid",utils:36}],66:[function(e,t,n){"use strict";function o(e){return r.testClients.some(function(t){return e.replace(/\-(PROD|QA|STAGE|VAL)$/g,"")===t})}{var r=(e("utils"),e("../config"));e("../constants")}t.exports=function(e){var t=!1;(t||o(e.client_id))&&(window.__metrics__=(window.__metrics__||[]).concat([e]));var n=Object.keys(e).reduceNative(function(t,n){var o=e[n];return"object"==typeof val&&(o=JSON.stringify(o)),t.push(n+"="+encodeURIComponent(o)),t},[]).sort().join("&"),i=r.webLogUrl+"?"+n,s=new XMLHttpRequest;s.open("GET",i),s.withCredentials=!0,s.send(null)}},{"../config":61,"../constants":62,utils:36}],67:[function(e,t,n){"use strict";var o=e("./basicLogTypes"),r=e("utils");t.exports=function(e,t,n){function i(t,n){s.process_time=Date.now()-a,("boolean"==typeof n?n:!0)?o.log(e,r.assign({},s,t||{})):o.error(e,r.assign({},s,t||{}))}var s=r.isObject(t)?t:{},a="number"==typeof n?n:Date.now();return{error:function(e){i(e,!1)},send:i,success:function(e){i(e)}}}},{"./basicLogTypes":60,utils:36}],68:[function(e,t,n){!function(){"use strict";function n(){c.log("AgebandCountryCookie#read");var e=u.read(i())||"",t=d[e.substring(0,1)],n=e.substring(1);return e&&t&&n?{ageBand:t,countryCode:n}:null}function o(e){c.log("AgebandCountryCookie#write");var t,n=l[s.get(e,"profile.ageBand")||""],o=s.get(e,"profile.region")||s.get(e,"profile.countryCodeDetected"),r=n+o;return n&&o?(t=new Date,t.setFullYear(t.getFullYear()+33),u.write(i(),r,a.getCookieDomain(),"/",t,!1),!0):(c.debug("Failed to write country/ageband cookie"),!1)}function r(){c.log("AgebandCountryCookie#remove"),u.remove(i(),a.getCookieDomain(),"/")}function i(){return a.getClientId()+"-ac"}t.exports={read:n,write:o,remove:r};var s=e("utils"),a=e("../environment"),c=e("logger"),u=e("cookie"),d={X:"ADULT",Y:"TEEN",Z:"CHILD"},l={ADULT:"X",TEEN:"Y",CHILD:"Z"}}()},{"../environment":71,cookie:9,logger:15,utils:36}],69:[function(e,t,n){"use strict";var o=e("messages");t.exports={view:o.publish.bind(o,"analytics.view"),link:o.publish.bind(o,"analytics.link")}},{messages:16}],70:[function(e,t,n){!function(){"use strict";function n(){var e=o.defer();return r.publish("siteconfig.read",null,e),i.promise.timeout(e,9e4),e.promise}var o=e("../../../../assets/common/js/q"),r=e("messages"),i=e("utils");t.exports={getSite:n}}()},{"../../../../assets/common/js/q":1,messages:16,utils:36}],71:[function(e,t,n){!function(){"use strict";function n(e,t){var n;S.assign(C,e),C.isDirectFlow=!!S.get(t,"isDirectFlow"),_=e.origin||(document.querySelector('script[src$="/outer/DisneyID.js"]')||{}).src||(document.getElementById("disneyid-script")||{}).src||document.location.href,C.environment=T.getEnvironmentFromUrl(_),n=S.url.getHostName(_),b=y(f()),k=-1===location.protocol.toLowerCase().indexOf("https")?"http":"https",C.cookieDomain?E=C.cookieDomain:e.responderPage&&(E=v(C.outerDomain,S.url.getHostName(e.responderPage))),I=!!C.blueCookie,A.subscribe("env.correlation.read",function(e,t){t.resolve(C.correlationId)})}function o(){return b}function r(){return k}function i(){return I}function s(){return"undefined"==typeof C.clientId||T.clientIdHasSuffix(C.clientId)?C.clientId:[C.clientId,T.getClientIdEnvironment(C.environment)].join("-")}function a(){return T.getClientIdEnvironment(T.getClientIdSuffix(s()))}function c(){return C.correlationId}function u(e){C.correlationId=e}function d(){return C.correlationIdTimeStamp}function l(){return C.langPref}function f(){function e(e,t){var n=t[e];try{delete t[e]}catch(o){}return n}var t=S.clone(p()),n=e("clientId",t),o=e("langPref",t),r=e("l10nContent",t),i=r?"content="+r+"&":"",s=_.replace("outer/DisneyID.js",n+"/"+o+"?include=config,l10n,js,html&"+i)+S.buildQueryString(t);return R.debug("Lightbox Path: "+s),R.debug("Lightbox Params",t),s}function p(){var e,t=a();e="STAGE"===t?"STG":"VALID"===t?"VAL":t;var n=S.assign({clientId:s(),scheme:window.location.protocol.replace(":",""),postMessageOrigin:location.href,cookieDomain:E,config:e,logLevel:R.getLogLevel(),topHost:document.location.host||""},O.read()||{});["l10nContent","langPref","countryPref","continentPref","cssOverride","debug","responderPage","successPageAfterCreate","siteURL"].forEach(function(e){C[e]&&(n[e]=C[e])});var o=x.getCountry();o&&(n.countryCode=o);var r=x.getGeoIP();return r&&(n.geoIP=r),C.marketingMode&&(n.marketingMode=C.marketingMode),n.buildId=N,n}function g(e,t){var n,o,r={};return(e=e||C.responderPage)?(S.assign(r,S.getQueryStringParams(e),p(),t||{}),n=e.match(/(^[^\?]*)?(\?[^#]*)?(#.*$)?/),o=n[1]+"?",o+=S.buildQueryString(r),n[3]&&(o+=n[3]),o):void 0}function h(){return C.migrationResponderPage?g(C.migrationResponderPage,{"espn-migration":!0}):void 0}function m(){return E}function v(e,t){for(var n=e.split(".").reverse(),o=t.split(".").reverse(),r=[],i=0;i<Math.min(n.length,o.length)&&n[i]===o[i];i++)r.push(n[i]);return r.length>1?r.reverse().join("."):null}function y(e){var t=document.createElement("a");return t.setAttribute("href",e),t.protocol+"//"+t.host}function w(){return C.isDirectFlow}t.exports={init:n,getOrigin:o,getProtocol:r,getPath:f,getClientId:s,setCorrelationId:u,getClientIdEnvSuffix:a,getCorrelationId:c,getCorrelationIdTimeStamp:d,getCookieDomain:m,getLangPref:l,getResponderPageUrl:g,getMigrationResponderPageUrl:h,blueCookieEnabled:i,getStandardQueryParams:p,isDirectFlow:w};var b,k,E,_,I,A=e("messages"),S=e("../common/utils"),x=e("debug"),T=e("../common/environment-helper"),O=e("./ageband-country-cookie"),R=e("logger"),N=e("../common/build-identifier"),C={langPref:"en-US"}}()},{"../common/build-identifier":8,"../common/environment-helper":11,"../common/utils":36,"./ageband-country-cookie":68,debug:10,logger:15,messages:16}],72:[function(e,t,n){!function(){"use strict";function n(e){return f.log("espn/migration#init"),m++,m>1?(2===m&&g.error("log:migration.responder.mismatch",{client_id:e.clientId}),!1):(y=d.subscribe("migration.session.found",function(t){f.debug("OneID session found by migration responder"),r(t,e.cookieDomain,e.onMigrationSuccess)}),w=d.subscribe("migration.session.notfound",function(t){if(f.debug("OneID session not found by migration responder"),t&&t.navy){var n=p.defer();f.debug("NAVY cookie found. Attempting to reconstitute session.");var o=l.getTLD(""+window.location.hostname),r=new Date;r.setFullYear(r.getFullYear()+1),h.write("oidNAVY",t.navy,"."+o,"/",r,!1),d.publish("bluecookie.authenticate",{blue:t.navy},n),n.promise.then(function(){e.onMigrationSuccess()},function(){e.onMigrationFailure()})}else e.onMigrationFailure()}),void o(e.responderPage))}function o(e){u=document.createElement("iframe"),u.setAttribute("id","disneyid-secure-migration-responder"),u.setAttribute("name","disneyid-secure-migration-responder"),u.setAttribute("src",e),u.style.display="none",document.body.appendChild(u)}function r(e,t,n){f.log("espn/migration#handleSessionFound");var o=(p.defer(),p.defer(),new Date);v=!0,o.setFullYear(o.getFullYear()+33),Object.keys(e.cookies).forEach(function(n){var r=n.indexOf(".token")>-1||n.indexOf(".idn")>-1,i=n.toLowerCase().indexOf("swid")>-1||n.indexOf("oidNAVY")>-1?l.getTLD(window.location.hostname):t;"swid"===n.toLowerCase()&&(c=e.cookies[n]),h.write(n,e.cookies[n],i,"/",o,r)}),f.debug("OneID session cookies copied to ."+t),n()}function i(){return v}function s(){return c}function a(){u&&u.parentElement&&u.parentElement.removeChild(u),v=!1,m=0,y(),w()}var c,u,d=e("messages"),l=e("../../../common/utils"),f=e("logger"),p=e("q"),g=e("metrics"),h=e("cookie"),m=0,v=!1,y=function(){},w=function(){};t.exports={init:n,isMigratingSession:i,getSwid:s,cleanup:a}}()},{"../../../common/utils":36,cookie:9,logger:15,messages:16,metrics:63,q:1}],73:[function(e,t,n){"use strict";function o(e){var t=i.defer(),n=c.timed(c.actions.event.getLicensePlateDataBag,{correlation_id:e.correlationId,conversation_id:e.conversationId,reporting:e.reporting});return s.licensePlatePeek(e.pairingCode,e.correlationId,e.conversationId,e.reporting).then(function(e){e.isClientError()?t.reject(r(e,n)):(d.link({lplate_peek_success:!0}),n.success(),t.resolve(e.data.content))},function(e){t.reject(r(e,n))}),t.promise}function r(e,t){var n=a.getKeyErrors(e)||[],o="UNKNOWN_ERROR",r={error_category:u.get(e,"error.keyCategory"),error_codes:a.getErrorCodes(n)};return(a.find(n,"MISSING_VALUE")||a.find(n,"INVALID_VALUE"))&&(o="INVALID_PAIRING_CODE"),e.isServerError()?t.error(r):t.success(r),d.link({lplate_peek_error:!0}),o}var i=e("q"),s=e("dao"),a=e("exceptions"),c=e("metrics"),u=e("utils"),d=e("../analytics");t.exports={peek:o}},{"../analytics":69,dao:54,exceptions:14,metrics:63,q:1,utils:36}],74:[function(e,t,n){!function(){"use strict";function n(){return r}function o(e){function t(e,t,n){var o={datadfd:function(e){s.subscribe(e,function(n,o){r.send(t,e,n,o)})},data:function(e){s.subscribe(e,function(n){r.send(t,e,n)})},nulldfd:function(e){s.subscribe(e,function(n,o){r.send(t,e,null,o)})},"default":function(e){s.subscribe(e,function(){r.send(t,e)})}};e&&o.hasOwnProperty(e)||(e="default"),n.forEach(o[e])}function n(e,t){var n={datadfd:function(e){r.on(e,function(t,n){s.publish(e,t,n)})},data:function(e){r.on(e,function(t){s.publish(e,t)})},nulldfd:function(e){r.on(e,function(t,n){s.publish(e,null,n)})},"default":function(e){r.on(e,function(){s.publish(e)})}};e&&n.hasOwnProperty(e)||(e="default"),t.forEach(n[e])}i=e,r=new a(c.CLIENT),r.frames=c,r.registerChild(r.frames.LIGHTBOX,i.getOrigin()),r.registerChild(r.frames.RESPONDER,"*"),r.registerChild(r.frames.MIGRATION_RESPONDER,"*"),t("datadfd",r.frames.RESPONDER,["responder.session.write","responder.session.read","responder.guest.identifier.write","responder.guest.identifier.read","responder.dateOfBirth.write","responder.authenticator.write","responder.apikey.write","responder.obo.read","responder.obo.delete"]),t("nulldfd",r.frames.RESPONDER,["responder.session.delete","responder.dateOfBirth.read","responder.authenticator.read","responder.apikey.read"]),t("datadfd",r.frames.LIGHTBOX,["bluecookie.authenticate","bluecookie.delete","inner.setRoute","guest.reload","authReloader.reloadIfChanged","workflow.run","workflow.execute"]),t("data",r.frames.LIGHTBOX,["analytics.view","analytics.link","debug.geoIP","debug.country","debug.testProfileFlag","debug.clientConfigOverride","debug.epcEnabled","setLogLevel"]),t("nulldfd",r.frames.LIGHTBOX,["siteconfig.read"]),t(null,r.frames.LIGHTBOX,["session.deleted","debug.clear","logger.enable"]),s.subscribe("lightbox.show",function(){r.send(r.frames.LIGHTBOX,"lightbox.show",void 0)}),n("datadfd",["profile.deactivation-complete","apiEvent.ppu","env.correlation.read","session.loggedin","lightbox.showError"]),n("data",["metrics.log.send","cookielength","session.found","session.notfound","migration.session.found","migration.session.notfound","profile.create","profile.primary-account","session.refreshed","token.refreshed","config.ready","marketing.opt-in","guest.updated","license-plate.link-success","license-plate.link-failure"]),n("nulldfd",["session.reauth","apiEvent.reauth","doNotDisturb.isEnabled"]),n(null,["lightbox.hide","license-plate-redeemed","lightbox.heartbeat","inner.fatal","session-timer.pause","session-timer.unpause"]),r.on("lightbox.requestshow",function(e){s.publish("lightbox.show",e)}),r.on("session.isloggedin",function(e,t){u.isLoggedIn().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("s2cookie.write",function(e,t){u.s2.write(e).then(t.resolve.bind(t),t.reject.bind(t))}),r.on("s2cookie.delete",function(e,t){u.s2["delete"](e).then(t.resolve.bind(t),t.reject.bind(t))}),r.on("guest.write",function(e,t){u.guest.write(e).then(t.resolve.bind(t),t.reject.bind(t))}),r.on("guest.read",function(e,t){u.guest.read().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("token.write",function(e,t){u.token.write(e).then(t.resolve.bind(t),t.reject.bind(t))}),r.on("token.read",function(e,t){u.token.read().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("session.delete",function(e,t){u.deleteAll(e).then(t.resolve.bind(t),t.reject.bind(t))}),r.on("session.invalidateTokens",function(e,t){u.invalidateTokens(e).then(t.resolve.bind(t),t.reject.bind(t))}),r.on("session.dateOfBirth.write",function(e,t){u.dob.write(e).then(t.resolve.bind(t),t.reject.bind(t))}),r.on("session.dateOfBirth.read",function(e,t){u.dob.read().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("session.authenticator.read",function(e,t){u.authenticator.read().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("session.apikey.read",function(e,t){u.apiKey.read().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("trustState.write",function(e,t){u.trustState.write(e).then(t.resolve.bind(t),t.reject.bind(t))}),r.on("trustState.read",function(e,t){u.trustState.read().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("trustState.readHighestEspnTs",function(e,t){u.trustState.readHighestEspnTs().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("trustState.delete",function(e,t){u.trustState["delete"]().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("swid.read",function(e,t){u.swid.read().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("unid.read",function(e,t){u.unid.read().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("navy.read",function(e,t){u.navy.read().then(t.resolve.bind(t),t.reject.bind(t))}),r.on("session.authenticator.write",function(e,t){u.authenticator.write(e).then(t.resolve.bind(t),t.reject.bind(t))}),r.on("session.apikey.write",function(e,t){u.apiKey.write(e).then(t.resolve.bind(t),t.reject.bind(t))}),r.on("session.deleted[source=inner,target=outer]",function(e,t){s.publish("session.deleted",e,t)}),r.init()}t.exports={init:o,getPMT:n};var r,i,s=e("messages"),a=e("../../common/postmessage-transport"),c=e("../../common/postmessage-transport/frames"),u=e("session")}()},{"../../common/postmessage-transport":20,"../../common/postmessage-transport/frames":19,messages:16,session:"session"}],75:[function(e,t,n){!function(){"use strict";function n(){var e=r.defer();return r.spread([i.guest.read(),o.getSite()],function(t,n){e.resolve(a.getEditableAndRequiredFields(s.get(t,"guest"),n))},function(t){e.reject(t)}),e.promise}var o=e("../../../components/outer/config"),r=e("q"),i=e("session"),s=e("utils"),a=e("../../../components/common/progressive-profile-collection");t.exports={get:n}}()},{"../../../components/common/progressive-profile-collection":25,"../../../components/outer/config":70,q:1,session:"session",utils:36}],76:[function(e,t,n){!function(){"use strict";function n(){f.subscribe("session.loggedin",r),f.subscribe("session.deleted",i)}function o(){f.unsubscribe("session.deleted",i),f.unsubscribe("session.loggedin",r)}function r(){u=!0}function i(){u=!1}function s(){l.log("RefreshTimer#startTimer"),p.isLoggedIn().then(function(e){u=e,a()})}function a(){clearTimeout(c);var e=m.get("session-state-tasks"),t=new h(e);e.on("done",function(){c=setTimeout(a,d)}),e.run(null,{loggingInfo:{correlationId:g.uuid(),context:"session-timer",breadcrumbs:t},wasLoggedIn:u})}var c,u,d=1e4,l=e("logger"),f=e("messages"),p=e("session"),g=e("utils"),h=e("WorkflowHistory"),m=e("../workflow-manager");t.exports={start:s},n(),f.subscribe("session-timer.pause",function(){o(),clearTimeout(c)}),f.subscribe("session-timer.unpause",function(){o(),n(),p.isLoggedIn().then(function(e){u=e,a()})})}()},{"../workflow-manager":98,WorkflowHistory:40,logger:15,messages:16,session:"session",utils:36}],77:[function(e,t,n){"use strict";var o=e("./shim");t.exports={read:o("responder.authenticator.read"),write:o("responder.authenticator.write")}},{"./shim":87}],78:[function(e,t,n){"use strict";var o=e("./shim");t.exports={"delete":o("bluecookie.delete")}},{"./shim":87}],79:[function(e,t,n){"use strict";var o=(e("./shim"),e("messages")),r=e("../ageband-country-cookie"),i=e("q"),s={blueCookie:e("./blue-cookie"),trustState:e("./trust-state"),token:e("./token"),guest:e("./guest"),s2:e("./s2"),navy:e("./navy")};t.exports=function(e){var t={};"string"==typeof e?t.reason=e:"object"==typeof e&&(t=e);var n=i.defer();return i.all([s.blueCookie["delete"](),s.trustState["delete"](),s.s2["delete"](),s.token["delete"](),s.guest["delete"](),s.navy["delete"]()])["finally"](function(){r.remove(),t.suppressLogoutEvent||o.publish("session.deleted",t.reason),n.resolve()}),n.promise}},{"../ageband-country-cookie":68,"./blue-cookie":78,"./guest":81,"./navy":85,"./s2":"session.s2","./shim":87,"./token":"session.token","./trust-state":88,messages:16,q:1}],80:[function(e,t,n){"use strict";var o=e("./shim");t.exports={read:o("responder.dateOfBirth.read"),write:o("responder.dateOfBirth.write")}},{"./shim":87}],81:[function(e,t,n){"use strict";function o(e){e=e||{};var t=g.getClientId(),n=v.defer(),o=e.token?v.resolve(e):f.read(),r=e.identifier?v.resolve(e.identifier):p.read();return v.spread([r,o],function(e,o){var r=a(e,m.get(o,"token.access_token"),t);m.get(r,"guest.token")&&delete r.guest.token,m.get(r,"guest.profile")?n.resolve(r):n.reject()},function(){n.reject()}),n.promise}function r(e,t){function n(){var t=m.get(e,"token.access_token")?v.resolve(e):f.read();t.then(function(t){var n=s(e,m.get(t,"token.access_token"),o);l.write(m.get(e,"guest")),p.write(n)["finally"](function(){r.resolve()})})}var o=g.getClientId(),r=v.defer();return m.get(e,"guest")?(t?f.write(e).then(n):n(),r.promise):v.resolve()}function i(){return c(g.getClientId()),v.resolve()}function s(e,t,n){var o={guest:e.guest,created:(new Date).toISOString()},r=u(o,t);try{localStorage.setItem(n+".guest",r.data)}catch(i){}return r.checksum}function a(e,t,n){var o;try{o=localStorage.getItem(n+".guest")}catch(r){}return d(""+e,t,o)}function c(e){try{localStorage.removeItem(e+".guest")}catch(t){}}function u(e,t){var n=m.clone(e),o=JSON.stringify(n),r=m.crc32(JSON.stringify({guest:e.guest})).toString(16);return{data:h.encrypt(r+t,o),checksum:y+r}}function d(e,t,n){var o;try{o=JSON.parse(h.decrypt(e.substring(y.length)+t,n))}catch(r){return null}return o}t.exports={read:o,write:r,"delete":i};var l=e("../ageband-country-cookie"),f=e("./token"),p=e("./idn"),g=e("../environment"),h=e("../../../../assets/common/js/sjcl"),m=(e("messages"),e("utils")),v=e("q"),y="00"},{"../../../../assets/common/js/sjcl":2,"../ageband-country-cookie":68,"../environment":71,"./idn":82,"./token":"session.token",messages:16,q:1,utils:36}],82:[function(e,t,n){"use strict";var o=e("./shim");t.exports={read:o("responder.guest.identifier.read"),write:o("responder.guest.identifier.write")}},{"./shim":87}],83:[function(e,t,n){"use strict";function o(e,t,n){n=n||s.uuid(),t=t||s.uuid();var o={called_gc_logout_endpoint:!1},d=i.timed("log:logout",{correlation_id:t,conversation_id:n});return a.fcall(function(){var i=[],a=[];return Object.keys(e).forEach(function(t){var n=e[t];-1===a.indexOf(n.swid)&&a.push(n.swid),i.push({token:n.refresh_token||n.access_token,clientId:t})}),a.length>1&&(o.multiple_tokens_swids=!0),o.refresh_token_count=i.length,o.refresh_tokens=i.map(function(e){return s.maskToken(e.token)}),o.called_gc_logout_endpoint=!0,r.invalidateRefreshTokens(a[0],i,n,t).timeout(u,l)}).then(function(){d.success({info:o})})["catch"](function(e){if(e&&"ETIMEDOUT"===e.code)d.success({error_codes:[e.message],error_category:p,info:o});else if(e&&e.error){var t=c.getErrorCodes(c.getKeyErrors(e));d.success({error_codes:t,error_category:s.get(e,"error.keyCategory"),info:o})}else o.error=JSON.stringify(e),d.success({error_codes:[f],error_category:p,info:o})})}var r=e("dao"),i=(e("session.token"),e("metrics")),s=e("utils"),a=e("q"),c=(e("../../../../src/components/outer/environment"),e("exceptions")),u=2e3,d="UI_TIMEOUT",l=d+":gc_logout",f="ERROR_NOT_PROVIDED",p="UNKNOWN_ERROR";t.exports={invalidate:o}},{"../../../../src/components/outer/environment":71,dao:54,exceptions:14,metrics:63,q:1,"session.token":"session.token",utils:36}],84:[function(e,t,n){"use strict";var o=e("q"),r=e("./token");t.exports=function(){var e=o.defer();return r.read().then(function(){e.resolve(!0)},function(){e.resolve(!1)}),e.promise}},{"./token":"session.token",q:1}],85:[function(e,t,n){"use strict";function o(){return i.resolve({value:s.read("oidNAVY")})}function r(){var e=a.getTLD(""+window.location.hostname);return s.remove("oidNAVY",e,"/"),i.resolve()}var i=e("q"),s=e("cookie"),a=e("utils");t.exports={read:o,"delete":r}},{cookie:9,q:1,utils:36}],86:[function(e,t,n){"use strict";var o=e("./shim");t.exports={read:o("responder.obo.read"),"delete":o("responder.obo.delete")}},{"./shim":87}],87:[function(e,t,n){"use strict";var o=e("q"),r=e("messages");t.exports=function(e){return function(t){var n=o.defer();return r.publish(e,t,n),n.promise}}},{messages:16,q:1}],88:[function(e,t,n){"use strict";function o(){return d.remove(r(),l.getCookieDomain(),"/"),u(),g.resolve()}function r(){return l.getClientId()+".ts"}function i(){var e=new Date(Date.now()+f.TRUST_EXPIRY),t=d.write(r(),e.toISOString(),l.getCookieDomain(),"/",e,!1);return t?g.resolve(t):g.reject()}function s(){var e=d.read(r());if(null===e)return g.resolve({state:!1});var t=Date.parse(e)-(new Date).getTime(),n=1>t?f.STATES.low:f.STATES.high;return g.resolve({state:n,timeLeft:t})}function a(e){var t=c();return null===t?g.reject():g.resolve(t)}function c(){var e=p.getEspnWhitelist().map(function(e){return d.read(e+"-"+l.getClientIdEnvSuffix()+".ts")});return e.sort(function(e,t){return e=new Date(e).getTime(),t=new Date(t).getTime(),e-t}).pop()}function u(){p.isEspnClientId(l.getClientId())&&p.getEspnWhitelist().forEach(function(e){d.remove(e+"-"+l.getClientIdEnvSuffix()+".ts",l.getCookieDomain(),"/")})}var d=(e("./shim"),e("cookie")),l=e("../environment.js"),f=e("./../../common/trust-state/constants.js"),p=e("utils"),g=e("q");t.exports={read:s,write:i,"delete":o,readHighestEspnTs:a}},{"../environment.js":71,"./../../common/trust-state/constants.js":30,"./shim":87,cookie:9,q:1,utils:36}],89:[function(e,t,n){"use strict";function o(){clearInterval(i),i=setInterval(function(){var e=Date.now();s&&e-s>=u&&(a=e),s=e},c)}function r(){return a?Math.floor((Date.now()-a)/1e3):void 0}t.exports={start:o,timeSinceLastSleep:r};var i,s,a,c=2e3,u=6e4},{}],90:[function(e,t,n){"use strict";function o(e){var t=r.defer(),n=u.create(),o={};e=e||{},e.correlationId=e.correlationId||i.uuid();var l=e.breadcrumbs;l&&l.track(n,[{prop:"token.access_token",format:i.maskToken},{prop:"token.refresh_token",format:i.maskToken},{prop:"tokenData.access_token",format:i.maskToken},{prop:"tokenData.refresh_token",format:i.maskToken},{prop:"tokenData.id_token",format:i.hashString},{prop:"token.expires"},{prop:"tokenData.expires"},{prop:"token.refresh_expires"},{prop:"tokenData.refresh_expires"}]);var f=s.timed(s.actions.event.tokenRefresh,{conversation_id:i.uuid(),correlation_id:e.correlationId,reporting:e.reporting});return n.on("step-start",function(t){t=t||{};var n=d[t.name];n&&(o[t.name]=setTimeout(function(){s.log("log:refresh:timeout:"+t.name,{conversation_id:i.uuid(),correlation_id:e.correlationId,swid:i.get(t,"data.token.swid"),trace:l&&l.getTrail(),trace_data:l&&l.getData(),reporting:e.reporting,info:{context:e.context}})},1e3*n))}),n.on("step-end",function(e){e=e||{},clearTimeout(o[e.name])}),n.on("done",function(n){var o=n.attemptedRefresh&&!n.refreshSuccess;o?t.reject(n.finalResponse):t.resolve(n.finalResponse),n.refreshSuccess?t.resolve(n.finalResponse):t.reject(n.finalResponse);var r=i.get(n,"response"),s=i.get(n,"token.refresh_token"),u=i.get(n,"tokenData.refresh_token"),d=i.get(r,"error.keyCategory"),p=a.getErrorCodes(a.getKeyErrors(r)),g={swid:i.get(n,"token.swid"),info:{expiredRefresh:"refresh_expired"===n.refreshStatus,refreshStatus:n.refreshStatus,context:e.context,timeAwake:c.timeSinceLastSleep(),oldRefresh:i.maskToken(s),refresh:i.maskToken(u)},trace:l&&l.getTrail(),trace_data:l&&l.getData()};d&&(g.error_category=d),p&&(g.error_codes=p),o?f.error(g):f.success(g)}),n.run(null,{loggingInfo:e}),t.promise}var r=e("q"),i=e("utils"),s=e("metrics"),a=e("exceptions"),c=e("../sleep-timer"),u=e("../../../workflows/outer/token-refresh"),d={"read-token":15,"read-navy":15,"check-do-not-disturb":15,"aquire-mutex":180,"check-refresh-status":15,"refresh-with-token":90,"parse-refresh-with-token-errors":15,"refresh-with-blue":90,"parse-refresh-with-blue-errors":15,
gating:15,"write-session":15,"encode-guest":15,"emit-refresh-events":15,"logout-from-other-tab":15,"logout-no-refresh":15,"logout-security-flagged":15,"logout-invalid-refresh":15,"release-mutex":15,__UNIT_TEST__:-1};t.exports={refresh:o}},{"../../../workflows/outer/token-refresh":146,"../sleep-timer":89,exceptions:14,metrics:63,q:1,utils:36}],91:[function(e,t,n){!function(){"use strict";function n(e){function t(e,t){s.log("Token#getNextRefreshAttempt");var n=new Date(c.data.created),a=new Date(c.data.expires);if(!i.isValidDate(n)||!i.isValidDate(a))return void s.error("Invalid created or expires date in token object");var m,v,y=new r(n,a),w=y.getPercentElapsed(e),b=y.getSecondsRemaining(e),k=new r(e,y.end);if(w>1){var E=t.getCount(o.EXPIRED),_=new r(y.end,e);v=o.EXPIRED,s.debug("Token currently expired. Retries already attempted within this interval: "+E),g>E?(s.debug("token should be refreshed immedietly"),m=e):(s.debug("Too many attempts made within this interval. Get time nearest to interval of "+h+" (round up)"),t.reset(),m=_.getDateNearestToMultipleOfSeconds(h))}else if(w>=d&&1>w||l>=b&&c.data.ttl>=p)v=o.REFRESH_WINDOW,0===t.getCount(o.REFRESH_WINDOW)?(s.debug("Token is active, we are within the token refresh window and a refresh attempt has not yet been made. Refresh immedietly."),m=e):(s.debug("Token is active, we are within the token refresh window, and an attempt has already been made."),m=k.getDateAtPercent(f));else{s.debug("Valid token"),v=o.VALID;var I=y.getDateAtPercent(d).getTime(),A=c.data.ttl<=p?I:y.end.getTime()-l*u;m=new Date(Math.min(I,A))}return{date:m,state:v}}function n(){var e=new Date(c.data.expires),t=e.getTime();return!c.isValid()||isNaN(t)||t<(new Date).getTime()}function a(){return"string"==typeof c.data.access_token&&"string"==typeof c.data.swid&&"number"==typeof c.data.ttl}var c=this;this.data=e||{},this.getNextRefreshAttempt=t,this.isValid=a,this.isExpired=n;var u=1e3,d=.9,l=300,f=.5,p=480,g=3,h=300}t.exports=n;var o={VALID:1,REFRESH_WINDOW:2,EXPIRED:3},r=e("../../common/time-span"),i=e("utils"),s=e("logger");n.TOKEN_LIFECYCLE_STATE=o}()},{"../../common/time-span":29,logger:15,utils:36}],92:[function(e,t,n){!function(){"use strict";function n(){a.subscribe("session.loggedin",o),a.subscribe("session.reauth",o),a.subscribe("session.deleted",function(){i=void 0,r()})}function o(){d.log("TrustState#watch");u.trustState.read().then(function(e){if(a.publish("guest.trustStateChanged",e.state,e.timeLeft),r(),e.state===c.STATES.low)return void u.trustState["delete"]();a.publish("trustState.setTimer",e.timeLeft);var t=a.subscribe("trustState.timerExpired",function(){a.publish("guest.trustStateChanged",c.STATES.low),u.trustState["delete"](),t()})},function(){a.publish("guest.trustStateChanged",c.STATES.low),r()})}function r(){a.publish("trustState.clearTimer")}var i,s={init:n},a=(e("../../../../assets/common/js/q"),e("messages")),c=e("./../../common/trust-state/constants.js"),u=e("session"),d=e("logger");t.exports=s}()},{"../../../../assets/common/js/q":1,"./../../common/trust-state/constants.js":30,logger:15,messages:16,session:"session"}],93:[function(e,t,n){!function(){"use strict";function n(){a.subscribe("trustState.setTimer",o),a.subscribe("trustState.clearTimer",r)}function o(e){i=setTimeout(function(){a.publish("trustState.timerExpired")},e)}function r(){clearTimeout(i),i=void 0}var i,s={init:n},a=e("messages");t.exports=s}()},{messages:16}],94:[function(e,t,n){!function(){"use strict";function n(e){r=e}function o(){return r}t.exports={setState:n,getState:o};var r,i=e("messages");i.subscribe("doNotDisturb.isEnabled",function(e,t){t&&t.resolve&&t.resolve(!!o())})}()},{messages:16}],95:[function(e,t,n){{var o=e("../../environment");e("messages")}!function(){"use strict";function n(e){"inner.loaded"===e.data&&(A=!0,window.removeEventListener("message",n))}function r(e){var t=w.isIOS()||e?"absolute":"fixed";return"div#disneyid-wrapper{position:"+t+";display:none;opacity:0;top:0;left:0;width:100%;height:100%;}div#disneyid-wrapper.state-active {z-index:9999999;opacity:1;transition:opacity 300ms;-webkit-transition:opacity 300ms;}iframe#disneyid-iframe{width:100%;height:100%;}"}function i(){E.log("UI#appendIframe"),x.setAttribute("id","disneyid-style"),x.setAttribute("type","text/css"),x.innerHTML=r(),h=document.createElement("div"),h.setAttribute("id","disneyid-wrapper"),g=document.createElement("iframe"),g.setAttribute("id","disneyid-iframe"),g.setAttribute("name","disneyid-iframe"),g.setAttribute("frameborder","0"),g.setAttribute("title","Account Dialog");var e=p.getPath();g.setAttribute("src",e),h.appendChild(g),document.head.appendChild(x),document.body.appendChild(h);var t=setTimeout(function(){y.publish("lightbox.showError",{reason:"inner.timeout"})},9e4);y.subscribe("lightbox.heartbeat",function(){clearTimeout(t)})}function s(e){p=e;var t=p.getResponderPageUrl();w.docReady(i),t&&-1==t.indexOf("no.responder.page.com")?w.docReady(function(){f(t)}):_.attach()}function a(e,t){e&&e.deferWhenDoNotDisturbEnabled&&b.getState()||w.docReady(function(){k.disable(),c(),setTimeout(function(){h.className="state-active",m=window.scrollY||window.pageYOffset,T&&!w.isMobileDevice()&&(h.style.top=m+"px"),S&&S.classList.add("oneid-lightbox-open")}),setTimeout(function(){h.style.display="block",t&&t.resolve&&t.resolve()},50),I&&v.error(v.actions.event.serviceError,{error_codes:"UNKNOWN_ERROR",error_category:"UNKNOWN_ERROR",info:{"static":"true"}})})}function c(){E.log("UI#setFrameFocus");var e=Date.now(),t=setInterval(function(){if(document.activeElement!==g&&Date.now()-e<5e3)try{g.focus()}catch(n){}else clearInterval(t)},100)}function u(){E.log("UI#clearFrameFocus");try{document.querySelector("body").focus()}catch(e){}}function d(){window.scrollTo(0,m),E.log("UI#hide"),h&&(h.style.display="none",h.className=""),S&&S.classList.remove("oneid-lightbox-open"),k.enable(),u()}function l(e){E.log("UI#showError"),I=!0;var t=p.getStandardQueryParams(),n=w.get(e,"reason")||"outer",r=o.getOrigin()+"/v2/error/"+o.getClientId()+"/"+o.getLangPref()+"?reason="+encodeURIComponent(n);t.cssOverride&&(r+="&cssOverride="+encodeURIComponent(t.cssOverride)),g&&(g.src=r),v.error(v.actions.event.serviceError,{error_category:"UNKNOWN_ERROR",error_codes:"UNKNOWN_ERROR",info:{"static":!0,reason:n,innerLoaded:""+A}})}function f(e){var t=document.createElement("iframe");t.setAttribute("id","disneyid-secure-responder"),t.setAttribute("name","disneyid-secure-responder"),t.setAttribute("src",e),t.style.display="none",document.body.appendChild(t)}t.exports={init:s,show:a,hide:d,showError:l};var p,g,h,m,v=e("metrics"),y=e("messages"),w=e("utils"),b=e("../do-not-disturb"),k=e("./scroll"),E=e("logger"),_=e("../../../../outer/responder-lite"),I=!1,A=!1,S=document.querySelector("html"),x=document.createElement("style"),T=!1;window.addEventListener("message",n,!1),y.subscribe("config.ready",function(e){var t=w.get(e,"dynamicConfig.configurations.DIDFE-8538-scrolling.disabled");t&&(T=!0,x.innerHTML=r(!0))}),y.subscribe("lightbox.show",a),y.subscribe("lightbox.hide",d),y.subscribe("lightbox.showError",l)}()},{"../../../../outer/responder-lite":102,"../../environment":71,"../do-not-disturb":94,"./scroll":96,logger:15,messages:16,metrics:63,utils:36}],96:[function(e,t,n){!function(){"use strict";function n(){c||(s=window.document.querySelector("html"),a=window.document.querySelector("body"),i={html:{overflow:a.style.overflow,height:a.style.height},body:{overflow:a.style.overflow,height:a.style.height}},s.style.overflow="hidden",a.style.overflow="hidden",(r.isMobileDevice()||r.isBodyPositionRelative())&&(s.style.height="100%",a.style.height="100%"),c=!0)}function o(){c&&(s.style.overflow=i.html.overflow,s.style.height=i.html.height,a.style.overflow=i.body.overflow,a.style.height=i.body.height,c=!1)}var r=e("utils");t.exports={enable:o,disable:n};var i,s,a,c=!1}()},{utils:36}],97:[function(e,t,n){!function(){"use strict";function n(e,t){r.subscribe("config.ready",function(n){var r=s.get(n,"site.data.uiConfig.audience");r&&r!==u&&i.guest.read().then(function(i){var a=r===l||r===d,u=i&&s.get(i,"guest.profile.ageBand")!==c;a&&u&&o(e,t,n)},function(){r===l&&o(e,t,n)})})}function o(e,t,n){e.unid={};var o=t.body,r=t.createElement("script");r.type="text/javascript",r.id="unid",r.setAttribute("data-client",n.global.clientId),r.src=a,o.appendChild(r)}var r=e("messages"),i=e("session"),s=e("utils"),a="//cdn.unid.go.com/js/unid.min.js",c="CHILD",u="PK",d="FF",l="GA";t.exports=n,n(window,document)}()},{messages:16,session:"session",utils:36}],98:[function(e,t,n){"use strict";function o(e,t){i[e]=t}function r(e){return"function"==typeof i[e]?i[e]():void 0}t.exports={register:o,get:r};var i={}},{}],99:[function(e,t,n){"use strict";function o(e,t,n,o){var r=i.defer(),s=o?"workflow.execute":"workflow.run";return a.publish(s,{name:e,step:t,data:n},r),r.promise}function r(e,t,n){var o=i.defer();return a.publish("inner.setRoute",{name:e,opts:t,routeParameters:n},o),s.promise.timeout(o,9e4),o.promise}var i=e("../../assets/common/js/q"),s=e("utils"),a=(e("metrics"),e("messages"));t.exports={runWorkflow:o,setRoute:r}},{"../../assets/common/js/q":1,messages:16,metrics:63,utils:36}],100:[function(e,t,n){"use strict";function o(e){if(!P){if(!e||!Object.keys(e).length)throw new Error(ie.NO_CONFIG_OPTIONS);if(!e.clientId)throw new Error(ie.NO_CLIENT_ID);if("string"!=typeof e.responderPage)throw new Error(ie.NO_RESPONDER_PAGE);if(e.cookieDomain){if("string"!=typeof e.cookieDomain)throw new Error(ie.INVALID_COOKIE_DOMAIN);var t=0===window.location.protocol.toLowerCase().indexOf("https")?window.location.hostname:q.url.getHostName(e.responderPage);if(!r(e.cookieDomain,t))throw new Error(ie.INVALID_COOKIE_DOMAIN)}try{var n=q.getTLD(window.location.hostname),o=q.getTLD((q.getLocation(e.responderPage||"")||{}).hostname);n!==o&&(j=o,J.warn("responder page apex domain does not match the top window apex domain. responder apex:",o))}catch(i){}q.get(e,"optionalConfigs.reporting")&&!ne.validate(e.optionalConfigs.reporting)&&(delete e.optionalConfigs.reporting,J.warn("optionalConfigs.reporting does not pass validation, values will be ignored")),C=q.clone(e),K.setReportingProperties(q.get(e,"optionalConfigs.reporting")),e.correlationId||(e.correlationId=q.uuid()),e.correlationId&&e.correlationIdTimeStamp||(e.correlationIdTimeStamp=(new Date).getTime())}if(e&&P)throw new Error(ie.CONFIG_SET);return e&&!P&&(e.logLevel&&J.setLogLevel(e.logLevel),P=new N(e),P.on("error",function(e){J.error(e)})),P}function r(e,t){var n=e.split("."),o=t.split(".");if(n.length<2)return!1;for(;o.length>n.length;)o.shift();return e===o.join(".")}function i(e){D=e||{},e.isTest&&(de={promise:{then:function(e){e()}}})}function s(){P=void 0}function a(e){function t(){return ue.initialized?M.resolve():M.reject(ie.NOT_INITIALIZED)}function n(){return le.promise.then(function(){return V.isLoggedIn()}).then(function(e){if(e!==!0)throw ie.SESSION_NOT_ESTABLISHED})}function o(){return le.promise.then(function(){return V.isLoggedIn()}).then(function(e){if(e!==!1)throw ie.SESSION_ESTABLISHED})}function r(e){return Array.isArray(e)&&e.length>0?e.shift()().then(function(){return r(e)}):M.resolve()}function i(e,t,n){return function(){var o=arguments[0]||{};"undefined"!=typeof n&&(o=arguments[n]||{}),o.loggingInfo=ne.getLoggingInfo(C,R(o));var i,a=[o].concat([].slice.call(arguments,0)),c=M.defer();return K.actions.api[e]&&(i=K.timed(K.actions.api[e],{conversation_id:o.conversationId,correlation_id:o.correlationId,reporting:q.get(o.loggingInfo,"reporting")},o.conversationIdTimeStamp)),r(q.clone(t)).then(function(){s[e].apply(null,a).then(function(e){c.resolve(e&&"undefined"!=typeof e.data?e.data:e),i&&i.success(e&&e.logging?e.logging:void 0)}).fail(function(e){var t=q.get(e,"error_codes"),n=!!q.get(e,"success");P.emit("error",t),c.reject(t),i&&i[n?"success":"error"](e)})},function(e){P.emit("error",e),c.reject(e),i.success({error_codes:e})}),c.promise}}var s=q.assign({},U,{getEditableProfileFields:w,setEditableProfileFields:b,getGuest:k,doNotDisturb:v,forceTokenRefresh:_,getGuestNewsletters:I,getActivityStatus:A,getTrustStateStatus:S,launchRegistration:u,launchSocialRegistration:d,launchAdultVerification:l,launchNewsletters:f,redeemSessionTransferKey:E});e.init=c,e.setLanguage=p,e.getConfig=m,e.setDebug=g,e.setLogLevel=h,e.getLoggedInStatus=y;var a=[t,n],x=[t,o],T=[["doNotDisturb",a,1],["getEditableProfileFields",a],["setEditableProfileFields",a,1],["getGuest",a,1],["redeemSessionTransferKey",x,1],["forceTokenRefresh",a],["getGuestNewsletters",a],["getActivityStatus",a,1],["getTrustStateStatus",a],["logout",[]],["launchLogin",x],["launchAdultVerification",[t]],["launchRegistration",x],["launchSocialRegistration",x],["launchProfile",a],["launchResetPassword",x],["launchRecoverUsername",x],["launchReauth",a],["launchDisplayName",a],["launchNewsletters",[t],1],["launchRequestActivity",a,1],["launchLicensePlate",[t]],["getLicensePlateDataBag",[t]]];T.forEach(function(t){e[t[0]]=i.apply(null,t)})}function c(){var e=R({}),t=M.defer(),n=M.defer(),o=oe.get("initialization"),r=q.get(C,"optionalConfigs.reporting"),i=new re(o,[{prop:"token.access_token",format:q.maskToken},{prop:"token.refresh_token",format:q.maskToken},{prop:"token.expires"}]),s={correlation_id:e.correlationId,conversation_id:e.conversationId,reporting:r};j&&(s.info={responderMismatch:j});var a=K.timed(K.actions.api.init,s);return ue.initialized?(t.reject(ie.ALREADY_INITIALIZED),P.emit("error",ie.ALREADY_INITIALIZED),a.success({error_codes:ie.ALREADY_INITIALIZED})):(ce.start(),ae.init(F),B.subscribe("config.ready",function(e){n.resolve(e)}),se.configure(n.promise),o.on("session-state-known",function(e){var n={loggedIn:e.isLoggedIn,guest:e.guest};J.debug("`session-state-known` emitted by initialization workflow",e);var o={trace:i.getTrail(),trace_data:i.getData()};if(e.guest||(o.error_codes="Logged in as unknown"),a.success(o),e.guest){var r="CHILD"===q.get(e,"guest.profile.ageBand");V.swid.write(q.get(e,"guest.token.swid"),!0,r)}P.emit("init",n),t.resolve(n),le.resolve()}),o.on("migration-success",function(e){var t=e.guest;t.token=e.token,K.log(K.actions.event.migration,{client_id:F.getClientId(),swid:q.get(t,"token.swid"),anon:!1}),P.emit("login",t)}),o.on("login",function(e){var t="CHILD"===q.get(e,"guest.profile.ageBand");V.swid.write(q.get(e,"guest.token.swid"),!0,t),P.emit("login",e.guest)}),o.on("done",function(){Q.start()}),o.run(null,{clientId:F.getClientId(),blueEnabled:F.blueCookieEnabled(),cookieDomain:F.getCookieDomain(),migrationResponderPageUrl:F.getMigrationResponderPageUrl(),loggingInfo:{correlationId:e.correlationId,reporting:r,breadcrumbs:i,context:"initialization"}}),J.debug("initialization workflow reference:"),J.debug(o),H.init(),ue.initialized=!0),t.promise["finally"](function(){de.resolve()}),t.promise}function u(e){return U.launchRegistration(C,e)}function d(e){return U.launchSocialRegistration(C,e)}function l(e){return U.launchAdultVerification(C,e)}function f(e,t){var n=!0;return M.promise(function(o,r){$.getSite().then(function(i){var s=q.get(i,"newsletters")||{};Object.keys(s).forEach(function(e){var o=s[e]||{};-1!==Object.keys(o).indexOf(t)&&(n=!1)}),!t||n?r({success:!0,error_codes:ie.INVALID_ARGUMENT}):U.launchNewsletters(e,t).then(o,r)})})}function p(e){var t=M.defer();return z.isValid(e)?(ue.locale=e,console.info(ie.NOT_IMPLEMENTED)):(t.reject(ie.UNSUPPORTED_LOCALE),P.emit("error",ie.UNSUPPORTED_LOCALE)),t.promise}function g(e,t){if(e===!1)B.publish("debug.clear");else{var n=q.get(e,"geoIP");n&&B.publish("debug.geoIP",n);var o=q.get(e,"country");o&&B.publish("debug.country",o);var r=q.get(e,"testProfileFlag");r&&B.publish("debug.testProfileFlag",r);var i=q.get(e,"metricsUrl");i&&K.setWebLogUrl(i);var s=q.get(e,"epcEnabled");s&&B.publish("debug.epcEnabled",s)}"CLIENT_CONFIG"!==t||/-PROD$/.test(F.getClientId())||O(e)}function h(e,t){J.setLogLevel(e),B.publish("setLogLevel",{level:e}),t&&"OFF"!==e.toUpperCase()?ee.write("oid_loglevel",e,null,"/"):t&&"OFF"!==e.toUpperCase()||ee.remove("oid_loglevel",null,"/")}function m(){return q.clone(C)}function v(e,t){var n=M.defer();return void 0===t?n.reject({success:!0,error_codes:ie.INVALID_ARGUMENT}):(W.setState(t),t||T(),n.resolve()),n.promise}function y(){var e=M.defer(),t=R(),n=K.timed(K.actions.api.getLoggedInStatus,{conversation_id:t.conversationId,correlation_id:t.correlationId});return le.promise.then(function(){V.isLoggedIn().then(function(){e.resolve.apply(e,arguments),n.success()})}),e.promise}function w(e){var t=M.defer();return Z.get().then(function(e){q.get(e,"required")&&(e.required=Object.keys(e.required).reduceNative(function(t,n){return/^phone\.mobile/.test(n)||(t[n]=e.required[n]),t},{})),t.resolve({data:e})},function(){t.reject({success:!0,error_codes:ie.UNKNOWN_ERROR})}),t.promise}function b(e,t){var n=M.defer(),o=Object.keys(t||{}).find(function(e){return/^phone\.mobile/.test(e)});return o?(n.reject({success:!0,error_codes:ie.PROFILE_UPDATE_INVALID}),n.promise):(te.runWorkflow("ppcApi",null,{guestData:t,loggingInfo:{correlationId:e.correlationId}},!0).then(function(e){e.isUnresolvableError?n.reject({success:!0,error_codes:q.get(e,"output.failures[0].code",!0)}):n.resolve({data:e.output})})["catch"](function(e){n.reject({error_codes:e})}),n.promise)}function k(e,t){var n=M.defer(),o=oe.get("get-guest"),r={force:"undefined"!=typeof t&&t},i=new re(o,[{prop:"token.access_token",format:q.maskToken},{prop:"token.expires"}]);return o.on("done",function(e){var t=(e.errorCodes||[]).join(",");q.get(e,"guest.profile")?n.resolve({data:e.guest,logging:{error_codes:t,error_category:e.errorCategory,info:r}}):n.reject({error_codes:t,error_category:e.errorCategory,info:r})}),o.run(null,{cacheBust:t,loggingInfo:{correlationId:e.correlationId,breadcrumbs:i,context:"get-guest"}}),n.promise}function E(e,t){var n=M.defer(),o=oe.get("session-transfer"),r=new re(o,[{prop:"sessionTransferKey"}]);return o.on("done",function(e){var t=(e.errorCodes||[]).join(",");q.get(e,"guest.profile")?n.resolve({data:e.guest,logging:{error_codes:t,error_category:e.errorCategory}}):n.reject({error_codes:t,error_category:e.errorCategory})}),o.run(null,{sessionTransferKey:t,loggingInfo:{correlationId:e.correlationId,breadcrumbs:r,context:"session-transfer"}}),n.promise}function _(e){var t=M.defer(),n=new re,o=q.assign({breadcrumbs:n,context:"force-token-refresh"},ne.getLoggingInfo(C,R(e)));return X.refresh(o).then(function(e){t.resolve({data:q.get(e,"data.token")})},function(e){var n=q.get(e,"error.keyCategory")||"",o=-1===["UNKNOWN_ERROR","SYSTEM_UNAVAILABLE"].indexOf(n),r=[];(q.get(e,"error.errors")||[]).forEach(function(e){-1===r.indexOf(e.code)&&r.push(e.code)}),t.reject({success:o,error_codes:r.join(","),error_category:n})}),t.promise}function I(e){var t=M.defer(),n=oe.get("get-guest");return n.on("done",function(e){var n=(e.errorCodes||[]).join(",");q.get(e,"guest.profile")?t.resolve({data:q.get(e,"guest.marketing"),logging:{error_codes:n,error_category:e.errorCategory}}):t.reject({error_codes:n,error_category:e.errorCategory})}),n.run(),t.promise}function A(e,t){var n=M.defer();return te.runWorkflow("checkActivity",null,{activityCode:t},!0).then(function(e){e.error_code?n.reject({success:!0,error_codes:e.error_code}):n.resolve({data:e.approvalStatus})}),n.promise}function S(){var e=M.defer();return V.trustState.read().then(function(t){e.resolve({data:t.state})}),e.promise}function x(e){function t(){var e=M.defer();return V.token.read().then(function(t){V.guest.read().then(function(n){var o=q.get(n,"guest")||{};o.token=q.get(t,"token"),e.resolve(o)},function(){e.reject()})},function(){e.reject()}),e.promise}B.subscribe("session.loggedin",function(n,o){t().then(function(t){var n="CHILD"===q.get(t,"profile.ageBand");V.swid.write(t.token.swid,!0,n),e.emit("login",t),o&&o.resolve()})}),B.subscribe("apiEvent.ppu",function(e,t){B.publish("bridge.ppuSuccess"),t.resolve()}),B.subscribe("apiEvent.reauth",function(n,o){t().then(function(t){e.emit("reauth",t),o.resolve()})}),B.subscribe("session.reestablished",function(){t(!1).then(function(e){var t="CHILD"===q.get(e,"profile.ageBand");V.swid.write(e.token.swid,!0,t)})}),B.subscribe("token.refreshed",function(t){J.info("token refreshed"),e.emit("refresh",t.token)}),B.subscribe("lightbox.hide",function(){e.emit("close")}),B.subscribe("guest.updated",function(t){e.emit("update",t)}),B.subscribe("profile.create",function(t){e.emit("create",t)}),B.subscribe("profile.deactivation-complete",function(){e.emit("logout")}),B.subscribe("session.deleted",function(t){var n=q.getCookie("SWID"),o={action_name:K.actions.event.logout+":"+t,anon:!1,swid:n};K.send(o,!0),V.swid.anonymize(),e.emit("logout"),F.setCorrelationId(q.uuid())}),B.subscribe("profile.primary-account",function(t){e.emit("primary-account",t)}),B.subscribe("marketing.opt-in",function(t){e.emit("opt-in",t)}),B.subscribe("license-plate-redeemed",function(){e.emit("license-plate-redeemed")}),B.subscribe("guest.trustStateChanged",function(t){t===Y.STATES.low&&e.emit("low-trust")})}function T(){oe.get("cagoots").run(null,{loggingInfo:{context:"cagoots"}})}function O(e){B.publish("debug.clientConfigOverride",e)}function R(e){return e=e||{},e.conversationId=e.conversationId||q.uuid(),e.correlationId=e.correlationId||q.uuid(),e}t.exports={configure:i,get:o,deleteInstance:s};var N,C,D,P,L,j,U=e("../common/api"),M=e("../../assets/common/js/q"),q=e("utils"),B=e("messages"),F=e("../components/outer/environment"),V=e("session"),G=e("../components/common/event-emitter"),z=e("../components/inner/language-preferences/languages"),K=e("../components/metrics"),W=e("../components/outer/ui/do-not-disturb"),H=e("../components/outer/trust-state"),Y=e("../components/common/trust-state/constants.js"),X=e("../components/outer/token-refresh"),Q=e("../components/outer/session-timer"),$=e("../components/outer/config"),Z=e("../components/outer/progressive-profile-collection"),J=e("logger"),ee=e("cookie"),te=e("./api-helper"),ne=e("../common/reporting"),oe=e("../components/outer/workflow-manager"),re=e("WorkflowHistory"),ie=e("../common/errors"),se=e("dao"),ae=e("../components/outer/ui/web-ui"),ce=e("../components/outer/sleep-timer"),ue=(e("../components/common/postmessage-transport/whitelist"),{}),de=M.defer(),le=M.defer();N=function(e){{var t=this;q.getOS()}e.outerDomain=window.location.hostname,F.init(e,D),K.setClientId(F.getClientId()),q.get(D,"modules.patchBay")&&D.modules.patchBay.init(F),q.get(D,"modules.trustStateWeb")&&(L=D.modules.trustStateWeb.init()),a(t),x(t),ue.initialized=!1,e.initialize&&t.init()},G.emittable(N),function(){var e=M.defer();B.subscribe("inner.fatal",function(){e.resolve()}),B.subscribe("lightbox.requestShowErrorOnFatal",function(){e.promise.then(function(){B.publish("lightbox.show")})})}()},{"../../assets/common/js/q":1,"../common/api":5,"../common/errors":6,"../common/reporting":7,"../components/common/event-emitter":13,"../components/common/postmessage-transport/whitelist":23,"../components/common/trust-state/constants.js":30,"../components/inner/language-preferences/languages":57,"../components/metrics":63,"../components/outer/config":70,"../components/outer/environment":71,"../components/outer/progressive-profile-collection":75,"../components/outer/session-timer":76,"../components/outer/sleep-timer":89,"../components/outer/token-refresh":90,"../components/outer/trust-state":92,"../components/outer/ui/do-not-disturb":94,"../components/outer/ui/web-ui":95,"../components/outer/workflow-manager":98,"./api-helper":99,WorkflowHistory:40,cookie:9,dao:54,logger:15,messages:16,session:"session",utils:36}],101:[function(e,t,n){"use strict";function o(){var e="";if(document){var t=Array.prototype.slice.call(document.scripts,0).pop();e=t&&t.getAttribute("src")||e}return e}e("../components/common/polyfills/console"),e("./workflows-bootstrap");var r="2.38.9",i=e("./api"),s=e("../components/outer/patch-bay"),a=e("../components/outer/trust-state/web.js"),c=e("metrics"),u=e("../components/metrics/requests/web"),d=e("logger"),l=e("utils"),f=e("cookie"),p=l.getOS(),g=sessionStorage.getItem("oid_tab_id");g||(g=l.uuid(),sessionStorage.setItem("oid_tab_id",g)),d.setLogLevel(f.read("oid_loglevel")||"INFO"),c.init({os:p.name?p.name+" "+p.version:p,sdk_version:"Web "+r,appid:"DTSS-DISNEYID-UI",info:{tabId:g}},u),c.attachSubscribers(),i.configure({modules:{patchBay:s,trustStateWeb:a}}),window.DisneyID={get:function(e){return i.get(e)}},l.randomChance(.004)&&u({action_name:c.actions.event.preinit,timestamp:(new Date).toISOString(),appid:"DTSS-DISNEYID-UI",info:l.formatLogInfoBlock({disneyid_js_url:o(),page_url:window&&window.location&&window.location.href,log_type:"preinit"})},!1)},{"../components/common/polyfills/console":18,"../components/metrics/requests/web":66,"../components/outer/patch-bay":74,"../components/outer/trust-state/web.js":93,"./api":100,"./workflows-bootstrap":103,cookie:9,logger:15,metrics:63,utils:36}],102:[function(e,t,n){"use strict";var o=e("messages");t.exports={attach:function(){o.subscribe("responder.session.read",function(e,t){t&&t.reject()}),o.subscribe("responder.session.delete",function(e,t){t&&t.reject()}),o.subscribe("responder.guest.identifier.read",function(e,t){t&&t.reject()}),o.subscribe("responder.dateOfBirth.read",function(e,t){t&&t.reject()}),o.subscribe("responder.authenticator.read",function(e,t){t&&t.reject()}),o.subscribe("responder.apikey.write",function(e,t){sessionStorage.setItem("did_api_key",e),t.resolve()}),o.subscribe("responder.apikey.read",function(e,t){t.resolve(sessionStorage.getItem("did_api_key"))}),o.subscribe("responder.obo.read",function(e,t){t&&t.reject()})}}},{messages:16}],103:[function(e,t,n){"use strict";var o=e("../components/outer/workflow-manager");o.register("get-guest",e("../workflows/outer/get-guest")),o.register("initialization",e("../workflows/outer/initialization")),o.register("obo",e("../workflows/outer/obo")),o.register("navy-blue-login",e("../workflows/outer/navy-blue-login")),o.register("session-state-tasks",e("../workflows/outer/session-state-tasks")),o.register("cagoots",e("../workflows/outer/cagoots")),o.register("session-transfer",e("../workflows/outer/session-transfer"))},{"../components/outer/workflow-manager":98,"../workflows/outer/cagoots":107,"../workflows/outer/get-guest":110,"../workflows/outer/initialization":115,"../workflows/outer/navy-blue-login":123,"../workflows/outer/obo":128,"../workflows/outer/session-state-tasks":132,"../workflows/outer/session-transfer":138}],104:[function(e,t,n){function o(e){return Object.keys(e).reduce(function(t,n){var r=e[n];return t[n.toLowerCase()]="[object Object]"===Object.prototype.toString.call(r)?o(r):r,t},{})}t.exports=o},{}],105:[function(e,t,n){!function(){"use strict";function n(e,t,n,o){"PPU"!==e.workflowName||t.isPPU||n.forEach(function(e){"MISSING_VALUE"===e.code?t.isPPU=!0:o.isPPU.forEach(function(n){t.isPPU||(t.isPPU=e.code===n)})})}function o(){return{isPPU:["PPU_MARKETING","PPU_LEGAL"],isMarketingPPU:["PPU_MARKETING"],isGating:["GUEST_GATED_AGEBAND","GUEST_GATED_UNKNOWN","GUEST_GATED_EMBARGOED","GUEST_GATED_EMAIL","GUEST_GATED_LOCATION","GUEST_GATED_BOTH_EMAIL_VERIFICATION","GUEST_GATED_EMAIL_VERIFICATION","GUEST_GATED_PARENT_EMAIL_VERIFICATION","AUTHORIZATION_ACCOUNT_LOCKED_OUT","ACCOUNT_MAPPING_NOT_MAPPED_PROFILE_DELETE_REQUESTED","PROFILE_DISABLED","ACCOUNT_IS_CHILDED","PROFILE_USER_BANNED"],isAgebandGating:["GUEST_GATED_AGEBAND"],isBanned:["PROFILE_USER_BANNED"],isDisabled:["PROFILE_DISABLED","ACCOUNT_MAPPING_NOT_MAPPED_PROFILE_DELETE_REQUESTED"],isSecurityFlagged:["AUTHORIZATION_ACCOUNT_SECURITY_LOCKED_OUT"],isIPAS:["AUTHORIZATION_MASE_ERROR_RESOLVABLE"],isPil2:["AUTHORIZATION_PARENTAL_CONSENT_REQUIRED"],isAccountMappingError:["ACCOUNT_MAPPING_NOT_FOUND_BUT_EMAIL_FOUND","NRT_ACCOUNT","DISALLOWED_VALUE","UNKNOWN_ACCOUNT_STATUS"],isActionableInputError:["MISSING_VALUE","INVALID_VALUE","INUSE_VALUE","DISALLOWED_VALUE"],isAccountMappingNotFoundError:["ACCOUNT_MAPPING_NOT_FOUND","ACCOUNT_MAPPING_NOT_FOUND_AND_EMAIL_NOT_FOUND"],isAuthorizationError:["AUTHORIZATION_CREDENTIALS","AUTHORIZATION_BAD_EXTERNAL_TOKEN","AUTHORIZATION_EXTERNAL_ID_MISMATCH"],isEtagMismatch:["VALID_ETAG_REQUIRED"],isServiceError:["SERVICE_ERROR","UNKNOWN_ERROR","SYSTEM_UNAVAILABLE"],isMase:["AUTHORIZATION_MASE_ERROR"],isOtpAuthError:["PHONE_NOT_FOUND","PHONE_NOT_VERIFIED","PHONE_VERIFICATION_NOT_ALLOWED"],isOtpCodeLockedOut:["DEVICE_LINK_LOCKOUT_REACHED"],isInvalidLoginValue:["LOGIN_VALUE_INVALID","PROFILE_NOT_FOUND"],isInvalidOtpCode:["DEVICE_LINK_INVALID_OTP_CODE"],isInvalidAccessToken:["AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN"],isInvalidSessionTransferKeyError:["INVALID_SESSION_TRANSFER_KEY"]}}var r=e("utils"),i=e("exceptions"),s=/accountMapping\.AM-([a-zA-Z0-9]+)\.externalId/;t.exports=e("step").extend({execute:function(){var e=this,t=e.data.response,a=i.getKeyErrors(t),c=r.get(t,"error.keyCategory"),u={},d=o();Object.keys(d).forEach(function(e){i.find(a,d[e])&&(u[e]=!0)}),n(e,u,a,d),"PPU_ACTIONABLE_INPUT"===c?u.isPPU=!0:"ADVISORY"===c?u.isAdvisoryError=!0:"ACTIONABLE_INPUT"===c&&(u.isActionableInputError=!0);var l=r.get(i.find(a,"AUTHORIZATION_CREDENTIALS"),"data");u.isAuthorizationError&&/^SOCIAL\_/.test((l||{}).accountOrigin)&&"MACHINE_GENERATED"===l.passwordOrigin&&(e.data.socialProvider={GOOGLE:"Google",FACEBOOK:"Facebook"}[l.accountOrigin.replace(/^SOCIAL\_/,"")],u.isLoginSetPassword=!0);var f=t&&t.isValid&&!t.isValid(),p=t&&500===t.status;("undefined"==typeof t||f||p||"SYSTEM_UNAVAILABLE"===c)&&(u.isServiceError=!0),a.forEach(function(e){"INVALID_VALUE"===e.code&&"profile.region"===e.inputName?u.isInvalidRegionError=!0:"INUSE_VALUE"===e.code&&s.test(e.inputName)&&(u.isAccountLinkingError=!0)}),e.data.errors=u,e.success()}})}()},{exceptions:14,step:42,utils:36}],106:[function(e,t,n){!function(){"use strict";var n=e("utils"),o=e("session"),r=e("q");t.exports=e("step").extend({execute:function(){var e=this,t=e.data.guest,i=new Date;t.token.created=i.toISOString(),t.token.lastChecked=t.token.created,t.token.expires=n.expires(i,t.token.ttl).toISOString(),t.token.refresh_expires=n.expires(i,t.token.refresh_ttl||0).toISOString();var s={guest:t,token:t.token,s2:t.s2};r.all([o.guest.write(s,!0),o.trustState.write(),o.authenticator.write(s)]).then(function(){e.success()},function(){e.failure()})}})}()},{q:1,session:"session",step:42,utils:36}],107:[function(e,t,n){"use strict";var o=e("workflow"),r={ReadToken:e("../token-refresh/steps/read-token"),CheckDoNotDisturb:e("../shared/steps/check-do-not-disturb"),ExecuteCheckAuthorization:e("./steps/execute-check-authorization"),ParseErrors:e("../../common/shared/steps/parse-errors"),Gating:e("../shared/steps/gating"),PPU:e("../token-refresh/steps/ppu"),UpdateLastChecked:e("./steps/update-last-checked")};t.exports=function(){var e=new o({name:"Cagoots"});return e.step("read-token",new r.ReadToken).success("check-do-not-disturb").failure("done"),e.step("check-do-not-disturb",new r.CheckDoNotDisturb).success("execute-check-authorization"),e.step("execute-check-authorization",new r.ExecuteCheckAuthorization).success("update-last-checked").failure("parse-errors"),e.step("parse-errors",new r.ParseErrors).success(function(){var e=this.data.errors||{},t=this.data.doNotDisturbEnabled;return!t&&e.isGating?"gating":!t&&e.isPPU?"ppu":"update-last-checked"}),e.step("gating",new r.Gating).success("done"),e.step("ppu",new r.PPU).success("update-last-checked").failure("done"),e.step("update-last-checked",new r.UpdateLastChecked).success("done"),e}},{"../../common/shared/steps/parse-errors":105,"../shared/steps/check-do-not-disturb":142,"../shared/steps/gating":143,"../token-refresh/steps/ppu":152,"../token-refresh/steps/read-token":154,"./steps/execute-check-authorization":108,"./steps/update-last-checked":109,workflow:41}],108:[function(e,t,n){"use strict";var o=e("utils"),r=e("dao"),i=e("metrics"),s=e("exceptions"),a=e("../../../../components/outer/sleep-timer");t.exports=e("step").extend({
execute:function(){var e=this,t=e.data.token||{},n=t.access_token,c=t.swid,u=o.uuid(),d=o.get(e.data,"loggingInfo.correlationId")||o.uuid(),l=o.get(e.data,"loggingInfo.reporting"),f=i.timed("log:checkauthorization",{swid:c,conversation_id:u,correlation_id:d,reporting:l,info:{context:o.get(e.data,"loggingInfo.context"),timeAwake:a.timeSinceLastSleep(),token:o.maskToken(t.access_token),ttl:Date.parse(t.expires)-Date.now(),lastChecked:t.lastChecked}});r.checkAuthorization(n,c,u,d,l).then(function(t){e.data.response=t,f.success({error_category:o.get(t,"error.keyCategory"),error_codes:s.getErrorCodes(s.getKeyErrors(t))}),t.isClientError()?e.failure():e.success()},function(t){e.data.response=t,f.failure({error_category:o.get(t,"error.keyCategory"),error_codes:s.getErrorCodes(s.getKeyErrors(t))}),e.failure()})}})},{"../../../../components/outer/sleep-timer":89,dao:54,exceptions:14,metrics:63,step:42,utils:36}],109:[function(e,t,n){"use strict";var o=(e("utils"),e("session"));t.exports=e("step").extend({execute:function(){var e=this;o.token.read().then(function(t){var n=(t||{}).token||{};n.lastChecked=new Date(Date.now()).toISOString(),o.token.write({token:n}).then(function(){e.success()},function(){e.success()})},function(){e.success()})}})},{session:"session",step:42,utils:36}],110:[function(e,t,n){"use strict";var o=e("workflow"),r={ReadToken:e("../shared/steps/read-token"),ReadGuestFromStorage:e("./steps/read-guest-from-storage"),CheckCache:e("./steps/check-cache"),SaveGuest:e("./steps/save-guest"),Execute:e("./steps/execute")};t.exports=function(){var e=new o({name:"GetGuest"});return e.step("read-token",new r.ReadToken).success("read-guest-from-storage").failure("done"),e.step("read-guest-from-storage",new r.ReadGuestFromStorage).success("check-cache").failure("execute"),e.step("check-cache",new r.CheckCache).success(function(){return this.data.isExpired||this.data.cacheBust?"execute":"done"}),e.step("execute",new r.Execute).success("save-guest").failure("done"),e.step("save-guest",new r.SaveGuest).success("done"),e}},{"../shared/steps/read-token":145,"./steps/check-cache":111,"./steps/execute":112,"./steps/read-guest-from-storage":113,"./steps/save-guest":114,workflow:41}],111:[function(e,t,n){"use strict";t.exports=e("step").extend({execute:function(){var e=216e5;this.data.isExpired=this.data.created?this.data.created.getTime()+e<Date.now():!1,this.success()}})},{step:42}],112:[function(e,t,n){"use strict";{var o=e("dao"),r=e("metrics"),i=e("exceptions"),s=(e("session"),e("utils"));e("q")}t.exports=e("step").extend({execute:function(){function e(e){var n=i.find(s.get(e,"error.errors"),"AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN"),o={error_category:s.get(e,"error.keyCategory"),error_codes:i.getErrorCodes(i.getKeyErrors(e))};n&&n.developerMessage.indexOf("Authorization header is missing or invalid")>-1&&(o.info={context:s.get(t.data,"loggingInfo.context"),missingAuthHeader:!0}),d.send(o,!e.isServerError())}var t=this,n=s.uuid(),a=s.get(t.data,"loggingInfo.correlationId")||s.uuid(),c=s.get(t.data,"loggingInfo.reporting"),u=s.get(t.data,"loggingInfo.breadcrumbs"),d=r.timed("log:getguest",{conversation_id:n,correlation_id:a,reporting:c,info:{context:s.get(t.data,"loggingInfo.context")},trace:u&&u.getTrail(),trace_data:u&&u.getData()}),l=s.get(t.data,"token.swid"),f=s.get(t.data,"token.access_token");o.getBySwid(l,f,n,a,c).then(function(n){n.data?(t.data.guest=n.data,d.success({anon:!1,swid:l}),s.get(t,"data.token")&&s.set(t,"data.guest.token",t.data.token),t.success()):(e(n),t.failure())},function(n){t.data.response=n,e(n),t.failure()})}})},{dao:54,exceptions:14,metrics:63,q:1,session:"session",step:42,utils:36}],113:[function(e,t,n){"use strict";var o=e("session"),r=e("utils");t.exports=e("step").extend({execute:function(){var e=this;o.guest.read().then(function(t){t.created&&(t.created=new Date(t.created)),r.get(e,"data.token")&&r.set(t,"guest.token",e.data.token),e.data.guest=t.guest,e.data.created=t.created,e.success()},function(){e.data.errorCodes.push("GUEST_READ_FAILURE"),e.failure()})}})},{session:"session",step:42,utils:36}],114:[function(e,t,n){"use strict";var o=e("session");t.exports=e("step").extend({execute:function(){var e=this;o.guest.write({guest:e.data.guest})["finally"](function(){e.success()})}})},{session:"session",step:42}],115:[function(e,t,n){"use strict";var o=e("workflow"),r=(e("utils"),{anonymize:e("./steps/anonymize"),ReadToken:e("../shared/steps/read-token"),GetGuest:e("./steps/get-guest"),NavyBlueLogin:e("./steps/navy-blue-login"),Events:e("./steps/events"),Migration:e("./steps/migration"),Obo:e("./steps/obo"),TokenRefresh:e("./steps/token-refresh")});t.exports=function(){var e=new o({name:"Initialization"});return e.step("anonymize",new r.anonymize).success("read-token"),e.step("read-token",new r.ReadToken).success(function(){return this.data.tokenIsExpired?"token-refresh":"get-guest"}).failure(function(){return"navy-blue-login"}),e.step("token-refresh",new r.TokenRefresh).success("get-guest").failure("events"),e.step("get-guest",new r.GetGuest).success("events").failure("events"),e.step("navy-blue-login",new r.NavyBlueLogin).success("events").failure("events"),e.step("events",new r.Events).success(function(){return this.data.token?"obo":"migration"}),e.step("migration",new r.Migration).success("read-token").failure("obo"),e.step("obo",new r.Obo).success("done").failure("done"),e}},{"../shared/steps/read-token":145,"./steps/anonymize":116,"./steps/events":117,"./steps/get-guest":118,"./steps/migration":119,"./steps/navy-blue-login":120,"./steps/obo":121,"./steps/token-refresh":122,utils:36,workflow:41}],116:[function(e,t,n){"use strict";{var o=e("session");e("dao")}t.exports=e("step").extend({execute:function(){o.swid.anonymize(!0).then(this.success.bind(this))}})},{dao:54,session:"session",step:42}],117:[function(e,t,n){"use strict";t.exports=e("step").extend({execute:function(){this.data.migrated&&this.data.token&&this.data.guest?this.workflow.emit("migration-success",{guest:this.data.guest,token:this.data.token}):this.data.migrated||this.workflow.emit("session-state-known",{guest:this.data.guest||null,isLoggedIn:!!this.data.token}),this.success()}})},{step:42}],118:[function(e,t,n){"use strict";var o=e("../../../../components/outer/workflow-manager"),r=e("utils");t.exports=e("step").extend({execute:function(){var e=this,t=o.get("get-guest"),n=[],i=r.get(e.data,"loggingInfo.breadcrumbs");i&&i.track(t,[{prop:"token.access_token",format:r.maskToken},{prop:"token.id_token",format:r.hashString},{prop:"token.expires"}]),t.on("done",function(t){t.guest?(e.data.guest=t.guest,e.success()):e.failure()}),t.run("read-guest-from-storage",{token:e.data.token,errorCodes:n,loggingInfo:e.data.loggingInfo})}})},{"../../../../components/outer/workflow-manager":98,step:42,utils:36}],119:[function(e,t,n){"use strict";var o=(e("session"),e("cookie")),r=e("../../../../components/outer/espn/migration"),i="s_oidSessionMigrated";t.exports=e("step").extend({execute:function(){var e=this;return!e.data.migrationResponderPageUrl||o.read(i)||e.data.migrated?e.failure():void r.init({responderPage:e.data.migrationResponderPageUrl,clientId:e.data.clientId,cookieDomain:e.data.cookieDomain,onMigrationSuccess:function(){var t=new Date;t.setFullYear(t.getFullYear()+33),o.write(i,"1",e.data.cookieDomain,"/",t),e.data.migrated=!0,e.success()},onMigrationFailure:function(){e.failure()}})}})},{"../../../../components/outer/espn/migration":72,cookie:9,session:"session",step:42}],120:[function(e,t,n){"use strict";var o=e("../../../../components/outer/workflow-manager"),r=e("utils");t.exports=e("step").extend({execute:function(){var e=o.get("navy-blue-login"),t=this,n=r.get(t.data,"loggingInfo.breadcrumbs");return n&&n.track(e,[{prop:"token.access_token",format:r.maskToken},{prop:"token.refresh_token",format:r.maskToken},{prop:"token.id_token",format:r.hashString},{prop:"token.expires"}]),t.data.blueEnabled?(e.on("done",function(e){e.guest?(t.data.guest=e.guest,t.data.token=e.guest.token,t.success()):t.failure()}),void e.run(null,{clientId:t.data.clientId,loggingInfo:t.data.loggingInfo})):t.failure()}})},{"../../../../components/outer/workflow-manager":98,step:42,utils:36}],121:[function(e,t,n){"use strict";var o=e("../../../../components/outer/workflow-manager"),r=e("utils");t.exports=e("step").extend({execute:function(){var e=o.get("obo"),t=this,n=r.get(t.data,"loggingInfo.breadcrumbs");n&&n.track(e),e.on("done",function(e){e.guest?(t.data.guest=e.guest,t.workflow.emit("login",{guest:e.guest}),t.success()):t.failure()}),e.run(null,{token:t.data.token,loggingInfo:t.data.loggingInfo})}})},{"../../../../components/outer/workflow-manager":98,step:42,utils:36}],122:[function(e,t,n){"use strict";var o=e("../../../../components/outer/token-refresh"),r=e("utils");t.exports=e("step").extend({execute:function(){var e=this;o.refresh(e.data.loggingInfo).then(function(t){r.get(t,"data.token")?(e.data.token=r.get(t,"data.token"),e.success()):e.failure()},function(){e.failure()})}})},{"../../../../components/outer/token-refresh":90,step:42,utils:36}],123:[function(e,t,n){"use strict";var o=e("workflow"),r=e("utils"),i={ParseErrors:e("../../common/shared/steps/parse-errors"),ReadCookies:e("./steps/read-cookies"),DeleteCookies:e("./steps/delete-cookies"),Execute:e("./steps/execute"),CreateSession:e("../../inner/shared/steps/create-session"),PPU:e("./steps/ppu")};t.exports=function(){var e=new o({name:"NavyBlueLogin"});return e.step("read-cookies",new i.ReadCookies).success(function(){return this.data.blue||this.data.navy&&r.isEspnClientId(this.data.clientId)?"execute":"done"}),e.step("execute",new i.Execute).success("create-session").failure("parse-errors"),e.step("create-session",new i.CreateSession).success("done").failure("done"),e.step("parse-errors",new i.ParseErrors).success(function(){var e=this.data.errors;return e.isPPU?"ppu":e.isSecurityFlagged?"delete-cookies":"done"}),e.step("ppu",new i.PPU).success("create-session").failure("done"),e.step("delete-cookies",new i.DeleteCookies).success("done"),e}},{"../../common/shared/steps/parse-errors":105,"../../inner/shared/steps/create-session":106,"./steps/delete-cookies":124,"./steps/execute":125,"./steps/ppu":126,"./steps/read-cookies":127,utils:36,workflow:41}],124:[function(e,t,n){"use strict";var o=e("session");t.exports=e("step").extend({execute:function(){var e=this;o.deleteAll("securityflagged").then(e.success.bind(e))}})},{session:"session",step:42}],125:[function(e,t,n){"use strict";{var o=e("dao"),r=e("metrics"),i=e("exceptions"),s=(e("session"),e("utils"));e("q")}t.exports=e("step").extend({execute:function(){function e(e){u.send({error_category:s.get(e,"error.keyCategory"),error_codes:i.getErrorCodes(i.getKeyErrors(e)),info:{context:s.get(t.data,"loggingInfo.context")}},!e.isServerError())}var t=this,n=s.uuid(),a=s.get(t.data,"loggingInfo.correlationId"),c=s.get(t.data,"loggingInfo.reporting"),u=r.timed(r.actions.event.loginBlue,{conversation_id:n,correlation_id:a,reporting:c});o.authenticateViaBlueCookie(t.data.blue||t.data.navy,n,a,c).then(function(n){t.data.response=n,t.data.guest=n.data,n.isClientError()||i.find(s.get(n,"error.errors",[]),["PPU_MARKETING"])?(e(n),t.failure()):(u.success({anon:!1,swid:s.get(n,"data.profile.swid"),info:{context:s.get(t.data,"loggingInfo.context"),refresh:s.maskToken(s.get(n,"data.token.refresh_token"))}}),t.success())},function(n){t.data.response=n,e(n),t.failure()})}})},{dao:54,exceptions:14,metrics:63,q:1,session:"session",step:42,utils:36}],126:[function(e,t,n){"use strict";var o=e("utils"),r=e("../../../../outer/api-helper");t.exports=e("step").extend({execute:function(){var e=this,t={loggingInfo:e.data.loggingInfo,response:e.data.response,guest:o.get(e.data,"response.data")};r.runWorkflow("ppuLoggedOut",null,t,!0).then(function(t){t.ppuSuccess!==!0?e.failure():(e.data.guest=t.guest,e.success())})}})},{"../../../../outer/api-helper":99,step:42,utils:36}],127:[function(e,t,n){"use strict";var o=e("utils"),r=e("cookie"),i="BLUE",s="oidNAVY";t.exports=e("step").extend({execute:function(){this.data.navy=r.read(s),this.data.blue=r.read(i),this.data.isEspn=o.isEspnClientId(this.data.clientId),this.success()}})},{cookie:9,step:42,utils:36}],128:[function(e,t,n){"use strict";var o=e("workflow"),r=e("utils"),i={ParseErrors:e("../../common/shared/steps/parse-errors"),ReadOboToken:e("./steps/read-obo-token"),LogoutAndReload:e("./steps/logout-and-reload"),Execute:e("./steps/execute"),CreateSession:e("../../inner/shared/steps/create-session"),PPU:e("../shared/steps/ppu"),Gating:e("../shared/steps/gating")};t.exports=function(){var e=new o({name:"OBO"});return e.step("read-obo-token",new i.ReadOboToken).success(function(){return r.get(this.data,"obo.token")&&this.data.token?"logout-and-reload":r.get(this.data,"obo.token")?"execute":"done"}).failure("done"),e.step("execute",new i.Execute).success("create-session").failure("parse-errors"),e.step("create-session",new i.CreateSession).success("done").failure("done"),e.step("parse-errors",new i.ParseErrors).success(function(){var e=this.data.errors;return e.isPPU?"ppu":e.isGating?"gating":"done"}),e.step("ppu",new i.PPU).success("create-session").failure("done"),e.step("gating",new i.Gating).success("done").failure("done"),e.step("logout-and-reload",new i.LogoutAndReload).success("done"),e}},{"../../common/shared/steps/parse-errors":105,"../../inner/shared/steps/create-session":106,"../shared/steps/gating":143,"../shared/steps/ppu":144,"./steps/execute":129,"./steps/logout-and-reload":130,"./steps/read-obo-token":131,utils:36,workflow:41}],129:[function(e,t,n){"use strict";var o=e("dao"),r=e("metrics"),i=e("exceptions"),s=e("session"),a=e("utils"),c=e("q");t.exports=e("step").extend({execute:function(){function e(e){l.send({error_category:a.get(e,"error.keyCategory"),error_codes:i.getErrorCodes(i.getKeyErrors(e)),info:{context:a.get(t.data,"loggingInfo.context")}},!e.isServerError())}var t=this,n=a.uuid(),u=a.get(t.data,"loggingInfo.correlationId"),d=a.get(t.data,"loggingInfo.reporting"),l=r.timed(r.actions.event.loginObo,{conversation_id:n,correlation_id:u,reporting:d});c.all([o.authenticateViaOboCookie(t.data.obo.token,t.data.obo.swid,n,u,d),s.obo["delete"]()]).then(function(n){var o=n[0];t.data.response=o,t.data.guest=o.data,o.isClientError()||i.find(a.get(o,"error.errors",[]),["PPU_MARKETING"])?(e(o),t.failure()):(l.success({anon:!1,swid:a.get(o,"data.profile.swid"),info:{context:a.get(t.data,"loggingInfo.context"),refresh:a.maskToken(a.get(o,"data.token.refresh_token"))}}),t.success())},function(n){t.data.response=n,e(n),t.failure()})}})},{dao:54,exceptions:14,metrics:63,q:1,session:"session",step:42,utils:36}],130:[function(e,t,n){"use strict";var o=e("session"),r=(e("q"),e("utils"),2e3);t.exports=e("step").extend({execute:function(){var e=this.data.reload||window.location.reload.bind(window.location);o.deleteAll("obo").then(function(){setTimeout(function(){e()},r)})}})},{q:1,session:"session",step:42,utils:36}],131:[function(e,t,n){"use strict";var o=e("session");t.exports=e("step").extend({execute:function(){var e=this;o.obo.read().then(function(t){return t.token&&t.swid?(e.data.obo={token:t.token,swid:t.swid},void e.success()):e.failure()},function(){e.failure()})}})},{session:"session",step:42}],132:[function(e,t,n){"use strict";var o=e("workflow"),r={CheckState:e("./steps/check-state"),Cagoots:e("../shared/steps/cagoots"),TokenRefresh:e("../initialization/steps/token-refresh"),SyncLoggedIn:e("./steps/sync-logged-in"),SyncLoggedOut:e("./steps/sync-logged-out"),IncrementRefreshCounter:e("./steps/increment-refresh-counter"),ResetRefreshCounter:e("./steps/reset-refresh-counter")};t.exports=function(){var e=new o({name:"SessionStateTasks"});return e.step("check-state",new r.CheckState).success(function(){var e=this.data.requires||{};return e.sync&&this.data.isLoggedIn===!0?"sync-logged-in":e.sync&&this.data.isLoggedIn===!1?"sync-logged-out":e.tokenRefresh?"token-refresh":e.cagoots?"cagoots":"done"}),e.step("cagoots",new r.Cagoots).success("done").failure("done"),e.step("token-refresh",new r.TokenRefresh).success("reset-refresh-counter").failure("increment-refresh-counter"),e.step("increment-refresh-counter",new r.IncrementRefreshCounter).success("done"),e.step("reset-refresh-counter",new r.ResetRefreshCounter).success("done"),e.step("sync-logged-in",new r.SyncLoggedIn).success("done"),e.step("sync-logged-out",new r.SyncLoggedOut).success("done"),e}},{"../initialization/steps/token-refresh":122,"../shared/steps/cagoots":141,"./steps/check-state":133,"./steps/increment-refresh-counter":134,"./steps/reset-refresh-counter":135,"./steps/sync-logged-in":136,"./steps/sync-logged-out":137,workflow:41}],133:[function(e,t,n){"use strict";function o(e,t){var n=86400,o=60*t*60;return n>=e&&o>=e}var r=e("session"),i=e("utils"),s=e("../../../../components/outer/token"),a=e("../../../../components/common/retry-counter"),c=e("../../../../components/outer/config");t.exports=e("step").extend({execute:function(){var e=this;c.getSite().then(function(t){var n=i.get(t,"uiConfig.cagoots.interval")||24,c=60*n*1e3,u=i.get(t,"uiConfig.cagoots.enabled");"undefined"==typeof u&&(u=!0),r.token.read().then(function(t){e.data.isLoggedIn=!0,e.data.wasLoggedIn===!1&&i.set(e.data,"requires.sync",!0);var r=new s(t.token),d=r.getNextRefreshAttempt(new Date,a),l=i.get(t,"token.ttl")||0,f=new Date(i.get(t,"token.lastChecked")||i.get(t,"token.created")),p=Date.now()-f.getTime()>=c;new Date>=(d.date||new Date)&&i.set(e.data,"requires.tokenRefresh",!0),u&&p&&!o(l,n)&&i.set(e.data,"requires.cagoots",!0),e.data.nextRefreshAttempt=d,e.success()},function(){e.data.isLoggedIn=!1,e.data.wasLoggedIn===!0&&i.set(e.data,"requires.sync",!0),e.success()})})}})},{"../../../../components/common/retry-counter":27,"../../../../components/outer/config":70,"../../../../components/outer/token":91,session:"session",step:42,utils:36}],134:[function(e,t,n){"use strict";var o=e("../../../../components/common/retry-counter"),r=e("utils");t.exports=e("step").extend({execute:function(){o.increment(r.get(this.data,"nextRefreshAttempt.state")),this.success()}})},{"../../../../components/common/retry-counter":27,step:42,utils:36}],135:[function(e,t,n){"use strict";var o=e("../../../../components/common/retry-counter");t.exports=e("step").extend({execute:function(){o.reset(),this.success()}})},{"../../../../components/common/retry-counter":27,step:42}],136:[function(e,t,n){"use strict";var o=e("q"),r=e("utils"),i=e("session"),s=e("messages");t.exports=e("step").extend({execute:function(){var e=this;i.guest.read().then(function(e){var t=o.defer(),n={ageBand:r.get(e,"guest.profile.ageBand"),legalCountry:r.get(e,"guest.profile.region")||r.get(e,"guest.profile.countryCodeDetected")};return s.publish("authReloader.reloadIfChanged",n,t),t.promise})["finally"](function(){s.publish("session.loggedin"),e.success()})}})},{messages:16,q:1,session:"session",step:42,utils:36}],137:[function(e,t,n){"use strict";var o=e("messages");t.exports=e("step").extend({execute:function(){o.publish("session.deleted","mismatchtimer"),this.success()}})},{messages:16,step:42}],138:[function(e,t,n){"use strict";var o=e("workflow"),r={ParseErrors:e("../../common/shared/steps/parse-errors"),Execute:e("./steps/execute"),CreateSession:e("../../inner/shared/steps/create-session"),PPU:e("../shared/steps/ppu"),Gating:e("../shared/steps/gating"),Complete:e("./steps/complete")};t.exports=function(){var e=new o({name:"session-transfer"});return e.step("execute",new r.Execute).success("create-session").failure("parse-errors"),e.step("create-session",new r.CreateSession).success("complete").failure("done"),e.step("complete",new r.Complete).success("done"),e.step("parse-errors",new r.ParseErrors).success(function(){var e=this.data.errors,t=this.data.retryAttempted;return e.isPPU?"ppu":e.isGating?"gating":e.isInvalidSessionTransferKeyError&&!t?(this.data.retryAttempted=!0,"execute"):"done"}),e.step("ppu",new r.PPU).success("create-session").failure("done"),e.step("gating",new r.Gating).success("done").failure("done"),e}},{"../../common/shared/steps/parse-errors":105,"../../inner/shared/steps/create-session":106,"../shared/steps/gating":143,"../shared/steps/ppu":144,"./steps/complete":139,"./steps/execute":140,workflow:41}],139:[function(e,t,n){"use strict";var o=e("messages"),r=e("q");t.exports=e("step").extend({execute:function(){var e=this.data.guest,t=r.defer(),n=this;o.publish("session.loggedin",{guest:e,token:e.token},t),n.success()}})},{messages:16,q:1,step:42}],140:[function(e,t,n){"use strict";var o=e("dao"),r=e("metrics"),i=e("exceptions"),s=e("utils");t.exports=e("step").extend({execute:function(){function e(e){l.send({error_category:s.get(e,"error.keyCategory"),error_codes:i.getErrorCodes(i.getKeyErrors(e)),info:{context:s.get(t.data,"loggingInfo.context"),attempt:u,originClientId:s.get(e,"headers.origin-client-id"),keyHash:d}},!e.isServerError())}var t=this,n=s.uuid(),a=s.get(t.data,"loggingInfo.correlationId"),c=s.get(t.data,"loggingInfo.reporting"),u=t.data.retryAttempted?1:0,d=s.crc32(t.data.sessionTransferKey).toString(16),l=r.timed(r.actions.event.sessionTransferRedeem,{conversation_id:n,correlation_id:a,reporting:c});o.authenticateViaSessionTransferKey(t.data.sessionTransferKey,n,a,c).then(function(n){t.data.response=n,t.data.guest=n.data,n.isClientError()||i.find(s.get(n,"error.errors",[]),["PPU_MARKETING"])?(e(n),t.failure()):(l.success({anon:!1,swid:s.get(n,"data.profile.swid"),info:{context:s.get(t.data,"loggingInfo.context"),refresh:s.maskToken(s.get(n,"data.token.refresh_token")),attempt:u,originClientId:s.get(n,"headers.origin-client-id"),keyHash:d}}),t.success())},function(n){t.data.response=n,e(n),t.failure()})}})},{dao:54,exceptions:14,metrics:63,step:42,utils:36}],141:[function(e,t,n){"use strict";var o=e("../../../../components/outer/workflow-manager");t.exports=e("step").extend({execute:function(){var e=this,t=o.get("cagoots");t.on("done",function(){e.success()}),t.run(null,{loggingInfo:e.data.loggingInfo})}})},{"../../../../components/outer/workflow-manager":98,step:42}],142:[function(e,t,n){"use strict";var o=e("../../../../components/outer/ui/do-not-disturb");t.exports=e("step").extend({execute:function(){this.data.doNotDisturbEnabled=o.getState(),this.success()}})},{"../../../../components/outer/ui/do-not-disturb":94,step:42}],143:[function(e,t,n){"use strict";var o=e("messages");t.exports=e("step").extend({execute:function(){this.data.logoutType="gating",o.publish("workflow.run",{name:"gating",step:"ensure-logged-out",data:this.data}),this.success()}})},{messages:16,step:42}],144:[function(e,t,n){"use strict";var o=e("session"),r=(e("q"),e("utils")),i=e("../../../../outer/api-helper");t.exports=e("step").extend({execute:function(){var e=this;o.isLoggedIn().then(function(t){var n={loggingInfo:e.data.loggingInfo,response:e.data.response,guest:r.get(e.data.response,"data")},o=t?"ppuLoggedIn":"ppuLoggedOut";i.runWorkflow(o,null,n,!0).then(function(t){t.guest?(e.data.guest=t.guest,e.success()):e.failure()})})}})},{"../../../../outer/api-helper":99,q:1,session:"session",step:42,utils:36}],145:[function(e,t,n){"use strict";var o=e("session"),r=e("../../../../components/outer/token");t.exports=e("step").extend({execute:function(){var e=this;e.data.errorCodes=[],o.token.read().then(function(t){var n=new r(t.token);e.data.token=t.token,e.data.tokenIsExpired=n.isExpired(),e.success()},function(){e.data.errorCodes.push("TOKEN_READ_FAILURE"),e.failure()})}})},{"../../../../components/outer/token":91,session:"session",step:42}],146:[function(e,t,n){"use strict";function o(){var e=new r({name:"TokenRefresh"});return e.step("read-token",new s.ReadToken).success(function(){return i.get(this.data,"token.refresh_token")?"read-navy":"logout-no-refresh"}).failure("release-mutex"),e.step("read-navy",new s.ReadNavy).success("check-do-not-disturb"),e.step("check-do-not-disturb",new s.CheckDoNotDisturb).success("aquire-mutex"),e.step("aquire-mutex",new s.AquireMutex).success("check-refresh-status"),e.step("check-refresh-status",new s.CheckRefreshStatus).success(function(){return"token_refreshed"===this.data.refreshStatus?"emit-refresh-events":"logged_out"===this.data.refreshStatus?"logout-from-other-tab":"refresh_expired_blue_fallback"===this.data.refreshStatus?"refresh-with-blue":"refresh_expired"===this.data.refreshStatus?"logout-invalid-refresh":"refresh-with-token"}),e.step("refresh-with-token",new s.RefreshWithToken).success("write-session").failure("parse-refresh-with-token-errors"),e.step("parse-refresh-with-token-errors",new s.ParseErrors).success(function(){var e=this.data.errors||{},t=e.isPPU&&!e.isMarketingPPU,n=e.isGating,o=this.data.doNotDisturbEnabled;return e.isSecurityFlagged?"logout-security-flagged":o&&this.data.tokenData?"write-session":o&&n?"release-mutex":t?"ppu":n?"gating":this.data.navyValue?"refresh-with-blue":this.data.isInvalidRefreshToken?"logout-invalid-refresh":"release-mutex"}),e.step("refresh-with-blue",new s.RefreshWithBlue).success("write-session").failure("parse-refresh-with-blue-errors"),e.step("parse-refresh-with-blue-errors",new s.ParseErrors).success(function(){var e=this.data.errors||{},t=e.isPPU&&!e.isMarketingPPU,n=e.isGating,o=this.data.doNotDisturbEnabled;return e.isSecurityFlagged?"logout-security-flagged":o&&this.data.tokenData?"write-session":o&&n?"release-mutex":t?"ppu":n?"gating":this.data.isInvalidRefreshToken?"logout-invalid-refresh":"release-mutex"}),e.step("ppu",new s.PPU).success("write-session").failure("release-mutex"),e.step("gating",new s.Gating).success("release-mutex"),e.step("write-session",new s.WriteSession).success("encode-guest"),e.step("encode-guest",new s.EncodeGuest).success("emit-refresh-events"),e.step("emit-refresh-events",new s.EmitRefreshEvents).success("release-mutex"),e.step("logout-from-other-tab",new s.LogoutFromOtherTab).success("release-mutex"),e.step("logout-no-refresh",new s.LogoutNoRefresh).success("release-mutex"),e.step("logout-security-flagged",new s.LogoutSecurityFlagged).success("release-mutex"),e.step("logout-invalid-refresh",new s.LogoutInvalidRefresh).success("release-mutex"),e.step("release-mutex",new s.ReleaseMutex).success("done"),e}var r=e("workflow"),i=e("utils"),s={ReadToken:e("./steps/read-token"),AquireMutex:e("./steps/aquire-mutex"),CheckRefreshStatus:e("./steps/check-refresh-status"),ReleaseMutex:e("./steps/release-mutex"),CheckDoNotDisturb:e("../shared/steps/check-do-not-disturb"),ReadNavy:e("./steps/read-navy"),RefreshWithToken:e("./steps/refresh-with-token"),RefreshWithBlue:e("./steps/refresh-with-blue"),ParseErrors:e("../../common/shared/steps/parse-errors"),PPU:e("./steps/ppu"),Gating:e("../shared/steps/gating"),Logout:e("./steps/ensure-logged-out")("tokenrefresh"),LogoutInvalidRefresh:e("./steps/ensure-logged-out")("invalidrefresh"),LogoutSecurityFlagged:e("./steps/ensure-logged-out")("securityflagged"),LogoutNoRefresh:e("./steps/ensure-logged-out")("norefresh"),LogoutFromOtherTab:e("./steps/ensure-logged-out")("loggedoutinothertab"),WriteSession:e("./steps/write-session"),EmitRefreshEvents:e("./steps/emit-refresh-events"),EncodeGuest:e("./steps/encode-guest")};t.exports={create:o}},{"../../common/shared/steps/parse-errors":105,"../shared/steps/check-do-not-disturb":142,"../shared/steps/gating":143,"./steps/aquire-mutex":147,"./steps/check-refresh-status":148,"./steps/emit-refresh-events":149,"./steps/encode-guest":150,"./steps/ensure-logged-out":151,"./steps/ppu":152,"./steps/read-navy":153,"./steps/read-token":154,"./steps/refresh-with-blue":155,"./steps/refresh-with-token":156,"./steps/release-mutex":157,"./steps/write-session":158,utils:36,workflow:41}],147:[function(e,t,n){"use strict";var o=e("../../../../components/outer/environment"),r=e("../../../../components/common/mutex");t.exports=e("step").extend({execute:function(){var e=this;e.data.mutex||(e.data.mutex=new r(o.getClientId())),e.data.mutex.aquire(function(){e.success()})}})},{"../../../../components/common/mutex":17,"../../../../components/outer/environment":71,step:42}],148:[function(e,t,n){"use strict";var o=e("session"),r=e("utils"),i=e("../../../../components/outer/environment");t.exports=e("step").extend({execute:function(){var e=this;o.token.read().then(function(t){if(r.get(t,"token.access_token")!==r.get(e.data,"token.access_token"))e.data.refreshStatus="token_refreshed";else{var n=r.get(t,"token.refresh_expires"),o=n&&new Date(n)<new Date,s=r.isEspnClientId(i.getClientId());e.data.refreshStatus=o?s&&e.data.navyValue?"refresh_expired_blue_fallback":"refresh_expired":"needs_refresh"}e.success()},function(){e.data.refreshStatus="logged_out",e.success()})}})},{"../../../../components/outer/environment":71,session:"session",step:42,utils:36}],149:[function(e,t,n){"use strict";var o=e("utils"),r=e("messages");t.exports=e("step").extend({execute:function(){var e=o.get(this.data,"tokenData")||{};r.publish("token.refreshed",{token:e,previousToken:this.data.token}),this.success()}})},{messages:16,step:42,utils:36}],150:[function(e,t,n){"use strict";var o=e("session"),r=e("utils");t.exports=e("step").extend({execute:function(){var e=this,t=r.get(this.data,"token")||{},n=r.get(this.data,"tokenData")||{};o.guest.read({token:t}).then(function(e){return o.guest.write({guest:e.guest,token:n})})["finally"](function(){e.success()})}})},{session:"session",step:42,utils:36}],151:[function(e,t,n){"use strict";{var o=e("session"),r=e("messages"),i=e("utils");e("../../../../components/outer/environment")}t.exports=function(t){return e("step").extend({execute:function(){var e=this;t=t||"UNKNOWN",o.isLoggedIn().then(function(n){n?o.token.readAll().then(function(t){return o.invalidateTokens(t,i.get(e.data,"loggingInfo.correlationId"))})["finally"](function(){o.deleteAll(t).then(e.success.bind(e))}):(r.publish("session.deleted",t),e.success())})}})}},{"../../../../components/outer/environment":71,messages:16,session:"session",step:42,utils:36}],152:[function(e,t,n){"use strict";var o=e("q"),r=e("messages");t.exports=e("step").extend({execute:function(){var e=this,t=o.defer();r.publish("workflow.execute",{name:"ppuLoggedIn",data:{response:e.data.response,loggingInfo:e.data.loggingInfo}},t),t.promise.then(function(t){t.ppuSuccess?e.success():e.failure()})}})},{messages:16,q:1,step:42}],153:[function(e,t,n){"use strict";var o=(e("utils"),e("session"));t.exports=e("step").extend({execute:function(){var e=this;o.navy.read().then(function(t){t&&t.value&&(e.data.navyValue=t.value),e.success()})}})},{session:"session",step:42,utils:36}],154:[function(e,t,n){"use strict";var o=e("session");t.exports=e("step").extend({execute:function(){var e=this;o.token.read().then(function(t){e.data.token=t.token,e.success()},function(){e.failure()})}})},{session:"session",step:42}],155:[function(e,t,n){"use strict";var o=e("dao"),r=e("utils"),i=e("metrics"),s=e("exceptions"),a=e("../../../../components/outer/sleep-timer");t.exports=e("step").extend({execute:function(){function e(e){var n=r.get(t.data,"loggingInfo.breadcrumbs");return{success:e&&e.isServerError?!e.isServerError():!0,error_category:r.get(e,"error.keyCategory"),error_codes:s.getErrorCodes(s.getKeyErrors(e)),info:{context:r.get(t.data,"loggingInfo.context"),timeAwake:a.timeSinceLastSleep(),oldRefresh:r.maskToken(l),refresh:r.maskToken(r.get(e,"data.token.refresh_token")),xhrFailure:e.xhrFailureReason,xhrTimeout:e.xhrTimeout,xhrReady:e.xhrReadyState},trace:n&&n.getTrail(),trace_data:n&&n.getData()}}var t=this,n=r.uuid(),c=r.get(t.data,"loggingInfo.correlationId"),u=r.get(t.data,"loggingInfo.reporting"),d=t.data.navyValue,l=r.get(t.data,"token.refresh_token"),f=i.timed("log:refresh:blue",{conversation_id:n,correlation_id:c,reporting:u});t.data.attemptedRefresh=!0,o.authenticateViaBlueCookie(d,n,c,u).then(function(n){t.data.response=n,r.get(n,"data.token.access_token")&&(t.data.finalResponse=n,t.data.tokenData=n.data.token,t.data.refreshSuccess=!0),t.data.tokenData&&!n.isClientError()?t.success():t.failure(),
f.success(e(n))},function(n){f.success(e(n)),t.data.response=n,t.failure()})}})},{"../../../../components/outer/sleep-timer":89,dao:54,exceptions:14,metrics:63,step:42,utils:36}],156:[function(e,t,n){"use strict";function o(e){var t=i.get(e,"error.errors");return Array.isArray(t)||(t=[]),t.some(function(e){return e&&"AUTHORIZATION_INVALID_REFRESH_TOKEN"===e.code})}var r=e("dao"),i=e("utils"),s=e("metrics"),a=e("exceptions"),c=e("../../../../components/outer/sleep-timer");t.exports=e("step").extend({execute:function(){function e(e){var n=i.get(t.data,"loggingInfo.breadcrumbs");return{success:e&&e.isServerError?!e.isServerError():!0,error_category:i.get(e,"error.keyCategory"),error_codes:a.getErrorCodes(a.getKeyErrors(e)),info:{context:i.get(t.data,"loggingInfo.context"),timeAwake:c.timeSinceLastSleep(),oldRefresh:i.maskToken(l),refresh:i.maskToken(i.get(e,"data.token.refresh_token")),xhrFailure:e.xhrFailureReason,xhrTimeout:e.xhrTimeout,xhrReady:e.xhrReadyState},trace:n&&n.getTrail(),trace_data:n&&n.getData()}}var t=this,n=i.uuid(),u=i.get(t.data,"loggingInfo.correlationId"),d=i.get(t.data,"loggingInfo.reporting"),l=i.get(t.data,"token.refresh_token"),f=s.timed("log:refresh:token",{conversation_id:n,correlation_id:u,reporting:d});t.data.attemptedRefresh=!0,r.refreshAuthorization(l,n,u,d).then(function(n){t.data.response=t.data.finalResponse=n,t.data.isInvalidRefreshToken=o(n),i.get(n,"data.token.access_token")?(t.data.tokenData=n.data.token,t.data.refreshSuccess=!0):f.success(e(n)),t.data.tokenData&&!n.isClientError()?t.success():t.failure()},function(n){f.success(e(n)),t.data.response=n,t.failure()})}})},{"../../../../components/outer/sleep-timer":89,dao:54,exceptions:14,metrics:63,step:42,utils:36}],157:[function(e,t,n){"use strict";t.exports=e("step").extend({execute:function(){this.data.mutex&&this.data.mutex.release(),this.success()}})},{step:42}],158:[function(e,t,n){"use strict";var o=e("utils"),r=e("session");t.exports=e("step").extend({execute:function(){var e=this,t=o.get(e.data,"tokenData")||{},n=new Date(Date.now());t.created=n.toISOString(),t.lastChecked=t.created,t.expires=o.expires(n,t.ttl||0).toISOString(),t.refresh_expires=o.expires(n,t.refresh_ttl||0).toISOString(),r.token.write({token:t}).then(function(t){e.success()},function(){e.failure()})}})},{session:"session",step:42,utils:36}],"session.apiKey":[function(e,t,n){"use strict";var o=e("./shim");t.exports={read:o("responder.apikey.read"),write:o("responder.apikey.write")}},{"./shim":87}],"session.s2":[function(e,t,n){"use strict";function o(e){c.log("outer/session/s2#write");var t=l.defer();return i().then(function(n){var o=new Date;o.setFullYear(o.getFullYear()+33),u.write(n.name,e,n.domain,"/",o),u.read(n.name)!==e&&s()&&u.write(n.name,e,"."+s(),"/",o),t.resolve()}),t.promise}function r(){c.log("outer/session/s2#handleDelete");var e=l.defer();return i().then(function(t){u.remove(t.name,t.domain,"/"),s()&&u.remove(t.name,"."+s(),"/"),u.remove(t.name,window.location.hostname,"/"),e.resolve()}),e.promise}function i(){var e=l.defer();return a.getSite().then(function(t){var n=d.get(t,"clientInfo.s2-namespace"),o=d.get(t,"clientInfo.s2-domain");e.resolve({name:n?n+"_s2":"s2",domain:o?o:window.location.hostname})}),e.promise}function s(){return d.getTLD(window.location.hostname)}var a=(e("./shim"),e("../config")),c=e("logger"),u=e("cookie"),d=e("utils"),l=e("q");t.exports={write:o,"delete":r}},{"../config":70,"./shim":87,cookie:9,logger:15,q:1,utils:36}],"session.swid":[function(e,t,n){"use strict";function o(){return c.resolve({swid:u.read(g),cookieLength:f})}function r(e){return p.test(e)||(e="{"+e+"}"),e}function i(e,t,n){var o=a(),i=new Date;return n="undefined"!=typeof n&&n?"1":"0",i.setFullYear(i.getFullYear()+1),t===!0&&(e=r(e)),u.write(g,e,o,"/",i),u.write(h,n,o,"/",i),c.resolve()}function s(e,t){var n=a(),o=u.read(g);return(!o||p.test(o)&&!e||t)&&(i(d.uuid()),d.deleteCookie(h,n,"/")),c.resolve()}function a(){var e=d.getTLD(window.location.hostname),t=e?"."+e:".go.com";return t}var c=(e("./shim"),e("q")),u=e("cookie"),d=e("utils"),l=e("messages"),f=0,p=/^\{[^}]+\}$/,g="SWID",h="SWID_NT";t.exports={read:o,write:i,anonymize:s},l.subscribe("cookielength",function(e){f=e}),l.subscribe("swid.read",function(){var e=arguments[1];e&&e.resolve&&e.resolve({swid:u.read(g),cookieLength:f})})},{"./shim":87,cookie:9,messages:16,q:1,utils:36}],"session.token":[function(e,t,n){var o=e("./shim"),r=(e("messages"),e("utils"),e("../../../../src/components/outer/environment"),e("q"),e("../../common/session/readAll"));t.exports={read:o("responder.session.read"),readAll:r,write:o("responder.session.write"),"delete":o("responder.session.delete")}},{"../../../../src/components/outer/environment":71,"../../common/session/readAll":28,"./shim":87,messages:16,q:1,utils:36}],"session.unid":[function(e,t,n){function o(e){e=e||window;var t=r.defer();return e.unid&&e.unid.getData?e.unid.getData(function(e){t.resolve(e)}):t.resolve(),t.promise}var r=e("q");t.exports={read:o}},{q:1}],session:[function(e,t,n){"use strict";var o=(e("./shim"),e("./guest")),r=e("./token"),i=e("./obo");t.exports={guest:{read:o.read,write:o.write},token:{read:r.read,readAll:r.readAll,write:r.write},obo:{read:i.read,"delete":i["delete"]},deleteAll:e("./delete-all"),trustState:e("./trust-state"),s2:e("./s2"),dob:e("./dob"),authenticator:e("./authenticator"),apiKey:e("./api-key"),swid:e("./swid"),isLoggedIn:e("./is-logged-in"),blueCookie:e("./blue-cookie"),navy:e("./navy"),identifier:e("./idn"),invalidateTokens:e("./invalidate-tokens").invalidate,unid:e("./unid")}},{"./api-key":"session.apiKey","./authenticator":77,"./blue-cookie":78,"./delete-all":79,"./dob":80,"./guest":81,"./idn":82,"./invalidate-tokens":83,"./is-logged-in":84,"./navy":85,"./obo":86,"./s2":"session.s2","./shim":87,"./swid":"session.swid","./token":"session.token","./trust-state":88,"./unid":"session.unid"}]},{},[101,97,"session","session.apiKey","session.s2","session.token","session.swid","session.unid"]);
//# sourceMappingURL=DisneyID.js.map