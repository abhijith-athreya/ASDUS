function FastClick(a,b){"use strict";function c(a,b){return function(){return a.apply(b,arguments)}}var d;if(b=b||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=b.touchBoundary||10,this.layer=a,this.tapDelay=b.tapDelay||200,!FastClick.notNeeded(a)){for(var e=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],f=this,g=0,h=e.length;h>g;g++)f[e[g]]=c(f[e[g]],f);deviceIsAndroid&&(a.addEventListener("mouseover",this.onMouse,!0),a.addEventListener("mousedown",this.onMouse,!0),a.addEventListener("mouseup",this.onMouse,!0)),a.addEventListener("click",this.onClick,!0),a.addEventListener("touchstart",this.onTouchStart,!1),a.addEventListener("touchmove",this.onTouchMove,!1),a.addEventListener("touchend",this.onTouchEnd,!1),a.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(a.removeEventListener=function(b,c,d){var e=Node.prototype.removeEventListener;"click"===b?e.call(a,b,c.hijacked||c,d):e.call(a,b,c,d)},a.addEventListener=function(b,c,d){var e=Node.prototype.addEventListener;"click"===b?e.call(a,b,c.hijacked||(c.hijacked=function(a){a.propagationStopped||c(a)}),d):e.call(a,b,c,d)}),"function"==typeof a.onclick&&(d=a.onclick,a.addEventListener("click",function(a){d(a)},!1),a.onclick=null)}}"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a){function b(b,d,g,h,i,j){var i=i||function(){},j=parseFloat(j);"function"==typeof g&&(i=g,g=void 0),"function"==typeof h&&(i=h,h=void 0),void 0===g&&(g=400),void 0===h?h=f:a.inArray(h,e)||(h=f);var k="opacity "+g+"ms "+h;if(b.css({opacity:"0",filter:"alpha(opacity=0)","-webkit-transition":k,"-webkit-backface-visibility":"hidden","-moz-transition":k,"-o-transition":k,"-ms-transition":k,transition:k}),b.css("display",""),b.is(":visible")||b.show(),"in"==d)b.css("opacity",1).css("filter","alpha(opacity=100)");else if("out"==d)b.css("opacity",0).css("filter","alpha(opacity=0)");else if("to"==d&&NaN!=j){b.css("opacity",j);var l=c(j);b.css("filter","alpha(opacity="+l+")")}setTimeout(function(){i(b)},g)}function c(b){var b=parseFloat(b);return NaN==b&&a.error("Bad opacity value"),1===b?100:0===b?0:100*b}var d={_in:function(a,c,d){return b(this,"in",a,c,d),this},_out:function(a,c,d){return b(this,"out",a,c,d),this},_to:function(a,c,d,e){return b(this,"to",a,d,e,c),this},_toggle:function(a,c,d){return this.css("opacity")>=1?b(this,"out",a,c,d):this.css("opacity")<=0&&b(this,"in",a,c,d),this}},e=["default","linear","ease","ease-in","ease-out","ease-in-out","cubic-bezier"],f="ease";a.fn.cssFade=function(b){var c="_"+b;return d[c]?d[c].apply(this,Array.prototype.slice.call(arguments,1)):void(b?a.error("Invalid fade method. Options: (in, out, to, toggle)."):a.error("Must pass a valid fade method: (in, out, to, toggle)."))}}(jQuery),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.5.2";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?void 0:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-(1/0);var d={computed:-(1/0),value:-(1/0)};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return arguments.length<2||c?a[x.random(a.length-1)]:x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={},f=null==c?x.identity:B(c);return y(b,function(c,g){var h=f.call(d,c,g,b);a(e,h,c)}),e}};x.groupBy=C(function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=a.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var a,b=this,c=b.Backbone,d=[],e=d.push,f=d.slice,g=d.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.0.0";var h=b._;h||"undefined"==typeof require||(h=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var i=a.Events={on:function(a,b,c){if(!k(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!k(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,i,j,l,m;if(!this._events||!k(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:h.keys(this._events),i=0,j=g.length;j>i;i++)if(a=g[i],f=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=f.length;m>l;l++)e=f[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=f.call(arguments,1);if(!k(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&l(c,b),d&&l(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},j=/\s+/,k=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(j.test(c)){for(var f=c.split(j),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},l=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},m={listenTo:"on",listenToOnce:"once"};h.each(m,function(a,b){i[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=h.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),i.bind=i.on,i.unbind=i.off,h.extend(a,i);var n=a.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=h.uniqueId("c"),this.attributes={},h.extend(this,h.pick(b,o)),b.parse&&(d=this.parse(d,b)||{}),(c=h.result(this,"defaults"))&&(d=h.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},o=["url","urlRoot","collection"];h.extend(n.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),void b.trigger("sync",b,d,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,d&&(!c||!c.wait)&&!this.set(d,c))return!1;if(c=h.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=g;var b=i.parse(a,c);return c.wait&&(b=h.extend(d||{},b)),h.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),void i.trigger("sync",i,a,c))},L(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;L(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||K();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,h.extend(b||{},{validationError:c})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(a){n.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.attributes),h[a].apply(h,b)}});var q=a.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))},r={add:!0,remove:!0,merge:!0},s={add:!0,merge:!1,remove:!1};h.extend(q.prototype,i,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},s))},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=h.defaults(b||{},r),b.parse&&(a=this.parse(a,b)),h.isArray(a)||(a=a?[a]:[]);var c,d,f,i,j,k=b.at,l=this.comparator&&null==k&&b.sort!==!1,m=h.isString(this.comparator)?this.comparator:null,n=[],o=[],p={};for(c=0,d=a.length;d>c;c++)(f=this._prepareModel(a[c],b))&&((i=this.get(f))?(b.remove&&(p[i.cid]=!0),b.merge&&(i.set(f.attributes,b),l&&!j&&i.hasChanged(m)&&(j=!0))):b.add&&(n.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f)));if(b.remove){for(c=0,d=this.length;d>c;++c)p[(f=this.models[c]).cid]||o.push(f);o.length&&this.remove(o,b)}if(n.length&&(l&&(j=!0),this.length+=n.length,null!=k?g.apply(this.models,[k,0].concat(n)):e.apply(this.models,n)),j&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=n.length;d>c;c++)(f=n[c]).trigger("add",f,this,b);return j&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?h.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof n)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var t=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(t,function(a){q.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var u=["groupBy","countBy","sortBy"];h.each(u,function(a){q.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var v=a.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(v.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];
if(h.isFunction(c)||(c=this[a[b]]),c){var d=b.match(w),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,x)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var b=h.extend({},h.result(this,"attributes"));this.id&&(b.id=h.result(this,"id")),this.className&&(b["class"]=h.result(this,"className"));var c=a.$("<"+h.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=y[b];h.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var f={type:e,dataType:"json"};if(d.url||(f.url=h.result(c,"url")||K()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",d.emulateJSON&&(f.data._method=e);var g=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),g?g.apply(this,arguments):void 0}}"GET"===f.type||d.emulateJSON||(f.processData=!1),"PATCH"!==f.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(h.extend(f,d));return c.trigger("request",c,i,d),i};var y={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var z=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,C=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(z.prototype,i,{initialize:function(){},route:function(b,c,d){h.isRegExp(b)||(b=this._routeToRegExp(b)),h.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=h.result(this,"routes");for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(D,"\\$&").replace(A,"(?:$1)?").replace(B,function(a,b){return b?a:"([^/]+)"}).replace(C,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var E=a.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;E.started=!1,h.extend(E.prototype,i,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(b){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=h.extend({},{root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=H.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(G,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var f=this.location,g=f.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&g&&f.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+f.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment?!1:(this.iframe&&this.navigate(b),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=h.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!E.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new E;var J=function(a,b){var c,d=this;c=a&&h.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},h.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&h.extend(c.prototype,a),c.__super__=d.prototype,c};n.extend=q.extend=z.extend=v.extend=E.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this);var Handlebars={};!function(a,b){a.VERSION="1.0.0",a.COMPILER_REVISION=4,a.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},a.helpers={},a.partials={};var c=Object.prototype.toString,d="[object Function]",e="[object Object]";a.registerHelper=function(b,d,f){if(c.call(b)===e){if(f||d)throw new a.Exception("Arg not supported with multiple helpers");a.Utils.extend(this.helpers,b)}else f&&(d.not=f),this.helpers[b]=d},a.registerPartial=function(b,d){c.call(b)===e?a.Utils.extend(this.partials,b):this.partials[b]=d},a.registerHelper("helperMissing",function(a){if(2===arguments.length)return b;throw new Error("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,e){var f=e.inverse||function(){},g=e.fn,h=c.call(b);return h===d&&(b=b.call(this)),b===!0?g(this):b===!1||null==b?f(this):"[object Array]"===h?b.length>0?a.helpers.each(b,e):f(this):g(b)}),a.K=function(){},a.createFrame=Object.create||function(b){a.K.prototype=b;var c=new a.K;return a.K.prototype=null,c},a.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(b,c){if(a.logger.level<=b){var d=a.logger.methodMap[b];"undefined"!=typeof console&&console[d]&&console[d].call(console,c)}}},a.log=function(b,c){a.logger.log(b,c)},a.registerHelper("each",function(b,e){var f,g=e.fn,h=e.inverse,i=0,j="",k=c.call(b);if(k===d&&(b=b.call(this)),e.data&&(f=a.createFrame(e.data)),b&&"object"==typeof b)if(b instanceof Array)for(var l=b.length;l>i;i++)f&&(f.index=i),j+=g(b[i],{data:f});else for(var m in b)b.hasOwnProperty(m)&&(f&&(f.key=m),j+=g(b[m],{data:f}),i++);return 0===i&&(j=h(this)),j}),a.registerHelper("if",function(b,e){var f=c.call(b);return f===d&&(b=b.call(this)),!b||a.Utils.isEmpty(b)?e.inverse(this):e.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn})}),a.registerHelper("with",function(b,e){var f=c.call(b);return f===d&&(b=b.call(this)),a.Utils.isEmpty(b)?void 0:e.fn(b)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)});var f=["description","fileName","lineNumber","message","name","number","stack"];a.Exception=function(a){for(var b=Error.prototype.constructor.apply(this,arguments),c=0;c<f.length;c++)this[f[c]]=b[f[c]]},a.Exception.prototype=new Error,a.SafeString=function(a){this.string=a},a.SafeString.prototype.toString=function(){return this.string.toString()};var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},h=/[&<>"'`]/g,i=/[&<>"'`]/,j=function(a){return g[a]||"&amp;"};a.Utils={extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},escapeExpression:function(b){return b instanceof a.SafeString?b.toString():null==b||b===!1?"":(b=b.toString(),i.test(b)?b.replace(h,j):b)},isEmpty:function(a){return a||0===a?"[object Array]"===c.call(a)&&0===a.length?!0:!1:!0}},a.VM={template:function(b){var c={escapeExpression:a.Utils.escapeExpression,invokePartial:a.VM.invokePartial,programs:[],program:function(b,c,d){var e=this.programs[b];return d?e=a.VM.program(b,c,d):e||(e=this.programs[b]=a.VM.program(b,c)),e},merge:function(b,c){var d=b||c;return b&&c&&(d={},a.Utils.extend(d,c),a.Utils.extend(d,b)),d},programWithDepth:a.VM.programWithDepth,noop:a.VM.noop,compilerInfo:null};return function(d,e){e=e||{};var f=b.call(c,a,d,e.helpers,e.partials,e.data),g=c.compilerInfo||[],h=g[0]||1,i=a.COMPILER_REVISION;if(h!==i){if(i>h){var j=a.REVISION_CHANGES[i],k=a.REVISION_CHANGES[h];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+j+") or downgrade your runtime to an older version ("+k+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+g[1]+")."}return f}},programWithDepth:function(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e},program:function(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d},noop:function(){return""},invokePartial:function(c,d,e,f,g,h){var i={helpers:f,partials:g,data:h};if(c===b)throw new a.Exception("The partial "+d+" could not be found");if(c instanceof Function)return c(e,i);if(a.compile)return g[d]=a.compile(c,{data:h!==b}),g[d](e,i);throw new a.Exception("The partial "+d+" could not be compiled when running in runtime-only mode")}},a.template=a.VM.template}(Handlebars);var Mustache;!function(a){"undefined"!=typeof module&&module.exports?module.exports=a:"function"==typeof define?define(a):Mustache=a}(function(){function a(a,b){return RegExp.prototype.test.call(a,b)}function b(b){return!a(p,b)}function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function d(a){return String(a).replace(/[&<>"'\/]/g,function(a){return u[a]})}function e(a){this.string=a,this.tail=a,this.pos=0}function f(a,b){this.view=a,this.parent=b,this.clearCache()}function g(){this.clearCache()}function h(a){for(var b,c=a[3],d=c;(b=a[4])&&b.length;)a=b[b.length-1],d=a[3];return[c,d]}function i(a){function b(a,b,d){if(!c[a]){var e=i(b);c[a]=function(a,b){return e(a,b,d)}}return c[a]}var c={};return function(c,d,e){for(var f,g,i="",j=0,k=a.length;k>j;++j)switch(f=a[j],f[0]){case"#":g=e.slice.apply(e,h(f)),i+=c._section(f[1],d,g,b(j,f[4],e));break;case"^":i+=c._inverted(f[1],d,b(j,f[4],e));break;case">":i+=c._partial(f[1],d);break;case"&":i+=c._name(f[1],d);break;case"name":i+=c._escaped(f[1],d);break;case"text":i+=f[1]}return i}}function j(a){for(var b,c,d=[],e=d,f=[],g=0;g<a.length;++g)switch(b=a[g],b[0]){case"#":case"^":b[4]=[],f.push(b),e.push(b),e=b[4];break;case"/":if(0===f.length)throw new Error("Unopened section: "+b[1]);if(c=f.pop(),c[1]!==b[1])throw new Error("Unclosed section: "+c[1]);e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}if(c=f.pop())throw new Error("Unclosed section: "+c[1]);return d}function k(a){for(var b,c,d=0;d<a.length;++d)b=a[d],c&&"text"===c[0]&&"text"===b[0]?(c[1]+=b[1],c[3]=b[3],a.splice(d--,1)):c=b}function l(a){if(2!==a.length)throw new Error("Invalid tags: "+a.join(" "));return[new RegExp(c(a[0])+"\\s*"),new RegExp("\\s*"+c(a[1]))]}var m={};m.name="mustache.js",m.version="0.7.0",m.tags=["{{","}}"],m.Scanner=e,m.Context=f,m.Writer=g;var n=/\s*/,o=/\s+/,p=/\S/,q=/\s*=/,r=/\s*\}/,s=/#|\^|\/|>|\{|&|=|!/,t=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};m.escape=d,e.prototype.eos=function(){return""===this.tail},e.prototype.scan=function(a){var b=this.tail.match(a);return b&&0===b.index?(this.tail=this.tail.substring(b[0].length),this.pos+=b[0].length,b[0]):""},e.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c),this.pos+=c}return b},f.make=function(a){return a instanceof f?a:new f(a)},f.prototype.clearCache=function(){this._cache={}},f.prototype.push=function(a){return new f(a,this)},f.prototype.lookup=function(a){var b=this._cache[a];if(!b){if("."===a)b=this.view;else for(var c=this;c;){if(a.indexOf(".")>0){var d=a.split("."),e=0;for(b=c.view;b&&e<d.length;)b=b[d[e++]]}else b=c.view[a];if(null!=b)break;c=c.parent}this._cache[a]=b}return"function"==typeof b&&(b=b.call(this.view)),b},g.prototype.clearCache=function(){this._cache={},this._partialCache={}},g.prototype.compile=function(a,b){var c=this._cache[a];if(!c){var d=m.parse(a,b);c=this._cache[a]=this.compileTokens(d,a)}return c},g.prototype.compilePartial=function(a,b,c){var d=this.compile(b,c);return this._partialCache[a]=d,d},g.prototype.compileTokens=function(a,b){var c=i(a),d=this;return function(a,e){if(e)if("function"==typeof e)d._loadPartial=e;else for(var g in e)d.compilePartial(g,e[g]);return c(d,f.make(a),b)}},g.prototype.render=function(a,b,c){return this.compile(a)(b,c)},g.prototype._section=function(a,b,c,d){var e=b.lookup(a);switch(typeof e){case"object":if(t(e)){for(var f="",g=0,h=e.length;h>g;++g)f+=d(this,b.push(e[g]));return f}return e?d(this,b.push(e)):"";case"function":var i=this,j=function(a){return i.render(a,b)};return e.call(b.view,c,j)||"";default:if(e)return d(this,b)}return""},g.prototype._inverted=function(a,b,c){var d=b.lookup(a);return!d||t(d)&&0===d.length?c(this,b):""},g.prototype._partial=function(a,b){a in this._partialCache||!this._loadPartial||this.compilePartial(a,this._loadPartial(a));var c=this._partialCache[a];return c?c(b):""},g.prototype._name=function(a,b){var c=b.lookup(a);return"function"==typeof c&&(c=c.call(b.view)),null==c?"":String(c)},g.prototype._escaped=function(a,b){return m.escape(this._name(a,b))},m.parse=function(a,d){function f(){if(x&&!y)for(;w.length;)v.splice(w.pop(),1);else w=[];x=!1,y=!1}d=d||m.tags;for(var g,h,i,p,t=l(d),u=new e(a),v=[],w=[],x=!1,y=!1;!u.eos();){if(g=u.pos,i=u.scanUntil(t[0]))for(var z=0,A=i.length;A>z;++z)p=i.charAt(z),b(p)?w.push(v.length):y=!0,v.push(["text",p,g,g+1]),g+=1,"\n"===p&&f();if(g=u.pos,!u.scan(t[0]))break;if(x=!0,h=u.scan(s)||"name",u.scan(n),"="===h)i=u.scanUntil(q),u.scan(q),u.scanUntil(t[1]);else if("{"===h){var B=new RegExp("\\s*"+c("}"+d[1]));i=u.scanUntil(B),u.scan(r),u.scanUntil(t[1]),h="&"}else i=u.scanUntil(t[1]);if(!u.scan(t[1]))throw new Error("Unclosed tag at "+u.pos);v.push([h,i,g,u.pos]),("name"===h||"{"===h||"&"===h)&&(y=!0),"="===h&&(d=i.split(o),t=l(d))}return k(v),j(v)};var v=new g;return m.clearCache=function(){return v.clearCache()},m.compile=function(a,b){return v.compile(a,b)},m.compilePartial=function(a,b,c){return v.compilePartial(a,b,c)},m.compileTokens=function(a,b){return v.compileTokens(a,b)},m.render=function(a,b,c){return v.render(a,b,c)},m.to_html=function(a,b,c,d){var e=m.render(a,b,c);return"function"!=typeof d?e:void d(e)},m}()),function(a){function b(){var a=document.createElement("input"),b="onpaste";return a.setAttribute(b,""),"function"==typeof a[b]?"paste":"input"}var c,d=b()+".mask",e=navigator.userAgent,f=/iphone/i.test(e),g=/android/i.test(e);a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},a.fn.extend({caret:function(a,b){var c;return 0===this.length||this.is(":hidden")?void 0:"number"==typeof a?(b="number"==typeof b?b:a,this.each(function(){this.setSelectionRange?this.setSelectionRange(a,b):this.createTextRange&&(c=this.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select())})):(this[0].setSelectionRange?(a=this[0].selectionStart,b=this[0].selectionEnd):document.selection&&document.selection.createRange&&(c=document.selection.createRange(),a=0-c.duplicate().moveStart("character",-1e5),b=a+c.text.length),{begin:a,end:b})},unmask:function(){return this.trigger("unmask")},mask:function(b,e){var h,i,j,k,l,m;return!b&&this.length>0?(h=a(this[0]),h.data(a.mask.dataName)()):(e=a.extend({placeholder:a.mask.placeholder,completed:null},e),i=a.mask.definitions,j=[],k=m=b.length,l=null,a.each(b.split(""),function(a,b){"?"==b?(m--,k=a):i[b]?(j.push(RegExp(i[b])),null===l&&(l=j.length-1)):j.push(null)}),this.trigger("unmask").each(function(){function h(a){for(;m>++a&&!j[a];);return a}function n(a){for(;--a>=0&&!j[a];);return a}function o(a,b){var c,d;if(!(0>a)){for(c=a,d=h(b);m>c;c++)if(j[c]){if(!(m>d&&j[c].test(w[d])))break;w[c]=w[d],w[d]=e.placeholder,d=h(d)}t(),v.caret(Math.max(l,a))}}function p(a){var b,c,d,f;for(b=a,c=e.placeholder;m>b;b++)if(j[b]){if(d=h(b),f=w[b],w[b]=c,!(m>d&&j[d].test(f)))break;c=f}}function q(a){var b,c,d,e=a.which;8===e||46===e||f&&127===e?(b=v.caret(),c=b.begin,d=b.end,0===d-c&&(c=46!==e?n(c):d=h(c-1),d=46===e?h(d):d),s(c,d),o(c,d-1),a.preventDefault()):27==e&&(v.val(x),v.caret(0,u()),a.preventDefault())}function r(b){var c,d,f,i=b.which,k=v.caret();b.ctrlKey||b.altKey||b.metaKey||32>i||i&&(0!==k.end-k.begin&&(s(k.begin,k.end),o(k.begin,k.end-1)),c=h(k.begin-1),m>c&&(d=String.fromCharCode(i),j[c].test(d)&&(p(c),w[c]=d,t(),f=h(c),g?setTimeout(a.proxy(a.fn.caret,v,f),0):v.caret(f),e.completed&&f>=m&&e.completed.call(v))),b.preventDefault())}function s(a,b){var c;for(c=a;b>c&&m>c;c++)j[c]&&(w[c]=e.placeholder)}function t(){v.val(w.join(""))}function u(a){var b,c,d=v.val(),f=-1;for(b=0,pos=0;m>b;b++)if(j[b]){for(w[b]=e.placeholder;pos++<d.length;)if(c=d.charAt(pos-1),j[b].test(c)){w[b]=c,f=b;break}if(pos>d.length)break}else w[b]===d.charAt(pos)&&b!==k&&(pos++,f=b);return a?t():k>f+1?(v.val(""),s(0,m)):(t(),v.val(v.val().substring(0,f+1))),k?b:l}var v=a(this),w=a.map(b.split(""),function(a){return"?"!=a?i[a]?e.placeholder:a:void 0}),x=v.val();v.data(a.mask.dataName,function(){return a.map(w,function(a,b){return j[b]&&a!=e.placeholder?a:null}).join("")}),v.attr("readonly")||v.one("unmask",function(){v.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){clearTimeout(c);var a;x=v.val(),a=u(),c=setTimeout(function(){t(),a==b.length?v.caret(0,a):v.caret(a)},10)}).bind("blur.mask",function(){u(),v.val()!=x&&v.change()}).bind("keydown.mask",q).bind("keypress.mask",r).bind(d,function(){setTimeout(function(){var a=u(!0);v.caret(a),e.completed&&a==v.val().length&&e.completed.call(v)},0)}),u()}))}})}(jQuery),window.Modernizr=function(a,b,c){function d(a){t.cssText=a}function e(a,b){return d(x.join(a+";")+(b||""))}function f(a,b){return typeof a===b}function g(a,b){return!!~(""+a).indexOf(b)}function h(a,b){for(var d in a){var e=a[d];if(!g(e,"-")&&t[e]!==c)return"pfx"==b?e:!0}return!1}function i(a,b,d){for(var e in a){var g=b[a[e]];if(g!==c)return d===!1?a[e]:f(g,"function")?g.bind(d||b):g}return!1}function j(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+z.join(d+" ")+d).split(" ");return f(b,"string")||f(b,"undefined")?h(e,b):(e=(a+" "+A.join(d+" ")+d).split(" "),i(e,b,c))}function k(){o.input=function(c){for(var d=0,e=c.length;e>d;d++)E[c[d]]=!!(c[d]in u);return E.list&&(E.list=!(!b.createElement("datalist")||!a.HTMLDataListElement)),E}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),o.inputtypes=function(a){for(var d,e,f,g=0,h=a.length;h>g;g++)u.setAttribute("type",e=a[g]),d="text"!==u.type,d&&(u.value=v,u.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(e)&&u.style.WebkitAppearance!==c?(q.appendChild(u),f=b.defaultView,d=f.getComputedStyle&&"textfield"!==f.getComputedStyle(u,null).WebkitAppearance&&0!==u.offsetHeight,q.removeChild(u)):/^(search|tel)$/.test(e)||(d=/^(url|email)$/.test(e)?u.checkValidity&&u.checkValidity()===!1:u.value!=v)),D[a[g]]=!!d;return D}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var l,m,n="2.7.1",o={},p=!0,q=b.documentElement,r="modernizr",s=b.createElement(r),t=s.style,u=b.createElement("input"),v=":)",w={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),y="Webkit Moz O ms",z=y.split(" "),A=y.toLowerCase().split(" "),B={svg:"http://www.w3.org/2000/svg"},C={},D={},E={},F=[],G=F.slice,H=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:r+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',r,'">',a,"</style>"].join(""),j.id=r,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=q.style.overflow,q.style.overflow="hidden",q.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),q.style.overflow=i),!!g},I=function(){function a(a,e){e=e||b.createElement(d[a]||"div"),a="on"+a;var g=a in e;return g||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(a,""),g=f(e[a],"function"),f(e[a],"undefined")||(e[a]=c),e.removeAttribute(a))),e=null,g}var d={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return a}(),J={}.hasOwnProperty;m=f(J,"undefined")||f(J.call,"undefined")?function(a,b){return b in a&&f(a.constructor.prototype[b],"undefined")}:function(a,b){return J.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=G.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(G.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(G.call(arguments)))};return d}),C.flexbox=function(){return j("flexWrap")},C.canvas=function(){var a=b.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},C.canvastext=function(){return!(!o.canvas||!f(b.createElement("canvas").getContext("2d").fillText,"function"))},C.webgl=function(){return!!a.WebGLRenderingContext},C.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:H(["@media (",x.join("touch-enabled),("),r,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},C.geolocation=function(){return"geolocation"in navigator},C.postmessage=function(){return!!a.postMessage},C.websqldatabase=function(){return!!a.openDatabase},C.indexedDB=function(){return!!j("indexedDB",a)},C.hashchange=function(){return I("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},C.history=function(){return!(!a.history||!history.pushState)},C.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},C.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},C.rgba=function(){return d("background-color:rgba(150,255,150,.5)"),g(t.backgroundColor,"rgba")},C.hsla=function(){return d("background-color:hsla(120,40%,100%,.5)"),g(t.backgroundColor,"rgba")||g(t.backgroundColor,"hsla")},C.multiplebgs=function(){return d("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(t.background)},C.backgroundsize=function(){return j("backgroundSize")},C.borderimage=function(){return j("borderImage")},C.borderradius=function(){return j("borderRadius")},C.boxshadow=function(){return j("boxShadow")},C.textshadow=function(){return""===b.createElement("div").style.textShadow},C.opacity=function(){return e("opacity:.55"),/^0.55$/.test(t.opacity)},C.cssanimations=function(){return j("animationName")},C.csscolumns=function(){return j("columnCount")},C.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return d((a+"-webkit- ".split(" ").join(b+a)+x.join(c+a)).slice(0,-a.length)),g(t.backgroundImage,"gradient")},C.cssreflections=function(){return j("boxReflect")},C.csstransforms=function(){return!!j("transform")},C.csstransforms3d=function(){var a=!!j("perspective");return a&&"webkitPerspective"in q.style&&H("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=9===b.offsetLeft&&3===b.offsetHeight}),a},C.csstransitions=function(){return j("transition")},C.fontface=function(){var a;return H('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&0===g.indexOf(d.split(" ")[0])}),a},C.generatedcontent=function(){var a;return H(["#",r,"{font:0/0 a}#",r,':after{content:"',v,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},C.video=function(){var a=b.createElement("video"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(d){}return c},C.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(d){}return c},C.localstorage=function(){try{return localStorage.setItem(r,r),localStorage.removeItem(r),!0}catch(a){return!1}},C.sessionstorage=function(){try{return sessionStorage.setItem(r,r),sessionStorage.removeItem(r),!0}catch(a){return!1}},C.webworkers=function(){return!!a.Worker},C.applicationcache=function(){return!!a.applicationCache},C.svg=function(){return!!b.createElementNS&&!!b.createElementNS(B.svg,"svg").createSVGRect},C.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==B.svg},C.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(w.call(b.createElementNS(B.svg,"animate")))},C.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(w.call(b.createElementNS(B.svg,"clipPath")))};for(var K in C)m(C,K)&&(l=K.toLowerCase(),o[l]=C[K](),F.push((o[l]?"":"no-")+l));return o.input||k(),o.addTest=function(a,b){if("object"==typeof a)for(var d in a)m(a,d)&&o.addTest(d,a[d]);else{if(a=a.toLowerCase(),o[a]!==c)return o;b="function"==typeof b?b():b,"undefined"!=typeof p&&p&&(q.className+=" "+(b?"":"no-")+a),o[a]=b}return o},d(""),s=u=null,function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=s.elements;return"string"==typeof a?a.split(" "):a}function e(a){var b=r[a[p]];return b||(b={},q++,a[p]=q,r[q]=b),b}function f(a,c,d){if(c||(c=b),k)return c.createElement(a);d||(d=e(c));var f;return f=d.cache[a]?d.cache[a].cloneNode():o.test(a)?(d.cache[a]=d.createElem(a)).cloneNode():d.createElem(a),!f.canHaveChildren||n.test(a)||f.tagUrn?f:d.frag.appendChild(f)}function g(a,c){if(a||(a=b),k)return a.createDocumentFragment();c=c||e(a);for(var f=c.frag.cloneNode(),g=0,h=d(),i=h.length;i>g;g++)f.createElement(h[g]);return f}function h(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?f(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function i(a){a||(a=b);var d=e(a);return!s.shivCSS||j||d.hasCSS||(d.hasCSS=!!c(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||h(a,d),a}var j,k,l="3.7.0",m=a.html5||{},n=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,o=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p="_html5shiv",q=0,r={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",j="hidden"in a,k=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return"undefined"==typeof a.cloneNode||"undefined"==typeof a.createDocumentFragment||"undefined"==typeof a.createElement}()}catch(c){j=!0,k=!0}}();var s={elements:m.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:l,shivCSS:m.shivCSS!==!1,supportsUnknownElements:k,shivMethods:m.shivMethods!==!1,type:"default",shivDocument:i,createElement:f,createDocumentFragment:g};a.html5=s,i(b)}(this,b),o._version=n,o._prefixes=x,o._domPrefixes=A,o._cssomPrefixes=z,o.hasEvent=I,o.testProp=function(a){return h([a])},o.testAllProps=j,o.testStyles=H,o.prefixed=function(a,b,c){return b?j(a,b,c):j(a,"pfx")},q.className=q.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(p?" js "+F.join(" "):""),o}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==q.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=r.shift();s=1,a?a.t?o(function(){("c"==a.t?m.injectCss:m.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):s=0}function i(a,c,d,e,f,i,j){function k(b){if(!n&&g(l.readyState)&&(t.r=n=1,!s&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&o(function(){v.removeChild(l)},50);for(var d in A[c])A[c].hasOwnProperty(d)&&A[c][d].onload()}}var j=j||m.errorTimeout,l=b.createElement(a),n=0,q=0,t={t:d,s:c,e:f,a:i,x:j};1===A[c]&&(q=1,A[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,q)},r.splice(e,0,t),"img"!=a&&(q||2===A[c]?(v.insertBefore(l,u?null:p),o(k,j)):A[c].push(l))}function j(a,b,c,d,f){return s=0,b=b||"j",e(a)?i("c"==b?x:w,a,b,this.i++,c,d,f):(r.splice(this.i++,0,a),1==r.length&&h()),this}function k(){var a=m;return a.loader={load:j,i:0},a}var l,m,n=b.documentElement,o=a.setTimeout,p=b.getElementsByTagName("script")[0],q={}.toString,r=[],s=0,t="MozAppearance"in n.style,u=t&&!!b.createRange().compareNode,v=u?n:p.parentNode,n=a.opera&&"[object Opera]"==q.call(a.opera),n=!!b.attachEvent&&!n,w=t?"object":n?"script":"img",x=n?"script":w,y=Array.isArray||function(a){
return"[object Array]"==q.call(a)},z=[],A={},B={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}};m=function(a){function b(a){var b,c,d,a=a.split("!"),e=z.length,f=a.pop(),g=a.length,f={url:f,origUrl:f,prefixes:a};for(c=0;g>c;c++)d=a[c].split("="),(b=B[d.shift()])&&(f=b(f,d));for(c=0;e>c;c++)f=z[c](f);return f}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(A[i.url]?i.noexec=!0:A[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),A[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}),g(a,l,b,0,j);else if(Object(a)===a)for(i in h=function(){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}(),a)a.hasOwnProperty(i)&&(!c&&!--h&&(d(l)?l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}:l[i]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),n()}}(m[i])),g(a[i],l,b,i,j))}else!c&&n()}var h,i,j=!!a.test,k=a.load||a.both,l=a.callback||f,m=l,n=a.complete||f;c(j?a.yep:a.nope,!!k),k&&c(k)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(y(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):y(j)?m(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},m.addPrefix=function(a,b){B[a]=b},m.addFilter=function(a){z.push(a)},m.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",l=function(){b.removeEventListener("DOMContentLoaded",l,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k,l,n=b.createElement("script"),e=e||m.errorTimeout;n.src=a;for(l in d)n.setAttribute(l,d[l]);c=j?h:c||f,n.onreadystatechange=n.onload=function(){!k&&g(n.readyState)&&(k=1,c(),n.onload=n.onreadystatechange=null)},o(function(){k||(k=1,c(1))},e),i?n.onload():p.parentNode.insertBefore(n,p)},a.yepnope.injectCss=function(a,c,d,e,g,i){var j,e=b.createElement("link"),c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(p.parentNode.insertBefore(e,p),o(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("fileinput",function(){var a=document.createElement("input");return a.type="file",!a.disabled}),Modernizr.addTest("blobconstructor",function(){try{return!!new Blob}catch(a){return!1}}),function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=l.elements;return"string"==typeof a?a.split(" "):a}function e(a){var b={},c=a.createElement,e=a.createDocumentFragment,f=e();a.createElement=function(a){if(!l.shivMethods)return c(a);var d;return d=b[a]?b[a].cloneNode():k.test(a)?(b[a]=c(a)).cloneNode():c(a),d.canHaveChildren&&!j.test(a)?f.appendChild(d):d},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/\w+/g,function(a){return c(a),f.createElement(a),'c("'+a+'")'})+");return n}")(l,f)}function f(a){var b;return a.documentShived?a:(l.shivCSS&&!g&&(b=!!c(a,"article,aside,details,figcaption,figure,footer,header,hgroup,nav,section{display:block}audio{display:none}canvas,video{display:inline-block;*display:inline;*zoom:1}[hidden]{display:none}audio[controls]{display:inline-block;*display:inline;*zoom:1}mark{background:#FF0;color:#000}")),h||(b=!e(a)),b&&(a.documentShived=b),a)}var g,h,i=a.html5||{},j=/^<|^(?:button|form|map|select|textarea|object|iframe|option|optgroup)$/i,k=/^<|^(?:a|b|button|code|div|fieldset|form|h1|h2|h3|h4|h5|h6|i|iframe|img|input|label|li|link|ol|option|p|param|q|script|select|span|strong|style|table|tbody|td|textarea|tfoot|th|thead|tr|ul)$/i;!function(){var c=b.createElement("a");c.innerHTML="<xyz></xyz>",g="hidden"in c,g&&"function"==typeof injectElementWithStyles&&injectElementWithStyles("#modernizr{}",function(b){b.hidden=!0,g="none"==(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle).display}),h=1==c.childNodes.length||function(){try{b.createElement("a")}catch(a){return!0}var c=b.createDocumentFragment();return"undefined"==typeof c.cloneNode||"undefined"==typeof c.createDocumentFragment||"undefined"==typeof c.createElement}()}();var l={elements:i.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:i.shivCSS!==!1,shivMethods:i.shivMethods!==!1,type:"default",shivDocument:f};a.html5=l,f(b)}(this,document),function(a){"use strict";function b(b){var c=b.data;b.isDefaultPrevented()||(b.preventDefault(),a(this).ajaxSubmit(c))}function c(b){var c=b.target,d=a(c);if(!d.is("[type=submit],[type=image]")){var e=d.closest("[type=submit]");if(0===e.length)return;c=e[0]}var f=this;if(f.clk=c,"image"==c.type)if(void 0!==b.offsetX)f.clk_x=b.offsetX,f.clk_y=b.offsetY;else if("function"==typeof a.fn.offset){var g=d.offset();f.clk_x=b.pageX-g.left,f.clk_y=b.pageY-g.top}else f.clk_x=b.pageX-c.offsetLeft,f.clk_y=b.pageY-c.offsetTop;setTimeout(function(){f.clk=f.clk_x=f.clk_y=null},100)}function d(){if(a.fn.ajaxSubmit.debug){var b="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(b):window.opera&&window.opera.postError&&window.opera.postError(b)}}var e={};e.fileapi=void 0!==a("<input type='file'/>").get(0).files,e.formdata=void 0!==window.FormData,a.fn.ajaxSubmit=function(b){function c(b){var c,d,e=a.param(b).split("&"),f=e.length,g={};for(c=0;f>c;c++)e[c]=e[c].replace(/\+/g," "),d=e[c].split("="),g[decodeURIComponent(d[0])]=decodeURIComponent(d[1]);return g}function f(d){for(var e=new FormData,f=0;f<d.length;f++)e.append(d[f].name,d[f].value);if(b.extraData){var g=c(b.extraData);for(var i in g)g.hasOwnProperty(i)&&e.append(i,g[i])}b.data=null;var j=a.extend(!0,{},a.ajaxSettings,b,{contentType:!1,processData:!1,cache:!1,type:h||"POST"});b.uploadProgress&&(j.xhr=function(){var a=jQuery.ajaxSettings.xhr();return a.upload&&(a.upload.onprogress=function(a){var c=0,d=a.loaded||a.position,e=a.total;a.lengthComputable&&(c=Math.ceil(d/e*100)),b.uploadProgress(a,d,e,c)}),a}),j.data=null;var k=j.beforeSend;return j.beforeSend=function(a,b){b.data=e,k&&k.call(this,a,b)},a.ajax(j)}function g(c){function e(a){var b=a.contentWindow?a.contentWindow.document:a.contentDocument?a.contentDocument:a.document;return b}function f(){function b(){try{var a=e(q).readyState;d("state = "+a),a&&"uninitialized"==a.toLowerCase()&&setTimeout(b,50)}catch(c){d("Server abort: ",c," (",c.name,")"),g(A),v&&clearTimeout(v),v=void 0}}var c=k.attr("target"),f=k.attr("action");w.setAttribute("target",n),h||w.setAttribute("method","POST"),f!=l.url&&w.setAttribute("action",l.url),l.skipEncodingOverride||h&&!/post/i.test(h)||k.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),l.timeout&&(v=setTimeout(function(){u=!0,g(z)},l.timeout));var i=[];try{if(l.extraData)for(var j in l.extraData)l.extraData.hasOwnProperty(j)&&(a.isPlainObject(l.extraData[j])&&l.extraData[j].hasOwnProperty("name")&&l.extraData[j].hasOwnProperty("value")?i.push(a('<input type="hidden" name="'+l.extraData[j].name+'">').val(l.extraData[j].value).appendTo(w)[0]):i.push(a('<input type="hidden" name="'+j+'">').val(l.extraData[j]).appendTo(w)[0]));l.iframeTarget||(p.appendTo("body"),q.attachEvent?q.attachEvent("onload",g):q.addEventListener("load",g,!1)),setTimeout(b,15),w.submit()}finally{w.setAttribute("action",f),c?w.setAttribute("target",c):k.removeAttr("target"),a(i).remove()}}function g(b){if(!r.aborted&&!F){try{E=e(q)}catch(c){d("cannot access response document: ",c),b=A}if(b===z&&r)return r.abort("timeout"),void y.reject(r,"timeout");if(b==A&&r)return r.abort("server abort"),void y.reject(r,"error","server abort");if(E&&E.location.href!=l.iframeSrc||u){q.detachEvent?q.detachEvent("onload",g):q.removeEventListener("load",g,!1);var f,h="success";try{if(u)throw"timeout";var i="xml"==l.dataType||E.XMLDocument||a.isXMLDoc(E);if(d("isXml="+i),!i&&window.opera&&(null===E.body||!E.body.innerHTML)&&--G)return d("requeing onLoad callback, DOM not available"),void setTimeout(g,250);var j=E.body?E.body:E.documentElement;r.responseText=j?j.innerHTML:null,r.responseXML=E.XMLDocument?E.XMLDocument:E,i&&(l.dataType="xml"),r.getResponseHeader=function(a){var b={"content-type":l.dataType};return b[a]},j&&(r.status=Number(j.getAttribute("status"))||r.status,r.statusText=j.getAttribute("statusText")||r.statusText);var k=(l.dataType||"").toLowerCase(),n=/(json|script|text)/.test(k);if(n||l.textarea){var o=E.getElementsByTagName("textarea")[0];if(o)r.responseText=o.value,r.status=Number(o.getAttribute("status"))||r.status,r.statusText=o.getAttribute("statusText")||r.statusText;else if(n){var s=E.getElementsByTagName("pre")[0],t=E.getElementsByTagName("body")[0];s?r.responseText=s.textContent?s.textContent:s.innerText:t&&(r.responseText=t.textContent?t.textContent:t.innerText)}}else"xml"==k&&!r.responseXML&&r.responseText&&(r.responseXML=H(r.responseText));try{D=J(r,k,l)}catch(b){h="parsererror",r.error=f=b||h}}catch(b){d("error caught: ",b),h="error",r.error=f=b||h}r.aborted&&(d("upload aborted"),h=null),r.status&&(h=r.status>=200&&r.status<300||304===r.status?"success":"error"),"success"===h?(l.success&&l.success.call(l.context,D,"success",r),y.resolve(r.responseText,"success",r),m&&a.event.trigger("ajaxSuccess",[r,l])):h&&(void 0===f&&(f=r.statusText),l.error&&l.error.call(l.context,r,h,f),y.reject(r,"error",f),m&&a.event.trigger("ajaxError",[r,l,f])),m&&a.event.trigger("ajaxComplete",[r,l]),m&&!--a.active&&a.event.trigger("ajaxStop"),l.complete&&l.complete.call(l.context,r,h),F=!0,l.timeout&&clearTimeout(v),setTimeout(function(){l.iframeTarget||p.remove(),r.responseXML=null},100)}}}var i,j,l,m,n,p,q,r,s,t,u,v,w=k[0],x=!!a.fn.prop,y=a.Deferred();if(a("[name=submit],[id=submit]",w).length)return alert('Error: Form elements must not have name or id of "submit".'),y.reject(),y;if(c)for(j=0;j<o.length;j++)i=a(o[j]),x?i.prop("disabled",!1):i.removeAttr("disabled");if(l=a.extend(!0,{},a.ajaxSettings,b),l.context=l.context||l,n="jqFormIO"+(new Date).getTime(),l.iframeTarget?(p=a(l.iframeTarget),t=p.attr("name"),t?n=t:p.attr("name",n)):(p=a('<iframe name="'+n+'" src="'+l.iframeSrc+'" />'),p.css({position:"absolute",top:"-1000px",left:"-1000px"})),q=p[0],r={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(b){var c="timeout"===b?"timeout":"aborted";d("aborting upload... "+c),this.aborted=1;try{q.contentWindow.document.execCommand&&q.contentWindow.document.execCommand("Stop")}catch(e){}p.attr("src",l.iframeSrc),r.error=c,l.error&&l.error.call(l.context,r,c,b),m&&a.event.trigger("ajaxError",[r,l,c]),l.complete&&l.complete.call(l.context,r,c)}},m=l.global,m&&0===a.active++&&a.event.trigger("ajaxStart"),m&&a.event.trigger("ajaxSend",[r,l]),l.beforeSend&&l.beforeSend.call(l.context,r,l)===!1)return l.global&&a.active--,y.reject(),y;if(r.aborted)return y.reject(),y;s=w.clk,s&&(t=s.name,t&&!s.disabled&&(l.extraData=l.extraData||{},l.extraData[t]=s.value,"image"==s.type&&(l.extraData[t+".x"]=w.clk_x,l.extraData[t+".y"]=w.clk_y)));var z=1,A=2,B=a("meta[name=csrf-token]").attr("content"),C=a("meta[name=csrf-param]").attr("content");C&&B&&(l.extraData=l.extraData||{},l.extraData[C]=B),l.forceSync?f():setTimeout(f,10);var D,E,F,G=50,H=a.parseXML||function(a,b){return window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml"),b&&b.documentElement&&"parsererror"!=b.documentElement.nodeName?b:null},I=a.parseJSON||function(a){return window.eval("("+a+")")},J=function(b,c,d){var e=b.getResponseHeader("content-type")||"",f="xml"===c||!c&&e.indexOf("xml")>=0,g=f?b.responseXML:b.responseText;return f&&"parsererror"===g.documentElement.nodeName&&a.error&&a.error("parsererror"),d&&d.dataFilter&&(g=d.dataFilter(g,c)),"string"==typeof g&&("json"===c||!c&&e.indexOf("json")>=0?g=I(g):("script"===c||!c&&e.indexOf("javascript")>=0)&&a.globalEval(g)),g};return y}if(!this.length)return d("ajaxSubmit: skipping submit process - no element selected"),this;var h,i,j,k=this;"function"==typeof b&&(b={success:b}),h=this.attr("method"),i=this.attr("action"),j="string"==typeof i?a.trim(i):"",j=j||window.location.href||"",j&&(j=(j.match(/^([^#]+)/)||[])[1]),b=a.extend(!0,{url:j,success:a.ajaxSettings.success,type:h||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},b);var l={};if(this.trigger("form-pre-serialize",[this,b,l]),l.veto)return d("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(b.beforeSerialize&&b.beforeSerialize(this,b)===!1)return d("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var m=b.traditional;void 0===m&&(m=a.ajaxSettings.traditional);var n,o=[],p=this.formToArray(b.semantic,o);if(b.data&&(b.extraData=b.data,n=a.param(b.data,m)),b.beforeSubmit&&b.beforeSubmit(p,this,b)===!1)return d("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[p,this,b,l]),l.veto)return d("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var q=a.param(p,m);n&&(q=q?q+"&"+n:n),"GET"==b.type.toUpperCase()?(b.url+=(b.url.indexOf("?")>=0?"&":"?")+q,b.data=null):b.data=q;var r=[];if(b.resetForm&&r.push(function(){k.resetForm()}),b.clearForm&&r.push(function(){k.clearForm(b.includeHidden)}),!b.dataType&&b.target){var s=b.success||function(){};r.push(function(c){var d=b.replaceTarget?"replaceWith":"html";a(b.target)[d](c).each(s,arguments)})}else b.success&&r.push(b.success);b.success=function(a,c,d){for(var e=b.context||this,f=0,g=r.length;g>f;f++)r[f].apply(e,[a,c,d||k,k])};var t=a('input[type=file]:enabled[value!=""]',this),u=t.length>0,v="multipart/form-data",w=k.attr("enctype")==v||k.attr("encoding")==v,x=e.fileapi&&e.formdata;d("fileAPI :"+x);var y,z=(u||w)&&!x;b.iframe!==!1&&(b.iframe||z)?b.closeKeepAlive?a.get(b.closeKeepAlive,function(){y=g(p)}):y=g(p):y=(u||w)&&x?f(p):a.ajax(b),k.removeData("jqxhr").data("jqxhr",y);for(var A=0;A<o.length;A++)o[A]=null;return this.trigger("form-submit-notify",[this,b]),this},a.fn.ajaxForm=function(e){if(e=e||{},e.delegation=e.delegation&&a.isFunction(a.fn.on),!e.delegation&&0===this.length){var f={s:this.selector,c:this.context};return!a.isReady&&f.s?(d("DOM not ready, queuing ajaxForm"),a(function(){a(f.s,f.c).ajaxForm(e)}),this):(d("terminating; zero elements found by selector"+(a.isReady?"":" (DOM not ready)")),this)}return e.delegation?(a(document).off("submit.form-plugin",this.selector,b).off("click.form-plugin",this.selector,c).on("submit.form-plugin",this.selector,e,b).on("click.form-plugin",this.selector,e,c),this):this.ajaxFormUnbind().bind("submit.form-plugin",e,b).bind("click.form-plugin",e,c)},a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},a.fn.formToArray=function(b,c){var d=[];if(0===this.length)return d;var f=this[0],g=b?f.getElementsByTagName("*"):f.elements;if(!g)return d;var h,i,j,k,l,m,n;for(h=0,m=g.length;m>h;h++)if(l=g[h],j=l.name)if(b&&f.clk&&"image"==l.type)l.disabled||f.clk!=l||(d.push({name:j,value:a(l).val(),type:l.type}),d.push({name:j+".x",value:f.clk_x},{name:j+".y",value:f.clk_y}));else if(k=a.fieldValue(l,!0),k&&k.constructor==Array)for(c&&c.push(l),i=0,n=k.length;n>i;i++)d.push({name:j,value:k[i]});else if(e.fileapi&&"file"==l.type&&!l.disabled){c&&c.push(l);var o=l.files;if(o.length)for(i=0;i<o.length;i++)d.push({name:j,value:o[i],type:l.type});else d.push({name:j,value:"",type:l.type})}else null!==k&&"undefined"!=typeof k&&(c&&c.push(l),d.push({name:j,value:k,type:l.type,required:l.required}));if(!b&&f.clk){var p=a(f.clk),q=p[0];j=q.name,j&&!q.disabled&&"image"==q.type&&(d.push({name:j,value:p.val()}),d.push({name:j+".x",value:f.clk_x},{name:j+".y",value:f.clk_y}))}return d},a.fn.formSerialize=function(b){return a.param(this.formToArray(b))},a.fn.fieldSerialize=function(b){var c=[];return this.each(function(){var d=this.name;if(d){var e=a.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,g=e.length;g>f;f++)c.push({name:d,value:e[f]});else null!==e&&"undefined"!=typeof e&&c.push({name:this.name,value:e})}}),a.param(c)},a.fn.fieldValue=function(b){for(var c=[],d=0,e=this.length;e>d;d++){var f=this[d],g=a.fieldValue(f,b);null===g||"undefined"==typeof g||g.constructor==Array&&!g.length||(g.constructor==Array?a.merge(c,g):c.push(g))}return c},a.fieldValue=function(b,c){var d=b.name,e=b.type,f=b.tagName.toLowerCase();if(void 0===c&&(c=!0),c&&(!d||b.disabled||"reset"==e||"button"==e||("checkbox"==e||"radio"==e)&&!b.checked||("submit"==e||"image"==e)&&b.form&&b.form.clk!=b||"select"==f&&-1==b.selectedIndex))return null;if("select"==f){var g=b.selectedIndex;if(0>g)return null;for(var h=[],i=b.options,j="select-one"==e,k=j?g+1:i.length,l=j?g:0;k>l;l++){var m=i[l];if(m.selected){var n=m.value;if(n||(n=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value),j)return n;h.push(n)}}return h}return a(b).val()},a.fn.clearForm=function(b){return this.each(function(){a("input,select,textarea",this).clearFields(b)})},a.fn.clearFields=a.fn.clearInputs=function(b){var c=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var d=this.type,e=this.tagName.toLowerCase();c.test(d)||"textarea"==e?this.value="":"checkbox"==d||"radio"==d?this.checked=!1:"select"==e?this.selectedIndex=-1:"file"==d?/MSIE/.test(navigator.userAgent)?a(this).replaceWith(a(this).clone()):a(this).val(""):b&&(b===!0&&/hidden/.test(d)||"string"==typeof b&&a(this).is(b))&&(this.value="")})},a.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},a.fn.enable=function(a){return void 0===a&&(a=!0),this.each(function(){this.disabled=!a})},a.fn.selected=function(b){return void 0===b&&(b=!0),this.each(function(){var c=this.type;if("checkbox"==c||"radio"==c)this.checked=b;else if("option"==this.tagName.toLowerCase()){var d=a(this).parent("select");b&&d[0]&&"select-one"==d[0].type&&d.find("option").selected(!1),this.selected=b}})},a.fn.ajaxSubmit.debug=!1}(jQuery),function(a,b,c){function d(a){var b={},d=/^jQuery\d+$/;return c.each(a.attributes,function(a,c){c.specified&&!d.test(c.name)&&(b[c.name]=c.value)}),b}function e(a,d){var e=this,f=c(e);if(e.value==f.attr("placeholder")&&f.hasClass("placeholder"))if(f.data("placeholder-password")){if(f=f.hide().next().show().attr("id",f.removeAttr("id").data("placeholder-id")),a===!0)return f[0].value=d;f.focus()}else e.value="",f.removeClass("placeholder"),e==b.activeElement&&e.select()}function f(){var a,b=this,f=c(b),g=this.id;if(""==b.value){if("password"==b.type){if(!f.data("placeholder-textinput")){try{a=f.clone().attr({type:"text"})}catch(h){a=c("<input>").attr(c.extend(d(this),{type:"text"}))}a.removeAttr("name").data({"placeholder-password":!0,"placeholder-id":g}).bind("focus.placeholder",e),f.data({"placeholder-textinput":a,"placeholder-id":g}).before(a)}f=f.removeAttr("id").hide().prev().attr("id",g).show()}f.addClass("placeholder"),f[0].value=f.attr("placeholder")}else f.removeClass("placeholder")}var g,h,i="placeholder"in b.createElement("input"),j="placeholder"in b.createElement("textarea"),k=c.fn,l=c.valHooks;i&&j?(h=k.placeholder=function(){return this},h.input=h.textarea=!0):(h=k.placeholder=function(){var a=this;return a.filter((i?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":e,"blur.placeholder":f}).data("placeholder-enabled",!0).trigger("blur.placeholder"),a},h.input=i,h.textarea=j,g={get:function(a){var b=c(a);return b.data("placeholder-enabled")&&b.hasClass("placeholder")?"":a.value},set:function(a,d){var g=c(a);return g.data("placeholder-enabled")?(""==d?(a.value=d,a!=b.activeElement&&f.call(a)):g.hasClass("placeholder")?e.call(a,!0,d)||(a.value=d):a.value=d,g):a.value=d}},i||(l.input=g),j||(l.textarea=g),c(function(){c(b).delegate("form","submit.placeholder",function(){var a=c(".placeholder",this).each(e);setTimeout(function(){a.each(f)},10)})}),c(a).bind("beforeunload.placeholder",function(){c(".placeholder").each(function(){this.value=""})}))}(this,document,jQuery),$.fn.imagesLoaded=function(a){function b(){a.call(d,e)}function c(a){var d=a.target;d.src!==g&&-1===$.inArray(d,h)&&(h.push(d),--f<=0&&(setTimeout(b),e.unbind(".imagesLoaded",c)))}var d=this,e=d.find("img").add(d.filter("img")),f=e.length,g="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",h=[];return f||b(),e.bind("load.imagesLoaded error.imagesLoaded",c).each(function(){var a=this.src;this.src=g,this.src=a}),d},function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(a){"use strict";function b(c,d){var e=function(){},f=this,g={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:b.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:e,onSearchComplete:e,onSearchError:e,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(a,b,c){return-1!==a.value.toLowerCase().indexOf(c)},paramName:"query",transformResult:function(b){return"string"==typeof b?a.parseJSON(b):b},showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1};f.element=c,f.el=a(c),f.suggestions=[],f.badQueries=[],f.selectedIndex=-1,f.currentValue=f.element.value,f.intervalId=0,f.cachedResponse={},f.onChangeInterval=null,f.onChange=null,f.isLocal=!1,f.suggestionsContainer=null,f.noSuggestionsContainer=null,f.options=a.extend({},g,d),f.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},f.hint=null,f.hintValue="",f.selection=null,f.initialize(),f.setOptions(d)}var c=function(){return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(a){var b=document.createElement("div");return b.className=a,b.style.position="absolute",b.style.display="none",b}}}(),d={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};b.utils=c,a.Autocomplete=b,b.formatResult=function(a,b){var d="("+c.escapeRegExChars(b)+")";return a.value.replace(new RegExp(d,"gi"),"<strong>$1</strong>")},b.prototype={killerFn:null,initialize:function(){var c,d=this,e="."+d.classes.suggestion,f=d.classes.selected,g=d.options;d.element.setAttribute("autocomplete","off"),d.killerFn=function(b){0===a(b.target).closest("."+d.options.containerClass).length&&(d.killSuggestions(),d.disableKillerFn())},d.noSuggestionsContainer=a('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),d.suggestionsContainer=b.utils.createNode(g.containerClass),c=a(d.suggestionsContainer),c.appendTo(g.appendTo),"auto"!==g.width&&c.width(g.width),c.on("mouseover.autocomplete",e,function(){d.activate(a(this).data("index"))}),c.on("mouseout.autocomplete",function(){d.selectedIndex=-1,c.children("."+f).removeClass(f)}),c.on("click.autocomplete",e,function(){d.select(a(this).data("index"))}),d.fixPositionCapture=function(){d.visible&&d.fixPosition()},a(window).on("resize.autocomplete",d.fixPositionCapture),d.el.on("keydown.autocomplete",function(a){d.onKeyPress(a)}),d.el.on("keyup.autocomplete",function(a){d.onKeyUp(a)}),d.el.on("blur.autocomplete",function(){d.onBlur()}),d.el.on("focus.autocomplete",function(){d.onFocus()}),d.el.on("change.autocomplete",function(a){d.onKeyUp(a)})},onFocus:function(){var a=this;a.fixPosition(),a.options.minChars<=a.el.val().length&&a.onValueChange()},onBlur:function(){this.enableKillerFn()},setOptions:function(b){var c=this,d=c.options;a.extend(d,b),c.isLocal=a.isArray(d.lookup),c.isLocal&&(d.lookup=c.verifySuggestionsFormat(d.lookup)),d.orientation=c.validateOrientation(d.orientation,"bottom"),a(c.suggestionsContainer).css({"max-height":d.maxHeight+"px",width:d.width+"px","z-index":d.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var a=this;a.disabled=!0,clearInterval(a.onChangeInterval),a.currentRequest&&a.currentRequest.abort()},enable:function(){this.disabled=!1},fixPosition:function(){var b=this,c=a(b.suggestionsContainer),d=c.parent().get(0);if(d===document.body||b.options.forceFixPosition){var e=b.options.orientation,f=c.outerHeight(),g=b.el.outerHeight(),h=b.el.offset(),i={top:h.top,left:h.left};if("auto"==e){var j=a(window).height(),k=a(window).scrollTop(),l=-k+h.top-f,m=k+j-(h.top+g+f);e=Math.max(l,m)===l?"top":"bottom"}if("top"===e?i.top+=-f:i.top+=g,d!==document.body){var n,o=c.css("opacity");b.visible||c.css("opacity",0).show(),n=c.offsetParent().offset(),i.top-=n.top,i.left-=n.left,b.visible||c.css("opacity",o).hide()}"auto"===b.options.width&&(i.width=b.el.outerWidth()-2+"px"),c.css(i)}},enableKillerFn:function(){var b=this;a(document).on("click.autocomplete",b.killerFn)},disableKillerFn:function(){var b=this;a(document).off("click.autocomplete",b.killerFn)},killSuggestions:function(){var a=this;a.stopKillSuggestions(),a.intervalId=window.setInterval(function(){a.hide(),a.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var a,b=this,c=b.el.val().length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0},onKeyPress:function(a){var b=this;if(!b.disabled&&!b.visible&&a.which===d.DOWN&&b.currentValue)return void b.suggest();if(!b.disabled&&b.visible){switch(a.which){case d.ESC:b.el.val(b.currentValue),b.hide();break;case d.RIGHT:if(b.hint&&b.options.onHint&&b.isCursorAtEnd()){b.selectHint();break}return;case d.TAB:if(b.hint&&b.options.onHint)return void b.selectHint();case d.RETURN:if(-1===b.selectedIndex)return void b.hide();if(b.select(b.selectedIndex),a.which===d.TAB&&b.options.tabDisabled===!1)return;break;case d.UP:b.moveUp();break;case d.DOWN:b.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case d.UP:case d.DOWN:return}clearInterval(b.onChangeInterval),b.currentValue!==b.el.val()&&(b.findBestHint(),b.options.deferRequestBy>0?b.onChangeInterval=setInterval(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},onValueChange:function(){var b,c=this,d=c.options,e=c.el.val(),f=c.getQuery(e);return c.selection&&c.currentValue!==f&&(c.selection=null,(d.onInvalidateSelection||a.noop).call(c.element)),clearInterval(c.onChangeInterval),c.currentValue=e,c.selectedIndex=-1,d.triggerSelectOnValidInput&&(b=c.findSuggestionIndex(f),-1!==b)?void c.select(b):void(f.length<d.minChars?c.hide():c.getSuggestions(f))},findSuggestionIndex:function(b){var c=this,d=-1,e=b.toLowerCase();return a.each(c.suggestions,function(a,b){return b.value.toLowerCase()===e?(d=a,!1):void 0}),d},getQuery:function(b){var c,d=this.options.delimiter;return d?(c=b.split(d),a.trim(c[c.length-1])):b},getSuggestionsLocal:function(b){var c,d=this,e=d.options,f=b.toLowerCase(),g=e.lookupFilter,h=parseInt(e.lookupLimit,10);return c={suggestions:a.grep(e.lookup,function(a){return g(a,b,f)})},h&&c.suggestions.length>h&&(c.suggestions=c.suggestions.slice(0,h)),c},getSuggestions:function(b){var c,d,e,f,g=this,h=g.options,i=h.serviceUrl;h.params[h.paramName]=b,d=h.ignoreParams?null:h.params,h.onSearchStart.call(g.element,h.params)!==!1&&(g.isLocal?c=g.getSuggestionsLocal(b):(a.isFunction(i)&&(i=i.call(g.element,b)),e=i+"?"+a.param(d||{}),c=g.cachedResponse[e]),c&&a.isArray(c.suggestions)?(g.suggestions=c.suggestions,g.suggest(),h.onSearchComplete.call(g.element,b,c.suggestions)):g.isBadQuery(b)?h.onSearchComplete.call(g.element,b,[]):(g.currentRequest&&g.currentRequest.abort(),f={url:i,data:d,type:h.type,dataType:h.dataType},a.extend(f,h.ajaxSettings),g.currentRequest=a.ajax(f).done(function(a){var c;g.currentRequest=null,c=h.transformResult(a),g.processResponse(c,b,e),h.onSearchComplete.call(g.element,b,c.suggestions)}).fail(function(a,c,d){h.onSearchError.call(g.element,b,a,c,d)})))},isBadQuery:function(a){if(!this.options.preventBadQueries)return!1;for(var b=this.badQueries,c=b.length;c--;)if(0===a.indexOf(b[c]))return!0;return!1},hide:function(){var b=this;b.visible=!1,b.selectedIndex=-1,clearInterval(b.onChangeInterval),a(b.suggestionsContainer).hide(),b.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void(this.options.showNoSuggestionNotice?this.noSuggestions():this.hide());var b,c,d=this,e=d.options,f=e.groupBy,g=e.formatResult,h=d.getQuery(d.currentValue),i=d.classes.suggestion,j=d.classes.selected,k=a(d.suggestionsContainer),l=a(d.noSuggestionsContainer),m=e.beforeRender,n="",o=function(a,c){var d=a.data[f];return b===d?"":(b=d,'<div class="autocomplete-group"><strong>'+b+"</strong></div>")};return e.triggerSelectOnValidInput&&(c=d.findSuggestionIndex(h),-1!==c)?void d.select(c):(a.each(d.suggestions,function(a,b){f&&(n+=o(b,h,a)),n+='<div class="'+i+'" data-index="'+a+'">'+g(b,h)+"</div>"}),this.adjustContainerWidth(),l.detach(),k.html(n),e.autoSelectFirst&&(d.selectedIndex=0,k.children().first().addClass(j)),a.isFunction(m)&&m.call(d.element,k),d.fixPosition(),k.show(),d.visible=!0,void d.findBestHint())},noSuggestions:function(){var b=this,c=a(b.suggestionsContainer),d=a(b.noSuggestionsContainer);this.adjustContainerWidth(),d.detach(),c.empty(),c.append(d),b.fixPosition(),c.show(),b.visible=!0},adjustContainerWidth:function(){var b,c=this,d=c.options,e=a(c.suggestionsContainer);"auto"===d.width&&(b=c.el.outerWidth()-2,e.width(b>0?b:300))},findBestHint:function(){var b=this,c=b.el.val().toLowerCase(),d=null;c&&(a.each(b.suggestions,function(a,b){var e=0===b.value.toLowerCase().indexOf(c);return e&&(d=b),!e}),b.signalHint(d))},signalHint:function(b){var c="",d=this;b&&(c=d.currentValue+b.value.substr(d.currentValue.length)),d.hintValue!==c&&(d.hintValue=c,d.hint=b,(this.options.onHint||a.noop)(c))},verifySuggestionsFormat:function(b){return b.length&&"string"==typeof b[0]?a.map(b,function(a){return{value:a,data:null}}):b},validateOrientation:function(b,c){return b=a.trim(b||"").toLowerCase(),-1===a.inArray(b,["auto","bottom","top"])&&(b=c),b},processResponse:function(a,b,c){var d=this,e=d.options;a.suggestions=d.verifySuggestionsFormat(a.suggestions),e.noCache||(d.cachedResponse[c]=a,e.preventBadQueries&&0===a.suggestions.length&&d.badQueries.push(b)),b===d.getQuery(d.currentValue)&&(d.suggestions=a.suggestions,d.suggest())},activate:function(b){var c,d=this,e=d.classes.selected,f=a(d.suggestionsContainer),g=f.find("."+d.classes.suggestion);return f.find("."+e).removeClass(e),d.selectedIndex=b,-1!==d.selectedIndex&&g.length>d.selectedIndex?(c=g.get(d.selectedIndex),a(c).addClass(e),c):null},selectHint:function(){var b=this,c=a.inArray(b.hint,b.suggestions);b.select(c)},select:function(a){var b=this;b.hide(),b.onSelect(a)},moveUp:function(){var b=this;if(-1!==b.selectedIndex)return 0===b.selectedIndex?(a(b.suggestionsContainer).children().first().removeClass(b.classes.selected),b.selectedIndex=-1,b.el.val(b.currentValue),
void b.findBestHint()):void b.adjustScroll(b.selectedIndex-1)},moveDown:function(){var a=this;a.selectedIndex!==a.suggestions.length-1&&a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(b){var c,d,e,f=this,g=f.activate(b),h=25;g&&(c=g.offsetTop,d=a(f.suggestionsContainer).scrollTop(),e=d+f.options.maxHeight-h,d>c?a(f.suggestionsContainer).scrollTop(c):c>e&&a(f.suggestionsContainer).scrollTop(c-f.options.maxHeight+h),f.el.val(f.getValue(f.suggestions[b].value)),f.signalHint(null))},onSelect:function(b){var c=this,d=c.options.onSelect,e=c.suggestions[b];c.currentValue=c.getValue(e.value),c.currentValue!==c.el.val()&&c.el.val(c.currentValue),c.signalHint(null),c.suggestions=[],c.selection=e,a.isFunction(d)&&d.call(c.element,e)},getValue:function(a){var b,c,d=this,e=d.options.delimiter;return e?(b=d.currentValue,c=b.split(e),1===c.length?a:b.substr(0,b.length-c[c.length-1].length)+a):a},dispose:function(){var b=this;b.el.off(".autocomplete").removeData("autocomplete"),b.disableKillerFn(),a(window).off("resize.autocomplete",b.fixPositionCapture),a(b.suggestionsContainer).remove()}},a.fn.autocomplete=a.fn.devbridgeAutocomplete=function(c,d){var e="autocomplete";return 0===arguments.length?this.first().data(e):this.each(function(){var f=a(this),g=f.data(e);"string"==typeof c?g&&"function"==typeof g[c]&&g[c](d):(g&&g.dispose&&g.dispose(),g=new b(this,c),f.data(e,g))})}}),function(){function a(){try{return h in f&&f[h]}catch(a){return!1}}function b(a){return function(){var b=Array.prototype.slice.call(arguments,0);b.unshift(d),j.appendChild(d),d.addBehavior("#default#userData"),d.load(h);var c=a.apply(e,b);return j.removeChild(d),c}}function c(a){return a.replace(m,"___")}var d,e={},f=window,g=f.document,h="localStorage",i="__storejs__";if(e.disabled=!1,e.set=function(a,b){},e.get=function(a){},e.remove=function(a){},e.clear=function(){},e.transact=function(a,b,c){var d=e.get(a);null==c&&(c=b,b=null),"undefined"==typeof d&&(d=b||{}),c(d),e.set(a,d)},e.getAll=function(){},e.serialize=function(a){return JSON.stringify(a)},e.deserialize=function(a){if("string"!=typeof a)return void 0;try{return JSON.parse(a)}catch(b){return a||void 0}},a())d=f[h],e.set=function(a,b){return void 0===b?e.remove(a):(d.setItem(a,e.serialize(b)),b)},e.get=function(a){return e.deserialize(d.getItem(a))},e.remove=function(a){d.removeItem(a)},e.clear=function(){d.clear()},e.getAll=function(){for(var a={},b=0;b<d.length;++b){var c=d.key(b);a[c]=e.get(c)}return a};else if(g.documentElement.addBehavior){var j,k;try{k=new ActiveXObject("htmlfile"),k.open(),k.write('<script>document.w=window</script><iframe src="/favicon.ico"></frame>'),k.close(),j=k.w.frames[0].document,d=j.createElement("div")}catch(l){d=g.createElement("div"),j=g.body}var m=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");e.set=b(function(a,b,d){return b=c(b),void 0===d?e.remove(b):(a.setAttribute(b,e.serialize(d)),a.save(h),d)}),e.get=b(function(a,b){return b=c(b),e.deserialize(a.getAttribute(b))}),e.remove=b(function(a,b){b=c(b),a.removeAttribute(b),a.save(h)}),e.clear=b(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(h);for(var c,d=0;c=b[d];d++)a.removeAttribute(c.name);a.save(h)}),e.getAll=b(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(h);for(var c,d={},f=0;c=b[f];++f)d[c]=e.get(c);return d})}try{e.set(i,i),e.get(i)!=i&&(e.disabled=!0),e.remove(i)}catch(l){e.disabled=!0}e.enabled=!e.disabled,"undefined"!=typeof module&&"function"!=typeof module?module.exports=e:"function"==typeof define&&define.amd?define(e):this.store=e}(),function(a){function b(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function c(a){for(p in r)r[p]=a[x[p]]}function d(a,d){var e,f,h,i,j;if(e=a.keyCode,-1==b(w,e)&&w.push(e),(93==e||224==e)&&(e=91),e in r){r[e]=!0;for(h in t)t[h]==e&&(g[h]=!0)}else if(c(a),g.filter.call(this,a)&&e in q)for(i=0;i<q[e].length;i++)if(f=q[e][i],f.scope==d||"all"==f.scope){j=f.mods.length>0;for(h in r)(!r[h]&&b(f.mods,+h)>-1||r[h]&&-1==b(f.mods,+h))&&(j=!1);(0!=f.mods.length||r[16]||r[18]||r[17]||r[91])&&!j||f.method(a,f)===!1&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0))}}function e(a){var c,d=a.keyCode,e=b(w,d);if(e>=0&&w.splice(e,1),(93==d||224==d)&&(d=91),d in r){r[d]=!1;for(c in t)t[c]==d&&(g[c]=!1)}}function f(){for(p in r)r[p]=!1;for(p in t)g[p]=!1}function g(a,b,c){var d,e,f,g;for(void 0===c&&(c=b,b="all"),a=a.replace(/\s/g,""),d=a.split(","),""==d[d.length-1]&&(d[d.length-2]+=","),f=0;f<d.length;f++){if(e=[],a=d[f].split("+"),a.length>1){for(e=a.slice(0,a.length-1),g=0;g<e.length;g++)e[g]=t[e[g]];a=[a[a.length-1]]}a=a[0],a=v(a),a in q||(q[a]=[]),q[a].push({shortcut:d[f],scope:b,method:c,key:d[f],mods:e})}}function h(a){return"string"==typeof a&&(a=v(a)),-1!=b(w,a)}function i(){return w.slice(0)}function j(a){var b=(a.target||a.srcElement).tagName;return!("INPUT"==b||"SELECT"==b||"TEXTAREA"==b)}function k(a){s=a||"all"}function l(){return s||"all"}function m(a){var b,c,d;for(b in q)for(c=q[b],d=0;d<c.length;)c[d].scope===a?c.splice(d,1):d++}function n(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})}function o(){var b=a.key;return a.key=y,b}var p,q={},r={16:!1,18:!1,17:!1,91:!1},s="all",t={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,command:91},u={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},v=function(a){return u[a]||a.toUpperCase().charCodeAt(0)},w=[];for(p=1;20>p;p++)t["f"+p]=111+p;var x={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(p in t)g[p]=!1;n(document,"keydown",function(a){d(a,s)}),n(document,"keyup",e),n(window,"focus",f);var y=a.key;a.key=g,a.key.setScope=k,a.key.getScope=l,a.key.deleteScope=m,a.key.filter=j,a.key.isPressed=h,a.key.getPressedKeyCodes=i,a.key.noConflict=o,"undefined"!=typeof module&&(module.exports=key)}(this),Function.prototype.bind||(Function.prototype.bind=function(a){"use strict";if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),$(document).ready(function(){var a="https://blockchain.info/",b=$(".blockchain-btn");b.find(".blockchain").hide(),b.find(".stage-begin").trigger("show").show(),b.each(function(b){var c=$(this);!function(){var b=c;b.click(function(){var c=$(this).data("address"),d=$(this).data("shared"),e=$(this).data("test");d||(d=!1);var f=$(this).data("callback");f||(f=""),b.find(".blockchain").hide(),b.find(".stage-loading").trigger("show").show(),$.ajax({type:"GET",dataType:"json",url:a+"api/receive",data:{method:"create",address:encodeURIComponent(c),shared:d,callback:f},success:function(c){function d(){$.ajax({type:"GET",url:a+"q/getreceivedbyaddress/"+c.input_address,data:{format:"plain"},success:function(a){if(a){var c=parseInt(a);c>0||e?(b.find(".blockchain").hide(),b.find(".stage-paid").trigger("show").show().html(b.find(".stage-paid").html().replace("[[value]]",c/1e8))):setTimeout(d,5e3)}}})}if(b.find(".qr-code").empty(),b.find(".blockchain").hide(),!c||!c.input_address)return void b.find(".stage-error").trigger("show").show().html(b.find(".stage-error").html().replace("[[error]]","Unknown Error"));try{if(ws=new WebSocket("ws://api.blockchain.info:8335/inv"),!ws)return;ws.onmessage=function(a){try{var d=$.parseJSON(a.data);if("utx"==d.op)for(var e=d.x,f=0,g=0;g<e.out.length;g++){var h=e.out[g];h.addr==c.input_address&&(f+=parseInt(h.value))}b.find(".blockchain").hide(),b.find(".stage-paid").trigger("show").show().html(b.find(".stage-paid").html().replace("[[value]]",f/1e8)),ws.close()}catch(a){console.log(a),console.log(a.data)}},ws.onopen=function(){ws.send('{"op":"addr_sub", "addr":"'+c.input_address+'"}')}}catch(f){console.log(f)}b.find(".stage-ready").trigger("show").show().html(b.find(".stage-ready").html().replace("[[address]]",c.input_address)),b.find(".qr-code").html('<img style="margin:5px" src="'+a+"qr?data="+c.input_address+'&size=125">'),b.unbind(),setTimeout(d,5e3)},error:function(a){b.find(".blockchain").hide(),b.find(".stage-error").show().trigger("show").html(b.find(".stage-error").html().replace("[[error]]",a.responseText))}})})}()})}),function(a,b){var c=a.Router.prototype.route,d=function(){};b.extend(a.Router.prototype,{before:d,after:d,route:function(a,e,f){f||(f=this[e]);var g=b.bind(function(){var c,e=[a,b.toArray(arguments)];if(c=b.isFunction(this.before)?this.before:"undefined"!=typeof this.before[a]?this.before[a]:d,c.apply(this,e)!==!1){f&&f.apply(this,arguments);var g;g=b.isFunction(this.after)?this.after:"undefined"!=typeof this.after[a]?this.after[a]:d,g.apply(this,e)}},this);return c.call(this,a,e,g)}})}(Backbone,_),function(a,b){"function"==typeof define&&define.amd?define(["underscore","backbone","jquery"],function(c,d,e){return a.Backbone=b(c,d,e)}):a.Backbone=b(a._,a.Backbone,a.jQuery)}(this,function(a,b,c){function d(b,d){var e;return(e=d&&d.url?d.url:a.isFunction(b.url)?b.url():b.url)?d&&d.data?e+"?"+c.param(d.data):e:void 0}function e(a,c,d){c=c||{};var e=b.fetchCache.getCacheKey(a,c),f=!1;e&&c.cache!==!1&&(c.cache||c.prefill)&&(c.expires!==!1&&(f=(new Date).getTime()+1e3*(c.expires||300)),b.fetchCache._cache[e]={expires:f,value:d},b.fetchCache.setLocalStorage())}function f(c){a.isFunction(c)&&(c=c()),delete b.fetchCache._cache[c],b.fetchCache.setLocalStorage()}function g(){if(k&&b.fetchCache.localStorage)try{localStorage.setItem(b.fetchCache.getLocalStorageKey(),JSON.stringify(b.fetchCache._cache))}catch(a){var c=a.code||a.number||a.message;if(22!==c)throw a;this._deleteCacheWithPriority()}}function h(){if(k&&b.fetchCache.localStorage){var a=localStorage.getItem(b.fetchCache.getLocalStorageKey())||"{}";b.fetchCache._cache=JSON.parse(a)}}function i(a){return window.setTimeout(a,0)}var j={modelFetch:b.Model.prototype.fetch,modelSync:b.Model.prototype.sync,collectionFetch:b.Collection.prototype.fetch},k=function(){var a="undefined"!=typeof window.localStorage;if(a)try{localStorage.setItem("test_support","test_support"),localStorage.removeItem("test_support")}catch(b){a=!1}return a}();return b.fetchCache=b.fetchCache||{},b.fetchCache._cache=b.fetchCache._cache||{},b.fetchCache.priorityFn=function(a,b){return a&&a.expires&&b&&b.expires?a.expires-b.expires:a},b.fetchCache._prioritize=function(){var b=a.values(this._cache).sort(this.priorityFn),c=a.indexOf(a.values(this._cache),b[0]);return a.keys(this._cache)[c]},b.fetchCache._deleteCacheWithPriority=function(){b.fetchCache._cache[this._prioritize()]=null,delete b.fetchCache._cache[this._prioritize()],b.fetchCache.setLocalStorage()},b.fetchCache.getLocalStorageKey=function(){return"backboneCache"},"undefined"==typeof b.fetchCache.localStorage&&(b.fetchCache.localStorage=!0),b.Model.prototype.fetch=function(d){function e(){d.parse&&(k=m.parse(k,d)),m.set(k,d),a.isFunction(d.prefillSuccess)&&d.prefillSuccess(m,k,d),m.trigger("cachesync",m,k,d),m.trigger("sync",m,k,d),d.prefill?l.notify(m):(a.isFunction(d.success)&&d.success(m,k,d),l.resolve(m))}d=a.defaults(d||{},{parse:!0});var f=b.fetchCache.getCacheKey(this,d),g=b.fetchCache._cache[f],h=!1,k=!1,l=new c.Deferred,m=this;return g&&(h=g.expires,h=h&&g.expires<(new Date).getTime(),k=g.value),h||!d.cache&&!d.prefill||!k||(null==d.async&&(d.async=!0),d.async?i(e):e(),d.prefill)?j.modelFetch.apply(this,arguments).done(a.bind(l.resolve,this,this)).done(a.bind(b.fetchCache.setCache,null,this,d)).fail(a.bind(l.reject,this,this)):l},b.Model.prototype.sync=function(a,c,d){if("read"===a)return j.modelSync.apply(this,arguments);var e,g,h=c.collection,i=[];for(i.push(b.fetchCache.getCacheKey(c,d)),h&&i.push(b.fetchCache.getCacheKey(h)),e=0,g=i.length;g>e;e++)f(i[e]);return j.modelSync.apply(this,arguments)},b.Collection.prototype.fetch=function(d){function e(){m[d.reset?"reset":"set"](k,d),a.isFunction(d.prefillSuccess)&&d.prefillSuccess(m),m.trigger("cachesync",m,k,d),m.trigger("sync",m,k,d),d.prefill?l.notify(m):(a.isFunction(d.success)&&d.success(m,k,d),l.resolve(m))}d=a.defaults(d||{},{parse:!0});var f=b.fetchCache.getCacheKey(this,d),g=b.fetchCache._cache[f],h=!1,k=!1,l=new c.Deferred,m=this;return g&&(h=g.expires,h=h&&g.expires<(new Date).getTime(),k=g.value),h||!d.cache&&!d.prefill||!k||(null==d.async&&(d.async=!0),d.async?i(e):e(),d.prefill)?j.collectionFetch.apply(this,arguments).done(a.bind(l.resolve,this,this)).done(a.bind(b.fetchCache.setCache,null,this,d)).fail(a.bind(l.reject,this,this)):l},h(),b.fetchCache._superMethods=j,b.fetchCache.setCache=e,b.fetchCache.getCacheKey=d,b.fetchCache.clearItem=f,b.fetchCache.setLocalStorage=g,b.fetchCache.getLocalStorage=h,b}),function(a){"function"==typeof module?module.exports=a(this.jQuery||require("jquery")):this.NProgress=a(this.jQuery)}(function(a){function b(a,b,c){return b>a?b:a>c?c:a}function c(a){return 100*(-1+a)}function d(a,b,d){var e;return e="translate3d"===f.positionUsing?{transform:"translate3d("+c(a)+"%,0,0)"}:"translate"===f.positionUsing?{transform:"translate("+c(a)+"%,0)"}:{"margin-left":c(a)+"%"},e.transition="all "+b+"ms "+d,e}var e={};e.version="0.1.2";var f=e.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>',type:"desktop"};return e.configure=function(b){return a.extend(f,b),this},e.status=null,e.set=function(a){var c=e.isStarted();a=b(a,f.minimum,1),e.status=1===a?null:a;var g=e.render(!c),h=g.find('[role="bar"]'),i=f.speed,j=f.easing;return g[0].offsetWidth,g.queue(function(b){""===f.positionUsing&&(f.positionUsing=e.getPositioningCSS()),h.css(d(a,i,j)),1===a?(g.css({transition:"none",opacity:1}),g[0].offsetWidth,setTimeout(function(){g.css({transition:"all "+i+"ms linear",opacity:0}),setTimeout(function(){e.remove(),b()},i)},i)):setTimeout(b,i)}),this},e.isStarted=function(){return"number"==typeof e.status},e.start=function(){e.status||e.set(0);var a=function(){setTimeout(function(){e.status&&(e.trickle(),a())},f.trickleSpeed)};return f.trickle&&a(),this},e.done=function(a){return a||e.status?e.inc(.3+.5*Math.random()).set(1):this},e.inc=function(a){var c=e.status;return c?("number"!=typeof a&&(a=(1-c)*b(Math.random()*c,.1,.95)),c=b(c+a,0,.994),e.set(c)):e.start()},e.trickle=function(){return e.inc(Math.random()*f.trickleRate)},e.render=function(b){if(e.isRendered())return a("#nprogress");a("html").addClass("nprogress-busy");var d=a("<div id='nprogress'>").html(f.template);d.find(".bar").attr("data-type",f.type);var g=b?"-100":c(e.status||0);return d.find('[role="bar"]').css({transition:"all 0 linear",transform:"translate3d("+g+"%,0,0)"}),f.showSpinner||d.find('[role="spinner"]').remove(),d.appendTo(document.body),d},e.remove=function(){a("html").removeClass("nprogress-busy"),a("#nprogress").remove()},e.isRendered=function(){return a("#nprogress").length>0},e.getPositioningCSS=function(){var a=document.body.style,b="WebkitTransform"in a?"Webkit":"MozTransform"in a?"Moz":"msTransform"in a?"ms":"OTransform"in a?"O":"";return b+"Perspective"in a?"translate3d":b+"Transform"in a?"translate":"margin"},e}),function(a,b){"use strict";function c(){d.READY||(d.event.determineEventTypes(),d.utils.each(d.gestures,function(a){d.detection.register(a)}),d.event.onTouch(d.DOCUMENT,d.EVENT_MOVE,d.detection.detect),d.event.onTouch(d.DOCUMENT,d.EVENT_END,d.detection.detect),d.READY=!0)}var d=function(a,b){return new d.Instance(a,b||{})};d.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},d.HAS_POINTEREVENTS=a.navigator.pointerEnabled||a.navigator.msPointerEnabled,d.HAS_TOUCHEVENTS="ontouchstart"in a,d.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&a.navigator.userAgent.match(d.MOBILE_REGEX),d.EVENT_TYPES={},d.DIRECTION_DOWN="down",d.DIRECTION_LEFT="left",d.DIRECTION_UP="up",d.DIRECTION_RIGHT="right",d.POINTER_MOUSE="mouse",d.POINTER_TOUCH="touch",d.POINTER_PEN="pen",d.EVENT_START="start",d.EVENT_MOVE="move",d.EVENT_END="end",d.DOCUMENT=a.document,d.plugins=d.plugins||{},d.gestures=d.gestures||{},d.READY=!1,d.utils={extend:function(a,c,d){for(var e in c)a[e]!==b&&d||(a[e]=c[e]);return a},each:function(a,c,d){var e,f;if("forEach"in a)a.forEach(c,d);else if(a.length!==b){for(e=0,f=a.length;f>e;e++)if(c.call(d,a[e],e,a)===!1)return}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return},hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){var b=[],c=[];return d.utils.each(a,function(a){b.push("undefined"!=typeof a.clientX?a.clientX:a.pageX),c.push("undefined"!=typeof a.clientY?a.clientY:a.pageY)}),{pageX:(Math.min.apply(Math,b)+Math.max.apply(Math,b))/2,pageY:(Math.min.apply(Math,c)+Math.max.apply(Math,c))/2}},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.pageY-a.pageY,d=b.pageX-a.pageX;return 180*Math.atan2(c,d)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.pageX-b.pageX),e=Math.abs(a.pageY-b.pageY);return c>=e?a.pageX-b.pageX>0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT:a.pageY-b.pageY>0?d.DIRECTION_UP:d.DIRECTION_DOWN},getDistance:function(a,b){var c=b.pageX-a.pageX,d=b.pageY-a.pageY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==d.DIRECTION_UP||a==d.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(a,b){b&&a&&a.style&&(d.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(c){d.utils.each(b,function(b){c&&(b=c+b.substring(0,1).toUpperCase()+b.substring(1)),b in a.style&&(a.style[b]=b)})}),"none"==b.userSelect&&(a.onselectstart=function(){return!1}),"none"==b.userDrag&&(a.ondragstart=function(){return!1}))}},d.Instance=function(a,b){var e=this;return c(),this.element=a,this.enabled=!0,this.options=d.utils.extend(d.utils.extend({},d.defaults),b||{}),this.options.stop_browser_behavior&&d.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),d.event.onTouch(a,d.EVENT_START,function(a){e.enabled&&d.detection.startDetect(e,a)}),this},d.Instance.prototype={on:function(a,b){var c=a.split(" ");return d.utils.each(c,function(a){this.element.addEventListener(a,b,!1)},this),this},off:function(a,b){var c=a.split(" ");return d.utils.each(c,function(a){this.element.removeEventListener(a,b,!1)},this),this},trigger:function(a,b){b||(b={});var c=d.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var e=this.element;return d.utils.hasParent(b.target,e)&&(e=b.target),e.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this}};var e=null,f=!1,g=!1;d.event={bindDom:function(a,b,c){var e=b.split(" ");d.utils.each(e,function(b){a.addEventListener(b,c,!1)})},onTouch:function(a,b,c){var h=this;this.bindDom(a,d.EVENT_TYPES[b],function(i){var j=i.type.toLowerCase();if(!j.match(/mouse/)||!g){j.match(/touch/)||j.match(/pointerdown/)||j.match(/mouse/)&&1===i.which?f=!0:j.match(/mouse/)&&!i.which&&(f=!1),j.match(/touch|pointer/)&&(g=!0);var k=0;f&&(d.HAS_POINTEREVENTS&&b!=d.EVENT_END?k=d.PointerEvent.updatePointer(b,i):j.match(/touch/)?k=i.touches.length:g||(k=j.match(/up/)?0:1),k>0&&b==d.EVENT_END?b=d.EVENT_MOVE:k||(b=d.EVENT_END),(k||null===e)&&(e=i),c.call(d.detection,h.collectEventData(a,b,h.getTouchList(e,b),i)),d.HAS_POINTEREVENTS&&b==d.EVENT_END&&(k=d.PointerEvent.updatePointer(b,i))),k||(e=null,f=!1,g=!1,d.PointerEvent.reset())}})},determineEventTypes:function(){var a;a=d.HAS_POINTEREVENTS?d.PointerEvent.getEvents():d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],d.EVENT_TYPES[d.EVENT_START]=a[0],d.EVENT_TYPES[d.EVENT_MOVE]=a[1],d.EVENT_TYPES[d.EVENT_END]=a[2]},getTouchList:function(a){return d.HAS_POINTEREVENTS?d.PointerEvent.getTouchList():a.touches?a.touches:(a.identifier=1,[a])},collectEventData:function(a,b,c,e){var f=d.POINTER_TOUCH;return(e.type.match(/mouse/)||d.PointerEvent.matchType(d.POINTER_MOUSE,e))&&(f=d.POINTER_MOUSE),{center:d.utils.getCenter(c),timeStamp:(new Date).getTime(),target:e.target,touches:c,eventType:b,pointerType:f,srcEvent:e,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return d.detection.stopDetect()}}}},d.PointerEvent={pointers:{},getTouchList:function(){var a=this,b=[];return d.utils.each(a.pointers,function(a){b.push(a)}),b},updatePointer:function(a,b){return a==d.EVENT_END?this.pointers={}:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b),Object.keys(this.pointers).length},matchType:function(a,b){if(!b.pointerType)return!1;var c=b.pointerType,e={};return e[d.POINTER_MOUSE]=c===b.MSPOINTER_TYPE_MOUSE||c===d.POINTER_MOUSE,e[d.POINTER_TOUCH]=c===b.MSPOINTER_TYPE_TOUCH||c===d.POINTER_TOUCH,e[d.POINTER_PEN]=c===b.MSPOINTER_TYPE_PEN||c===d.POINTER_PEN,e[a]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:d.utils.extend({},b),lastEvent:!1,name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);var b=this.current.inst.options;return d.utils.each(this.gestures,function(c){return this.stopped||b[c.name]===!1||c.handler.call(c,a,this.current.inst)!==!1?void 0:(this.stopDetect(),!1)},this),this.current&&(this.current.lastEvent=a),a.eventType==d.EVENT_END&&!a.touches.length-1&&this.stopDetect(),a}},stopDetect:function(){this.previous=d.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(a){var b=this.current.startEvent;!b||a.touches.length==b.touches.length&&a.touches!==b.touches||(b.touches=[],d.utils.each(a.touches,function(a){b.touches.push(d.utils.extend({},a))}));var c,e,f=a.timeStamp-b.timeStamp,g=a.center.pageX-b.center.pageX,h=a.center.pageY-b.center.pageY,i=d.utils.getVelocity(f,g,h);return"end"===a.eventType?(c=this.current.lastEvent&&this.current.lastEvent.interimAngle,e=this.current.lastEvent&&this.current.lastEvent.interimDirection):(c=this.current.lastEvent&&d.utils.getAngle(this.current.lastEvent.center,a.center),e=this.current.lastEvent&&d.utils.getDirection(this.current.lastEvent.center,a.center)),d.utils.extend(a,{deltaTime:f,deltaX:g,deltaY:h,velocityX:i.x,velocityY:i.y,distance:d.utils.getDistance(b.center,a.center),angle:d.utils.getAngle(b.center,a.center),interimAngle:c,direction:d.utils.getDirection(b.center,a.center),interimDirection:e,scale:d.utils.getScale(b.touches,a.touches),rotation:d.utils.getRotation(b.touches,a.touches),startEvent:b}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),d.utils.extend(d.defaults,c,!0),a.index=a.index||1e3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}},d.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),void(this.triggered=!1);if(!(b.options.drag_max_touches>0&&a.touches.length>b.options.drag_max_touches))switch(a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:if(a.distance<b.options.drag_min_distance&&d.detection.current.name!=this.name)return;if(d.detection.current.name!=this.name&&(d.detection.current.name=this.name,b.options.correct_for_drag_min_distance&&a.distance>0)){var c=Math.abs(b.options.drag_min_distance/a.distance);d.detection.current.startEvent.center.pageX+=a.deltaX*c,d.detection.current.startEvent.center.pageY+=a.deltaY*c,a=d.detection.extendEventData(a)}(d.detection.current.lastEvent.drag_locked_to_axis||b.options.drag_lock_to_axis&&b.options.drag_lock_min_distance<=a.distance)&&(a.drag_locked_to_axis=!0);var e=d.detection.current.lastEvent.direction;a.drag_locked_to_axis&&e!==a.direction&&(d.utils.isVertical(e)?a.direction=a.deltaY<0?d.DIRECTION_UP:d.DIRECTION_DOWN:a.direction=a.deltaX<0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT),this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),b.trigger(this.name+a.direction,a),(b.options.drag_block_vertical&&d.utils.isVertical(a.direction)||b.options.drag_block_horizontal&&!d.utils.isVertical(a.direction))&&a.preventDefault();break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(a,b){switch(a.eventType){case d.EVENT_START:clearTimeout(this.timer),d.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==d.detection.current.name&&b.trigger("hold",a)},b.options.hold_timeout);break;case d.EVENT_MOVE:a.distance>b.options.hold_threshold&&clearTimeout(this.timer);break;case d.EVENT_END:clearTimeout(this.timer)}}},d.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==d.EVENT_END&&b.trigger(this.name,a)}},d.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(a,b){if(a.eventType==d.EVENT_END){if(b.options.swipe_max_touches>0&&a.touches.length<b.options.swipe_min_touches&&a.touches.length>b.options.swipe_max_touches)return;(a.velocityX>b.options.swipe_velocity||a.velocityY>b.options.swipe_velocity)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},d.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(a,b){if(a.eventType==d.EVENT_END&&"touchcancel"!=a.srcEvent.type){var c=d.detection.previous,e=!1;if(a.deltaTime>b.options.tap_max_touchtime||a.distance>b.options.tap_max_distance)return;c&&"tap"==c.name&&a.timeStamp-c.lastEvent.timeStamp<b.options.doubletap_interval&&a.distance<b.options.doubletap_distance&&(b.trigger("doubletap",a),e=!0),(!e||b.options.tap_always)&&(d.detection.current.name="tap",b.trigger(d.detection.current.name,a))}}},d.gestures.Touch={name:"touch",index:-(1/0),defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(a,b){return b.options.prevent_mouseevents&&a.pointerType==d.POINTER_MOUSE?void a.stopDetect():(b.options.prevent_default&&a.preventDefault(),void(a.eventType==d.EVENT_START&&b.trigger(this.name,a)))}},d.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),void(this.triggered=!1);if(!(a.touches.length<2))switch(b.options.transform_always_block&&a.preventDefault(),a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:var c=Math.abs(1-a.scale),e=Math.abs(a.rotation);if(c<b.options.transform_min_scale&&e<b.options.transform_min_rotation)return;d.detection.current.name=this.name,this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),e>b.options.transform_min_rotation&&b.trigger("rotate",a),c>b.options.transform_min_scale&&(b.trigger("pinch",a),b.trigger("pinch"+(a.scale<1?"in":"out"),a));break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return d}):"object"==typeof module&&"object"==typeof module.exports?module.exports=d:a.Hammer=d}(this),function(a,b){"use strict";function c(a){this.callback=a,this.ticking=!1}function d(a){if(arguments.length<=0)throw new Error("Missing arguments in extend function");var b,c,e=a||{};for(c=1;c<arguments.length;c++){var f=arguments[c]||{};for(b in f)"object"==typeof e[b]?e[b]=d(e[b],f[b]):e[b]=e[b]||f[b]}return e}function e(a,b){b=d(b,e.options),this.lastKnownScrollY=0,this.elem=a,this.debouncer=new c(this.update.bind(this)),this.tolerance=b.tolerance,this.classes=b.classes,this.offset=b.offset,this.initialised=!1,this.onPin=b.onPin,this.onUnpin=b.onUnpin,this.onTop=b.onTop,this.onNotTop=b.onNotTop}var f={bind:!!function(){}.bind,classList:"classList"in b.documentElement,rAF:!!(a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame)};a.requestAnimationFrame=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame,c.prototype={constructor:c,update:function(){this.callback&&this.callback(),this.ticking=!1},requestTick:function(){this.ticking||(requestAnimationFrame(this.rafCallback||(this.rafCallback=this.update.bind(this))),this.ticking=!0)},handleEvent:function(){this.requestTick()}},e.prototype={constructor:e,init:function(){return e.cutsTheMustard?(this.elem.classList.add(this.classes.initial),setTimeout(this.attachEvent.bind(this),100),this):void 0},destroy:function(){var b=this.classes;this.initialised=!1,a.removeEventListener("scroll",this.debouncer,!1),this.elem.classList.remove(b.unpinned,b.pinned,b.top,b.initial)},attachEvent:function(){this.initialised||(this.lastKnownScrollY=this.getScrollY(),this.initialised=!0,a.addEventListener("scroll",this.debouncer,!1),this.debouncer.handleEvent())},unpin:function(){var a=this.elem.classList,b=this.classes;(a.contains(b.pinned)||!a.contains(b.unpinned))&&(a.add(b.unpinned),a.remove(b.pinned),this.onUnpin&&this.onUnpin.call(this))},pin:function(){var a=this.elem.classList,b=this.classes;a.contains(b.unpinned)&&(a.remove(b.unpinned),a.add(b.pinned),this.onPin&&this.onPin.call(this))},top:function(){var a=this.elem.classList,b=this.classes;a.contains(b.top)||(a.add(b.top),a.remove(b.notTop),this.onTop&&this.onTop.call(this))},notTop:function(){var a=this.elem.classList,b=this.classes;a.contains(b.notTop)||(a.add(b.notTop),a.remove(b.top),this.onNotTop&&this.onNotTop.call(this))},getScrollY:function(){return void 0!==a.pageYOffset?a.pageYOffset:(b.documentElement||b.body.parentNode||b.body).scrollTop},getViewportHeight:function(){return a.innerHeight||b.documentElement.clientHeight||b.body.clientHeight},getDocumentHeight:function(){var a=b.body,c=b.documentElement;return Math.max(a.scrollHeight,c.scrollHeight,a.offsetHeight,c.offsetHeight,a.clientHeight,c.clientHeight)},isOutOfBounds:function(a){var b=0>a,c=a+this.getViewportHeight()>this.getDocumentHeight();return b||c},toleranceExceeded:function(a){return Math.abs(a-this.lastKnownScrollY)>=this.tolerance},shouldUnpin:function(a,b){var c=a>this.lastKnownScrollY,d=a>=this.offset;return c&&d&&b},shouldPin:function(a,b){var c=a<this.lastKnownScrollY,d=a<=this.offset;return c&&b||d},update:function(){var a=this.getScrollY(),b=this.toleranceExceeded(a);this.isOutOfBounds(a)||(a<=this.offset?this.top():this.notTop(),this.shouldUnpin(a,b)?this.unpin():this.shouldPin(a,b)&&this.pin(),this.lastKnownScrollY=a)}},e.options={
tolerance:0,offset:0,classes:{pinned:"headroom--pinned",unpinned:"headroom--unpinned",top:"headroom--top",notTop:"headroom--not-top",initial:"headroom"}},e.cutsTheMustard="undefined"!=typeof f&&f.rAF&&f.bind&&f.classList,a.Headroom=e}(window,document),function(a){a&&(a.fn.headroom=function(b){return this.each(function(){var c=a(this),d=c.data("headroom"),e="object"==typeof b&&b;e=a.extend(!0,{},Headroom.options,e),d||(d=new Headroom(this,e),d.init(),c.data("headroom",d)),"string"==typeof b&&d[b]()})},a("[data-headroom]").each(function(){var b=a(this);b.headroom(b.data())}))}(window.Zepto||window.jQuery);var deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),deviceIsIOS4=deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),deviceIsIOSWithBadTarget=deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent);FastClick.prototype.needsClick=function(a){"use strict";switch(a.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(a.disabled)return!0;break;case"input":if(deviceIsIOS&&"file"===a.type||a.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(a.className)},FastClick.prototype.needsFocus=function(a){"use strict";switch(a.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!deviceIsAndroid;case"input":switch(a.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!a.disabled&&!a.readOnly;default:return/\bneedsfocus\b/.test(a.className)}},FastClick.prototype.sendClick=function(a,b){"use strict";var c,d;document.activeElement&&document.activeElement!==a&&document.activeElement.blur(),d=b.changedTouches[0],c=document.createEvent("MouseEvents"),c.initMouseEvent(this.determineEventType(a),!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),c.forwardedTouchEvent=!0,a.dispatchEvent(c)},FastClick.prototype.determineEventType=function(a){"use strict";return deviceIsAndroid&&"select"===a.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(a){"use strict";var b;deviceIsIOS&&a.setSelectionRange&&0!==a.type.indexOf("date")&&"time"!==a.type?(b=a.value.length,a.setSelectionRange(b,b)):a.focus()},FastClick.prototype.updateScrollParent=function(a){"use strict";var b,c;if(b=a.fastClickScrollParent,!b||!b.contains(a)){c=a;do{if(c.scrollHeight>c.offsetHeight){b=c,a.fastClickScrollParent=c;break}c=c.parentElement}while(c)}b&&(b.fastClickLastScrollTop=b.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(a){"use strict";return a.nodeType===Node.TEXT_NODE?a.parentNode:a},FastClick.prototype.onTouchStart=function(a){"use strict";var b,c,d;if(a.targetTouches.length>1)return!0;if(b=this.getTargetElementFromEventTarget(a.target),c=a.targetTouches[0],deviceIsIOS){if(d=window.getSelection(),d.rangeCount&&!d.isCollapsed)return!0;if(!deviceIsIOS4){if(c.identifier===this.lastTouchIdentifier)return a.preventDefault(),!1;this.lastTouchIdentifier=c.identifier,this.updateScrollParent(b)}}return this.trackingClick=!0,this.trackingClickStart=a.timeStamp,this.targetElement=b,this.touchStartX=c.pageX,this.touchStartY=c.pageY,a.timeStamp-this.lastClickTime<this.tapDelay&&a.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(a){"use strict";var b=a.changedTouches[0],c=this.touchBoundary;return Math.abs(b.pageX-this.touchStartX)>c||Math.abs(b.pageY-this.touchStartY)>c?!0:!1},FastClick.prototype.onTouchMove=function(a){"use strict";return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(a.target)||this.touchHasMoved(a))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},FastClick.prototype.findControl=function(a){"use strict";return void 0!==a.control?a.control:a.htmlFor?document.getElementById(a.htmlFor):a.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(a){"use strict";var b,c,d,e,f,g=this.targetElement;if(!this.trackingClick)return!0;if(a.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(this.cancelNextClick=!1,this.lastClickTime=a.timeStamp,c=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,deviceIsIOSWithBadTarget&&(f=a.changedTouches[0],g=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)||g,g.fastClickScrollParent=this.targetElement.fastClickScrollParent),d=g.tagName.toLowerCase(),"label"===d){if(b=this.findControl(g)){if(this.focus(g),deviceIsAndroid)return!1;g=b}}else if(this.needsFocus(g))return a.timeStamp-c>100||deviceIsIOS&&window.top!==window&&"input"===d?(this.targetElement=null,!1):(this.focus(g),this.sendClick(g,a),deviceIsIOS&&"select"===d||(this.targetElement=null,a.preventDefault()),!1);return deviceIsIOS&&!deviceIsIOS4&&(e=g.fastClickScrollParent,e&&e.fastClickLastScrollTop!==e.scrollTop)?!0:(this.needsClick(g)||(a.preventDefault(),this.sendClick(g,a)),!1)},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(a){"use strict";return this.targetElement?a.forwardedTouchEvent?!0:a.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(a.stopImmediatePropagation?a.stopImmediatePropagation():a.propagationStopped=!0,a.stopPropagation(),a.preventDefault(),!1):!0:!0},FastClick.prototype.onClick=function(a){"use strict";var b;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===a.target.type&&0===a.detail?!0:(b=this.onMouse(a),b||(this.targetElement=null),b)},FastClick.prototype.destroy=function(){"use strict";var a=this.layer;deviceIsAndroid&&(a.removeEventListener("mouseover",this.onMouse,!0),a.removeEventListener("mousedown",this.onMouse,!0),a.removeEventListener("mouseup",this.onMouse,!0)),a.removeEventListener("click",this.onClick,!0),a.removeEventListener("touchstart",this.onTouchStart,!1),a.removeEventListener("touchmove",this.onTouchMove,!1),a.removeEventListener("touchend",this.onTouchEnd,!1),a.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(a){"use strict";var b,c;if("undefined"==typeof window.ontouchstart)return!0;if(c=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!deviceIsAndroid)return!0;if(b=document.querySelector("meta[name=viewport]")){if(-1!==b.content.indexOf("user-scalable=no"))return!0;if(c>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}return"none"===a.style.msTouchAction?!0:!1},FastClick.attach=function(a,b){"use strict";return new FastClick(a,b)},"undefined"!=typeof define&&define.amd?define(function(){"use strict";return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,window.Chart=function(a,b){function c(a,b,c,d){m.tooltips.push(new o(a,b,c,d))}function d(b){var c,d;if(0<m.tooltips.length){m.savedState=null==m.savedState?a.getImageData(0,0,a.canvas.width,a.canvas.height):m.savedState;var e,f=0;for(e in m.tooltips){c=a.canvas;var g=0;for(d=0;c;)g+=c.offsetLeft+c.clientLeft,d+=c.offsetTop+c.clientTop,c=c.offsetParent;0<window.pageXOffset||0<window.pageYOffset?(g-=window.pageXOffset,d-=window.pageYOffset):(0<document.body.scrollLeft||0<document.body.scrollTop)&&(g-=document.body.scrollLeft,d-=document.body.scrollTop),c=g,c=b.clientX-c,d=b.clientY-d,m.tooltips[e].inRange(c,d)&&(m.tooltips[e].render(c,d),f++)}0==f&&a.putImageData(m.savedState,0,0)}}function e(a,b,c){return a=i((a-b.graphMin)/(b.steps*b.stepValue),1,0),c*b.steps*a}function f(a,b,c,d){function e(){h+=f;var j=a.animation?i(g(h),null,0):1;d.clearRect(0,0,p,q),a.scaleOverlay?(c(j),b()):(b(),c(j)),1>=h?x(e):"function"==typeof a.onAnimationComplete&&a.onAnimationComplete()}var f=a.animation?1/i(a.animationSteps,Number.MAX_VALUE,1):1,g=n[a.animationEasing],h=a.animation?0:1;"function"!=typeof b&&(b=function(){}),x(e)}function g(a,b,c,d,e,f){var g;for(a=Math.floor(Math.log(d-e)/Math.LN10),e=Math.floor(e/(1*Math.pow(10,a)))*Math.pow(10,a),d=Math.ceil(d/(1*Math.pow(10,a)))*Math.pow(10,a)-e,a=Math.pow(10,a),g=Math.round(d/a);c>g||g>b;)a=c>g?a/2:2*a,g=Math.round(d/a);return b=[],h(f,b,g,e,a),{steps:g,stepValue:a,graphMin:e,labels:b}}function h(a,b,c,d,e){if(a)for(var f=1;c+1>f;f++)b.push(k(a,{value:(d+e*f).toFixed(0!=e%1?e.toString().split(".")[1].length:0)}))}function h(a,b,c,d,e){if(a)for(var f=1;c+1>f;f++)b.push(k(a,{value:(d+e*f).toFixed(0!=e%1?e.toString().split(".")[1].length:0)}))}function i(a,b,c){return!isNaN(parseFloat(b))&&isFinite(b)&&a>b?b:!isNaN(parseFloat(c))&&isFinite(c)&&c>a?c:a}function j(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]="object"==typeof b[c]&&a[c]?j(a[c],b[c]):b[c];return d}function k(a,b){var c=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):y[a]=y[a]||k(document.getElementById(a).innerHTML);return b?c(b):c}function l(a,b,c){var d,e=document.createElement("div");e.style.color=b,document.body.appendChild(e),b=window.getComputedStyle(e).color,e.style.color=c,d=window.getComputedStyle(e).color;var f=/rgb *\( *([0-9]{1,3}) *, *([0-9]{1,3}) *, *([0-9]{1,3}) *\)/;c=f.exec(b);var g=f.exec(d);d=Math.round(parseFloat(c[1])),b=Math.round(parseFloat(c[2])),c=Math.round(parseFloat(c[3]));var h=Math.round(parseFloat(g[1])),f=Math.round(parseFloat(g[2])),g=Math.round(parseFloat(g[3]));return d=parseInt((d-h)*a+h),b=parseInt((b-f)*a+f),a=parseInt((c-g)*a+g),e.parentNode.removeChild(e),"rgb("+d+","+b+","+a+")"}var m=this,n={linear:function(a){return a},easeInQuad:function(a){return a*a},easeOutQuad:function(a){return-1*a*(a-2)},easeInOutQuad:function(a){return 1>(a/=.5)?.5*a*a:-.5*(--a*(a-2)-1)},easeInCubic:function(a){return a*a*a},easeOutCubic:function(a){return 1*((a=a/1-1)*a*a+1)},easeInOutCubic:function(a){return 1>(a/=.5)?.5*a*a*a:.5*((a-=2)*a*a+2)},easeInQuart:function(a){return a*a*a*a},easeOutQuart:function(a){return-1*((a=a/1-1)*a*a*a-1)},easeInOutQuart:function(a){return 1>(a/=.5)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},easeInQuint:function(a){return 1*(a/=1)*a*a*a*a},easeOutQuint:function(a){return 1*((a=a/1-1)*a*a*a*a+1)},easeInOutQuint:function(a){return 1>(a/=.5)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},easeInSine:function(a){return-1*Math.cos(a/1*(Math.PI/2))+1},easeOutSine:function(a){return 1*Math.sin(a/1*(Math.PI/2))},easeInOutSine:function(a){return-.5*(Math.cos(Math.PI*a/1)-1)},easeInExpo:function(a){return 0==a?1:1*Math.pow(2,10*(a/1-1))},easeOutExpo:function(a){return 1==a?1:1*(-Math.pow(2,-10*a/1)+1)},easeInOutExpo:function(a){return 0==a?0:1==a?1:1>(a/=.5)?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return a>=1?a:-1*(Math.sqrt(1-(a/=1)*a)-1)},easeOutCirc:function(a){return 1*Math.sqrt(1-(a=a/1-1)*a)},easeInOutCirc:function(a){return 1>(a/=.5)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},easeInElastic:function(a){var b=1.70158,c=0,d=1;return 0==a?0:1==(a/=1)?1:(c||(c=.3),d<Math.abs(1)?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),-(d*Math.pow(2,10*(a-=1))*Math.sin(2*(1*a-b)*Math.PI/c)))},easeOutElastic:function(a){var b=1.70158,c=0,d=1;return 0==a?0:1==(a/=1)?1:(c||(c=.3),d<Math.abs(1)?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),d*Math.pow(2,-10*a)*Math.sin(2*(1*a-b)*Math.PI/c)+1)},easeInOutElastic:function(a){var b=1.70158,c=0,d=1;return 0==a?0:2==(a/=.5)?1:(c||(c=.3*1.5),d<Math.abs(1)?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),1>a?-.5*d*Math.pow(2,10*(a-=1))*Math.sin(2*(1*a-b)*Math.PI/c):.5*d*Math.pow(2,-10*(a-=1))*Math.sin(2*(1*a-b)*Math.PI/c)+1)},easeInBack:function(a){return 1*(a/=1)*a*(2.70158*a-1.70158)},easeOutBack:function(a){return 1*((a=a/1-1)*a*(2.70158*a+1.70158)+1)},easeInOutBack:function(a){var b=1.70158;return 1>(a/=.5)?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},easeInBounce:function(a){return 1-n.easeOutBounce(1-a)},easeOutBounce:function(a){return(a/=1)<1/2.75?7.5625*a*a:2/2.75>a?1*(7.5625*(a-=1.5/2.75)*a+.75):2.5/2.75>a?1*(7.5625*(a-=2.25/2.75)*a+.9375):1*(7.5625*(a-=2.625/2.75)*a+.984375)},easeInOutBounce:function(a){return.5>a?.5*n.easeInBounce(2*a):.5*n.easeOutBounce(2*a-1)+.5}};this.tooltips=[],defaults={tooltips:{background:"black",fontFamily:"'Arial'",fontStyle:"normal",fontColor:"white",fontSize:"12px",labelTemplate:"<%=label%>: <%=value%>",height:24,padding:{top:4,right:8,bottom:4,left:8},position:"bottom center",offset:{left:0,top:0},border:{width:0,color:"black",radius:4},showShadow:!0,shadow:{color:"rgba(0,0,0,0.9)",blur:8,offsetX:0,offsetY:0},showHighlight:!0,highlight:{stroke:{width:1,color:"rgba(230,230,230,0.25)"},fill:"rgba(255,255,255,0.25)"}}},b=b?j(defaults,b):defaults;var o=function(a,c,d,e){this.ctx=a,this.areaObj=c,this.data=d,this.y=this.x=this.highlightState=this.savedState=null,this.inRange=function(a,b){if(this.areaObj.type)switch(this.areaObj.type){case"rect":return a>=this.areaObj.x&&a<=this.areaObj.x+this.areaObj.width&&b>=this.areaObj.y&&b<=this.areaObj.y+this.areaObj.height;case"circle":return Math.pow(a-this.areaObj.x,2)+Math.pow(b-this.areaObj.y,2)<Math.pow(this.areaObj.r,2);case"shape":for(var c=this.areaObj.points,d=!1,e=-1,f=c.length,g=f-1;++e<f;g=e)(c[e].y<=b&&b<c[g].y||c[g].y<=b&&b<c[e].y)&&a<(c[g].x-c[e].x)*(b-c[e].y)/(c[g].y-c[e].y)+c[e].x&&(d=!d);return d}},this.render=function(c,d){if(this.ctx.shadowColor=void 0,this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,null==this.savedState&&(this.ctx.putImageData(m.savedState,0,0),this.savedState=this.ctx.getImageData(0,0,this.ctx.canvas.width,this.ctx.canvas.height)),this.ctx.putImageData(this.savedState,0,0),b.tooltips.showHighlight)if(null==this.highlightState){switch(this.ctx.strokeStyle=b.tooltips.highlight.stroke.color,this.ctx.lineWidth=b.tooltips.highlight.stroke.width,this.ctx.fillStyle=b.tooltips.highlight.fill,this.areaObj.type){case"rect":this.ctx.strokeRect(this.areaObj.x,this.areaObj.y,this.areaObj.width,this.areaObj.height),this.ctx.fillStyle=b.tooltips.highlight.fill,this.ctx.fillRect(this.areaObj.x,this.areaObj.y,this.areaObj.width,this.areaObj.height);break;case"circle":this.ctx.beginPath(),this.ctx.arc(this.areaObj.x,this.areaObj.y,this.areaObj.r,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.fill();break;case"shape":this.ctx.beginPath(),this.ctx.moveTo(this.areaObj.points[0].x,this.areaObj.points[0].y);for(var e in this.areaObj.points)this.ctx.lineTo(this.areaObj.points[e].x,this.areaObj.points[e].y);this.ctx.stroke(),this.ctx.fill()}this.highlightState=this.ctx.getImageData(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}else this.ctx.putImageData(this.highlightState,0,0);e=c+b.tooltips.offset.left;var f=d+b.tooltips.offset.top,g=k(b.tooltips.labelTemplate,this.data),h=b.tooltips.padding.left+this.ctx.measureText(g).width+b.tooltips.padding.right,i=b.tooltips.position.split(" "),j=b.tooltips.height;if(b.tooltips.fontSize.match(/[0-9]+(.[0-9]+)?px/))j=parseInt(b.tooltips.fontSize);else if(b.tooltips.fontSize.match(/[0-9]+(.[0-9]+)?(\%|em)/)){j=parseFloat(b.tooltips.fontSize),b.tooltips.fontSize.match(/[0-9]+(.[0-9]+)?\%/)&&(j/=100);var l=this.ctx.canvas.parentNode,l=l||document.body,n=document.createElement("div");n.style.cssText="display:inline-block; padding:0; line-height:1; position:absolute; visibility:hidden; font-size:1em",n.appendChild(document.createTextNode("M")),l.appendChild(n);var o=[n.offsetWidth,n.offsetHeight];l.removeChild(n),j*=o[1]}var p,j=j+(b.tooltips.padding.top+b.tooltips.padding.bottom);for(p in i)0==p&&("bottom"==i[p]?f-=j:"center"==i[p]&&(f-=j/2,1==i.length&&(e-=h/2))),1==p&&("right"==i[p]?e-=h:"center"==i[p]&&(e-=h/2));e+h>a.canvas.width&&(e-=e+h-a.canvas.width),0>e&&(e=0),f+j>a.canvas.height&&(f-=f+j-a.canvas.height),0>f&&(f=0),this.ctx.fillStyle=b.tooltips.background,b.tooltips.showShadow&&(this.ctx.shadowColor=b.tooltips.shadow.color,this.ctx.shadowBlur=b.tooltips.shadow.blur,this.ctx.shadowOffsetX=b.tooltips.shadow.offsetX,this.ctx.shadowOffsetY=b.tooltips.shadow.offsetY),b.tooltips.border.radius?(p=12<b.tooltips.border.radius?12:b.tooltips.border.radius,this.ctx.beginPath(),this.ctx.moveTo(e+p,f),this.ctx.lineTo(e+h-p,f),this.ctx.quadraticCurveTo(e+h,f,e+h,f+p),this.ctx.lineTo(e+h,f+j-p),this.ctx.quadraticCurveTo(e+h,f+j,e+h-p,f+j),this.ctx.lineTo(e+p,f+j),this.ctx.quadraticCurveTo(e,f+j,e,f+j-p),this.ctx.lineTo(e,f+p),this.ctx.quadraticCurveTo(e,f,e+p,f),this.ctx.fill(),0<b.tooltips.border.width&&(this.ctx.strokeStyle=b.tooltips.border.color,this.ctx.lineWidth=b.tooltips.border.width,this.ctx.stroke()),this.ctx.closePath()):(this.ctx.fillRect(e,f,h,j),0<b.tooltips.border.width&&(this.ctx.fillStyle=b.tooltips.border.color,this.ctx.lineWidth=b.tooltips.border.width,this.ctx.strokeRect(e,f,h,j))),this.ctx.font=b.tooltips.fontStyle+" "+b.tooltips.fontSize+" "+b.tooltips.fontFamily,this.ctx.fillStyle=b.tooltips.fontColor,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(g,e+h/2,f+j/2),this.x=c,this.y=d}},p=a.canvas.width,q=a.canvas.height;this.savedState=null,window.Touch?(a.canvas.ontouchstart=function(a){a.clientX=a.targetTouches[0].clientX,a.clientY=a.targetTouches[0].clientY,d(a)},a.canvas.ontouchmove=function(a){a.clientX=a.targetTouches[0].clientX,a.clientY=a.targetTouches[0].clientY,d(a)}):a.canvas.onmousemove=function(a){d(a)},a.canvas.onmouseout=function(b){null!=m.savedState&&a.putImageData(m.savedState,0,0)},window.devicePixelRatio&&(a.canvas.style.width=p+"px",a.canvas.style.height=q+"px",a.canvas.height=q*window.devicePixelRatio,a.canvas.width=p*window.devicePixelRatio,a.scale(window.devicePixelRatio,window.devicePixelRatio)),this.PolarArea=function(b,c){m.PolarArea.defaults={scaleOverlay:!0,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleShowLine:!0,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowLabelBackdrop:!0,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animation:!0,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,onAnimationComplete:null,showTooltips:!0};var d=c?j(m.PolarArea.defaults,c):m.PolarArea.defaults;return new r(b,d,a)},this.Radar=function(b,c){m.Radar.defaults={scaleOverlay:!1,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleShowLine:!0,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!1,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowLabelBackdrop:!0,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,angleShowLineOut:!0,angleLineColor:"rgba(0,0,0,.1)",angleLineWidth:1,pointLabelFontFamily:"'Arial'",pointLabelFontStyle:"normal",pointLabelFontSize:12,pointLabelFontColor:"#666",pointDot:!0,pointDotRadius:3,pointDotStrokeWidth:1,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,animation:!0,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null,showTooltips:!0};var d=c?j(m.Radar.defaults,c):m.Radar.defaults;return new s(b,d,a)},this.Pie=function(b,c){m.Pie.defaults={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animation:!0,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,onAnimationComplete:null,labelFontFamily:"'Arial'",labelFontStyle:"normal",labelFontSize:12,labelFontColor:"#666",labelAlign:"right",showTooltips:!0};var d=c?j(m.Pie.defaults,c):m.Pie.defaults;return new t(b,d,a)},this.Doughnut=function(b,c){m.Doughnut.defaults={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animation:!0,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,onAnimationComplete:null,showTooltips:!0};var d=c?j(m.Doughnut.defaults,c):m.Doughnut.defaults;return new u(b,d,a)},this.Line=function(b,c){m.Line.defaults={scaleOverlay:!1,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:!0,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:2,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,animation:!0,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null,showTooltips:!0};var d=c?j(m.Line.defaults,c):m.Line.defaults;return new v(b,d,a)},this.Bar=function(b,c){m.Bar.defaults={scaleOverlay:!1,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,animation:!0,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null,showTooltips:!0};var d=c?j(m.Bar.defaults,c):m.Bar.defaults;return new w(b,d,a)};var r=function(a,b,d){var i,j,k,l,m,n,o;i=Math.min.apply(Math,[p,q])/2,i-=Math.max.apply(Math,[.5*b.scaleFontSize,.5*b.scaleLineWidth]),l=2*b.scaleFontSize,b.scaleShowLabelBackdrop&&(l+=2*b.scaleBackdropPaddingY,i-=1.5*b.scaleBackdropPaddingY),m=i,l=l?l:5,n=function(){for(var b=Number.MIN_VALUE,c=Number.MAX_VALUE,d=0;d<a.length;d++)a[d].value>b&&(b=a[d].value),a[d].value<c&&(c=a[d].value);return{maxValue:b,minValue:c,maxSteps:Math.floor(m/(.66*l)),minSteps:Math.floor(.5*(m/l))}}(),o=b.scaleShowLabels?b.scaleLabel:null,b.scaleOverride?(k={steps:b.scaleSteps,stepValue:b.scaleStepWidth,graphMin:b.scaleStartValue,labels:[]},h(o,k.labels,k.steps,b.scaleStartValue,b.scaleStepWidth)):k=g(m,n.maxSteps,n.minSteps,n.maxValue,n.minValue,o),j=i/k.steps,f(b,function(){for(var a=0;a<k.steps;a++)if(b.scaleShowLine&&(d.beginPath(),d.arc(p/2,q/2,j*(a+1),0,2*Math.PI,!0),d.strokeStyle=b.scaleLineColor,d.lineWidth=b.scaleLineWidth,d.stroke()),b.scaleShowLabels){d.textAlign="center",d.font=b.scaleFontStyle+" "+b.scaleFontSize+"px "+b.scaleFontFamily;var c=k.labels[a];if(b.scaleShowLabelBackdrop){var e=d.measureText(c).width;d.fillStyle=b.scaleBackdropColor,d.beginPath(),d.rect(Math.round(p/2-e/2-b.scaleBackdropPaddingX),Math.round(q/2-j*(a+1)-.5*b.scaleFontSize-b.scaleBackdropPaddingY),Math.round(e+2*b.scaleBackdropPaddingX),Math.round(b.scaleFontSize+2*b.scaleBackdropPaddingY)),d.fill()}d.textBaseline="middle",d.fillStyle=b.scaleFontColor,d.fillText(c,p/2,q/2-j*(a+1))}},function(f){var g=-Math.PI/2,h=2*Math.PI/a.length,i=1,l=1;b.animation&&(b.animateScale&&(i=f),b.animateRotate&&(l=f));for(var m=0;m<a.length;m++){if(d.beginPath(),d.arc(p/2,q/2,i*e(a[m].value,k,j),g,g+l*h,!1),d.lineTo(p/2,q/2),d.closePath(),d.fillStyle=a[m].color,d.fill(),f>=1&&b.showTooltips){var n=[{x:p/2,y:q/2}],o=e(a[m].value,k,j);n.push({x:p/2+o*Math.cos(g),y:q/2+o*Math.sin(g)});for(var r=0;50>=r;r++)n.push({x:p/2+o*Math.cos(g+r/50*l*h),y:q/2+o*Math.sin(g+r/50*l*h)});c(d,{type:"shape",points:n},{label:a[m].label,value:a[m].value},"PolarArea")}b.segmentShowStroke&&(d.strokeStyle=b.segmentStrokeColor,d.lineWidth=b.segmentStrokeWidth,d.stroke()),g+=l*h}},d)},s=function(a,b,d){var j,k,l,m,n,o,r;a.labels||(a.labels=[]),function(){j=Math.min.apply(Math,[p,q])/2,m=2*b.scaleFontSize;for(var c=0,e=0;e<a.labels.length;e++){d.font=b.pointLabelFontStyle+" "+b.pointLabelFontSize+"px "+b.pointLabelFontFamily;var f=d.measureText(a.labels[e]).width;f>c&&(c=f)}j-=Math.max.apply(Math,[c,1.5*(b.pointLabelFontSize/2)]),j-=b.pointLabelFontSize,n=j=i(j,null,0),m=m?m:5}(),o=function(){for(var b=Number.MIN_VALUE,c=Number.MAX_VALUE,d=0;d<a.datasets.length;d++)for(var e=0;e<a.datasets[d].data.length;e++)a.datasets[d].data[e]>b&&(b=a.datasets[d].data[e]),a.datasets[d].data[e]<c&&(c=a.datasets[d].data[e]);return{maxValue:b,minValue:c,maxSteps:Math.floor(n/(.66*m)),minSteps:Math.floor(.5*(n/m))}}(),r=b.scaleShowLabels?b.scaleLabel:null,b.scaleOverride?(l={steps:b.scaleSteps,stepValue:b.scaleStepWidth,graphMin:b.scaleStartValue,labels:[]},h(r,l.labels,l.steps,b.scaleStartValue,b.scaleStepWidth)):l=g(n,o.maxSteps,o.minSteps,o.maxValue,o.minValue,r),k=j/l.steps,f(b,function(){var c=2*Math.PI/a.datasets[0].data.length;if(d.save(),d.translate(p/2,q/2),b.angleShowLineOut){d.strokeStyle=b.angleLineColor,d.lineWidth=b.angleLineWidth;for(var e=0;e<a.datasets[0].data.length;e++)d.rotate(c),d.beginPath(),d.moveTo(0,0),d.lineTo(0,-j),d.stroke()}for(e=0;e<l.steps;e++){if(d.beginPath(),b.scaleShowLine){d.strokeStyle=b.scaleLineColor,d.lineWidth=b.scaleLineWidth,d.moveTo(0,-k*(e+1));for(var f=0;f<a.datasets[0].data.length;f++)d.rotate(c),d.lineTo(0,-k*(e+1));d.closePath(),d.stroke()}b.scaleShowLabels&&(d.textAlign="center",d.font=b.scaleFontStyle+" "+b.scaleFontSize+"px "+b.scaleFontFamily,d.textBaseline="middle",b.scaleShowLabelBackdrop&&(f=d.measureText(l.labels[e]).width,d.fillStyle=b.scaleBackdropColor,d.beginPath(),d.rect(Math.round(-f/2-b.scaleBackdropPaddingX),Math.round(-k*(e+1)-.5*b.scaleFontSize-b.scaleBackdropPaddingY),Math.round(f+2*b.scaleBackdropPaddingX),Math.round(b.scaleFontSize+2*b.scaleBackdropPaddingY)),d.fill()),d.fillStyle=b.scaleFontColor,d.fillText(l.labels[e],0,-k*(e+1)))}for(e=0;e<a.labels.length;e++){d.font=b.pointLabelFontStyle+" "+b.pointLabelFontSize+"px "+b.pointLabelFontFamily,d.fillStyle=b.pointLabelFontColor;var f=Math.sin(c*e)*(j+b.pointLabelFontSize),g=Math.cos(c*e)*(j+b.pointLabelFontSize);d.textAlign=c*e==Math.PI||0==c*e?"center":c*e>Math.PI?"right":"left",d.textBaseline="middle",d.fillText(a.labels[e],f,-g)}d.restore()},function(f){var g=2*Math.PI/a.datasets[0].data.length;d.save(),d.translate(p/2,q/2);for(var h=0;h<a.datasets.length;h++){var i=e(a.datasets[h].data[0],l,k);if(d.beginPath(),d.moveTo(0,-1*f*i),f>=1&&b.showTooltips){var j=p/2+i*Math.cos(0-Math.PI/2),i=q/2+i*Math.sin(0-Math.PI/2),m=b.pointDot?b.pointDotRadius+b.pointDotStrokeWidth:10;a.labels[0].trim(),c(d,{type:"circle",x:j,y:i,r:m},{label:a.labels[0],value:a.datasets[h].data[0]},"Radar")}for(var n=1;n<a.datasets[h].data.length;n++)i=e(a.datasets[h].data[n],l,k),d.rotate(g),d.lineTo(0,-1*f*i),f>=1&&b.showTooltips&&(j=p/2+i*Math.cos(n*g-Math.PI/2),i=q/2+i*Math.sin(n*g-Math.PI/2),m=b.pointDot?b.pointDotRadius+b.pointDotStrokeWidth:10,a.labels[n].trim(),c(d,{type:"circle",x:j,y:i,r:m},{label:a.labels[n],value:a.datasets[h].data[n]},"Radar"));if(d.closePath(),d.fillStyle=a.datasets[h].fillColor,d.strokeStyle=a.datasets[h].strokeColor,d.lineWidth=b.datasetStrokeWidth,d.fill(),d.stroke(),b.pointDot)for(d.fillStyle=a.datasets[h].pointColor,d.strokeStyle=a.datasets[h].pointStrokeColor,d.lineWidth=b.pointDotStrokeWidth,j=0;j<a.datasets[h].data.length;j++)d.rotate(g),d.beginPath(),d.arc(0,-1*f*e(a.datasets[h].data[j],l,k),b.pointDotRadius,2*Math.PI,!1),d.fill(),d.stroke();d.rotate(g)}d.restore()},d)},t=function(a,b,d){for(var e=0,g=Math.min.apply(Math,[q/2,p/2])-5,h=0;h<a.length;h++)e+=a[h].value;d.fillStyle="black",d.textBaseline="base",f(b,null,function(f){var h=-Math.PI/2,i=1,j=1;b.animation&&(b.animateScale&&(i=f),b.animateRotate&&(j=f));for(var k=0;k<a.length;k++){var m=j*a[k].value/e*2*Math.PI;if(d.beginPath(),d.arc(p/2,q/2,i*g,h,h+m),d.lineTo(p/2,q/2),d.closePath(),d.fillStyle=a[k].color,d.fill(),a[k].label&&2*(i*g)*m/(2*Math.PI)>b.labelFontSize){var n=function(a){switch(a){case"left":return"right";case"right":return"left";case"center":return a}},o=a[k].labelFontSize||b.labelFontSize+"px";null!=o.match(/^[0-9]+$/g)&&(o+="px"),d.font=b.labelFontStyle+" "+o+" "+b.labelFontFamily,d.fillStyle=l(f,a[k].labelColor||"black",a[k].color),d.textBaseline="middle";var o=-(h+m)+m/2,r=p/2+i*g*Math.cos(o),s=q/2-i*g*Math.sin(o);d.textAlign=a[k].labelAlign||b.labelAlign,textX=function(a,b){switch(a){case"left":return-b+20;case"center":return-b/2}return-10}(d.textAlign,i*g),o<-Math.PI/2&&(o-=Math.PI,d.textAlign=n(d.textAlign),textX=-textX),d.translate(r,s),d.rotate(-o),d.fillText(a[k].label,textX,0),d.rotate(o),d.translate(-r,-s)}if(f>=1&&b.showTooltips){for(n=[{x:p/2,y:q/2}],n.push({x:p/2+g*Math.cos(h),y:q/2+g*Math.sin(h)}),o=0;50>=o;o++)n.push({x:p/2+g*Math.cos(h+o/50*m),y:q/2+g*Math.sin(h+o/50*m)});c(d,{type:"shape",points:n},{label:a[k].label,value:a[k].value},"Pie")}b.segmentShowStroke&&(d.lineWidth=b.segmentStrokeWidth,d.strokeStyle=b.segmentStrokeColor,d.stroke()),h+=m}},d)},u=function(a,b,d){for(var e=0,g=Math.min.apply(Math,[q/2,p/2])-5,h=g*(b.percentageInnerCutout/100),i=0;i<a.length;i++)e+=a[i].value;f(b,null,function(f){var i=-Math.PI/2,j=1,k=1;b.animation&&(b.animateScale&&(j=f),b.animateRotate&&(k=f));for(var l=0;l<a.length;l++){var m=k*a[l].value/e*2*Math.PI;if(d.beginPath(),d.arc(p/2,q/2,j*g,i,i+m,!1),d.arc(p/2,q/2,j*h,i+m,i,!0),d.closePath(),d.fillStyle=a[l].color,d.fill(),f>=1&&b.showTooltips){var n=[];n.push({x:p/2+g*Math.cos(i),y:q/2+g*Math.sin(i)});for(var o=0;50>=o;o++)n.push({x:p/2+g*Math.cos(i+o/50*m),y:q/2+g*Math.sin(i+o/50*m)});for(n.push({x:p/2+h*Math.cos(i+m),y:q/2+h*Math.sin(i+m)}),o=50;o>=0;o--)n.push({x:p/2+h*Math.cos(i+o/50*m),y:q/2+h*Math.sin(i+o/50*m)});c(d,{type:"shape",points:n},{label:a[l].label,value:a[l].value},"Doughnut")}b.segmentShowStroke&&(d.lineWidth=b.segmentStrokeWidth,d.strokeStyle=b.segmentStrokeColor,d.stroke()),i+=m}},d)},v=function(a,b,d){var i,j,k,l,m,n,o,r,s,t,u,v,w=0;!function(){i=q,d.font=b.scaleFontStyle+" "+b.scaleFontSize+"px "+b.scaleFontFamily,s=1;for(var c=0;c<a.labels.length;c++){var e=d.measureText(a.labels[c]).width;s=e>s?e:s}p/a.labels.length<s?(w=45,p/a.labels.length<Math.cos(w)*s?(w=90,i-=s):i-=Math.sin(w)*s):i-=b.scaleFontSize,i-=5,l=b.scaleFontSize,m=i-=l}(),n=function(){for(var b=Number.MIN_VALUE,c=Number.MAX_VALUE,d=0;d<a.datasets.length;d++)for(var e=0;e<a.datasets[d].data.length;e++)a.datasets[d].data[e]>b&&(b=a.datasets[d].data[e]),a.datasets[d].data[e]<c&&(c=a.datasets[d].data[e]);return{maxValue:b,minValue:c,maxSteps:Math.floor(m/(.66*l)),minSteps:Math.floor(.5*(m/l))}}(),o=b.scaleShowLabels?b.scaleLabel:"",b.scaleOverride?(k={steps:b.scaleSteps,stepValue:b.scaleStepWidth,graphMin:b.scaleStartValue,labels:[]},h(o,k.labels,k.steps,b.scaleStartValue,b.scaleStepWidth)):k=g(m,n.maxSteps,n.minSteps,n.maxValue,n.minValue,o),j=Math.floor(m/k.steps),function(){var c=1;if(b.scaleShowLabels){d.font=b.scaleFontStyle+" "+b.scaleFontSize+"px "+b.scaleFontFamily;for(var e=0;e<k.labels.length;e++)var f=d.measureText(k.labels[e]).width,c=f>c?f:c;c+=10}t=p-c-s,r=Math.floor(t/(a.labels.length-1)),u=p-s/2-t,v=m+b.scaleFontSize/2}(),f(b,function(){d.lineWidth=b.scaleLineWidth,d.strokeStyle=b.scaleLineColor,d.beginPath(),d.moveTo(p-s/2+5,v),d.lineTo(p-s/2-t-5,v),d.stroke(),w>0?(d.save(),d.textAlign="right"):d.textAlign="center",d.fillStyle=b.scaleFontColor;for(var c=0;c<a.labels.length;c++)d.save(),w>0?(d.translate(u+c*r,v+b.scaleFontSize),d.rotate(-(w*(Math.PI/180))),d.fillText(a.labels[c],0,0),d.restore()):d.fillText(a.labels[c],u+c*r,v+b.scaleFontSize+3),d.beginPath(),d.moveTo(u+c*r,v+3),b.scaleShowGridLines&&c>0?(d.lineWidth=b.scaleGridLineWidth,d.strokeStyle=b.scaleGridLineColor,d.lineTo(u+c*r,5)):d.lineTo(u+c*r,v+3),d.stroke();for(d.lineWidth=b.scaleLineWidth,d.strokeStyle=b.scaleLineColor,d.beginPath(),d.moveTo(u,v+5),d.lineTo(u,5),d.stroke(),d.textAlign="right",d.textBaseline="middle",c=0;c<k.steps;c++)d.beginPath(),d.moveTo(u-3,v-(c+1)*j),b.scaleShowGridLines?(d.lineWidth=b.scaleGridLineWidth,d.strokeStyle=b.scaleGridLineColor,d.lineTo(u+t+5,v-(c+1)*j)):d.lineTo(u-.5,v-(c+1)*j),
d.stroke(),b.scaleShowLabels&&d.fillText(k.labels[c],u-8,v-(c+1)*j)},function(f){function g(b,c){return v-f*e(a.datasets[b].data[c],k,j)}for(var h=0;h<a.datasets.length;h++){d.strokeStyle=a.datasets[h].strokeColor,d.lineWidth=b.datasetStrokeWidth,d.beginPath(),d.moveTo(u,v-f*e(a.datasets[h].data[0],k,j));for(var i=1;i<a.datasets[h].data.length;i++)b.bezierCurve?d.bezierCurveTo(u+r*(i-.5),g(h,i-1),u+r*(i-.5),g(h,i),u+r*i,g(h,i)):d.lineTo(u+r*i,g(h,i));for(var l=b.pointDot?b.pointDotRadius+b.pointDotStrokeWidth:10,i=0;i<a.datasets[h].data.length;i++)f>=1&&b.showTooltips&&c(d,{type:"circle",x:u+r*i,y:g(h,i),r:l},{label:a.labels[i],value:a.datasets[h].data[i]},"Line");if(d.stroke(),b.datasetFill?(d.lineTo(u+r*(a.datasets[h].data.length-1),v),d.lineTo(u,v),d.closePath(),d.fillStyle=a.datasets[h].fillColor,d.fill()):d.closePath(),b.pointDot)for(d.fillStyle=a.datasets[h].pointColor,d.strokeStyle=a.datasets[h].pointStrokeColor,d.lineWidth=b.pointDotStrokeWidth,i=0;i<a.datasets[h].data.length;i++)d.beginPath(),d.arc(u+r*i,v-f*e(a.datasets[h].data[i],k,j),b.pointDotRadius,0,2*Math.PI,!0),d.fill(),d.stroke()}},d)},w=function(a,b,d){var i,j,k,l,m,n,o,r,s,t,u,v,w,x=0;!function(){i=q,d.font=b.scaleFontStyle+" "+b.scaleFontSize+"px "+b.scaleFontFamily,s=1;for(var c=0;c<a.labels.length;c++){var e=d.measureText(a.labels[c]).width;s=e>s?e:s}p/a.labels.length<s?(x=45,p/a.labels.length<Math.cos(x)*s?(x=90,i-=s):i-=Math.sin(x)*s):i-=b.scaleFontSize,i-=5,l=b.scaleFontSize,m=i-=l}(),n=function(){for(var b=Number.MIN_VALUE,c=Number.MAX_VALUE,d=0;d<a.datasets.length;d++)for(var e=0;e<a.datasets[d].data.length;e++)a.datasets[d].data[e]>b&&(b=a.datasets[d].data[e]),a.datasets[d].data[e]<c&&(c=a.datasets[d].data[e]);return{maxValue:b,minValue:c,maxSteps:Math.floor(m/(.66*l)),minSteps:Math.floor(.5*(m/l))}}(),o=b.scaleShowLabels?b.scaleLabel:"",b.scaleOverride?(k={steps:b.scaleSteps,stepValue:b.scaleStepWidth,graphMin:b.scaleStartValue,labels:[]},h(o,k.labels,k.steps,b.scaleStartValue,b.scaleStepWidth)):k=g(m,n.maxSteps,n.minSteps,n.maxValue,n.minValue,o),j=Math.floor(m/k.steps),function(){var c=1;if(b.scaleShowLabels){d.font=b.scaleFontStyle+" "+b.scaleFontSize+"px "+b.scaleFontFamily;for(var e=0;e<k.labels.length;e++)var f=d.measureText(k.labels[e]).width,c=f>c?f:c;c+=10}t=p-c-s,r=Math.floor(t/a.labels.length),w=(r-2*b.scaleGridLineWidth-2*b.barValueSpacing-(b.barDatasetSpacing*a.datasets.length-1)-(b.barStrokeWidth/2*a.datasets.length-1))/a.datasets.length,u=p-s/2-t,v=m+b.scaleFontSize/2}(),f(b,function(){d.lineWidth=b.scaleLineWidth,d.strokeStyle=b.scaleLineColor,d.beginPath(),d.moveTo(p-s/2+5,v),d.lineTo(p-s/2-t-5,v),d.stroke(),x>0?(d.save(),d.textAlign="right"):d.textAlign="center",d.fillStyle=b.scaleFontColor;for(var c=0;c<a.labels.length;c++)d.save(),x>0?(d.translate(u+c*r,v+b.scaleFontSize),d.rotate(-(x*(Math.PI/180))),d.fillText(a.labels[c],0,0),d.restore()):d.fillText(a.labels[c],u+c*r+r/2,v+b.scaleFontSize+3),d.beginPath(),d.moveTo(u+(c+1)*r,v+3),d.lineWidth=b.scaleGridLineWidth,d.strokeStyle=b.scaleGridLineColor,d.lineTo(u+(c+1)*r,5),d.stroke();for(d.lineWidth=b.scaleLineWidth,d.strokeStyle=b.scaleLineColor,d.beginPath(),d.moveTo(u,v+5),d.lineTo(u,5),d.stroke(),d.textAlign="right",d.textBaseline="middle",c=0;c<k.steps;c++)d.beginPath(),d.moveTo(u-3,v-(c+1)*j),b.scaleShowGridLines?(d.lineWidth=b.scaleGridLineWidth,d.strokeStyle=b.scaleGridLineColor,d.lineTo(u+t+5,v-(c+1)*j)):d.lineTo(u-.5,v-(c+1)*j),d.stroke(),b.scaleShowLabels&&d.fillText(k.labels[c],u-8,v-(c+1)*j)},function(f){d.lineWidth=b.barStrokeWidth;for(var g=0;g<a.datasets.length;g++){d.fillStyle=a.datasets[g].fillColor,d.strokeStyle=a.datasets[g].strokeColor;for(var h=0;h<a.datasets[g].data.length;h++){var i=u+b.barValueSpacing+r*h+w*g+b.barDatasetSpacing*g+b.barStrokeWidth*g;if(d.beginPath(),d.moveTo(i,v),d.lineTo(i,v-f*e(a.datasets[g].data[h],k,j)+b.barStrokeWidth/2),d.lineTo(i+w,v-f*e(a.datasets[g].data[h],k,j)+b.barStrokeWidth/2),d.lineTo(i+w,v),b.barShowStroke&&d.stroke(),d.closePath(),d.fill(),f>=1&&b.showTooltips){var l=e(a.datasets[g].data[h],k,j);c(d,{type:"rect",x:i,y:v-l,width:w,height:l},{label:a.labels[h],value:a.datasets[g].data[h]},"Bar")}}}},d)},x=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),y={}},function(a,b){"use strict";var c;if("object"==typeof exports){try{c=require("moment")}catch(d){}module.exports=b(c)}else"function"==typeof define&&define.amd?define(function(a){var d="moment";return c=a.defined&&a.defined(d)?a(d):void 0,b(c)}):a.Pikaday=b(a.moment)}(this,function(a){"use strict";var b="function"==typeof a,c=!!window.addEventListener,d=window.document,e=window.setTimeout,f=function(a,b,d,e){c?a.addEventListener(b,d,!!e):a.attachEvent("on"+b,d)},g=function(a,b,d,e){c?a.removeEventListener(b,d,!!e):a.detachEvent("on"+b,d)},h=function(a,b,c){var e;d.createEvent?(e=d.createEvent("HTMLEvents"),e.initEvent(b,!0,!1),e=s(e,c),a.dispatchEvent(e)):d.createEventObject&&(e=d.createEventObject(),e=s(e,c),a.fireEvent("on"+b,e))},i=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},j=function(a,b){return-1!==(" "+a.className+" ").indexOf(" "+b+" ")},k=function(a,b){j(a,b)||(a.className=""===a.className?b:a.className+" "+b)},l=function(a,b){a.className=i((" "+a.className+" ").replace(" "+b+" "," "))},m=function(a){return/Array/.test(Object.prototype.toString.call(a))},n=function(a){return/Date/.test(Object.prototype.toString.call(a))&&!isNaN(a.getTime())},o=function(a){return a%4===0&&a%100!==0||a%400===0},p=function(a,b){return[31,o(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},q=function(a){n(a)&&a.setHours(0,0,0,0)},r=function(a,b){return a.getTime()===b.getTime()},s=function(a,b,c){var d,e;for(d in b)e=void 0!==a[d],e&&"object"==typeof b[d]&&void 0===b[d].nodeName?n(b[d])?c&&(a[d]=new Date(b[d].getTime())):m(b[d])?c&&(a[d]=b[d].slice(0)):a[d]=s({},b[d],c):(c||!e)&&(a[d]=b[d]);return a},t=function(a){return a.month<0&&(a.year-=Math.ceil(Math.abs(a.month)/12),a.month+=12),a.month>11&&(a.year+=Math.floor(Math.abs(a.month)/12),a.month-=12),a},u={field:null,bound:void 0,position:"bottom left",format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!1,firstDay:0,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,numberOfMonths:1,mainCalendar:"left",container:void 0,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},onSelect:null,onOpen:null,onClose:null,onDraw:null},v=function(a,b,c){for(b+=a.firstDay;b>=7;)b-=7;return c?a.i18n.weekdaysShort[b]:a.i18n.weekdays[b]},w=function(a,b,c,d,e,f,g){if(g)return'<td class="is-empty"></td>';var h=[];return f&&h.push("is-disabled"),e&&h.push("is-today"),d&&h.push("is-selected"),'<td data-day="'+a+'" class="'+h.join(" ")+'"><button class="pika-button pika-day" type="button" data-pika-year="'+c+'" data-pika-month="'+b+'" data-pika-day="'+a+'">'+a+"</button></td>"},x=function(a,b,c){var d=new Date(c,0,1),e=Math.ceil(((new Date(c,b,a)-d)/864e5+d.getDay()+1)/7);return'<td class="pika-week">'+e+"</td>"},y=function(a,b){return"<tr>"+(b?a.reverse():a).join("")+"</tr>"},z=function(a){return"<tbody>"+a.join("")+"</tbody>"},A=function(a){var b,c=[];for(a.showWeekNumber&&c.push("<th></th>"),b=0;7>b;b++)c.push('<th scope="col"><abbr title="'+v(a,b)+'">'+v(a,b,!0)+"</abbr></th>");return"<thead>"+(a.isRTL?c.reverse():c).join("")+"</thead>"},B=function(a,b,c,d,e){var f,g,h,i,j,k=a._o,l=c===k.minYear,n=c===k.maxYear,o='<div class="pika-title">',p=!0,q=!0;for(h=[],f=0;12>f;f++)h.push('<option value="'+(c===e?f-b:12+f-b)+'"'+(f===d?" selected":"")+(l&&f<k.minMonth||n&&f>k.maxMonth?"disabled":"")+">"+k.i18n.months[f]+"</option>");for(i='<div class="pika-label">'+k.i18n.months[d]+'<select class="pika-select pika-select-month">'+h.join("")+"</select></div>",m(k.yearRange)?(f=k.yearRange[0],g=k.yearRange[1]+1):(f=c-k.yearRange,g=1+c+k.yearRange),h=[];g>f&&f<=k.maxYear;f++)f>=k.minYear&&h.push('<option value="'+f+'"'+(f===c?" selected":"")+">"+f+"</option>");return j='<div class="pika-label">'+c+k.yearSuffix+'<select class="pika-select pika-select-year">'+h.join("")+"</select></div>",o+=k.showMonthAfterYear?j+i:i+j,l&&(0===d||k.minMonth>=d)&&(p=!1),n&&(11===d||k.maxMonth<=d)&&(q=!1),0===b&&(o+='<a class="icon-back-arrow pika-prev'+(p?"":" is-disabled")+'" type="button"></a>'),b===a._o.numberOfMonths-1&&(o+='<a class="icon-forward-arrow pika-next'+(q?"":" is-disabled")+'" type="button"></a>'),o+="</div>"},C=function(a,b){return'<table cellpadding="0" cellspacing="0" class="pika-table">'+A(a)+z(b)+"</table>"},D=function(g){var h=this,i=h.config(g);h._onMouseDown=function(a){if(h._v){a=a||window.event;var b=a.target||a.srcElement;if(b){if(!j(b,"is-disabled")){if(j(b,"pika-button")&&!j(b,"is-empty"))return h.setDate(new Date(b.getAttribute("data-pika-year"),b.getAttribute("data-pika-month"),b.getAttribute("data-pika-day"))),void(i.bound&&e(function(){h.hide(),i.field&&i.field.blur()},100));j(b,"pika-prev")?h.prevMonth():j(b,"pika-next")&&h.nextMonth()}if(j(b,"pika-select"))h._c=!0;else{if(!a.preventDefault)return a.returnValue=!1,!1;a.preventDefault()}}}},h._onChange=function(a){a=a||window.event;var b=a.target||a.srcElement;b&&(j(b,"pika-select-month")?h.gotoMonth(b.value):j(b,"pika-select-year")&&h.gotoYear(b.value))},h._onInputChange=function(c){var d;c.firedBy!==h&&(b?(d=a(i.field.value,i.format),d=d&&d.isValid()?d.toDate():null):d=new Date(Date.parse(i.field.value)),h.setDate(n(d)?d:null),h._v||h.show())},h._onInputFocus=function(){h.show()},h._onInputClick=function(){h.show()},h._onInputBlur=function(){h._c||(h._b=e(function(){h.hide()},50)),h._c=!1},h._onClick=function(a){a=a||window.event;var b=a.target||a.srcElement,d=b;if(b){!c&&j(b,"pika-select")&&(b.onchange||(b.setAttribute("onchange","return;"),f(b,"change",h._onChange)));do if(j(d,"pika-single"))return;while(d=d.parentNode);h._v&&b!==i.trigger&&h.hide()}},h.el=d.createElement("div"),h.el.className="pika-single"+(i.isRTL?" is-rtl":""),f(h.el,"mousedown",h._onMouseDown,!0),f(h.el,"change",h._onChange),i.field&&(i.container?i.container.appendChild(h.el):i.bound?d.body.appendChild(h.el):i.field.parentNode.insertBefore(h.el,i.field.nextSibling),f(i.field,"change",h._onInputChange),i.defaultDate||(b&&i.field.value?i.defaultDate=a(i.field.value,i.format).toDate():i.defaultDate=new Date(Date.parse(i.field.value)),i.setDefaultDate=!0));var k=i.defaultDate;n(k)?i.setDefaultDate?h.setDate(k,!0):h.gotoDate(k):h.gotoDate(new Date),i.bound?(this.hide(),h.el.className+=" is-bound",f(i.trigger,"click",h._onInputClick),f(i.trigger,"focus",h._onInputFocus),f(i.trigger,"blur",h._onInputBlur)):this.show()};return D.prototype={config:function(a){this._o||(this._o=s({},u,!0));var b=s(this._o,a,!0);b.isRTL=!!b.isRTL,b.field=b.field&&b.field.nodeName?b.field:null,b.bound=!!(void 0!==b.bound?b.field&&b.bound:b.field),b.trigger=b.trigger&&b.trigger.nodeName?b.trigger:b.field;var c=parseInt(b.numberOfMonths,10)||1;if(b.numberOfMonths=c>4?4:c,n(b.minDate)||(b.minDate=!1),n(b.maxDate)||(b.maxDate=!1),b.minDate&&b.maxDate&&b.maxDate<b.minDate&&(b.maxDate=b.minDate=!1),b.minDate&&(q(b.minDate),b.minYear=b.minDate.getFullYear(),b.minMonth=b.minDate.getMonth()),b.maxDate&&(q(b.maxDate),b.maxYear=b.maxDate.getFullYear(),b.maxMonth=b.maxDate.getMonth()),m(b.yearRange)){var d=(new Date).getFullYear()-10;b.yearRange[0]=parseInt(b.yearRange[0],10)||d,b.yearRange[1]=parseInt(b.yearRange[1],10)||d}else b.yearRange=Math.abs(parseInt(b.yearRange,10))||u.yearRange,b.yearRange>100&&(b.yearRange=100);return b},toString:function(c){return n(this._d)?b?a(this._d).format(c||this._o.format):this._d.toDateString():""},getMoment:function(){return b?a(this._d):null},setMoment:function(c,d){b&&a.isMoment(c)&&this.setDate(c.toDate(),d)},getDate:function(){return n(this._d)?new Date(this._d.getTime()):null},setDate:function(a,b){if(!a)return this._d=null,this.draw();if("string"==typeof a&&(a=new Date(Date.parse(a))),n(a)){var c=this._o.minDate,d=this._o.maxDate;n(c)&&c>a?a=c:n(d)&&a>d&&(a=d),this._d=new Date(a.getTime()),q(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),h(this._o.field,"change",{firedBy:this})),b||"function"!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(a){var b=!0;if(n(a)){if(this.calendars){var c=new Date(this.calendars[0].year,this.calendars[0].month,1),d=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),e=a.getTime();d.setMonth(d.getMonth()+1),d.setDate(d.getDate()-1),b=e<c.getTime()||d.getTime()<e}b&&(this.calendars=[{month:a.getMonth(),year:a.getFullYear()}],"right"===this._o.mainCalendar&&(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars()}},adjustCalendars:function(){this.calendars[0]=t(this.calendars[0]);for(var a=1;a<this._o.numberOfMonths;a++)this.calendars[a]=t({month:this.calendars[0].month+a,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(a){isNaN(a)||(this.calendars[0].month=parseInt(a,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(a){isNaN(a)||(this.calendars[0].year=parseInt(a,10),this.adjustCalendars())},setMinDate:function(a){this._o.minDate=a},setMaxDate:function(a){this._o.maxDate=a},draw:function(a){if(this._v||a){var b=this._o,c=b.minYear,d=b.maxYear,f=b.minMonth,g=b.maxMonth,h="";this._y<=c&&(this._y=c,!isNaN(f)&&this._m<f&&(this._m=f)),this._y>=d&&(this._y=d,!isNaN(g)&&this._m>g&&(this._m=g));for(var i=0;i<b.numberOfMonths;i++)h+='<div class="pika-lendar">'+B(this,i,this.calendars[i].year,this.calendars[i].month,this.calendars[0].year)+this.render(this.calendars[i].year,this.calendars[i].month)+"</div>";if(this.el.innerHTML=h,b.bound&&"hidden"!==b.field.type&&e(function(){b.trigger.focus()},1),"function"==typeof this._o.onDraw){var j=this;e(function(){j._o.onDraw.call(j)},0)}}},adjustPosition:function(){if(!this._o.container){var a,b,c,e=this._o.trigger,f=e,g=this.el.offsetWidth,h=this.el.offsetHeight,i=window.innerWidth||d.documentElement.clientWidth,j=window.innerHeight||d.documentElement.clientHeight,k=window.pageYOffset||d.body.scrollTop||d.documentElement.scrollTop;if("function"==typeof e.getBoundingClientRect)c=e.getBoundingClientRect(),a=c.left+window.pageXOffset,b=c.bottom+window.pageYOffset;else for(a=f.offsetLeft,b=f.offsetTop+f.offsetHeight;f=f.offsetParent;)a+=f.offsetLeft,b+=f.offsetTop;(a+g>i||this._o.position.indexOf("right")>-1&&a-g+e.offsetWidth>0)&&(a=a-g+e.offsetWidth),(b+h>j+k||this._o.position.indexOf("top")>-1&&b-h-e.offsetHeight>0)&&(b=b-h-e.offsetHeight),this.el.style.cssText=["position: absolute","left: "+a+"px","top: "+b+"px"].join(";")}},render:function(a,b){var c=this._o,d=new Date,e=p(a,b),f=new Date(a,b,1).getDay(),g=[],h=[];q(d),c.firstDay>0&&(f-=c.firstDay,0>f&&(f+=7));for(var i=e+f,j=i;j>7;)j-=7;i+=7-j;for(var k=0,l=0;i>k;k++){var m=new Date(a,b,1+(k-f)),o=c.minDate&&m<c.minDate||c.maxDate&&m>c.maxDate,s=n(this._d)?r(m,this._d):!1,t=r(m,d),u=f>k||k>=e+f;h.push(w(1+(k-f),b,a,s,t,o,u)),7===++l&&(c.showWeekNumber&&h.unshift(x(k-f,b,a)),g.push(y(h,c.isRTL)),h=[],l=0)}return C(c,g)},isVisible:function(){return this._v},show:function(){this._v||(l(this.el,"is-hidden"),this._v=!0,this.draw(),this._o.bound&&(f(d,"click",this._onClick),this.adjustPosition()),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var a=this._v;a!==!1&&(this._o.bound&&g(d,"click",this._onClick),this.el.style.cssText="",k(this.el,"is-hidden"),this._v=!1,void 0!==a&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){this.hide(),g(this.el,"mousedown",this._onMouseDown,!0),g(this.el,"change",this._onChange),this._o.field&&(g(this._o.field,"change",this._onInputChange),this._o.bound&&(g(this._o.trigger,"click",this._onInputClick),g(this._o.trigger,"focus",this._onInputFocus),g(this._o.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},D}),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}}),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},C=[].slice,D={}.hasOwnProperty,E=function(a,b){return function(){return a.apply(b,arguments)}},F=function(a,b){function c(){this.constructor=a}for(var d in b)D.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};y=["extended","included"],p=function(){function a(){}return a["extends"]=function(a){var b,c,d;for(b in a)c=a[b],B.call(y,b)<0&&(this[b]=c);return null!=(d=a.extended)&&d.apply(this),this},a.includes=function(a){var b,c,d;for(b in a)c=a[b],B.call(y,b)<0&&(this.prototype[b]=c);return null!=(d=a.included)&&d.apply(this),this},a.delegate=function(){var a,b,c,d,e,f;for(a=1<=arguments.length?C.call(arguments,0):[],c=a.pop(),f=[],d=0,e=a.length;e>d;d++)b=a[d],f.push(this.prototype[b]=c.prototype[b]);return f},a.aliasFunction=function(a,b){var c=this;return this.prototype[a]=function(){var a;return a=1<=arguments.length?C.call(arguments,0):[],c.prototype[b].apply(c,a)}},a.aliasProperty=function(a,b){return Object.defineProperty(this.prototype,a,{get:function(){return this[b]},set:function(a){return this[b]=a}})},a.included=function(a){return a.call(this,this.prototype)},a}(),z=Array.prototype.slice,a=function(a,b){return null==b&&(b=document),"object"==typeof a||"undefined"!=typeof exports&&null!==exports?a:b.querySelector(a)},v=function(){function a(){}return a.uniqid=function(){var a;return a=0,{get:function(){return a++}}}(),a.extend=function(){var a,b,c,d,e,f,g;for(c=arguments[0],e=2<=arguments.length?C.call(arguments,1):[],b=c,f=0,g=e.length;g>f;f++){a=e[f];for(d in a)D.call(a,d)&&(b[d]=a[d])}return b},a.clampRGB=function(a){return 0>a?0:a>255?255:a},a.copyAttributes=function(a,b,c){var d,e,f,g,h,i;for(null==c&&(c={}),g=a.attributes,i=[],e=0,f=g.length;f>e;e++)d=g[e],null!=c.except&&(h=d.nodeName,B.call(c.except,h)>=0)||i.push(b.setAttribute(d.nodeName,d.nodeValue));return i},a.dataArray=function(a){return null==a&&(a=0),e.NodeJS||null!=window.Uint8Array?new Uint8Array(a):new Array(a)},a}(),"undefined"!=typeof exports&&null!==exports?(t=exports,g=require("canvas"),m=g.Image,j=require("fibers"),w=require("fs"),x=require("http")):t=window,e=function(c){function d(){this.nodeFileReady=E(this.nodeFileReady,this);var a,c,e,f=this;if(0===arguments.length)throw"Invalid arguments";return this instanceof d?(this.finishInit=this.finishInit.bind(this),this.imageLoaded=this.imageLoaded.bind(this),a=arguments[0],d.NodeJS||(e=parseInt(d.getAttrId(a[0]),10),c="function"==typeof a[1]?a[1]:"function"==typeof a[2]?a[2]:function(){},isNaN(e)||!u.has(e))?(this.id=v.uniqid.get(),this.initializedPixelData=this.originalPixelData=null,this.cropCoordinates={x:0,y:0},this.cropped=!1,this.resized=!1,this.pixelStack=[],this.layerStack=[],this.canvasQueue=[],this.currentLayer=null,this.scaled=!1,this.analyze=new b(this),this.renderer=new s(this),this.domIsLoaded(function(){return f.parseArguments(a),f.setup()}),this):u.execute(e,c)):new d(arguments)}return F(d,c),d.version={release:"4.1.2",date:"7/27/2013"},d.DEBUG=!1,d.allowRevert=!0,d.crossOrigin="anonymous",d.remoteProxy="",d.proxyParam="camanProxyUrl",d.NodeJS="undefined"!=typeof exports&&null!==exports,d.autoload=!d.NodeJS,d.toString=function(){return"Version "+d.version.release+", Released "+d.version.date},d.getAttrId=function(b){return d.NodeJS?!0:("string"==typeof b&&(b=a(b)),null==b||null==b.getAttribute?null:b.getAttribute("data-caman-id"))},d.prototype.domIsLoaded=function(a){var b,c=this;return d.NodeJS?setTimeout(function(){return a.call(c)},0):"complete"===document.readyState?(o.debug("DOM initialized"),setTimeout(function(){return a.call(c)},0)):(b=function(){return"complete"===document.readyState?(o.debug("DOM initialized"),a.call(c)):void 0},document.addEventListener("readystatechange",b,!1))},d.prototype.parseArguments=function(a){var b,c,d,e;if(0===a.length)throw"Invalid arguments given";if(this.initObj=null,this.initType=null,this.imageUrl=null,this.callback=function(){},this.setInitObject(a[0]),1!==a.length){switch(typeof a[1]){case"string":this.imageUrl=a[1];break;case"function":this.callback=a[1]}if(2!==a.length&&(this.callback=a[2],4===a.length)){d=a[4],e=[];for(b in d)D.call(d,b)&&(c=d[b],e.push(this.options[b]=c));return e}}},d.prototype.setInitObject=function(b){if(d.NodeJS)return this.initObj=b,void(this.initType="node");if("object"==typeof b?this.initObj=b:this.initObj=a(b),null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()},d.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}},d.prototype.initNode=function(){return o.debug("Initializing for NodeJS"),"string"==typeof this.initObj&&this.initObj.match(/^https?:\/\//)?this.readFromHttp(this.initObj,this.nodeFileReady):"string"==typeof this.initObj?w.readFile(this.initObj,this.nodeFileReady):this.nodeFileReady(null,this.initObj)},d.prototype.readFromHttp=function(a,b){var c;return o.debug("Fetching image from "+a),c=x.get(a,function(a){var c;return c="",a.setEncoding("binary"),a.on("data",function(a){return c+=a}),a.on("end",function(){return b(null,new Buffer(c,"binary"))})}),c.on("error",b)},d.prototype.nodeFileReady=function(a,b){if(a)throw a;return this.image=new m,this.image.src=b,o.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.canvas=new g(this.imageWidth(),this.imageHeight()),this.finishInit()},d.prototype.initImage=function(){return this.image=this.initObj,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),v.copyAttributes(this.image,this.canvas,{except:["src"]}),null!=this.image.parentNode&&this.image.parentNode.replaceChild(this.canvas,this.image),this.imageAdjustments(),this.waitForImageLoaded()},d.prototype.initCanvas=function(){return this.canvas=this.initObj,this.context=this.canvas.getContext("2d"),null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()},d.prototype.imageAdjustments=function(){return this.needsHiDPISwap()&&(o.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement()),l.isRemote(this.image)?(this.image.src=l.proxyUrl(this.image.src),o.debug("Remote image detected, using URL = "+this.image.src)):void 0},d.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded},d.prototype.isImageLoaded=function(){return this.image.complete?null!=this.image.naturalWidth&&0===this.image.naturalWidth?!1:!0:!1},d.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth},d.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight},d.prototype.imageLoaded=function(){return o.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight()),this.finishInit()},d.prototype.finishInit=function(){var a,b,c,e,f;if(null==this.context&&(this.context=this.canvas.getContext("2d")),this.originalWidth=this.preScaledWidth=this.width=this.canvas.width,this.originalHeight=this.preScaledHeight=this.height=this.canvas.height,this.hiDPIAdjustments(),this.hasId()||this.assignId(),null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data,d.allowRevert)for(this.initializedPixelData=v.dataArray(this.pixelData.length),this.originalPixelData=v.dataArray(this.pixelData.length),f=this.pixelData,a=c=0,e=f.length;e>c;a=++c)b=f[a],this.initializedPixelData[a]=b,this.originalPixelData[a]=b;return this.dimensions={width:this.canvas.width,height:this.canvas.height},d.NodeJS||u.put(this.id,this),this.callback.call(this,this),this.callback=function(){}},d.prototype.reloadCanvasData=function(){return this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data},d.prototype.resetOriginalPixelData=function(){var a,b,c,e,f,g;if(!d.allowRevert)throw"Revert disabled";for(this.originalPixelData=v.dataArray(this.pixelData.length),f=this.pixelData,g=[],a=c=0,e=f.length;e>c;a=++c)b=f[a],g.push(this.originalPixelData[a]=b);return g},d.prototype.hasId=function(){return null!=d.getAttrId(this.canvas)},d.prototype.assignId=function(){return d.NodeJS||this.canvas.getAttribute("data-caman-id")?void 0:this.canvas.setAttribute("data-caman-id",this.id)},d.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")},d.prototype.hiDPIAdjustments=function(){var a;if(!d.NodeJS&&this.needsHiDPISwap())return a=this.hiDPIRatio(),1!==a?(o.debug("HiDPI ratio = "+a),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*a,this.canvas.height=this.preScaledHeight*a,this.canvas.style.width=""+this.preScaledWidth+"px",this.canvas.style.height=""+this.preScaledHeight+"px",this.context.scale(a,a),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=this.canvas.height):void 0},d.prototype.hiDPIRatio=function(){var a,b;return b=window.devicePixelRatio||1,a=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,b/a},d.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio},d.prototype.needsHiDPISwap=function(){return this.hiDPIDisabled()||!this.hiDPICapable()?!1:null!==this.hiDPIReplacement()},d.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")},d.prototype.replaceCanvas=function(a){var b;return b=this.canvas,this.canvas=a,this.context=this.canvas.getContext("2d"),d.NodeJS||b.parentNode.replaceChild(this.canvas,b),this.width=this.canvas.width,this.height=this.canvas.height,this.reloadCanvasData(),this.dimensions={width:this.canvas.width,height:this.canvas.height}},d.prototype.render=function(a){var b=this;return null==a&&(a=function(){}),i.trigger(this,"renderStart"),this.renderer.execute(function(){return b.context.putImageData(b.imageData,0,0),a.call(b)})},d.prototype.revert=function(a){var b,c,e,f,g;if(null==a&&(a=!0),!d.allowRevert)throw"Revert disabled";for(g=this.originalVisiblePixels(),b=e=0,f=g.length;f>e;b=++e)c=g[b],this.pixelData[b]=c;return a?this.context.putImageData(this.imageData,0,0):void 0},d.prototype.reset=function(){var a,b,c,d,e,f,g,h,i;for(a=document.createElement("canvas"),v.copyAttributes(this.canvas,a),a.width=this.originalWidth,a.height=this.originalHeight,b=a.getContext("2d"),d=b.getImageData(0,0,a.width,a.height),f=d.data,i=this.initializedPixelData,c=g=0,h=i.length;h>g;c=++g)e=i[c],f[c]=e;return b.putImageData(d,0,0),this.cropCoordinates={x:0,y:0},this.resized=!1,this.replaceCanvas(a)},d.prototype.originalVisiblePixels=function(){var a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,r,s,t,u,v,w;if(!d.allowRevert)throw"Revert disabled";if(k=[],m=this.cropCoordinates.x,e=m+this.width,n=this.cropCoordinates.y,f=n+this.height,this.resized){for(a=document.createElement("canvas"),a.width=this.originalWidth,a.height=this.originalHeight,c=a.getContext("2d"),h=c.getImageData(0,0,a.width,a.height),j=h.data,t=this.originalPixelData,g=p=0,s=t.length;s>p;g=++p)i=t[g],j[g]=i;c.putImageData(h,0,0),l=document.createElement("canvas"),l.width=this.width,l.height=this.height,c=l.getContext("2d"),c.drawImage(a,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height),j=c.getImageData(0,0,this.width,this.height).data,o=this.width}else j=this.originalPixelData,o=this.originalWidth;for(g=r=0,u=j.length;u>r;g=r+=4)b=q.locationToCoordinates(g,o),m<=(v=b.x)&&e>v&&n<=(w=b.y)&&f>w&&k.push(j[g],j[g+1],j[g+2],j[g+3]);return k},d.prototype.process=function(a,b){return this.renderer.add({type:k.Type.Single,name:a,processFn:b}),this},d.prototype.processKernel=function(a,b,c,d){var e,f,g;if(null==c&&(c=null),null==d&&(d=0),null==c)for(c=0,e=f=0,g=b.length;g>=0?g>f:f>g;e=g>=0?++f:--f)c+=b[e];return this.renderer.add({type:k.Type.Kernel,name:a,adjust:b,divisor:c,bias:d}),this},d.prototype.processPlugin=function(a,b){return this.renderer.add({type:k.Type.Plugin,plugin:a,args:b}),this},d.prototype.newLayer=function(a){var b;return b=new n(this),this.canvasQueue.push(b),this.renderer.add({type:k.Type.LayerDequeue}),a.call(b),this.renderer.add({type:k.Type.LayerFinished}),this},d.prototype.executeLayer=function(a){return this.pushContext(a)},d.prototype.pushContext=function(a){return this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=a,this.pixelData=a.pixelData},d.prototype.popContext=function(){return this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()},d.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()},d}(p),t.Caman=e,e.Analyze=function(){function a(a){this.c=a}return a.prototype.calculateLevels=function(){var a,b,c,d,e,f,g;for(b={r:{},g:{},b:{}},a=d=0;255>=d;a=++d)b.r[a]=0,b.g[a]=0,b.b[a]=0;for(a=e=0,g=this.c.pixelData.length;g>e;a=e+=4)b.r[this.c.pixelData[a]]++,b.g[this.c.pixelData[a+1]]++,b.b[this.c.pixelData[a+2]]++;for(c=this.c.pixelData.length/4,a=f=0;255>=f;a=++f)b.r[a]/=c,b.g[a]/=c,b.b[a]/=c;return b},a}(),b=e.Analyze,e.DOMUpdated=function(){var a,b,c,d,e,g;if(b=document.querySelectorAll("img[data-caman]"),b.length>0){for(g=[],d=0,e=b.length;e>d;d++)a=b[d],g.push(c=new f(a,function(){return this.parse(),this.execute()}));return g}},e.autoload&&!function(){return"complete"===document.readyState?e.DOMUpdated():document.addEventListener("DOMContentLoaded",e.DOMUpdated,!1);
}(),f=function(){function a(a,b){this.dataStr=a.getAttribute("data-caman"),this.caman=e(a,b.bind(this))}var b;return b="(\\w+)\\((.*?)\\)",a.prototype.parse=function(){var a,c,d,e,f,g,h,i,j,k,l,m,n;if(this.ele=this.caman.canvas,i=new RegExp(b,"g"),j=this.dataStr.match(i),j.length>0){for(i=new RegExp(b),n=[],k=0,l=j.length;l>k;k++){f=j[k],m=f.match(i),h=m[0],d=m[1],a=m[2],g=new Function("return function() {        this."+d+"("+a+");      };");try{e=g(),n.push(e.call(this.caman))}catch(p){c=p,n.push(o.debug(c))}}return n}},a.prototype.execute=function(){var a;return a=this.ele,this.caman.render(function(){return a.parentNode.replaceChild(this.toImage(),a)})},a}(),e.Blender=function(){function a(){}return a.blenders={},a.register=function(a,b){return this.blenders[a]=b},a.execute=function(a,b,c){return this.blenders[a](b,c)},a}(),c=e.Blender,e.Calculate=function(){function a(){}return a.distance=function(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))},a.randomRange=function(a,b,c){var d;return null==c&&(c=!1),d=a+Math.random()*(b-a),c?d.toFixed(c):Math.round(d)},a.luminance=function(a){return.299*a.r+.587*a.g+.114*a.b},a.bezier=function(a,b,c,d,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t;if(null==f&&(f=0),null==g&&(g=255),a[0]instanceof Array?(j=a,f=b,g=c):j=[a,b,c,d],j.length<2)throw"Invalid number of arguments to bezier";for(h={},n=function(a,b,c){return a*(1-c)+b*c},i=function(a,b,c){return Math.min(Math.max(a,b),c)},l=r=0;1e3>r;l=++r){for(q=l/1e3,p=j;p.length>1;){for(o=[],m=s=0,t=p.length-2;t>=0?t>=s:s>=t;m=t>=0?++s:--s)o.push([n(p[m][0],p[m+1][0],q),n(p[m][1],p[m+1][1],q)]);p=o}h[Math.round(p[0][0])]=Math.round(i(p[0][1],f,g))}return k=j[j.length-1][0],h=e.Calculate.missingValues(h,k),null==h[k]&&(h[k]=h[k-1]),h},a.hermite=function(a,b,c){var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;if(a.length<2)throw"Invalid number of arguments to hermite";for(y={},o=function(a,b,c){return a*(1-c)+b*c},d=function(a,b,c,d){return[a[0]+b[0]+c[0]+d[0],a[1]+b[1]+c[1]+d[1]]},r=function(a,b){return[a[0]*b[0],a[1]*b[1]]},z=function(a,b){return[a[0]-b[0],a[1]-b[1]]},f=function(a,b,c){return Math.min(Math.max(a,b),c)},g=0,m=B=0,D=a.length-2;D>=0?D>=B:B>=D;m=D>=0?++B:--B)for(t=a[m],u=a[m+1],v=u[0]-t[0],w=1/v,m===a.length-2&&(w=1/(v-1)),s=m>0?a[m-1]:t,p=r(z(u,s),[.5,.5]),s=m<a.length-2?a[m+2]:u,q=r(z(s,t),[.5,.5]),n=C=0;v>=0?v>=C:C>=v;n=v>=0?++C:--C)A=n*w,i=2*A*A*A-3*A*A+1,j=A*A*A-2*A*A+A,k=-2*A*A*A+3*A*A,l=A*A*A-A*A,x=d(r(t,[i,i]),r(p,[j,j]),r(u,[k,k]),r(q,[l,l])),y[Math.round(x[0])]=Math.round(f(x[1],b,c)),g+=1;return h=a[a.length-1][0],y=e.Calculate.missingValues(y,h)},a.missingValues=function(a,b){var c,d,e,f,g,h,i;if(Object.keys(a).length<b+1){for(f={},c=h=0;b>=0?b>=h:h>=b;c=b>=0?++h:--h)if(null!=a[c])f[c]=a[c];else{for(e=[c-1,f[c-1]],d=i=c;b>=c?b>=i:i>=b;d=b>=c?++i:--i)if(null!=a[d]){g=[d,a[d]];break}f[c]=e[1]+(g[1]-e[1])/(g[0]-e[0])*(c-e[0])}return f}return a},a}(),d=e.Calculate,e.Convert=function(){function a(){}return a.hexToRGB=function(a){var b,c,d;return"#"===a.charAt(0)&&(a=a.substr(1)),d=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),b=parseInt(a.substr(4,2),16),{r:d,g:c,b:b}},a.rgbToHSL=function(a,b,c){var d,e,f,g,h,i;return"object"==typeof a&&(b=a.g,c=a.b,a=a.r),a/=255,b/=255,c/=255,g=Math.max(a,b,c),h=Math.min(a,b,c),f=(g+h)/2,g===h?e=i=0:(d=g-h,i=f>.5?d/(2-g-h):d/(g+h),e=function(){switch(g){case a:return(b-c)/d+(c>b?6:0);case b:return(c-a)/d+2;case c:return(a-b)/d+4}}(),e/=6),{h:e,s:i,l:f}},a.hslToRGB=function(a,b,c){var d,e,f,g,h;return"object"==typeof a&&(b=a.s,c=a.l,a=a.h),0===b?h=e=d=c:(g=.5>c?c*(1+b):c+b-c*b,f=2*c-g,h=this.hueToRGB(f,g,a+1/3),e=this.hueToRGB(f,g,a),d=this.hueToRGB(f,g,a-1/3)),{r:255*h,g:255*e,b:255*d}},a.hueToRGB=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},a.rgbToHSV=function(a,b,c){var d,e,f,g,h,i;return a/=255,b/=255,c/=255,f=Math.max(a,b,c),g=Math.min(a,b,c),i=f,d=f-g,h=0===f?0:d/f,f===g?e=0:(e=function(){switch(f){case a:return(b-c)/d+(c>b?6:0);case b:return(c-a)/d+2;case c:return(a-b)/d+4}}(),e/=6),{h:e,s:h,v:i}},a.hsvToRGB=function(a,b,c){var d,e,f,g,h,i,j,k;switch(g=Math.floor(6*a),e=6*a-g,h=c*(1-b),i=c*(1-e*b),k=c*(1-(1-e)*b),g%6){case 0:j=c,f=k,d=h;break;case 1:j=i,f=c,d=h;break;case 2:j=h,f=c,d=k;break;case 3:j=h,f=i,d=c;break;case 4:j=k,f=h,d=c;break;case 5:j=c,f=h,d=i}return{r:Math.floor(255*j),g:Math.floor(255*f),b:Math.floor(255*d)}},a.rgbToXYZ=function(a,b,c){var d,e,f;return a/=255,b/=255,c/=255,a>.04045?a=Math.pow((a+.055)/1.055,2.4):a/=12.92,b>.04045?b=Math.pow((b+.055)/1.055,2.4):b/=12.92,c>.04045?c=Math.pow((c+.055)/1.055,2.4):c/=12.92,d=.4124*a+.3576*b+.1805*c,e=.2126*a+.7152*b+.0722*c,f=.0193*a+.1192*b+.9505*c,{x:100*d,y:100*e,z:100*f}},a.xyzToRGB=function(a,b,c){var d,e,f;return a/=100,b/=100,c/=100,f=3.2406*a+-1.5372*b+-.4986*c,e=-.9689*a+1.8758*b+.0415*c,d=.0557*a+-.204*b+1.057*c,f>.0031308?f=1.055*Math.pow(f,.4166666667)-.055:f*=12.92,e>.0031308?e=1.055*Math.pow(e,.4166666667)-.055:e*=12.92,d>.0031308?d=1.055*Math.pow(d,.4166666667)-.055:d*=12.92,{r:255*f,g:255*e,b:255*d}},a.xyzToLab=function(a,b,c){var d,e,f,g,h,i;return"object"==typeof a&&(b=a.y,c=a.z,a=a.x),g=95.047,h=100,i=108.883,a/=g,b/=h,c/=i,a=a>.008856451679?Math.pow(a,.3333333333):7.787037037*a+.1379310345,b=b>.008856451679?Math.pow(b,.3333333333):7.787037037*b+.1379310345,c=c>.008856451679?Math.pow(c,.3333333333):7.787037037*c+.1379310345,f=116*b-16,d=500*(a-b),e=200*(b-c),{l:f,a:d,b:e}},a.labToXYZ=function(a,b,c){var d,e,f;return"object"==typeof a&&(b=a.a,c=a.b,a=a.l),e=(a+16)/116,d=e+b/500,f=e-c/200,d=d>.2068965517?d*d*d:.1284185493*(d-.1379310345),e=e>.2068965517?e*e*e:.1284185493*(e-.1379310345),f=f>.2068965517?f*f*f:.1284185493*(f-.1379310345),{x:95.047*d,y:100*e,z:108.883*f}},a.rgbToLab=function(a,b,c){var d;return"object"==typeof a&&(b=a.g,c=a.b,a=a.r),d=this.rgbToXYZ(a,b,c),this.xyzToLab(d)},a.labToRGB=function(a,b,c){},a}(),h=e.Convert,e.Event=function(){function a(){}return a.events={},a.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"],a.trigger=function(a,b,c){var d,e,f,g,h;if(null==c&&(c=null),this.events[b]&&this.events[b].length){for(g=this.events[b],h=[],e=0,f=g.length;f>e;e++)d=g[e],null===d.target||a.id===d.target.id?h.push(d.fn.call(a,c)):h.push(void 0);return h}},a.listen=function(a,b,c){var d,e;return"string"==typeof a&&(e=a,d=b,a=null,b=e,c=d),B.call(this.types,b)<0?!1:(this.events[b]||(this.events[b]=[]),this.events[b].push({target:a,fn:c}),!0)},a}(),i=e.Event,e.Filter=function(){function a(){}return a.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6},a.register=function(a,b){return e.prototype[a]=b},a}(),k=e.Filter,e.IO=function(){function a(){}return a.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/,a.isRemote=function(a){return null==a?!1:this.corsEnabled(a)?!1:this.isURLRemote(a.src)},a.corsEnabled=function(a){var b;return null!=a.crossOrigin&&("anonymous"===(b=a.crossOrigin.toLowerCase())||"use-credentials"===b)},a.isURLRemote=function(a){var b;return b=a.match(this.domainRegex),b?b[1]!==document.domain:!1},a.remoteCheck=function(a){if(this.isURLRemote(a)){if(e.remoteProxy.length)return e.isURLRemote(e.remoteProxy)?void o.info("Cannot use a remote proxy for loading images."):this.proxyUrl(a);o.info("Attempting to load a remote image without a configured proxy. URL: "+a)}},a.proxyUrl=function(a){return""+e.remoteProxy+"?"+e.proxyParam+"="+encodeURIComponent(a)},a.useProxy=function(a){var b;return b={ruby:"rb",python:"py",perl:"pl",javascript:"js"},a=a.toLowerCase(),null!=b[a]&&(a=b[a]),"proxies/caman_proxy."+a},a}(),e.prototype.save=function(){return"undefined"!=typeof exports&&null!==exports?this.nodeSave.apply(this,arguments):this.browserSave.apply(this,arguments)},e.prototype.browserSave=function(a){var b;return null==a&&(a="png"),a=a.toLowerCase(),b=this.toBase64(a).replace("image/"+a,"image/octet-stream"),document.location.href=b},e.prototype.nodeSave=function(a,b,c){var d,e;null==b&&(b=!0),null==c&&(c=null);try{if(e=w.statSync(a),e.isFile()&&!b)return!1}catch(f){d=f,o.debug("Creating output file "+a)}return w.writeFile(a,this.canvas.toBuffer(),function(b){return o.debug("Finished writing to "+a),c?c.call(this,b):void 0})},e.prototype.toImage=function(a){var b;return b=new m,b.src=this.toBase64(a),b.width=this.dimensions.width,b.height=this.dimensions.height,window.devicePixelRatio&&(b.width/=window.devicePixelRatio,b.height/=window.devicePixelRatio),b},e.prototype.toBase64=function(a){return null==a&&(a="png"),a=a.toLowerCase(),this.canvas.toDataURL("image/"+a)},l=e.IO,e.Layer=function(){function b(a){this.c=a,this.filter=this.c,this.options={blendingMode:"normal",opacity:1},this.layerID=v.uniqid.get(),this.canvas="undefined"!=typeof exports&&null!==exports?new g:document.createElement("canvas"),this.canvas.width=this.c.dimensions.width,this.canvas.height=this.c.dimensions.height,this.context=this.canvas.getContext("2d"),this.context.createImageData(this.canvas.width,this.canvas.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data}return b.prototype.newLayer=function(a){return this.c.newLayer.call(this.c,a)},b.prototype.setBlendingMode=function(a){return this.options.blendingMode=a,this},b.prototype.opacity=function(a){return this.options.opacity=a/100,this},b.prototype.copyParent=function(){var a,b,c,d;for(b=this.c.pixelData,a=c=0,d=this.c.pixelData.length;d>c;a=c+=4)this.pixelData[a]=b[a],this.pixelData[a+1]=b[a+1],this.pixelData[a+2]=b[a+2],this.pixelData[a+3]=b[a+3];return this},b.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)},b.prototype.overlayImage=function(b){return"object"==typeof b?b=b.src:"string"==typeof b&&"#"===b[0]&&(b=a(b).src),b?(this.c.renderer.renderQueue.push({type:k.Type.LoadOverlay,src:b,layer:this}),this):this},b.prototype.applyToParent=function(){var a,b,d,e,f,g,h,i,j;for(d=this.c.pixelStack[this.c.pixelStack.length-1],b=this.c.pixelData,j=[],a=h=0,i=b.length;i>h;a=h+=4)g={r:d[a],g:d[a+1],b:d[a+2],a:d[a+3]},f={r:b[a],g:b[a+1],b:b[a+2],a:b[a+3]},e=c.execute(this.options.blendingMode,f,g),e.r=v.clampRGB(e.r),e.g=v.clampRGB(e.g),e.b=v.clampRGB(e.b),null==e.a&&(e.a=f.a),d[a]=g.r-(g.r-e.r)*(this.options.opacity*(e.a/255)),d[a+1]=g.g-(g.g-e.g)*(this.options.opacity*(e.a/255)),j.push(d[a+2]=g.b-(g.b-e.b)*(this.options.opacity*(e.a/255)));return j},b}(),n=e.Layer,e.Logger=function(){function a(){var a,b,c,d;for(d=["log","info","warn","error"],b=0,c=d.length;c>b;b++)a=d[b],this[a]=function(a){return function(){var b,c;if(b=1<=arguments.length?C.call(arguments,0):[],e.DEBUG)try{return console[a].apply(console,b)}catch(d){return c=d,console[a](b)}}}(a);this.debug=this.log}return a}(),o=new e.Logger,e.Pixel=function(){function a(a,b,c,d,e){this.r=null!=a?a:0,this.g=null!=b?b:0,this.b=null!=c?c:0,this.a=null!=d?d:255,this.c=null!=e?e:null,this.loc=0}return a.coordinatesToLocation=function(a,b,c){return 4*(b*c+a)},a.locationToCoordinates=function(a,b){var c,d;return d=Math.floor(a/(4*b)),c=a%(4*b)/4,{x:c,y:d}},a.prototype.setContext=function(a){return this.c=a},a.prototype.locationXY=function(){var a,b;if(null==this.c)throw"Requires a CamanJS context";return b=this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width)),a=this.loc%(4*this.c.dimensions.width)/4,{x:a,y:b}},a.prototype.pixelAtLocation=function(b){if(null==this.c)throw"Requires a CamanJS context";return new a(this.c.pixelData[b],this.c.pixelData[b+1],this.c.pixelData[b+2],this.c.pixelData[b+3],this.c)},a.prototype.getPixelRelative=function(b,c){var d;if(null==this.c)throw"Requires a CamanJS context";return d=this.loc+4*this.c.dimensions.width*(-1*c)+4*b,d>this.c.pixelData.length||0>d?new a(0,0,0,255,this.c):this.pixelAtLocation(d)},a.prototype.putPixelRelative=function(a,b,c){var d;if(null==this.c)throw"Requires a CamanJS context";return d=this.loc+4*this.c.dimensions.width*(-1*b)+4*a,newLoc>this.c.pixelData.length||newLoc<0?void 0:(this.c.pixelData[newLoc]=c.r,this.c.pixelData[newLoc+1]=c.g,this.c.pixelData[newLoc+2]=c.b,this.c.pixelData[newLoc+3]=c.a,!0)},a.prototype.getPixel=function(a,b){var c;if(null==this.c)throw"Requires a CamanJS context";return c=this.coordinatesToLocation(a,b,this.width),this.pixelAtLocation(c)},a.prototype.putPixel=function(a,b,c){var d;if(null==this.c)throw"Requires a CamanJS context";return d=this.coordinatesToLocation(a,b,this.width),this.c.pixelData[d]=c.r,this.c.pixelData[d+1]=c.g,this.c.pixelData[d+2]=c.b,this.c.pixelData[d+3]=c.a},a.prototype.toString=function(){return this.toKey()},a.prototype.toHex=function(a){var b;return null==a&&(a=!1),b="#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16),a?b+this.a.toString(16):b},a}(),q=e.Pixel,e.Plugin=function(){function a(){}return a.plugins={},a.register=function(a,b){return this.plugins[a]=b},a.execute=function(a,b,c){return this.plugins[b].apply(a,c)},a}(),r=e.Plugin,e.Renderer=function(){function a(a){this.c=a,this.processNext=E(this.processNext,this),this.renderQueue=[],this.modPixelData=null}return a.Blocks=e.NodeJS?require("os").cpus().length:4,a.prototype.add=function(a){return null!=a?this.renderQueue.push(a):void 0},a.prototype.processNext=function(){var a;if(0===this.renderQueue.length)return i.trigger(this,"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case k.Type.LayerDequeue:return a=this.c.canvasQueue.shift(),this.c.executeLayer(a),this.processNext();case k.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case k.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case k.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}},a.prototype.execute=function(a){return this.finishedFn=a,this.modPixelData=v.dataArray(this.c.pixelData.length),this.processNext()},a.prototype.eachBlock=function(b){var c,d,f,g,h,i,k,l,m,n,o,p,q=this;for(this.blocksDone=0,l=this.c.pixelData.length,d=Math.floor(l/4/a.Blocks),c=4*d,k=c+l/4%a.Blocks*4,p=[],i=n=0,o=a.Blocks;o>=0?o>n:n>o;i=o>=0?++n:--n)m=i*c,g=m+(i===a.Blocks-1?k:c),e.NodeJS?(h=j(function(){return b.call(q,i,m,g)}),f=h.run(),p.push(this.blockFinished(f))):p.push(setTimeout(function(a,c,d){return function(){return b.call(q,a,c,d)}}(i,m,g),0));return p},a.prototype.executeFilter=function(){return i.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===k.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)},a.prototype.executePlugin=function(){return o.debug("Executing plugin "+this.currentJob.plugin),r.execute(this.c,this.currentJob.plugin,this.currentJob.args),o.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()},a.prototype.renderBlock=function(b,c,d){var f,g,h;for(o.debug("Block #"+b+" - Filter: "+this.currentJob.name+", Start: "+c+", End: "+d),i.trigger(this.c,"blockStarted",{blockNum:b,totalBlocks:a.Blocks,startPixel:c,endPixel:d}),g=new q,g.setContext(this.c),f=h=c;d>h;f=h+=4)g.loc=f,g.r=this.c.pixelData[f],g.g=this.c.pixelData[f+1],g.b=this.c.pixelData[f+2],g.a=this.c.pixelData[f+3],this.currentJob.processFn(g),this.c.pixelData[f]=v.clampRGB(g.r),this.c.pixelData[f+1]=v.clampRGB(g.g),this.c.pixelData[f+2]=v.clampRGB(g.b),this.c.pixelData[f+3]=v.clampRGB(g.a);return e.NodeJS?j["yield"](b):this.blockFinished(b)},a.prototype.renderKernel=function(a,b,c){var d,f,g,h,i,k,l,m,n,p,r,s,t,u,w,x,y,z;for(s=this.currentJob.name,g=this.currentJob.bias,k=this.currentJob.divisor,r=this.c.pixelData.length,d=this.currentJob.adjust,f=Math.sqrt(d.length),p=[],o.debug("Rendering kernel - Filter: "+this.currentJob.name),b=Math.max(b,4*this.c.dimensions.width*((f-1)/2)),c=Math.min(c,r-4*this.c.dimensions.width*((f-1)/2)),h=(f-1)/2,u=new q,u.setContext(this.c),l=x=b;c>x;l=x+=4){for(u.loc=l,i=0,m=y=-h;h>=-h?h>=y:y>=h;m=h>=-h?++y:--y)for(n=z=h;-h>=h?-h>=z:z>=-h;n=-h>=h?++z:--z)t=u.getPixelRelative(m,n),p[3*i]=t.r,p[3*i+1]=t.g,p[3*i+2]=t.b,i++;w=this.processKernel(d,p,k,g),this.modPixelData[l]=v.clampRGB(w.r),this.modPixelData[l+1]=v.clampRGB(w.g),this.modPixelData[l+2]=v.clampRGB(w.b),this.modPixelData[l+3]=this.c.pixelData[l+3]}return e.NodeJS?j["yield"](a):this.blockFinished(a)},a.prototype.blockFinished=function(b){var c,d,e;if(b>=0&&o.debug("Block #"+b+" finished! Filter: "+this.currentJob.name),this.blocksDone++,i.trigger(this.c,"blockFinished",{blockNum:b,blocksFinished:this.blocksDone,totalBlocks:a.Blocks}),this.blocksDone===a.Blocks){if(this.currentJob.type===k.Type.Kernel)for(c=d=0,e=this.c.pixelData.length;e>=0?e>d:d>e;c=e>=0?++d:--d)this.c.pixelData[c]=this.modPixelData[c];return b>=0&&o.debug("Filter "+this.currentJob.name+" finished!"),i.trigger(this.c,"processComplete",this.currentJob),this.processNext()}},a.prototype.processKernel=function(a,b,c,d){var e,f,g,h;for(f={r:0,g:0,b:0},e=g=0,h=a.length;h>=0?h>g:g>h;e=h>=0?++g:--g)f.r+=a[e]*b[3*e],f.g+=a[e]*b[3*e+1],f.b+=a[e]*b[3*e+2];return f.r=f.r/c+d,f.g=f.g/c+d,f.b=f.b/c+d,f},a.prototype.loadOverlay=function(a,b){var c,d,e=this;return c=new m,c.onload=function(){return a.context.drawImage(c,0,0,e.c.dimensions.width,e.c.dimensions.height),a.imageData=a.context.getImageData(0,0,e.c.dimensions.width,e.c.dimensions.height),a.pixelData=a.imageData.data,e.c.pixelData=a.pixelData,e.processNext()},d=l.remoteCheck(b),c.src=null!=d?d:b},a}(),s=e.Renderer,e.Store=function(){function a(){}return a.items={},a.has=function(a){return null!=this.items[a]},a.get=function(a){return this.items[a]},a.put=function(a,b){return this.items[a]=b},a.execute=function(a,b){var c=this;return setTimeout(function(){return b.call(c.get(a),c.get(a))},0),this.get(a)},a.flush=function(a){return null==a&&(a=!1),a?delete this.items[a]:this.items={}},a}(),u=e.Store,c.register("normal",function(a,b){return{r:a.r,g:a.g,b:a.b}}),c.register("multiply",function(a,b){return{r:a.r*b.r/255,g:a.g*b.g/255,b:a.b*b.b/255}}),c.register("screen",function(a,b){return{r:255-(255-a.r)*(255-b.r)/255,g:255-(255-a.g)*(255-b.g)/255,b:255-(255-a.b)*(255-b.b)/255}}),c.register("overlay",function(a,b){var c;return c={},c.r=b.r>128?255-2*(255-a.r)*(255-b.r)/255:b.r*a.r*2/255,c.g=b.g>128?255-2*(255-a.g)*(255-b.g)/255:b.g*a.g*2/255,c.b=b.b>128?255-2*(255-a.b)*(255-b.b)/255:b.b*a.b*2/255,c}),c.register("difference",function(a,b){return{r:a.r-b.r,g:a.g-b.g,b:a.b-b.b}}),c.register("addition",function(a,b){return{r:b.r+a.r,g:b.g+a.g,b:b.b+a.b}}),c.register("exclusion",function(a,b){return{r:128-2*(b.r-128)*(a.r-128)/255,g:128-2*(b.g-128)*(a.g-128)/255,b:128-2*(b.b-128)*(a.b-128)/255}}),c.register("softLight",function(a,b){var c;return c={},c.r=b.r>128?255-(255-b.r)*(255-(a.r-128))/255:b.r*(a.r+128)/255,c.g=b.g>128?255-(255-b.g)*(255-(a.g-128))/255:b.g*(a.g+128)/255,c.b=b.b>128?255-(255-b.b)*(255-(a.b-128))/255:b.b*(a.b+128)/255,c}),c.register("lighten",function(a,b){return{r:b.r>a.r?b.r:a.r,g:b.g>a.g?b.g:a.g,b:b.b>a.b?b.b:a.b}}),c.register("darken",function(a,b){return{r:b.r>a.r?a.r:b.r,g:b.g>a.g?a.g:b.g,b:b.b>a.b?a.b:b.b}}),k.register("fillColor",function(){var a;return a=1===arguments.length?h.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]},this.process("fillColor",function(b){return b.r=a.r,b.g=a.g,b.b=a.b,b.a=255,b})}),k.register("brightness",function(a){return a=Math.floor(255*(a/100)),this.process("brightness",function(b){return b.r+=a,b.g+=a,b.b+=a,b})}),k.register("saturation",function(a){return a*=-.01,this.process("saturation",function(b){var c;return c=Math.max(b.r,b.g,b.b),b.r!==c&&(b.r+=(c-b.r)*a),b.g!==c&&(b.g+=(c-b.g)*a),b.b!==c&&(b.b+=(c-b.b)*a),b})}),k.register("vibrance",function(a){return a*=-1,this.process("vibrance",function(b){var c,d,e;return e=Math.max(b.r,b.g,b.b),d=(b.r+b.g+b.b)/3,c=2*Math.abs(e-d)/255*a/100,b.r!==e&&(b.r+=(e-b.r)*c),b.g!==e&&(b.g+=(e-b.g)*c),b.b!==e&&(b.b+=(e-b.b)*c),b})}),k.register("greyscale",function(a){return this.process("greyscale",function(a){var b;return b=d.luminance(a),a.r=b,a.g=b,a.b=b,a})}),k.register("contrast",function(a){return a=Math.pow((a+100)/100,2),this.process("contrast",function(b){return b.r/=255,b.r-=.5,b.r*=a,b.r+=.5,b.r*=255,b.g/=255,b.g-=.5,b.g*=a,b.g+=.5,b.g*=255,b.b/=255,b.b-=.5,b.b*=a,b.b+=.5,b.b*=255,b})}),k.register("hue",function(a){return this.process("hue",function(b){var c,d,e,f,g,i;return f=h.rgbToHSV(b.r,b.g,b.b),e=100*f.h,e+=Math.abs(a),e%=100,e/=100,f.h=e,i=h.hsvToRGB(f.h,f.s,f.v),g=i.r,d=i.g,c=i.b,b.r=g,b.g=d,b.b=c,b})}),k.register("colorize",function(){var a,b;return 2===arguments.length?(b=h.hexToRGB(arguments[0]),a=arguments[1]):4===arguments.length&&(b={r:arguments[0],g:arguments[1],b:arguments[2]},a=arguments[3]),this.process("colorize",function(c){return c.r-=(c.r-b.r)*(a/100),c.g-=(c.g-b.g)*(a/100),c.b-=(c.b-b.b)*(a/100),c})}),k.register("invert",function(){return this.process("invert",function(a){return a.r=255-a.r,a.g=255-a.g,a.b=255-a.b,a})}),k.register("sepia",function(a){return null==a&&(a=100),a/=100,this.process("sepia",function(b){return b.r=Math.min(255,b.r*(1-.607*a)+b.g*(.769*a)+b.b*(.189*a)),b.g=Math.min(255,b.r*(.349*a)+b.g*(1-.314*a)+b.b*(.168*a)),b.b=Math.min(255,b.r*(.272*a)+b.g*(.534*a)+b.b*(1-.869*a)),b})}),k.register("gamma",function(a){return this.process("gamma",function(b){return b.r=255*Math.pow(b.r/255,a),b.g=255*Math.pow(b.g/255,a),b.b=255*Math.pow(b.b/255,a),b})}),k.register("noise",function(a){return a=2.55*Math.abs(a),this.process("noise",function(b){var c;return c=d.randomRange(-1*a,a),b.r+=c,b.g+=c,b.b+=c,b})}),k.register("clip",function(a){return a=2.55*Math.abs(a),this.process("clip",function(b){return b.r>255-a?b.r=255:b.r<a&&(b.r=0),b.g>255-a?b.g=255:b.g<a&&(b.g=0),b.b>255-a?b.b=255:b.b<a&&(b.b=0),b})}),k.register("channels",function(a){var b,c;if("object"!=typeof a)return this;for(b in a)D.call(a,b)&&(c=a[b],0!==c?a[b]/=100:delete a[b]);return 0===a.length?this:this.process("channels",function(b){return null!=a.red&&(a.red>0?b.r+=(255-b.r)*a.red:b.r-=b.r*Math.abs(a.red)),null!=a.green&&(a.green>0?b.g+=(255-b.g)*a.green:b.g-=b.g*Math.abs(a.green)),null!=a.blue&&(a.blue>0?b.b+=(255-b.b)*a.blue:b.b-=b.b*Math.abs(a.blue)),b})}),k.register("curves",function(){var a,b,c,e,f,g,h,i,j,k,l,m;if(c=arguments[0],e=2<=arguments.length?C.call(arguments,1):[],h=e[e.length-1],"function"==typeof h?(a=h,e.pop()):"string"==typeof h?(a=d[h],e.pop()):a=d.bezier,"string"==typeof c&&(c=c.split("")),"v"===c[0]&&(c=["r","g","b"]),e.length<2)throw"Invalid number of arguments to curves filter";if(b=a(e,0,255),i=e[0],i[0]>0)for(g=j=0,l=i[0];l>=0?l>j:j>l;g=l>=0?++j:--j)b[g]=i[1];if(f=e[e.length-1],f[0]<255)for(g=k=m=f[0];255>=m?255>=k:k>=255;g=255>=m?++k:--k)b[g]=f[1];return this.process("curves",function(a){var d,e;for(g=d=0,e=c.length;e>=0?e>d:d>e;g=e>=0?++d:--d)a[c[g]]=b[a[c[g]]];return a})}),k.register("exposure",function(a){var b,c,d;return d=Math.abs(a)/100,b=[0,255*d],c=[255-255*d,255],0>a&&(b=b.reverse(),c=c.reverse()),this.curves("rgb",[0,0],b,c,[255,255])}),e.Plugin.register("crop",function(a,b,c,d){var e,f;return null==c&&(c=0),null==d&&(d=0),"undefined"!=typeof exports&&null!==exports?e=new g(a,b):(e=document.createElement("canvas"),v.copyAttributes(this.canvas,e),e.width=a,e.height=b),f=e.getContext("2d"),f.drawImage(this.canvas,c,d,a,b,0,0,a,b),this.cropCoordinates={x:c,y:d},this.cropped=!0,this.replaceCanvas(e)}),e.Plugin.register("resize",function(a){var b,c;return null==a&&(a=null),null===a||null==a.width&&null==a.height?void o.error("Invalid or missing dimensions given for resize"):(null==a.width?a.width=this.canvas.width*a.height/this.canvas.height:null==a.height&&(a.height=this.canvas.height*a.width/this.canvas.width),"undefined"!=typeof exports&&null!==exports?b=new g(a.width,a.height):(b=document.createElement("canvas"),v.copyAttributes(this.canvas,b),b.width=a.width,b.height=a.height),c=b.getContext("2d"),c.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,a.width,a.height),this.resized=!0,this.replaceCanvas(b))}),e.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))}),e.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))}),e.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])}),e.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])}),e.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])}),e.Filter.register("motionBlur",function(a){var b;return b=0===a||180===a?[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]:a>0&&90>a||a>180&&270>a?[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]:90===a||270===a?[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],this.processKernel("Motion Blur",b)}),e.Filter.register("sharpen",function(a){return null==a&&(a=100),a/=100,this.processKernel("Sharpen",[0,-a,0,-a,4*a+1,-a,0,-a,0])}),A={brightness:function(a,b,c){return a.r=a.r-a.r*b*c.strength,a.g=a.g-a.g*b*c.strength,a.b=a.b-a.b*b*c.strength,a},gamma:function(a,b,c){return a.r=255*Math.pow(a.r/255,Math.max(10*b*c.strength,1)),a.g=255*Math.pow(a.g/255,Math.max(10*b*c.strength,1)),a.b=255*Math.pow(a.b/255,Math.max(10*b*c.strength,1)),a},colorize:function(a,b,c){return a.r-=(a.r-c.color.r)*b,a.g-=(a.g-c.color.g)*b,a.b-=(a.b-c.color.b)*b,a}},k.register("vignette",function(a,b){var c,e,f,g;return null==b&&(b=60),"string"==typeof a&&"%"===a.substr(-1)&&(a=this.dimensions.height>this.dimensions.width?this.dimensions.width*(parseInt(a.substr(0,a.length-1),10)/100):this.dimensions.height*(parseInt(a.substr(0,a.length-1),10)/100)),b/=100,e=[this.dimensions.width/2,this.dimensions.height/2],g=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),f=g-a,c=d.bezier([0,1],[30,30],[70,60],[100,80]),this.process("vignette",function(g){var h,i,j;return j=g.locationXY(),h=d.distance(j.x,j.y,e[0],e[1]),h>f&&(i=Math.max(1,c[Math.round((h-f)/a*100)]/10*b),g.r=255*Math.pow(g.r/255,i),g.g=255*Math.pow(g.g/255,i),g.b=255*Math.pow(g.b/255,i)),g})}),k.register("rectangularVignette",function(a){var b,c,f,g,i,j,k;if(b={strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}},a=v.extend(b,a),!a.size)return this;if("string"==typeof a.size)f=parseInt(a.size,10)/100,a.size={width:this.dimensions.width*f,height:this.dimensions.height*f};else if("object"==typeof a.size)for(k=["width","height"],i=0,j=k.length;j>i;i++)c=k[i],"string"==typeof a.size[c]&&(a.size[c]=this.dimensions[c]*(parseInt(a.size[c],10)/100));else"number"===a.size&&(g=a.size,a.size={width:g,height:g});return"string"==typeof a.cornerRadius&&(a.cornerRadius=a.size.width/2*(parseInt(a.cornerRadius,10)/100)),a.strength/=100,a.size.width=Math.floor(a.size.width),a.size.height=Math.floor(a.size.height),a.image={width:this.dimensions.width,height:this.dimensions.height},"colorize"===a.method&&"string"==typeof a.color&&(a.color=h.hexToRGB(a.color)),a.coords={left:(this.dimensions.width-a.size.width)/2,right:this.dimensions.width-a.coords.left,bottom:(this.dimensions.height-a.size.height)/2,top:this.dimensions.height-a.coords.bottom},a.corners=[{x:a.coords.left+a.cornerRadius,y:a.coords.top-a.cornerRadius},{x:a.coords.right-a.cornerRadius,y:a.coords.top-a.cornerRadius},{x:a.coords.right-a.cornerRadius,y:a.coords.bottom+a.cornerRadius},{x:a.coords.left+a.cornerRadius,y:a.coords.bottom+a.cornerRadius}],a.maxDist=d.distance(0,0,a.corners[3].x,a.corners[3].y)-a.cornerRadius,this.process("rectangularVignette",function(b){var c,d,f;return d=b.locationXY(),d.x>a.corners[0].x&&d.x<a.corners[1].x&&d.y>a.coords.bottom&&d.y<a.coords.top?b:d.x>a.coords.left&&d.x<a.coords.right&&d.y>a.corners[3].y&&d.y<a.corners[2].y?b:(d.x>a.corners[0].x&&d.x<a.corners[1].x&&d.y>a.coords.top?c=(d.y-a.coords.top)/a.maxDist:d.y>a.corners[2].y&&d.y<a.corners[1].y&&d.x>a.coords.right?c=(d.x-a.coords.right)/a.maxDist:d.x>a.corners[0].x&&d.x<a.corners[1].x&&d.y<a.coords.bottom?c=(a.coords.bottom-d.y)/a.maxDist:d.y>a.corners[2].y&&d.y<a.corners[1].y&&d.x<a.coords.left?c=(a.coords.left-d.x)/a.maxDist:d.x<=a.corners[0].x&&d.y>=a.corners[0].y?(f=e.distance(d.x,d.y,a.corners[0].x,a.corners[0].y),c=(f-a.cornerRadius)/a.maxDist):d.x>=a.corners[1].x&&d.y>=a.corners[1].y?(f=e.distance(d.x,d.y,a.corners[1].x,a.corners[1].y),c=(f-a.cornerRadius)/a.maxDist):d.x>=a.corners[2].x&&d.y<=a.corners[2].y?(f=e.distance(d.x,d.y,a.corners[2].x,a.corners[2].y),c=(f-a.cornerRadius)/a.maxDist):d.x<=a.corners[3].x&&d.y<=a.corners[3].y&&(f=e.distance(d.x,d.y,a.corners[3].x,a.corners[3].y),c=(f-a.cornerRadius)/a.maxDist),0>c?b:A[a.method](b,c,a))})}),function(){var a,b,c,d,f;return d=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],f=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],b=function(a,b,c,d,e,f,h){var i,j,k,l,m,n,o;return i="undefined"!=typeof exports&&null!==exports?new g:document.createElement("canvas"),i.width=a,i.height=b,l=c+Math.cos(e)*f*.5,n=d+Math.sin(e)*f*.5,m=c-Math.cos(e)*f*.5,o=d-Math.sin(e)*f*.5,j=i.getContext("2d"),k=j.createLinearGradient(l,n,m,o),h?(k.addColorStop(0,"white"),k.addColorStop(.5,"black"),k.addColorStop(1,"white")):(k.addColorStop(0,"white"),k.addColorStop(1,"black")),j.fillStyle=k,j.fillRect(0,0,a,b),j.getImageData(0,0,a,b)},c=function(a,b,c,d,e,f){var h,i,j;return h="undefined"!=typeof exports&&null!==exports?new g:document.createElement("canvas"),h.width=a,h.height=b,i=h.getContext("2d"),j=i.createRadialGradient(c,d,e,c,d,f),j.addColorStop(1,"white"),j.addColorStop(0,"black"),i.fillStyle=j,i.fillRect(0,0,a,b),i.getImageData(0,0,a,b)},a=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},e.Plugin.register("compoundBlur",function(b,c,e,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka;for(W=this.dimensions.width,q=this.dimensions.height,v=this.pixelData,I=b.data,U=W*q,V=U<<2,D=[],s=ba=0;V>=0?V>ba:ba>V;s=V>=0?++ba:--ba)D[s]=v[s];for(l=0,R=g,g-=1;R-->=0;)if(x=c+.5|0,0!==x){for(x>256&&(x=256),m=x+x+1,T=W<<2,X=W-1,r=q-1,J=x+1,S=J*(J+1)/2,
Q=new a,N=void 0,M=Q,s=ca=1;m>=1?m>ca:ca>m;s=m>=1?++ca:--ca)M=M.next=new a,s===J&&(N=M);for(M.next=Q,O=null,P=null,aa=$=0,z=d[x],L=f[x],Z=da=0;q>=0?q>da:da>q;Z=q>=0?++da:--da){for(F=n=h=H=p=j=0,G=J*(E=D[$]),o=J*(C=D[$+1]),i=J*(B=D[$+2]),H+=S*E,p+=S*C,j+=S*B,M=Q,s=ea=0;J>=0?J>ea:ea>J;s=J>=0?++ea:--ea)M.r=E,M.g=C,M.b=B,M=M.next;for(s=fa=1;J>=1?J>fa:fa>J;s=J>=1?++fa:--fa)A=$+((s>X?X:s)<<2),H+=(M.r=E=D[A])*(K=J-s),p+=(M.g=C=D[A+1])*K,j+=(M.b=B=D[A+2])*K,F+=E,n+=C,h+=B,M=M.next;for(O=Q,P=N,Y=ga=0;W>=0?W>ga:ga>W;Y=W>=0?++ga:--ga)D[$]=H*z>>L,D[$+1]=p*z>>L,D[$+2]=j*z>>L,H-=G,p-=o,j-=i,G-=O.r,o-=O.g,i-=O.b,A=aa+((A=Y+J)<X?A:X)<<2,F+=O.r=D[A],n+=O.g=D[A+1],h+=O.b=D[A+2],H+=F,p+=n,j+=h,O=O.next,G+=E=P.r,o+=C=P.g,i+=B=P.b,F-=E,n-=C,h-=B,P=P.next,$+=4;aa+=W}for(Y=ha=0;W>=0?W>ha:ha>W;Y=W>=0?++ha:--ha){for(n=h=F=p=j=H=0,$=Y<<2,G=J*(E=D[$]),o=J*(C=D[$+1]),i=J*(B=D[$+2]),H+=S*E,p+=S*C,j+=S*B,M=Q,s=ia=0;J>=0?J>ia:ia>J;s=J>=0?++ia:--ia)M.r=E,M.g=C,M.b=B,M=M.next;for(_=W,s=ja=1;J>=1?J>ja:ja>J;s=J>=1?++ja:--ja)$=_+Y<<2,H+=(M.r=E=D[$])*(K=J-s),p+=(M.g=C=D[$+1])*K,j+=(M.b=B=D[$+2])*K,F+=E,n+=C,h+=B,M=M.next,r>s&&(_+=W);for($=Y,O=Q,P=N,Z=ka=0;q>=0?q>ka:ka>q;Z=q>=0?++ka:--ka)A=$<<2,D[A]=H*z>>L,D[A+1]=p*z>>L,D[A+2]=j*z>>L,H-=G,p-=o,j-=i,G-=O.r,o-=O.g,i-=O.b,A=Y+((A=Z+J)<r?A:r)*W<<2,H+=F+=O.r=D[A],p+=n+=O.g=D[A+1],j+=h+=O.b=D[A+2],O=O.next,G+=E=P.r,o+=C=P.g,i+=B=P.b,F-=E,n-=C,h-=B,P=P.next,$+=W}for(c*=e,s=U;--s>-1;)u=s<<2,y=(255&I[u+2])/255*g,w=0|y,w===l?(k=256*(y-(0|y)),t=256-k,v[u]=v[u]*t+D[u]*k>>8,v[u+1]=v[u+1]*t+D[u+1]*k>>8,v[u+2]=v[u+2]*t+D[u+2]*k>>8):w===l+1&&(v[u]=D[u],v[u+1]=D[u+1],v[u+2]=D[u+2]);l++}return this}),e.Filter.register("tiltShift",function(a){var c,d;return c={center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3},a=v.extend(c,a),a.angle*=Math.PI/180,d=b(this.dimensions.width,this.dimensions.height,a.center.x,a.center.y,a.angle,a.focusWidth,!0),this.processPlugin("compoundBlur",[d,a.startRadius,a.radiusFactor,a.steps])}),e.Filter.register("radialBlur",function(a){var b,d,e,f;return b={size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null},a=v.extend(b,a),a.radius||(a.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width),e=a.radius/2-a.size,f=a.radius/2,d=c(this.dimensions.width,this.dimensions.height,a.center.x,a.center.y,e,f),this.processPlugin("compoundBlur",[d,a.startRadius,a.radiusFactor,a.steps])})}(),e.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])}),e.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])}),e.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])}),e.Filter.register("posterize",function(a){var b,c;return b=256/a,c=255/(a-1),this.process("posterize",function(a){return a.r=Math.floor(Math.floor(a.r/b)*c),a.g=Math.floor(Math.floor(a.g/b)*c),a.b=Math.floor(Math.floor(a.b/b)*c),a})}),e.Filter.register("vintage",function(a){return null==a&&(a=!0),this.greyscale(),this.contrast(5),this.noise(3),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.87),a?this.vignette("40%",30):void 0}),e.Filter.register("lomo",function(a){return null==a&&(a=!0),this.brightness(15),this.exposure(15),this.curves("rgb",[0,0],[200,0],[155,255],[255,255]),this.saturation(-20),this.gamma(1.8),a&&this.vignette("50%",60),this.brightness(5)}),e.Filter.register("clarity",function(a){return null==a&&(a=!1),this.vibrance(20),this.curves("rgb",[5,0],[130,150],[190,220],[250,255]),this.sharpen(15),this.vignette("45%",20),a&&(this.greyscale(),this.contrast(4)),this}),e.Filter.register("sinCity",function(){return this.contrast(100),this.brightness(15),this.exposure(10),this.posterize(80),this.clip(30),this.greyscale()}),e.Filter.register("sunrise",function(){return this.exposure(3.5),this.saturation(-5),this.vibrance(50),this.sepia(60),this.colorize("#e87b22",10),this.channels({red:8,blue:8}),this.contrast(5),this.gamma(1.2),this.vignette("55%",25)}),e.Filter.register("crossProcess",function(){return this.exposure(5),this.colorize("#e87b22",4),this.sepia(20),this.channels({blue:8,red:3}),this.curves("b",[0,0],[100,150],[180,180],[255,255]),this.contrast(15),this.vibrance(75),this.gamma(1.6)}),e.Filter.register("orangePeel",function(){return this.curves("rgb",[0,0],[100,50],[140,200],[255,255]),this.vibrance(-30),this.saturation(-30),this.colorize("#ff9000",30),this.contrast(-5),this.gamma(1.4)}),e.Filter.register("love",function(){return this.brightness(5),this.exposure(8),this.contrast(4),this.colorize("#c42007",30),this.vibrance(50),this.gamma(1.3)}),e.Filter.register("grungy",function(){return this.gamma(1.5),this.clip(25),this.saturation(-60),this.contrast(5),this.noise(5),this.vignette("50%",30)}),e.Filter.register("jarques",function(){return this.saturation(-35),this.curves("b",[20,0],[90,120],[186,144],[255,230]),this.curves("r",[0,0],[144,90],[138,120],[255,255]),this.curves("g",[10,0],[115,105],[148,100],[255,248]),this.curves("rgb",[0,0],[120,100],[128,140],[255,255]),this.sharpen(20)}),e.Filter.register("pinhole",function(){return this.greyscale(),this.sepia(10),this.exposure(10),this.contrast(15),this.vignette("60%",35)}),e.Filter.register("oldBoot",function(){return this.saturation(-20),this.vibrance(-50),this.gamma(1.1),this.sepia(30),this.channels({red:-10,blue:5}),this.curves("rgb",[0,0],[80,50],[128,230],[255,255]),this.vignette("60%",30)}),e.Filter.register("glowingSun",function(a){return null==a&&(a=!0),this.brightness(10),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.gamma(.8),this.filter.contrast(50),this.filter.exposure(10)}),this.newLayer(function(){return this.setBlendingMode("softLight"),this.opacity(80),this.fillColor("#f49600")}),this.exposure(20),this.gamma(.8),a?this.vignette("45%",20):void 0}),e.Filter.register("hazyDays",function(){return this.gamma(1.2),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(60),this.copyParent(),this.filter.channels({red:5}),this.filter.stackBlur(15)}),this.newLayer(function(){return this.setBlendingMode("addition"),this.opacity(40),this.fillColor("#6899ba")}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(35),this.copyParent(),this.filter.brightness(40),this.filter.vibrance(40),this.filter.exposure(30),this.filter.contrast(15),this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]),this.filter.stackBlur(5)}),this.curves("r",[20,0],[128,158],[128,128],[235,255]),this.curves("g",[20,0],[128,128],[128,128],[235,255]),this.curves("b",[20,0],[128,108],[128,128],[235,255]),this.vignette("45%",20)}),e.Filter.register("herMajesty",function(){return this.brightness(40),this.colorize("#ea1c5d",10),this.curves("b",[0,10],[128,180],[190,190],[255,255]),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(50),this.copyParent(),this.filter.gamma(.7),this.newLayer(function(){return this.setBlendingMode("normal"),this.opacity(60),this.fillColor("#ea1c5d")})}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(60),this.copyParent(),this.filter.saturation(50),this.filter.hue(90),this.filter.contrast(10)}),this.gamma(1.4),this.vibrance(-30),this.newLayer(function(){return this.opacity(10),this.fillColor("#e5f0ff")}),this}),e.Filter.register("nostalgia",function(){return this.saturation(20),this.gamma(1.4),this.greyscale(),this.contrast(5),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.8),this.contrast(5),this.exposure(10),this.newLayer(function(){return this.setBlendingMode("overlay"),this.copyParent(),this.opacity(55),this.filter.stackBlur(10)}),this.vignette("50%",30)}),e.Filter.register("hemingway",function(){return this.greyscale(),this.contrast(10),this.gamma(.9),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(40),this.copyParent(),this.filter.exposure(15),this.filter.contrast(15),this.filter.channels({green:10,red:5})}),this.sepia(30),this.curves("rgb",[0,10],[120,90],[180,200],[235,255]),this.channels({red:5,green:-2}),this.exposure(15)}),e.Filter.register("concentrate",function(){return this.sharpen(40),this.saturation(-50),this.channels({red:3}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.sharpen(5),this.filter.contrast(50),this.filter.exposure(10),this.filter.channels({blue:5})}),this.brightness(10)}),e.Plugin.register("rotate",function(a){var b,c,d,e,f,h,i,j;return b=a%360,0===b?this.dimensions={width:this.canvas.width,height:this.canvas.height}:(f=Math.PI/180,"undefined"!=typeof exports&&null!==exports?c=new g:(c=document.createElement("canvas"),v.copyAttributes(this.canvas,c)),90===b||-270===b||270===b||-90===b?(h=this.canvas.height,e=this.canvas.width,i=h/2,j=e/2):180===b?(h=this.canvas.width,e=this.canvas.height,i=h/2,j=e/2):(h=Math.sqrt(Math.pow(this.originalWidth,2)+Math.pow(this.originalHeight,2)),e=h,i=this.canvas.height/2,j=this.canvas.width/2),c.width=h,c.height=e,d=c.getContext("2d"),d.save(),d.translate(i,j),d.rotate(b*f),d.drawImage(this.canvas,-this.canvas.width/2,-this.canvas.height/2,this.canvas.width,this.canvas.height),d.restore(),this.replaceCanvas(c))}),e.Filter.register("rotate",function(){return this.processPlugin("rotate",Array.prototype.slice.call(arguments,0))}),function(){var a,b,c;return b=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],c=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],a=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},e.Plugin.register("stackBlur",function(d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W;if(!(isNaN(d)||1>d)){for(d|=0,s=this.pixelData,H=this.dimensions.width,l=this.dimensions.height,h=d+d+1,G=H<<2,I=H-1,m=l-1,x=d+1,F=x*(x+1)/2,E=new a,A=E,n=O=1;h>=1?h>O:O>h;n=h>=1?++O:--O)A=A.next=new a,n===x&&(B=A);for(A.next=E,C=null,D=null,N=L=0,o=b[d],z=c[d],K=P=0;l>=0?l>P:P>l;K=l>=0?++P:--P){for(u=i=e=w=k=g=0,v=x*(t=s[L]),j=x*(r=s[L+1]),f=x*(q=s[L+2]),w+=F*t,k+=F*r,g+=F*q,A=E,n=Q=0;x>=0?x>Q:Q>x;n=x>=0?++Q:--Q)A.r=t,A.g=r,A.b=q,A=A.next;for(n=R=1;x>=1?x>R:R>x;n=x>=1?++R:--R)p=L+((n>I?I:n)<<2),w+=(A.r=t=s[p])*(y=x-n),k+=(A.g=r=s[p+1])*y,g+=(A.b=q=s[p+2])*y,u+=t,i+=r,e+=q,A=A.next;for(C=E,D=B,J=S=0;H>=0?H>S:S>H;J=H>=0?++S:--S)s[L]=w*o>>z,s[L+1]=k*o>>z,s[L+2]=g*o>>z,w-=v,k-=j,g-=f,v-=C.r,j-=C.g,f-=C.b,p=N+((p=J+d+1)<I?p:I)<<2,u+=C.r=s[p],i+=C.g=s[p+1],e+=C.b=s[p+2],w+=u,k+=i,g+=e,C=C.next,v+=t=D.r,j+=r=D.g,f+=q=D.b,u-=t,i-=r,e-=q,D=D.next,L+=4;N+=H}for(J=T=0;H>=0?H>T:T>H;J=H>=0?++T:--T){for(i=e=u=k=g=w=0,L=J<<2,v=x*(t=s[L]),j=x*(r=s[L+1]),f=x*(q=s[L+2]),w+=F*t,k+=F*r,g+=F*q,A=E,n=U=0;x>=0?x>U:U>x;n=x>=0?++U:--U)A.r=t,A.g=r,A.b=q,A=A.next;for(M=H,n=V=1;d>=1?d>=V:V>=d;n=d>=1?++V:--V)L=M+J<<2,w+=(A.r=t=s[L])*(y=x-n),k+=(A.g=r=s[L+1])*y,g+=(A.b=q=s[L+2])*y,u+=t,i+=r,e+=q,A=A.next,m>n&&(M+=H);for(L=J,C=E,D=B,K=W=0;l>=0?l>W:W>l;K=l>=0?++W:--W)p=L<<2,s[p]=w*o>>z,s[p+1]=k*o>>z,s[p+2]=g*o>>z,w-=v,k-=j,g-=f,v-=C.r,j-=C.g,f-=C.b,p=J+((p=K+x)<m?p:m)*H<<2,w+=u+=C.r=s[p],k+=i+=C.g=s[p+1],g+=e+=C.b=s[p+2],C=C.next,v+=t=D.r,j+=r=D.g,f+=q=D.b,u-=t,i-=r,e-=q,D=D.next,L+=H}return this}}),e.Filter.register("stackBlur",function(a){return this.processPlugin("stackBlur",[a])})}(),e.Filter.register("threshold",function(a){return this.process("threshold",function(b){var c;return c=.2126*b.r+.7152*b.g+.0722*b.b,a>c?(b.r=0,b.g=0,b.b=0):(b.r=255,b.g=255,b.b=255),b})})}.call(this),function(a){function b(a,b,c){if((a[b]||a[c])&&a[b]===a[c])throw Error("(Link) '"+b+"' can't match '"+c+"'.'")}function c(c){if(void 0===c&&(c={}),"object"!=typeof c)throw Error("(Format) 'format' option must be an object.");var d={};a(e).each(function(a,b){if(void 0===c[b])d[b]=f[a];else{if(typeof c[b]!=typeof f[a])throw Error("(Format) 'format."+b+"' must be a "+typeof f[a]+".");if("decimals"===b&&(0>c[b]||7<c[b]))throw Error("(Format) 'format.decimals' option must be between 0 and 7.");d[b]=c[b]}}),b(d,"mark","thousand"),b(d,"prefix","negative"),b(d,"prefix","negativeBefore"),this.r=d}function d(b,c){return"object"!=typeof b&&a.error("(Link) Initialize with an object."),new d.prototype.p(b.target||function(){},b.method,b.format||{},c)}var e="decimals mark thousand prefix postfix encoder decoder negative negativeBefore to from".split(" "),f=[2,".","","","",function(a){return a},function(a){return a},"-","",function(a){return a},function(a){return a}];c.prototype.a=function(a){return this.r[a]},c.prototype.L=function(a){function b(a){return a.split("").reverse().join("")}a=this.a("encoder")(a);var c=this.a("decimals"),d="",e="",f="",g="";return 0===parseFloat(a.toFixed(c))&&(a="0"),0>a&&(d=this.a("negative"),e=this.a("negativeBefore")),a=Math.abs(a).toFixed(c).toString(),a=a.split("."),this.a("thousand")?(f=b(a[0]).match(/.{1,3}/g),f=b(f.join(b(this.a("thousand"))))):f=a[0],this.a("mark")&&1<a.length&&(g=this.a("mark")+a[1]),this.a("to")(e+this.a("prefix")+d+f+g+this.a("postfix"))},c.prototype.w=function(a){function b(a){return a.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")}var c;return null===a||void 0===a?!1:(a=this.a("from")(a),a=a.toString(),c=a.replace(RegExp("^"+b(this.a("negativeBefore"))),""),a!==c?(a=c,c="-"):c="",a=a.replace(RegExp("^"+b(this.a("prefix"))),""),this.a("negative")&&(c="",a=a.replace(RegExp("^"+b(this.a("negative"))),"-")),a=a.replace(RegExp(b(this.a("postfix"))+"$"),"").replace(RegExp(b(this.a("thousand")),"g"),"").replace(this.a("mark"),"."),a=this.a("decoder")(parseFloat(c+a)),isNaN(a)?!1:a)},d.prototype.K=function(b,c){this.method=c||"html",this.j=a(b.replace("-tooltip-","")||"<div/>")[0]},d.prototype.H=function(a){this.method="val",this.j=document.createElement("input"),this.j.name=a,this.j.type="hidden"},d.prototype.G=function(b){function c(a,b){return[b?null:a,b?a:null]}var d=this;this.method="val",this.target=b.on("change",function(b){d.B.val(c(a(b.target).val(),d.t),{link:d,set:!0})})},d.prototype.p=function(b,c,d,e){if(this.g=d,this.update=!e,"string"==typeof b&&0===b.indexOf("-tooltip-"))this.K(b,c);else if("string"==typeof b&&0!==b.indexOf("-"))this.H(b);else{if("function"!=typeof b){if(b instanceof a||a.zepto&&a.zepto.isZ(b)){if(!c){if(b.is("input, select, textarea"))return void this.G(b);c="html"}if("function"==typeof c||"string"==typeof c&&b[c])return this.method=c,void(this.target=b)}throw new RangeError("(Link) Invalid Link.")}this.target=!1,this.method=b}},d.prototype.write=function(a,b,c,d){this.update&&!1===d||(this.u=a,this.F=a=this.format(a),"function"==typeof this.method?this.method.call(this.target[0]||c[0],a,b,c):this.target[this.method](a,b,c))},d.prototype.q=function(b){this.g=new c(a.extend({},b,this.g instanceof c?this.g.r:this.g))},d.prototype.J=function(a){this.B=a},d.prototype.I=function(a){this.t=a},d.prototype.format=function(a){return this.g.L(a)},d.prototype.A=function(a){return this.g.w(a)},d.prototype.p.prototype=d.prototype,a.Link=d}(window.jQuery||window.Zepto),function(a){function b(a){return"number"==typeof a&&!isNaN(a)&&isFinite(a)}function c(b){return a.isArray(b)?b:[b]}function d(a,b){a.addClass(b),setTimeout(function(){a.removeClass(b)},300)}function e(a,b){return 100*b/(a[1]-a[0])}function f(a,b){if(b>=a.d.slice(-1)[0])return 100;for(var c,d,f,g=1;b>=a.d[g];)g++;return c=a.d[g-1],d=a.d[g],f=a.c[g-1],c=[c,d],f+e(c,0>c[0]?b+Math.abs(c[0]):b-c[0])/(100/(a.c[g]-f))}function g(a,b){if(b>=100)return a.d.slice(-1)[0];for(var c,d,e,f=1;b>=a.c[f];)f++;return c=a.d[f-1],d=a.d[f],e=a.c[f-1],c=[c,d],100/(a.c[f]-e)*(b-e)*(c[1]-c[0])/100+c[0]}function h(a,b){for(var c,d=1;(a.dir?100-b:b)>=a.c[d];)d++;return a.m?(c=a.c[d-1],d=a.c[d],b-c>(d-c)/2?d:c):(a.h[d-1]?(c=a.h[d-1],d=a.c[d-1]+Math.round((b-a.c[d-1])/c)*c):d=b,d)}function i(a,c){if(!b(c))throw Error("noUiSlider: 'step' is not numeric.");a.h[0]=c}function j(c,d){if("object"!=typeof d||a.isArray(d))throw Error("noUiSlider: 'range' is not an object.");if(void 0===d.min||void 0===d.max)throw Error("noUiSlider: Missing 'min' or 'max' in 'range'.");a.each(d,function(d,e){var f;if("number"==typeof e&&(e=[e]),!a.isArray(e))throw Error("noUiSlider: 'range' contains invalid value.");if(f="min"===d?0:"max"===d?100:parseFloat(d),!b(f)||!b(e[0]))throw Error("noUiSlider: 'range' value isn't numeric.");c.c.push(f),c.d.push(e[0]),f?c.h.push(isNaN(e[1])?!1:e[1]):isNaN(e[1])||(c.h[0]=e[1])}),a.each(c.h,function(a,b){return b?void(c.h[a]=e([c.d[a],c.d[a+1]],b)/(100/(c.c[a+1]-c.c[a]))):!0})}function k(b,c){if("number"==typeof c&&(c=[c]),!a.isArray(c)||!c.length||2<c.length)throw Error("noUiSlider: 'start' option is incorrect.");b.b=c.length,b.start=c}function l(a,b){if(a.m=b,"boolean"!=typeof b)throw Error("noUiSlider: 'snap' option must be a boolean.")}function m(a,b){if("lower"===b&&1===a.b)a.i=1;else if("upper"===b&&1===a.b)a.i=2;else if(!0===b&&2===a.b)a.i=3;else{if(!1!==b)throw Error("noUiSlider: 'connect' option doesn't match handle count.");a.i=0}}function n(a,b){switch(b){case"horizontal":a.k=0;break;case"vertical":a.k=1;break;default:throw Error("noUiSlider: 'orientation' option is invalid.")}}function o(a,c){if(2<a.c.length)throw Error("noUiSlider: 'margin' option is only supported on linear sliders.");if(a.margin=e(a.d,c),!b(c))throw Error("noUiSlider: 'margin' option must be numeric.")}function p(a,b){switch(b){case"ltr":a.dir=0;break;case"rtl":a.dir=1,a.i=[0,2,1,3][a.i];break;default:throw Error("noUiSlider: 'direction' option was not recognized.")}}function q(a,b){if("string"!=typeof b)throw Error("noUiSlider: 'behaviour' must be a string containing options.");var c=0<=b.indexOf("snap");a.n={s:0<=b.indexOf("tap")||c,extend:0<=b.indexOf("extend"),v:0<=b.indexOf("drag"),fixed:0<=b.indexOf("fixed"),m:c}}function r(b,c,d){b.o=[c.lower,c.upper],b.g=c.format,a.each(b.o,function(b,e){if(!a.isArray(e))throw Error("noUiSlider: 'serialization."+(b?"upper":"lower")+"' must be an array.");a.each(e,function(){if(!(this instanceof a.Link))throw Error("noUiSlider: 'serialization."+(b?"upper":"lower")+"' can only contain Link instances.");this.I(b),this.J(d),this.q(c.format)})}),b.dir&&1<b.b&&b.o.reverse()}function s(b,c){var d,e={c:[],d:[],h:[!1],margin:0};return d={step:{e:!1,f:i},start:{e:!0,f:k},connect:{e:!0,f:m},direction:{e:!0,f:p},range:{e:!0,f:j},snap:{e:!1,f:l},orientation:{e:!1,f:n},margin:{e:!1,f:o},behaviour:{e:!0,f:q},serialization:{e:!0,f:r}},b=a.extend({connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},b),b.serialization=a.extend({lower:[],upper:[],format:{}},b.serialization),a.each(d,function(a,d){if(void 0===b[a]){if(d.e)throw Error("noUiSlider: '"+a+"' is required.");return!0}d.f(e,b[a],c)}),e.style=e.k?"top":"left",e}function t(b,c){var d=a("<div><div/></div>").addClass(G[2]),e=["-lower","-upper"];return b.dir&&e.reverse(),d.children().addClass(G[3]+" "+G[3]+e[c]),d}function u(b,c){return c.j&&(c=new a.Link({target:a(c.j).clone().appendTo(b),method:c.method,format:c.g},!0)),c}function v(b,c){var d,e=[];for(d=0;d<b.b;d++){var f=e,g=d,h=b.o[d],i=c[d].children(),j=b.g,k=void 0,l=[],k=new a.Link({},!0);for(k.q(j),l.push(k),k=0;k<h.length;k++)l.push(u(i,h[k]));f[g]=l}return e}function w(a,b,c){switch(a){case 1:b.addClass(G[7]),c[0].addClass(G[6]);break;case 3:c[1].addClass(G[6]);case 2:c[0].addClass(G[7]);case 0:b.addClass(G[6])}}function x(a,b){var c,d=[];for(c=0;c<a.b;c++)d.push(t(a,c).appendTo(b));return d}function y(b,c){return c.addClass([G[0],G[8+b.dir],G[4+b.k]].join(" ")),a("<div/>").appendTo(c).addClass(G[1])}function z(b,e,i){function j(){return t[["width","height"][e.k]]()}function k(a){var b,c=[A.val()];for(b=0;b<a.length;b++)A.trigger(a[b],c)}function l(b,c,d){var f=b[0]!==z[0][0]?1:0,i=B[0]+e.margin,j=B[1]-e.margin;return d&&1<z.length&&(c=f?Math.max(c,i):Math.min(c,j)),100>c&&(c=h(e,c)),c=Math.max(Math.min(parseFloat(c.toFixed(7)),100),0),c===B[f]?1===z.length?!1:c===i||c===j?0:!1:(b.css(e.style,c+"%"),b.is(":first-child")&&b.toggleClass(G[17],c>50),B[f]=c,e.dir&&(c=100-c),a(u[f]).each(function(){this.write(g(e,c),b.children(),A)}),!0)}function m(a,b,c){c||d(A,G[14]),l(a,b,!1),k(["slide","set","change"])}function n(a,b,c,d){a=a.replace(/\s/g,".nui ")+".nui",b.on(a,function(a){var b=A.attr("disabled");if(A.hasClass(G[14])||void 0!==b&&null!==b)return!1;a.preventDefault();var f,g,b=0===a.type.indexOf("touch"),h=0===a.type.indexOf("mouse"),i=0===a.type.indexOf("pointer"),j=a;0===a.type.indexOf("MSPointer")&&(i=!0),a.originalEvent&&(a=a.originalEvent),b&&(f=a.changedTouches[0].pageX,g=a.changedTouches[0].pageY),(h||i)&&(i||void 0!==window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),f=a.clientX+window.pageXOffset,g=a.clientY+window.pageYOffset),j.C=[f,g],j.cursor=h,a=j,a.l=a.C[e.k],c(a,d)})}function o(a,b){var c,d=b.b||z,e=!1,e=100*(a.l-b.start)/j(),f=d[0][0]!==z[0][0]?1:0,g=b.D;c=e+g[0],e+=g[1],1<d.length?(0>c&&(e+=Math.abs(c)),e>100&&(c-=e-100),c=[Math.max(Math.min(c,100),0),Math.max(Math.min(e,100),0)]):c=[c,e],e=l(d[0],c[f],1===d.length),1<d.length&&(e=l(d[1],c[f?0:1],!1)||e),e&&k(["slide"])}function p(b){a("."+G[15]).removeClass(G[15]),b.cursor&&a("body").css("cursor","").off(".nui"),D.off(".nui"),A.removeClass(G[12]),k(["set","change"])}function q(b,c){1===c.b.length&&c.b[0].children().addClass(G[15]),b.stopPropagation(),n(F.move,D,o,{start:b.l,b:c.b,D:[B[0],B[z.length-1]]}),n(F.end,D,p,null),b.cursor&&(a("body").css("cursor",a(b.target).css("cursor")),1<z.length&&A.addClass(G[12]),a("body").on("selectstart.nui",!1))}function r(b){var c=b.l,d=0;b.stopPropagation(),a.each(z,function(){d+=this.offset()[e.style]}),d=d/2>c||1===z.length?0:1,c-=t.offset()[e.style],c=100*c/j(),m(z[d],c,e.n.m),e.n.m&&q(b,{b:[z[d]]})}function s(a){var b=(a=a.l<t.offset()[e.style])?0:100;a=a?0:z.length-1,m(z[a],b,!1)}var t,u,z,A=a(b),B=[-1,-1];if(A.hasClass(G[0]))throw Error("Slider was already initialized.");t=y(e,A),z=x(e,t),u=v(e,z),w(e.i,A,z),function(a){var b;if(!a.fixed)for(b=0;b<z.length;b++)n(F.start,z[b].children(),q,{b:[z[b]]});a.s&&n(F.start,t,r,{b:z}),a.extend&&(A.addClass(G[16]),a.s&&n(F.start,A,s,{b:z})),a.v&&(b=t.find("."+G[7]).addClass(G[10]),a.fixed&&(b=b.add(t.children().not(b).children())),n(F.start,b,q,{b:z}))}(e.n),b.vSet=function(){var b,g,h,i,j,m,n=Array.prototype.slice.call(arguments,0),o=c(n[0]);for("object"==typeof n[1]?(b=n[1].set,g=n[1].link,h=n[1].update,i=n[1].animate):!0===n[1]&&(b=!0),e.dir&&1<e.b&&o.reverse(),i&&d(A,G[14]),n=1<z.length?3:1,1===o.length&&(n=1),j=0;n>j;j++)i=g||u[j%2][0],i=i.A(o[j%2]),!1!==i&&(i=f(e,i),e.dir&&(i=100-i),!0!==l(z[j%2],i,!0)&&a(u[j%2]).each(function(a){return a?void this.write(m,z[j%2].children(),A,h):(m=this.u,!0)}));return!0===b&&k(["set"]),this},b.vGet=function(){var a,b=[];for(a=0;a<e.b;a++)b[a]=u[a][0].F;return 1===b.length?b[0]:e.dir?b.reverse():b},b.destroy=function(){return a.each(u,function(){a.each(this,function(){this.target&&this.target.off(".nui")})}),a(this).off(".nui").removeClass(G.join(" ")).empty(),i},A.val(e.start)}function A(a){if(!this.length)throw Error("noUiSlider: Can't initialize slider on empty selection.");var b=s(a,this);return this.each(function(){z(this,b,a)})}function B(b){return this.each(function(){var c=a(this).val(),d=this.destroy(),e=a.extend({},d,b);a(this).noUiSlider(e),d.start===e.start&&a(this).val(c)})}function C(){return this[0][arguments.length?"vSet":"vGet"].apply(this[0],arguments)}var D=a(document),E=a.fn.val,F=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},G="noUi-target noUi-base noUi-origin noUi-handle noUi-horizontal noUi-vertical noUi-background noUi-connect noUi-ltr noUi-rtl noUi-dragable  noUi-state-drag  noUi-state-tap noUi-active noUi-extended noUi-stacking".split(" ");a.fn.val=function(){var b=arguments,c=a(this[0]);return arguments.length?this.each(function(){(a(this).hasClass(G[0])?C:E).apply(a(this),b)}):(c.hasClass(G[0])?C:E).call(c)},a.noUiSlider={Link:a.Link},a.fn.noUiSlider=function(a,b){return(b?B:A).call(this,a)}}(window.jQuery||window.Zepto),function(a){a.Jcrop=function(b,c){function d(a){return Math.round(a)+"px"}function e(a){return J.baseClass+"-"+a}function f(){return a.fx.step.hasOwnProperty("backgroundColor")}function g(b){var c=a(b).offset();return[c.left,c.top]}function h(a){return[a.pageX-I[0],a.pageY-I[1]]}function i(b){"object"!=typeof b&&(b={}),J=a.extend(J,b),a.each(["onChange","onSelect","onRelease","onDblClick"],function(a,b){"function"!=typeof J[b]&&(J[b]=function(){})})}function j(a,b,c){if(I=g(R),oa.setCursor("move"===a?a:a+"-resize"),"move"===a)return oa.activateHandlers(l(b),q,c);var d=la.getFixed(),e=m(a),f=la.getCorner(m(e));la.setPressed(la.getCorner(e)),la.setCurrent(f),oa.activateHandlers(k(a,d),q,c)}function k(a,b){return function(c){if(J.aspectRatio)switch(a){case"e":c[1]=b.y+1;break;case"w":c[1]=b.y+1;break;case"n":c[0]=b.x+1;break;case"s":c[0]=b.x+1}else switch(a){case"e":c[1]=b.y2;break;case"w":c[1]=b.y2;break;case"n":c[0]=b.x2;break;case"s":c[0]=b.x2}la.setCurrent(c),na.update()}}function l(a){var b=a;return pa.watchKeys(),function(a){la.moveOffset([a[0]-b[0],a[1]-b[1]]),b=a,na.update()}}function m(a){switch(a){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function n(a){return function(b){return J.disabled?!1:"move"!==a||J.allowMove?(I=g(R),da=!0,j(a,h(b)),b.stopPropagation(),b.preventDefault(),!1):!1}}function o(a,b,c){var d=a.width(),e=a.height();d>b&&b>0&&(d=b,e=b/a.width()*a.height()),e>c&&c>0&&(e=c,d=c/a.height()*a.width()),ba=a.width()/d,ca=a.height()/e,a.width(d).height(e)}function p(a){return{x:a.x*ba,y:a.y*ca,x2:a.x2*ba,y2:a.y2*ca,w:a.w*ba,h:a.h*ca}}function q(a){var b=la.getFixed();b.w>J.minSelect[0]&&b.h>J.minSelect[1]?(na.enableHandles(),na.done()):na.release(),oa.setCursor(J.allowSelect?"crosshair":"default")}function r(a){if(J.disabled)return!1;if(!J.allowSelect)return!1;da=!0,I=g(R),na.disableHandles(),oa.setCursor("crosshair");var b=h(a);return la.setPressed(b),na.update(),oa.activateHandlers(s,q,"touch"===a.type.substring(0,5)),pa.watchKeys(),a.stopPropagation(),a.preventDefault(),!1}function s(a){la.setCurrent(a),na.update()}function t(){var b=a("<div></div>").addClass(e("tracker"));return L&&b.css({opacity:0,backgroundColor:"white"}),b}function u(a){U.removeClass().addClass(e("holder")).addClass(a)}function v(a,b){function c(){window.setTimeout(s,l)}var d=a[0]/ba,e=a[1]/ca,f=a[2]/ba,g=a[3]/ca;if(!ea){var h=la.flipCoords(d,e,f,g),i=la.getFixed(),j=[i.x,i.y,i.x2,i.y2],k=j,l=J.animationDelay,m=h[0]-j[0],n=h[1]-j[1],o=h[2]-j[2],p=h[3]-j[3],q=0,r=J.swingSpeed;d=k[0],e=k[1],f=k[2],g=k[3],na.animMode(!0);var s=function(){return function(){q+=(100-q)/r,k[0]=Math.round(d+q/100*m),k[1]=Math.round(e+q/100*n),k[2]=Math.round(f+q/100*o),k[3]=Math.round(g+q/100*p),q>=99.8&&(q=100),100>q?(x(k),c()):(na.done(),na.animMode(!1),"function"==typeof b&&b.call(qa))}}();c()}}function w(a){x([a[0]/ba,a[1]/ca,a[2]/ba,a[3]/ca]),J.onSelect.call(qa,p(la.getFixed())),na.enableHandles()}function x(a){la.setPressed([a[0],a[1]]),la.setCurrent([a[2],a[3]]),na.update()}function y(){return p(la.getFixed())}function z(){return la.getFixed()}function A(a){i(a),H()}function B(){J.disabled=!0,na.disableHandles(),na.setCursor("default"),oa.setCursor("default")}function C(){J.disabled=!1,H()}function D(){na.done(),oa.activateHandlers(null,null)}function E(){U.remove(),O.show(),O.css("visibility","visible"),a(b).removeData("Jcrop")}function F(a,b){na.release(),B();var c=new Image;c.onload=function(){var d=c.width,e=c.height,f=J.boxWidth,g=J.boxHeight;R.width(d).height(e),R.attr("src",a),V.attr("src",a),o(R,f,g),S=R.width(),T=R.height(),V.width(S).height(T),ha.width(S+2*ga).height(T+2*ga),U.width(S).height(T),ma.resize(S,T),C(),"function"==typeof b&&b.call(qa)},c.src=a}function G(a,b,c){var d=b||J.bgColor;J.bgFade&&f()&&J.fadeTime&&!c?a.animate({backgroundColor:d},{queue:!1,duration:J.fadeTime}):a.css("backgroundColor",d)}function H(a){J.allowResize?a?na.enableOnly():na.enableHandles():na.disableHandles(),oa.setCursor(J.allowSelect?"crosshair":"default"),na.setCursor(J.allowMove?"move":"default"),J.hasOwnProperty("trueSize")&&(ba=J.trueSize[0]/S,ca=J.trueSize[1]/T),J.hasOwnProperty("setSelect")&&(w(J.setSelect),na.done(),delete J.setSelect),ma.refresh(),J.bgColor!=ia&&(G(J.shade?ma.getShades():U,J.shade?J.shadeColor||J.bgColor:J.bgColor),ia=J.bgColor),ja!=J.bgOpacity&&(ja=J.bgOpacity,J.shade?ma.refresh():na.setBgOpacity(ja)),Z=J.maxSize[0]||0,$=J.maxSize[1]||0,_=J.minSize[0]||0,aa=J.minSize[1]||0,J.hasOwnProperty("outerImage")&&(R.attr("src",J.outerImage),delete J.outerImage),na.refresh()}var I,J=a.extend({},a.Jcrop.defaults),K=navigator.userAgent.toLowerCase(),L=/msie/.test(K),M=/msie [1-6]\./.test(K);"object"!=typeof b&&(b=a(b)[0]),"object"!=typeof c&&(c={}),i(c);var N={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},O=a(b),P=!0;if("IMG"==b.tagName){if(0!=O[0].width&&0!=O[0].height)O.width(O[0].width),O.height(O[0].height);else{var Q=new Image;Q.src=O[0].src,O.width(Q.width),O.height(Q.height)}var R=O.clone().removeAttr("id").css(N).show();R.width(O.width()),R.height(O.height()),O.after(R).hide()}else R=O.css(N).show(),P=!1,null===J.shade&&(J.shade=!0);o(R,J.boxWidth,J.boxHeight);var S=R.width(),T=R.height(),U=a("<div />").width(S).height(T).addClass(e("holder")).css({position:"relative",backgroundColor:J.bgColor}).insertAfter(O).append(R);J.addClass&&U.addClass(J.addClass);var V=a("<div />"),W=a("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),X=a("<div />").width("100%").height("100%").css("zIndex",320),Y=a("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=la.getFixed();J.onDblClick.call(qa,a)}).insertBefore(R).append(W,X);
P&&(V=a("<img />").attr("src",R.attr("src")).css(N).width(S).height(T),W.append(V)),M&&Y.css({overflowY:"hidden"});var Z,$,_,aa,ba,ca,da,ea,fa,ga=J.boundary,ha=t().width(S+2*ga).height(T+2*ga).css({position:"absolute",top:d(-ga),left:d(-ga),zIndex:290}).mousedown(r),ia=J.bgColor,ja=J.bgOpacity;I=g(R);var ka=function(){function a(){var a,b={},c=["touchstart","touchmove","touchend"],d=document.createElement("div");try{for(a=0;a<c.length;a++){var e=c[a];e="on"+e;var f=e in d;f||(d.setAttribute(e,"return;"),f="function"==typeof d[e]),b[c[a]]=f}return b.touchstart&&b.touchend&&b.touchmove}catch(g){return!1}}function b(){return J.touchSupport===!0||J.touchSupport===!1?J.touchSupport:a()}return{createDragger:function(a){return function(b){return J.disabled?!1:"move"!==a||J.allowMove?(I=g(R),da=!0,j(a,h(ka.cfilter(b)),!0),b.stopPropagation(),b.preventDefault(),!1):!1}},newSelection:function(a){return r(ka.cfilter(a))},cfilter:function(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,a},isSupported:a,support:b()}}(),la=function(){function a(a){a=g(a),o=m=a[0],p=n=a[1]}function b(a){a=g(a),k=a[0]-o,l=a[1]-p,o=a[0],p=a[1]}function c(){return[k,l]}function d(a){var b=a[0],c=a[1];0>m+b&&(b-=b+m),0>n+c&&(c-=c+n),p+c>T&&(c+=T-(p+c)),o+b>S&&(b+=S-(o+b)),m+=b,o+=b,n+=c,p+=c}function e(a){var b=f();switch(a){case"ne":return[b.x2,b.y];case"nw":return[b.x,b.y];case"se":return[b.x2,b.y2];case"sw":return[b.x,b.y2]}}function f(){if(!J.aspectRatio)return i();var a,b,c,d,e=J.aspectRatio,f=J.minSize[0]/ba,g=J.maxSize[0]/ba,k=J.maxSize[1]/ca,l=o-m,q=p-n,r=Math.abs(l),s=Math.abs(q),t=r/s;return 0===g&&(g=10*S),0===k&&(k=10*T),e>t?(b=p,c=s*e,a=0>l?m-c:c+m,0>a?(a=0,d=Math.abs((a-m)/e),b=0>q?n-d:d+n):a>S&&(a=S,d=Math.abs((a-m)/e),b=0>q?n-d:d+n)):(a=o,d=r/e,b=0>q?n-d:n+d,0>b?(b=0,c=Math.abs((b-n)*e),a=0>l?m-c:c+m):b>T&&(b=T,c=Math.abs(b-n)*e,a=0>l?m-c:c+m)),a>m?(f>a-m?a=m+f:a-m>g&&(a=m+g),b=b>n?n+(a-m)/e:n-(a-m)/e):m>a&&(f>m-a?a=m-f:m-a>g&&(a=m-g),b=b>n?n+(m-a)/e:n-(m-a)/e),0>a?(m-=a,a=0):a>S&&(m-=a-S,a=S),0>b?(n-=b,b=0):b>T&&(n-=b-T,b=T),j(h(m,n,a,b))}function g(a){return a[0]<0&&(a[0]=0),a[1]<0&&(a[1]=0),a[0]>S&&(a[0]=S),a[1]>T&&(a[1]=T),[Math.round(a[0]),Math.round(a[1])]}function h(a,b,c,d){var e=a,f=c,g=b,h=d;return a>c&&(e=c,f=a),b>d&&(g=d,h=b),[e,g,f,h]}function i(){var a,b=o-m,c=p-n;return Z&&Math.abs(b)>Z&&(o=b>0?m+Z:m-Z),$&&Math.abs(c)>$&&(p=c>0?n+$:n-$),aa/ca&&Math.abs(c)<aa/ca&&(p=c>0?n+aa/ca:n-aa/ca),_/ba&&Math.abs(b)<_/ba&&(o=b>0?m+_/ba:m-_/ba),0>m&&(o-=m,m-=m),0>n&&(p-=n,n-=n),0>o&&(m-=o,o-=o),0>p&&(n-=p,p-=p),o>S&&(a=o-S,m-=a,o-=a),p>T&&(a=p-T,n-=a,p-=a),m>S&&(a=m-T,p-=a,n-=a),n>T&&(a=n-T,p-=a,n-=a),j(h(m,n,o,p))}function j(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var k,l,m=0,n=0,o=0,p=0;return{flipCoords:h,setPressed:a,setCurrent:b,getOffset:c,moveOffset:d,getCorner:e,getFixed:f}}(),ma=function(){function b(a,b){o.left.css({height:d(b)}),o.right.css({height:d(b)})}function c(){return e(la.getFixed())}function e(a){o.top.css({left:d(a.x),width:d(a.w),height:d(a.y)}),o.bottom.css({top:d(a.y2),left:d(a.x),width:d(a.w),height:d(T-a.y2)}),o.right.css({left:d(a.x2),width:d(S-a.x2)}),o.left.css({width:d(a.x)})}function f(){return a("<div />").css({position:"absolute",backgroundColor:J.shadeColor||J.bgColor}).appendTo(n)}function g(){m||(m=!0,n.insertBefore(R),c(),na.setBgOpacity(1,0,1),V.hide(),h(J.shadeColor||J.bgColor,1),na.isAwake()?j(J.bgOpacity,1):j(1,1))}function h(a,b){G(l(),a,b)}function i(){m&&(n.remove(),V.show(),m=!1,na.isAwake()?na.setBgOpacity(J.bgOpacity,1,1):(na.setBgOpacity(1,1,1),na.disableHandles()),G(U,0,1))}function j(a,b){m&&(J.bgFade&&!b?n.animate({opacity:1-a},{queue:!1,duration:J.fadeTime}):n.css({opacity:1-a}))}function k(){J.shade?g():i(),na.isAwake()&&j(J.bgOpacity)}function l(){return n.children()}var m=!1,n=a("<div />").css({position:"absolute",zIndex:240,opacity:0}),o={top:f(),left:f().height(T),right:f().height(T),bottom:f()};return{update:c,updateRaw:e,getShades:l,setBgColor:h,enable:g,disable:i,resize:b,refresh:k,opacity:j}}(),na=function(){function b(b){var c=a("<div />").css({position:"absolute",opacity:J.borderOpacity}).addClass(e(b));return W.append(c),c}function c(b,c){var d=a("<div />").mousedown(n(b)).css({cursor:b+"-resize",position:"absolute",zIndex:c}).addClass("ord-"+b);return ka.support&&d.bind("touchstart.jcrop",ka.createDragger(b)),X.append(d),d}function f(a){var b=J.handleSize,d=c(a,B++).css({opacity:J.handleOpacity}).addClass(e("handle"));return b&&d.width(b).height(b),d}function g(a){return c(a,B++).addClass("jcrop-dragbar")}function h(a){var b;for(b=0;b<a.length;b++)E[a[b]]=g(a[b])}function i(a){var c,d;for(d=0;d<a.length;d++){switch(a[d]){case"n":c="hline";break;case"s":c="hline bottom";break;case"e":c="vline right";break;case"w":c="vline"}C[a[d]]=b(c)}}function j(a){var b;for(b=0;b<a.length;b++)D[a[b]]=f(a[b])}function k(a,b){J.shade||V.css({top:d(-b),left:d(-a)}),Y.css({top:d(b),left:d(a)})}function l(a,b){Y.width(Math.round(a)).height(Math.round(b))}function m(){var a=la.getFixed();la.setPressed([a.x,a.y]),la.setCurrent([a.x2,a.y2]),o()}function o(a){return A?q(a):void 0}function q(a){var b=la.getFixed();l(b.w,b.h),k(b.x,b.y),J.shade&&ma.updateRaw(b),A||s(),a?J.onSelect.call(qa,p(b)):J.onChange.call(qa,p(b))}function r(a,b,c){(A||b)&&(J.bgFade&&!c?R.animate({opacity:a},{queue:!1,duration:J.fadeTime}):R.css("opacity",a))}function s(){Y.show(),J.shade?ma.opacity(ja):r(ja,!0),A=!0}function u(){x(),Y.hide(),J.shade?ma.opacity(1):r(1),A=!1,J.onRelease.call(qa)}function v(){F&&X.show()}function w(){return F=!0,J.allowResize?(X.show(),!0):void 0}function x(){F=!1,X.hide()}function y(a){a?(ea=!0,x()):(ea=!1,w())}function z(){y(!1),m()}var A,B=370,C={},D={},E={},F=!1;J.dragEdges&&a.isArray(J.createDragbars)&&h(J.createDragbars),a.isArray(J.createHandles)&&j(J.createHandles),J.drawBorders&&a.isArray(J.createBorders)&&i(J.createBorders),a(document).bind("touchstart.jcrop-ios",function(b){a(b.currentTarget).hasClass("jcrop-tracker")&&b.stopPropagation()});var G=t().mousedown(n("move")).css({cursor:"move",position:"absolute",zIndex:360});return ka.support&&G.bind("touchstart.jcrop",ka.createDragger("move")),W.append(G),x(),{updateVisible:o,update:q,release:u,refresh:m,isAwake:function(){return A},setCursor:function(a){G.css("cursor",a)},enableHandles:w,enableOnly:function(){F=!0},showHandles:v,disableHandles:x,animMode:y,setBgOpacity:r,done:z}}(),oa=function(){function b(b){ha.css({zIndex:450}),b?a(document).bind("touchmove.jcrop",g).bind("touchend.jcrop",i):m&&a(document).bind("mousemove.jcrop",d).bind("mouseup.jcrop",e)}function c(){ha.css({zIndex:290}),a(document).unbind(".jcrop")}function d(a){return k(h(a)),!1}function e(a){return a.preventDefault(),a.stopPropagation(),da&&(da=!1,l(h(a)),na.isAwake()&&J.onSelect.call(qa,p(la.getFixed())),c(),k=function(){},l=function(){}),!1}function f(a,c,d){return da=!0,k=a,l=c,b(d),!1}function g(a){return k(h(ka.cfilter(a))),!1}function i(a){return e(ka.cfilter(a))}function j(a){ha.css("cursor",a)}var k=function(){},l=function(){},m=J.trackDocument;return m||ha.mousemove(d).mouseup(e).mouseout(e),R.before(ha),{activateHandlers:f,setCursor:j}}(),pa=function(){function b(){J.keySupport&&(f.show(),f.focus())}function c(a){f.hide()}function d(a,b,c){J.allowMove&&(la.moveOffset([b,c]),na.updateVisible(!0)),a.preventDefault(),a.stopPropagation()}function e(a){if(a.ctrlKey||a.metaKey)return!0;fa=a.shiftKey?!0:!1;var b=fa?10:1;switch(a.keyCode){case 37:d(a,-b,0);break;case 39:d(a,b,0);break;case 38:d(a,0,-b);break;case 40:d(a,0,b);break;case 27:J.allowSelect&&na.release();break;case 9:return!0}return!1}var f=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),g=a("<div />").css({position:"absolute",overflow:"hidden"}).append(f);return J.keySupport&&(f.keydown(e).blur(c),M||!J.fixedSupport?(f.css({position:"absolute",left:"-20px"}),g.append(f).insertBefore(R)):f.insertBefore(R)),{watchKeys:b}}();ka.support&&ha.bind("touchstart.jcrop",ka.newSelection),X.hide(),H(!0);var qa={setImage:F,animateTo:v,setSelect:w,setOptions:A,tellSelect:y,tellScaled:z,setClass:u,disable:B,enable:C,cancel:D,release:na.release,destroy:E,focus:pa.watchKeys,getBounds:function(){return[S*ba,T*ca]},getWidgetSize:function(){return[S,T]},getScaleFactor:function(){return[ba,ca]},getOptions:function(){return J},ui:{holder:U,selection:Y}};return L&&U.bind("selectstart",function(){return!1}),O.data("Jcrop",qa),qa},a.fn.Jcrop=function(b,c){var d;return this.each(function(){if(a(this).data("Jcrop")){if("api"===b)return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b)}else"IMG"==this.tagName?a.Jcrop.Loader(this,function(){a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&c.call(d)}):(a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&c.call(d))}),this},a.Jcrop.Loader=function(b,c,d){function e(){g.complete?(f.unbind(".jcloader"),a.isFunction(c)&&c.call(g)):window.setTimeout(e,50)}var f=a(b),g=f[0];f.bind("load.jcloader",e).bind("error.jcloader",function(b){f.unbind(".jcloader"),a.isFunction(d)&&d.call(g)}),g.complete&&a.isFunction(c)&&(f.unbind(".jcloader"),c.call(g))},a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery),function(a){"use strict";var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c=a.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),d=c&&a.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(a){return!1}}(),e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=(c||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,f,g,h,i,j;for(b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]),f=new ArrayBuffer(b.length),g=new Uint8Array(f),h=0;h<b.length;h+=1)g[h]=b.charCodeAt(h);return i=a.split(",")[0].split(":")[1].split(";")[0],c?new Blob([d?g:f],{type:i}):(j=new e,j.append(f),j.getBlob(i))};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,c,d){a(d&&b.toDataURL&&f?f(this.toDataURL(c,d)):this.mozGetAsFile("blob",c))}:b.toDataURL&&f&&(b.toBlob=function(a,b,c){a(f(this.toDataURL(b,c)))})),"function"==typeof define&&define.amd?define(function(){return f}):a.dataURLtoBlob=f}(this),function(){"use strict";try{window.optimizely=optimizely||[]}catch(a){window.optimizely=[]}window.IS={Templates:{},Collections:{},Models:{Mixins:{}},Views:{Mixins:{}},Routers:{Mixins:{}},CONS:{},subs:{},inlineTemplates:{},helpers:{},logger:{},et:{},vent:_.clone(Backbone.Events),cm:{},currentUser:null,_bootstrappedData:{},start:function(a){if(a=a||{},this._setupLogger(),this._setupBackboneSync(),IS.cm.initialize(),window.bodyView=new IS.Views.Body,!a["static"]&&this._checkBrowserCompatibility()){IS.currentUser&&IS.currentUser.logAccountStatus(),IS.currentUser&&IS.currentUser.loadSystemMessages(),a.bootstrapped=a.bootstrapped||{},window.IS._bootstrappedData=a.bootstrapped,IS.CONS.MOBILE_DEVICE?new IS.Routers.Mobile({bootstrapped:a.bootstrapped}):new IS.Routers.Main({bootstrapped:a.bootstrapped});var b=!0,c=!!(b&&window.history&&window.history.pushState);Backbone.history.start({pushState:c,hashChange:c}),this._setupLinks()}},_checkBrowserCompatibility:function(){var a=!0;if("upload"in new XMLHttpRequest||(a=!1),"FormData"in window||(a=!1),Modernizr.history||(a=!1),!a&&!IS.CONS.MOBILE_DEVICE){var b=new IS.Views.BrowserUpgrade;$("body").append(b.render().el)}return a},_setupLogger:function(){IS.vent.on("all",function(){var a=_.toArray(arguments),b=["body:clicked","body:keyup:shift","body:keydown:shift","body:keyup:escape"];if(!_.contains(b,a[0])){var c=["[Vent] Fired: "+a[0]];_.each(a.slice(1),function(a){c.push(a)}),IS.logger.log.apply(IS.logger,c)}})},_setupBackboneSync:function(){var a=Backbone.sync,b=this;Backbone.sync=function(c,d,e){return e=e||{},e.beforeSend=function(a,d){if("read"==c)b.currentUser&&(d.url+=(-1==d.url.indexOf("?")?"?":"&")+$.param({auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY})),d.url+=(-1==d.url.indexOf("?")?"?":"&")+"ts="+(new Date).getTime();else if(!d.directSend){d.data?d.data=JSON.parse(d.data):d.data={};var e;e=b.currentUser?_.extend(d.data,{auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY}):d.data,d.data=JSON.stringify(e)}},e.contentType="application/json",a.call(this,c,d,e)}},_setupLinks:function(){$(document).on("click","a[href]:not([data-bypass])",function(a){var b={prop:$(this).prop("href"),attr:$(this).attr("href")},c=location.protocol+"//"+location.host+"/";b.prop.slice(0,c.length)===c&&(a.preventDefault(),Backbone.history.navigate(b.attr,!0))})}}}(),this.IS=this.IS||{},this.IS.templates=this.IS.templates||{},this.IS.templates.activity_item=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d,e="";return e+='\n        <div class="images clearfix">\n            ',c=a.imgs,d=typeof c===m?c.apply(a):c,(d||0===d)&&(e+=d),e+="\n        </div>\n    "}function g(a,b){var c,d,e="";return e+='\n    <div class="avatar">\n        ',c=a.hasAvatar,c=typeof c===m?c.apply(a):c,d=p.call(a,c,{hash:{},inverse:o.noop,fn:o.program(4,h,b),data:b}),(d||0===d)&&(e+=d),e+="\n        ",c=a.hasAvatar,c=typeof c===m?c.apply(a):c,d=p.call(a,c,{hash:{},inverse:o.program(6,i,b),fn:o.noop,data:b}),(d||0===d)&&(e+=d),e+="\n    </div>\n"}function h(a,b){var c,d="";return d+='\n            <img src="'+n((c=a.imageUrl,typeof c===m?c.apply(a):c))+'" onerror="this.parentNode.removeChild(this)" />\n        '}function i(a,b){return'\n            <img src="/v2_images/default_avatar_activity.jpg" />\n        '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j,k,l="",m="function",n=this.escapeExpression,o=this,p=c.blockHelperMissing;return l+='<div class="left">\n    <div class="msg">',j=b.text,k=typeof j===m?j.apply(b):j,(k||0===k)&&(l+=k),l+="</div>\n    ",j=b.hasManyImgs,j=typeof j===m?j.apply(b):j,k=p.call(b,j,{hash:{},inverse:o.noop,fn:o.program(1,f,e),data:e}),(k||0===k)&&(l+=k),l+='\n    <div class="time">'+n((j=b.time,typeof j===m?j.apply(b):j))+"</div>\n</div>\n",j=b.hasManyImgs,j=typeof j===m?j.apply(b):j,k=p.call(b,j,{hash:{},inverse:o.program(3,g,e),fn:o.noop,data:e}),(k||0===k)&&(l+=k),l}),this.IS.templates.ad=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+="<div id='"+i((f=b.code,typeof f===h?f.apply(b):f))+"' style='width:"+i((f=b.width,typeof f===h?f.apply(b):f))+"px; height:"+i((f=b.height,typeof f===h?f.apply(b):f))+"px;'>\n    <script type='text/javascript'>\n        googletag.cmd.push(function(){googletag.display('"+i((f=b.code,typeof f===h?f.apply(b):f))+"');});\n    </script>\n</div>"}),this.IS.templates.app_layout_tip=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="icon-close"></div>\n<header>\n    <h1>'+i((f=b.title,typeof f===h?f.apply(b):f))+"</h1>\n</header>\n<p>"+i((f=b.msg,typeof f===h?f.apply(b):f))+'</p>\n<div class="button">'+i((f=b.buttonText,typeof f===h?f.apply(b):f))+"</div>\n"}),this.IS.templates.browser_upgrade=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div class="browser-upgrade">\n    <figure class="logo"></figure>\n    <section class="centered">\n        <h1>Oops! Your browser isn\'t supported.</h1>\n        <p>Please upgrade your browser or use one of the recommended ones below.</p>\n        <section class="browsers">\n            <a href="https://www.google.com/intl/en/chrome/browser/"><img src="/v2_images/chrome_256x256.png" title="Chrome" class="chrome" /></a>\n            <a href="http://www.mozilla.org/en-US/firefox/new/"><img src="/v2_images/firefox_256x256.png" title="Firefox" class="firefox" /></a>\n            <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie"><img src="/v2_images/internet-explorer_256x256.png" title="Internet Explorer" class="ie" /></a>\n        </section>\n    </section>\n</div>'}),this.IS.templates.credit_card_form=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d,e="";return e+="\n    <header>\n        <h1>"+t((c=a.short_desc,typeof c===s?c.apply(a):c))+"</h1>\n        ",c=a.hasPaypal,c=typeof c===s?c.apply(a):c,d=v.call(a,c,{hash:{},inverse:u.noop,fn:u.program(2,g,b),data:b}),(d||0===d)&&(e+=d),e+="\n    </header>\n"}function g(a,b){var c,d="";return d+='\n            <div class="paypal">\n                <form action="https://www.paypal.com/cgi-bin/webscr" method="post">\n                    <input type="hidden" name="cmd" value="_s-xclick">\n                    <input type="hidden" name="hosted_button_id" value="'+t((c=a.paypal_id,typeof c===s?c.apply(a):c))+'">\n                    <input type="hidden" name="item_name" value="'+t((c=a.desc,typeof c===s?c.apply(a):c))+'">\n                    <input type="hidden" name="item_number" value="'+t((c=a.type,typeof c===s?c.apply(a):c))+'">\n                    <input type="hidden" name="invoice" value="'+t((c=a.paypalInvoice,typeof c===s?c.apply(a):c))+'">\n                    <input type="hidden" name="no_shipping" value="1">\n                    <input type="hidden" name="no_note" value="1">\n                    <input type="hidden" name="currency_code" value="USD">\n                    <input type="hidden" name="lc" value="US">\n                    <input type="hidden" name="notify_url" value="http://imageshack.us/paypal/notify.php">\n                    <button type="submit"><span>Pay using</span><img src="/v2_images/paypal.jpg" alt="PayPal"></button>\n                </form>\n            </div>\n        '}function h(a,b){return"Update"}function i(a,b){return"Enter"}function j(a,b){var c,d="";return d+='\n            <input type="hidden" name="transaction_id" value="'+t((c=a.transaction_id,typeof c===s?c.apply(a):c))+'">\n            <input type="hidden" name="payment_method" value="'+t((c=a.payment_method,typeof c===s?c.apply(a):c))+'">\n            <input type="hidden" name="sub_id" value="'+t((c=a.id,typeof c===s?c.apply(a):c))+'">\n        '}function k(a,b){var c,d,e="";return e+='\n            <input type="hidden" value="F6436rQzTEd649eA" name="vendor_id">\n            <input type="hidden" value="ImageShack" name="mername">\n            <input type="hidden" value="https://imageshack.com/" name="home_page">\n            <input type="hidden" value="https://imageshack.us/itransact/paymentReceived.php" name="ret_addr">\n            <input type="hidden" value="1" name="show_items">\n            <input type="hidden" value="1" name="acceptcards">\n            <input type="hidden" value="itemNumber" name="passback">\n            <input type="hidden" value="userId" name="passback">\n            <input type="hidden" value="summary" name="passback">\n            <input type="hidden" value="xid" name="lookup">\n            <input type="hidden" value="email" name="lookup">\n            <input type="hidden" value="1" name="showcvv">\n            <input type="hidden" value="'+t((c=a.user_id,typeof c===s?c.apply(a):c))+'" name="cust_id">\n            <input type="hidden" value="'+t((c=a.user_id,typeof c===s?c.apply(a):c))+'" name="userId">\n            <input type="hidden" value="'+t((c=a.user_email,typeof c===s?c.apply(a):c))+'" name="email">\n            <input type="hidden" value="'+t((c=a.desc,typeof c===s?c.apply(a):c))+'" name="1_desc">\n            <input type="hidden" value="'+t((c=a.cost,typeof c===s?c.apply(a):c))+'" name="1_cost">\n            <input type="hidden" value="1" name="1_qty">\n            <input type="hidden" value="'+t((c=a.type,typeof c===s?c.apply(a):c))+'" name="itemNumber">\n            <input type="hidden" value="'+t((c=a.desc,typeof c===s?c.apply(a):c))+'" name="summary">\n            <input type="hidden" value="post" name="ret_mode">\n            ',c=a.isRecurring,c=typeof c===s?c.apply(a):c,d=v.call(a,c,{hash:{},inverse:u.noop,fn:u.program(11,l,b),data:b}),(d||0===d)&&(e+=d),e+="\n        "}function l(a,b){var c,d="";return d+='\n                <input type="hidden" value="'+t((c=a.recipe,typeof c===s?c.apply(a):c))+'" name="recur_recipe">\n                <input type="hidden" value="'+t((c=a.reps,typeof c===s?c.apply(a):c))+'" name="recur_reps">\n            '}function m(a,b){var c,d="";return d+='\n        <div class="details">\n            <div class="clearfix">\n                <h3>'+t((c=a.desc,typeof c===s?c.apply(a):c))+"</h3>\n                <p>$"+t((c=a.prettyCost,typeof c===s?c.apply(a):c))+'</p>\n            </div>\n            <p class="total">TOTAL: $'+t((c=a.prettyCost,typeof c===s?c.apply(a):c))+"</p>\n        </div>\n    "}function n(a,b){return"SAVE"}function o(a,b){return"CONFIRM PAYMENT"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var p,q,r="",s="function",t=this.escapeExpression,u=this,v=c.blockHelperMissing;return p=b.updateMode,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.program(1,f,e),fn:u.noop,data:e}),(q||0===q)&&(r+=q),r+="\n\n<h1>",p=b.updateMode,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(4,h,e),data:e}),(q||0===q)&&(r+=q),p=b.updateMode,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.program(6,i,e),fn:u.noop,data:e}),(q||0===q)&&(r+=q),r+=' Credit Card:</h1>\n<form method="post" action="'+t((p=b.formAction,typeof p===s?p.apply(b):p))+'" class="cc">\n    <div class="clearfix inputs">\n        <article class="left">\n            <div class="cc-input">\n                <input tabindex="900" type="text" autofocus value="" placeholder="ADDRESS" name="address" autocomplete="on">\n            </div>\n            <div class="cc-input">\n                <input tabindex="901" type="text" value="" placeholder="CITY" name="city" autocomplete="on">\n            </div>\n            <div class="cc-input dd-parent country">\n                <input tabindex="-1" type="text" value="" placeholder="SELECT COUNTRY" id="cc-country" autocomplete="on" disabled>\n                <div class="country-dd">\n                    <select tabindex="902" name="country"></select>\n                </div>\n            </div>\n            <div class="clearfix dd-parent state cc-input">\n                <input tabindex="-1" type="text" value="" maxlength="2" placeholder="SELECT STATE" id="cc-state" disabled>\n                <input tabindex="-1" type="text" value="" name="" placeholder="Province / Region" id="cc-province">\n                <input tabindex="904" type="text" value="" maxlength="10" placeholder="ZIP CODE" name="zip" id="cc-zip" autocomplete="on">\n                <div class="states-dd">\n                    <select tabindex="903" name="state"></select>\n                </div>\n            </div>\n            <div class="cc-input mt">\n                <input tabindex="905" type="text" value="" placeholder="PHONE: XXX-XXX-XXXX" name="phone" autocomplete="on">\n            </div>\n        </article>\n        <article class="right" style="width: 350px">\n            <div class="cc-input">\n                <input tabindex="906" type="text" value="" placeholder="CARD NUMBER" name="ccnum" autocomplete="off">\n            </div>\n            <div class="cc-input">\n                <input tabindex="907" type="text" value="" placeholder="FIRST NAME" name="first_name" autocomplete="on">\n            </div>\n            <div class="cc-input">\n                <input tabindex="908" type="text" value="" placeholder="LAST NAME" name="last_name" autocomplete="on">\n            </div>\n            <div class="clearfix cc-input">\n                <label for="cc-month">EXPIRATION DATE</label>\n                <input tabindex="909" type="text" value="" placeholder="XX" name="ccmo" id="cc-month" autocomplete="off" onblur="if(!isNaN(this.value) && +this.value < 10 && this.value.length == 1) { this.value = \'0\' + this.value; }">\n                <input tabindex="910" type="text" value="" placeholder="XXXX" name="ccyr" id="cc-year" autocomplete="off">\n            </div>\n            <div class="clearfix mt cc-input">\n                <label for="cc-code">SECURITY CODE</label>\n                <input tabindex="911" type="text" value="" maxlength="4" placeholder="XXX" name="cvv2_number" id="cc-code" autocomplete="off">\n            </div>\n        </article>\n        <input type="submit" value="submit">\n        ',p=b.updateMode,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(8,j,e),data:e}),(q||0===q)&&(r+=q),r+="\n        ",p=b.updateMode,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.program(10,k,e),fn:u.noop,data:e}),(q||0===q)&&(r+=q),r+="\n    </div>\n    ",p=b.updateMode,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.program(13,m,e),fn:u.noop,data:e}),(q||0===q)&&(r+=q),r+='\n    <div class="clearfix buttons">\n        <p class="enc">Secured with 256-bit encryption</p>\n        <!--<a class="button-large-yellow no-user-select rounded">',p=b.updateMode,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(15,n,e),data:e}),(q||0===q)&&(r+=q),p=b.updateMode,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.program(17,o,e),fn:u.noop,data:e}),(q||0===q)&&(r+=q),r+='</a>-->\n        <input type="submit" value="CONFIRM PAYMENT" id="confirm-pmt" class="button-large-yellow no-user-select rounded">\n        <a class="button-large-white no-user-select rounded">CANCEL</a>\n    </div>\n</form>\n'}),this.IS.templates.discover_category=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='<article class="category" data-type="'+n((c=a.class_name,typeof c===m?c.apply(a):c))+'">'}function g(a,b){return"left-arrow"}function h(a,b){return"right-arrow"}function i(a,b){return"</article>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j,k,l="",m="function",n=this.escapeExpression,o=this,p=c.blockHelperMissing;return j=b._backend,j=typeof j===m?j.apply(b):j,k=p.call(b,j,{hash:{},inverse:o.noop,fn:o.program(1,f,e),data:e}),(k||0===k)&&(l+=k),l+='\n    <h1 class="title">'+n((j=b.category,typeof j===m?j.apply(b):j))+'</h1>\n    <div class="wrapper ',j=b.left_arrow,j=typeof j===m?j.apply(b):j,k=p.call(b,j,{hash:{},inverse:o.noop,fn:o.program(3,g,e),data:e}),(k||0===k)&&(l+=k),l+=" ",j=b.right_arrow,j=typeof j===m?j.apply(b):j,k=p.call(b,j,{hash:{},inverse:o.noop,fn:o.program(5,h,e),data:e}),(k||0===k)&&(l+=k),l+='">\n        <div class="images" style="width: '+n((j=b.width,typeof j===m?j.apply(b):j))+'px;">\n            '+n((j=b.hero,typeof j===m?j.apply(b):j))+'\n            <div class="row top">'+n((j=b.top_row,typeof j===m?j.apply(b):j))+'</div>\n            <div class="row bottom">'+n((j=b.bottom_row,typeof j===m?j.apply(b):j))+'</div>\n        </div>\n        <a class="arrow right">\n            <span class="icon"></span>\n        </a>\n        <span class="bg right"></span>\n        <a class="arrow left">\n            <span class="icon"></span>\n        </a>\n        <span class="bg left"></span>\n    </div>\n',j=b._backend,j=typeof j===m?j.apply(b):j,k=p.call(b,j,{hash:{},inverse:o.noop,fn:o.program(7,i,e),data:e}),(k||0===k)&&(l+=k),l}),this.IS.templates.discover_category_photo=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d,e="";return e+='<a class="',c=a.hero,c=typeof c===m?c.apply(a):c,d=o.call(a,c,{hash:{},inverse:n.noop,fn:n.program(2,g,b),data:b}),(d||0===d)&&(e+=d),c=a.hero,c=typeof c===m?c.apply(a):c,d=o.call(a,c,{hash:{},inverse:n.program(4,h,b),fn:n.noop,data:b}),(d||0===d)&&(e+=d),e+='" href="/i/'+p((c=a.id,typeof c===m?c.apply(a):c))+'">'}function g(a,b){return"hero"}function h(a,b){return"photo"}function i(a,b){return"</a>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j,k,l="",m="function",n=this,o=c.blockHelperMissing,p=this.escapeExpression;return j=b._backend,j=typeof j===m?j.apply(b):j,k=o.call(b,j,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(k||0===k)&&(l+=k),l+='\n    <img class="pending" src="/v2_images/empty.png">\n',j=b._backend,j=typeof j===m?j.apply(b):j,k=o.call(b,j,{hash:{},inverse:n.noop,fn:n.program(6,i,e),data:e}),(k||0===k)&&(l+=k),l}),this.IS.templates.featured=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<section id="featured">'}function g(a,b){return"</section>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing;return h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <div class="wrapper clearfix">\n        <section class="result"></section>\n        <aside class="more">\n            <div class="top">\n                <section class="widget-area">\n                    <h1>DISCOVER MORE IMAGES</h1>\n                </section>\n                <footer>\n                    <h3>Want to be featured on ImageShack?</h3>\n                    <a href="/contact/customer_service?option=featured" data-bypass="true" class="button-large-black rounded">APPLY HERE</a>\n                </footer>\n            </div>\n            <div class="bottom"></div>\n        </aside>\n    </div>\n',h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+="\n"}),this.IS.templates.features_overlay=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<h1>Unlock These Features</h1>\n<h2>Upgrade to a premium account to enjoy all of these benefits and more.</h2>\n<article class="features">\n    <ul>\n        <li><span>Image stats</span></li>\n        <li><span>Direct linking</span></li>\n        <li><span>Unlimited space</span></li>\n    </ul>\n    <ul>\n        <li><span>Dynamic image resizer</span></li>\n        <li><span>Dedicated support</span></li>\n        <li><span>Sharing</span></li>\n    </ul>\n</article>\n<article class="buttons">\n    <a class="button-large-white rounded close-trigger">CANCEL</a>\n    <a class="button-large-yellow rounded upgrade-trigger">'+i((f=b.verb,typeof f===h?f.apply(b):f))+"</a>\n</article>"}),this.IS.templates.feed_no_results=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<section class="regular">\n    <h1>You don\'t have any images.</h1>\n    <p></p>\n</section>\n<section class="my-images">\n    <h1>Upload your first images.</h1>\n    <p>Just click the add images icon.</p>\n</section>\n'}),this.IS.templates.feed_photo=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='\n    <div class="username">'+k((c=a.owner,typeof c===j?c.apply(a):c))+"</div>\n"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this,m=c.blockHelperMissing;return i+='<img src="'+k((g=b.hero,typeof g===j?g.apply(b):g))+'" onerror="this.src=\'/v2_images/empty.png\'" />\n<div class="title">'+k((g=b.title,typeof g===j?g.apply(b):g))+"</div>\n",g=b.showOwner,g=typeof g===j?g.apply(b):g,h=m.call(b,g,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),
(h||0===h)&&(i+=h),i+="\n"}),this.IS.templates.feedback=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<h1>Submit Your Feedback</h1>\n<p>We would love to hear from you about what you think of the new ImageShack.</p>\n<textarea autofocus="true" placeholder="Add comment..."></textarea>\n<input type="text" name="email" placeholder="Add email if you would like us to help you..." value="" autocomplete="on">\n<a class="button"><span></span></a>\n'}),this.IS.templates.file_uploader=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'\n                    <div class="selected-label initial" data-value="web">HTML</div>\n                    '}function g(a,b){return'\n                    <div class="selected-label initial" data-value="direct">Direct</div>\n                    '}function h(a,b){return'\n                    <div class="selected-label initial" data-value="150x100">150 x 100 (thumbnail)</div>\n                    '}function i(a,b){return'\n                    <div class="selected-label initial" data-value="">Fullsize</div>\n                    '}function j(a,b){return"ALBUM"}function k(a,b){return"IMAGES"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var l,m,n="",o="function",p=this.escapeExpression,q=this,r=c.blockHelperMissing;return n+='<section class="top-part">\n    <article class="clearfix options">\n        <div data-tab="regular" class="rounded option active browse">\n            <h3>BROWSE &amp; UPLOAD</h3>\n            <form class="uploader" enctype="multipart/form-data" method="post" action="/rest_api/v2/images">\n                <input class="file" name="file" type="file" multiple="" accept="image/*">\n            </form>\n        </div>\n        <a data-tab="url" class="rounded option url">USE URL</a>\n        <div class="clearfix rounded album-list">\n            <h3 class="drop-label padded">UPLOAD TO</h3>\n            <div class="left-border albums">\n                <div class="dropdown">\n                    <div class="selected-label initial" data-value="">My Images</div>\n                    <div class="arrow"></div>\n                    <div class="selection">\n                        <div class="item prevent-click" data-value="">Select One</div>\n                        <div class="item" data-value="">My Images</div>\n                        <div class="item prevent-click album-selector" data-value="">\n                            My Albums\n                            <div class="albums-list">\n                                <div class="rounded wrapper">\n                                    <a class="prevent-click add-new-album">Add New Album</a>\n                                    <ul class="list"></ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="clearfix rounded resize-list">\n            <h3 class="drop-label padded">RESIZE TO</h3>\n            <div class="left-border resize">\n                <div class="dropdown">\n                    <div class="selected-label initial" data-value="">Do not resize</div>\n                    <div class="arrow"></div>\n                    <div class="selection">\n                        <div class="item prevent-click" data-value="">Select One</div>\n                        <div class="item" data-value="">Do not resize</div>\n                        <div class="item" data-value="100x75">100 x 75 (avatar)</div>\n                        <div class="item" data-value="150x100">150 x 100 (thumbnail)</div>\n                        <div class="item" data-value="280x200">280 x 200 (thumbnail)</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="320x240">320 x 240 (small)</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="640x480">640 x 480 (medium)</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="800x600">800 x 600</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="1024x768">1024 x 768 (large)</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="1280x1024">1280 x 1024</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="1600x1200">1600 x 1200</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </article>\n    <article class="rounded tabs inactive">\n        <section class="tab regular">\n            <div class="clearfix progress-text">\n                <div class="status"></div>\n                <a class="cancel-upload">CANCEL UPLOAD</a>\n                <div class="uploaded-size"></div>\n            </div>\n            <div class="progress-bar"><span></span></div>\n        </section>\n        <section class="clearfix tab url">\n            <input type="text" name="url" class="trans" value="" autocomplete="off" placeholder="Paste your URL here and hit enter...">\n            <a class="button-large-black rounded">UPLOAD</a>\n        </section>\n    </article>\n    <article class="clearfix controls">\n        <div class="clearfix control rounded link-type">\n            <h3 class="drop-label padded">SELECT TYPE</h3>\n            <div class="left-border types">\n                <div class="dropdown">\n                    ',l=b.freeAccount,l=typeof l===o?l.apply(b):l,m=r.call(b,l,{hash:{},inverse:q.noop,fn:q.program(1,f,e),data:e}),(m||0===m)&&(n+=m),n+="\n                    ",l=b.freeAccount,l=typeof l===o?l.apply(b):l,m=r.call(b,l,{hash:{},inverse:q.program(3,g,e),fn:q.noop,data:e}),(m||0===m)&&(n+=m),n+='\n                    <div class="arrow"></div>\n                    <div class="selection">\n                        <div class="item prevent-click" data-value="">Select One</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="direct">Direct</div>\n                        <div class="item" data-value="forum">Forum</div>\n                        <div class="item" data-value="alt-forum">Alt Forum</div>\n                        <div class="item" data-value="web">HTML</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="clearfix control rounded link-sizes">\n            <h3 class="drop-label padded">SELECT SIZE</h3>\n            <div class="left-border sizes">\n                <div class="dropdown sizes-dd">\n                    ',l=b.freeAccount,l=typeof l===o?l.apply(b):l,m=r.call(b,l,{hash:{},inverse:q.noop,fn:q.program(5,h,e),data:e}),(m||0===m)&&(n+=m),n+="\n                    ",l=b.freeAccount,l=typeof l===o?l.apply(b):l,m=r.call(b,l,{hash:{},inverse:q.program(7,i,e),fn:q.noop,data:e}),(m||0===m)&&(n+=m),n+='\n                    <div class="arrow"></div>\n                    <div class="selection">\n                        <div class="item prevent-click" data-value="">Select One</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="">Fullsize</div>\n                        <div class="item" data-value="100x75">100 x 75 (avatar)</div>\n                        <div class="item" data-value="150x100">150 x 100 (thumbnail)</div>\n                        <div class="item" data-value="280x200">280 x 200 (thumbnail)</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="320x240">320 x 240 (small)</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="640x480">640 x 480 (medium)</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="800x600">800 x 600</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="1024x768">1024 x 768 (large)</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="1280x1024">1280 x 1024</div>\n                        <div class="item '+p((l=b.otherClass,typeof l===o?l.apply(b):l))+'" data-value="1600x1200">1600 x 1200</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="rounded control select-text all">\n            <h3 class="drop-label padded">SELECT ALL</h3>\n        </div>\n    </article>\n    <article class="rounded result-links">\n        <textarea autofocus="off" readonly="true"></textarea>\n    </article>\n</section>\n<section class="bottom-part">\n    <h2>UPLOADED IMAGES</h2>\n    <h3>Select the images you wish to move into an album.</h3>\n    <article class="rounded thumbnails">\n        <div class="wrapper">\n            <figure class="clearfix"></figure>\n        </div>\n        <a class="arrow left"><span><figure></figure></span></a>\n        <a class="arrow right"><span><figure></figure></span></a>\n    </article>\n    <article class="clearfix buttons options">\n        <div class="clearfix rounded album-list">\n            <h3 class="drop-label padded">MOVE TO</h3>\n            <div class="left-border albums">\n                <div class="dropdown">\n                    <div class="selected-label initial" data-value="">Select One</div>\n                    <div class="arrow"></div>\n                    <div class="selection">\n                        <div class="item prevent-click" data-value="">Select One</div>\n                        <div class="item prevent-click album-selector" data-value="">\n                            My Albums\n                            <div class="move-albums-list">\n                                <div class="rounded wrapper">\n                                    <a class="prevent-click add-new-album moving">Add New Album</a>\n                                    <ul class="list"></ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <a class="rounded done icon-close"></a>\n        <a class="rounded link">\n            GO TO MY ',l=b.inActiveAlbum,l=typeof l===o?l.apply(b):l,m=r.call(b,l,{hash:{},inverse:q.noop,fn:q.program(9,j,e),data:e}),(m||0===m)&&(n+=m),l=b.inActiveAlbum,l=typeof l===o?l.apply(b):l,m=r.call(b,l,{hash:{},inverse:q.program(11,k,e),fn:q.noop,data:e}),(m||0===m)&&(n+=m),n+="\n        </a>\n    </article>\n</section>"}),this.IS.templates.follow_parent=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<section class="follow-parent faded">'}function g(a,b){return"</section>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing;return h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <div class="wrapper">\n        <div class="clearfix columns">\n            <section class="column left">',h=b.leftHtml,i=typeof h===k?h.apply(b):h,(i||0===i)&&(j+=i),j+='</section>\n            <section class="column right">',h=b.rightHtml,i=typeof h===k?h.apply(b):h,(i||0===i)&&(j+=i),j+='</section>\n        </div>\n        <div class="loading">LOADING MORE...</div>\n    </div>\n',h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j}),this.IS.templates.follow_person=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<article class="clearfix person">'}function g(a,b){return"premium-badge"}function h(a,b){var c,d="";return d+='\n            <div class="location">'+q((c=a.location,typeof c===p?c.apply(a):c))+"</div>\n        "}function i(a,b){var c,d,e="";return e+='\n            <a data-force-login="true" class="fading-button follow-button ',c=a.isFollowed,c=typeof c===p?c.apply(a):c,d=s.call(a,c,{hash:{},inverse:r.noop,fn:r.program(8,j,b),data:b}),(d||0===d)&&(e+=d),e+='" data-following="'+q((c=a.followValue,typeof c===p?c.apply(a):c))+'">\n                <span class="front">FOLLOW</span>\n                <span class="back">UNFOLLOW</span>\n            </a>\n        '}function j(a,b){return"on"}function k(a,b){var c,d,e="";return e+='\n        <aside class="clearfix images">',c=a.imagesHTML,d=typeof c===p?c.apply(a):c,(d||0===d)&&(e+=d),e+="</aside>\n    "}function l(a,b){return"</article>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var m,n,o="",p="function",q=this.escapeExpression,r=this,s=c.blockHelperMissing;return m=b._backend,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.noop,fn:r.program(1,f,e),data:e}),(n||0===n)&&(o+=n),o+='\n    <a class="avatar" href="/user/'+q((m=b.username,typeof m===p?m.apply(b):m))+'">\n        <img src="'+q((m=b.avatarUrl,typeof m===p?m.apply(b):m))+'" onerror="this.src=\'/v2_images/default_avatar_70x70.jpg\';">\n    </a>\n    <div class="info '+q((m=b.infoAreaClass,typeof m===p?m.apply(b):m))+'">\n        <h3 class="profile-link ',m=b.showPremiumBadge,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.noop,fn:r.program(3,g,e),data:e}),(n||0===n)&&(o+=n),o+='">\n            <a href="/user/'+q((m=b.username,typeof m===p?m.apply(b):m))+'">'+q((m=b.username,typeof m===p?m.apply(b):m))+"</a>\n        </h3>\n        ",m=b.location,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.noop,fn:r.program(5,h,e),data:e}),(n||0===n)&&(o+=n),o+="\n        ",m=b.disableFollowButton,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.program(7,i,e),fn:r.noop,data:e}),(n||0===n)&&(o+=n),o+="\n    </div>\n    ",m=b.hasLatestImages,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.noop,fn:r.program(10,k,e),data:e}),(n||0===n)&&(o+=n),o+="\n",m=b._backend,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.noop,fn:r.program(12,l,e),data:e}),(n||0===n)&&(o+=n),o}),this.IS.templates.follow_person_image=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='<a href="/i/'+l((c=a.id,typeof c===k?c.apply(a):c))+'">'}function g(a,b){return"</a>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this.escapeExpression,m=this,n=c.blockHelperMissing;return h=b._backend,h=typeof h===k?h.apply(b):h,i=n.call(b,h,{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <img src="'+l((h=b.imageUrl,typeof h===k?h.apply(b):h))+'">\n',h=b._backend,h=typeof h===k?h.apply(b):h,i=n.call(b,h,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j}),this.IS.templates.gauge_chart=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<figure class="circle inner"></figure>\n<figure class="circle pin"></figure>\n<figure class="arrow"></figure>\n<p class="value">0%</p>\n<p class="label">'+i((f=b.label,typeof f===h?f.apply(b):f))+"</p>"}),this.IS.templates.global_confirm=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d,e="";return e+="\n<h2>",c=a.sub_message,d=typeof c===j?c.apply(a):c,(d||0===d)&&(e+=d),e+="</h2>\n"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this,l=c.blockHelperMissing,m=this.escapeExpression;return i+="<h1>",g=b.message,h=typeof g===j?g.apply(b):g,(h||0===h)&&(i+=h),i+="</h1>\n",g=b.hasSubMessage,g=typeof g===j?g.apply(b):g,h=l.call(b,g,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+='\n<div class="clearfix buttons">\n    <a class="button-large-white rounded cancel">'+m((g=b.cancel_text,typeof g===j?g.apply(b):g))+'</a>\n    <a class="button-large-yellow rounded confirm">'+m((g=b.confirm_text,typeof g===j?g.apply(b):g))+"</a>\n</div>"}),this.IS.templates.global_login_signup=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="login-wrapper">\n    <p class="error"></p>\n    <div class="initial-step">\n        <p class="message">'+i((f=b.message,typeof f===h?f.apply(b):f))+'</p>\n        <a class="button-large-white rounded no-user-select log-in">LOG IN</a>\n        <a class="button-large-blue rounded fb no-user-select">LOG IN WITH FACEBOOK</a>\n        <div class="or"></div>\n        <a href="/signup" class="button-large-yellow rounded signup no-user-select">SIGN UP</a>\n        <a class="forgot" href="/forgot_password">Forgot Password</a>\n    </div>\n    <div class="login-box interaction-box">\n        <div class="inputs-parent login-inputs">\n            <div class="bordered-input large arrow">\n                <input type="text" name="username" class="username enter-key" value="" autocomplete="on" placeholder="EMAIL OR USERNAME">\n            </div>\n            <div class="bordered-input large arrow second">\n                <input type="password" name="password" class="password enter-key" value="" autocomplete="" placeholder="PASSWORD">\n            </div>\n        </div>\n        <a class="action-button button-large-gray rounded no-user-select log-in">LOG IN</a>\n        <div class="button-wrapper">\n            <a class="forgot" href="/forgot_password">Forgot Password</a>\n            <a class="reset-login-box">Go Back</a>\n        </div>\n    </div>\n</div>'}),this.IS.templates.global_overlay=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'\n        <div class="overlay-error"></div>\n    '}function g(a,b){return'\n        <div class="overlay-success"></div>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing;return j+='<div class="content-box">\n    <a class="close"><span></span></a>\n    <div class="content"></div>\n    ',h=b.enableErrorHandling,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+="\n    ",h=b.enableSuccessHandling,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+="\n</div>"}),this.IS.templates.grid_album=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='<div class="grid-album" data-id="'+B((c=a.id,typeof c===A?c.apply(a):c))+'">'}function g(a,b){var c,d,e="";return e+='\n                    <img style="width: '+B((c=a.adjustedWidth,typeof c===A?c.apply(a):c))+'px" src="',c=a.hero,d=typeof c===A?c.apply(a):c,(d||0===d)&&(e+=d),e+='" onerror="this.className=\'invisible\'" />\n                '}function h(a,b){return'\n                    <div class="text">ADD MORE IMAGES</div>\n                    <div class="icon"></div>\n                '}function i(a,b){var c,d,e="";return e+='<img src="'+B((c=a.thumb1Src,typeof c===A?c.apply(a):c))+'" onerror="this.className=\'invisible\'" data-url="',c=a.thumb1,d=typeof c===A?c.apply(a):c,(d||0===d)&&(e+=d),e+='" />'}function j(a,b){var c,d,e="";return e+='<img src="'+B((c=a.thumb2Src,typeof c===A?c.apply(a):c))+'" onerror="this.className=\'invisible\'" data-url="',c=a.thumb2,d=typeof c===A?c.apply(a):c,(d||0===d)&&(e+=d),e+='" />'}function k(a,b){var c,d,e="";return e+='<img src="'+B((c=a.thumb3Src,typeof c===A?c.apply(a):c))+'" onerror="this.className=\'invisible\'" data-url="',c=a.thumb3,d=typeof c===A?c.apply(a):c,(d||0===d)&&(e+=d),e+='" />'}function l(a,b){var c,d,e="";return e+='<img src="'+B((c=a.thumb4Src,typeof c===A?c.apply(a):c))+'" onerror="this.className=\'invisible\'" data-url="',c=a.thumb4,d=typeof c===A?c.apply(a):c,(d||0===d)&&(e+=d),e+='" />'}function m(a,b){return"ALBUM"}function n(a,b){return"GALLERY"}function o(a,b){var c,d,e="";return e+='\n                    <div class="avatar">\n                        <a href="/user/'+B((c=a.username,typeof c===A?c.apply(a):c))+'"><img src="',c=a.avatarURL,d=typeof c===A?c.apply(a):c,(d||0===d)&&(e+=d),e+='" onerror="this.src=\'/v2_images/default_avatar_56x56.jpg\';"></a>\n                    </div>\n                '}function p(a,b){return'\n                    <div class="icon-lock" data-tooltip="Private" data-tooltip-left="7" data-tooltip-top="2"></div>\n                '}function q(a,b){return'\n                    <div class="icon-lock-password" data-tooltip="Private Password" data-tooltip-left="23" data-tooltip-top="2"></div>\n                '}function r(a,b){return"readonly"}function s(a,b){var c,d,e="";return e+='\n                            <li class="private">\n                                <div class="text">\n                                    ',c=a.isPublic,c=typeof c===A?c.apply(a):c,d=D.call(a,c,{hash:{},inverse:C.noop,fn:C.program(28,t,b),data:b}),(d||0===d)&&(e+=d),e+="\n                                    ",c=a.isPublic,c=typeof c===A?c.apply(a):c,d=D.call(a,c,{hash:{},inverse:C.program(30,u,b),fn:C.noop,data:b}),(d||0===d)&&(e+=d),e+='\n                                </div>\n                                <div class="icon-lock"></div>\n                            </li>\n                            <li class="delete">\n                                Delete Album\n                                <div class="icon-delete-x"></div>\n                            </li>\n                        '}function t(a,b){return"Make Private"}function u(a,b){return"Make Public"}function v(a,b){return"disabled"}function w(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var x,y,z="",A="function",B=this.escapeExpression,C=this,D=c.blockHelperMissing;return x=b._backend,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(1,f,e),data:e}),(y||0===y)&&(z+=y),z+='\n    <div class="inner">\n        <div class="edit-container">\n            <div class="hero">\n                ',x=b.hasHero,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(3,g,e),data:e}),(y||0===y)&&(z+=y),z+="\n                ",x=b.hasHero,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.program(5,h,e),fn:C.noop,data:e}),(y||0===y)&&(z+=y),z+='\n            </div>\n            <div class="thumbs">\n                <div class="thumb one">\n                    ',x=b.hasThumb1,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(7,i,e),data:e}),(y||0===y)&&(z+=y),z+='\n                </div>\n                <div class="thumb two">\n                    ',x=b.hasThumb2,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(9,j,e),data:e}),(y||0===y)&&(z+=y),z+='\n                </div>\n                <div class="thumb three">\n                    ',x=b.hasThumb3,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(11,k,e),data:e}),(y||0===y)&&(z+=y),z+='\n                </div>\n                <div class="thumb four">\n                    ',x=b.hasThumb4,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(13,l,e),data:e}),(y||0===y)&&(z+=y),z+='\n                </div>\n            </div>\n            <div class="clearer"></div>\n        </div>\n        <div class="view-btn">VIEW ',x=b.isFeatured,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.program(15,m,e),fn:C.noop,data:e}),(y||0===y)&&(z+=y),x=b.isFeatured,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(17,n,e),data:e}),(y||0===y)&&(z+=y),z+='</div>\n        <footer>\n            <div class="left">\n                ',x=b.profileMode,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(19,o,e),data:e}),(y||0===y)&&(z+=y),z+='\n                <div class="info-album">\n                    <div class="title-wrapper">\n                        <div class="title">'+B((x=b.albumTitle,typeof x===A?x.apply(b):x))+'</div>\n                    </div>\n                    <div class="count">'+B((x=b.total,typeof x===A?x.apply(b):x))+' Photos</div>\n                </div>\n            </div>\n            <div class="right">\n                ',x=b.isPrivate,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(21,p,e),data:e}),(y||0===y)&&(z+=y),z+="\n                ",x=b.isPrivatePass,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(23,q,e),data:e}),(y||0===y)&&(z+=y),z+='\n                <div class="icon-menu"></div>\n                <nav class="menu-dark animated">\n                    <ul class="top">\n                        <li>\n                            Direct\n                            <input data-label="Direct" data-category="Grid Album" type="text" value="',x=b.directLink,y=typeof x===A?x.apply(b):x,(y||0===y)&&(z+=y),z+='" ',x=b.iOSDevice,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.program(25,r,e),fn:C.noop,data:e}),(y||0===y)&&(z+=y),z+=' />\n                        </li>\n                    </ul>\n                    <ul class="bottom">\n                        <li class="share">\n                            Share\n                            <div class="icon-menu-arrow-right"></div>\n                        </li>\n                        ',x=b.profileMode,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.program(27,s,e),fn:C.noop,data:e}),(y||0===y)&&(z+=y),z+='\n                    </ul>\n                    <div class="arrow"></div>\n                </nav>\n                <nav class="menu-dark-sub albums animated">\n                    <ul>\n                        <li class="add-new-album">Add New Album...</li>\n                    </ul>\n                </nav>\n                <nav class="menu-dark-sub share animated">\n                    <ul class="sub share-options">\n                        <li data-category="Grid Album" data-channel="facebook">Facebook</li>\n                        <li data-category="Grid Album" data-channel="twitter">Twitter</li>\n                        <li data-category="Grid Album" data-channel="email">Email</li>\n                    </ul>\n                </nav>\n            </div>\n        </footer>\n    </div>\n    <section class="follow ',x=b.showFollowBtn,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.program(32,v,e),fn:C.noop,data:e}),(y||0===y)&&(z+=y),z+='">\n        <a class="btn '+B((x=b.followBtnType,typeof x===A?x.apply(b):x))+'">'+B((x=b.followBtnText,typeof x===A?x.apply(b):x))+"</a>\n    </section>\n",x=b._backend,x=typeof x===A?x.apply(b):x,y=D.call(b,x,{hash:{},inverse:C.noop,fn:C.program(34,w,e),data:e}),(y||0===y)&&(z+=y),z}),this.IS.templates.grid_album_mobile=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<section class="hero">\n    <img src="'+i((f=b.hero,typeof f===h?f.apply(b):f))+'" style="width:'+i((f=b.heroAdjustedWidth,typeof f===h?f.apply(b):f))+'px" onerror="this.className=\'invisible\'" />\n</section>\n<section class="thumbs">\n    <div class="thumb">\n        <img src="'+i((f=b.thumb1,typeof f===h?f.apply(b):f))+'" class="thumb" onerror="this.className=\'blank\'" />\n    </div>\n    <div class="thumb">\n        <img src="'+i((f=b.thumb2,typeof f===h?f.apply(b):f))+'" class="thumb" onerror="this.className=\'blank\'" />\n    </div>\n    <div class="thumb">\n        <img src="'+i((f=b.thumb3,typeof f===h?f.apply(b):f))+'" class="thumb" onerror="this.className=\'blank\'" />\n    </div>\n</section>\n<section class="title">\n    <span class="title">'+i((f=b.title,typeof f===h?f.apply(b):f))+'</span>\n    <span class="count">'+i((f=b.count,typeof f===h?f.apply(b):f))+"</span>\n</section>\n"}),this.IS.templates.grid_photo=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='<div class="grid-photo" data-id="'+O((c=a.id,typeof c===N?c.apply(a):c))+'">'}function g(a,b){var c,d="";return d+='<a class="hero-wrapper" href="'+O((c=a.landingURL,typeof c===N?c.apply(a):c))+'">'}function h(a,b){return'<span class="cover"></span>'}function i(a,b){return"</a>"}function j(a,b){var c,d,e="";return e+='\n            <a class="clearfix like-button ',c=a.liked,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(10,k,b),data:b}),(d||0===d)&&(e+=d),e+='">\n                <span class="icon"></span>\n            </a>\n            '}function k(a,b){return"liked"}function l(a,b){var c,d,e="";return e+='\n            <a class="select-button" ',c=a.iOSDevice,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(13,m,b),data:b}),(d||0===d)&&(e+=d),e+='>\n                <div class="icon"></div>\n            </a>\n            '}function m(a,b){return'style="opacity:0.95 !important"'}function n(a,b){return'\n                <a class="icon-gif"></a>\n            '}function o(a,b){var c,d,e="";return e+='\n        <footer>\n            <div class="left ',c=a.showFooterLeft,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(18,p,b),fn:P.noop,data:b}),(d||0===d)&&(e+=d),e+='">\n                ',c=a.showPrivateInfo,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(20,q,b),data:b}),(d||0===d)&&(e+=d),e+='\n                <div class="info">\n                    <div class="title-wrapper ',c=a.profileMode,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(23,s,b),fn:P.noop,data:b}),(d||0===d)&&(e+=d),e+='">\n                        <div title="'+O((c=a.imageTitle,typeof c===N?c.apply(a):c))+'" class="title">'+O((c=a.imageTitle,typeof c===N?c.apply(a):c))+"</div>\n                    </div>\n                    ",c=a.profileMode,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(26,u,b),data:b}),(d||0===d)&&(e+=d),e+="\n                    ",c=a.profileMode,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(28,v,b),fn:P.noop,data:b}),(d||0===d)&&(e+=d),e+='\n                </div>\n            </div>\n            <div class="right">\n                ',c=a.isPublic,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(31,x,b),fn:P.noop,data:b}),(d||0===d)&&(e+=d),e+='\n                <div class="icon-menu"></div>\n                <nav class="menu-dark animated">\n                    <ul class="links-button">\n                        <li>\n                            <a class="button-large-white">Get image sizes or links</a>\n                        </li>\n                    </ul>\n                    <ul class="top">\n                        <li>\n                            Link\n                            <input data-label="Link" data-category="Grid Photo" type="text" value="'+O((c=a.link,typeof c===N?c.apply(a):c))+'" ',c=a.iOSDevice,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(33,y,b),fn:P.noop,data:b}),(d||0===d)&&(e+=d),e+=" />\n                        </li>\n                        <li ",c=a.freeAccount,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(35,z,b),data:b}),(d||0===d)&&(e+=d),e+=">\n                            Direct\n                            <input ",c=a.freeAccount,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(35,z,b),data:b}),(d||0===d)&&(e+=d),e+=' data-label="Direct" data-category="Grid Photo" type="text" value="'+O((c=a.directLink,typeof c===N?c.apply(a):c))+'" ',c=a.iOSDevice,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(33,y,b),fn:P.noop,data:b}),(d||0===d)&&(e+=d),e+=' />\n                        </li>\n                    </ul>\n                    <ul class="bottom">\n                        ',c=a.profileMode,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(37,A,b),
fn:P.noop,data:b}),(d||0===d)&&(e+=d),e+='\n                        <li class="share">\n                            Share\n                            <div class="icon-menu-arrow-right"></div>\n                        </li>\n                        ',c=a.profileMode,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(42,D,b),fn:P.noop,data:b}),(d||0===d)&&(e+=d),e+='\n                    </ul>\n                    <div class="arrow"></div>\n                </nav>\n                <nav class="menu-dark-sub albums animated">\n                    <div class="loading">Loading Albums...</div>\n                    <div class="no-results">No Albums</div>\n                    <ul>\n                        <!--<li class="add-new-album">Add New Album...</li>-->\n                        <div class="albums"></div>\n                    </ul>\n                </nav>\n                <nav class="menu-dark-sub share animated">\n                    <ul class="sub share-options">\n                        <li data-category="Grid Photo" data-channel="facebook">Facebook</li>\n                        <li data-category="Grid Photo" data-channel="twitter">Twitter</li>\n                        <li data-category="Grid Photo" data-channel="pinterest">Pinterest</li>\n                        <li data-category="Grid Photo" data-channel="email">Email</li>\n                    </ul>\n                </nav>\n            </div>\n        </footer>\n        '}function p(a,b){return"hidden"}function q(a,b){var c,d,e="";return e+="\n                    ",c=a.profileMode,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(21,r,b),data:b}),(d||0===d)&&(e+=d),e+="\n                "}function r(a,b){var c,d="";return d+='\n                        <div class="avatar">\n                            <a href="/user/'+O((c=a.username,typeof c===N?c.apply(a):c))+'"><img src="'+O((c=a.avatarURL,typeof c===N?c.apply(a):c))+'" onerror="this.src=\''+O((c=a.defaultAvatarURL,typeof c===N?c.apply(a):c))+"'\" /></a>\n                        </div>\n                    "}function s(a,b){var c,d;return c=a.belongsToAlbum,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(24,t,b),fn:P.noop,data:b}),d||0===d?d:""}function t(a,b){return"shifted"}function u(a,b){var c,d="";return d+='\n                        <div class="username">\n                            <a href="/user/'+O((c=a.username,typeof c===N?c.apply(a):c))+'">'+O((c=a.username,typeof c===N?c.apply(a):c))+"</a>\n                        </div>\n                    "}function v(a,b){var c,d,e="";return e+="\n                        ",c=a.belongsToAlbum,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(29,w,b),data:b}),(d||0===d)&&(e+=d),e+="\n                    "}function w(a,b){var c,d="";return d+='\n                            <div class="album-name">\n                                <a href="/a/'+O((c=a.albumId,typeof c===N?c.apply(a):c))+'">Album: '+O((c=a.albumTitle,typeof c===N?c.apply(a):c))+"</a>\n                            </div>\n                        "}function x(a,b){return'\n                    <div class="icon-lock" data-tooltip="Private" data-tooltip-left="7" data-tooltip-top="2"></div>\n                '}function y(a,b){return"readonly"}function z(a,b){return'class="disabled"'}function A(a,b){var c,d,e="";return e+='\n                        <li class="add-to-album">\n                            ',c=a.belongsToAlbum,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(38,B,b),data:b}),(d||0===d)&&(e+=d),e+="\n                            ",c=a.belongsToAlbum,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(40,C,b),fn:P.noop,data:b}),(d||0===d)&&(e+=d),e+='\n                            <div class="icon-menu-arrow-right"></div>\n                        </li>\n                        '}function B(a,b){return"\n                                Move To Album\n                            "}function C(a,b){return"\n                                Add To Album\n                            "}function D(a,b){var c,d,e="";return e+='\n                            <li class="private">\n                                <div class="text">\n                                    ',c=a.isPublic,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(43,E,b),data:b}),(d||0===d)&&(e+=d),e+="\n                                    ",c=a.isPublic,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.program(45,F,b),fn:P.noop,data:b}),(d||0===d)&&(e+=d),e+='\n                                </div>\n                                <div class="icon-lock"></div>\n                            </li>\n                            ',c=a.showAlbumRemove,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(47,G,b),data:b}),(d||0===d)&&(e+=d),e+="\n                            ",c=a.showEdit,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(49,H,b),data:b}),(d||0===d)&&(e+=d),e+='\n                            <li class="crop">\n                                Crop\n                                <div class="icon-crop"></div>\n                            </li>\n                            ',c=a.showRotate,c=typeof c===N?c.apply(a):c,d=Q.call(a,c,{hash:{},inverse:P.noop,fn:P.program(51,I,b),data:b}),(d||0===d)&&(e+=d),e+='\n                            <li class="delete">\n                                Delete\n                                <div class="icon-delete-x"></div>\n                            </li>\n                        '}function E(a,b){return"Make Private"}function F(a,b){return"Make Public"}function G(a,b){return'\n                                <li class="remove-from-album">\n                                    Remove from Album\n                                    <div class="icon-delete-x"></div>\n                                </li>\n                            '}function H(a,b){return'\n                                <li class="edit">\n                                    Edit\n                                    <div class="icon-edit"></div>\n                                </li>\n                            '}function I(a,b){return'\n                                <li class="rotate">\n                                    Rotate\n                                    <div class="icon-rotate"></div>\n                                </li>\n                            '}function J(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var K,L,M="",N="function",O=this.escapeExpression,P=this,Q=c.blockHelperMissing;return K=b._backend,K=typeof K===N?K.apply(b):K,L=Q.call(b,K,{hash:{},inverse:P.noop,fn:P.program(1,f,e),data:e}),(L||0===L)&&(M+=L),M+='\n    <div class="inner">\n        <figure class="top-wrapper">\n            ',K=b.iOSDevice,K=typeof K===N?K.apply(b):K,L=Q.call(b,K,{hash:{},inverse:P.program(3,g,e),fn:P.noop,data:e}),(L||0===L)&&(M+=L),M+='\n				<img style="width: '+O((K=b.adjustedWidth,typeof K===N?K.apply(b):K))+"px; height: "+O((K=b.adjustedHeight,typeof K===N?K.apply(b):K))+'px;" src="/v2_images/empty.png" class="hero" onload="if(this.src&&this.src.indexOf(\'empty.png\')<0){this.parentNode.parentNode.parentNode.parentNode.className+=\' loaded\';}" onerror="this.className=\'invisible\'; this.parentNode.parentNode.parentNode.parentNode.className+=\' hero-failed\';" data-src="'+O((K=b.hero,typeof K===N?K.apply(b):K))+'" />\n                ',K=b.iOSDevice,K=typeof K===N?K.apply(b):K,L=Q.call(b,K,{hash:{},inverse:P.program(5,h,e),fn:P.noop,data:e}),(L||0===L)&&(M+=L),M+="\n            ",K=b.iOSDevice,K=typeof K===N?K.apply(b):K,L=Q.call(b,K,{hash:{},inverse:P.program(7,i,e),fn:P.noop,data:e}),(L||0===L)&&(M+=L),M+="\n            ",K=b.disableLike,K=typeof K===N?K.apply(b):K,L=Q.call(b,K,{hash:{},inverse:P.program(9,j,e),fn:P.noop,data:e}),(L||0===L)&&(M+=L),M+="\n            ",K=b.showSelect,K=typeof K===N?K.apply(b):K,L=Q.call(b,K,{hash:{},inverse:P.noop,fn:P.program(12,l,e),data:e}),(L||0===L)&&(M+=L),M+="\n            ",K=b.showGifIcon,K=typeof K===N?K.apply(b):K,L=Q.call(b,K,{hash:{},inverse:P.noop,fn:P.program(15,n,e),data:e}),(L||0===L)&&(M+=L),M+="            \n        </figure>\n        ",K=b.homepageMode,K=typeof K===N?K.apply(b):K,L=Q.call(b,K,{hash:{},inverse:P.program(17,o,e),fn:P.noop,data:e}),(L||0===L)&&(M+=L),M+="\n    </div>\n",K=b._backend,K=typeof K===N?K.apply(b):K,L=Q.call(b,K,{hash:{},inverse:P.noop,fn:P.program(53,J,e),data:e}),(L||0===L)&&(M+=L),M}),this.IS.templates.grid_photo_mobile=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<section class="hero">\n    <img src="'+i((f=b.hero,typeof f===h?f.apply(b):f))+'" onerror="this.src=\'/v2_images/empty.png\'" />\n</section>\n'}),this.IS.templates.header_album_detail=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<header class="my-albums">'}function g(a,b){var c,d="";return d+='\n                <img src="'+u((c=a.avatarURL,typeof c===t?c.apply(a):c))+'" class="avatar" onerror="this.parentNode.removeChild(this)" />\n            '}function h(a,b){var c,d="";return d+='\n                <div class="description">'+u((c=a.description,typeof c===t?c.apply(a):c))+"</div>\n            "}function i(a,b){var c,d,e="";return e+="\n                ",c=a.showUserInfo,c=typeof c===t?c.apply(a):c,d=w.call(a,c,{hash:{},inverse:v.noop,fn:v.program(8,j,b),data:b}),(d||0===d)&&(e+=d),e+="\n            "}function j(a,b){var c,d="";return d+='By <a href="/user/'+u((c=a.username,typeof c===t?c.apply(a):c))+'" class="user">'+u((c=a.username,typeof c===t?c.apply(a):c))+"</a> |"}function k(a,b){return'<span class="icon-lock"></span>'}function l(a,b){return'<span class="icon-lock-password"></span>'}function m(a,b){return"readonly"}function n(a,b){return'\n                    <li class="add">Add New Images</li>\n                    <li class="private">\n                        <div class="text">Privacy Settings</div>\n                        <div class="lock" data-tooltip="Private" data-tooltip-left="7" data-tooltip-top="2"></div>\n                    </li>\n                    <li class="delete">\n                        Delete Album\n                        <div class="x"></div>\n                    </li>\n                '}function o(a,b){return'\n            <div class="dropdown-sort">\n                <div class="selected-label initial" data-value="">Sort by</div>\n                <span class="icon-menu-arrow-down"></span>\n                <div class="selection">\n                    <!-- <div class="item prevent-click" data-value="">Sort by</div> -->\n                    <div class="item" data-value="creation_date">Date</div>\n                    <div class="item" data-value="modification_date">Modified</div>\n                    <div class="item" data-value="title">Title</div>\n                    <div class="item" data-value="filename">Filename</div>\n                    <div class="item last" data-value="file_size">File Size</div>\n                </div>\n            </div>\n            <div class="dropdown-grid">\n                <div class="selected-label initial" data-value=""></div>\n                <div class="selection">\n                    <div class="item icon-thumbnail-grid" data-value="3" data-class="icon-thumbnail-grid"></div>\n                    <div class="item icon-square-grid" data-value="2" data-class="icon-square-grid"></div>\n                    <div class="item icon-masonry-grid" data-value="1" data-class="icon-masonry-grid"></div>\n                </div>\n            </div>\n            <div class="edit" data-tooltip="Edit Album" data-tooltip-left="-5" data-tooltip-top="-5" data-tooltip-animate-top="0" data-tooltip-disabled="false">\n                <span class="icon-edit"></span>\n            </div>\n        '}function p(a,b){return"</header>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var q,r,s="",t="function",u=this.escapeExpression,v=this,w=c.blockHelperMissing;return q=b._backend,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(1,f,e),data:e}),(r||0===r)&&(s+=r),s+='\n    <section class="top">\n        <div class="normal-mode">\n            ',q=b.ownerMode,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.program(3,g,e),fn:v.noop,data:e}),(r||0===r)&&(s+=r),s+="\n            <h1>"+u((q=b.title,typeof q===t?q.apply(b):q))+"</h1>\n            ",q=b.showDescription,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(5,h,e),data:e}),(r||0===r)&&(s+=r),s+='\n        </div>\n        <div class="edit-mode">\n            <input type="text" placeholder="Title" name="title" value="'+u((q=b.title,typeof q===t?q.apply(b):q))+'" />\n            <textarea placeholder="Description (limit 300 characters)">'+u((q=b.description,typeof q===t?q.apply(b):q))+'</textarea>\n            <a class="button-large-black save">SAVE</a>\n            <a class="button-large-black cancel">CANCEL</a>\n        </div>\n        <div class="date">\n            ',q=b.ownerMode,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.program(7,i,e),fn:v.noop,data:e}),(r||0===r)&&(s+=r),s+="\n            Created "+u((q=b.date,typeof q===t?q.apply(b):q))+"\n            ",q=b.isPrivate,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(10,k,e),data:e}),(r||0===r)&&(s+=r),s+="\n            ",q=b.isPrivatePass,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(12,l,e),data:e}),(r||0===r)&&(s+=r),s+='\n        </div>\n    </section>\n    <section class="bottom">\n        <div class="menu">\n            <span class="icon-menu-tall"></span>\n        </div>\n        <nav class="owner-options menu-dark animated" style="min-height:100%">\n            <ul class="top">\n                <li>Direct <input type="text" value="'+u((q=b.directLink,typeof q===t?q.apply(b):q))+'" ',q=b.iOSDevice,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.program(14,m,e),fn:v.noop,data:e}),(r||0===r)&&(s+=r),s+=' /></li>\n            </ul>\n            <ul class="bottom">\n                ',q=b.ownerMode,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(16,n,e),data:e}),(r||0===r)&&(s+=r),s+='\n                <li class="share">\n                    Share\n                    <div class="arrow"></div>\n                </li>\n            </ul>\n            <nav class="menu-dark-sub share animated">\n                <ul class="sub share-options">\n                    <li data-category="Grid Photo" data-channel="facebook">Facebook</li>\n                    <li data-category="Grid Photo" data-channel="twitter">Twitter</li>\n                    <li data-category="Grid Photo" data-channel="pinterest">Pinterest</li>\n                    <li data-category="Grid Photo" data-channel="email">Email</li>\n                </ul>\n            </nav>\n            <div class="arrow"></div>\n        </nav>\n        <div class="stats">\n            <div class="images">\n                <span>'+u((q=b.total,typeof q===t?q.apply(b):q))+'</span> IMAGES\n            </div>\n            <!-- <div class="followers">\n                <span>6</span> FOLLOWERS\n            </div> -->\n        </div>\n        ',q=b.ownerMode,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(18,o,e),data:e}),(r||0===r)&&(s+=r),s+="\n    </section>\n",q=b._backend,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(20,p,e),data:e}),(r||0===r)&&(s+=r),s}),this.IS.templates.header_album_detail_mobile=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'\n        <div class="icon-menu"></div>\n    '}function g(a,b){return"lower"}function h(a,b){return'<div class="icon-lock"></div>'}function i(a,b){return'<div class="icon-lock-password"></div>'}function j(a,b){return"shifted"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var k,l,m="",n="function",o=this,p=c.blockHelperMissing,q=this.escapeExpression;return m+='<div class="left">\n    ',k=b.showMenu,k=typeof k===n?k.apply(b):k,l=p.call(b,k,{hash:{},inverse:o.noop,fn:o.program(1,f,e),data:e}),(l||0===l)&&(m+=l),m+='\n</div>\n<div class="center">\n    <h1 class="',k=b.hasDescription,k=typeof k===n?k.apply(b):k,l=p.call(b,k,{hash:{},inverse:o.program(3,g,e),fn:o.noop,data:e}),(l||0===l)&&(m+=l),m+='">'+q((k=b.title,typeof k===n?k.apply(b):k))+'</h1>\n    <div class="description">'+q((k=b.description,typeof k===n?k.apply(b):k))+'</div>\n</div>\n<div class="right">\n    ',k=b.isPrivate,k=typeof k===n?k.apply(b):k,l=p.call(b,k,{hash:{},inverse:o.noop,fn:o.program(5,h,e),data:e}),(l||0===l)&&(m+=l),m+="\n    ",k=b.isPrivatePass,k=typeof k===n?k.apply(b):k,l=p.call(b,k,{hash:{},inverse:o.noop,fn:o.program(7,i,e),data:e}),(l||0===l)&&(m+=l),m+='\n    <div class="images ',k=b.showLock,k=typeof k===n?k.apply(b):k,l=p.call(b,k,{hash:{},inverse:o.noop,fn:o.program(9,j,e),data:e}),(l||0===l)&&(m+=l),m+='">'+q((k=b.count,typeof k===n?k.apply(b):k))+"</div>\n</div>\n"}),this.IS.templates.header_main_mobile=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<span class="icon-menu"></span>'}function g(a,b){return"active"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing,n=this.escapeExpression;return j+='<section data-type="normal">\n    ',h=b.userLoggedIn,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <span class="icon-back-arrow"></span>\n    <section class="menu">\n        <span class="icon-menu"></span>\n        <section class="top">\n            <div class="blurred-bg"></div>\n            <div class="blurred-bg-overlay"></div>\n            <section class="info">\n                <img src="'+n((h=b.avatarURL,typeof h===k?h.apply(b):h))+'" class="avatar" onerror="this.src=\'/v2_images/default_avatar_120x120.jpg\'">\n                <a href="/user/'+n((h=b.username,typeof h===k?h.apply(b):h))+'" class="username">'+n((h=b.username,typeof h===k?h.apply(b):h))+'</a>\n            </section>\n        </section>\n        <section class="bottom">\n            <ul class="menu">\n                <li><a href="/my/following" data-type="Following" class="',h=b.activeMyFollowing,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+='">FOLLOWING</a></li>\n                <li><a href="/my/images" data-type="My Images" class="',h=b.activeMyImages,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+='">MY IMAGES</a></li>\n                <li><a href="/my/albums" data-type="My Albums" class="',h=b.activeMyAlbums,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+='">MY ALBUMS</a></li>\n                <li><a href="/user/'+n((h=b.username,typeof h===k?h.apply(b):h))+'" data-type="My Profile" class="',h=b.activeProfile,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+='">MY PROFILE</a></li>\n                <li><a href="/auth/logout" data-type="Log Out" class="logout" data-bypass="true">LOG OUT</a></li>\n            </ul>\n        </section>\n    </section>\n    <a class="icon-frog" href="/" data-bypass="true"></a>\n    <span class="icon-arrow"></span>\n    <div class="upload-icon-wrapper">\n        <span class="icon-upload needsclick"></span>\n        <form class="fake-upload main" method="post" action="/rest_api/v2/images" enctype="multipart/form-data">\n            <input type="file" name="file" class="file-input-first" accept="image/*" autocomplete="off">\n        </form>\n    </div>\n    <section class="upload-overlay">\n        <div class="icon-close"></div>\n        <div class="content">\n            <section class="uploading">\n                <h1>Uploading...</h1>\n                <div class="uploader">\n                    <div class="bar"></div>\n                </div>\n                <a class="cancel">CANCEL</a>\n            </section>\n            <section class="error">\n                <h1>There was an error uploading your image.</h1>\n                <a class="close">CLOSE</a>\n            </section>\n            <section class="location">\n                <div class="buttons">\n                    <div class="album">\n                        <a class="album">ADD TO ALBUM</a>\n                        <form class="fake-upload" method="post" action="/rest_api/v2/images" enctype="multipart/form-data" data-type="album">\n                            <input type="file" name="file" class="file-input" accept="image/*" autocomplete="off">\n                            <input type="hidden" name="album" value="" class="album-id">\n                        </form>\n                    </div>\n                    <div class="images">\n                        <a class="images">ADD TO MY IMAGES</a>\n                        <form class="fake-upload" method="post" action="/rest_api/v2/images" enctype="multipart/form-data" date-type="images">\n                            <input type="file" name="file" class="file-input" accept="image/*" autocomplete="off">\n                        </form>\n                    </div>\n                </div>\n            </section>\n        </div>\n    </section>\n</section>\n<section data-type="landing">\n    <span class="icon-back-arrow"></span>\n    <a class="icon-frog" href="/" data-bypass="true"></a>\n    <span class="icon-delete"></span>\n</section>\n'}),this.IS.templates.header_manage=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<header class="manage">'}function g(a,b){var c,d,e="";return e+='\n            <div class="dropdown-grid ',c=a.disableGridDropdown,c=typeof c===m?c.apply(a):c,d=o.call(a,c,{hash:{},inverse:n.noop,fn:n.program(4,h,b),data:b}),(d||0===d)&&(e+=d),e+='">\n                <div class="selected-label initial" data-value=""></div>\n                <div class="selection">\n                    <div class="item icon-thumbnail-grid" data-value="3" data-class="icon-thumbnail-grid"></div>\n                    <div class="item icon-square-grid" data-value="2" data-class="icon-square-grid"></div>\n                    <div class="item icon-masonry-grid" data-value="1" data-class="icon-masonry-grid"></div>\n                </div>\n            </div>\n        '}function h(a,b){return"hidden"}function i(a,b){return"</header>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j,k,l="",m="function",n=this,o=c.blockHelperMissing;return j=b._backend,j=typeof j===m?j.apply(b):j,k=o.call(b,j,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(k||0===k)&&(l+=k),l+='\n    <div class="left">\n        <div class="text">',j=b.title,k=typeof j===m?j.apply(b):j,(k||0===k)&&(l+=k),l+='</div>\n        <div class="count">',j=b.count,k=typeof j===m?j.apply(b):j,(k||0===k)&&(l+=k),l+='</div>\n    </div>\n    <div class="right">\n        ',j=b.showControls,j=typeof j===m?j.apply(b):j,k=o.call(b,j,{hash:{},inverse:n.noop,fn:n.program(3,g,e),data:e}),(k||0===k)&&(l+=k),l+='\n    </div>\n    <div class="clearer"></div>\n',j=b._backend,j=typeof j===m?j.apply(b):j,k=o.call(b,j,{hash:{},inverse:n.noop,fn:n.program(6,i,e),data:e}),(k||0===k)&&(l+=k),l+="\n"}),this.IS.templates.header_premium_banner=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div class="icon-close"></div>\n<section class="middle">\n    <h1>Premium can be yours again.</h1>\n    <p>Get everything with premium: direct linking, image stats, unlimited space, no ads and more.</p>\n    <a href="/upgrade" data-bypass="true" class="upgrade">GET IT NOW</a>\n</section>\n'}),this.IS.templates.header_profile=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<header class="user-profile">'}function g(a,b){var c,d="";return d+='\n                    <img src="'+x((c=a.avatarUrl,typeof c===w?c.apply(a):c))+'" onerror="this.parentNode.removeChild(this)" />\n                '}function h(a,b){return'\n                    <div class="edit">EDIT</div>\n                '}function i(a,b){return'class="premium-badge"'}function j(a,b){return"tall"}function k(a,b){var c,d="";return d+='\n                    <div class="clearfix location">\n                        <div class="icon"></div>\n                        <div class="name">'+x((c=a.location,typeof c===w?c.apply(a):c))+"</div>\n                    </div>\n                "}function l(a,b){return"selected"}function m(a,b){return"ALBUMS"}function n(a,b){return"GALLERIES"}function o(a,b){var c,d,e="";return e+="-->\n                <!--",c=a.disableFollowButton,c=typeof c===w?c.apply(a):c,d=z.call(a,c,{hash:{},inverse:y.program(20,p,b),fn:y.noop,data:b}),(d||0===d)&&(e+=d),e+="-->\n                <!--",c=a.disableFollowButton,c=typeof c===w?c.apply(a):c,d=z.call(a,c,{hash:{},inverse:y.noop,fn:y.program(23,r,b),data:b}),(d||0===d)&&(e+=d),e+="-->\n            <!--"}function p(a,b){var c,d,e="";return e+='-->\n                    <!--<a data-force-login="true" class="fading-button follow-button ',c=a.isFollowed,c=typeof c===w?c.apply(a):c,d=z.call(a,c,{hash:{},inverse:y.noop,fn:y.program(21,q,b),data:b}),(d||0===d)&&(e+=d),e+='" data-following="'+x((c=a.followValue,typeof c===w?c.apply(a):c))+'">-->\n                        <!--<span class="front">FOLLOW</span>-->\n                        <!--<span class="back">UNFOLLOW</span>-->\n                    <!--</a>-->\n                <!--'}function q(a,b){return"on"}function r(a,b){return'-->\n                    <!--<p class="not-allowed">This user does not allow followers.</p>-->\n                <!--'}function s(a,b){return"</header>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var t,u,v="",w="function",x=this.escapeExpression,y=this,z=c.blockHelperMissing;return t=b._backend,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.noop,fn:y.program(1,f,e),data:e}),(u||0===u)&&(v+=u),v+='\n    <div class="inner">\n        <div class="inner-wrapper">\n            <div class="avatar">\n                ',t=b.hasAvatar,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.noop,fn:y.program(3,g,e),data:e}),(u||0===u)&&(v+=u),v+="\n                ",t=b.editProfileEnabled,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.noop,fn:y.program(5,h,e),data:e}),(u||0===u)&&(v+=u),v+='\n            </div>\n            <div class="info">\n                <h1 ',t=b.showPremiumBadge,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.noop,fn:y.program(7,i,e),data:e}),(u||0===u)&&(v+=u),v+=">"+x((t=b.username,typeof t===w?t.apply(b):t))+'</h1>\n                <div class="bio ',t=b.hasLocation,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.program(9,j,e),fn:y.noop,data:e}),(u||0===u)&&(v+=u),v+='">'+x((t=b.bio,typeof t===w?t.apply(b):t))+"</div>\n                ",t=b.hasLocation,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.noop,fn:y.program(11,k,e),data:e}),(u||0===u)&&(v+=u),v+='\n            </div>\n        </div>\n        <!--<section class="follow-area">-->\n            <!--<section class="clearfix wrapper">-->\n                <!--<a class="following" href="/user/'+x((t=b.username,typeof t===w?t.apply(b):t))+'/following">-->\n                    <!--<div class="count">'+x((t=b.followingTotal,typeof t===w?t.apply(b):t))+'</div>-->\n                    <!--<div class="name">FOLLOWING</div>-->\n                <!--</a>-->\n                <!--<div class="divider"></div>-->\n                <!--<a class="followers" href="/user/'+x((t=b.username,typeof t===w?t.apply(b):t))+'/followers">-->\n                    <!--<div class="followers-total count">'+x((t=b.followersTotal,typeof t===w?t.apply(b):t))+'</div>-->\n                    <!--<div class="name">FOLLOWERS</div>-->\n                <!--</a>-->\n            <!--</section>-->\n        <!--</section>-->\n    </div>\n    <div class="footer clearfix">\n        <nav>\n            <ul>\n                <li class="images ',t=b.currentPagePhotos,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.noop,fn:y.program(13,l,e),data:e}),(u||0===u)&&(v+=u),v+='">\n                    <a href="/user/'+x((t=b.username,typeof t===w?t.apply(b):t))+'">IMAGES <span class="thin">'+x((t=b.photosTotal,typeof t===w?t.apply(b):t))+'</span></a>\n                    <div class="arrow"></div>\n                </li>\n                <li class="albums ',t=b.currentPageAlbums,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.noop,fn:y.program(13,l,e),data:e}),(u||0===u)&&(v+=u),v+='">\n                    <a href="/user/'+x((t=b.username,typeof t===w?t.apply(b):t))+'/a">',t=b.isFeatured,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.program(15,m,e),fn:y.noop,data:e}),(u||0===u)&&(v+=u),t=b.isFeatured,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.noop,fn:y.program(17,n,e),data:e}),(u||0===u)&&(v+=u),v+=' <span class="thin">'+x((t=b.albumsTotal,typeof t===w?t.apply(b):t))+'</span></a>\n                    <div class="arrow"></div>\n                </li>\n                <li class="liked ',t=b.currentPageLiked,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.noop,fn:y.program(13,l,e),data:e}),(u||0===u)&&(v+=u),v+='">\n                    <a href="/user/'+x((t=b.username,typeof t===w?t.apply(b):t))+'/liked">LIKED <span class="thin">'+x((t=b.likedTotal,typeof t===w?t.apply(b):t))+'</span></a>\n                    <div class="arrow"></div>\n                </li>\n            </ul>\n            <!--',t=b.isOwnPage,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.program(19,o,e),fn:y.noop,data:e}),(u||0===u)&&(v+=u),v+="-->\n        </nav>\n    </div>\n",t=b._backend,t=typeof t===w?t.apply(b):t,u=z.call(b,t,{hash:{},inverse:y.noop,fn:y.program(25,s,e),data:e}),(u||0===u)&&(v+=u),v}),this.IS.templates.header_profile_mobile=Handlebars.template(function(a,b,c,d,e){function f(a,b){return"active"}function g(a,b){var c,d,e="";return e+="\n            ",c=a.disableFollowButton,c=typeof c===l?c.apply(a):c,d=o.call(a,c,{hash:{},inverse:n.program(4,h,b),fn:n.noop,data:b}),(d||0===d)&&(e+=d),e+="\n        "}function h(a,b){var c,d="";return d+='\n                <a class="follow-btn" data-following="'+m((c=a.followValue,typeof c===l?c.apply(a):c))+'">\n                    <span class="follow">FOLLOW</span>\n                    <span class="unfollow">UNFOLLOW</span>\n                    <span class="login">LOGIN TO FOLLOW</span>\n                </a>\n            '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k="",l="function",m=this.escapeExpression,n=this,o=c.blockHelperMissing;return k+='<section class="background-blur"></section>\n<section class="background-overlay"></section>\n<section class="top">\n    <div class="avatar">\n        <img src="'+m((i=b.avatarURL,typeof i===l?i.apply(b):i))+'" onerror="this.src=\'/v2_images/default_avatar_120x120.jpg\'">\n    </div>\n    <div class="name">'+m((i=b.username,typeof i===l?i.apply(b):i))+'</div>\n</section>\n<div class="line"></div>\n<section class="bottom">\n    <section class="large">\n        <div class="icon-my-images ',i=b.imagesActive,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='"></div>\n        <div class="icon-my-albums ',i=b.albumsActive,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='"></div>\n        <div class="icon-like ',i=b.likedActive,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(1,f,e),
data:e}),(j||0===j)&&(k+=j),k+='"></div>\n        ',i=b.isOwnPage,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.program(3,g,e),fn:n.noop,data:e}),(j||0===j)&&(k+=j),k+='\n    </section>\n    <section class="mini">\n        <div class="avatar">\n            <img src="'+m((i=b.avatarURL,typeof i===l?i.apply(b):i))+'" onerror="this.src=\'/v2_images/default_avatar_120x120.jpg\'">\n        </div>\n        <div class="name">'+m((i=b.username,typeof i===l?i.apply(b):i))+'</div>\n        <div class="icon-my-images ',i=b.imagesActive,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='"></div>\n        <div class="icon-my-albums ',i=b.albumsActive,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='"></div>\n        <div class="icon-like ',i=b.likedActive,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='"></div>\n    </section> \n</section>\n'}),this.IS.templates.header_selector_mobile=Handlebars.template(function(a,b,c,d,e){function f(a,b){return"active"}function g(a,b){return"visible"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing;return j+='<section class="left">\n    <div class="icon-my-images ',h=b.myImagesActive,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='"></div>\n    <div class="icon-my-albums ',h=b.myAlbumsActive,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='"></div>\n    <div class="icon-following ',h=b.followingActive,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='"></div>\n    <div class="icon-like ',h=b.myLikedActive,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='"></div>\n</section>\n<section class="right">\n    <section class="grid ',h=b.gridSelectorVisible,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+='">\n        <div class="icon-selector-feed ',h=b.feedIconVisible,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+='"></div>\n        <div class="icon-selector-grid ',h=b.gridIconVisible,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+='"></div>\n    </section>\n    <section class="album ',h=b.addAlbumIconVisible,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+='">\n        <div class="icon-add-album"></div>\n    </section>\n</section>\n'}),this.IS.templates.header_upgrade_banner=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='\n<!--\n<section class="list">\n    <ul>\n        <li>IMAGE STATS</li>\n        <li>DIRECT LINKING</li>\n        <li>UNLIMITED SPACE</li>\n        <li>WATERMARKING</li>\n    </ul>\n</section>\n<section class="question">\n    Want to '+i((f=b.actionVerb,typeof f===h?f.apply(b):f))+' these awesome features and more?\n</section>\n<a href="/upgrade" class="upgrade" data-bypass="true">UPGRADE</a>\n-->\n\n<div class="alert" style="text-align:center;color:white;position:relative;top:1px;">Important Content Delivery Policy Changes: <a style="font-siz\ne:16px;color:#ffc246;" href="https://medium.com/@ImageShack/imageshack-content-delivery-policy-changes-3984af30964e">Click Here For Details</a></div>'}),this.IS.templates.image_cropper=Handlebars.template(function(a,b,c,d,e){function f(a,b){return"\n        <h1>CROP &amp; SAVE YOUR PROFILE IMAGE</h1>\n    "}function g(a,b){return"\n        <h1>CROP &amp; SAVE YOUR IMAGE</h1>\n    "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing,n=this.escapeExpression;return j+='<figure class="blurred-bg"></figure>\n<header>\n    ',h=b.avatarType,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+="\n    ",h=b.imageType,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <p>Move the box to where you want to crop. Drag the corners to adjust the size.</p>\n\n    <article class="controls">\n        <a class="icon-close"></a>\n        <a class="button save">SAVE</a>\n        <a class="button cancel">CANCEL</a>\n    </article>\n</header>\n<figure class="crop-box" style="width: '+n((h=b.width,typeof h===k?h.apply(b):h))+"px; height: "+n((h=b.height,typeof h===k?h.apply(b):h))+'px">\n    <img src="/v2_images/empty.png" style="width: '+n((h=b.width,typeof h===k?h.apply(b):h))+"px; height: "+n((h=b.height,typeof h===k?h.apply(b):h))+'px">\n</figure>\n'}),this.IS.templates.image_editor=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<figure class="blurred-bg"></figure>\n<figure class="bg-overlay"></figure>\n<section class="content">\n    <header>\n        <section class="main">\n            <section class="left">\n                <ul>\n                    <li data-name="exposure">\n                        <div title="Exposure" class="icon-editor-exposure"></div>\n                    </li>\n                    <li data-name="brightness">\n                        <div title="Brightness" class="icon-editor-brightness"></div>\n                    </li>\n                    <li data-name="contrast">\n                        <div title="Constrast" class="icon-editor-contrast"></div>\n                    </li>\n                    <li data-name="sharpen">\n                        <div title="Sharpen" class="icon-editor-sharpen"></div>\n                    </li>\n                    <li data-name="saturation">\n                        <div title="Saturation" class="icon-editor-saturation"></div>\n                    </li>\n                    <!-- <li><div class="icon-editor-rotate"></div></li> -->\n            </section>\n            <section class="right">\n                <a class="save">SAVE</a>\n                <section class="save-error">\n                    <div class="icon-box-arrow"></div>\n                    <p>AN ERROR HAS OCCURRED. PLEASE TRY AGAIN.</p>\n                </section>\n                <div class="icon-close"></div>\n            </section>\n        </section>\n        <section class="value">\n            <section class="left">\n                <span class="name">SHARPEN</span>\n            </section>\n            <section class="inner">\n                <div class="slider"></div>\n            </section>\n            <section class="right">\n                <div class="value">+100</div>\n            </section>\n        </section>\n    </header>\n    <section class="hero">\n        <img src="'+i((f=b.heroURL,typeof f===h?f.apply(b):f))+'" class="editor-hero" />\n    </section>\n    <canvas id="special"></canvas>\n</section>'}),this.IS.templates.image_overlay=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d,e="";return e+='\n    <a class="is-arrow prev toggled-elem ',c=a.has_prev_image,c=typeof c===y?c.apply(a):c,d=A.call(a,c,{hash:{},inverse:z.program(2,g,b),fn:z.noop,data:b}),(d||0===d)&&(e+=d),e+=" ",c=a.enableLandingLink,c=typeof c===y?c.apply(a):c,d=A.call(a,c,{hash:{},inverse:z.noop,fn:z.program(4,h,b),data:b}),(d||0===d)&&(e+=d),e+='">\n        <span class="wrapper">\n            <b class="icon-right-arrow"></b>\n        </span>\n    </a>\n    <a class="is-arrow next toggled-elem ',c=a.has_next_image,c=typeof c===y?c.apply(a):c,d=A.call(a,c,{hash:{},inverse:z.program(2,g,b),fn:z.noop,data:b}),(d||0===d)&&(e+=d),e+=" ",c=a.enableLandingLink,c=typeof c===y?c.apply(a):c,d=A.call(a,c,{hash:{},inverse:z.noop,fn:z.program(4,h,b),data:b}),(d||0===d)&&(e+=d),e+='">\n        <span class="wrapper">\n            <b class="icon-left-arrow"></b>\n        </span>\n    </a>\n'}function g(a,b){return"disabled"}function h(a,b){return"narrow"}function i(a,b){return'\n    <figure class="blurred-bg"></figure>\n'}function j(a,b){return"linked"}function k(a,b){return'class="center" onload="this.className+=\' loaded\';"'}function l(a,b){return"touch"}function m(a,b){return"no-touch"}function n(a,b){var c,d="";return d+='\n            <a class="avatar close-trigger" href="/user/'+B((c=a.username,typeof c===y?c.apply(a):c))+'"><img onerror="this.src=\'/v2_images/default_avatar_120x120.jpg\';" src="'+B((c=a.ownerAvatarUrl,typeof c===y?c.apply(a):c))+'" alt="'+B((c=a.username,typeof c===y?c.apply(a):c))+'"></a>\n        '}function o(a,b){return"adjusted"}function p(a,b){var c,d="";return d+='\n                <a class="close-trigger" href="/user/'+B((c=a.username,typeof c===y?c.apply(a):c))+'">'+B((c=a.username,typeof c===y?c.apply(a):c))+"</a>\n            "}function q(a,b){var c,d,e="";return e+='\n            <aside class="clearfix">\n                <a class="button close-trigger"><span class="icon-close"></span></a>\n                <div class="button share">\n                    <a><span class="icon-share"></span></a>\n                    <ul class="share-list">\n                        <li class="mail" data-channel="email" data-category="Lightbox"><span></span></li>\n                        <li class="pinterest" data-channel="pinterest" data-category="Lightbox"><span></span></li>\n                        <li class="twitter" data-channel="twitter" data-category="Lightbox"><span></span></li>\n                        <li class="facebook" data-channel="facebook" data-category="Lightbox"><span></span></li>\n                        <li class="the-void"><span></span></li>\n                    </ul>\n                </div>\n                <a class="button like ',c=a.liked,c=typeof c===y?c.apply(a):c,d=A.call(a,c,{hash:{},inverse:z.noop,fn:z.program(23,r,b),data:b}),(d||0===d)&&(e+=d),e+='"><span class="icon-like"></span></a>\n            </aside>\n        '}function r(a,b){return"liked"}function s(a,b){var c,d,e="";return e+='\n            <aside class="clearfix">\n                <a class="details-trigger">\n                    <span></span>\n                </a>\n                <a class="button like ',c=a.liked,c=typeof c===y?c.apply(a):c,d=A.call(a,c,{hash:{},inverse:z.noop,fn:z.program(23,r,b),data:b}),(d||0===d)&&(e+=d),e+='">\n                    <span></span>\n                </a>\n            </aside>\n        '}function t(a,b){return'\n        <section class="details">\n            <article class="clearfix">\n                <div class="label">LINK</div>\n                <input type="text" value="" class="link" id="o-link" data-type="link">\n            </article>\n            <article class="clearfix">\n                <div class="label direct">DIRECT</div>\n                <input type="text" value="" class="direct" id="o-direct" data-type="direct">\n            </article>\n            <article class="clearfix">\n                <div class="label">FORUM</div>\n                <input type="text" value="" class="forum" id="f-link" data-type="forum">\n            </article>\n            <article class="clearfix">\n                <div class="label">ALT</div>\n                <input type="text" value="" class="alt" id="a-link" data-type="alt-forum">\n            </article>\n            <article class="clearfix">\n                <div class="label">HTML</div>\n                <input type="text" value="" class="html" id="h-link" data-type="web">\n            </article>\n            <article class="related-images">\n                <div class="parent">\n                    <ul class="images"></ul>\n                </div>\n            </article>\n        </section>\n    '}function u(a,b){return'\n    <div class="touch-events o-height"></div>\n'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var v,w,x="",y="function",z=this,A=c.blockHelperMissing,B=this.escapeExpression;return x+='<section class="mobile-ads"></section>\n\n',v=b.disableArrows,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.program(1,f,e),fn:z.noop,data:e}),(w||0===w)&&(x+=w),x+="\n\n",v=b.isTouchDevice,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.program(6,i,e),fn:z.noop,data:e}),(w||0===w)&&(x+=w),x+='\n\n<article class="wrapper o-height move-for-ad">\n    <div class="c-item vp-width o-height">\n        <img src="'+B((v=b.nextImageUrl,typeof v===y?v.apply(b):v))+'">\n    </div>\n    <div class="c-item vp-width o-height ',v=b.enableLandingLink,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.noop,fn:z.program(8,j,e),data:e}),(w||0===w)&&(x+=w),x+='">\n        <img src="'+B((v=b.imageUrl,typeof v===y?v.apply(b):v))+'" ',v=b.isTouchDevice,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.program(10,k,e),fn:z.noop,data:e}),(w||0===w)&&(x+=w),x+='>\n    </div>\n    <div class="c-item vp-width o-height">\n        <img src="'+B((v=b.prevImageUrl,typeof v===y?v.apply(b):v))+'">\n    </div>\n</article>\n\n<footer class="',v=b.isTouchDevice,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.noop,fn:z.program(12,l,e),data:e}),(w||0===w)&&(x+=w),v=b.isTouchDevice,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.program(14,m,e),fn:z.noop,data:e}),(w||0===w)&&(x+=w),x+=' toggled-elem">\n    <div class="wrapper">\n        ',v=b.isPublic,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.noop,fn:z.program(16,n,e),data:e}),(w||0===w)&&(x+=w),x+='\n\n        <div class="info ',v=b.isPublic,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.program(18,o,e),fn:z.noop,data:e}),(w||0===w)&&(x+=w),x+='">\n            <h1 title="'+B((v=b.imageTitle,typeof v===y?v.apply(b):v))+'">'+B((v=b.imageTitle,typeof v===y?v.apply(b):v))+"</h1>\n            ",v=b.isPublic,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.noop,fn:z.program(20,p,e),data:e}),(w||0===w)&&(x+=w),x+="\n        </div>\n\n        ",v=b.isTouchDevice,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.program(22,q,e),fn:z.noop,data:e}),(w||0===w)&&(x+=w),x+="\n\n        ",v=b.isTouchDevice,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.noop,fn:z.program(25,s,e),data:e}),(w||0===w)&&(x+=w),x+="\n    </div>\n\n    ",v=b.isTouchDevice,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.noop,fn:z.program(27,t,e),data:e}),(w||0===w)&&(x+=w),x+="\n</footer>\n\n",v=b.isTouchDevice,v=typeof v===y?v.apply(b):v,w=A.call(b,v,{hash:{},inverse:z.noop,fn:z.program(29,u,e),data:e}),(w||0===w)&&(x+=w),x+='\n\n<section class="ad">\n    <div class="icon-close"></div>\n    <img src="/v2_images/mobile-landing-ad.jpg" />\n</section>\n'}),this.IS.templates.image_size_slider=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<div class="image-size-slider">'}function g(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing;return h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <h3>SELECT IMAGE SIZE</h3>\n    <div class="bar"></div>\n    <div class="arrow"><span></span></div>\n    <div class="labels">\n        <div class="thumb">Thumb</div>\n        <div class="small">Small</div>\n        <div class="medium">Medium</div>\n        <div class="large">Large</div>\n        <div class="full">Full Size</div>\n    </div>\n',h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j}),this.IS.templates.image_stats=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<figure class="blurred-bg"></figure>\n<div class="wrapper">\n    <header class="padded l-bg">\n        <h1>IMAGE STATS: <span>'+i((f=b.filename,typeof f===h?f.apply(b):f))+'</span></h1>\n        <a class="icon-close close-trigger"></a>\n    </header>\n    <article class="counts-area padded d-bg">\n        <img src="'+i((f=b.thumbnailURL,typeof f===h?f.apply(b):f))+'">\n        <section class="counts">\n            <article>\n                <p class="count page-views"></p>\n                <h3>PAGE VIEWS</h3>\n            </article>\n            <article class="second">\n                <p class="count image-likes"></p>\n                <h3>IMAGE LIKES</h3>\n            </article>\n            <article class="third">\n                <p class="count comments"></p>\n                <h3>COMMENTS</h3>\n            </article>\n        </section>\n    </article>\n    <article class="chart-area padded l-bg">\n        <div class="mode-text">\n            <h2>VIEWS PER DAY:</h2>\n            <span></span>\n        </div>\n        <div class="date-picker">\n            <span class="label">DATE</span>\n            <input type="text" class="dp-input from" placeholder="FROM" value="">\n            <input type="text" class="dp-input to" placeholder="TO" value="">\n            <a class="dp-go">GO</a>\n        </div>\n        <canvas width="'+i((f=b.chartWidth,typeof f===h?f.apply(b):f))+'" height="'+i((f=b.chartHeight,typeof f===h?f.apply(b):f))+'"></canvas>\n        <div class="controls">\n            <a class="chart-trigger" data-mode="hourly">HOUR</a>\n            <a class="chart-trigger daily active" data-mode="daily">DAYS</a>\n            <a class="chart-trigger" data-mode="weekly">WEEK</a>\n            <a class="chart-trigger" data-mode="monthly">MONTH</a>\n        </div>\n        <div class="result-loading">\n            <h3>Loading daily stats...</h3>\n            <div class="progress-bar"><span></span></div>\n        </div>\n    </article>\n    <article class="ref-area padded d-bg">\n        <header>\n            <h2>REFERRER</h2>\n            <h3>VIEWED</h3>\n        </header>\n        <section class="ref-results"></section>\n    </article>\n</div>'}),this.IS.templates.image_tag=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='<a href="/search/'+m((c=a.name,typeof c===l?c.apply(a):c))+'/1/?g=0" class="tag" data-name="'+m((c=a.name,typeof c===l?c.apply(a):c))+'">'}function g(a,b){return'<span class="delete">x</span>'}function h(a,b){return"</a>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k="",l="function",m=this.escapeExpression,n=this,o=c.blockHelperMissing;return i=b._backend,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+="\n    "+m((i=b.name,typeof i===l?i.apply(b):i))+"\n    ",i=b.isOwner,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+="\n",i=b._backend,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k}),this.IS.templates.landing=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d,e="";return e+='<section id="landing" class="',c=a.is_owner,c=typeof c===v?c.apply(a):c,d=x.call(a,c,{hash:{},inverse:w.program(2,g,b),fn:w.noop,data:b}),(d||0===d)&&(e+=d),e+='">'}function g(a,b){var c,d;return c=a.isPublic,c=typeof c===v?c.apply(a):c,d=x.call(a,c,{hash:{},inverse:w.program(3,h,b),fn:w.noop,data:b}),d||0===d?d:""}function h(a,b){return"private"}function i(a,b){return'\n                    <div class="you-shall-not-pass"></div>\n                '}function j(a,b){var c,d="";return d+='\n                    <img id="lp-image" data-width="0" data-height="0" alt="'+y((c=a.title,typeof c===v?c.apply(a):c))+'" src="/a/img'+y((c=a.server,typeof c===v?c.apply(a):c))+"/"+y((c=a.bucket,typeof c===v?c.apply(a):c))+"/"+y((c=a.filename,typeof c===v?c.apply(a):c))+"\" onerror=\"this.src='/v2_images/empty.png'; this.className='broken';\">\n                "}function k(a,b){return"hidden"}function l(a,b){return"liked"}function m(a,b){var c,d,e="";return e+='-->\n            <!--<div class="comments-area">-->\n                <!--',c=a.pagination_html,d=typeof c===v?c.apply(a):c,(d||0===d)&&(e+=d),e+='-->\n\n                <!--<section class="comments">-->\n                    <!--',c=a.landing_comments_html,d=typeof c===v?c.apply(a):c,(d||0===d)&&(e+=d),e+='-->\n                <!--</section>-->\n\n                <!--<div class="clearfix comment-input">-->\n                    <!--<img src="'+y((c=a.currentUserAvatarUrl,typeof c===v?c.apply(a):c))+'">-->\n                    <!--<div class="input">-->\n                        <!--<textarea class="comment" placeholder="Add Comment" autocomplete="off" maxlength="500"></textarea>-->\n                        <!--<a class="button-large-yellow submit-button">POST</a>-->\n                        <!--<span class="counter"></span>-->\n                    <!--</div>-->\n                <!--</div>-->\n            <!--</div>-->\n            <!--'}function n(a,b){return'class="shifted"'}function o(a,b){return"premium-badge"}function p(a,b){return'\n                    <article class="is-promo"></article>\n                '}function q(a,b){var c,d="";return d+='\n                                <a data-tooltip="Download" id="share-dl" href="//imageshack.us/download/'+y((c=a.server,typeof c===v?c.apply(a):c))+"/"+y((c=a.filename,typeof c===v?c.apply(a):c))+'" data-bypass="true">\n                                    <figure>\n                                        <span class="front"></span>\n                                        <span class="back"></span>\n                                    </figure>\n                                </a>\n                            '}function r(a,b){return"</section>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var s,t,u="",v="function",w=this,x=c.blockHelperMissing,y=this.escapeExpression;return s=b._backend,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.noop,fn:w.program(1,f,e),data:e}),(t||0===t)&&(u+=t),u+='\n    <article class="top-part clearfix">\n        <section class="left-side dynamic-width">\n            <figure class="image">\n                ',s=b.blockedDownload,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.noop,fn:w.program(5,i,e),data:e}),(t||0===t)&&(u+=t),u+="\n                ",s=b.isGif,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.noop,fn:w.program(7,j,e),data:e}),(t||0===t)&&(u+=t),u+="\n                ",s=b.isGif,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.program(7,j,e),fn:w.noop,data:e}),(t||0===t)&&(u+=t),u+='\n                <a class="is-arrow prev ',s=b.has_prev_image,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.program(9,k,e),fn:w.noop,data:e}),(t||0===t)&&(u+=t),u+='" href="/i/'+y((s=b.prev_image_id,typeof s===v?s.apply(b):s))+'">\n                    <span class="wrapper">\n                        <figure></figure>\n                    </span>\n                </a>\n                <a class="is-arrow next ',s=b.has_next_image,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.program(9,k,e),fn:w.noop,data:e}),(t||0===t)&&(u+=t),u+='" href="/i/'+y((s=b.next_image_id,typeof s===v?s.apply(b):s))+'">\n                    <span class="wrapper">\n                        <figure></figure>\n                    </span>\n                </a>\n                <div class="lb-trigger"><span></span></div>\n            </figure>\n            <div class="image-info">\n                <header>\n                    <h1 title="'+y((s=b.imageTitle,typeof s===v?s.apply(b):s))+'">'+y((s=b.imageTitle,typeof s===v?s.apply(b):s))+'</h1>\n                </header>\n                <div class="stats clearfix">\n\n                    <!--<div class="lb views">-->\n                        <!--VIEWS<b>'+y((s=b.views,typeof s===v?s.apply(b):s))+'</b>-->\n                    <!--</div>-->\n                    <a class="lb likes ',s=b.liked,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.noop,fn:w.program(11,l,e),data:e}),(t||0===t)&&(u+=t),u+='">\n                        <span></span>\n                        <span class="liked"></span>\n                        <!--LIKES<b>'+y((s=b.likes,typeof s===v?s.apply(b):s))+'</b>-->\n                        LIKE\n                    </a>\n                    <!--<a class="stats-trigger" data-label="Icon">-->\n                        <!--<span class="icon-stats"></span>-->\n                        <!--STATS-->\n                    <!--</a>-->\n\n                </div>\n            </div>\n            <div class="related-images">\n                <h2>RELATED IMAGES</h2>\n                <div class="clearfix images">\n                    <div class="wrapper">\n                        ',s=b.related_images_html,t=typeof s===v?s.apply(b):s,(t||0===t)&&(u+=t),u+='\n                    </div>\n                </div>\n                <a class="left disabled"><span><figure></figure></span></a>\n                <a class="right"><span><figure></figure></span></a>\n            </div>\n            <!--',s=b.comments_disabled,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.program(13,m,e),fn:w.noop,data:e}),(t||0===t)&&(u+=t),u+='-->\n        </section>\n        <aside class="right-side">\n            <section class="user-area">\n                <header ',s=b.is_owner,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.noop,fn:w.program(15,n,e),data:e}),(t||0===t)&&(u+=t),u+='>\n                    <a class="profile-link user-anchor" href="/user/'+y((s=b.username,typeof s===v?s.apply(b):s))+'">\n                        <img class="user-avatar" onerror="this.src=\'/v2_images/empty.png\'; this.className+=\' broken\';" src="'+y((s=b.ownerAvatarUrl,typeof s===v?s.apply(b):s))+'">\n                    </a>\n                    <h2>\n                        <a class="user-anchor profile-username ',s=b.showPremiumBadge,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.noop,fn:w.program(17,o,e),data:e}),(t||0===t)&&(u+=t),u+='" href="/user/'+y((s=b.username,typeof s===v?s.apply(b):s))+'">'+y((s=b.username,typeof s===v?s.apply(b):s))+'</a>\n                    </h2>\n                    <time datetime="'+y((s=b.datetime,typeof s===v?s.apply(b):s))+'">Uploaded '+y((s=b.date_string,typeof s===v?s.apply(b):s))+'</time>\n                    <div class="follow"></div>\n                </header>\n                ',s=b.showAd,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.noop,fn:w.program(19,p,e),data:e}),(t||0===t)&&(u+=t),u+='\n            </section>\n\n            <a class="get-links button-large-black">GET LINKS / IMAGE SIZES</a>\n\n            <section class="details">\n                <!--<article class="stats">-->\n                    <!--<h3>IMAGE STATS</h3>-->\n                    <!--<a class="stats-trigger" data-label="Right Side"></a>-->\n                    <!--<figure class="icon-stats"></figure>-->\n                <!--</article>-->\n                <article class="tags">\n                    <h3>TAGS</h3>\n                    <a class="trigger" data-height-selector=".tags-wrapper"></a>\n                    <span></span>\n                    ',s=b.tags_html,t=typeof s===v?s.apply(b):s,(t||0===t)&&(u+=t),u+='\n                </article>\n                <article class="settings">\n                    <h3>CAMERA SETTINGS</h3>\n                    <a class="trigger" data-height-selector=".content"></a>\n                    <span></span>\n                </article>\n                <article class="sharing">\n                    <h3>SHARE</h3>\n                    <div class="share-options">\n                        <div class="clearfix options">\n                            ',s=b.blockedDownload,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.program(21,q,e),fn:w.noop,data:e}),(t||0===t)&&(u+=t),u+='\n                            <a data-tooltip="Email" class="external" data-channel="email" id="share-email" data-category="Landing Page"><span></span></a>\n                            <a data-tooltip="Pinterest" class="external" data-channel="pinterest" id="share-pin" data-category="Landing Page"><span></span></a>\n                            <a data-tooltip="Twitter" class="external" data-channel="twitter" id="share-twitter" data-category="Landing Page"><span></span></a>\n                            <a data-tooltip="Facebook" class="external" data-channel="facebook" id="share-fb" data-category="Landing Page"><span></span></a>\n                        </div>\n                    </div>\n                </article>\n            </section>\n        </aside>\n    </article>\n    \n',s=b._backend,s=typeof s===v?s.apply(b):s,t=x.call(b,s,{hash:{},inverse:w.noop,fn:w.program(23,r,e),data:e}),(t||0===t)&&(u+=t),u+="\n"}),this.IS.templates.landing_ad=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},"<div id='div-gpt-ad-1412719341886-0' style='width:300px; height:250px;'>\n    <script type='text/javascript'>\n        googletag.cmd.push(function(){googletag.display('div-gpt-ad-1412719341886-0');});\n    </script>\n</div>\n"}),this.IS.templates.landing_camera_settings=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='\n<li class="clearfix">\n    <span>Make</span>\n    <p title="'+t((c=a.make,typeof c===s?c.apply(a):c))+'">'+t((c=a.make,typeof c===s?c.apply(a):c))+"</p>\n</li>\n"}function g(a,b){var c,d="";return d+='\n<li class="clearfix">\n    <span>Model</span>\n    <p title="'+t((c=a.model,typeof c===s?c.apply(a):c))+'">'+t((c=a.model,typeof c===s?c.apply(a):c))+"</p>\n</li>\n"}function h(a,b){var c,d="";return d+='\n<li class="clearfix">\n    <span>Aperture</span>\n    <p title="'+t((c=a.aperture,typeof c===s?c.apply(a):c))+'">'+t((c=a.aperture,typeof c===s?c.apply(a):c))+"</p>\n</li>\n"}function i(a,b){var c,d="";return d+='\n<li class="clearfix">\n    <span>Date &amp; Time</span>\n    <p title="'+t((c=a.datetime,typeof c===s?c.apply(a):c))+'">'+t((c=a.datetime,typeof c===s?c.apply(a):c))+"</p>\n</li>\n"}function j(a,b){var c,d="";return d+='\n<li class="clearfix">\n    <span>Exposure Time</span>\n    <p title="'+t((c=a.exposuretime,typeof c===s?c.apply(a):c))+'">'+t((c=a.exposuretime,typeof c===s?c.apply(a):c))+"</p>\n</li>\n"}function k(a,b){var c,d="";return d+='\n<li class="clearfix">\n    <span>Focal Length</span>\n    <p title="'+t((c=a.focallength,typeof c===s?c.apply(a):c))+'">'+t((c=a.focallength,typeof c===s?c.apply(a):c))+"</p>\n</li>\n"}function l(a,b){var c,d="";return d+='\n<li class="clearfix">\n    <span>ISO</span>\n    <p title="'+t((c=a.iso,typeof c===s?c.apply(a):c))+'">'+t((c=a.iso,typeof c===s?c.apply(a):c))+"</p>\n</li>\n"}function m(a,b){var c,d="";return d+='\n<li class="clearfix">\n    <span>Dimensions</span>\n    <p>'+t((c=a.width,typeof c===s?c.apply(a):c))+" x "+t((c=a.height,typeof c===s?c.apply(a):c))+"</p>\n</li>\n"}function n(a,b){var c,d="";return d+='\n<li class="clearfix">\n    <span>Size</span>\n    <p title="'+t((c=a.formattedSize,typeof c===s?c.apply(a):c))+'">'+t((c=a.parsedSize,typeof c===s?c.apply(a):c))+"</p>\n</li>\n"}function o(a,b){return'\n<li class="none">\n    <span class="none">No settings</span>\n</li>\n'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var p,q,r="",s="function",t=this.escapeExpression,u=this,v=c.blockHelperMissing;return p=b.hasMake,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(1,f,e),data:e}),(q||0===q)&&(r+=q),r+="\n",p=b.hasModel,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(3,g,e),
data:e}),(q||0===q)&&(r+=q),r+="\n",p=b.hasAperture,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(5,h,e),data:e}),(q||0===q)&&(r+=q),r+="\n",p=b.hasDate,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(7,i,e),data:e}),(q||0===q)&&(r+=q),r+="\n",p=b.hasExposureTime,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(9,j,e),data:e}),(q||0===q)&&(r+=q),r+="\n",p=b.hasFocalLength,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(11,k,e),data:e}),(q||0===q)&&(r+=q),r+="\n",p=b.hasISO,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(13,l,e),data:e}),(q||0===q)&&(r+=q),r+="\n",p=b.hasDimensions,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(15,m,e),data:e}),(q||0===q)&&(r+=q),r+="\n",p=b.hasSize,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(17,n,e),data:e}),(q||0===q)&&(r+=q),r+="\n",p=b.noSettings,p=typeof p===s?p.apply(b):p,q=v.call(b,p,{hash:{},inverse:u.noop,fn:u.program(19,o,e),data:e}),(q||0===q)&&(r+=q),r+="\n\n\n\n\n"}),this.IS.templates.landing_comment=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='<article id="c-'+n((c=a.id,typeof c===m?c.apply(a):c))+'" class="clearfix loaded">'}function g(a,b){return"premium-badge"}function h(a,b){return'\n    <a data-tooltip="Delete" data-tooltip-left="7" data-tooltip-top="1" class="destroy"></a>\n    '}function i(a,b){return"</article>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j,k,l="",m="function",n=this.escapeExpression,o=this,p=c.blockHelperMissing;return j=b._backend,j=typeof j===m?j.apply(b):j,k=p.call(b,j,{hash:{},inverse:o.noop,fn:o.program(1,f,e),data:e}),(k||0===k)&&(l+=k),l+='\n    <a class="avatar" href="/user/'+n((j=b.username,typeof j===m?j.apply(b):j))+'">\n        <img src="'+n((j=b.avatarUrl,typeof j===m?j.apply(b):j))+'" alt="'+n((j=b.username,typeof j===m?j.apply(b):j))+'">\n    </a>\n    <div class="message">\n        <a class="profile-link ',j=b.showPremiumBadge,j=typeof j===m?j.apply(b):j,k=p.call(b,j,{hash:{},inverse:o.noop,fn:o.program(3,g,e),data:e}),(k||0===k)&&(l+=k),l+='" href="/user/'+n((j=b.username,typeof j===m?j.apply(b):j))+'">'+n((j=b.username,typeof j===m?j.apply(b):j))+'</a>\n        <time datetime="'+n((j=b.datetime,typeof j===m?j.apply(b):j))+'">'+n((j=b.pretty_date,typeof j===m?j.apply(b):j))+'</time>\n        <div class="text">\n            ',j=b.comment_processed,k=typeof j===m?j.apply(b):j,(k||0===k)&&(l+=k),l+="\n        </div>\n    </div>\n    ",j=b.is_owner,j=typeof j===m?j.apply(b):j,k=p.call(b,j,{hash:{},inverse:o.noop,fn:o.program(5,h,e),data:e}),(k||0===k)&&(l+=k),l+="\n",j=b._backend,j=typeof j===m?j.apply(b):j,k=p.call(b,j,{hash:{},inverse:o.noop,fn:o.program(7,i,e),data:e}),(k||0===k)&&(l+=k),l}),this.IS.templates.landing_comments_pagination=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<div class="paginator clearfix">'}function g(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing,n=this.escapeExpression;return h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <h3>Load previous comments</h3>\n    <div class="count">'+n((h=b.current,typeof h===k?h.apply(b):h))+" of "+n((h=b.total,typeof h===k?h.apply(b):h))+"</div>\n",h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j}),this.IS.templates.landing_stream=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<section class="stream">'}function g(a,b){var c,d="";return d+='href="/i/'+u((c=a.next_image_id,typeof c===t?c.apply(a):c))+'"'}function h(a,b){return"disabled"}function i(a,b){var c,d,e="";return e+="\n        ",c=a.has_second_next_image,c=typeof c===t?c.apply(a):c,d=w.call(a,c,{hash:{},inverse:v.noop,fn:v.program(8,j,b),data:b}),(d||0===d)&&(e+=d),e+="\n        "}function j(a,b){var c,d="";return d+='\n        <a class="next" href="/i/'+u((c=a.second_next_image_id,typeof c===t?c.apply(a):c))+'">\n            <figure style="background-image: url(\'/scaled/thumb60x60/'+u((c=a.second_next_image_server,typeof c===t?c.apply(a):c))+"/"+u((c=a.second_next_image_filename,typeof c===t?c.apply(a):c))+"');\"></figure>\n        </a>\n        "}function k(a,b){var c,d="";return d+='\n        <a class="next" href="/i/'+u((c=a.next_image_id,typeof c===t?c.apply(a):c))+'">\n            <figure style="background-image: url(\'/scaled/thumb60x60/'+u((c=a.next_image_server,typeof c===t?c.apply(a):c))+"/"+u((c=a.next_image_filename,typeof c===t?c.apply(a):c))+"');\"></figure>\n        </a>\n        "}function l(a,b){var c,d="";return d+='\n        <a class="prev" href="/i/'+u((c=a.prev_image_id,typeof c===t?c.apply(a):c))+'">\n            <figure style="background-image: url(\'/scaled/thumb60x60/'+u((c=a.prev_image_server,typeof c===t?c.apply(a):c))+"/"+u((c=a.prev_image_filename,typeof c===t?c.apply(a):c))+"');\"></figure>\n        </a>\n        "}function m(a,b){var c,d,e="";return e+="\n        ",c=a.has_second_prev_image,c=typeof c===t?c.apply(a):c,d=w.call(a,c,{hash:{},inverse:v.noop,fn:v.program(15,n,b),data:b}),(d||0===d)&&(e+=d),e+="\n        "}function n(a,b){var c,d="";return d+='\n        <a class="prev" href="/i/'+u((c=a.second_prev_image_id,typeof c===t?c.apply(a):c))+'">\n            <figure style="background-image: url(\'/scaled/thumb60x60/'+u((c=a.second_prev_image_server,typeof c===t?c.apply(a):c))+"/"+u((c=a.second_prev_image_filename,typeof c===t?c.apply(a):c))+"');\"></figure>\n        </a>\n        "}function o(a,b){var c,d="";return d+='href="/i/'+u((c=a.prev_image_id,typeof c===t?c.apply(a):c))+'"'}function p(a,b){return"</section>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var q,r,s="",t="function",u=this.escapeExpression,v=this,w=c.blockHelperMissing;return q=b._backend,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(1,f,e),data:e}),(r||0===r)&&(s+=r),s+="\n    <a ",q=b.has_next_image,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(3,g,e),data:e}),(r||0===r)&&(s+=r),s+=' class="arrow next ',q=b.has_next_image,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.program(5,h,e),fn:v.noop,data:e}),(r||0===r)&&(s+=r),s+='"><span></span></a>\n\n    <div class="clearfix thumbs">\n        ',q=b.has_prev_image,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.program(7,i,e),fn:v.noop,data:e}),(r||0===r)&&(s+=r),s+="\n        ",q=b.has_next_image,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(10,k,e),data:e}),(r||0===r)&&(s+=r),s+='\n        <figure class="current" style="background-image: url(\'/scaled/thumb60x60/'+u((q=b.server,typeof q===t?q.apply(b):q))+"/"+u((q=b.filename,typeof q===t?q.apply(b):q))+"');\"></figure>\n        ",q=b.has_prev_image,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(12,l,e),data:e}),(r||0===r)&&(s+=r),s+="\n        ",q=b.has_next_image,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.program(14,m,e),fn:v.noop,data:e}),(r||0===r)&&(s+=r),s+="\n    </div>\n\n    <a ",q=b.has_prev_image,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(17,o,e),data:e}),(r||0===r)&&(s+=r),s+=' class="arrow prev ',q=b.has_prev_image,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.program(5,h,e),fn:v.noop,data:e}),(r||0===r)&&(s+=r),s+='"><span></span></a>\n',q=b._backend,q=typeof q===t?q.apply(b):q,r=w.call(b,q,{hash:{},inverse:v.noop,fn:v.program(19,p,e),data:e}),(r||0===r)&&(s+=r),s}),this.IS.templates.landing_tags=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<div class="content">'}function g(a,b){var c,d,e="";return e+="\n                ",c=a.isOwner,c=typeof c===o?c.apply(a):c,d=q.call(a,c,{hash:{},inverse:p.program(4,h,b),fn:p.noop,data:b}),(d||0===d)&&(e+=d),e+="\n            "}function h(a,b){return'\n                    <span class="none">No tags</span>\n                '}function i(a,b){var c,d,e="";return e+="\n                ",c=a.tagsHtml,d=typeof c===o?c.apply(a):c,(d||0===d)&&(e+=d),e+="\n            "}function j(a,b){return'\n            <div class="add-tags">\n                <input type="text" value="" name="tags" placeholder="Add your tags..." />\n                <div class="how">\n                    Tags separated by space, multiple words must be "wrapped in quotes"\n                </div>\n            </div>\n        '}function k(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var l,m,n="",o="function",p=this,q=c.blockHelperMissing;return l=b._backend,l=typeof l===o?l.apply(b):l,m=q.call(b,l,{hash:{},inverse:p.noop,fn:p.program(1,f,e),data:e}),(m||0===m)&&(n+=m),n+='\n    <div class="tags-wrapper">\n        <div class="clearfix items">\n            ',l=b.areTags,l=typeof l===o?l.apply(b):l,m=q.call(b,l,{hash:{},inverse:p.program(3,g,e),fn:p.noop,data:e}),(m||0===m)&&(n+=m),n+="\n            ",l=b.areTags,l=typeof l===o?l.apply(b):l,m=q.call(b,l,{hash:{},inverse:p.noop,fn:p.program(6,i,e),data:e}),(m||0===m)&&(n+=m),n+="\n        </div>\n        ",l=b.isOwner,l=typeof l===o?l.apply(b):l,m=q.call(b,l,{hash:{},inverse:p.noop,fn:p.program(8,j,e),data:e}),(m||0===m)&&(n+=m),n+="\n    </div>\n",l=b._backend,l=typeof l===o?l.apply(b):l,m=q.call(b,l,{hash:{},inverse:p.noop,fn:p.program(10,k,e),data:e}),(m||0===m)&&(n+=m),n}),this.IS.templates.lightbox=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<div class="lightbox">'}function g(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing;return h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <div class="content">',h=b.content,i=typeof h===k?h.apply(b):h,(i||0===i)&&(j+=i),j+="</div>\n",h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j}),this.IS.templates.lightbox_add_filters=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div class="lightbox-add-filters">\n    <h1>ADD FILTERS</h1>\n    <div class="line"></div>\n    <div class="lightbox-filters dropdown">\n        <div class="selected-label initial">ADD FILTER</div>\n        <div class="arrow"></div>\n        <div class="selection">\n            <div class="item" data-value="bacon">bacon</div>\n            <div class="item" data-value="eggs">eggs</div>\n            <div class="item" data-value="water">water</div>\n            <div class="item" data-value="soda">soda</div>\n            <div class="item" data-value="coffee">coffee</div>\n        </div>\n    </div>\n    <div class="images clearfix">\n        <img src="" />\n        <img src="" />\n        <img src="" />\n    </div>\n    <div class="line"></div>\n    <div class="buttons">\n        <div class="button-grey-cancel">CANCEL</div>\n        <div class="button-dark">ADD FILTER</div>\n    </div>\n    <div class="clearer"></div>\n</div>'}),this.IS.templates.lightbox_add_tags=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="lightbox-add-tags">\n    <div class="close"></div>\n    <h1>ADD TAGS</h1>\n    <div class="line"></div>\n    <p class="tip">\n        You have selected '+i((f=b.count,typeof f===h?f.apply(b):f))+' image(s) to add tags to.\n    </p>\n    <div class="items"></div>\n    <div class="add-tags clearfix">\n        <input type="text" name="tags" placeholder="Add your tags and press enter..." />\n        <!-- <div class="button-dark">ADD TAGS</div> -->\n    </div>\n    <p class="tip tiny">\n        Tags separated by space, multiple words "wrapped in quotes"\n    </p>\n    <div class="line"></div>\n    <div class="buttons">\n        <div class="button-grey-cancel">CANCEL</div>\n        <div class="button-dark send">ADD TAGS</div>\n    </div>\n    <div class="clearer"></div>\n</div>'}),this.IS.templates.lightbox_delete_images=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div class="lightbox-delete-images">\n    <h1>DELETE IMAGES</h1>\n    <div class="line"></div>\n    <p class="tip">\n        You are about to delete the following <span class="count"></span> images. Are you sure?\n    </p>\n    <p class="error">\n        Something went wrong. Please try again later.\n    </p>\n    <div class="images clearfix"></div>\n    <div class="line"></div>\n    <div class="buttons">\n        <div class="button-grey-cancel">CANCEL</div>\n        <div class="button-dark">DELETE IMAGES</div>\n    </div>\n    <div class="clearer"></div>\n</div>'}),this.IS.templates.lightbox_get_links=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="lightbox-get-links">\n    <div class="close"></div>\n    <h1>GET LINKS</h1>\n    <div class="clearfix c-wrapper">\n        <div class="clearfix types">\n            <div class="label">TYPE</div>\n            <div class="dropdown">\n                <div class="selected-label initial" data-value="direct">Direct</div>\n                <div class="arrow"></div>\n                <div class="selection">\n                    <div class="item prevent-click" data-value="">Select One</div>\n                    <div class="item '+i((f=b.otherClass,typeof f===h?f.apply(b):f))+'" data-value="direct">Direct</div>\n                    <div class="item" data-value="forum">Forum</div>\n                    <div class="item" data-value="alt-forum">Alt Forum</div>\n                    <div class="item" data-value="web">HTML</div>\n                </div>\n            </div>\n        </div>\n        <div class="sizes">\n            <div class="label">SIZE</div>\n            <div class="dropdown">\n                <div class="selected-label initial" data-value="">Fullsize</div>\n                <div class="arrow"></div>\n                <div class="selection">\n                    <div class="item prevent-click" data-value="">Select One</div>\n                    <div class="item '+i((f=b.otherClass,typeof f===h?f.apply(b):f))+'" data-value="">Fullsize</div>\n                    <div class="item" data-value="100x75">100 x 75 (avatar)</div>\n                    <div class="item" data-value="150x100">150 x 100 (thumbnail)</div>\n                    <div class="item" data-value="280x200">280 x 200 (thumbnail)</div>\n                    <div class="item '+i((f=b.otherClass,typeof f===h?f.apply(b):f))+'" data-value="320x240">320 x 240 (small)</div>\n                    <div class="item '+i((f=b.otherClass,typeof f===h?f.apply(b):f))+'" data-value="640x480">640 x 480 (medium)</div>\n                    <div class="item '+i((f=b.otherClass,typeof f===h?f.apply(b):f))+'" data-value="800x600">800 x 600</div>\n                    <div class="item '+i((f=b.otherClass,typeof f===h?f.apply(b):f))+'" data-value="1024x768">1024 x 768 (large)</div>\n                    <div class="item '+i((f=b.otherClass,typeof f===h?f.apply(b):f))+'" data-value="1280x1024">1280 x 1024</div>\n                    <div class="item '+i((f=b.otherClass,typeof f===h?f.apply(b):f))+'" data-value="1600x1200">1600 x 1200</div>\n                </div>\n            </div>\n        </div>\n        <a class="select-toggle">SELECT ALL</a>\n    </div>\n\n    <textarea class="links"></textarea>\n\n    <div class="clearer"></div>\n</div>\n'}),this.IS.templates.lightbox_new_album=Handlebars.template(function(a,b,c,d,e){function f(a,b){return"\n        <h1>ADD NEW ALBUM</h1>\n    "}function g(a,b){return"\n        <h1>CHANGE ALBUM PRIVACY</h1>\n    "}function h(a,b){return'\n        <h1 class="create">CREATE ALBUM</h1>\n        <div class="dropdown">\n            <div class="selected-label initial">ADD TO ALBUM</div>\n            <div class="arrow"></div>\n            <div class="loading">Loading...</div>\n            <div class="no-results">No Albums.</div>\n            <div class="selection"></div>\n        </div>\n    '}function i(a,b){var c,d,e="";return e+="\n        ",c=a.showMoveMsg,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(8,j,b),data:b}),(d||0===d)&&(e+=d),e+="\n        ",c=a.showAddMsg,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(10,k,b),data:b}),(d||0===d)&&(e+=d),e+='\n        <div class="line"></div>\n    '}function j(a,b){var c,d="";return d+='\n            <div class="move">\n                <div class="msg">You are <strong>moving</strong> '+w((c=a.moveThumbCount,typeof c===v?c.apply(a):c))+' image(s) into <span class="album-name">a new</span> album.</div>\n                <div class="thumbs clearfix"></div>\n            </div>\n        '}function k(a,b){var c,d,e="";return e+='\n            <div class="add ',c=a.moveThumbCount,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(11,l,b),data:b}),(d||0===d)&&(e+=d),e+='">\n                <div class="msg">You are <strong>adding</strong> '+w((c=a.addThumbCount,typeof c===v?c.apply(a):c))+' image(s) into <span class="album-name">a new</span> album.</div>\n                <div class="thumbs clearfix"></div>\n            </div>\n        '}function l(a,b){return"padding"}function m(a,b){return'\n            <div class="bordered-input arrow top">\n                <input type="text" name="name" class="title" autocomplete="on" placeholder="NAME ALBUM">\n            </div>\n        '}function n(a,b){return'\n            <div class="bordered-input">\n                <textarea name="description" placeholder="ADD DESCRIPTION"></textarea>\n            </div>\n            <div class="line"></div>\n        '}function o(a,b){return"selected"}function p(a,b){return"ADD ALBUM"}function q(a,b){return"CREATE ALBUM"}function r(a,b){return"UPDATE ALBUM"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var s,t,u="",v="function",w=this.escapeExpression,x=this,y=c.blockHelperMissing;return u+='<div class="lightbox-new-album">\n    ',s=b.navbarVersion,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(1,f,e),data:e}),(t||0===t)&&(u+=t),u+="\n    ",s=b.editVersion,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(3,g,e),data:e}),(t||0===t)&&(u+=t),u+="\n    ",s=b.regularVersion,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(5,h,e),data:e}),(t||0===t)&&(u+=t),u+='\n    <div class="line"></div>\n    ',s=b.regularVersion,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(7,i,e),data:e}),(t||0===t)&&(u+=t),u+='\n    <div class="add-fields">\n        ',s=b.showTitle,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(13,m,e),data:e}),(t||0===t)&&(u+=t),u+="\n        ",s=b.navbarVersion,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(15,n,e),data:e}),(t||0===t)&&(u+=t),u+='\n        <div class="privacy clearfix">\n            <div class="item clearfix">\n                <div class="left">\n                    <div class="radio-green public-trigger trackable ',s=b.privateSelected,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.program(17,o,e),fn:x.noop,data:e}),(t||0===t)&&(u+=t),u+='" data-id="public"></div>\n                </div>\n                <div class="right">\n                    <div class="strong">Public</div>\n                    <div class="tip">This album will be visible to anyone.</div>\n                </div>\n            </div>\n            <div class="item clearfix">\n                <div class="left">\n                    <div class="radio-green private-trigger trackable ',s=b.privateSelected,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(17,o,e),data:e}),(t||0===t)&&(u+=t),u+='" data-id="private"></div>\n                </div>\n                <div class="right">\n                    <div class="strong">Private</div>\n                    <div class="tip">Only you and people with the share link will be able to view.</div>\n                </div>\n            </div>\n            <div class="item clearfix">\n                <div class="left">\n                    <div class="radio-green private-password-trigger trackable" data-id="private-pass"></div>\n                </div>\n                <div class="right">\n                    <div class="strong">Private with password</div>\n                    <div class="tip">Only you and people who have the password and link can view this album.</div>\n                </div>\n                <div class="passwords">\n                    <div class="bordered-input arrow top">\n                        <input type="password" name="pass" class="pass" placeholder="'+w((s=b.passPlaceholder,typeof s===v?s.apply(b):s))+'">\n                    </div>\n                    <div class="bordered-input arrow top">\n                        <input type="password" name="pass_confirm" class="pass-confirm" placeholder="'+w((s=b.passConfirmPlaceholder,typeof s===v?s.apply(b):s))+'">\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="line"></div>\n    <div class="buttons">\n        <div class="button-grey-cancel">CANCEL</div>\n        <div class="button-dark add">\n            ',s=b.navbarVersion,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(19,p,e),data:e}),(t||0===t)&&(u+=t),u+="\n            ",s=b.regularVersion,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(21,q,e),data:e}),(t||0===t)&&(u+=t),u+="\n            ",s=b.editVersion,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(23,r,e),data:e}),(t||0===t)&&(u+=t),u+='\n        </div>\n    </div>\n    <div class="clearer"></div>\n</div>'}),this.IS.templates.lightbox_privacy=Handlebars.template(function(a,b,c,d,e){function f(a,b){return"selected"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this,m=c.blockHelperMissing;return i+='<div class="lightbox-privacy">\n    <h1>IMAGE PRIVACY</h1>\n    <div class="line"></div>\n    <div class="privacy clearfix">\n        <p class="tip">You have selected '+k((g=b.imageCount,typeof g===j?g.apply(b):g))+' image(s). Please change their privacy settings below.</p>\n        <div class="item clearfix">\n            <div class="left">\n                <div class="radio-green ',g=b.private_images,g=typeof g===j?g.apply(b):g,h=m.call(b,g,{hash:{},inverse:l.program(1,f,e),fn:l.noop,data:e}),(h||0===h)&&(i+=h),i+='" data-id="public"></div>\n            </div>\n            <div class="right">\n                <div class="strong">Public</div>\n                <div class="tip">This image will be visible to anyone.</div>\n            </div>\n        </div>\n        <div class="item clearfix">\n            <div class="left">\n                <div class="radio-green ',g=b.private_images,g=typeof g===j?g.apply(b):g,h=m.call(b,g,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+='" data-id="private"></div>\n            </div>\n            <div class="right">\n                <div class="strong">Private</div>\n                <div class="tip">Only you and people you share with will be able to view this image.</div>\n            </div>\n        </div>\n    </div>\n    <div class="line"></div>\n    <div class="buttons">\n        <div class="button-grey-cancel">CANCEL</div>\n        <div class="button-dark save">SAVE</div>\n    </div>\n    <div class="clearer"></div>\n</div>'}),this.IS.templates.lightbox_rotate=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="lightbox-rotate">\n    <h1>ROTATE IMAGE</h1>\n    <div class="line"></div>\n    <div class="inner clearfix">\n        <div class="rotate-buttons">\n            <div class="button rotate" data-action="90-left">Left</div>\n            <div class="button rotate" data-action="180">Rotate 180&deg;</div>\n            <div class="button rotate" data-action="90-right">Right</div>\n        </div>\n        <div class="hero">\n            <img src="'+i((f=b.heroURL,typeof f===h?f.apply(b):f))+'" />\n        </div>\n    </div>\n    <div class="line"></div>\n    <div class="buttons">\n        <div class="button-grey-cancel">CANCEL</div>\n        <div class="button-dark save">SAVE</div>\n    </div>\n    <div class="clearer"></div>\n</div>'}),this.IS.templates.minimized_uploader=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<h3>UPLOADING IMAGES...</h3>\n<p class="count">'+i((f=b.count,typeof f===h?f.apply(b):f))+" of "+i((f=b.total,typeof f===h?f.apply(b):f))+'</p>\n<figure><span style="width: '+i((f=b.progress,typeof f===h?f.apply(b):f))+'%"></span></figure>\n<a class="close-me"><span></span></a>'}),this.IS.templates.mobile_layout_overlay_add_album=Handlebars.template(function(a,b,c,d,e){function f(a,b){return"active"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this,l=c.blockHelperMissing;return i+='<header>\n    <h1>CREATE ALBUM</h1>\n</header>\n<form>\n    <div class="input">\n        <input type="text" name="title" placeholder="TITLE" />\n    </div>\n    <div class="input">\n        <textarea name="description" placeholder="DESCRIPTION"></textarea>\n    </div>\n    <div class="selector clearfix">\n        <div class="option left ',g=b.privateAlbums,g=typeof g===j?g.apply(b):g,h=l.call(b,g,{hash:{},inverse:k.program(1,f,e),fn:k.noop,data:e}),(h||0===h)&&(i+=h),i+='" data-value="public">\n            <span class="icon-check"></span>\n            <span class="text">PUBLIC</span>\n        </div>\n        <div class="option right ',g=b.privateAlbums,g=typeof g===j?g.apply(b):g,h=l.call(b,g,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+='" data-value="private">\n            <span class="icon-check"></span>\n            <span class="text">PRIVATE</span>\n        </div>\n    </div>\n    <div class="ask-password ',g=b.privateAlbums,g=typeof g===j?g.apply(b):g,h=l.call(b,g,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+='">\n        <p>PASSWORD PROTECT THIS ALBUM? <input type="checkbox" class="checkbox" name="protected" /></p>\n        <div class="password">\n            <input type="password" name="password" placeholder="PASSWORD" />\n        </div>\n    </div>\n    <input type="submit" class="hidden-submit" />\n    <a class="submit">CREATE ALBUM</a>\n</form>\n'}),this.IS.templates.mobile_layout_overlay_album_pass=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<header>\n    <h1>PRIVATE ALBUM</h1>\n    <p>To view please provide a password.</p>\n</header>\n<form>\n    <div class="input">\n        <input type="password" name="password" placeholder="PASSWORD" />\n    </div>\n    <input type="submit" class="hidden-submit" />\n    <a class="submit">VIEW ALBUM</a>\n</form>\n'}),this.IS.templates.mobile_layout_overlay_edit_album=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='\n        <a class="add">\n            <div class="text">ADD IMAGES</div>\n            <form class="fake-upload" method="post" action="/rest_api/v2/images" enctype="multipart/form-data" data-type="album">\n                <input type="file" name="file" class="file-input" accept="image/*" autocomplete="off" />\n                <input type="hidden" name="album" value="'+m((c=a.albumId,typeof c===l?c.apply(a):c))+'" class="album-id" />\n            </form>\n        </a>\n    '}function g(a,b){return'\n        <a class="make-private">MAKE PRIVATE</a>\n    '}function h(a,b){return'\n        <a class="make-public">MAKE PUBLIC</a>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k="",l="function",m=this.escapeExpression,n=this,o=c.blockHelperMissing;return k+='<nav class="main">\n    ',i=b.canUpload,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+="\n    ",i=b.isPublic,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+="\n    ",i=b.isPrivate,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k+='\n    <a class="delete">DELETE ALBUM</a>\n    <a class="share">SHARE</a>\n    <section class="sub share">\n        <a data-type="twitter">TWITTER</a>\n        <!-- <a data-type="fb">FACEBOOK</a> -->\n        <a data-type="email" href="'+m((i=b.emailMailto,typeof i===l?i.apply(b):i))+'">EMAIL</a>\n    </section>\n    <a class="edit">EDIT ALBUM INFO</a>\n</nav>\n<section class="edit">\n    <header>\n        <h1>EDIT ALBUM INFO</h1>\n    </header>\n    <form class="edit-album">\n        <div class="input">\n            <input type="text" name="title" value="'+m((i=b.title,typeof i===l?i.apply(b):i))+'" placeholder="TITLE" />\n        </div>\n        <div class="input">\n            <textarea name="description" placeholder="DESCRIPTION">'+m((i=b.description,typeof i===l?i.apply(b):i))+'</textarea>\n        </div>\n        <input type="submit" class="hidden-submit" />\n        <a class="submit">SAVE</a>\n    </form>\n</section>\n'}),this.IS.templates.my_tags_item=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<div class="tag">'}function g(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing,n=this.escapeExpression;return h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <div class="left">\n        <a href="/my/tags/detail/'+n((h=b.name,typeof h===k?h.apply(b):h))+'/1" class="name">'+n((h=b.name,typeof h===k?h.apply(b):h))+'</a>\n        <span class="count">'+n((h=b.count,typeof h===k?h.apply(b):h))+'</span>\n    </div>\n    <div class="right">',h=b.thumbs,i=typeof h===k?h.apply(b):h,(i||0===i)&&(j+=i),j+="</div>\n",h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j}),this.IS.templates.onboarding_step_1=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<section class="ob-step" id="ob-step-1">\n    <div class="wrapper top-right">\n        <p>Update and upgrade your account, control privacy, and even receive help!</p>\n        <a>'+i((f=b.nextText,typeof f===h?f.apply(b):f))+"</a>\n    </div>\n</section>"}),this.IS.templates.onboarding_step_2=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<section class="ob-step" id="ob-step-2">\n    <div class="wrapper left-top">\n        <p>Explore new images on the "Discover" page.</p>\n        <a>'+i((f=b.nextText,typeof f===h?f.apply(b):f))+"</a>\n    </div>\n</section>"}),this.IS.templates.onboarding_step_3=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),
e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<section class="ob-step" id="ob-step-3">\n    <div class="wrapper left-top">\n        <p>Under "All Images" get links in bulk. Manage your images by deleting, changing privacy, and sharing.</p>\n        <a>'+i((f=b.nextText,typeof f===h?f.apply(b):f))+"</a>\n    </div>\n</section>"}),this.IS.templates.onboarding_step_4=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<section class="ob-step" id="ob-step-4">\n    <div class="wrapper left-top">\n        <p>Click here to grab links, share and delete an individual image.</p>\n        <a>'+i((f=b.nextText,typeof f===h?f.apply(b):f))+"</a>\n    </div>\n</section>"}),this.IS.templates.onboarding_step_5=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<section class="ob-step" id="ob-step-5">\n    <div class="wrapper left-top">\n        <p>Manage multiple images by <b>clicking the check mark</b>\n         on the image or by <b>holding down the shift key</b> and clicking \n         each image.</p>\n        <a>'+i((f=b.nextText,typeof f===h?f.apply(b):f))+"</a>\n    </div>\n</section>"}),this.IS.templates.photographer=Handlebars.template(function(a,b,c,d,e){function f(a,b){return"on"}function g(a,b){var c,d="";return d+='\n    <section class="images">\n        <a class="first" href="/i/'+m((c=a.image1LP,typeof c===l?c.apply(a):c))+'" style="background-image: url(\''+m((c=a.image1URL,typeof c===l?c.apply(a):c))+'\')"></a>\n        <a class="second" href="/i/'+m((c=a.image2LP,typeof c===l?c.apply(a):c))+'" style="background-image: url(\''+m((c=a.image2URL,typeof c===l?c.apply(a):c))+'\')"></a>\n        <a class="third" href="/i/'+m((c=a.image3LP,typeof c===l?c.apply(a):c))+'" style="background-image: url(\''+m((c=a.image3URL,typeof c===l?c.apply(a):c))+"')\"></a>\n    </section>\n"}function h(a,b){var c,d="";return d+='\n    <p class="website">Visit '+m((c=a.firstName,typeof c===l?c.apply(a):c))+"'s personal site <a href=\""+m((c=a.website,typeof c===l?c.apply(a):c))+'" data-bypass="true">'+m((c=a.websiteClean,typeof c===l?c.apply(a):c))+"</a></p>\n"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k="",l="function",m=this.escapeExpression,n=this,o=c.blockHelperMissing;return k+='<header>\n    <a class="avatar" href="/user/'+m((i=b.username,typeof i===l?i.apply(b):i))+'">\n        <img src="'+m((i=b.avatarURL,typeof i===l?i.apply(b):i))+'" alt="'+m((i=b.username,typeof i===l?i.apply(b):i))+'" onerror="this.src=\'/v2_images/default_avatar_120x120.jpg\'">\n    </a>\n    <div class="info">\n        <h1>'+m((i=b.firstName,typeof i===l?i.apply(b):i))+" "+m((i=b.lastName,typeof i===l?i.apply(b):i))+'</h1>\n        <time datetime="'+m((i=b.dateTime,typeof i===l?i.apply(b):i))+'">Featured: '+m((i=b.publishDate,typeof i===l?i.apply(b):i))+'</time>\n    </div>\n    <a data-force-login="true" class="fading-button follow-button ',i=b.isFollowed,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='" data-following="'+m((i=b.followValue,typeof i===l?i.apply(b):i))+'">\n        <span class="front">FOLLOW</span>\n        <span class="back">UNFOLLOW</span>\n    </a>\n</header>\n',i=b.hasLatestImages,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='\n<p class="bio">'+m((i=b.bio,typeof i===l?i.apply(b):i))+"</p>\n",i=b.hasWebsite,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k+='\n<section class="social-sites">',i=b.socialSites,j=typeof i===l?i.apply(b):i,(j||0===j)&&(k+=j),k+="</section>\n"}),this.IS.templates.photographer_condensed=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<a href="/user/'+i((f=b.username,typeof f===h?f.apply(b):f))+'" class="clearfix">\n    <img src="'+i((f=b.avatarURL,typeof f===h?f.apply(b):f))+'" onerror="this.src=\'/v2_images/default_avatar_120x120.jpg\';">\n    <span class="info">\n        <h2>'+i((f=b.firstName,typeof f===h?f.apply(b):f))+" "+i((f=b.lastName,typeof f===h?f.apply(b):f))+'</h2>\n        <time datetime="'+i((f=b.dateTime,typeof f===h?f.apply(b):f))+'">Featured: '+i((f=b.publishDate,typeof f===h?f.apply(b):f))+"</time>\n    </span>\n</a>"}),this.IS.templates.profile_banner_multi=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='\n                <a href="/i/'+m((c=a.id,typeof c===l?c.apply(a):c))+'">\n                    <img class="front active" src="'+m((c=a.imageUrl,typeof c===l?c.apply(a):c))+'">\n                </a>\n                <a href="#">\n                    <img class="back" src="/v2_images/empty.png">\n                </a>\n            '}function g(a,b){var c,d="";return d+='\n                <a href="/i/'+m((c=a.id_1,typeof c===l?c.apply(a):c))+'">\n                    <img class="front active" src="'+m((c=a.imageUrl1,typeof c===l?c.apply(a):c))+'">\n                </a>\n                <a href="#">\n                    <img class="back" src="/v2_images/empty.png">\n                </a>\n            '}function h(a,b){var c,d="";return d+='\n                <a href="/i/'+m((c=a.id_2,typeof c===l?c.apply(a):c))+'">\n                    <img class="front active" src="'+m((c=a.imageUrl2,typeof c===l?c.apply(a):c))+'">\n                </a>\n                <a href="#">\n                    <img class="back" src="/v2_images/empty.png">\n                </a>\n            '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k="",l="function",m=this.escapeExpression,n=this,o=c.blockHelperMissing;return k+='<figure class="banner-box '+m((i=b.box_type,typeof i===l?i.apply(b):i))+'" style="left: '+m((i=b.left,typeof i===l?i.apply(b):i))+'px">\n    <div class="wrapper">\n        <div class="box-0">\n            ',i=b.hasImg,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='\n        </div>\n        <div class="box-1">\n            ',i=b.hasImg,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='\n        </div>\n        <div class="box-2">\n            ',i=b.hasImg,i=typeof i===l?i.apply(b):i,j=o.call(b,i,{hash:{},inverse:n.noop,fn:n.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k+='\n        </div>\n        <div class="bg one"></div>\n        <div class="bg two"></div>\n        <div class="bg three"></div>\n    </div>\n</figure>'}),this.IS.templates.profile_banner_single=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='\n            <a href="/i/'+k((c=a.id,typeof c===j?c.apply(a):c))+'">\n                <img class="front active" src="'+k((c=a.imageUrl,typeof c===j?c.apply(a):c))+'">\n            </a>\n            <a href="#">\n                <img class="back" src="/v2_images/empty.png">\n            </a>\n        '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this,m=c.blockHelperMissing;return i+='<figure class="banner-box '+k((g=b.box_type,typeof g===j?g.apply(b):g))+'" style="left: '+k((g=b.left,typeof g===j?g.apply(b):g))+'px">\n    <div class="wrapper">\n        ',g=b.hasImg,g=typeof g===j?g.apply(b):g,h=m.call(b,g,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+="\n    </div>\n</figure>\n"}),this.IS.templates.settings=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<section id="settings">'}function g(a,b){return"</section>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing;return h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+="\n    ",h=b.menu_html,i=typeof h===k?h.apply(b):h,(i||0===i)&&(j+=i),j+='\n    <div class="my-tabs">\n        ',h=b.tab_html,i=typeof h===k?h.apply(b):h,(i||0===i)&&(j+=i),j+="\n    </div>\n",h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j}),this.IS.templates.settings_menu=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<aside class="no-user-select menu">'}function g(a,b){return"active"}function h(a,b){return"</aside>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k="",l="function",m=this,n=c.blockHelperMissing,o=this.escapeExpression;return i=b._backend,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='\n    <h1>Settings</h1>\n    <div class="tabs '+o((i=b.tab,typeof i===l?i.apply(b):i))+'">\n        <a href="/my/settings" class="profile ',i=b.is_profile,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='"><span>Your Info</span></a>\n        <a href="/my/settings/notifications" class="notifications ',i=b.is_notifications,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='"><span>Notifications</span></a>\n        <a href="/my/settings/subscription" class="subscription ',i=b.is_subscription,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='"><span>Subscription</span></a>\n        <a href="/my/settings/privacy" class="privacy ',i=b.is_privacy,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='"><span>Privacy / Preferences</span></a>\n        <a href="/my/settings/referral" class="referral ',i=b.is_referral,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='"><span>Referral Program</span></a>\n    </div>\n    <a class="delete-account button-large-white rounded">DELETE ACCOUNT</a>\n',i=b._backend,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k}),this.IS.templates.settings_notifications=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<div class="tab notifications">'}function g(a,b){return"on"}function h(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k="",l="function",m=this,n=c.blockHelperMissing;return i=b._backend,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='\n    <h2>Email Notifications</h2>\n    <article>\n        <h3>ACTIVITY RELATED TO YOUR IMAGESHACK</h3>\n        <p class="subtitle">Email me when...</p>\n        <ul class="options">\n            <li class="clearfix">\n                <a class="slider-option ',i=b.upload_notification,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="upload_notification"><span></span></a>\n                <p>I have successfully uploaded photos</p>\n            </li>\n            <li class="clearfix">\n                <a class="slider-option ',i=b.comments_notification,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="comments_notification"><span></span></a>\n                <p>Someone comments on my image</p>\n            </li>\n            <li class="clearfix">\n                <a class="slider-option ',i=b.shares_notification,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="shares_notification"><span></span></a>\n                <p>Someone shares my image</p>\n            </li>\n            <li class="clearfix">\n                <a class="slider-option ',i=b.likes_notification,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="likes_notification"><span></span></a>\n                <p>Someone likes my image</p>\n            </li>\n            <!--<li class="clearfix">-->\n                <!--<a class="slider-option ',i=b.follows_notification,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="follows_notification"><span></span></a>-->\n                <!--<p>Someone follows me</p>-->\n            <!--</li>-->\n        </ul>\n    </article>\n    <article>\n        <h3>ACTIVITY RELATED TO YOUR SKYPATH</h3>\n        <p class="subtitle">Email me when...</p>\n        <ul class="options">\n            <li class="clearfix">\n                <a class="slider-option ',i=b.skypath_message,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="skypath_message"><span></span></a>\n                <p>Someone sends me a SkyPath message</p>\n            </li>\n            <li class="clearfix">\n                <a class="slider-option ',i=b.skypath_share_file,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="skypath_share_file"><span></span></a>\n                <p>Someone shares a file with me</p>\n            </li>\n        </ul>\n        <a class="skypath" target="_blank" href="/applications" data-bypass="true">What is SkyPath?</a>\n    </article>\n    <article>\n        <h3>UPDATES FROM IMAGESHACK</h3>\n        <p class="subtitle">Email me when...</p>\n        <ul class="options">\n            <li class="clearfix">\n                <a class="slider-option email-slider other-off-toggle ',i=b.usage_tips,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="usage_tips" data-other-selector=".unsubscribe-all"><span></span></a>\n                <p>There are tips on getting more out of ImageShack</p>\n            </li>\n            <li class="clearfix">\n                <a class="slider-option email-slider other-off-toggle ',i=b.new_feature_notification,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="new_feature_notification" data-other-selector=".unsubscribe-all"><span></span></a>\n                <p>A new feature is released or updated</p>\n            </li>\n            <li class="clearfix">\n                <a class="slider-option email-slider other-off-toggle ',i=b.special_offers,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="special_offers" data-other-selector=".unsubscribe-all"><span></span></a>\n                <p>Special offers and updates are released</p>\n            </li>\n        </ul>\n    </article>\n    <article>\n        <ul class="options single">\n            <li class="clearfix">\n                <a class="slider-option reverse-grouped unsubscribe-all ',i=b.all_email_off,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='" data-attribute="all_email_off" data-other-selector=".email-slider"><span></span></a>\n                <p>Unsubscribe from all promotional emails</p>\n            </li>\n        </ul>\n    </article>\n    <article class="clearfix save-button">\n        <a class="button-large-black">SAVE SETTINGS</a>\n    </article>\n',i=b._backend,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k}),this.IS.templates.settings_privacy=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<div class="tab privacy">'}function g(a,b){return"private"}function h(a,b){return"public"}function i(a,b){return"gallery"}function j(a,b){return"album"}function k(a,b){var c;return s((c=a.watermarkURL,typeof c===r?c.apply(a):c))}function l(a,b){return"/v2_images/transparent.png"}function m(a,b){return'\n                <a class="toggle-watermark">Remove watermark</a>\n            '}function n(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var o,p,q="",r="function",s=this.escapeExpression,t=this,u=c.blockHelperMissing;return o=b._backend,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.noop,fn:t.program(1,f,e),data:e}),(p||0===p)&&(q+=p),q+='\n    <h2>Privacy</h2>\n\n    <article>\n        <h3>When I upload I want my images:</h3>\n        <div class="clearfix option ',o=b.private_images,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.noop,fn:t.program(3,g,e),data:e}),(p||0===p)&&(q+=p),o=b.private_images,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.program(5,h,e),fn:t.noop,data:e}),(p||0===p)&&(q+=p),q+='">\n            <a class="radio private" data-value="private" data-attribute="private_images">\n                <span></span>\n                <p>Private</p>\n            </a>\n            <a class="radio public" data-value="public" data-attribute="private_images">\n                <span></span>\n                <p>Public</p>\n            </a>\n        </div>\n    </article>\n\n    <article>\n        <h3>When I create a new ',o=b.isFeatured,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.noop,fn:t.program(7,i,e),data:e}),(p||0===p)&&(q+=p),o=b.isFeatured,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.program(9,j,e),fn:t.noop,data:e}),(p||0===p)&&(q+=p),q+=' I want it:</h3>\n        <div class="clearfix option ',o=b.private_albums,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.noop,fn:t.program(3,g,e),data:e}),(p||0===p)&&(q+=p),o=b.private_albums,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.program(5,h,e),fn:t.noop,data:e}),(p||0===p)&&(q+=p),q+='">\n            <a class="radio private" data-value="private" data-attribute="private_albums">\n                <span></span>\n                <p>Private</p>\n            </a>\n            <a class="radio public" data-value="public" data-attribute="private_albums">\n                <span></span>\n                <p>Public</p>\n            </a>\n        </div>\n    </article>\n\n    <article class="bb">\n        <h3>Allow others to download, drag and get links to my images:</h3>\n        <div class="clearfix option ',o=b.block_downloading,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.noop,fn:t.program(3,g,e),data:e}),(p||0===p)&&(q+=p),o=b.block_downloading,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.program(5,h,e),fn:t.noop,data:e}),(p||0===p)&&(q+=p),q+='">\n            <a class="radio public" data-value="public" data-attribute="block_downloading">\n                <span></span>\n                <p>Yes</p>\n            </a>\n            <a class="radio private" data-value="private" data-attribute="block_downloading">\n                <span></span>\n                <p>No</p>\n            </a>\n        </div>\n    </article>\n\n    <h2>Preferences</h2>\n\n    <article>\n        <h3>What would you like your default view to be?</h3>\n        <div class="clearfix option higher">\n            <div class="dropdown default-view">\n                <div class="selected-label initial">Select One</div>\n                <div class="arrow"></div>\n                <div class="selection">\n                    <div class="item" data-value="1">My Images</div>\n                    <div class="item" data-value="2">My Albums</div>\n                    <!--<div class="item" data-value="3">Following</div>-->\n                </div>\n            </div>\n        </div>\n    </article>\n\n    <article class="bb">\n        <h3>Add a watermark to my images upon upload:</h3>\n        <div class="option watermark">\n            <div class="wrapper">\n                <img src="',o=b.hasWatermark,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.noop,fn:t.program(11,k,e),data:e}),(p||0===p)&&(q+=p),o=b.hasWatermark,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.program(13,l,e),fn:t.noop,data:e}),(p||0===p)&&(q+=p),q+='">\n            </div>\n            ',o=b.watermarkEnabled,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.noop,fn:t.program(15,m,e),data:e}),(p||0===p)&&(q+=p),q+='\n        </div>\n        <span class="subtext">Watermark will be placed at the bottom right of your image.<br>We recommend you use a PNG file.</span>\n        <div class="watermark-parent">\n            <form method="post" action="/rest_api/v2/images" enctype="multipart/form-data">\n                <input type="file" name="file" class="w-input" accept="image/*" autocomplete="off">\n            </form>\n        </div>\n    </article>\n\n    <!--<h2>Following</h2>-->\n\n    <!--<article>-->\n        <!--<h3>I would like to opt out of the follow feature:</h3>-->\n        <!--<div class="clearfix option ',o=b.private_followings,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.noop,fn:t.program(3,g,e),data:e}),(p||0===p)&&(q+=p),o=b.private_followings,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.program(5,h,e),fn:t.noop,data:e}),(p||0===p)&&(q+=p),q+='">-->\n            <!--<a class="radio private" data-value="private" data-attribute="private_followings">-->\n                <!--<span></span>-->\n                <!--<p>Yes</p>-->\n            <!--</a>-->\n            <!--<a class="radio public" data-value="public" data-attribute="private_followings">-->\n                <!--<span></span>-->\n                <!--<p>No</p>-->\n            <!--</a>-->\n        <!--</div>-->\n        <!--<span class="subtext">This controls if you want the following feature removed from your profile page. Opting out means other users will not be able to follow you.</span>-->\n    <!--</article>-->\n\n    <article class="clearfix save-button">\n        <a class="button-large-black">SAVE SETTINGS</a>\n    </article>\n\n',o=b._backend,o=typeof o===r?o.apply(b):o,p=u.call(b,o,{hash:{},inverse:t.noop,fn:t.program(17,n,e),data:e}),(p||0===p)&&(q+=p),q}),this.IS.templates.settings_profile=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<div class="tab profile">'}function g(a,b){var c,d="";return d+='\n                <img src="'+q((c=a.avatarUrl,typeof c===p?c.apply(a):c))+'" onerror="this.src=\'/v2_images/default_avatar_100x100.jpg\';">\n            '}function h(a,b){return'\n                <img src="/v2_images/default_avatar_100x100.jpg">\n            '}function i(a,b){return"disabled"}function j(a,b){return"hidden"}function k(a,b){var c,d="";return d+='\n        <article class="social-sites">\n            <h3>SOCIAL SITES</h3>\n            <p class="subtext">To promote your photography from other social sites on your profile page, add them below:</p>\n            <section class="sites">\n                <article class="clearfix">\n                    <label for="site-facebook">Facebook</label>\n                    <input autocomplete="off" name="sites.facebook" placeholder="https://facebook.com/mypage" class="model-attribute" type="text" id="site-facebook" value="'+q((c=a.facebookURL,typeof c===p?c.apply(a):c))+'">\n                </article>\n                <article class="clearfix">\n                    <label for="site-instagram">Instagram</label>\n                    <input autocomplete="off" name="sites.instagram" placeholder="http://instagram.com/mypage" class="model-attribute" type="text" id="site-instagram" value="'+q((c=a.instagramURL,typeof c===p?c.apply(a):c))+'">\n                </article>\n                <article class="clearfix">\n                    <label for="site-tumblr">Tumblr</label>\n                    <input autocomplete="off" name="sites.tumblr" placeholder="http://mypage.tumblr.com" class="model-attribute" type="text" id="site-tumblr" value="'+q((c=a.tumblrURL,typeof c===p?c.apply(a):c))+'">\n                </article>\n                <article class="clearfix">\n                    <label for="site-twitter">Twitter</label>\n                    <input autocomplete="off" name="sites.twitter" placeholder="https://twitter.com/mypage" class="model-attribute" type="text" id="site-twitter" value="'+q((c=a.twitterURL,typeof c===p?c.apply(a):c))+'">\n                </article>\n            </section>\n        </article>\n    '}function l(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var m,n,o="",p="function",q=this.escapeExpression,r=this,s=c.blockHelperMissing;return m=b._backend,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.noop,fn:r.program(1,f,e),data:e}),(n||0===n)&&(o+=n),o+='\n    <h2>Settings for your profile</h2>\n    <article class="clearfix profile-pic">\n        <div class="avatar">\n            ',m=b.hasAvatar,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.noop,fn:r.program(3,g,e),data:e}),(n||0===n)&&(o+=n),o+="\n            ",m=b.hasAvatar,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.program(5,h,e),fn:r.noop,data:e}),(n||0===n)&&(o+=n),o+='\n        </div>\n        <div class="upload-form ',m=b.canUploadAvatar,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.program(7,i,e),fn:r.noop,data:e}),(n||0===n)&&(o+=n),o+='">\n            <h3>UPLOAD A PROFILE PICTURE</h3>\n            <p class="subtext">Select a JPG, PNG or GIF from your computer</p>\n            <form method="post" action="/rest_api/v2/images" enctype="multipart/form-data">\n                <a class="avatar-crop ',m=b.hasAvatar,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.program(9,j,e),fn:r.noop,data:e}),(n||0===n)&&(o+=n),o+='">Edit Avatar</a>\n                <input type="file" name="file" class="avatar-input" accept="image/*" autocomplete="off">\n            </form>\n        </div>\n        <div class="upload-msg ',m=b.canUploadAvatar,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.noop,fn:r.program(7,i,e),data:e}),(n||0===n)&&(o+=n),o+='">\n            <p>\n                Changing your avatar requires a premium account.<br/>\n                Only $2/mo. <a href="/upgrade" data-bypass="true">Upgrade now</a>.\n            </p>\n        </div>\n    </article>\n    <article class="user-name">\n        <h3>USER NAME</h3>\n        <div class="input-parent bordered-input arrow">\n            <input name="username" class="model-attribute name-input trackable" data-label="Username" type="text" value="'+q((m=b.username,typeof m===p?m.apply(b):m))+'" autocomplete="off">\n        </div>\n    </article>\n    <article class="email">\n        <h3>EMAIL</h3>\n        <div class="input-parent bordered-input arrow">\n            <input name="email" class="model-attribute email-input trackable" data-label="Email" type="text" value="'+q((m=b.email,typeof m===p?m.apply(b):m))+'" autocomplete="off">\n        </div>\n    </article>\n    <article class="about">\n        <h3>ABOUT</h3>\n        <p class="subtext">No more than 140 characters</p>\n        <div class="input-parent bordered-input">\n            <textarea name="description" class="model-attribute about-input trackable" data-label="About" maxlength="140" autocomplete="off">'+q((m=b.description,typeof m===p?m.apply(b):m))+'</textarea>\n        </div>\n    </article>\n    <article class="location">\n        <h3>LOCATION</h3>\n        <div class="input-parent bordered-input pin">\n            <input class="location-input geo trackable" data-label="location" type="text" value="'+q((m=b.location,typeof m===p?m.apply(b):m))+'" autocomplete="off">\n        </div>\n    </article>\n    <article class="gender">\n        <h3>GENDER</h3>\n        <div class="gender-options '+q((m=b.gender,typeof m===p?m.apply(b):m))+' clearfix">\n            <a class="female trackable" data-label="Female" data-gender="female">\n                <span></span>\n                <p>Female</p>\n            </a>\n            <a class="male trackable" data-label="Male" data-gender="male">\n                <span></span>\n                <p>Male</p>\n            </a>\n        </div>\n    </article>\n    <article class="password">\n        <h3>CHANGE MY PASSWORD</h3>\n        <div class="input-parent bordered-input arrow">\n            <input name="password" class="model-attribute password-input trackable" data-label="Password" type="password" value="" autocomplete="off">\n        </div>\n    </article>\n    ',m=b.isFeatured,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.noop,fn:r.program(11,k,e),data:e}),(n||0===n)&&(o+=n),o+='\n    <article class="clearfix save-button">\n        <a class="button-large-black">SAVE SETTINGS</a>\n    </article>\n',m=b._backend,m=typeof m===p?m.apply(b):m,n=s.call(b,m,{hash:{},inverse:r.noop,fn:r.program(13,l,e),data:e}),(n||0===n)&&(o+=n),o}),this.IS.templates.settings_referral=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<div class="tab referral">'}function g(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this,m=c.blockHelperMissing,n=this.escapeExpression;return h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <h2>Referral Program</h2>\n    <article>\n        <h3>Do you want to get one month for free?</h3>\n        <p class="subtitle">Share the the below referral link with friends, family and workmates. You will get one month for free for every three people who sign up to ImageShack using this link.</p>\n        <h3 class="mt">Copy and share this link:</h3>\n        <input type="text" value="'+n((h=b.referralLink,typeof h===k?h.apply(b):h))+'" readonly>\n    </article>\n    <article>\n    	<h3>Referral Count: <span class="referral-count"></span></h3>\n    	<section class="referral-users"></section>\n    </article>\n',h=b._backend,h=typeof h===k?h.apply(b):h,i=m.call(b,h,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j}),this.IS.templates.settings_subscription=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<div class="tab subscription">'}function g(a,b){return'\n    <!--<article class="other-options">-->\n        <!--<h3>USING IT FOR BUSINESS?</h3>-->\n        <!--<div class="info">-->\n            <!--<p>We have a plan for every business. More storage and no obligations.</p>-->\n        <!--</div>-->\n        <!--<div class="clearfix button">-->\n            <!--<a class="button-large-white no-user-select">VIEW ALL BUSINESS OPTIONS</a>-->\n        <!--</div>-->\n    <!--</article>-->\n    '}function h(a,b){return"</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k="",l="function",m=this,n=c.blockHelperMissing;return i=b._backend,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+="\n    <h2>Your Subscription Level</h2>\n    ",i=b.contentHTML,j=typeof i===l?i.apply(b):i,(j||0===j)&&(k+=j),k+="\n    ",i=b.hasBusinessSub,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.program(3,g,e),fn:m.noop,data:e}),(j||0===j)&&(k+=j),k+="\n",i=b._backend,i=typeof i===l?i.apply(b):i,j=n.call(b,i,{hash:{},inverse:m.noop,fn:m.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k}),this.IS.templates.settings_subscription_type=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<article class="sub">'}function g(a,b){return"\n                    FREE ACCOUNT\n                "}function h(a,b){var c,d,e="";return e+="\n                    ",c=a.isPremium,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(6,i,b),
data:b}),(d||0===d)&&(e+=d),e+="\n                    ",c=a.isBusiness,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(8,j,b),data:b}),(d||0===d)&&(e+=d),e+="\n                    ",c=a.isSkypath,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(10,k,b),data:b}),(d||0===d)&&(e+=d),e+="\n                    ",c=a.isStudent,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(12,l,b),data:b}),(d||0===d)&&(e+=d),e+="\n                    ",c=a.isTrial,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(14,m,b),data:b}),(d||0===d)&&(e+=d),e+="\n                "}function i(a,b){return"PREMIUM"}function j(a,b){return"BUSINESS"}function k(a,b){return"SKYPATH PROMO"}function l(a,b){return"STUDENT"}function m(a,b){return"TRIAL"}function n(a,b){return"\n                    <li>Uptime: 99%</li>\n                    <li>No ads</li>\n                    <li>Automatic backup</li>\n                "}function o(a,b){var c,d,e="";return e+="\n                    <li>\n                        ",c=a.isActive,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.program(19,p,b),fn:T.noop,data:b}),(d||0===d)&&(e+=d),e+="\n                        ",c=a.isActive,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(24,s,b),data:b}),(d||0===d)&&(e+=d),e+="\n                        : "+V((c=a.expDate,typeof c===S?c.apply(a):c))+"\n                    </li>\n                "}function p(a,b){var c,d,e="";return e+="\n                            ",c=a.isExpired,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(20,q,b),data:b}),(d||0===d)&&(e+=d),e+="\n                            ",c=a.isExpired,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.program(22,r,b),fn:T.noop,data:b}),(d||0===d)&&(e+=d),e+="\n                        "}function q(a,b){return"\n                                Expired\n                            "}function r(a,b){return"\n                                Expires\n                            "}function s(a,b){var c,d,e="";return e+="\n                            ",c=a.isRecurring,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(25,t,b),data:b}),(d||0===d)&&(e+=d),e+="\n                            ",c=a.isRecurring,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.program(22,r,b),fn:T.noop,data:b}),(d||0===d)&&(e+=d),e+="\n                        "}function t(a,b){return"\n                                Next Payment Date\n                            "}function u(a,b){return"\n                    Free\n                "}function v(a,b){var c,d,e="";return e+="\n                    ",c=a.isTrial,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(30,w,b),data:b}),(d||0===d)&&(e+=d),e+="\n                    ",c=a.isTrial,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.program(32,x,b),fn:T.noop,data:b}),(d||0===d)&&(e+=d),e+="\n                "}function w(a,b){return"\n                        Free 1-Month Trial\n                    "}function x(a,b){var c,d,e="";return e+="\n                        $"+V((c=a.monthlyCost,typeof c===S?c.apply(a):c)),c=a.isRecurring,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(33,y,b),data:b}),(d||0===d)&&(e+=d),e+="\n                    "}function y(a,b){return"/mo"}function z(a,b){var c,d="";return d+='\n            <div class="column">\n                <h3 class="np">YOUR STORAGE</h3>\n                <p class="desc">'+V((c=a.totalSpace,typeof c===S?c.apply(a):c))+"</p>\n            </div>\n        "}function A(a,b){var c,d,e="";return e+='\n        <div class="tb payment-info">\n            <h3>YOUR CURRENT PAYMENT METHOD</h3>\n            <div class="info">\n                <p>Type: '+V((c=a.paymentType,typeof c===S?c.apply(a):c))+"</p>\n                <p>Transaction ID: <strong>"+V((c=a.tID,typeof c===S?c.apply(a):c))+"</strong></p>\n                ",c=a.is3rdPartyPayment,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(38,B,b),data:b}),(d||0===d)&&(e+=d),e+="\n                ",c=a.isCardPayment,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(42,E,b),data:b}),(d||0===d)&&(e+=d),e+="\n            </div>\n            ",c=a.isPayPalPayment,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(47,H,b),data:b}),(d||0===d)&&(e+=d),e+='\n            <a class="invoice-trigger">Get Invoice</a>\n        </div>\n    '}function B(a,b){var c,d,e="";return e+="\n                    ",c=a.hasStatus,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(39,C,b),data:b}),(d||0===d)&&(e+=d),e+="\n                "}function C(a,b){var c,d,e="";return e+="\n                        <p>\n                            Status:&nbsp;\n                            <span ",c=a.isGoodStatus,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(40,D,b),data:b}),(d||0===d)&&(e+=d),e+=">"+V((c=a.status,typeof c===S?c.apply(a):c))+"</span>\n                        </p>\n                    "}function D(a,b){return'class="active"'}function E(a,b){var c,d,e="";return e+="\n                    ",c=a.hasLast4,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(43,F,b),data:b}),(d||0===d)&&(e+=d),e+="\n                    ",c=a.hasStatus,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(39,C,b),data:b}),(d||0===d)&&(e+=d),e+="\n                    ",c=a.isActive,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(45,G,b),data:b}),(d||0===d)&&(e+=d),e+="\n                "}function F(a,b){var c,d="";return d+="\n                        <p>Card: &#8226;&#8226;&#8226;&#8226;&nbsp;&#8226;&#8226;&#8226;&#8226;&nbsp;&#8226;&#8226;&#8226;&#8226;&nbsp;"+V((c=a.cardNum,typeof c===S?c.apply(a):c))+"</p>\n                    "}function G(a,b){return'\n                        <p><a class="cc-cancel">Cancel subscription</a></p>\n                    '}function H(a,b){var c,d,e="";return e+="\n                ",c=a.isActive,c=typeof c===S?c.apply(a):c,d=U.call(a,c,{hash:{},inverse:T.noop,fn:T.program(48,I,b),data:b}),(d||0===d)&&(e+=d),e+="\n            "}function I(a,b){return'\n                    <div class="button">\n                        <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_subscr-find&alias=QZP8WH2XDZZ9Q" data-bypass="true" class="button-large-white no-user-select nf pp">CANCEL SUBSCRIPTION IN PAYPAL</a>\n                    </div>\n                '}function J(a,b){return'class="current"'}function K(a,b){return'\n                    <a class="current">CURRENT SUBSCRIPTION</a>\n                '}function L(a,b){return'\n                    <a class="upgrade-button" data-type="WF_BASIC">UPGRADE</a>\n                '}function M(a,b){return'\n                    <a class="upgrade-button" data-type="WF_PRO">UPGRADE</a>\n                '}function N(a,b){return'\n                    <a class="upgrade-button" data-type="WF_PREMIUM">UPGRADE</a>\n                '}function O(a,b){return"</article>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var P,Q,R="",S="function",T=this,U=c.blockHelperMissing,V=this.escapeExpression;return P=b._backend,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(1,f,e),data:e}),(Q||0===Q)&&(R+=Q),R+='\n    <div class="columns clearfix">\n        <div class="column">\n            <h3>\n                ',P=b.isFree,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(3,g,e),data:e}),(Q||0===Q)&&(R+=Q),R+="\n                ",P=b.isFree,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.program(5,h,e),fn:T.noop,data:e}),(Q||0===Q)&&(R+=Q),R+="\n            </h3>\n            <ul>\n                <li>Image size: 25MB</li>\n                ",P=b.isLimitedAccount,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.program(16,n,e),fn:T.noop,data:e}),(Q||0===Q)&&(R+=Q),R+='\n                <li class="mt">Joined: '+V((P=b.joinDate,typeof P===S?P.apply(b):P))+"</li>\n                <li>Renewal Cycle: "+V((P=b.renewalType,typeof P===S?P.apply(b):P))+"</li>\n                ",P=b.hasExpDate,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(18,o,e),data:e}),(Q||0===Q)&&(R+=Q),R+='\n            </ul>\n        </div>\n        <div class="column">\n            <h3 class="np">PLAN TYPE</h3>\n            <p class="desc">\n                ',P=b.isFree,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(27,u,e),data:e}),(Q||0===Q)&&(R+=Q),R+="\n                ",P=b.isFree,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.program(29,v,e),fn:T.noop,data:e}),(Q||0===Q)&&(R+=Q),R+="\n            </p>\n        </div>\n        <!-- \n        ",P=b.isBusiness,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(35,z,e),data:e}),(Q||0===Q)&&(R+=Q),R+="\n        -->    \n    </div>    \n    ",P=b.hasPaymentInfo,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(37,A,e),data:e}),(Q||0===Q)&&(R+=Q),R+='\n    <div class="tb upgrade-area">\n        <h3>WANT TO UPGRADE?</h3>\n        <p>We have many options available to fit your needs.</p>\n        <a class="button-large-white all-plans-trigger">VIEW ALL PLANS</a>\n        <section class="all-plans">\n            <article ',P=b.isBasicSub,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(50,J,e),data:e}),(Q||0===Q)&&(R+=Q),R+='>\n                <h3>BASIC</h3>\n                <div class="clearfix benefits">\n                    <ul>\n                        <li><span>Unlimited Space</span></li>\n                        <li><span>Direct Linking</span></li>\n                        <li><span>Image Stats</span></li>\n                    </ul>\n                    <ul>\n                        <li><span>Watermarking</span></li>\n                        <li><span>Automatic Backups</span></li>\n                        <li><span>Mobile App</span></li>\n                    </ul>\n                </div>\n                ',P=b.isBasicSub,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(52,K,e),data:e}),(Q||0===Q)&&(R+=Q),R+="\n                ",P=b.isBasicSub,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.program(54,L,e),fn:T.noop,data:e}),(Q||0===Q)&&(R+=Q),R+="\n            </article>\n            <article ",P=b.isProSub,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(50,J,e),data:e}),(Q||0===Q)&&(R+=Q),R+='>\n                <h3>PRO</h3>\n                <div class="clearfix benefits">\n                    <ul>\n                        <li><span>Unlimited Space</span></li>\n                        <li><span>Bandwidth: 30Gb to 1Tb</span></li>\n                        <li><span>Direct Linking</span></li>\n                        <li><span>Image Stats</span></li>\n                        <li><span><a href="/pages/resize/" data-bypass="true">Dynamic Image Resizer</a></span></li>\n                    </ul>\n                    <ul>\n                        <li><span>Watermarking</span></li>\n                        <li><span>Automatic Backups</span></li>\n                        <li><span>Mobile App</span></li>\n                        <li><span>Dedicated Support</span></li>\n                        <li><span><a href="http://api.imageshack.us/" data-bypass="true">API Access</a></span></li>\n                    </ul>\n                </div>\n                ',P=b.isProSub,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(52,K,e),data:e}),(Q||0===Q)&&(R+=Q),R+="\n                ",P=b.isProSub,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.program(56,M,e),fn:T.noop,data:e}),(Q||0===Q)&&(R+=Q),R+="\n            </article>\n            <article ",P=b.isPremiumSub,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(50,J,e),data:e}),(Q||0===Q)&&(R+=Q),R+='>\n                <h3>PREMIUM</h3>\n                <div class="clearfix benefits">\n                    <ul>\n                        <li><span>Unlimited Space</span></li>\n                        <li><span>Bandwidth: 1Tb to 4Tb</span></li>\n                        <li><span>Direct Linking</span></li>\n                        <li><span>Image Stats</span></li>\n                        <li><span><a href="/pages/resize/" data-bypass="true">Dynamic Image Resizer</a></span></li>\n                    </ul>\n                    <ul>\n                        <li><span>Watermarking</span></li>\n                        <li><span>Automatic Backups</span></li>\n                        <li><span>Mobile App</span></li>\n                        <li><span>Dedicated Support</span></li>\n                        <li><span><a href="http://api.imageshack.us/" data-bypass="true">API Access</a></span></li>\n                    </ul>\n                </div>\n                ',P=b.isPremiumSub,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(52,K,e),data:e}),(Q||0===Q)&&(R+=Q),R+="\n                ",P=b.isPremiumSub,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.program(58,N,e),fn:T.noop,data:e}),(Q||0===Q)&&(R+=Q),R+="\n            </article>\n        </section>\n    </div>\n",P=b._backend,P=typeof P===S?P.apply(b):P,Q=U.call(b,P,{hash:{},inverse:T.noop,fn:T.program(60,O,e),data:e}),(Q||0===Q)&&(R+=Q),R}),this.IS.templates.sub_form=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d,e="";return e+='\n    <h1>Monthly or yearly?</h1>\n    <section class="clearfix plan-types">\n        <article class="type-selector" data-type="MONTHLY">\n            <h2>$'+w((c=a.proMonthlyCost,typeof c===v?c.apply(a):c))+"/month</h2>\n            <p>Subscribe for only $"+w((c=a.proMonthlyCost,typeof c===v?c.apply(a):c))+' a month.</p>\n        </article>\n        <article class="type-selector" data-type="ANNUAL">\n            <h2>$'+w((c=a.proAnnualCost,typeof c===v?c.apply(a):c))+"/year</h2>\n            <p>Go annual for $"+w((c=a.proAnnualCost,typeof c===v?c.apply(a):c))+" a year &amp; save.</p>\n\n            ",c=a.hasAnnualDiscount,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.program(2,g,b),fn:x.noop,data:b}),(d||0===d)&&(e+=d),e+="\n        </article>\n    </section>\n"}function g(a,b){return'\n                <div class="badge no-user-select">\n                    <div class="wrapper">\n                        <span>2 FREE<br>MONTHS</span>\n                    </div>\n                </div>\n            '}function h(a,b){var c,d,e="";return e+="\n    ",c=a.expireMessage,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(5,i,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n    ",c=a.overrideMessage,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(7,j,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n    ",c=a.overrideMessage,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.program(9,k,b),fn:x.noop,data:b}),(d||0===d)&&(e+=d),e+='\n\n        <section class="clearfix payment-types ',c=a.hasClickAndBuy,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(12,m,b),data:b}),(d||0===d)&&(e+=d),e+='">\n        <article class="cc">\n            <header>\n                <h2>Credit Card</h2>\n                <figure></figure>\n            </header>\n            <footer>\n                ',c=a.hasOneTimePayment,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(14,n,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n                ",c=a.hasRecurringPayment,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(16,o,b),data:b}),(d||0===d)&&(e+=d),e+='\n            </footer>\n        </article>\n        <article class="paypal">\n            <header>\n                <figure></figure>\n                <p>May take up to ten minutes to process payment.</p>\n            </header>\n            <footer>\n                ',c=a.hasOneTimePayment,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(18,p,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n                ",c=a.hasRecurringPayment,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(20,q,b),data:b}),(d||0===d)&&(e+=d),e+="\n            </footer>\n        </article>\n        ",c=a.hasClickAndBuy,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.noop,fn:x.program(22,r,b),data:b}),(d||0===d)&&(e+=d),e+="\n    </section>\n"}function i(a,b){return"\n        <h1>Your subscription is going to expire soon. Upgrade now to keep your service running uninterrupted.</h1>\n        <br>\n    "}function j(a,b){return'\n        <h1>As a special thanks for joining us we are giving you a discount of 50% off an entire year subscription.\n            Don\'t wait, this is a limited time offer.</h1>\n        <br>\n        <div class="center">\n            <h1>Only $18.99 a year - you can cancel at any time.</h1>\n        </div>\n\n    '}function k(a,b){var c,d,e="";return e+="\n        ",c=a.expireMessage,c=typeof c===v?c.apply(a):c,d=y.call(a,c,{hash:{},inverse:x.program(10,l,b),fn:x.noop,data:b}),(d||0===d)&&(e+=d),e+="\n    "}function l(a,b){var c,d="";return d+="\n            <h1>How would you like to pay? <span>"+w((c=a.cost_text,typeof c===v?c.apply(a):c))+".</span></h1>\n        "}function m(a,b){return"three-column"}function n(a,b){return'\n                    <a class="trigger" data-type="ONE_TIME">ONE TIME PAYMENT</a>\n                '}function o(a,b){var c,d="";return d+='\n                    <a class="trigger" data-type="RECUR">PAY '+w((c=a.term,typeof c===v?c.apply(a):c))+"</a>\n                "}function p(a,b){var c,d="";return d+='\n                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post">\n                        <input type="hidden" name="cmd" value="_s-xclick">\n                        <input type="hidden" name="hosted_button_id" value="'+w((c=a.oneTimePaypalID,typeof c===v?c.apply(a):c))+'">\n                        <input type="hidden" name="item_name" value="'+w((c=a.desc,typeof c===v?c.apply(a):c))+'">\n                        <input type="hidden" name="item_number" value="'+w((c=a.oneTimeType,typeof c===v?c.apply(a):c))+'">\n                        <input type="hidden" name="invoice" value="'+w((c=a.paypalInvoice,typeof c===v?c.apply(a):c))+'">\n                        <input type="hidden" name="no_shipping" value="1">\n                        <input type="hidden" name="no_note" value="1">\n                        <input type="hidden" name="currency_code" value="USD">\n                        <input type="hidden" name="lc" value="US">\n                        <input type="hidden" name="notify_url" value="http://imageshack.us/paypal/notify.php">\n                        <button type="submit">ONE TIME PAYMENT</button>\n                    </form>\n                '}function q(a,b){var c,d="";return d+='\n                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post">\n                        <input type="hidden" name="cmd" value="_s-xclick">\n                        <input type="hidden" name="hosted_button_id" value="'+w((c=a.recurPaypalID,typeof c===v?c.apply(a):c))+'">\n                        <input type="hidden" name="item_name" value="'+w((c=a.desc,typeof c===v?c.apply(a):c))+'">\n                        <input type="hidden" name="item_number" value="'+w((c=a.recurType,typeof c===v?c.apply(a):c))+'">\n                        <input type="hidden" name="invoice" value="'+w((c=a.paypalInvoice,typeof c===v?c.apply(a):c))+'">\n                        <input type="hidden" name="no_shipping" value="1">\n                        <input type="hidden" name="no_note" value="1">\n                        <input type="hidden" name="currency_code" value="USD">\n                        <input type="hidden" name="lc" value="US">\n                        <input type="hidden" name="notify_url" value="http://imageshack.us/paypal/notify.php">\n                        <button type="submit">PAY '+w((c=a.term,typeof c===v?c.apply(a):c))+"</button>\n                    </form>\n                "}function r(a,b){return'\n            <article class="cab">\n                <header>\n                    <figure></figure>\n                </header>\n                <footer>\n                    <a class="cab-trigger" data-type="ONE_TIME">ONE TIME PAYMENT</a>\n                </footer>\n            </article>\n        '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var s,t,u="",v="function",w=this.escapeExpression,x=this,y=c.blockHelperMissing;return s=b.typeChosen,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.program(1,f,e),fn:x.noop,data:e}),(t||0===t)&&(u+=t),u+="\n\n",s=b.typeChosen,s=typeof s===v?s.apply(b):s,t=y.call(b,s,{hash:{},inverse:x.noop,fn:x.program(4,h,e),data:e}),(t||0===t)&&(u+=t),u+="\n"}),this.IS.templates.system_message=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div class="system-msg '+j((f=b.type,typeof f===i?f.apply(b):f))+'">\n    <div class="text">',f=b.message,g=typeof f===i?f.apply(b):f,(g||0===g)&&(h+=g),h+='</div>\n    <div class="icon-close"></div>\n</div>\n'}),this.IS.templates.timeline_widget=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<figure class="timeline">\n    <div class="no-user-select user-grid"></div>\n</figure>\n<a class="no-user-select arrow top disabled">\n    <span>\n        <figure></figure>\n    </span>\n</a>\n<a class="no-user-select arrow bottom disabled">\n    <span>\n        <figure></figure>\n    </span>\n</a>\n\n'}),this.IS.templates.tooltip=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="wrapper">'+i((f=b.message,typeof f===h?f.apply(b):f))+"</div>"}),this.IS.templates.user_profile_albums_pass_dialog=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<p>\n    This album is private.<br/>\n    To view it please provide a password.\n</p>\n<form class="clearfix">\n    <input type="password" class="password" placeholder="PASSWORD" />\n    <div class="submit">VIEW ALBUM</div>\n</div>\n'}),this.IS.templates.welcome_video=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<h1>Getting Started</h1>\n<article class="video">\n    <iframe src="//player.vimeo.com/video/83692896?portrait=0&amp;color=f7bd25&amp;autoplay=1" width="650" height="365" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>\n</article>\n<article class="clearfix bottom">\n    <h2>HAVE MORE QUESTIONS OR NEED MORE HELP?</h2>\n    <p>Watch more how to videos on the help page.</p>\n    <a href="/help" data-bypass="true" class="button-large-yellow rounded">GO TO HELP PAGE</a>\n</article>'}),function(){"use strict";window.IS.CONS={API_BASE:"/rest_api/v2",API_KEY:"5SQW7ZT1dec0922325c83383377e7e557d97fe7a",API_KEY_MOBILE:"0CEHJKSX730c6a7f777ef39702a616984f6459ba",APIS:{USER:{USER:"/user",LOGIN:"/user/login",FACEBOOK_LOGIN:"/user/facebook_login",FORGOT:"/user/forgot",PASSWORD_RESET:"/user/password_reset",USAGE:"/user/usage",SETTINGS:"/user/settings",SUBSCRIPTIONS:"/user/subscriptions",REFERRAL:"/user/referral",REFERRAL_USERS:"/user/referral/users"},IMAGES:{IMAGES:"/images"},ALBUMS:{ALBUMS:"/albums"},COMMENTS:{COMMENTS:"/comments"},SYSTEM_MESSAGES:{HIDE:"/system_messages/hide"},ACTIVITIES:{ACTIVITIES:"/activities",VIEWED:"/activities/viewed",NEW_COUNT:"/activities/new_count"},FOLLOW:{FOLLOWS:"/follows",IS_FOLLOWING:"/follows/is_following"},SUBSCRIPTIONS:{UPDATE_PAYMENT:"/subscriptions/update_payment",PAY:"/subscriptions/pay",CANCEL:"/subscriptions/cancel",PROMO:"/subscriptions/promo",CAB:"/subscriptions/pay/cab"},STATS:{UPLOADS:"/stats/uploads"}},MIN_PASSWORD_LENGTH:6,MIN_USERNAME_LENGTH:4,UPLOAD_API_KEY:"023CPQUX4daaedb121349aa5cbf83f40e72d3849",EXT_MAP:{jpg:"j",png:"p",bmp:"b",tif:"t",gif:"g",ico:"i",swf:"s",pdf:"d",flv:"f",mp4:"z",gal:"x"},LARGE:{},SITE_URL:"//imageshack.com",TWITTER_HANDLE:"imageshack",PHOTO_FETCH_COUNT:40,ALBUM_FETCH_COUNT:30,FOLLOW_FETCH_COUNT:40,IOS_DEVICE:!1,MOBILE_DEVICE:!1,PROD:!0,BROWSER:"firefox",STORAGE:{GRID_STYLE:"grid_photo:style",ALBUM_SORT_TYPE:"album:sort_type",USER_SETTINGS:"user:settings",UPLOAD_COUNT_STAT:"user:upload_count_stat",UPGRADE_POPUP:"user:upgrade_popup",DEL_POPUP:"user:deletion_popup",MIN_UPLOADER:"uploader:min:coords",MOBILE_FEED_STYLE:"mobile_feed_style|v2",SURVEY_MONKEY:"user:survey_monkey",AUTO_PROMO_POP:"user:auto_popup",AUTO_PROMO_POP_SUB_EXP:"user:auto_popup_sub_exp"},SIZE_OPTIONS:{"100x75":"100 x 75 (avatar)","150x100":"150 x 100 (thumbnail)","280x200":"280 x 200 (thumbnail)","320x240":"320 x 240 (small)","640x480":"640 x 480 (medium)","800x600":"800 x 600","1024x768":"1024 x 768 (large)","1280x1024":"1280 x 1024","1600x1200":"1600 x 1200"},LINK_OPTIONS:{direct:"Direct",forum:"Forum","alt-forum":"Alt Forum",web:"HTML"},MOBILE_FEED_STYLES:{FEED:1,GRID:2},UPLOADER:{ACCEPTED_TYPES:{"image/png":!0,"image/x-png":!0,"image/jpeg":!0,"image/gif":!0,"image/bmp":!0,"image/tiff":!0,"image/x-icon":!0,"image/ico":!0,"image/icon":!0},SIZE_LIMITS:{pro:26214400}},ADS:{LP1:"div-gpt-ad-1412719341886-0",GL1:"div-gpt-ad-1412111620347-0",GL2:"div-gpt-ad-1412111620347-1",D0:"div-gpt-ad-1412881171414-0",D1:"div-gpt-ad-1412881171414-1",E1:"div-gpt-ad-1412363141668-0",E2:"div-gpt-ad-1412363141668-1",MLP1:"div-gpt-ad-1427919651962-0",MLP2:"div-gpt-ad-1412272181950-0"}}}(),function(){"use strict";window.IS.CONS.LARGE={STATES:[{v:"AL",n:"Alabama"},{v:"AK",n:"Alaska"},{v:"AZ",n:"Arizona"},{v:"AR",n:"Arkansas"},{v:"CA",n:"California"},{v:"CO",n:"Colorado"},{v:"CT",n:"Connecticut"},{v:"DE",n:"Delaware"},{v:"DC",n:"District Of Columbia"},{v:"FL",n:"Florida"},{v:"GA",n:"Georgia"},{v:"HI",n:"Hawaii"},{v:"ID",n:"Idaho"},{v:"IL",n:"Illinois"},{v:"IN",n:"Indiana"},{v:"IA",n:"Iowa"},{v:"KS",n:"Kansas"},{v:"KY",n:"Kentucky"},{v:"LA",n:"Louisiana"},{v:"ME",n:"Maine"},{v:"MD",n:"Maryland"},{v:"MA",n:"Massachusetts"},{v:"MI",n:"Michigan"},{v:"MN",n:"Minnesota"},{v:"MS",n:"Mississippi"},{v:"MO",n:"Missouri"},{v:"MT",n:"Montana"},{v:"NE",n:"Nebraska"},{v:"NV",n:"Nevada"},{v:"NH",n:"New Hampshire"},{v:"NJ",n:"New Jersey"},{v:"NM",n:"New Mexico"},{v:"NY",n:"New York"},{v:"NC",n:"North Carolina"},{v:"ND",n:"North Dakota"},{v:"OH",n:"Ohio"},{v:"OK",n:"Oklahoma"},{v:"OR",n:"Oregon"},{v:"PA",n:"Pennsylvania"},{v:"RI",n:"Rhode Island"},{v:"SC",n:"South Carolina"},{v:"SD",n:"South Dakota"},{v:"TN",n:"Tennessee"},{v:"TX",n:"Texas"},{v:"UT",n:"Utah"},{v:"VT",n:"Vermont"},{v:"VA",n:"Virginia"},{v:"WA",n:"Washington"},{v:"WV",n:"West Virginia"},{v:"WI",n:"Wisconsin"},{v:"WY",n:"Wyoming"}],COUNTRIES:[{v:"USA",n:"United States"},{v:"AF",n:"Afghanistan"},{v:"AX",n:"&#197;land Islands"},{v:"AL",n:"Albania"},{v:"DZ",n:"Algeria"},{v:"AS",n:"American Samoa"},{v:"AD",n:"Andorra"},{v:"AO",n:"Angola"},{v:"AI",n:"Anguilla"},{v:"AQ",n:"Antarctica"},{v:"AG",n:"Antigua and Barbuda"},{v:"AR",n:"Argentina"},{v:"AM",n:"Armenia"},{v:"AW",n:"Aruba"},{v:"AU",n:"Australia"},{v:"AT",n:"Austria"},{v:"AZ",n:"Azerbaijan"},{v:"BS",n:"Bahamas"},{v:"BH",n:"Bahrain"},{v:"BD",n:"Bangladesh"},{v:"BB",n:"Barbados"},{v:"BY",n:"Belarus"},{v:"BE",n:"Belgium"},{v:"BZ",n:"Belize"},{v:"BJ",n:"Benin"},{v:"BM",n:"Bermuda"},{v:"BT",n:"Bhutan"},{v:"BO",n:"Bolivia"},{v:"BA",n:"Bosnia and Herzegovina"},{v:"BW",n:"Botswana"},{v:"BV",n:"Bouvet Island"},{v:"BR",n:"Brazil"},{v:"IO",n:"British Indian Ocean Territory"},{v:"BN",n:"Brunei Darussalam"},{v:"BG",n:"Bulgaria"},{v:"BF",n:"Burkina Faso"},{v:"BI",n:"Burundi"},{v:"KH",n:"Cambodia"},{v:"CM",n:"Cameroon"},{v:"CA",n:"Canada"},{v:"CV",n:"Cape Verde"},{v:"KY",n:"Cayman Islands"},{v:"CF",n:"Central African Republic"},{v:"TD",n:"Chad"},{v:"CL",n:"Chile"},{v:"CN",n:"China"},{v:"CX",n:"Christmas Island"},{v:"CC",n:"Cocos (Keeling) Islands"},{v:"CO",n:"Colombia"},{v:"KM",n:"Comoros"},{v:"CG",n:"Congo"},{v:"CD",n:"Congo, The Democratic Republic of The"},{v:"CK",n:"Cook Islands"},{v:"CR",n:"Costa Rica"},{v:"CI",n:"Cote D'ivoire"},{v:"HR",n:"Croatia"},{v:"CU",n:"Cuba"},{v:"CY",n:"Cyprus"},{v:"CZ",n:"Czech Republic"},{v:"DK",n:"Denmark"},{v:"DJ",n:"Djibouti"},{v:"DM",n:"Dominica"},{v:"DO",n:"Dominican Republic"},{v:"EC",n:"Ecuador"},{v:"EG",n:"Egypt"},{v:"SV",n:"El Salvador"},{v:"GQ",n:"Equatorial Guinea"},{v:"ER",n:"Eritrea"},{v:"EE",n:"Estonia"},{v:"ET",n:"Ethiopia"},{v:"FK",n:"Falkland Islands (Malvinas)"},{v:"FO",n:"Faroe Islands"},{v:"FJ",n:"Fiji"},{v:"FI",n:"Finland"},{v:"FR",n:"France"},{v:"GF",n:"French Guiana"},{v:"PF",n:"French Polynesia"},{v:"TF",n:"French Southern Territories"},{v:"GA",n:"Gabon"},{v:"GM",n:"Gambia"},{v:"GE",n:"Georgia"},{v:"DE",n:"Germany"},{v:"GH",n:"Ghana"},{v:"GI",n:"Gibraltar"},{v:"GR",n:"Greece"},{v:"GL",n:"Greenland"},{v:"GD",n:"Grenada"},{v:"GP",n:"Guadeloupe"},{v:"GU",n:"Guam"},{v:"GT",n:"Guatemala"},{v:"GG",n:"Guernsey"},{v:"GN",n:"Guinea"},{v:"GW",n:"Guinea-bissau"},{v:"GY",n:"Guyana"},{v:"HT",n:"Haiti"},{v:"HM",n:"Heard Island and Mcdonald Islands"},{v:"VA",n:"Holy See (Vatican City State)"},{v:"HN",n:"Honduras"},{v:"HK",n:"Hong Kong"},{v:"HU",n:"Hungary"},{v:"IS",n:"Iceland"},{v:"IN",n:"India"},{v:"ID",n:"Indonesia"},{v:"IR",n:"Iran, Islamic Republic of"},{v:"IQ",n:"Iraq"},{v:"IE",n:"Ireland"},{v:"IM",n:"Isle of Man"},{v:"IL",n:"Israel"},{v:"IT",n:"Italy"},{v:"JM",n:"Jamaica"},{v:"JP",n:"Japan"},{v:"JE",n:"Jersey"},{v:"JO",n:"Jordan"},{v:"KZ",n:"Kazakhstan"},{v:"KE",n:"Kenya"},{v:"KI",n:"Kiribati"},{v:"KP",n:"Korea, Democratic People's Republic of"},{v:"KR",n:"Korea, Republic of"},{v:"XK",n:"Kosovo, Republic of"},{v:"KW",n:"Kuwait"},{v:"KG",n:"Kyrgyzstan"},{v:"LA",n:"Lao People's Democratic Republic"},{v:"LV",n:"Latvia"},{v:"LB",n:"Lebanon"},{v:"LS",n:"Lesotho"},{v:"LR",n:"Liberia"},{v:"LY",n:"Libyan Arab Jamahiriya"},{v:"LI",n:"Liechtenstein"},{v:"LT",n:"Lithuania"},{v:"LU",n:"Luxembourg"},{v:"MO",n:"Macao"},{v:"MK",n:"Macedonia, The Former Yugoslav Republic of"},{v:"MG",n:"Madagascar"},{v:"MW",n:"Malawi"},{v:"MY",n:"Malaysia"},{v:"MV",n:"Maldives"},{v:"ML",n:"Mali"},{v:"MT",n:"Malta"},{v:"MH",n:"Marshall Islands"},{v:"MQ",n:"Martinique"},{v:"MR",n:"Mauritania"},{v:"MU",n:"Mauritius"},{v:"YT",n:"Mayotte"},{v:"MX",n:"Mexico"},{v:"FM",n:"Micronesia, Federated States of"},{v:"MD",n:"Moldova, Republic of"},{v:"MC",n:"Monaco"},{v:"MN",n:"Mongolia"},{v:"ME",n:"Montenegro"},{v:"MS",n:"Montserrat"},{v:"MA",n:"Morocco"},{v:"MZ",n:"Mozambique"},{v:"MM",n:"Myanmar"},{v:"NA",n:"Namibia"},{v:"NR",n:"Nauru"},{v:"NP",n:"Nepal"},{v:"NL",n:"Netherlands"},{v:"AN",n:"Netherlands Antilles"},{v:"NC",n:"New Caledonia"},{v:"NZ",n:"New Zealand"},{v:"NI",n:"Nicaragua"},{v:"NE",n:"Niger"},{v:"NG",n:"Nigeria"},{v:"NU",n:"Niue"},{v:"NF",n:"Norfolk Island"},{v:"MP",n:"Northern Mariana Islands"},{v:"NO",n:"Norway"},{v:"OM",n:"Oman"},{v:"PK",n:"Pakistan"},{v:"PW",n:"Palau"},{v:"PS",n:"Palestinian Territory, Occupied"},{v:"PA",n:"Panama"},{v:"PG",n:"Papua New Guinea"},{v:"PY",n:"Paraguay"},{v:"PE",n:"Peru"},{v:"PH",n:"Philippines"},{v:"PN",n:"Pitcairn"},{v:"PL",n:"Poland"},{v:"PT",n:"Portugal"},{v:"PR",n:"Puerto Rico"},{v:"QA",n:"Qatar"},{v:"RE",n:"Reunion"},{v:"RO",n:"Romania"},{v:"RU",n:"Russian Federation"},{v:"RW",n:"Rwanda"},{v:"SH",n:"Saint Helena"},{v:"KN",n:"Saint Kitts and Nevis"},{v:"LC",n:"Saint Lucia"},{v:"PM",n:"Saint Pierre and Miquelon"},{v:"VC",n:"Saint Vincent and The Grenadines"},{v:"WS",n:"Samoa"},{v:"SM",n:"San Marino"},{v:"ST",n:"Sao Tome and Principe"
},{v:"SA",n:"Saudi Arabia"},{v:"SN",n:"Senegal"},{v:"RS",n:"Serbia"},{v:"SC",n:"Seychelles"},{v:"SL",n:"Sierra Leone"},{v:"SG",n:"Singapore"},{v:"SK",n:"Slovakia"},{v:"SI",n:"Slovenia"},{v:"SB",n:"Solomon Islands"},{v:"SO",n:"Somalia"},{v:"ZA",n:"South Africa"},{v:"GS",n:"South Georgia and The South Sandwich Islands"},{v:"ES",n:"Spain"},{v:"LK",n:"Sri Lanka"},{v:"SD",n:"Sudan"},{v:"SR",n:"Suriname"},{v:"SJ",n:"Svalbard and Jan Mayen"},{v:"SZ",n:"Swaziland"},{v:"SE",n:"Sweden"},{v:"CH",n:"Switzerland"},{v:"SY",n:"Syrian Arab Republic"},{v:"TW",n:"Taiwan, Province of China"},{v:"TJ",n:"Tajikistan"},{v:"TZ",n:"Tanzania, United Republic of"},{v:"TH",n:"Thailand"},{v:"TL",n:"Timor-leste"},{v:"TG",n:"Togo"},{v:"TK",n:"Tokelau"},{v:"TO",n:"Tonga"},{v:"TT",n:"Trinidad and Tobago"},{v:"TN",n:"Tunisia"},{v:"TR",n:"Turkey"},{v:"TM",n:"Turkmenistan"},{v:"TC",n:"Turks and Caicos Islands"},{v:"TV",n:"Tuvalu"},{v:"UG",n:"Uganda"},{v:"UA",n:"Ukraine"},{v:"AE",n:"United Arab Emirates"},{v:"GB",n:"United Kingdom"},{v:"USA",n:"United States"},{v:"UM",n:"United States Minor Outlying Islands"},{v:"UY",n:"Uruguay"},{v:"UZ",n:"Uzbekistan"},{v:"VU",n:"Vanuatu"},{v:"VE",n:"Venezuela"},{v:"VN",n:"Viet Nam"},{v:"VG",n:"Virgin Islands, British"},{v:"VI",n:"Virgin Islands, U.S."},{v:"WF",n:"Wallis and Futuna"},{v:"EH",n:"Western Sahara"},{v:"YE",n:"Yemen"},{v:"ZM",n:"Zambia"},{v:"ZW",n:"Zimbabwe"}]}}(),function(){"use strict";window.IS.subs={PRO:{MONTHLY:{cost:2,cost_text:"$2 month",desc:"Monthly ImageShack Premium",short_desc:"Premium $2/month",term:"MONTHLY",RECUR:{paypal_id:"BMPSUEV5RD79Y",type:"subpro1_v2",reps:300}},ANNUAL:{cost:20,cost_text:"$20 year",desc:"Annual ImageShack Premium",short_desc:"Premium $20/year",term:"YEARLY",RECUR:{paypal_id:"YY79U7QJ66P9G",type:"subpro12_v2",reps:300},ONE_TIME:{paypal_id:"TNYM7KZSVAP5A",type:"subpro12_v2_one",reps:0}}},WF_PROMO:{MONTHLY:{cost:1.99,cost_text:"$1.99 month",desc:"Monthly ImageShack Premium",short_desc:"Premium $1.99/month",term:"MONTHLY",RECUR:{paypal_id:"PVC9M5SZ2JN24",type:"subpromo1_v3",reps:300}},ANNUAL:{cost:18.99,cost_text:"$18.99 year",desc:"Annual ImageShack Premium",short_desc:"Premium $18.99/year",term:"YEARLY",discount:.2,RECUR:{paypal_id:"6UM7ZG5RS8V28",type:"subpromo12_v3",reps:300},ONE_TIME:{paypal_id:"3A4UAL6U4EL2J",type:"subpromo12_1_v3",reps:0}}},WF_BASIC:{MONTHLY:{cost:3.99,cost_text:"$3.99 month",desc:"Monthly ImageShack Premium",short_desc:"Premium $3.99/month",term:"MONTHLY",RECUR:{paypal_id:"C9LK9FFTHZ5Y4",type:"subbasic1_v3",reps:300}},ANNUAL:{cost:37.99,cost_text:"$37.99 year",desc:"Annual ImageShack Premium",short_desc:"Premium $37.99/year",term:"YEARLY",discount:.2,RECUR:{paypal_id:"CQ2878MTT59ZE",type:"subbasic12_v3",reps:300},ONE_TIME:{paypal_id:"LYG2B8SA53BGW",type:"subbasic12_1_v3",reps:0}}},WF_BASIC2:{MONTHLY:{cost:2.99,cost_text:"$2.99 month",desc:"Monthly ImageShack Premium",short_desc:"Premium $2.99/month",term:"MONTHLY",RECUR:{paypal_id:"S8FWA7C2X93NS",type:"subbasic1_v4",reps:300}},ANNUAL:{cost:28.99,cost_text:"$28.99 year",desc:"Annual ImageShack Premium",short_desc:"Premium $28.99/year",term:"YEARLY",discount:.2,RECUR:{paypal_id:"ZE6VP4YGWQJ5S",type:"subbasic12_v4",reps:300},ONE_TIME:{paypal_id:"WCHXQGCWS5682",type:"subbasic12_1_v4",reps:0}}},WF_BASIC3:{MONTHLY:{cost:4.99,cost_text:"$4.99 month",desc:"Monthly ImageShack Premium",short_desc:"Premium $4.99/month",term:"MONTHLY",RECUR:{paypal_id:"YVF2JY4G7E7Y6",type:"subbasic1_v5",reps:300}},ANNUAL:{cost:47.99,cost_text:"$47.99 year",desc:"Annual ImageShack Premium",short_desc:"Premium $47.99/year",term:"YEARLY",discount:.2,RECUR:{paypal_id:"J5BPSVJRVKHLE",type:"subbasic12_v5",reps:300},ONE_TIME:{paypal_id:"U7KXNV8R6MLRU",type:"subbasic12_1_v5",reps:0}}},WF_PRO:{MONTHLY:{cost:29.99,cost_text:"$29.99 month",desc:"Monthly ImageShack Premium",short_desc:"Premium $29.99/month",term:"MONTHLY",RECUR:{paypal_id:"Z38M2ANL3FSYL",type:"subpro1_v3",reps:300}},ANNUAL:{cost:285.99,cost_text:"$285.99 year",desc:"Annual ImageShack Premium",short_desc:"Premium $285.99/year",term:"YEARLY",discount:.2,RECUR:{paypal_id:"UQY5HMZASFAQ2",type:"subpro12_v3",reps:300},ONE_TIME:{paypal_id:"A5Y6ZAW8Y7PM4",type:"subpro12_1_v3",reps:0}}},WF_PREMIUM:{MONTHLY:{cost:99.99,cost_text:"$99.99 month",desc:"Monthly ImageShack Premium",short_desc:"Premium $99.99/month",term:"MONTHLY",RECUR:{paypal_id:"GJLN5WQFR5MYS",type:"subprem1_v3",reps:300}},ANNUAL:{cost:953.99,cost_text:"$953.99 year",desc:"Annual ImageShack Premium",short_desc:"Premium $953.99/year",term:"YEARLY",discount:.2,RECUR:{paypal_id:"2C39VNCGMBD6C",type:"subprem12_v3",reps:300},ONE_TIME:{paypal_id:"AGSPNZ4XFH29W",type:"subprem12_1_v3",reps:0}}},PROMO:{NEW_USERS:{cost:18.99,cost_text:"$18.99 year",desc:"Annual ImageShack Premium",short_desc:"Premium $18.99/year",term:"YEARLY",discount:.5,ONE_TIME:{paypal_id:"3A4UAL6U4EL2J",type:"subpromo12_1_v3",reps:0}},OLD_USERS:{cost:14,cost_text:"$14 year",desc:"Annual ImageShack Premium",short_desc:"Premium $14/year",discount:.3,ONE_TIME:{paypal_id:"QJR572GVPQJPJ",type:"subpromo12_old",reps:0}},FIFTY_OFF:{MONTHLY:{cost:1,cost_text:"$1 month",desc:"Monthly ImageShack Premium",short_desc:"Premium $1/month",term:"MONTHLY",RECUR:{paypal_id:"CWHTJT6HEBT9A",type:"subpromo1",reps:12}},ANNUAL:{cost:12,cost_text:"$12 year",desc:"Annual ImageShack Premium",short_desc:"Premium $12/year",term:"YEARLY",RECUR:{paypal_id:"JZJWGJHYXSY4C",type:"subpromo12",reps:0}}}},BUS:{ROOKIE:{cost:10,cost_text:"$10 month",desc:"Monthly ImageShack Business - Rookie",short_desc:"Business $10/month",term:"MONTHLY",RECUR:{paypal_id:"67STG5Z7EK9JG",type:"subbus0",reps:300}},BASIC:{cost:30,cost_text:"$30 month",desc:"Monthly ImageShack Business - Basic",short_desc:"Business $30/month",term:"MONTHLY",RECUR:{paypal_id:"F2NN3PXXPTB72",type:"subbus1",reps:300}},PRO:{cost:60,cost_text:"$60 month",desc:"Monthly ImageShack Business - Pro",short_desc:"Business $60/month",term:"MONTHLY",RECUR:{paypal_id:"82SMJBN8BNCTU",type:"subbus2",reps:300}},PREMIUM:{cost:100,cost_text:"$100 month",desc:"Monthly ImageShack Business - Premium",short_desc:"Business $100/month",term:"MONTHLY",RECUR:{paypal_id:"X8B623FSNNAVL",type:"subbus3",reps:300}}}}}(),function(){"use strict";IS.cm={USE_LOCALSTORAGE:!1,TIMES:{FIVE_MINS:300,HOUR:3600,TWO_HOURS:7200,FIVE_HOURS:18e3,SIX_HOURS:21600,TWELVE_HOURS:43200,DAY:86400},initialize:function(){return _.has(Backbone,"fetchCache")?(this.USE_LOCALSTORAGE?IS.logger.log("[IS.cm] localStorage enabled"):(Backbone.fetchCache.localStorage=!1,IS.logger.log("[IS.cm] localStorage disabled")),void(Backbone.fetchCache.getCacheKey=function(a,b){var c;return(c=b&&b.url?b.url:_.isFunction(a.url)?a.url():a.url)?(b&&b.data?(c+="?"+$.param(b.data),a.cacheKey&&(c+="&_cache_"+a.cacheKey+"=1")):a.cacheKey&&(c+="?_cache_"+a.cacheKey+"=1"),c):void 0})):void IS.logger.log("[IS.cm] Initialize failed")},cache:function(){return Backbone.fetchCache._cache},cacheCount:function(){return _.size(this.cache())},invalidateByCacheKey:function(a){var b="_cache_"+a+"=1",c=_.filter(_.keys(this.cache()),function(a){return-1!=a.indexOf(b)});return c.length?(_.each(c,function(a){_.has(this.cache(),a)&&(Backbone.fetchCache.clearItem(a),IS.logger.log("[IS.cm] Cache invalidated",{key:a}))}.bind(this)),c.length):(IS.logger.log("[IS.cm] Cache key doesn't exist",{key:a}),0)},invalidateByKey:function(a){return _.has(this.cache(),a)?(Backbone.fetchCache.clearItem(a),IS.logger.log("[IS.cm] Cache invalidated",{key:a}),!0):(IS.logger.log("[IS.cm] Cache key doesn't exist",{key:a}),!1)},invalidateAll:function(){var a=_.size(this.cache());_.each(this.cache(),function(a,b){Backbone.fetchCache.clearItem(b)}),this.USE_LOCALSTORAGE&&localStorage.clear(),IS.logger.log("[IS.cm] All cache invalidated",{size:a})}}}(),function(){"use strict";window.IS.helpers={shortenText:function(a,b){return a=$.trim(a),b=b||16,a.length<=b?a:a.substring(0,b)+"..."},infiniteScroll:function(a){var b=$(window),c=$(document);a=_.extend({$target:b,$reference:b,threshold:700,interval:200,callback:function(){}},a);var d=_.throttle(function(){var d=0;d=a.$target==b&&a.$reference==b?c.height()-b.height()-b.scrollTop():a.$reference.height()-a.$target.height()-a.$target.scrollTop(),d<=a.threshold&&(IS.logger.log("[InfiniteScroll] Firing scroll at "+d),a.callback.call(this))},a.interval);return a.$target.on("scroll",d),d},removeInfiniteScroll:function(a){a=_.extend({$target:$(window),callback:null},a),a.$target.off("scroll",a.callback),IS.logger.log("[InfiniteScroll] Unbinding infinite scroll on ",a.$target.selector)},parseTags:function(a){if(a=$.trim(a),!a.length)return[];var b=/(".*?"|\S+)/g,c=a.split(b),d=[];return c.length<=1?d=a.split(" "):(d=_.filter(c,function(a){return a=$.trim(a),!_.isEmpty(a)}),d=_.map(d,function(a){return a.replace(/\"/g,"")})),d=_.uniq(d)},isEnterKey:function(a){return 13==a},isEscapeKey:function(a){return 27==a},isShiftKey:function(a){return 16==a},isLeftArrowKey:function(a){return 37==a},isRightArrowKey:function(a){return 39==a},isUpArrowKey:function(a){return 38==a},isDownArrowKey:function(a){return 40==a},preloadImages:function(a,b){b=b||function(){};var c=[];return a&&a.length?(_.each(a,function(a){var d=new Image;d.src=a,d.onload=b,c.push(d)}),c):c},displayUserMessage:function(a,b){return this._triggerGlobalUserMessage(a,!1,b)},displayUserError:function(a,b){return this._triggerGlobalUserMessage(a,!0,b)},_triggerGlobalUserMessage:function(a,b,c){var d=new IS.Views.GlobalUserMessage({model:new Backbone.Model({message:a,is_error:b})});return c?_.delay(function(){$("body").append(d.render().el)},c):$("body").append(d.render().el),d},numberWithCommas:function(a){if(!a)return"0";var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")},stripHTML:function(a){return a?a.replace(/(&lt;|<)(?:.|\s)*?(&gt;|>)/g,""):""},getDateString:function(a,b){b=b||!1;var c=new Date(a),d=c.getMinutes(),e=c.getHours(),f=e>11?"pm":"am",g="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");return 10>d&&(d="0"+d),e>12&&(e-=12),b?g[c.getMonth()]+" "+c.getDate()+", "+c.getFullYear():g[c.getMonth()]+" "+c.getDate()+", "+c.getFullYear()+" "+e+":"+d+f},getDateTime:function(a){var b=new Date(a),c=b.getMonth()+1,d=b.getDate(),e=b.getHours(),f=b.getMinutes();return 10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),10>f&&(f="0"+f),b.getFullYear()+"-"+c+"-"+d+" "+e+":"+f},getSlashedDate:function(a){var b=new Date(a),c=b.getMonth()+1,d=b.getDate();return 10>c&&(c="0"+c),10>d&&(d="0"+d),c+"/"+d+"/"+b.getFullYear()},getMonthDayDate:function(a){var b=new Date(a),c=b.getMonth()+1,d=b.getDate();return 10>c&&(c="0"+c),10>d&&(d="0"+d),c+"/"+d},getPrettyDate:function(a,b){var c,d=(new Date).getTime(),e=1e3,f=60*e,g=60*f,h=24*g,i=Math.abs(d-a);return 3*e>=i?"just now":f>i?(c=Math.floor(i/e),c+" second"+(c>1?"s":"")):g>i?(c=Math.floor(i/f),c+" minute"+(c>1?"s":"")):h>i?(c=Math.floor(i/g),c+" hour"+(c>1?"s":"")):3*h>i?(c=Math.floor(i/h),c+" day"+(c>1?"s":"")):b?(c=Math.floor(i/h),c+" day"+(c>1?"s":"")):this.getDateString(a)},getPrettyFileSize:function(a,b){_.isUndefined(b)&&(b=1);var c,d={KB:1024,MB:1048576,GB:1073741824},e=a/d.KB;return c=e<d.KB?e.toFixed(1)+"KB":e<d.MB?(a/d.MB).toFixed(b)+"MB":(a/d.GB).toFixed(b)+"GB",c.replace(/(\d+)\.0/,"$1")},showLoginSignupOverlay:function(a,b,c){var d=new IS.Views.GlobalLoginSignup({model:new Backbone.Model({callback:a,message:b||"Log in or sign up to continue."}),fetchAlbums:c}),e=this.displayOverlay({content:d,width:IS.Views.GlobalLoginSignup.WIDTH,otherClassName:"login-signup"});d.initFbButton().postRenderSetup(),d.once("login:success",function(){a(),e.close()})},showCreditCardFormOverlay:function(a){var b=new IS.Views.CreditCardForm({model:a.model}),c=IS.helpers.displayOverlay({content:b,width:IS.Views.CreditCardForm.WIDTH,enableErrorHandling:!0,ignoreEscKey:!0});return b.once("close",function(){c.close()}),b},showSubForm:function(a,b,c,d){if(!IS.currentUser)return void IS.helpers.showLoginSignupOverlay(function(){this.showSubForm(a,b)}.bind(this));b=b||"PRO";var e=new IS.Views.SubForm({model:a?new Backbone.Model(a):null,category:b,overrideMessage:c,expireMessage:d}),f=IS.helpers.displayOverlay({content:e,width:710});e.once("close",function(){f.close()})},setPageTitle:function(a){a&&(document.title=document.title.replace(/-.*/,"- "+a))},displayOverlay:function(a){var b=new IS.Views.GlobalOverlay(a);return $("body").append(b.render().el),_.defer(function(){b.show()}),b},initFileUploader:function(a){if(a=a||{},window.fileUploader)return void(a.files?window.fileUploader.pushFiles(a.files).processQueue():IS.vent.trigger("global_overlay:fade:in"));if(!IS.currentUser)return void IS.helpers.showLoginSignupOverlay(function(){this.initFileUploader(a)}.bind(this),null,!0);window.fileUploader=new IS.Views.FileUploader({model:new Backbone.Model});var b=this.displayOverlay({content:window.fileUploader,width:IS.Views.FileUploader.WIDTH,otherClassName:"uploader",ignoreEscKey:!0,enableErrorHandling:!0,enableSuccessHandling:!0,skipHeightCSS:!0});b.on("drag:enter",function(){window.fileUploader.trigger("drag:enter")}).on("drag:leave",function(){window.fileUploader.trigger("drag:leave")}).on("drop:files",function(a){window.fileUploader.trigger("drop:files",a)}).on("content:clicked",function(){window.fileUploader.trigger("hide:dropdowns")}).on("action:close",function(){window.fileUploader.trigger("force:quit")}),window.fileUploader.once("closed",function(a){a&&a.firstImageId&&IS.Collections.Activities.registerUploads(a.firstImageId),b.close()}),a.files&&window.fileUploader.pushFiles(a.files).processQueue()},capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},confirmAction:function(a){var b=$.Deferred(),c=new IS.Views.GlobalConfirm({model:new Backbone.Model({message:a.message,sub_message:a.sub_message,cancel_text:(a.cancel_text||"Cancel").toUpperCase(),confirm_text:(a.confirm_text||"Confirm").toUpperCase()}),centered:!!a.centered}),d=this.displayOverlay({content:c,width:IS.Views.GlobalConfirm.WIDTH});return c.once("action:confirm",function(){b.resolve(),d.close()}).once("action:cancel",function(){b.reject(),d.close()}),d.once("action:close",function(){b.reject()}),b.promise()},getParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))},loadTemplate:function(a){return IS.CONS.PROD?IS.templates[a]:$("#tpl-"+a.replace(/_/g,"-")).html()},renderTemplate:function(a,b){var c;return c="function"==typeof a?a(b):Mustache.render(a,b)},convertLinks:function(a){if(!a)return"";var b=/(http:|ftp:|https:)?\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#])?/gi;return a.replace(b,function(a){return'<a data-bypass="true" href="'+(/^(http:\/\/|https:\/\/)/.test(a)?a:"http://"+a)+'" rel="nofollow">'+this.shortenText(a.replace(/^(http:\/\/[www\.]*|https:\/\/[www\.]*|[www\.]*)/,""),24)+"</a>"}.bind(this))},convertUsernames:function(a){var b;return(b=a.match(/[@]+[A-Za-z0-9-_]+/g))?($.each(b,function(b,c){var d=c.split("@")[1],e=a.indexOf(d);return e>a.indexOf("<a href")&&e<a.indexOf("</a>")?!0:void(a=a.replace(c,'<a href="/user/'+d+'">@'+d+"</a>"))}),a):a},isGif:function(a){return/\.gif$/i.test(a)},getImagizerLink:function(a,b){return b=b||!1,_.extend(a,{cropped:!!a.cropped,quality:a.quality||90,rotation_angle:a.rotation_angle||!1,retina:!b&&IS.helpers.isRetinaDevice()}),Mustache.render(IS.inlineTemplates.imagizer_img,a)},getAvatarLink:function(a,b){return b.cropped?"https://imagizer.imageshack.us/v2/"+a+"x"+a+"q90/https://imagizer.imageshack.us/v2/q90/"+b.x_pos+","+b.y_pos+","+b.x_length+","+b.y_length+"/"+b.server+"/"+b.filename:this.getImagizerLink({server:b.server,filename:b.filename,width:a,height:a,cropped:!0},!1)},getAdjustedDimensions:function(a){var b,c;return a.width<a.maxWidth?(b=a.width,c=a.height):(b=a.maxWidth,c=Math.floor(b*a.height/a.width)),a.maxHeight&&c>a.maxHeight&&(c=a.maxHeight,b=Math.floor(a.width*c/a.height)),{width:b,height:c}},isRetinaDevice:function(){return window.devicePixelRatio>1},animateScrollLeft:function(a,b,c){a.stop().animate({scrollLeft:b},c||250)},animateScrollTop:function(a,b,c){a.stop().animate({scrollTop:b},c||250)},isPremiumSubscription:function(a){return!!a.match(/sub(pro|basic|promo|prem)?\d+/)},isAnnualPremiumSub:function(a){return!!a.match(/sub(pro|promo)12/)},isBusinessSubscription:function(a){return!!a.match(/subbus\d+/)},isSkypathPromoSubscription:function(a){return!!a.match(/skypath\d+/)},isTrialSubscription:function(a){return!!a.match(/subtrial\d+/)},isStudentSubscription:function(a){return!!a.match(/substudent\d+/)},isPromoPricedSubscription:function(a){return 0===a.indexOf("subpromo")},getStatesList:function(){return IS.CONS.LARGE.STATES},getCountryList:function(){return IS.CONS.LARGE.COUNTRIES},showWelcomeVideoOverlay:function(){var a=new IS.Views.WelcomeVideo;IS.helpers.displayOverlay({content:a,width:IS.Views.WelcomeVideo.WIDTH,height:IS.Views.WelcomeVideo.HEIGHT})},applyCSS:function(a,b,c){_.each("moz webkit ms o".split(" "),function(d){a.css("-"+d+"-"+b,c)},this),a.css(b,c)},getTimeString:function(a){var b=new Date(a),c=b.getHours(),d=b.getMinutes(),e=b.getSeconds();return 10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),c+":"+d+":"+e+" "+(parseInt(c)>11?"PM":"AM")},showSurveyBox:function(){return},showFeaturesOverlay:function(){var a=new IS.Views.FeaturesOverlay,b=this.displayOverlay({content:a,width:IS.Views.FeaturesOverlay.WIDTH});a.once("close",function(){b.close()})},getScreenType:function(){var a=$(window).width();return a>=768?"tablet":768>=a?"phone":void 0},openWindow:function(a,b){var c="width="+a.width+",height="+a.height+",menubar=1,toolbar=1";if(b){var d=Math.round((screen.width-a.width)/2),e=Math.round((screen.height-a.height)/2);c+=",left="+d+",top="+e}return window.open(a.url,a.name||"window",c)},isNewServer:function(a){var b=[536,537,538,539,540,590,631,633,661,673,674,742,743,745,746,901,902,903,904,905,906,907,908,909,910,911,912,913];return b.indexOf(a)>=0},showImageOverlay:function(a){a.likeCallback=a.likeCallback||function(){},a.unlikeCallback=a.unlikeCallback||function(){};var b=new IS.Models.Landing({id:a.id,nextPrevAlbum:a.nextPrevAlbum}),c=window.location.pathname;b.once("request",function(){IS.vent.trigger("app_layout:content:loading")}).once("sync",function(b){IS.vent.trigger("app_layout:content:loaded");var d=new IS.Views.ImageOverlay({model:b,disableNav:!!a.disableNav,enableLandingLink:!0,standAlone:!0,nextPrevAlbum:a.nextPrevAlbum});$("body").append(d.render().el),d.on({close:function(){IS.vent.off("app_layout:destroy:overlay"),IS.vent.trigger("route:navigate",{route:c,trigger:!1,replace:!0})},liked:function(){a.likeCallback.call()},unliked:function(){a.unlikeCallback.call()}}),_.defer(function(){d.show()}.bind(this)),IS.vent.trigger("route:navigate",{route:IS.Models.Photo.landingURL(a.id),trigger:!1,replace:!1}),IS.vent.once("app_layout:destroy:overlay",function(){d.close()})}).once("error",function(){IS.vent.trigger("app_layout:content:loaded")}),b.fetch()},initImageCropper:function(a){var b=new IS.Views.ImageCropper({model:new Backbone.Model({server:a.server,filename:a.filename,width:a.width,height:a.height,type:a.type,id:a.id})});return $("body").append(b.render().el),_.defer(function(){b.show()}.bind(this)),b},showTrialExpiredDialog:function(){var a=IS.Views.Mixins.Messages;IS.helpers.confirmAction({message:a.trialExpired,sub_message:Mustache.render(a.trialExpiredSub,{extra:""}),confirm_text:"Upgrade",centered:!0}).done(function(){window.location="/upgrade"})},getAdHTML:function(a){return new IS.Views.Ad({model:new IS.Models.Ad(a)}).render().el}}}(),function(){"use strict";_.isUndefined(String.prototype.isValidEmail)&&(String.prototype.isValidEmail=function(){var a=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return this.match(a)}),_.isUndefined(Backbone.View.prototype.destroy)&&(Backbone.View.prototype._destroyed=!1,Backbone.View.prototype.destroy=function(){IS.vent.off(null,null,this),this._destroyed=!0,this.undelegateEvents(),this.$el.unbind(),this.remove()}),_.isUndefined(Date.prototype.daysPerMonth)&&(Date.prototype.daysPerMonth=function(a){var b=void 0==a?this.getMonth()+1:a+1,c=new Date(this.getFullYear(),b,0);return c.getDate()}),_.isUndefined(Date.prototype.getFirstDay)&&(Date.prototype.getFirstDay=function(a){var b=void 0==a?this.getMonth():a,c=new Date(this.getFullYear(),b,1);return c.getDay()}),Date.now=Date.now||function(){return+new Date}}(),function(){"use strict";Backbone||IS.logger.error("[CollectionPaginated] Must require Backbone.js first"),Backbone.CollectionPaginated=Backbone.Collection.extend({initialize:function(a,b){b=b||{},this.options=b,this.isFetching=!1,this.page=b.page||1,this.limit=b.limit||12,this.useEndOffset=!!b.useEndOffset,this.endOffset=b.endOffset,this.username=b.username,this.useFollowing=!!b.useFollowing,this.totalPages=null,_.isNull(b.totalCount)||this.setTotalCount(b.totalCount),_.bindAll(this,"fetch","parse","nextPage","previousPage")},fetch:function(a){a=a||{},this.trigger("fetch:started",{page:this.page}),this.isFetching=!0,IS.et.ts("Collection Paginated","Fetch");var b=a.success||function(){},c=a.success||function(){},d=this;return Backbone.Collection.prototype.fetch.call(this,_.extend(a,{success:function(a,c){IS.et.te("Collection Paginated","Fetch"),d.useEndOffset&&(d.endOffset=c.result.end_offset);var e=d.useEndOffset?!!d.endOffset:d.page<d.totalPages;d.trigger("fetch:success",{page:d.page,areMorePages:e}),d.trigger("fetch:completed"),b(c,{page:d.page,areMorePages:e}),d.isFetching=!1},error:function(a,b){IS.et.te("Collection Paginated","Fetch"),d.trigger("fetch:error"),d.trigger("fetch:completed"),c(b,{}),d.isFetching=!1}}))},offset:function(){return this.useEndOffset?this.endOffset:(this.page-1)*this.limit},nextPage:function(a){return a=_.extend({success:function(){},error:function(){}},a),!this.useEndOffset&&this.page+1>this.totalPages?!1:this.isFetching||this.useEndOffset&&!this.endOffset?!1:(this.page++,this.fetch({set:!0,remove:!1,success:a.success,error:a.error}),!0)},previousPage:function(a){return a=_.extend({success:function(){},error:function(){}},a),this.page-1<1?!1:this.isFetching?!1:(this.page--,this.fetch({set:!0,remove:!1,success:a.success,error:a.error}),!0)},hasNextPage:function(){return this.useEndOffset?!!this.endOffset:this.page+1<=this.totalPages},newest:function(){return this.rest((this.page-1)*this.limit)},createURL:function(a,b){var c=IS.CONS.API_BASE+a+"?";return c+=$.param(b)},setTotalCount:function(a){this.totalCount=a,this.totalPages=Math.ceil(this.totalCount/this.limit)}})}.call(this),function(){"use strict";window.IS.logger={DEBUG:!1,REMOTE_DEBUG:!1,REMOTE_ERROR:!1,SEVERITY:{LOG:1,ERROR:2,REMOTE_LOG:3},_queue:[],_timers:{},setup:function(){if(Function.prototype.bind&&window.console&&"object"==typeof console.log){var a=["log","info","warn","error","assert","dir","clear","profile","profileEnd"];_.isUndefined(a.forEach)||a.forEach(function(a){console[a]=this.bind(console[a],console)},Function.prototype.call)}},log:function(){this._log(_.toArray(arguments),this.SEVERITY.LOG)},logRemote:function(){this._log(_.toArray(arguments),this.SEVERITY.REMOTE_LOG)},error:function(){var a=_.toArray(arguments);this._log(a,this.SEVERITY.ERROR)},time:function(a){this._timers[a]=(new Date).getTime()},timeEnd:function(a){var b=(new Date).getTime()-this._timers[a];b="[Timer] "+a+": "+b+"ms",this._log([b],this.SEVERITY.REMOTE_LOG)},_log:function(a,b){var c="["+new Date+"]";window.location&&window.location.pathname&&(c+=" ["+window.location.pathname+"] ");var d=c;d+=a[0],_.isEmpty(a.slice(1))||_.each(a.slice(1),function(a){if(_.isObject(a)){var b="";b+=" [Object";var c=_.keys(a),e=_.values(a),f=0;_.each(c,function(a){_.isFunction(e[f])&&(e[f]="Function"),b+=" "+a+":"+e[f],f++}),b+="]"}else b+=a;d+=b}),d=[d],this._queue.push(d),b==this.SEVERITY.LOG?(this.REMOTE_DEBUG&&this._sendToRemote(d,this.SEVERITY.LOG),!this.DEBUG||_.isUndefined(window.console)||_.isUndefined(console.log.apply)||console.log.apply(console,d)):b==this.SEVERITY.REMOTE_LOG?(this._sendToRemote(d,this.SEVERITY.REMOTE_LOG),!this.DEBUG||_.isUndefined(window.console)||_.isUndefined(console.log.apply)||console.log.apply(console,d)):b==this.SEVERITY.ERROR&&(this.REMOTE_ERROR&&this._sendToRemote(d,this.SEVERITY.ERROR),_.isUndefined(window.console)||_.isUndefined(console.log.apply)||console.error.apply(console,d))},_sendToRemote:function(a,b){var c=new Image;c.src="/log?s="+b+"&m="+encodeURIComponent(a)},_currentDate:function(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),e=a.getHours(),f=a.getMinutes(),g=a.getSeconds();return b+"-"+c+"-"+d+" "+e+":"+f+":"+g}}}(),function(){"use strict";window.IS.et={timers:{},ts:function(a,b){this.timers[a+":"+b]=(new Date).getTime()},te:function(a,b){var c=a+":"+b;if(IS.CONS.PROD&&"undefined"!=typeof _gaq&&this.timers[c]){var d=(new Date).getTime()-this.timers[c];IS.logger.log("[ET] Timing:",_.extend({time:d},arguments)),_gaq.push(["_trackTiming",a,b,d]),delete this.timers[c]}},pe:function(a,b,c){IS.logger.log("[ET] Event: category = "+a+", action = "+b+", label = "+c),IS.CONS.PROD&&"undefined"!=typeof _gaq&&(IS.logger.log("[ET] Event: category = "+a+", action = "+b+", label = "+c),_gaq.push(["_trackEvent",a,b,c]))},pp:function(a){IS.CONS.PROD&&"undefined"!=typeof _gaq&&(IS.logger.log("[ET] Pageview: "+a),_gaq.push(["_trackPageview",a]))}}}(),function(){"use strict";window.IS.inlineTemplates={direct:function(a){return IS.helpers.isGif(a.filename)||!a.width&&!a.height?"http:"+IS.CONS.SITE_URL+"/a/img"+a.server+"/"+a.bucket+"/"+a.filename:!IS.currentUser||IS.currentUser.get("freeAccount")?IS.Models.Photo.getExternalLink(a):"http:"+IS.helpers.getImagizerLink(a,!0)},forum:function(a){return"[URL="+IS.Models.Photo.getExternalLink(a)+"][IMG]"+(IS.helpers.isGif(a.filename)?this.direct(a):"http:"+IS.helpers.getImagizerLink(a,!0))+"[/IMG][/URL]"},"alt-forum":function(a){return"[URL="+IS.Models.Photo.getExternalLink(a)+"][IMG="+(IS.helpers.isGif(a.filename)?this.direct(a):"http:"+IS.helpers.getImagizerLink(a,!0))+"][/IMG][/URL]"},web:function(a){return'<a target="_blank" href="'+IS.Models.Photo.getExternalLink(a)+'"><img src="'+(IS.helpers.isGif(a.filename)?this.direct(a):"http:"+IS.helpers.getImagizerLink(a,!0))+'" border="0"></a>'},uploader_album_li:'<li title="{{name}}" data-value="{{id}}">{{name}}</li>',uploader_album_input:'<input type="text" placeholder="Enter album name..." class="prevent-click new-album">',auto_complete_location:'<li {{#latitude}}data-lat="{{latitude}}"{{/latitude}} {{#longitude}}data-long="{{longitude}}"{{/longitude}}>{{#city}}{{city}}, {{/city}}{{#region}}{{region}}, {{/region}}{{#country}}{{country}}{{/country}}</li>',global_user_message:'<div class="wrapper"><p class="message">{{{message}}}</p><a class="close"><span></span></a></div>',album_link:'<div class="item album"><a href="/a/{{albumId}}" data-id="{{albumId}}">{{albumName}}</a><div class="lock {{#showLock}}show{{/showLock}}"></div></div>',tag_link:'<div class="item tag"><a href="{{url}}" data-id="{{id}}">{{name}}</a><span class="num">{{count}}</span></div>',grid_photo_title:'<div class="title" title="{{title}}">{{title}}</div>',grid_photo_title_input:'<input type="text" name="title" class="edit" value="{{title}}" />',landing_photo_title:'<h1 alt="{{title}}">{{title}}</h1>',landing_photo_title_input:'<input type="text" name="title" class="edit" value="{{title}}" />',lightbox_album_link:'<div class="item" data-value="{{id}}">{{name}}</div>',scaled_60x60:"/scaled/thumb60x60/{{server}}/{{filename}}",download_link:"//imageshack.us/download/{{server}}/{{filename}}",pagination:{prev:'<a class="prev {{#disabled}}disabled{{/disabled}}"><div class="icon"></div></a>',next:'<a class="next {{#disabled}}disabled{{/disabled}}"><div class="icon"></div></a>',num:'<a class="num {{#current}}current{{/current}}" data-id="{{page}}">{{page}}</a>',spacer:'<div class="spacer">...</div>',"goto":'<div class="goto clearfix"><input type="text" /><div class="btn">Go</div></div>'},my_tags_item_thumb:'<div class="thumb"><img src="/scaled/square70/{{server}}/{{filename}}" data-id="{{id}}" onerror="this.parentNode.removeChild(this)" /></div>',imagizer_img:"//imagizer.imageshack.us/v2/{{#width}}{{width}}{{/width}}x{{#height}}{{height}}{{/height}}q{{quality}}{{#rotation_angle}}a{{rotation_angle}}{{/rotation_angle}}{{#cropped}}/c{{/cropped}}{{#retina}}/r{{/retina}}/{{server}}/{{filename}}",timeline_widget_img:'<a class="timeline-photo" href="/i/{{id}}" style="width: {{adjustedWidth}}; height: {{adjustedHeight}}"><img style="width: {{adjustedWidth}}; height: {{adjustedHeight}}" src="{{imageUrl}}" onload="this.className+=\' loaded\';"></a>',landing_related_img:"<img onload=\"this.className='loaded';\" onerror=\"this.className='invisible'; this.parentNode.className='failed';\" src=\"{{imageUrl}}\">",follow_button:'<a data-force-login="true" class="fading-button follow-button {{#isFollowed}}on{{/isFollowed}}" data-following="{{followValue}}"><span class="front">FOLLOW</span><span class="back">UNFOLLOW</span></a>',facebook_like_button:'<div class="facebook-like"><iframe src="//www.facebook.com/plugins/like.php?href={{url}}&amp;send=false&amp;layout=button_count&amp;width=100&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font&amp;height=21" scrolling="no" frameborder="0" allowTransparency="true"></iframe></div>',mobile_landing_related_img:'<div class="thumb"><img src="{{imageURL}}" data-id="{{id}}" onerror="this.parentNode.removeChild(this)"></div>',file_uploader_drop_zone:'<section id="uploader-drop-zone"><div class="message"><h3>DRAG N&#39; DROP</h3><p>You are limited to 25MB in file size.</p></div></section>',file_uploader_progress_status:"{{count}} of {{total}} {{noun}} uploaded...<span>{{progress}}%</span>",file_uploader_progress_size:"{{loaded}} of {{total}}",file_uploader_img:'<a href="/i/{{id}}" data-index="{{index}}"><img src="{{imageURL}}"></a>',option:'<option value="{{value}}">{{{name}}}</option>',user_profile_no_results:'<div class="profile-mode"><h1>{{headerTxt}}</h1><div class="sub">{{{subTxt}}}</div><div class="widget"></div></div>',help_video:'<div class="video">{{{video}}}</div><h1>{{title}}</h1><p>{{desc}}</p>',vimeo_src:'<iframe src="//player.vimeo.com/video/{{id}}?portrait=0&amp;color=f7bd25&amp;autoplay=1" width="{{width}}" height="{{height}}" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>',activity_image:'<img src="{{imageUrl}}" onerror="this.parentNode.removeChild(this)" />',survey_monkey:'<section id="survey-monkey"><iframe src="{{src}}" width="370" height="210" frameborder="0" scrolling="no"></iframe><a class="close-box"><span></span></a></section>',social_site:'<a data-bypass="true" class="social-site" href="{{profileURL}}"><span class="icon-social-{{siteName}}"></span></a>',referred_user:'<article><a class="avatar" href="/user/{{username}}"><img src="{{avatarUrl}}"></a><p class="username">{{username}}</p><time datetime="{{datetime}}">{{dateString}}</time></article>',moved_to_album:"Successfully moved {{count}} {{noun}} to selected album."}}(),function(a,b,c,d){"use strict";function e(b,c){this.VERSION="0.1",this.$el=a(b),this.resizeTimeout=null,this.clearerTemplate='<div class="lace-clearer" style="clear:both">&nbsp</div>',this.clearerClass=".lace-clearer",this.colClass=".lace-col",this.settings=a.extend({},f,c),this.settings.cols=this._getColumnCount();var d="lace-col";this.settings.additionalColClass&&(d+=" "+this.settings.additionalColClass),this.colTemplate='<div class="'+d+'" data-sort-index="%i"></div>',this.cache={cols:this._getColumnCount(),lastColAppended:null,itemIndex:0},null==this.settings.selector&&g('Missing "selector" param'),0==this.settings.colWidth&&g('Missing "colWidth" param'),null==this.settings.colPadding&&g('Missing "colPadding" param'),
this._init()}var f={cols:1,colWidth:0,colPadding:0,minCols:1,windowPadding:50,selector:null,bootstrapped:!0,centered:!1,$centerRefDiv:a(b),additionalColClass:null},g=function(a){console.error("[jQuery.lace] "+a)};e.prototype={_init:function(){if(this._createColumns(),this.settings.bootstrapped){var c="> "+this.settings.selector,d=this.$el.find(c);this._moveItemsIntoCols(d),this.evenBottom()}this.settings.centered&&this._setContainerWidth(),this.$el.find(this.clearerClass).length||this.$el.append(this.clearerTemplate),a(b).on("resize",function(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this._resize()}.bind(this),250)}.bind(this)),this.$el.addClass("laced")},_getColumnCount:function(){var a;a=this.settings.centered?this.settings.$centerRefDiv.width()-this.settings.windowPadding:this.$el.width()-this.settings.windowPadding;var b=this.settings.colWidth+this.settings.colPadding,c=Math.floor(a/b);return c<this.settings.minCols?this.settings.minCols:c},_getColumnHeights:function(){var b=this.$el.find(this.colClass);if(b.length){b=this._sortItemsByIndex(b);var c=[];b.each(function(){c.push(a(this).height())});var d={highestCol:null,highestValue:null,shortestCol:null,shortestValue:null},e=null;return a.each(c,function(a,b){null==e?(e=b,d.shortestCol=a+1):e>b&&(e=b,d.shortestCol=a+1)}),d.shortestValue=e,e=null,a.each(c,function(a,b){null==e?(e=b,d.highestCol=a+1):b>e&&(e=b,d.highestCol=a+1)}),d.highestValue=e,{$highest:this.$el.find(this.colClass+'[data-sort-index="'+d.highestCol+'"]'),highestValue:d.highestValue,$shortest:this.$el.find(this.colClass+'[data-sort-index="'+d.shortestCol+'"]'),shortestValue:d.shortestValue}}},_getContainerWidth:function(){var a=this.settings.colWidth+this.settings.colPadding;return this._getColumnCount()*a-this.settings.colPadding},_setContainerWidth:function(){this.$el.css("width",this._getContainerWidth())},_sortItemsByIndex:function(a){return a.sort(function(a,b){return a=parseInt(a.getAttribute("data-sort-index")),b=parseInt(b.getAttribute("data-sort-index")),a>b?1:b>a?-1:0})},_createColumns:function(){for(var a=this.settings.cols;a>0;a--)this.$el.prepend(this.colTemplate.replace("%i",a))},_moveItemsIntoCols:function(b){a.each(b,function(b,c){var d=a(c);a(c).attr("data-sort-index",this.cache.itemIndex);var e;e=this.cache.lastColAppended?this.cache.lastColAppended%this.settings.cols+1:b%this.settings.cols+1,this.cache.lastColAppended=e;var f=this.$el.find("> "+this.colClass+'[data-sort-index="'+e+'"]');d.appendTo(f),this.cache.itemIndex++}.bind(this))},_reLayout:function(){this.$el.find(this.settings.selector).appendTo(this.$el),this.$el.find(this.colClass).remove(),this.settings.centered&&this._setContainerWidth(),this._createColumns();var a=this._sortItemsByIndex(this.$el.find(this.settings.selector));this.cache.itemIndex=0,this.cache.lastColAppended=null,this._moveItemsIntoCols(a)},_resize:function(){this.cache.cols!=this._getColumnCount()&&(this.settings.cols=this._getColumnCount(),this.cache.cols=this.settings.cols,this._reLayout())},append:function(a){a&&a.length&&(this.evenBottom(),this._moveItemsIntoCols(a))},remove:function(b){b&&b.length&&(a.each(b,function(b,c){this.$el.find(a(c)).remove()}.bind(this)),this._reLayout())},removeAll:function(){this.$el.children(":not("+this.clearerClass+")").each(function(){a(this).remove()}),this._createColumns()},evenBottom:function(){var a=this.$el.find(this.settings.selector);if(a.length){var b=this._getColumnHeights();if(!(Math.abs(b.highestValue-b.shortestValue)<=500)&&1!=a.length)for(var c=0;c<Math.ceil(this.cache.cols/2);){b=this._getColumnHeights();var d=b.$highest.find(this.settings.selector).last();d.length&&b.$shortest.append(d),c++}}}},a.fn.lace=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this).data("lace");"string"==typeof b?d?a.isFunction(d[b])?d[b].apply(d,c):g('The method "'+b+'" does not exist'):g("Methods cannot be called before init"):d||a(this).data("lace",new e(this,b))}),this}}(jQuery,window,document),function(a,b,c,d){"use strict";function e(b,c){this.VERSION="0.0.1",this.active=!1,this.start={x:0,y:0},this.current={x:0,y:0},this.delta={x:0,y:0},this.isPinch=!1,this.settings=a.extend({},f,c),this.$el=a(b),this.bindEvents()}var f={callback:function(a){},swipeSensitivity:100,scrollSensitivity:2};e.prototype={bindEvents:function(){this.$el.length&&(this.$el.on("touchstart",function(){this.touchStart()}.bind(this)),this.$el.on("touchmove",function(){this.touchMove()}.bind(this)))},touchStart:function(){this.active=!0,this.isPinch=event.touches.length>1,this.start.x=this.current.x=event.targetTouches[0].pageX,this.start.y=this.current.y=event.targetTouches[0].pageY},touchMove:function(){this.active&&!this.isPinch&&(this.current.x=event.targetTouches[0].pageX,this.current.y=event.targetTouches[0].pageY,this.delta.x=this.current.x-this.start.x,this.delta.y=this.current.y-this.start.y,Math.abs(this.delta.y)<Math.abs(this.delta.x*this.settings.scrollSensitivity)&&event.preventDefault(),this.delta.x<-this.settings.swipeSensitivity?(this.settings.callback("L"),this.active=!1):this.delta.x>this.settings.swipeSensitivity&&(this.settings.callback("R"),this.active=!1))}},a.fn.horizon=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this).data("horizon");"string"==typeof b?d?a.isFunction(d[b])?d[b].apply(d,c):a.error('The method "'+b+'" does not exist'):a.error("Methods cannot be called before init"):d||a(this).data("horizon",new e(this,b))}),this}}(jQuery,window,document),IS.Templates.Desktop={imageReferrer:'<article class="referrer"><a data-bypass="true" href="{{url}}">{{url}}</a><span>{{count}}</span></article>',grid:{noResultsBg:'<div class="bg"><a class="button">UPLOAD YOUR FIRST IMAGES</a></div>',noFollowingResultsBg:'<div class="bg following"><a class="button">FOLLOW FEATURED PHOTOGRAPHERS</a></div>'}},IS.Templates.Mobile={sectionImages:'<section class="images"></section>',sectionGrid:'<section class="grid"></section>',overlay:['<section class="content"></section>','<div class="icon-close {{#hideCloseBtn}}hidden{{/hideCloseBtn}}"></div>'].join(""),message:'<div class="message">{{message}}</div>'},IS.Models.Activity=Backbone.Model.extend({}),IS.Models.Ad=Backbone.Model.extend({defaults:{width:300,height:250,code:""}}),IS.Models.Album=Backbone.Model.extend({urlRoot:IS.CONS.API_BASE+"/albums",initialize:function(){this.on("destroy",function(){var a=IS.currentUser.get("albums").find(function(a){return a.get("id")==this.get("id")}.bind(this));a&&IS.currentUser.get("albums").remove(a)}.bind(this),this)},parse:function(a){return a&&a.result&&a.success?a.result:a},heroURL:function(a){var b=this.get("images");if(!b||!b.length)return null;a||(a=0);var c=new IS.Models.Photo(b[a]);return IS.helpers.getImagizerLink({server:c.get("server"),filename:c.get("filename"),width:242,height:242,cropped:!0})},detailURL:function(){return"/a/"+this.get("id")+"/1"},detailURLWithDomain:function(){return"https:"+IS.CONS.SITE_URL+this.detailURL()},friendlyTitle:function(a){a=_.extend({len:22,shorten:!0},a);var b=this.get("title");return b&&b.length?a.shorten?IS.helpers.shortenText(b,a.len):b:"Untitled"},ownerAvatarURL:function(a){var b=this.get("owner").avatar;return b&&b.filename&&b.server?(a=_.defaults(a||{},{server:b.server,filename:b.filename,width:50,height:50,cropped:!0}),IS.helpers.getImagizerLink(a)):"/v2_images/default_avatar_120x120.jpg"},isUserOwner:function(a){return a&&a.get("username")&&this.get("owner")&&this.get("owner").username?a.get("username")==this.get("owner").username:!1},isPublic:function(){return this.get("public")},isPrivate:function(){return!this.get("public")&&!this.get("password_protected")},isPrivatePass:function(){return this.get("password_protected")},removeImage:function(a){if(!a)return IS.logger.error("[Models.Album] Missing photoModel in removeImage");var b=$.ajax({url:IS.CONS.API_BASE+"/albums/"+this.get("id")+"/delete_files",type:"PUT",data:{files:[a.get("id")],auth_token:IS.currentUser.get("authToken")}});return IS.et.ts("Album Model","Remove Image"),$.when(b).always(function(b){this.trigger("removed_image",{success:b.success}),b.success||IS.logger.error("[Models.Album] Unable to remove image",a.attributes),IS.et.te("Album Model","Remove Image")}.bind(this)),b},addImages:function(a){if(!a||!a.length)return IS.logger.error("[Models.Album] photos missing or empty in addImages");var b=_.pluck(a,"id"),c=$.ajax({url:IS.CONS.API_BASE+"/albums/"+this.get("id")+"/add_files",type:"PUT",data:{files:b,auth_token:IS.currentUser.get("authToken")}});return IS.et.ts("Album Model","Add Images"),$.when(c).always(function(b){this.trigger("added_images",{success:b.success}),b.success||IS.logger.error("[Models.Album] Unable to add images",a),IS.et.te("Album Model","Add Images")}.bind(this)),c},follow:function(a){a=a||function(){};var b=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.FOLLOW.FOLLOWS+"/albums/"+this.id,type:"POST",data:{auth_token:IS.currentUser.get("authToken")}});return IS.et.ts("Album Model","Follow"),$.when(b).always(function(b){IS.et.te("Album Model","Follow"),b.success||IS.logger.error("[Models.Album] Unable to follow album",this.attributes),a(b)}.bind(this)),b},unfollow:function(a){a=a||function(){};var b=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.FOLLOW.FOLLOWS+"/albums/"+this.id,type:"DELETE",data:{auth_token:IS.currentUser.get("authToken")}});return IS.et.ts("Album Model","Unfollow"),$.when(b).always(function(b){IS.et.te("Album Model","Unfollow"),b.success||IS.logger.error("[Models.Album] Unable to unfollow album",this.attributes),a(b)}.bind(this)),b},authWithPassword:function(a,b,c){b=b||function(){};var d=$.ajax({url:IS.CONS.API_BASE+"/albums/"+this.get("id"),type:"POST",data:{auth_token:IS.currentUser&&IS.currentUser.get("authToken"),password:a}});return IS.et.ts("Album Model","Auth With Password"),$.when(d).then(function(a){b(a)}).fail(function(a){c(a.responseText?$.parseJSON(a.responseText):a)}).always(function(a){IS.et.te("Album Model","Auth With Password")}),d}}),IS.Models.Contact=Backbone.Model.extend({defaults:function(){var a=this.contactTable[this.contactType];return a},urlRoot:function(){return"/contact/send"},validate:function(a,b){for(var c in a){var d=a[c],e=$.trim(d);if(null===d&&"contact_street_2"!==c)return"All fields must be filled out!";if((c.indexOf("fax")>-1||c.indexOf("zip")>-1||c.indexOf("phone")>-1)&&isNaN(a[c]))return"All phone and fax numbers must be correct!";if("email"==c&&!e.isValidEmail()||"contact_email"==c&&!e.isValidEmail())return"All emails must be valid!";"email_comments"==c||"subject"==c||"api_use"==c||"deletion_reason"==c||"file_urls"==c?a[c]=IS.helpers.stripHTML(d):"string"==typeof d&&(a[c]=$.trim(IS.helpers.stripHTML(d)))}},contactTable:{marketing:{topic:null,name:null,email:null,subject:null,email_comments:null,recaptcha_challenge_field:null,recaptcha_response_field:null},advertise:{contact_city:null,contact_company_name:null,contact_country:null,contact_email:null,contact_fax_1:null,contact_fax_2:null,contact_fax_3:null,contact_name:null,contact_phone_1:null,contact_phone_2:null,contact_phone_3:null,contact_state:null,contact_street_1:null,contact_street_2:null,contact_text:null,contact_zip:null},api:{api_type:null,first_name:null,last_name:null,email:null,website:null,service_type_website:null,service_type_blog:null,service_type_forum:null,service_type_mobile_app:null,service_type_desktop_app:null,service_type_other:null,api_category:null,api_use:null},customer_service:{topic:null,name:null,email:null,subject:null,email_comments:null,recaptcha_challenge_field:null,recaptcha_response_field:null},report:{topic:null,name:null,email:null,subject:null,file_urls:null,deletion_reason:null,recaptcha_challenge_field:null,recaptcha_response_field:null}}}),IS.Models.ImageEditor=Backbone.Model.extend({defaults:{exposure:0,brightness:0,contrast:0,sharpen:0,saturation:0,activeOption:null},persistentChanged:[],initialize:function(){this.on("change",this.setPersistantChange,this)},setNewValue:function(a){var b=this.get("activeOption");if(!b)throw"Must have an active option first";if(void 0==this.get(b))throw"Must have a valid active option";this.set(b,parseInt(a))},getActiveValue:function(){var a=this.get("activeOption");if(!a)throw"Must have an active option first";return this.get(a)},setPersistantChange:function(a){var b=_.keys(a.changedAttributes());_.each(b,function(a){this.persistentChanged.push(a)}.bind(this)),this.persistentChanged=_.uniq(this.persistentChanged)},attributeChanged:function(a){return-1!=_.indexOf(this.persistentChanged,a)}}),IS.Models.ImageStats=Backbone.Model.extend({url:function(){var a="/"+this.get("id")+"/stats/"+this.get("mode");return this.get("count")&&(a+="/"+this.get("count")),this.get("timestamp")&&(a+="?timestamp="+this.get("timestamp")),IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES+a},parse:function(a){return a.result}}),IS.Models.ImageTag=Backbone.Model.extend({}),IS.Models.Landing=Backbone.Model.extend({url:function(){var a=IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES+"/"+this.get("id");return this.nextPrevAlbum&&(a+="?next_prev_album=true"),a},defaults:{id:null,server:null,bucket:null,filename:null,original_filename:null,title:null,likes:0,liked:!1,tags:null,comments_limit:10,views:0,creation_date:null,width:null,height:null,next_images:null,prev_images:null,comments_disabled:!1,ad_html:"",is_owner:!1,moderated:!1,block_downloading:!1,username:function(){return this.owner?this.owner.username:""},owner_avatar_server:function(){return this.owner&&this.owner.avatar?this.owner.avatar.server:null},owner_avatar_filename:function(){return this.owner&&this.owner.avatar?this.owner.avatar.filename:null},ownerHasAvatar:function(){return!!(this.owner&&this.owner.avatar?this.owner.avatar.server:!1)},membership:function(){return this.owner.membership},currentUserHasAvatar:function(){return!(!IS.currentUser||!IS.currentUser.get("avatarServer"))},next_image_server:function(){return this.next_images&&this.next_images.length?this.next_images[0].server:null},next_image_filename:function(){return this.next_images&&this.next_images.length?this.next_images[0].filename:null},next_image_id:function(){return this.next_images&&this.next_images.length?this.next_images[0].id:null},has_next_image:function(){return!(!this.next_images||!this.next_images.length)},prev_image_server:function(){return this.prev_images&&this.prev_images.length?this.prev_images[0].server:null},prev_image_filename:function(){return this.prev_images&&this.prev_images.length?this.prev_images[0].filename:null},prev_image_id:function(){return this.prev_images&&this.prev_images.length?this.prev_images[0].id:null},has_prev_image:function(){return!(!this.prev_images||!this.prev_images.length)},datetime:function(){return IS.helpers.getDateTime(1e3*Number(this.creation_date))},date_string:function(){return IS.helpers.getDateString(1e3*Number(this.creation_date))},link:function(){return"https://imageshack.com"+IS.Models.Photo.landingURL(this.id)},direct_link:function(){return IS.inlineTemplates.direct({id:this.id,server:this.server,filename:this.filename,bucket:this.bucket})},externalLink:function(a){return IS.inlineTemplates[a]({id:this.id,server:this.server,filename:this.filename,bucket:this.bucket,width:150,height:100})},forum_link:function(){return this.externalLink("forum")},alt_link:function(){return this.externalLink("alt-forum")},html_link:function(){return this.externalLink("web")},ownerAvatarUrl:function(){return this.ownerHasAvatar()?IS.helpers.getAvatarLink(60,this.owner.avatar):IS.Models.User.getDefaultAvatar(120)},currentUserAvatarUrl:function(){if(this.currentUserHasAvatar()){var a=IS.currentUser.get("avatarCoords");return IS.helpers.getAvatarLink(50,{cropped:!_.isEmpty(a),server:IS.currentUser.get("avatarServer"),filename:IS.currentUser.get("avatarFilename"),x_pos:a.x_pos,y_pos:a.y_pos,x_length:a.x_length,y_length:a.y_length})}return IS.Models.User.getDefaultAvatar(50)},imageUrl:function(){return IS.helpers.getImagizerLink({server:this.server,filename:this.filename,width:this.width,height:this.height,quality:50})},hasLikes:function(){return!!this.likes},isPublic:function(){return!(!this["public"]&&!this.is_owner)}},initialize:function(a){_.extend(this,IS.Models.Mixins.Photo),this.nextPrevAlbum=!!a.nextPrevAlbum},parse:function(a){return a.result},prevImageURL:function(){var a=this.get("prev_images");return a&&a.length?IS.Models.Photo.landingURL(a[0].id):null},nextImageURL:function(){var a=this.get("next_images");return a&&a.length?IS.Models.Photo.landingURL(a[0].id):null}},{IMAGE_AREA_WIDTH:720}),IS.Models.LandingComment=Backbone.Model.extend({defaults:{id:null,creation_date:0,pretty_date:function(){return IS.helpers.getPrettyDate(1e3*Number(this.creation_date))},datetime:function(){return IS.helpers.getDateTime(1e3*Number(this.creation_date))},username:function(){return this.owner.username},server:"",filename:"",comment:"",comment_processed:function(){var a=IS.helpers.convertLinks(this.comment);return a=IS.helpers.convertUsernames(a),a.replace(/\n/gi,"<br>"),a},owner:null,is_owner:!1,hasAvatar:function(){return!(!this.owner.avatar||!this.owner.avatar.server)},avatarUrl:function(){return this.hasAvatar()?IS.helpers.getImagizerLink({server:this.owner.avatar.server,filename:this.owner.avatar.filename,width:50,height:50,cropped:!0}):IS.Models.User.getDefaultAvatar(50)}},url:function(){return IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES+"/"+this.get("server")+"/"+this.get("filename")+"/comments"},remove:function(){return this.destroy({url:IS.CONS.API_BASE+IS.CONS.APIS.COMMENTS.COMMENTS+"/"+this.get("id")+"?api_key="+IS.CONS.API_KEY+"&auth_token="+IS.currentUser.get("authToken")})}}),IS.Models.Mixins.Photo={friendlyTitle:function(a){a=_.extend({len:22,shorten:!0},a);var b=this.get("title");return b&&b.length?a.shorten?IS.helpers.shortenText(b,a.len):b:"Untitled"},friendlyAlbumTitle:function(a){a=_.extend({len:22,shorten:!0},a);var b=this.get("album").title;return b&&b.length?a.shorten?IS.helpers.shortenText(b,a.len):b:"Untitled"},isGif:function(){return IS.helpers.isGif(this.get("filename"))},like:function(a){a=a||function(){};var b=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES+"/"+this.get("server")+"/"+this.get("filename")+"/likes",type:"POST",data:{auth_token:IS.currentUser.get("authToken")}});return IS.et.ts("Photo Mixin","Like"),$.when(b).then(function(a){this.trigger("liked",a)}.bind(this)).fail(function(b){a(b.responseText?$.parseJSON(b.responseText):b)}).always(function(){IS.et.te("Photo Mixin","Like")}),b},unlike:function(a){a=a||function(){};var b=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES+"/"+this.get("server")+"/"+this.get("filename")+"/unlike",type:"POST",data:{auth_token:IS.currentUser.get("authToken")}});return IS.et.ts("Photo Mixin","Unlike"),$.when(b).then(function(a){this.trigger("unliked",a)}.bind(this)).fail(function(b){a(b.responseText?$.parseJSON(b.responseText):b)}).always(function(){IS.et.te("Photo Mixin","Unlike")}),b},incrementViewCount:function(a,b){a=a||function(){},b=b||function(){};var c=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES+"/"+this.get("server")+"/"+this.get("filename")+"/views",type:"POST",data:{api_key:IS.CONS.API_KEY}});return IS.et.ts("Photo Mixin","Increment View Count"),$.when(c).then(function(b){a(b)}).fail(function(a){b(a.responseText?$.parseJSON(a.responseText):a)}).always(function(){IS.et.te("Photo Mixin","Increment View Count")}),c},addTags:function(a,b){b=b||function(){};var c={auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY,tags:a},d=$.ajax({url:IS.CONS.API_BASE+"/images/"+this.id,type:"PATCH",data:c,dataType:"json"});return IS.et.ts("Photo Mixin","Add Tags"),$.when(d).always(function(a){IS.et.te("Photo Mixin","Add Tags"),b({success:a.success})}.bind(this)),d},removeTags:function(a,b){if(b=b||function(){},a&&a.length){var c={auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY,tags:a},d=$.ajax({url:IS.CONS.API_BASE+"/images/"+this.id+"/tags",type:"DELETE",data:c,dataType:"json"});return IS.et.ts("Photo Mixin","Remove Tags"),$.when(d).always(function(a){IS.et.te("Photo Mixin","Remove Tags"),b({success:a.success})}.bind(this)),d}},removeFromServer:function(){var a={ids:[this.get("id")],auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY},b=$.ajax({url:IS.CONS.API_BASE+"/images",type:"DELETE",data:a,dataType:"json"});return IS.et.ts("Photo Model","Delete Single"),$.when(b).always(function(a){this.trigger("removed_from_server",{success:a.success}),IS.et.te("Photo Model","Delete Single")}.bind(this)),b}},IS.Models.Photo=Backbone.Model.extend({urlRoot:IS.CONS.API_BASE+"/images",initialize:function(){_.extend(this,IS.Models.Mixins.Photo)},parse:function(a){return a&&a.result&&a.success?a.result:a},landingURL:function(){return IS.Models.Photo.landingURL(this.get("id"))},URLByProfile:function(a){return IS.Models.Photo.URLByProfile(this.get("server"),this.get("filename"),a)},imagizerURL:function(a){return a=_.extend(a,{server:this.get("server"),filename:this.get("filename")}),IS.helpers.getImagizerLink(a)},updateRotation:function(a,b){b=b||function(){},a=a||0;var c={id:this.get("id"),angle:a,auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY},d=$.ajax({url:IS.CONS.API_BASE+"/images/rotate",type:"POST",data:c,dataType:"json"});return IS.et.ts("Photo Model","Update Rotation"),$.when(d).always(function(a){IS.et.te("Photo Model","Update Rotation"),b({success:a.success})}.bind(this)),d}},{URLByProfile:function(a,b,c){return"/scaled/"+c+"/"+a+"/"+b},landingURL:function(a){return"/i/"+a},replacePhotoWith:function(a,b,c){c=c||function(){};var d={replace_id:a,file:b,auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY},e=$.ajax({url:IS.CONS.API_BASE+"/images",type:"POST",data:d,dataType:"json"});return IS.et.ts("Photo Model","Replace Photo With"),$.when(e).always(function(a){IS.et.te("Photo Model","Replace Photo With"),c({success:a.success})}),e},replacePhotoWithURL:function(a,b,c){c=c||function(){};var d={replace_id:a,url:b,auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY},e=$.ajax({url:IS.CONS.API_BASE+"/images",type:"POST",data:d,dataType:"json"});return IS.et.ts("Photo Model","Replace Photo With URL"),$.when(e).always(function(a){IS.et.te("Photo Model","Replace Photo With URL"),c({success:a.success})}),e},replacePhotoWithBlob:function(a,b,c,d){c=c||function(){};var e=new FormData;e.append("replace_id",a),e.append("auth_token",IS.currentUser.get("authToken")),e.append("api_key",IS.CONS.API_KEY),e.append("file",b);var f=$.ajax({url:IS.CONS.API_BASE+"/images",type:"POST",data:e,contentType:!1,processData:!1,dataType:"json"});return IS.et.ts("Photo Model","Replace Photo With URL"),$.when(f).always(function(a){IS.et.te("Photo Model","Replace Photo With URL"),c({success:a.success})}),f},freeLandingURL:function(a){return"/f/"+a},removeFromServer:function(a,b){b=b||function(){},_.isArray(a)||(a=[a]);var c={ids:a,auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY},d=$.ajax({url:IS.CONS.API_BASE+"/images",type:"DELETE",data:c,dataType:"json"});return IS.et.ts("Photo Model","Delete Multiple"),$.when(d).always(function(a){IS.et.te("Photo Model","Delete Multiple"),b({success:a.success})}),d},updatePrivacy:function(a,b,c){c=c||function(){},_.isArray(a)||(a=[a]);var d={ids:a,"public":b,auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY},e=$.ajax({url:IS.CONS.API_BASE+"/images",type:"PUT",data:d,dataType:"json"});return IS.et.ts("Photo Model","Update Multiple"),$.when(e).always(function(a){IS.et.te("Photo Model","Update Multiple"),c({success:a.success})}),e},addTags:function(a,b,c){c=c||function(){};var d={ids:a,tags:b,auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY},e=$.ajax({url:IS.CONS.API_BASE+"/images",type:"PATCH",data:d,dataType:"json"});return IS.et.ts("Photo Model","Add Tags"),$.when(e).always(function(a){IS.et.te("Photo Model","Add Tags"),c({success:a.success})}),e},removeTags:function(a,b,c){c=c||function(){};var d={ids:a,tags:b,auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY},e=$.ajax({url:IS.CONS.API_BASE+"/images",type:"DELETE",data:d,dataType:"json"});return IS.et.ts("Photo Model","Remove Tags"),$.when(e).always(function(a){IS.et.te("Photo Model","Remove Tags"),c({success:a.success})}),e},getExternalLink:function(a){return!IS.currentUser||IS.currentUser.get("freeAccount")?"http:"+IS.CONS.SITE_URL+this.freeLandingURL(a.id):"https:"+IS.CONS.SITE_URL+this.landingURL(a.id)}}),IS.Models.ProfileHeader=Backbone.Model.extend({defaults:{username:""},url:function(){return"/papi/profile_header?user="+this.get("username")},parse:function(a){return a.result}}),IS.Models.RandomPhoto=Backbone.Model.extend({defaults:{id:"",server:"",filename:""}}),IS.Models.SettingsProfile=Backbone.Model.extend({defaults:{id:null,avatar_server:null,avatar_filename:null,avatar:null,username:"",email:"",description:"",location:"",password:"",gender:null,sites:[],avatarUrl:function(){return IS.helpers.getAvatarLink(100,this.avatar)},getSocialSiteValue:function(a){for(var b="",c=0;c<this.sites.length;c++){var d=this.sites[c];if(d.site_name==a){b=d.profile_url;break}}return b},facebookURL:function(){return this.getSocialSiteValue("facebook")},instagramURL:function(){return this.getSocialSiteValue("instagram")},tumblrURL:function(){return this.getSocialSiteValue("tumblr")},twitterURL:function(){return this.getSocialSiteValue("twitter")}},url:IS.CONS.API_BASE+IS.CONS.APIS.USER.USER,validate:function(a){return!a.username||a.username.length<IS.CONS.MIN_USERNAME_LENGTH?IS.Views.Mixins.Auth.errorMessages.usernameLength:a.email&&a.email.isValidEmail()?a.password&&a.password.length&&a.password.length<IS.CONS.MIN_PASSWORD_LENGTH?IS.Views.Mixins.Auth.errorMessages.passwordLength:void 0:IS.Views.Mixins.Auth.errorMessages.invalidEmail},parse:function(a){return a=a.result||{},_.isEmpty(a)?a:{avatar_server:a.avatar.server,avatar_filename:a.avatar.filename,avatar:a.avatar,username:a.username,email:a.email,description:a.description,location:a.location,gender:a.gender,sites:IS.currentUser.get("socialSites")}}},{MAX_BIO_LENGTH:140,DEFAULT_AVATAR:"/v2_images/default_avatar_100x100.jpg"}),IS.Models.Settings=Backbone.Model.extend({url:IS.CONS.API_BASE+IS.CONS.APIS.USER.SETTINGS,defaults:{id:"",private_images:!1,private_albums:!1,private_profile:!1,private_files:!1,private_followings:!1,upload_notification:!1,comments_notification:!1,shares_notification:!1,likes_notification:!1,follows_notification:!1,new_feature_notification:!1,usage_tips:!1,special_offers:!1,weekly_update_notification:!1,daily_update_notification:!1,skypath_message:!1,skypath_share_file:!1,albums_first:!1,use_watermark:!1,start_page:0,isFeatured:function(){return IS.currentUser.get("isFeatured")},hasWatermark:function(){var a=IS.currentUser.get("watermark");return!(!a||!a.id)},watermarkURL:function(){var a=IS.currentUser.get("watermark");return IS.inlineTemplates.direct({server:a.server,filename:a.filename,bucket:a.bucket}).replace("http:","//")},watermarkEnabled:function(){return this.use_watermark},all_email_off:function(){return!this.usage_tips&&!this.new_feature_notification&&!this.special_offers}},parse:function(a){return a=a.result||{},delete a.onboarding,_.extend(a,{id:IS.currentUser.get("userId")})}},{START_PAGE:{MY_IMAGES:1,MY_ALBUMS:2,FOLLOWING:3}}),IS.Models.SettingsReferral=Backbone.Model.extend({url:IS.CONS.API_BASE+IS.CONS.APIS.USER.REFERRAL,parse:function(a){return a.result}}),IS.Models.SettingsSubscription=Backbone.Model.extend({defaults:{hasBusinessSub:function(){var a=!1;return _.each(this.subs,function(b){a=a||IS.helpers.isBusinessSubscription(b.subscription)}),a},contentHTML:function(){var a="";return _.each(this.subs,function(b){a+=new IS.Views.SettingsSubscriptionType({model:new IS.Models.SettingsSubscriptionType(b)}).render().el.outerHTML}),a}},url:IS.CONS.API_BASE+IS.CONS.APIS.USER.SUBSCRIPTIONS,parse:function(a){var b={subs:[]};return _.each(a.result,function(a){b.subs.push(a)}),b.subs.length||b.subs.push({max_filesize:5242880,subscription:"free",amount:0,creation_date:IS.currentUser.get("creationDate")}),b}}),IS.Models.SettingsSubscriptionType=Backbone.Model.extend({defaults:{isPremium:function(){return IS.helpers.isPremiumSubscription(this.subscription)},isBusiness:function(){return IS.helpers.isBusinessSubscription(this.subscription)},isSkypath:function(){return IS.helpers.isSkypathPromoSubscription(this.subscription)},isFree:function(){return IS.currentUser.get("freeAccount")},isTrial:function(){return IS.helpers.isTrialSubscription(this.subscription)},isStudent:function(){return IS.helpers.isStudentSubscription(this.subscription)},isLimitedAccount:function(){return this.isSkypath()||this.isFree()},joinDate:function(){return IS.helpers.getDateString(1e3*this.creation_date,!0)},totalSpace:function(){return IS.helpers.getPrettyFileSize(1024*this.space_limit)},hasPaymentInfo:function(){return"credit_card"==this.payment_method&&!!this.credit_card_info||this.isPayPalPayment()||this.isCABPayment()},paymentType:function(){return this.isPayPalPayment()?"PayPal":this.isCABPayment()?"ClickandBuy":this.credit_card_info.type?this.credit_card_info.type:"Credit Card"},cardNum:function(){return this.credit_card_info.last_four},maxFileSize:function(){return IS.helpers.getPrettyFileSize(this.max_filesize)},hasStatus:function(){return null!==this.active},isActive:function(){return 1===this.active},expDate:function(){return IS.helpers.getDateString(1e3*this.renewal_date,!0)},isPayPalPayment:function(){return"paypal"==this.payment_method},isCABPayment:function(){return"cab"==this.payment_method},is3rdPartyPayment:function(){return this.isPayPalPayment()||this.isCABPayment()},isCardPayment:function(){return!!this.credit_card_info},monthlyCost:function(){return this.renew_cycle?(this.amount/this.renew_cycle).toFixed(2):this.amount},isRecurring:function(){return!!this.renew_cycle},showUpgradeButton:function(){return this.isExpired()||this.isTrial()||this.isLimitedAccount()},tID:function(){return this.transaction_id},hasExpDate:function(){return!!this.renewal_date},isExpired:function(){return(new Date).getTime()>1e3*this.renewal_date},hasRenewalCycle:function(){return!this.isLimitedAccount()&&!!this.renew_cycle&&this.isActive()},renewalType:function(){var a="";switch(this.renew_cycle){case 1:a="Monthly";break;case 3:case 6:a=this.renew_cycle+" Months";break;case 12:a="Yearly";break;default:a="Nonrecurring"}return a},status:function(){return this.isGoodStatus()?this.isRecurring()?"Active":"Paid":this.isRecurring()?"Canceled":"Inactive"},hasLast4:function(){return!isNaN(this.cardNum())},isGoodStatus:function(){return this.hasExpDate()&&!this.isExpired()},isBasicSub:function(){return/subbasic\d+/i.test(this.subscription)},isProSub:function(){return/subpro\d+/i.test(this.subscription)},isPremiumSub:function(){return/subprem\d+/i.test(this.subscription)}}}),IS.Models.SystemMessage=Backbone.Model.extend({defaults:{id:null,date:null,message:null,messageType:null},hide:function(){var a=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.SYSTEM_MESSAGES.HIDE,type:"POST",data:{auth_token:IS.currentUser.get("authToken"),message_id:this.id}});return $.when(a).always(function(a){this.trigger("hid",{success:a.success})}),a}}),IS.Models.UploadCandid=Backbone.Model.extend({defaults:{size:0,filename:"",src:"/v2_images/transparent.png",progress:0,completed:!1,processing:!1,failed:!1,exceeds_size_limit:!1,loaded:0}}),IS.Models.UploadedMedia=Backbone.Model.extend({defaults:{id:"",server:0,filename:"",bucket:0,selected:!0,synced:!1}}),IS.Models.User=Backbone.Model.extend({url:IS.CONS.API_BASE+IS.CONS.APIS.USER.USER,defaults:{settings:{resize:"",linkType:"direct",linkSize:""}},systemMessages:null,initialize:function(){this.loadSettings()},loadSettings:function(){if(this.get("freeAccount"))this.set("settings",{resize:"",linkType:"web",
linkSize:"150x100"});else if(store.enabled){var a=store.get(IS.CONS.STORAGE.USER_SETTINGS);a&&this.set("settings",a)}},saveSettings:function(){store.enabled&&store.set(IS.CONS.STORAGE.USER_SETTINGS,this.get("settings"))},loadSystemMessages:function(){this.systemMessages=new IS.Collections.SystemMessages,this.systemMessages.fetch({success:function(){this.systemMessages.length&&IS.vent.trigger("app_layout:display_system_msg")}.bind(this)})},setSetting:function(a,b){return this.get("settings")[a]=b,this.saveSettings(),this},canUpload:function(){return this.get("hasPaidSubscription")||!this.get("freeAccount")},logAccountStatus:function(){var a="";this.get("hasPaidSubscription")?(optimizely.push(["addToSegment","subscribers"]),a="Paid"):this.get("isTrialExpired")?(optimizely.push(["addToSegment","free_trial_users_after_30_days"]),a="Expired"):(optimizely.push(["addToSegment","free_trial_users_under_30_days"]),a="Trial"),IS.et.pe("User","Subscription",a)}},{signup:function(a,b,c){b=b||function(){},c=c||function(){};var d=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.USER.USER,type:"POST",data:_.extend(a,{api_key:IS.CONS.API_KEY})});return IS.et.ts("User Model","Signup"),$.when(d).then(function(a){IS.et.pe("User","New Signup"),optimizely.push(["trackEvent","free_trial_signup"]),b(a)}).fail(function(a){c(a.responseText?$.parseJSON(a.responseText):a)}).always(function(){IS.et.te("User Model","Signup")}),d},update:function(a,b){b=b||function(){};var c=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.USER.USER,type:"PUT",data:_.extend(a,{api_key:IS.CONS.API_KEY})});return IS.et.ts("User Model","Update"),$.when(c).always(function(a){IS.et.te("User Model","Update"),b(a)}),c},forgot:function(a,b,c){b=b||function(){},c=c||function(){};var d=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.USER.FORGOT,type:"POST",data:_.extend(a,{api_key:IS.CONS.API_KEY})});return IS.et.ts("User Model","Forgot"),$.when(d).then(function(a){IS.et.te("User Model","Forgot"),b(a)}).fail(function(a){c(a.responseText?$.parseJSON(a.responseText):a)}).always(function(){IS.et.te("User Model","Forgot")}),d},login:function(a,b,c,d,e,f){d=d||function(){},void 0==c&&(c=!1);var g=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.USER.LOGIN,type:"POST",data:{api_key:IS.CONS.API_KEY,username:a,password:b,set_cookies:!0,remember_me:c}});return IS.et.ts("User Model","Login"),$.when(g).then(function(a){f?this.getAlbums({username:a.result.username,auth_token:a.result.auth_token,limit:100,image_limit:0,show_private:!0},function(b){a.result.albums=b.result.albums,d(a)}):d(a)}.bind(this)).fail(function(a){e(a.responseText?$.parseJSON(a.responseText):a)}).always(function(){IS.et.te("User Model","Login")}),g},resetPassword:function(a,b,c){b=b||function(){},c=c||function(){};var d=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.USER.PASSWORD_RESET,type:"POST",data:_.extend(a,{api_key:IS.CONS.API_KEY})});return IS.et.ts("User Model","Reset Password"),$.when(d).then(function(a){b(a)}).fail(function(a){c(a.responseText?$.parseJSON(a.responseText):a)}).always(function(){IS.et.te("User Model","Reset Password")}),d},facebookLogin:function(a,b,c,d,e,f,g,h,i,j){i=i||function(){};var k=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.USER.FACEBOOK_LOGIN,type:"POST",data:{api_key:IS.CONS.API_KEY,email:a,user_id:b,access_token:c,first_name:d,last_name:e,gender:f,username:g,set_cookies:h}});return IS.et.ts("User Model","Facebook Login"),$.when(k).always(function(a){IS.et.te("User Model","Facebook Login"),j?this.getAlbums({username:a.result.username,auth_token:a.result.auth_token,limit:100,image_limit:0,show_private:!0},function(b){a.result.albums=b.result.albums,i(a)}):i(a)}.bind(this)),k},getAlbums:function(a,b){b=b||function(){};var c=a.username;delete a.username;var d=$.ajax({url:IS.CONS.API_BASE+"/user/"+c+IS.CONS.APIS.ALBUMS.ALBUMS,type:"GET",data:_.extend(a,{api_key:IS.CONS.API_KEY})});return IS.et.ts("User Model","Get Albums"),$.when(d).always(function(a){IS.et.te("User Model","Get Albums"),b(a)}),d},getDefaultAvatar:function(a){return a=a||50,"/v2_images/default_avatar_"+a+"x"+a+".jpg"},checkPromoStatus:function(){return $.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.SUBSCRIPTIONS.PROMO,type:"GET",data:{auth_token:IS.currentUser.get("authToken")}})}}),IS.Models.UserTag=Backbone.Model.extend({defaults:{name:null,count:null},friendlyName:function(a){a=_.extend({len:10,shorten:!0},a);var b=this.get("name");return b&&b.length&&a.shorten?IS.helpers.shortenText(b,a.len):b},friendlyCount:function(){return this.get("count")>999?"1k+":this.get("count")},myTagUrl:function(){return"/my/tags/detail/"+encodeURIComponent(this.get("name"))+"/1"}}),IS.Collections.Activities=Backbone.CollectionPaginated.extend({model:IS.Models.Activity,url:function(){return this.createURL("/activities",{limit:this.limit,offset:this.offset()})},parse:function(a){return _.isUndefined(a.error)?(this.setTotalCount(a.result.total),a.result.activities):(IS.logger.error(a.error),null)}},{newCount:function(a){a=a||function(){};var b=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.ACTIVITIES.NEW_COUNT,type:"GET",data:{auth_token:IS.currentUser.get("authToken"),ts:(new Date).getTime()}});return IS.et.ts("Activities Collection","New Count"),$.when(b).always(function(b){IS.et.te("Activities Collection","New Count"),b.success||IS.logger.error("[Collections.Activities] Unable to get new count"),a(b)}.bind(this)),b},viewed:function(a){a=a||function(){};var b=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.ACTIVITIES.VIEWED,type:"POST",data:{auth_token:IS.currentUser.get("authToken")}});return IS.et.ts("Activities Collection","Viewed"),$.when(b).always(function(b){IS.et.te("Activities Collection","Viewed"),b.success||IS.logger.error("[Collections.Activities] Unable to mark as viewed"),a(b)}.bind(this)),b},registerUploads:function(a,b){b=b||function(){};var c=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.ACTIVITIES.ACTIVITIES,type:"POST",data:{auth_token:IS.currentUser.get("authToken"),image_id:a}});return IS.et.ts("Activities Collection","Register Uploads"),$.when(c).always(function(a){IS.et.te("Activities Collection","Register Uploads"),a.success||IS.logger.error("[Collections.Activities] Unable to register uploads"),b(a)}.bind(this)),c}}),IS.Collections.Discover=Backbone.Collection.extend({url:IS.CONS.API_BASE+"/discovers",initialize:function(a,b){b=b||{},this.skipParse=!!b.skip_parse},parse:function(a){if(this.skipParse)return a.result;for(var b={},c=0;c<a.result.length;c++){var d=a.result[c],e=d.category.toLowerCase().replace(/\s/g,"");d.images=_.shuffle(d.images),d.class_name=e;for(var f=0;f<d.images.length;f++)d.images[f].hero=0===f;b[e]=d}return b}}),IS.Collections.DiscoverCategory=Backbone.Collection.extend({model:IS.Models.Photo}),IS.Collections.Featured=Backbone.CollectionPaginated.extend({model:Backbone.Model,cacheKey:"featured",url:function(){return this.createURL("/features/users",{limit:this.limit,offset:this.offset(),image_limit:3})},parse:function(a){return a.result}}),IS.Collections.FollowingFollowers=Backbone.CollectionPaginated.extend({url:function(){var a=this.offset(),b={limit:this.limit};return a&&(b.offset=a),this.createURL("/user/"+this.username+"/"+(this.useFollowing?"followings":"followers"),b)},parse:function(a){return _.isUndefined(a.error)?a.result[this.useFollowing?"followings":"followers"]:(IS.logger.error(a.error),null)}}),IS.Collections.LandingComments=Backbone.Collection.extend({model:IS.Models.LandingComment,initialize:function(){this.limit=10,this.offset=null,this.server=0,this.filename=null},setProps:function(a){(a.offset||null===a.offset)&&(this.offset=a.offset),a.server&&(this.server=a.server),a.filename&&(this.filename=a.filename),a.limit&&(this.limit=a.limit)},url:function(){return IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES+"/"+this.server+"/"+this.filename+"/comments?order=asc&limit="+this.limit+(this.offset?"&offset="+this.offset:"")},parse:function(a){if(a.result&&a.result&&a.result.comments){var b=a.result.comments;return this.offset&&b.reverse(),this.offset=a.result.end_offset,b}return this.offset=null,[]}}),IS.Collections.MyAlbums=Backbone.CollectionPaginated.extend({model:IS.Models.Album,cacheKey:"my_albums",url:function(){var a=5;return _.isUndefined(this.options.image_limit)||(a=parseInt(this.options.image_limit)),this.createURL("/albums",{image_limit:a,limit:this.limit,offset:this.offset(),show_private:!0,hide_empty:!1})},parse:function(a){return this.setTotalCount(a.result.total),a.result.albums}}),IS.Collections.MyAlbumsDetail=Backbone.CollectionPaginated.extend({model:IS.Models.Photo,url:function(){return this.createURL("/albums/"+this.options.albumId,{limit:this.limit,offset:this.offset(),show_private:!0,sort:this.options.sort})},parse:function(a){return _.isUndefined(a.error)?(this.setTotalCount(a.result.total),a.result.images):(IS.logger.error("API error",a.error),null)}},{SORT_TYPES:{TITLE:"Title",FILENAME:"Filename",FILE_SIZE:"File Size",CREATION_DATE:"Date",MODIFICATION_DATE:"Modified",DEFAULT:null}}),IS.Collections.MyFollowings=Backbone.CollectionPaginated.extend({model:IS.Models.Photo,url:function(){var a=this.offset(),b={limit:this.limit};return a&&(b.offset=a),this.createURL("/user/"+IS.currentUser.get("username")+"/followings/images",b)},parse:function(a){return _.isUndefined(a.error)?a.result.images:(IS.logger.error(a.error),null)}}),IS.Collections.MyImages=Backbone.CollectionPaginated.extend({model:IS.Models.Photo,cacheKey:"my_images",url:function(){return this.createURL("/images",{limit:this.limit,offset:this.offset(),show_private:!0})},parse:function(a){return _.isUndefined(a.error)?(this.setTotalCount(a.result.total),a.result.images):(IS.logger.error(a.error),null)}}),IS.Collections.MyLiked=Backbone.CollectionPaginated.extend({model:IS.Models.Photo,url:function(){var a=this.offset();return a&&(this.options.offset=a),this.createURL("/user/"+IS.currentUser.get("username")+"/liked/images",this.options)},parse:function(a){return _.isUndefined(a.error)?a.result.images:(IS.logger.error(a.error),null)}}),IS.Collections.MyPrivateAlbums=Backbone.CollectionPaginated.extend({model:IS.Models.Album,url:function(){var a=5;return _.isUndefined(this.options.image_limit)||(a=parseInt(this.options.image_limit)),this.createURL("/albums",{image_limit:a,limit:this.limit,offset:this.offset(),show_only_private:!0,hide_empty:!1})},parse:function(a){return this.setTotalCount(a.result.total),a.result.albums}}),IS.Collections.MyPrivateImages=Backbone.CollectionPaginated.extend({model:IS.Models.Photo,url:function(){return this.createURL("/images",{limit:this.limit,offset:this.offset(),show_only_private:!0})},parse:function(a){return _.isUndefined(a.error)?(this.setTotalCount(a.result.total),a.result.images):(IS.logger.error(a.error),null)}}),IS.Collections.MyTags=Backbone.CollectionPaginated.extend({model:IS.Models.Photo,cacheKey:"my_tags",url:function(){var a=this.options.tag.replace(/[^a-z0-9 \.,_-]/gim,"").trim();return this.createURL("/user/tags/"+a,{limit:this.limit,offset:this.offset()})},parse:function(a){return _.isUndefined(a.error)?(this.setTotalCount(a.result.total),a.result.images):(IS.logger.error(a.error),null)}}),IS.Collections.ProfileAlbums=Backbone.CollectionPaginated.extend({model:IS.Models.Album,url:function(){return this.createURL("/albums",{image_limit:5,limit:this.limit,offset:this.offset(),username:this.options.username,hide_empty:!0})},parse:function(a){return this.setTotalCount(a.result.total),a.result.albums}}),IS.Collections.ProfileAlbumsImages=Backbone.CollectionPaginated.extend({model:IS.Models.Photo,url:function(){return this.createURL("/albums/"+this.options.albumId,{limit:this.limit,offset:this.offset(),hide_empty:!0,show_private:!1})},parse:function(a){return _.isUndefined(a.error)?(this.setTotalCount(a.result.total),a.result.images):(IS.logger.error(a.error),null)}}),IS.Collections.ProfileImages=Backbone.CollectionPaginated.extend({model:IS.Models.Photo,url:function(){return this.createURL("/images",{username:this.options.username,limit:this.limit,offset:this.offset(),hide_empty:!0})},parse:function(a){return _.isUndefined(a.error)?(this.setTotalCount(a.result.total),a.result.images):(IS.logger.error(a.error),null)}}),IS.Collections.ProfileLiked=Backbone.CollectionPaginated.extend({model:IS.Models.Photo,url:function(){var a=this.offset();return a&&(this.options.offset=a),this.createURL("/user/"+this.options.username+"/liked/images",this.options)},parse:function(a){return _.isUndefined(a.error)?a.result.images:(IS.logger.error(a.error),null)}}),IS.Collections.RandomPhotos=Backbone.Collection.extend({model:IS.Models.RandomPhoto}),IS.Collections.Search=Backbone.CollectionPaginated.extend({model:IS.Models.Photo,url:function(){var a;return a="1"===this.options.global?"/search/"+this.options.query:"/search/"+this.options.query,this.createURL(a,{limit:this.limit,offset:this.offset()})},parse:function(a){return _.isUndefined(a.error)?(this.setTotalCount(a.result.total),a.result.images):(IS.logger.error(a.error),null)}}),IS.Collections.SelectedPhotos=Backbone.Collection.extend({model:IS.Models.Photo}),IS.Collections.SystemMessages=Backbone.CollectionPaginated.extend({model:IS.Models.SystemMessage,url:function(){return this.createURL("/system_messages",{})},parse:function(a){return this.setTotalCount(a.result.total),a.result.albums}}),IS.Collections.TimelineWidget=Backbone.Collection.extend({cacheKey:"timeline_widget",initialize:function(){this.limit=20,this.offset=0,this.username=null,this.fetching=!1,this.reachedEnd=!1,this.on({request:this.requesting,sync:this.synced},this)},setProp:function(a){return _.extend(this,a),this},url:function(){return IS.CONS.API_BASE+"/user/"+this.username+"/images?limit="+this.limit+"&offset="+this.offset},parse:function(a){var b=a&&a.result?a.result.images:[];return this.offset+=b.length,this.reachedEnd=b.length<this.limit,this.trigger("parsed",b),b},isFetching:function(){return this.fetching},requesting:function(){this.fetching=!0},synced:function(){this.fetching=!1},hasReachedEnd:function(){return this.reachedEnd}}),IS.Collections.UploadedMedias=Backbone.Collection.extend({model:IS.Models.UploadedMedia}),IS.Collections.UserTags=Backbone.CollectionPaginated.extend({model:IS.Models.UserTag,cacheKey:"user_tags",url:function(){return this.createURL("/user/tags",{limit:this.limit,offset:this.offset(),image_limit:this.options.imageLimit||0})},parse:function(a){return _.isUndefined(a.error)?(this.setTotalCount(a.result.total),_.map(a.result.tags,function(a,b){return{name:b,count:a.total,images:a.images}})):(IS.logger.error(a.error),null)}}),IS.Routers.Main=Backbone.Router.extend({routes:{"my/images":"myImages","my/images/:page":"myImages","my/albums":"myAlbums","my/albums/:page":"myAlbums","my/tags":"myTags","my/tags/:page":"myTags","my/tags/detail/:id":"myTagsDetail","my/tags/detail/:id/:page":"myTagsDetail","my/settings(/:subsection)":"mySettings","my/following":"myFollowing","my/liked":"myLiked","user/:username":"profileImages","user/:username/a":"profileAlbums","user/:username/liked":"profileLiked","user/:username/following":"following","user/:username/followers":"followers",discover:"discover",featured:"featured","i/:id":"landing","i/:id/edit":"imageEdit","a/:id":"albumsDetail","a/:id/:page":"albumsDetail","search/:query/:page/*params":"search"},initialize:function(a){a=a||{},_.extend(this,IS.Routers.Mixins.Base),this.bootstrapped=a.bootstrapped||{},this.layoutView=new IS.Views.AppLayout,this.setupLogger(),this.setupVentNavigate()},before:function(){this.pushHistoryFragment(),IS.currentUser&&IS.currentUser.set("activeAlbum",null),$("#image-overlay.stand-alone").length?IS.vent.trigger("app_layout:destroy:overlay"):(this.removeCurrentViews(),this.removeLoadingXhrs(),this.hidePagination())},after:function(){this.bootstrapped={},this.isFirstRoute=!1,IS.currentUser&&0===parseInt(IS.currentUser.get("startPage"))&&this.showStartPageTip()},hidePagination:function(){this.layoutView&&this.layoutView.hidePagination()},calcPhotoFetchCount:function(){var a=store.get(IS.CONS.STORAGE.GRID_STYLE);if(a!=IS.Views.GridPhoto.STYLE.MINI)return IS.CONS.PHOTO_FETCH_COUNT;var b=$(window),c=b.width(),d=b.height(),e=Math.ceil(d/IS.Views.GridPhoto.DIMENSIONS.MINI.HEIGHT),f=Math.ceil(c/IS.Views.GridPhoto.DIMENSIONS.MINI.WIDTH);return Math.ceil(e*f/2)},showStartPageTip:function(){if(IS.currentUser&&IS.currentUser.get("creationDate").length){var a=1412201810;if(!(IS.currentUser.get("creationDate")>a)){var b=new IS.Models.Settings,c="Your current login view is now set to following. Would you like to update it to my images or albums?";this.layoutView.showTip({title:"TIP",msg:c,buttonText:"UPDATE HERE",closeCallback:function(){b.save({start_page:IS.Models.Settings.START_PAGE.FOLLOWING})},buttonClickedCallback:function(){b.save({start_page:IS.Models.Settings.START_PAGE.FOLLOWING},{success:function(){Backbone.history.navigate("my/settings/privacy",!0),this.layoutView.hideTip()}.bind(this)})}.bind(this)})}}},myImages:function(a){IS.et.pe("Page","Load","/my/images");var b=this;a||(a=1),IS.helpers.setPageTitle(IS.Views.MyImages.TITLE),this.layoutView.hideAllSideNavs().enableEditWidget(),IS.et.pp("/my/images"),this.layoutView.emptyContent().hidePagination().setNavBarItem(IS.Views.MyImages.CLASS);var c=new IS.Collections.MyImages(null,{limit:this.calcPhotoFetchCount(),page:a});c.once("fetch:started",function(){IS.vent.trigger("app_layout:content:loading")}),c.once("fetch:success",function(){var d=new IS.Views.HeaderUpgradeBanner,e=new IS.Views.HeaderManage({model:new Backbone.Model({title:"ALL IMAGES",count:c.totalCount,showControls:!0,sizesEnabled:!0})}),f=new IS.Views.MyImages({collection:c,currentPage:a});b.currentViews.push(d,e,f),b.layoutView.setPaginationOptions({currentPage:a,totalCount:f.collection.totalCount,perPage:f.collection.limit,url:"/my/images/"}),b.layoutView.showPagination(),b.layoutView.insertContent(d.render().el).insertContent(e.render().el).insertContent(f.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results" />')),d.show(),e.show(),f.setupElements()});var d=c.fetch({cache:!0,expires:IS.cm.TIMES.DAY});this.loadingXhrs.push(d)},myAlbums:function(a){IS.et.pe("Page","Load","/my/albums");var b=this;a||(a=1),IS.helpers.setPageTitle(IS.Views.MyAlbums.TITLE),this.layoutView.hideAllSideNavs(),IS.vent.trigger("app_layout:navbar:deactivate_album_links"),IS.et.pp("/my/albums"),this.layoutView.emptyContent().hidePagination().setNavBarItem(IS.Views.MyAlbums.CLASS);var c=new IS.Collections.MyAlbums(null,{limit:IS.CONS.ALBUM_FETCH_COUNT,page:a});c.once("fetch:started",function(){IS.vent.trigger("app_layout:content:loading")}),c.once("fetch:success",function(){var d=new IS.Views.HeaderUpgradeBanner({windowPadding:0}),e=new IS.Views.HeaderManage({model:new Backbone.Model({title:IS.currentUser&&IS.currentUser.get("isFeatured")?"GALLERIES":"ALBUMS",count:c.totalCount}),windowPadding:0}),f=new IS.Views.MyAlbums({collection:c,currentPage:a});b.currentViews.push(e,d,f),b.layoutView.setPaginationOptions({currentPage:a,totalCount:f.collection.totalCount,perPage:f.collection.limit,url:"/my/albums/"}),b.layoutView.showPagination(),b.layoutView.insertContent(d.render().el).insertContent(e.render().el).insertContent(f.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results albums" />')),d.show(),e.show(),f.setupElements()});var d=c.fetch({cache:!0,expires:IS.cm.TIMES.DAY});this.loadingXhrs.push(d)},myAlbumsDetail:function(a,b,c){IS.et.pe("Page","Load","/a");var d=this;c||(c=1),this.layoutView.hideAllSideNavs().enableEditWidget(),IS.vent.trigger("grid_items:edit_widget:hide_privacy_icon"),IS.vent.trigger("app_layout:navbar:activate_album_link",{id:a});var e=new IS.Collections.MyAlbumsDetail(null,{albumId:a,limit:this.calcPhotoFetchCount(),page:c,sort:store.get(IS.CONS.STORAGE.ALBUM_SORT_TYPE)}).once("fetch:started",function(){IS.vent.trigger("app_layout:content:loading")}).once("fetch:success",function(){d.layoutView.emptyContent().hidePagination().setNavBarItem(IS.Views.MyAlbumsDetail.CLASS);var f=new IS.Views.HeaderAlbumDetail({model:b,ownerMode:!0,sizesEnabled:!0}),g=new IS.Views.MyAlbumsDetail({collection:e,model:b,currentPage:c});d.currentViews.push(f,g),d.layoutView.insertContent(f.render().el).insertContent(g.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results" />')),_.defer(function(){f.show()}),g.setupElements(),d.layoutView.setPaginationOptions({currentPage:c,totalCount:g.collection.totalCount,perPage:g.collection.limit,url:"/a/"+a+"/"}),d.layoutView.showPagination()}),f=e.fetch();this.loadingXhrs.push(f)},myTags:function(a){IS.et.pe("Page","Load","/my/tags");var b=this;a||(a=1),IS.helpers.setPageTitle(IS.Views.MyTags.TITLE),this.layoutView.hideAllSideNavs(),IS.et.pp("/my/tags"),IS.vent.trigger("app_layout:navbar:deactivate_tag_links"),this.layoutView.emptyContent().hidePagination().setNavBarItem(IS.Views.MyTags.CLASS);var c=new IS.Collections.UserTags(null,{limit:16,page:a,imageLimit:3});c.once("fetch:started",function(){IS.vent.trigger("app_layout:content:loading")}),c.once("fetch:success",function(){IS.vent.trigger("app_layout:content:loaded");var d=new IS.Views.HeaderUpgradeBanner({windowPadding:0}),e=new IS.Views.HeaderManage({model:new Backbone.Model({title:'<span class="tag">ALL TAGS</span> ',count:c.totalCount}),windowPadding:0}),f=new IS.Views.MyTags({collection:c,currentPage:a});b.currentViews.push(e,d,f),b.layoutView.setPaginationOptions({currentPage:a,totalCount:f.collection.totalCount,perPage:f.collection.limit,url:"/my/tags/"}),b.layoutView.showPagination(),b.layoutView.insertContent(d.render().el).insertContent(e.render().el).insertContent(f.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results" />')),d.show(),e.show(),f.show(),f.setupElements()});var d=c.fetch({cache:!0,expires:IS.cm.TIMES.DAY});this.loadingXhrs.push(d)},myTagsDetail:function(a,b){a=a.replace(/[^a-z0-9 \.,_-]/gim,"").trim(),IS.et.pe("Page","Load","/my/tags/detail");var c=this;b||(b=1),IS.helpers.setPageTitle(IS.Views.MyTagsDetail.TITLE),this.layoutView.hideAllSideNavs().enableEditWidget(),IS.vent.trigger("app_layout:navbar:activate_tag_link",{id:a}),IS.et.pp("/my/tags"),this.layoutView.emptyContent().hidePagination().setNavBarItem(IS.Views.MyTagsDetail.CLASS);var d=new IS.Collections.MyTags(null,{limit:this.calcPhotoFetchCount(),page:b,tag:a});d.once("fetch:started",function(){IS.vent.trigger("app_layout:content:loading")}),d.once("fetch:success",function(){var e=new IS.Views.HeaderManage({model:new Backbone.Model({title:'<span class="tag">TAG:</span> '+a,count:d.totalCount,showControls:!0,sizesEnabled:!0})}),f=new IS.Views.MyTagsDetail({collection:d,currentPage:b});c.currentViews.push(e,f),c.layoutView.setPaginationOptions({currentPage:b,totalCount:f.collection.totalCount,perPage:f.collection.limit,url:"/my/tags/detail/"+a+"/"}),c.layoutView.showPagination(),c.layoutView.insertContent(e.render().el).insertContent(f.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results" />')),e.show(),f.setupElements()});var e=d.fetch();this.loadingXhrs.push(e)},mySettings:function(a){IS.et.pe("Page","Load","/my/settings");var b,c,d=this;if((!a||_.indexOf(["privacy","notifications","subscription","referral"],a)<0)&&(a="profile"),IS.helpers.setPageTitle(IS.Views.Settings.TITLE),IS.vent.trigger("app_layout:navbar:reset_nav_state"),this.layoutView.hideAllSideNavs(),_.isEmpty(this.bootstrapped)){IS.et.pp("/my/settings"+("profile"==a?"":"/"+a)),b=_.find(this.currentViews,function(a){return a instanceof IS.Views.Settings}),this.layoutView.setNavBarItem(null),b?b.trigger("transition:start",{view:a}):this.layoutView.emptyContent().hidePagination(),c=new IS.Models[IS.Views.Settings.MODELS[a]]({id:IS.currentUser.get("userId")}),c.once("request",function(){IS.vent.trigger("app_layout:content:loading")}),c.once("sync",function(){IS.vent.trigger("app_layout:content:loaded"),b?(b.setProps({model:c,sub:a}),b.trigger("transition:end")):(b=new IS.Views.Settings({model:c,sub:a}),d.currentViews.push(b),d.layoutView.insertContent(b.render().el),b.doPostRenderTasks().show())});var e=c.fetch();this.loadingXhrs.push(e)}else c=new IS.Models[IS.Views.Settings.MODELS[a]]($.parseJSON(this.bootstrapped.settings)),b=new IS.Views.Settings({el:"#settings",model:c,bootstrapped:!0,sub:a}),IS.vent.trigger("app_layout:content:loaded"),this.currentViews.push(b),b.show()},handleProfileImagesAlbums:function(a,b){IS.et.pe("Page","Load","/user/"+(b?"images":"albums"));var c,d,e,f=this;if(IS.helpers.setPageTitle(a+"'s "+(b?"Images":"Albums")),this.layoutView.hideAllSideNavs(),IS.vent.trigger("app_layout:navbar:reset_nav_state"),_.isEmpty(this.bootstrapped)){IS.et.pp("/user/"+a+(b?"":"/a")),c=_.find(this.currentViews,function(a){return a instanceof IS.Views.HeaderProfile}),d=_.find(this.currentViews,function(a){return a instanceof IS.Views.UserProfileBanner});var g=!(!c||!d);g?(c.setCurrentPage(b?"images":"albums"),this.layoutView.emptyProfileContent()):this.layoutView.emptyContent().hidePagination(),IS.currentUser&&a==IS.currentUser.get("username")&&this.layoutView.setNavBarItem(IS.Views.UserProfileImages.CLASS);var h={col:!1,model:g};h.model||(e=new IS.Models.ProfileHeader({username:a}).once("sync",function(){h.model=!0,h.col&&j()}.bind(this)).once("error",function(){IS.logger.error("Unable to sync profile header model",arguments)}));var i=new IS.Collections[b?"ProfileImages":"ProfileAlbums"](null,{limit:b?this.calcPhotoFetchCount():IS.CONS.ALBUM_FETCH_COUNT,page:0,username:a}).once("fetch:started",function(){g&&IS.vent.trigger("app_layout:content:loader:add:class",{className:"profile-shift"}),IS.vent.trigger("app_layout:content:loading")}).once("fetch:success",function(){h.col=!0,h.model&&j()}),j=function(){IS.vent.trigger("app_layout:content:loaded"),g?IS.vent.trigger("app_layout:content:loader:remove:class",{className:"profile-shift"}):(c=new IS.Views.HeaderProfile({model:e}),f.layoutView.insertContent(c.render().el));var h=new IS.Views[b?"UserProfileImages":"UserProfileAlbums"]({collection:i,headerModel:c.model,username:a});f.layoutView.insertContent(h.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results" />')),g||(d=new IS.Views.UserProfileBanner({photos:e.get("banner_images")}),c.$el.find(".inner").prepend(d.el),c.setCurrentPage(b?"images":"albums")),h.setupElements().setupLaceGrid({selector:b?".grid-photo":".grid-album",lazyLoaded:b}).setupInfiniteScroll(),f.currentViews.push(h),g||f.currentViews.push(c,d)};if(!g){var k=e.fetch();this.loadingXhrs.push(k)}var l=i.fetch();this.loadingXhrs.push(l)}else{this.bootstrapped.isOwnPage&&this.layoutView.setNavBarItem(IS.Views.UserProfileImages.CLASS);var m={el:$(".grid-container"),username:f.bootstrapped.username};b?_.extend(m,{photos:f.bootstrapped.photos,photosTotal:f.bootstrapped.photosTotal}):_.extend(m,{albums:f.bootstrapped.albums,albumsTotal:f.bootstrapped.albumsTotal}),c=new IS.Views.HeaderProfile({el:$("header.user-profile"),model:new IS.Models.ProfileHeader({profile_user:{username:a,is_followed:this.bootstrapped.isFollowed}})}),d=new IS.Views.UserProfileBanner({photos:f.bootstrapped.bannerPhotos}),m.headerModel=c.model;var n=new IS.Views[b?"UserProfileImages":"UserProfileAlbums"](m);$("header.user-profile .inner").prepend(d.el),f.currentViews.push(n,c,d)}},profileImages:function(a){var b=_.find(this.currentViews,function(a){return a instanceof IS.Views.UserProfileImages});b||this.handleProfileImagesAlbums(a,!0)},profileAlbums:function(a){this.handleProfileImagesAlbums(a,!1)},profileLiked:function(a){var b=_.find(this.currentViews,function(a){return a instanceof IS.Views.UserProfileLiked});if(!b){IS.et.pp("/user/"+a+"/l");var c=_.find(this.currentViews,function(a){return a instanceof IS.Views.HeaderProfile}),d=_.find(this.currentViews,function(a){return a instanceof IS.Views.UserProfileBanner}),e=!(!c||!d);e?(c.setCurrentPage("liked"),this.layoutView.emptyProfileContent()):this.layoutView.emptyContent().hidePagination(),IS.currentUser&&a==IS.currentUser.get("username")&&this.layoutView.setNavBarItem(IS.Views.UserProfileImages.CLASS);var f={col:!1,model:e};f.model||(headerModel=new IS.Models.ProfileHeader({username:a}).once("sync",function(){f.model=!0,f.col&&h()}.bind(this)).once("error",function(){IS.logger.error("Unable to sync profile header model",arguments)}));var g=new IS.Collections.ProfileLiked(null,{limit:this.calcPhotoFetchCount(),page:0,username:a,useEndOffset:!0}).once("fetch:started",function(){e&&IS.vent.trigger("app_layout:content:loader:add:class",{className:"profile-shift"}),IS.vent.trigger("app_layout:content:loading")}).once("fetch:success",function(){f.col=!0,f.model&&h()}),h=function(){IS.vent.trigger("app_layout:content:loaded"),e?IS.vent.trigger("app_layout:content:loader:remove:class",{className:"profile-shift"}):(c=new IS.Views.HeaderProfile({model:headerModel}),this.layoutView.insertContent(c.render().el));var b=new IS.Views.UserProfileLiked({collection:g,headerModel:c.model,username:a});this.layoutView.insertContent(b.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results" />')),e||(d=new IS.Views.UserProfileBanner({photos:headerModel.get("banner_images")}),c.$el.find(".inner").prepend(d.el),c.setCurrentPage("liked")),b.setupElements().setupLaceGrid({selector:".grid-photo",lazyLoaded:!0}).setupInfiniteScroll(),this.currentViews.push(b),e||this.currentViews.push(c,d)}.bind(this);if(!e){var i=headerModel.fetch();this.loadingXhrs.push(i)}var j=g.fetch();this.loadingXhrs.push(j)}},albumsDetail:function(a,b){var c=_.find(this.currentViews,function(a){return a instanceof IS.Views.UserProfileAlbumsDetail||a instanceof IS.Views.MyAlbumsDetail});if(!c){var d=this;IS.vent.trigger("app_layout:content:loading"),this.layoutView.emptyContent().hidePagination(),IS.et.pp("/a/"+a);var e=new IS.Models.Album({id:a}).once("sync",function(){var c=this.get("title");c||(c=this.get("owner").username+"'s Album"),IS.helpers.setPageTitle(c),this.get("is_owner")?d.myAlbumsDetail(a,this,b):d.profileAlbumsDetail(a,this)}).once("error",function(b,c){var e=$.parseJSON(c.responseText);e.error&&5==e.error.error_code?b.get("is_owner")||d.profileAlbumsDetail(a,this):IS.logger.error("Unable to sync album header detail model",arguments)});this.loadingXhrs.push(e.fetch({data:{image_limit:0}}))}},profileAlbumsDetail:function(a,b){IS.et.pe("Page","Load","/a");var c=this;this.layoutView.hideAllSideNavs(),IS.vent.trigger("app_layout:navbar:reset_nav_state");var d=new IS.Collections.ProfileAlbumsImages(null,{limit:this.calcPhotoFetchCount(),page:0,albumId:a}).once("sync",function(){var a=new IS.Views.HeaderAlbumDetail({model:b}),e=new IS.Views.UserProfileAlbumsDetail({collection:d});c.currentViews.push(a,e),c.layoutView.insertContent(a.render().el).insertContent(e.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results" />')),_.defer(function(){a.show()}),e.setupElements(),e.setupLaceGrid({selector:".grid-photo",lazyLoaded:!0}).setupInfiniteScroll()}).once("error",function(a,d){var e=$.parseJSON(d.responseText);if(e.error&&5==e.error.error_code){var f=new IS.Views.UserProfileAlbumsPassDialog({model:b});c.layoutView.insertContent(f.render().el),IS.vent.trigger("app_layout:content:loaded")}}),e=d.fetch();this.loadingXhrs.push(e)},discover:function(){IS.et.pe("Page","Load","/discover");var a=this;if(IS.helpers.setPageTitle(IS.Views.Discover.TITLE),this.layoutView.hideAllSideNavs(),_.isEmpty(this.bootstrapped)){IS.et.pp("/discover"),this.layoutView.setNavBarItem(IS.Views.Discover.CLASS).emptyContent().hidePagination();var b=new IS.Collections.Discover;b.once("request",function(){IS.vent.trigger("app_layout:content:loading")}),b.once("sync",function(){IS.vent.trigger("app_layout:content:loaded");var c=new IS.Views.Discover({
photos:b.models[0].attributes});a.currentViews.push(c),a.layoutView.insertContent(c.render().el)});var c=b.fetch({cache:!0,expires:IS.cm.TIMES.SIX_HOURS});this.loadingXhrs.push(c)}else{var d=new IS.Views.Discover({el:"#discover",photos:this.bootstrapped.photos,adMode:this.bootstrapped.adMode});IS.vent.trigger("app_layout:content:loaded"),this.currentViews.push(d)}},featured:function(){IS.et.pe("Page","Load","/featured");var a;IS.helpers.setPageTitle(IS.Views.Featured.TITLE),this.layoutView.hideAllSideNavs().setNavBarItem(IS.Views.Featured.CLASS).emptyContent().hidePagination(),IS.et.pp("/featured");var b=new IS.Collections.Featured(null,{limit:100});b.once("request",function(){IS.vent.trigger("app_layout:content:loading")}),b.once("sync",function(c){IS.vent.trigger("app_layout:content:loaded"),a=new IS.Views.HeaderManage({model:new Backbone.Model({title:"FEATURED PHOTOGRAPHERS"}),windowPadding:0,maxWidth:1060});var d=new IS.Views.Featured({collection:b});this.currentViews.push(a,d),this.layoutView.insertContent(a.render().el).insertContent(d.render().el),a.show(),d.show()}.bind(this),this);var c=b.fetch({cache:!0,expires:IS.cm.TIMES.SIX_HOURS});this.loadingXhrs.push(c)},landing:function(a){IS.et.pe("Page","Load","/landingpage"),IS.et.pp("/landingpage");var b,c=this;if(this.layoutView.hideAllSideNavs(),IS.vent.trigger("app_layout:navbar:reset_nav_state"),_.isEmpty(this.bootstrapped)){if(b=_.find(this.currentViews,function(a){return a instanceof IS.Views.Landing})){b.trigger("transition:start");var d=b.getPreloadedModel(a);if(d)return b.trigger("transition:end"),void b.setModel(d)}else this.layoutView.emptyContent().hidePagination();var e=new IS.Models.Landing({id:a});b||e.once("request",function(){IS.vent.trigger("app_layout:content:loading")}),e.once("sync",function(){b?(b.trigger("transition:end"),b.setModel(e)):(b=new IS.Views.Landing({model:e}),c.currentViews.push(b),c.layoutView.insertContent(b.render().el),b.show())});var f=e.fetch({error:function(a,b){var d="";try{var e=$.parseJSON(b.responseText);d=e&&e.error&&6==e.error.error_code?IS.Views.Mixins.Messages.deletedPhoto:IS.Views.Mixins.Messages.unavailablePhoto}catch(f){d=IS.Views.Mixins.Messages.unavailablePhoto}c.layoutView.insertContent('<div id="unavailable-lp">'+d+"</div>")}});this.loadingXhrs.push(f)}else{if(!this.bootstrapped.available)return void(this.bootstrapped={});b=new IS.Views.Landing({el:$("#landing"),model:new IS.Models.Landing($.parseJSON(this.bootstrapped.photo)),comments:this.bootstrapped.comments,offset:this.bootstrapped.offset,comments_total:this.bootstrapped.comments_total,bootstrapped:!0}),this.currentViews.push(b),b.show()}},search:function(a,b){IS.et.pe("Page","Load","/search");var c=this;b||(b=1);var d=IS.helpers.getParameterByName("g");a?IS.helpers.setPageTitle("Search - "+a):IS.helpers.setPageTitle("Search"),this.layoutView.hideAllSideNavs(),IS.vent.trigger("app_layout:navbar:reset_nav_state"),IS.et.pp("/search"),this.layoutView.emptyContent().hidePagination();var e=new IS.Collections.Search(null,{limit:this.calcPhotoFetchCount(),page:b,query:a,global:d});e.once("fetch:started",function(){IS.vent.trigger("app_layout:content:loading")}),e.once("fetch:success",function(){var f=new IS.Views.HeaderManage({model:new Backbone.Model({title:"SEARCH",count:e.totalCount,showControls:!0,sizesEnabled:!0}),windowPadding:0}),g=new IS.Views.Search({collection:e,currentPage:b,query:a});c.currentViews.push(f,g),c.layoutView.setPaginationOptions({currentPage:b,totalCount:g.collection.totalCount,perPage:g.collection.limit,url:"/search/"+a+"/",urlParams:{g:d}}),c.layoutView.showPagination(),c.layoutView.insertContent(f.render().el).insertContent(g.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results" />')),f.show(),g.setupElements()});var f=e.fetch();this.loadingXhrs.push(f)},myFollowing:function(){var a=_.find(this.currentViews,function(a){return a instanceof IS.Views.MyFollowings});if(!a){IS.et.pe("Page","Load","/my/following");var b=this;this.layoutView.hideAllSideNavs(),IS.helpers.setPageTitle(IS.Views.MyFollowings.TITLE),IS.et.pp("/my/following"),this.layoutView.emptyContent().hidePagination().setNavBarItem(IS.Views.MyFollowings.CLASS);var c=new IS.Collections.MyFollowings(null,{limit:this.calcPhotoFetchCount(),useEndOffset:!0});c.once("request",function(){IS.vent.trigger("app_layout:content:loading")}),c.once("sync",function(a,d){var e=new IS.Views.HeaderUpgradeBanner,f=new IS.Views.HeaderManage({model:new Backbone.Model({title:"FOLLOWING",showControls:!0,sizesEnabled:!0}),windowPadding:0}),g=new IS.Views.MyFollowings({collection:c,endOffset:d.result.end_offset});b.currentViews.push(e,f,g),b.layoutView.insertContent(e.render().el).insertContent(f.render().el).insertContent(g.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results" />')),e.show(),f.show(),g.setupElements(),c.length||g.showUserNoFollowingResults(),d.result.end_offset&&g.setupInfiniteScroll()});var d=c.fetch();this.loadingXhrs.push(d)}},myLiked:function(){var a=_.find(this.currentViews,function(a){return a instanceof IS.Views.MyLiked});if(!a){IS.et.pe("Page","Load","/my/liked");var b=this;this.layoutView.hideAllSideNavs(),IS.helpers.setPageTitle(IS.Views.MyLiked.TITLE),IS.et.pp("/my/liked"),this.layoutView.emptyContent().hidePagination().setNavBarItem(IS.Views.MyLiked.CLASS);var c=new IS.Collections.MyLiked(null,{limit:this.calcPhotoFetchCount(),useEndOffset:!0});c.once("request",function(){IS.vent.trigger("app_layout:content:loading")}),c.once("sync",function(a,d){var e=new IS.Views.HeaderUpgradeBanner,f=new IS.Views.HeaderManage({model:new Backbone.Model({title:"LIKED",showControls:!0,sizesEnabled:!0,count:d.result.total}),windowPadding:0}),g=new IS.Views.MyLiked({collection:c,endOffset:d.result.end_offset});b.currentViews.push(e,f,g),b.layoutView.insertContent(e.render().el).insertContent(f.render().el).insertContent(g.render().el).insertContent($('<div class="grid-loading" />')).insertContent($('<div class="grid-no-results" />')),e.show(),f.show(),g.setupElements(),c.length||g.showEndOfLoading("NO IMAGES."),d.result.end_offset&&g.setupInfiniteScroll()});var d=c.fetch();this.loadingXhrs.push(d)}},following:function(a){IS.et.pe("Page","Load","/user/following"),this.handleFollowingFollowers(a,!0)},followers:function(a){IS.et.pe("Page","Load","/user/followers"),this.handleFollowingFollowers(a,!1)},handleFollowingFollowers:function(a,b){var c,d,e,f=this;if(IS.helpers.setPageTitle(a+"'s "+(b?"Following":"Followers")),this.layoutView.hideAllSideNavs(),IS.vent.trigger("app_layout:navbar:reset_nav_state"),_.isEmpty(this.bootstrapped)){IS.et.pp("/user/"+a+"/following"),c=_.find(this.currentViews,function(a){return a instanceof IS.Views.HeaderProfile}),d=_.find(this.currentViews,function(a){return a instanceof IS.Views.UserProfileBanner});var g=!(!c||!d);g?(c.setCurrentPage(b?"following":"followers"),this.layoutView.emptyProfileContent()):this.layoutView.emptyContent().hidePagination(),IS.currentUser&&a==IS.currentUser.get("username")&&this.layoutView.setNavBarItem(IS.Views.UserProfileImages.CLASS);var h={col:!1,model:g};h.model||(e=new IS.Models.ProfileHeader({username:a}).once("sync",function(){h.model=!0,h.col&&j()}.bind(this)).once("error",function(){IS.logger.error("Unable to sync profile header model",arguments)}));var i=new IS.Collections.FollowingFollowers(null,{limit:IS.CONS.FOLLOW_FETCH_COUNT,username:a,useEndOffset:!0,useFollowing:b}).once("request",function(){g&&IS.vent.trigger("app_layout:content:loader:add:class",{className:"profile-shift"}),IS.vent.trigger("app_layout:content:loading")}).once("sync",function(){h.col=!0,h.model&&j()}),j=function(){IS.vent.trigger("app_layout:content:loaded"),g&&IS.vent.trigger("app_layout:content:loader:remove:class",{className:"profile-shift"}),g||(c=new IS.Views.HeaderProfile({model:e}),f.layoutView.insertContent(c.render().el));var h=new IS.Views.FollowParent({collection:i,endOffset:i.endOffset,username:a,useFollowing:b});f.layoutView.insertContent(h.render().el),i.length||f.layoutView.insertContent($('<div class="grid-no-results follow" />')),g||(d=new IS.Views.UserProfileBanner({photos:e.get("banner_images")}),c.$el.find(".inner").prepend(d.el),c.setCurrentPage(b?"following":"followers")),h.setupElements().renderInitialSet(),i.endOffset?h.setupInfiniteScroll():i.length||h.showNoResults(),f.currentViews.push(h),g||f.currentViews.push(c,d)};if(!g){var k=e.fetch();this.loadingXhrs.push(k)}var l=i.fetch();this.loadingXhrs.push(l)}else{this.bootstrapped.isOwnPage&&this.layoutView.setNavBarItem(IS.Views.UserProfileImages.CLASS),c=new IS.Views.HeaderProfile({el:$("header.user-profile"),model:new IS.Models.ProfileHeader({profile_user:{username:a,is_followed:this.bootstrapped.isFollowed}})}),d=new IS.Views.UserProfileBanner({photos:f.bootstrapped.bannerPhotos});var m=new IS.Views.FollowParent({el:$("section.follow-parent"),users:f.bootstrapped.users,endOffset:f.bootstrapped.endOffset,username:a,useFollowing:f.bootstrapped.useFollowing});$("header.user-profile .inner").prepend(d.el),$.parseJSON(this.bootstrapped.users)&&$.parseJSON(this.bootstrapped.users).length&&$(".grid-no-results").remove(),f.currentViews.push(c,d,m)}},imageEdit:function(a){var b=new IS.Models.Photo({id:a}).once("sync",function(){var a=new IS.Views.ImageEditor({model:b});this.layoutView.emptyContent().insertContent(a.render().el)}.bind(this));b.fetch()}}),IS.Routers.Mixins.Base={bootstrapped:{},isFirstRoute:!0,history:[],currentView:[],loadingXhrs:[],layoutView:null,setupLogger:function(){this.on("all",function(){IS.logger.log.apply(IS.logger,_.union(["[MobileRouter] Fired:"],_.toArray(arguments).slice(1)))})},setupVentNavigate:function(){IS.vent.on("route:navigate",function(a){this.navigate(a.route,{trigger:!!a.trigger,replace:!!a.replace})}.bind(this),this)},pushHistoryFragment:function(){this.history.push(Backbone.history.fragment)},removeLoadingXhrs:function(){_.each(this.loadingXhrs,function(a){a&&4!=a.readystate&&a.abort?(IS.logger.log("[MainRouter] Aborting xhr"),a.abort()):a&&a.reject&&(IS.logger.log("[MainRouter] Rejecting xhr"),a.reject())}),this.loadingXhrs=[]},removeCurrentViews:function(){var a=[];_.each(this.currentViews,function(b){if(b instanceof IS.Views.Landing&&/\/i\/.*/.test(window.location.pathname))a.push(b);else if(b instanceof IS.Views.Settings&&/\/my\/settings/.test(window.location.pathname))a.push(b);else if((b instanceof IS.Views.HeaderProfile||b instanceof IS.Views.UserProfileBanner)&&/\/user\/.+\/?(a|followers|following)?/.test(window.location.pathname)){var c=this.history.slice(-2)[0],d=c.split("/"),e=d.length>1?d[1]:"";if(e){var f=new RegExp("/user/"+e,"i");f.test(window.location.pathname)?a.push(b):b.destroy()}else b.destroy()}else b.destroy()}.bind(this)),this.currentViews=a}},IS.Routers.Mobile=Backbone.Router.extend({routes:{"my/images":"myImages","my/albums":"myAlbums","my/following":"myFollowing","my/liked":"myLiked","i/:id":"landing","a/:id":"albumsDetail","a/:id/:page":"albumsDetail","user/:username":"profileImages","user/:username/a":"profileAlbums","user/:username/liked":"profileLiked"},LIMITS:{FEED:12,GRID_PHOTOS:24,GRID_ALBUMS:12},initialize:function(a){a=a||{},_.extend(this,IS.Routers.Mixins.Base),this.bootstrapped=a.bootstrapped||{},this.layoutView=new IS.Views.MobileLayout,this.setupLogger(),this.setupVentNavigate()},before:function(){this.pushHistoryFragment(),this.removeCurrentViews(),this.removeLoadingXhrs(),store.enabled&&!store.get(IS.CONS.STORAGE.MOBILE_FEED_STYLE)&&store.set(IS.CONS.STORAGE.MOBILE_FEED_STYLE,IS.CONS.MOBILE_FEED_STYLES.FEED)},after:function(){this.bootstrapped={},this.isFirstRoute=!1},myImages:function(){IS.et.pe("Page","Load","/my/images"),IS.et.pp("/my/images"),IS.helpers.setPageTitle(IS.Views.MyImagesMobile.TITLE),this._myFeed({activeTab:"myImages",collectionName:"MyImages",collectionCached:!0,collectionLimit:function(){var a=store.get(IS.CONS.STORAGE.MOBILE_FEED_STYLE);return a==IS.CONS.MOBILE_FEED_STYLES.GRID?this.LIMITS.GRID_PHOTOS:this.LIMITS.FEED}.bind(this)(),viewName:"MyImagesMobile",gridSelectorVisible:!0})},myAlbums:function(){IS.et.pe("Page","Load","/my/albums"),IS.et.pp("/my/albums"),IS.helpers.setPageTitle(IS.Views.MyAlbums.TITLE),this.layoutView.emptyContent();var a=new IS.Collections.MyAlbums(null,{limit:this.LIMITS.FEED});a.once("fetch:started",function(){this.isFirstRoute||this.layoutView.loaderStart()}.bind(this)),a.once("fetch:success",function(){var b=new IS.Views.MyAlbumsMobile({collection:a}),c=new IS.Views.FeedNoResults;this.currentViews.push(b,c),this.layoutView.insertContent(b.render().el).loaderFinish()}.bind(this));var b=new IS.Views.HeaderMainMobile,c=new IS.Views.HeaderSelectorMobile({activeTab:"myAlbums",addAlbumIconVisible:!0});this.currentViews.push(b,c),this.layoutView.insertContent([b.render().el,c.render().el]);var d=a.fetch({cache:!0,expires:IS.cm.TIMES.DAY});this.loadingXhrs.push(d)},albumsDetail:function(a){IS.et.pe("Page","Load","/a"),IS.currentUser?IS.et.pe("Album Mobile","Logged In"):IS.et.pe("Album Mobile","Logged Out"),IS.helpers.setPageTitle(IS.Views.MyAlbumsDetailMobile.TITLE),this.layoutView.emptyContent();var b=new IS.Models.Album({id:a});b.once("sync",function(b){var c=new IS.Collections.MyAlbumsDetail(null,{albumId:a,limit:this.LIMITS.FEED,page:1});c.once("fetch:success",function(){var a=new IS.Views.MyAlbumsDetailMobile({collection:c,albumModel:b}),d=new IS.Views.FeedNoResults;this.currentViews.push(a,d),this.layoutView.insertContent(a.render().el).loaderFinish()}.bind(this));var d=c.fetch({cache:!0,expires:IS.cm.TIMES.DAY});this.loadingXhrs.push(d)}.bind(this)),b.once("error",function(a,b){var c=$.parseJSON(b.responseText);c.error&&5==c.error.error_code?IS.vent.trigger("mobile_layout:show_album_pass_overlay",{model:a}):IS.logger.error("Unable to sync album header detail model",arguments)});var c=new IS.Views.HeaderMainMobile({type:"back_arrow"});this.currentViews.push(c),this.layoutView.insertContent([c.render().el]),this.isFirstRoute||this.layoutView.loaderStart();var d=b.fetch({data:{image_limit:0}});this.loadingXhrs.push(d)},myFollowing:function(){IS.et.pe("Page","Load","/my/following"),IS.et.pp("/my/following"),IS.helpers.setPageTitle(IS.Views.MyFollowingsMobile.TITLE),this.layoutView.emptyContent();var a=new IS.Collections.MyFollowings(null,{limit:function(){var a=store.get(IS.CONS.STORAGE.MOBILE_FEED_STYLE);return a==IS.CONS.MOBILE_FEED_STYLES.GRID?this.LIMITS.GRID_PHOTOS:this.LIMITS.FEED}.bind(this)(),useEndOffset:!0});a.once("request",function(){this.isFirstRoute||this.layoutView.loaderStart()}.bind(this)),a.once("sync",function(b,c){var d=new IS.Views.MyFollowingsMobile({collection:a,endOffset:c.result.end_offset}),e=new IS.Views.FeedNoResults;this.currentViews.push(d,e),this.layoutView.insertContent(d.render().el).loaderFinish()}.bind(this));var b=new IS.Views.HeaderMainMobile,c=new IS.Views.HeaderSelectorMobile({activeTab:"following",gridSelectorVisible:!0});this.currentViews.push(b,c),this.layoutView.insertContent([b.render().el,c.render().el]);var d=a.fetch();this.loadingXhrs.push(d)},myLiked:function(){IS.et.pe("Page","Load","/my/liked"),IS.et.pp("/my/liked"),IS.helpers.setPageTitle(IS.Views.MyLikedMobile.TITLE),this._myFeed({activeTab:"myLiked",collectionName:"MyLiked",collectionUseEndOffset:!0,collectionCached:!1,collectionLimit:function(){var a=store.get(IS.CONS.STORAGE.MOBILE_FEED_STYLE);return a==IS.CONS.MOBILE_FEED_STYLES.GRID?this.LIMITS.GRID_PHOTOS:this.LIMITS.FEED}.bind(this)(),viewName:"MyLikedMobile",gridSelectorVisible:!0})},landing:function(a){IS.et.pe("Page","Load","/mobile_landingpage"),IS.et.pe("Landing Page Mobile","Initialized","Page"),IS.currentUser?IS.et.pe("Landing Page Mobile","Logged In"):IS.et.pe("Landing Page Mobile","Logged Out"),this.layoutView.emptyContent();var b=function(){var a=new IS.Views.ImageOverlay({model:c});this.currentViews.push(a),$("body").append(a.render().el),_.defer(function(){a.show()}.bind(this))}.bind(this);if(_.isEmpty(this.bootstrapped)){var c=new IS.Models.Landing({id:a});this.isFirstRoute||this.layoutView.loaderStart(),c.once("sync",function(){b(),this.layoutView.loaderFinish()}.bind(this));var d=c.fetch();this.loadingXhrs.push(d)}else{var c=new IS.Models.Landing($.parseJSON(this.bootstrapped.photo));b()}},profileImages:function(a){IS.et.pe("Page","Load","/user/images"),IS.et.pp("/my/images"),IS.helpers.setPageTitle(a+"'s Images"),this._profileFeed({username:a,activeTab:"images",collectionName:"ProfileImages",collectionLimit:this.LIMITS.FEED,viewName:"UserProfileImagesMobile"})},profileAlbums:function(a){IS.et.pe("Page","Load","/user/albums"),IS.et.pp("/user/"+a+"/a"),IS.helpers.setPageTitle(a+"'s Albums"),this._profileFeed({username:a,activeTab:"albums",collectionName:"ProfileAlbums",collectionLimit:this.LIMITS.GRID_ALBUMS,viewName:"UserProfileAlbumsMobile"})},profileLiked:function(a){IS.et.pe("Page","Load","/user/images/liked"),IS.et.pp("/user/"+a+"/liked"),IS.helpers.setPageTitle(a+"'s Liked Images"),this._profileFeed({username:a,activeTab:"liked",collectionName:"ProfileLiked",collectionLimit:this.LIMITS.FEED,viewName:"UserProfileLikedMobile"})},_myFeed:function(a){a=_.defaults(a||{},{activeTab:null,collectionName:null,collectionLimit:null,collectionUseEndOffset:!1,collectionCached:!1,viewName:null,gridSelectorVisible:!1,cached:!1}),this.layoutView.emptyContent();var b=new IS.Collections[a.collectionName](null,{limit:a.collectionLimit,useEndOffset:a.collectionUseEndOffset});b.once("request",function(){this.isFirstRoute||this.layoutView.loaderStart()}.bind(this)),b.once("sync",function(c,d){var e=null;a.collectionUseEndOffset&&(e=d.result.end_offset);var f=new IS.Views[a.viewName]({collection:b,currentPage:1,endOffset:e}),g=new IS.Views.FeedNoResults;this.currentViews.push(f,g),this.layoutView.insertContent(f.render().el).loaderFinish()}.bind(this));var c=new IS.Views.HeaderMainMobile,d=new IS.Views.HeaderSelectorMobile({activeTab:a.activeTab,gridSelectorVisible:a.gridSelectorVisible});this.currentViews.push(c,d),this.layoutView.insertContent([c.render().el,d.render().el]);var e=b.fetch({cache:a.collectionCached,expires:IS.cm.TIMES.DAY});this.loadingXhrs.push(e)},_profileFeed:function(a){a=_.defaults(a||{},{username:null,activeTab:null,collectionName:null,collectionLimit:null,viewName:null}),IS.currentUser?IS.et.pe("Profile Page Mobile","Logged In"):IS.et.pe("Profile Page Mobile","Logged Out"),this.layoutView.emptyContent();var b={col:!1,model:!1},c=new IS.Models.ProfileHeader({username:a.username}),d=new IS.Collections[a.collectionName](null,{username:a.username,limit:a.collectionLimit}),e=function(){var b=new IS.Views.HeaderMainMobile({type:"profile"}),e=new IS.Views.HeaderProfileMobile({model:c,activeTab:a.activeTab});this.currentViews.push(b,e),this.layoutView.insertContent([b.render().el,e.render().el]);var f=new IS.Views[a.viewName]({collection:d,currentPage:1}),g=new IS.Views.FeedNoResults;this.currentViews.push(f,g),this.layoutView.insertContent(f.render().el).loaderFinish()}.bind(this);c.once("sync",function(){b.model=!0,b.col&&e()}),d.once("fetch:started",function(){this.isFirstRoute||this.layoutView.loaderStart()}.bind(this)),d.once("fetch:success",function(){b.col=!0,b.model&&e()}.bind(this));var f=d.fetch({cache:!0,expires:IS.cm.TIMES.DAY}),g=c.fetch({cache:!0,expires:IS.cm.TIMES.DAY});this.loadingXhrs.push(f,g)}}),IS.Views.AppLayout=Backbone.View.extend({el:".app-layout",headerView:null,navbarView:null,contentView:null,paginationView:null,tipView:null,$window:null,initialize:function(a){a=a||{},this.headerView=new IS.Views.HeaderMain,this.navbarView=new IS.Views.AppLayoutNavbar,this.contentView=new IS.Views.AppLayoutContent,this.paginationView=new IS.Views.AppLayoutPagination,_.bindAll(this,"windowResize"),this.$window=$(window);_.debounce(this.windowResize,50);this.$window.on("resize",this.windowResize),this.$window.trigger("resize"),this.popupThreshold=1728e5,this.delPopupThreshold=259200,IS.vent.on({"app_layout:content:expand":this.windowResize,"app_layout:content:unexpand":this.windowResize,"app_layout:display_system_msg":this.displaySystemMsg,"app_layout:show_tip":this.showTip},this),this.displayPromoMsg(),this.displayUpgradeBanner()},windowResize:function(a,b){var c=this.$window.width(),d=this.$window.height(),e=this.navbarView.getCurrentWidth(),f=0,g=c-e,h=d-f;this.contentView.resize(g,h)},insertContent:function(a){return this.contentView.insertContent(a),this},prependContent:function(a){return this.contentView.prependContent(a),this},emptyContent:function(){return this.contentView.empty(),this},emptyProfileContent:function(){return this.contentView.emptyProfile(),this},showTimelineNav:function(){return IS.vent.trigger("my_images:timeline:show"),this},showDiscoveryDirectory:function(){return IS.vent.trigger("discover:directory:show"),this},enableEditWidget:function(){return IS.vent.trigger("grid_items:edit_widget:enable"),this},disableEditWidget:function(){return IS.vent.trigger("grid_items:edit_widget:disable"),this},hideAllSideNavs:function(){return IS.vent.trigger("discover:directory:hide"),IS.vent.trigger("my_images:timeline:hide"),IS.vent.trigger("grid_items:edit_widget:hide"),IS.vent.trigger("grid_items:edit_widget:disable"),this},setNavBarItem:function(a){return this.navbarView.setSelectedItem(a),this},setPaginationOptions:function(a){a=_.extend({url:null,urlParams:{}},a),this.paginationView.setOptions(a),this.paginationView.off("link_clicked"),this.paginationView.on("link_clicked",function(b){if(a.urlParams&&!_.isEmpty(a.urlParams)){var c="/?"+$.param(a.urlParams);Backbone.history.navigate(a.url+b.page+c,!0)}else Backbone.history.navigate(a.url+b.page,!0)})},showPagination:function(){return this.paginationView.render().show(),this},hidePagination:function(){return this.paginationView.hide(),this},showTip:function(a){a=a||{},this.tipView||(this.tipView=new IS.Views.AppLayoutTip({title:a.title,msg:a.msg,buttonText:a.buttonText}).on("close",function(){a.closeCallback&&a.closeCallback()}).on("button:clicked",function(){a.buttonClickedCallback&&a.buttonClickedCallback()}),this.$el.append(this.tipView.render().el))},hideTip:function(){this.tipView&&this.tipView.destroy()},displaySystemMsg:function(){if(IS.currentUser&&IS.currentUser.systemMessages.length){var a=IS.currentUser.systemMessages.first(),b=new IS.Views.SystemMessage({model:a});$("body").append(b.render().el),b.show()}},displayPromoMsg:function(){var a=$("#user-promo-status"),b=(+new Date,!1);if(!b&&!$(".system-msg").length&&a.length){var c=+a.data("status");if(0===c)IS.currentUser.get("trialDaysCount")&&this.showUpgradePopup(parseInt(IS.currentUser.get("trialDaysCount")),!1);else{var d=2===c,e=d?"OLD_USERS":"NEW_USERS",f=IS.subs.PROMO[e],g=new IS.Views.SystemMessage({model:new Backbone.Model({messageType:3,message:"As a special thanks for "+(d?"coming to the new site":"joining us")+" we are giving you a discount of "+100*f.discount+'% off an entire year subscription. <a data-sub="'+e+'" data-promo-type="'+(d?"Old Users":"New Users")+'" class="button-large-yellow system-message-promo-trigger">GET IT NOW</a>'})});IS.et.pe("Site Banner","Show","Banner - "+(d?"Old":"New")+" Users"),$("body").append(g.render().el),g.show(),$("#trial-countdown footer > a").addClass("upgrade-trigger").data("sub",e),d&&this.showUpgradePopup(parseInt(IS.currentUser.get("trialDaysCount")),!0)}}},showUpgradePopup:function(a,b){var c=store.get(IS.CONS.STORAGE.UPGRADE_POPUP),d=+new Date;(!c||d-c>this.popupThreshold)&&(store.enabled&&store.set(IS.CONS.STORAGE.UPGRADE_POPUP,d),IS.et.pe("Popup","Show","Upgrade - "+(b?"Discount":"Regular")+" Price"),IS.helpers.confirmAction({message:Mustache.render(IS.Views.Mixins.Messages.uPopup,{count:a,noun:1==a?"day":"days"}),sub_message:IS.Views.Mixins.Messages.uPopupSub+(b?"<br><br>"+IS.Views.Mixins.Messages.uPopupSubOld:""),confirm_text:"Upgrade",centered:!0}).done(function(){IS.et.pe("Popup","Click","CTA - "+(b?"Discount":"Regular")+" Price"),b?IS.helpers.showSubForm(IS.subs.PROMO.OLD_USERS):window.location="/upgrade"}))},displayUpgradeBanner:function(){var a=new IS.Views.HeaderPremiumBanner;$("body").append(a.render().el)}}),IS.Views.AppLayoutContent=Backbone.View.extend({el:".app-layout-content",initialize:function(){this.loaderView=new IS.Views.AppLayoutLoader,this.editWidgetView=new IS.Views.GridItemsEditWidget,this.$content=this.$("> .content"),IS.vent.on({"app_layout:content:expand":this.expand,"app_layout:content:unexpand":this.unexpand,"app_layout:content:loading":this.showLoader,"app_layout:content:loaded":this.hideLoader,"app_layout:content:subdue":this.subdue,"app_layout:content:remove_subdue":this.removeSubdue,"app_layout:content:bind:scroll":this.bindScroll,"app_layout:content:unbind:scroll":this.unbindScroll,"app_layout:content:enable_scroll":this.enableScroll,"app_layout:content:disable_scroll":this.disableScroll,"app_layout:content:max_width":this.setContentWidthToMax,"app_layout:content:add:class":this.addCSSClass,"app_layout:content:remove:class":this.removeCSSClass,"app_layout:content:loader:add:class":this.addLoaderClass,"app_layout:content:loader:remove:class":this.removeLoaderClass},this)},bindScroll:function(){var a=_.throttle(function(){this.scrolled()}.bind(this),350);this.$el.on("scroll",a)},unbindScroll:function(){this.$el.off("scroll",null)},scrolled:function(){IS.vent.trigger("app_layout:content:scrolled")},expand:function(){this.$el.addClass("expanded"),setTimeout(function(){$(window).trigger("resize")},75)},unexpand:function(){this.$el.removeClass("expanded"),setTimeout(function(){$(window).trigger("resize")},75)},insertContent:function(a){this.$content.append(a)},prependContent:function(a){this.$content.prepend(a)},empty:function(){this.$content.empty()},emptyProfile:function(){this.$content.find("> *:not(header.user-profile)").remove()},showLoader:function(){this.loaderView.show()},hideLoader:function(){this.loaderView.hide()},subdue:function(){this.$el.addClass("subdued")},removeSubdue:function(){this.$el.removeClass("subdued")},resize:function(a,b){this.$el.css({width:a,height:b}),IS.vent.trigger("app_layout:content:size:change",{width:a,height:b})},enableScroll:function(){return this.$el.removeClass("no-scroll"),this},disableScroll:function(){return this.$el.addClass("no-scroll"),this},setContentWidthToMax:function(){this.$content.css("width","100%")},addCSSClass:function(a){this.$el.addClass(a.className)},removeCSSClass:function(a){this.$el.removeClass(a.className)},addLoaderClass:function(a){this.loaderView.$el.addClass(a.className)},removeLoaderClass:function(a){this.loaderView.$el.removeClass(a.className)}}),IS.Views.AppLayoutLoader=Backbone.View.extend({useDelay:!1,delayTime:350,delayId:null,initialize:function(){NProgress.configure({showSpinner:!1,minimum:.22,type:"desktop"})},show:function(){this.useDelay?this.delayId=_.delay(function(){NProgress.start()},this.delayTime):NProgress.start()},hide:function(){clearTimeout(this.delayId),NProgress.done()}}),IS.Views.AppLayoutNavbar=Backbone.View.extend({el:"#app-navbar",events:{"click .expander":"expanderClicked","click .toggle":"toggleClicked","click .album-add-icon":"albumIconClicked","click .feedback-button":"showFeedbackBox","click .trackable":"trackEvent","click .albums .item > a":"trackAlbumClick","click .tags .item > a":"tagsTrackTagClick","click .upgrade-trigger":"showUpgradeOverlay","click #trial-countdown":"goToFAQ","click section.logo":"logoClicked"},width:180,minimizedWidth:20,initialize:function(){this.addAlbumLightboxView=new IS.Views.LightboxNewAlbum({id:"lightbox-add-album-navbar"}),this.$content=this.$(".content"),this.$albumAddIcon=this.$(".album-add-icon"),this.$tagsLink=this.$(".item.tags"),this.$tagsSub=this.$tagsLink.next(".sub"),this.setupAlbumsInfiniteScroll(),this.tagsSetupInfiniteScroll(),IS.vent.on({"app_layout:navbar:remove_album_link":this.removeAlbumLinkById,"app_layout:navbar:rename_album_link":this.renameAlbumLinkById,"app_layout:navbar:update_album_link_privacy":this.updateAlbumLinkPrivacy,"app_layout:navbar:add_album_link":this.addAlbumLink,"app_layout:navbar:activate_album_link":this.activateAlbumLink,"app_layout:navbar:deactivate_album_links":this.deactivateAllAlbumLinks,"app_layout:navbar:reset_nav_state":this.resetNavState,"app_layout:navbar:enable_album_icon":this.enableAlbumIcon,"app_layout:navbar:disable_album_icon":this.disableAlbumIcon,"app_layout:navbar:hide_album_lightbox":this.hideAlbumLightbox,"app_layout:navbar:activate_private_link":this.activatePrivateLink,"app_layout:navbar:activate_tag_link":this.tagsActivateLink,"app_layout:navbar:deactivate_tag_links":this.tagsDeactivateAllLinks,"app_layout:navbar:increment_tag_link":this.tagsIncrementCount,"app_layout:navbar:decrement_tag_link":this.tagsDecrementCount,"app_layout:navbar:tags_refresh":this.tagsRefresh},this)},getCurrentWidth:function(){return this.width},albumIconClicked:function(a){a.preventDefault(),a.stopPropagation(),IS.vent.trigger("app_layout:content:subdue"),IS.vent.trigger("grid_items:edit_widget:disable"),this.addAlbumLightboxView.once("closed",function(){IS.vent.trigger("grid_items:edit_widget:enable")}),this.addAlbumLightboxView.show(),IS.et.pe("Left Nav","Click","Add Album Icon")},enableAlbumIcon:function(){this.$albumAddIcon.show()},disableAlbumIcon:function(){this.$albumAddIcon.hide()},resetNavState:function(){this.$("nav > .item.selected").each(function(){var a=$(this);a.removeClass("selected");var b=a.next(".sub");b.length&&b.removeClass("expanded")})},setSelectedItem:function(a){if(a){var b=this.$(".item."+a);if(!b.parents(".scrollable").length){this.resetNavState(),b.addClass("selected");var c=b.next(".sub");(!b.hasClass("albums")||c.find(".scrollable").children().length)&&c.length&&c.addClass("expanded")}}},activatePrivateLink:function(a){return a&&a.id?(this.deactivateAllPrivateLinks(),void this.$(".sub.private .item."+a.id+" a").addClass("selected").parent().addClass("selected")):IS.logger.error("Must pass ID")},activateAlbumLink:function(a){return a&&a.id?(this.deactivateAllAlbumLinks(),void this.$('.item.album a[data-id="'+a.id+'"]').addClass("selected").parent().addClass("selected")):IS.logger.error("Must pass ID")},deactivateAllAlbumLinks:function(){this.$(".item.album a.selected").removeClass("selected").parent().removeClass("selected")},deactivateAllPrivateLinks:function(){this.$(".sub.private .item a.selected").removeClass("selected").parent().removeClass("selected")},removeAlbumLinkById:function(a){return a.id?void this.$('.item.album a[data-id="'+a.id+'"]').parent().remove():IS.logger.error("Must pass ID")},renameAlbumLinkById:function(a){return a.id?a.name?void this.$('.item.album a[data-id="'+a.id+'"]').html(a.name):IS.logger.error("Must pass name"):IS.logger.error("Must pass ID")},updateAlbumLinkPrivacy:function(a){if(!a.album)return IS.logger.error("Must pass album");var b=this.$('.item.album a[data-id="'+a.album.get("id")+'"]'),c=b.next();return c.length?(c.removeClass("icon-lock icon-lock-password"),void(a.album.isPrivate()?c.addClass("icon-lock"):a.album.isPrivatePass()&&c.addClass("icon-lock-password"))):IS.logger.error("Couldn't find lock el")},addAlbumLink:function(a){a=_.defaults(a,{album:null,updateSelectedItem:!0}),a.album||IS.logger.error("Must pass album"),this.deactivateAllAlbumLinks();var b=$('<div class="item album" />'),c=a.album.friendlyTitle({len:15}),d=$('<a href="#" class="selected">'+c+"</a>");if(a.album.get("public")||a.album.get("password_protected")){if(a.album.get("password_protected"))var e=$('<div class="icon-lock-password" />')}else var e=$('<div class="icon-lock" />');d.attr({href:a.album.detailURL(),"data-id":a.album.get("id")}),a.updateSelectedItem&&(this.$("a.albums").hasClass("selected")||(this.setSelectedItem("albums"),this.$(".sub.albums").addClass("expanded"))),b.html(d),b.append(e),this.$(".sub.albums .scrollable").prepend(b)},setupAlbumsInfiniteScroll:function(){var a=this.$(".sub.albums .scrollable"),b=new IS.Collections.MyAlbums(null,{
limit:100,image_limit:0}),c=function(){b.isFetching||b.nextPage({success:function(b,c){c.areMorePages||IS.helpers.removeInfiniteScroll({$target:a}),b.result&&b.result.albums&&_.each(b.result.albums,function(b){b=new IS.Models.Album(b);var c=Mustache.render(IS.inlineTemplates.album_link,{albumId:b.get("id"),albumName:b.friendlyTitle({len:13}),showLock:!b.get("public")});a.append(c)})}})};IS.helpers.infiniteScroll({$target:a,$reference:a,threshold:200,callback:c})},hideAlbumLightbox:function(){this.addAlbumLightboxView.hide()},showFeedbackBox:function(){var a=new IS.Views.Feedback,b=IS.helpers.displayOverlay({content:a,width:IS.Views.Feedback.WIDTH,height:IS.Views.Feedback.HEIGHT});a.on("change:height",function(a){b.trigger("change:height",a)}),a.once("close",function(){b.close()}),IS.et.pe("Left Nav","Click","Feedback")},trackEvent:function(a){IS.et.pe("Left Nav","Click",$(a.currentTarget).data("label"))},trackAlbumClick:function(){IS.et.pe("Left Nav","Click","Album Name")},tagsActivateLink:function(a){return a&&a.id?(this.tagsDeactivateAllLinks(),void this.$('.item.tag a[data-id="'+encodeURIComponent(a.id)+'"]').addClass("selected").parent().addClass("selected")):IS.logger.error("Must pass ID")},tagsDeactivateAllLinks:function(){this.$(".item.tag a.selected").removeClass("selected").parent().removeClass("selected")},tagsDecrementCount:function(a){(!a.tags||a.tags.length)&&_.each(a.tags,function(a){var b=$('.item.tag a[data-id="'+a+'"]');if(b.length){var c=b.next("span.num");parseInt(c.html())-1<=0?b.parent(".item.tag").remove():c.html(parseInt(c.html())-1)}})},tagsIncrementCount:function(a){(!a.tags||a.tags.length)&&_.each(a.tags,function(a){var b=$('.item.tag a[data-id="'+a+'"]');if(b.length){var c=b.next("span.num");c.html(parseInt(c.html())+1)}else this.tagsRefresh()}.bind(this))},tagsSetupInfiniteScroll:function(){var a=this.$tagsSub.find(".scrollable"),b=new IS.Collections.UserTags(null,{limit:25,page:1}),c=function(){b.isFetching||b.nextPage({success:function(b,c){c.areMorePages||IS.helpers.removeInfiniteScroll({$target:a}),b.result&&b.result.tags&&_.each(b.result.tags,function(b,c){var d=new IS.Models.UserTag({name:c,count:b.total}),e=Mustache.render(IS.inlineTemplates.tag_link,{name:d.friendlyName(),count:d.friendlyCount(),url:d.myTagUrl(),id:encodeURIComponent(d.get("name"))});a.append(e)})}})};IS.helpers.infiniteScroll({$target:a,$reference:a,threshold:200,callback:c})},tagsRemoveAllLinks:function(){this.$tagsSub.find(".scrollable > .item.tag").remove()},tagsRefresh:function(){var a=this.$tagsSub.find(".scrollable");IS.helpers.removeInfiniteScroll({$target:a}),this.tagsRemoveAllLinks();var b=new IS.Collections.UserTags(null,{limit:25});b.fetch({success:function(b){b.result&&b.result.tags&&_.each(b.result.tags,function(b,c){var d=new IS.Models.UserTag({name:c,count:b.total}),e=Mustache.render(IS.inlineTemplates.tag_link,{name:d.friendlyName(),count:d.friendlyCount(),url:d.myTagUrl(),id:encodeURIComponent(d.get("name"))});a.append(e)}),this.tagsSetupInfiniteScroll()}.bind(this)})},tagsTrackTagClick:function(){IS.et.pe("Left Nav","Click","Tag Name")},showUpgradeOverlay:function(a){a.stopPropagation(),a.preventDefault(),IS.et.pe("Left Nav","Click","Upgrade");var b=$(a.currentTarget),c=b.data("sub"),d=IS.subs.PROMO[c];IS.helpers.showSubForm(d)},goToFAQ:function(){window.location="/faq#subscriptions"},logoClicked:function(){window.location="/"}}),IS.Views.AppLayoutPagination=Backbone.View.extend({el:".app-layout-pagination",events:{"click .inner a":"linkClicked","click .inner .goto .btn":"gotoBtnClicked","keyup .inner .goto input":"gotoEnterPressed"},initialize:function(){return this.enabled=!0,this.timeout=null,this.currentPage=1,this.totalCount=0,this.perPage=20,this.totalPages=0,this.$inner=this.$(".inner"),IS.vent.on({"app_layout_pagination:show":this.show,"app_layout_pagination:hide":this.hide},this),this},render:function(){return this.$inner.empty(),this.totalCount?1==this.totalPages?this:(this.totalPages<9?this.renderShortStyle():this.renderLongStyle(),this):this},setOptions:function(a){return this.currentPage=parseInt(a.currentPage)||1,this.totalCount=parseInt(a.totalCount)||0,this.perPage=parseInt(a.perPage)||20,this.totalPages=Math.ceil(this.totalCount/this.perPage),this},renderShortStyle:function(){this.$inner.append(Mustache.render(IS.inlineTemplates.pagination.prev,{disabled:1==this.currentPage})),this.$inner.append('<div class="nums"></div>');for(var a=this.$inner.find(".nums"),b=1;b<this.totalPages+1;b++)a.append(Mustache.render(IS.inlineTemplates.pagination.num,{page:b,current:b==this.currentPage}));this.$inner.append(Mustache.render(IS.inlineTemplates.pagination.next,{disabled:this.currentPage==this.totalPages}))},renderLongStyle:function(){this.$inner.append(Mustache.render(IS.inlineTemplates.pagination.prev,{disabled:1==this.currentPage})),this.$inner.append('<div class="nums"></div>');for(var a=this.$inner.find(".nums"),b=1;3>b;b++)a.append(Mustache.render(IS.inlineTemplates.pagination.num,{page:b,current:b==this.currentPage}));if(this.currentPage<=4)for(var b=3;6>b;b++)a.append(Mustache.render(IS.inlineTemplates.pagination.num,{page:b,current:b==this.currentPage}));else{a.append(Mustache.render(IS.inlineTemplates.pagination.spacer,null));for(var b=this.currentPage-1;b<this.currentPage+2&&!(this.currentPage>this.totalPages-4);b++)a.append(Mustache.render(IS.inlineTemplates.pagination.num,{page:b,current:b==this.currentPage}))}if(this.currentPage>this.totalPages-4)for(var b=this.totalPages-4;b<this.totalPages+1;b++)a.append(Mustache.render(IS.inlineTemplates.pagination.num,{page:b,current:b==this.currentPage}));else{a.append(Mustache.render(IS.inlineTemplates.pagination.spacer,null));for(var b=this.totalPages-1;b<this.totalPages+1;b++)a.append(Mustache.render(IS.inlineTemplates.pagination.num,{page:b,current:b==this.currentPage}))}this.$inner.append(Mustache.render(IS.inlineTemplates.pagination.next,{disabled:this.currentPage==this.totalPages})),this.$inner.append(Mustache.render(IS.inlineTemplates.pagination["goto"],{}))},linkClicked:function(a){a.preventDefault(),IS.et.pe("Grid Pagination","Click","Link");var b=$(a.currentTarget),c=null;b.hasClass("prev")?IS.et.pe("Grid Pagination","Click","Prev"):b.hasClass("next")?IS.et.pe("Grid Pagination","Click","Next"):IS.et.pe("Grid Pagination","Click","Link"),b.data("id")?c=b.data("id"):b.hasClass("prev")?this.currentPage-1>=1&&(c=this.currentPage-1):b.hasClass("next")&&this.currentPage+1<=this.totalPages&&(c=this.currentPage+1),c&&(this.currentPage=c,this.render(),this.trigger("link_clicked",{page:c}))},gotoBtnClicked:function(){var a=parseInt(this.$el.find(".goto > input").val());0>=a||a>this.totalPages||(IS.et.pe("Grid Pagination","Click","Goto Button"),this.trigger("link_clicked",{page:a}))},gotoEnterPressed:function(a){IS.helpers.isEnterKey(a.keyCode)&&this.gotoBtnClicked()},show:function(){return this.enabled?(this.$el.removeClass("fadeOut").addClass("fadeIn").show(),clearTimeout(this.timeout),this):void 0},hide:function(){return clearTimeout(this.timeout),this.$el.removeClass("fadeIn"),this.$el.hide(),this},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this}}),IS.Views.AppLayoutTip=Backbone.View.extend({className:"app-layout-tip",tagName:"section",events:{"click .icon-close":"close","click .button":"buttonClicked"},msg:null,title:null,buttonText:null,initialize:function(){if(this.template=IS.helpers.loadTemplate("app_layout_tip"),this.msg=this.options.msg,this.title=this.options.title||"TIP",this.buttonText=this.options.buttonText,!this.msg||!this.msg.length)throw new Error("'msg' param required");if(!this.buttonText||!this.buttonText.length)throw new Error("'buttonText' param required");this.setupElements()},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{msg:this.msg,title:this.title,buttonText:this.buttonText})),this.setupElements(),this},setupElements:function(){},close:function(){this.destroy(),this.trigger("close")},buttonClicked:function(){this.trigger("button:clicked")}}),IS.Views.AuthForgot=Backbone.View.extend({el:"#forgot-new",events:{"click form .yellow-btn":"submit","submit form":"submit"},activeRequest:!1,initialize:function(){_.extend(this,IS.Views.Mixins.Auth),this.currentStep=1,this.showBackground(3),this.$firstStep=this.$("section.page.first"),this.$successStep=this.$("section.page.success"),this.$error=this.$("section.error"),this.$email=this.$('input[name="email"]'),this.$submitButton=this.$("form .yellow-btn"),$("input, textarea").placeholder(),this.$email.focus()},validate:function(){var a=$.trim(this.$email.val());return a?a.isValidEmail()?!0:(this.showError("invalidEmail"),!1):(this.showError("emptyEmail"),!1)},submit:function(a){return a.preventDefault(),this.activeRequest?!1:this.validate()?(this.hideError(),this.activeRequest=!0,this.disableForm(),void IS.Models.User.forgot({email:$.trim(this.$email.val())},function(a){a.success?this.showSuccess():(this.showError("apiFailure"),this.enableForm()),this.activeRequest=!1}.bind(this),function(a){a.error&&3==a.error.error_code?this.showError("emailNonexistant"):this.showError("apiFailure"),this.enableForm(),this.activeRequest=!1}.bind(this))):!1},disableForm:function(){this.$submitButton.html("RESETTING...").addClass("disabled")},enableForm:function(){this.$submitButton.html("RESET PASSWORD").removeClass("disabled")},showSuccess:function(){this.$firstStep.fadeOut(200,function(){this.$successStep.fadeIn(400)}.bind(this))}}),IS.Views.AuthLogin=Backbone.View.extend({el:"#login-new",events:{"click form .yellow-btn":"submit","submit form":"submit","click form .signup-btn":"gotoSignup","click form .fb-btn":"fbLoginClicked"},activeRequest:!1,redirectUrl:null,initialize:function(a){a=a||{},this.redirectUrl=a.redirect,_.extend(this,IS.Views.Mixins.Auth),this.fbAuthButtonView=new IS.Views.FBAuthButton({el:"form .fb-btn",noRedirect:!0}).on("facebook_auth:success",function(){return this.redirectUrl?void(window.location=this.redirectUrl):void(window.location="/")}.bind(this)),this.$error=this.$("section.error"),this.$username=this.$('input[name="username"]'),this.$password=this.$('input[name="password"]'),this.$loginButton=this.$("form .yellow-btn"),this.showBackground(1)},submit:function(a){if(a.preventDefault(),IS.CONS.MOBILE_DEVICE&&IS.et.pe("Home Page Mobile","Click","Login"),this.activeRequest)return!1;if(!this.validate())return!1;this.hideError(),this.activeRequest=!0,this.disableForm();var b=this.$(".next-page");b=b.length?b.val():null,IS.Models.User.login(this.getUsernameInputVal(),this.getPasswordInputVal(),!1,function(a){if(a.success)setTimeout(function(){if(this.redirectUrl)return void(window.location=this.redirectUrl);IS.currentUser=new IS.Models.User({authToken:a.result.auth_token});var c=new IS.Models.Settings;c.once("sync",function(a){if(b)window.location=b;else switch(parseInt(a.get("start_page"))){case IS.Models.Settings.START_PAGE.MY_ALBUMS:window.location="/my/albums";break;case IS.Models.Settings.START_PAGE.FOLLOWING:window.location="/my/following";break;default:window.location="/my/images"}}),c.fetch()}.bind(this),200);else{if(a.error&&32==a.error.error_code){var c=encodeURIComponent(this.getUsernameInputVal());this.showError("inactiveAccount",!0,c)}else this.showError("badAuth");this.enableForm(),this.activeRequest=!1,this.resetPasswordInput()}}.bind(this),function(){this.enableForm(),this.resetPasswordInput(),this.showError("badAuth"),this.activeRequest=!1}.bind(this))},validate:function(){return!this.getUsernameInputVal()&&!this.getPasswordInputVal()||this.$username.hasClass("placeholder")&&this.$password.hasClass("placeholder")?(this.showError("emptyBoth"),!1):!this.getUsernameInputVal()||this.$username.hasClass("placeholder")?(this.showError("emptyUsername"),!1):!this.getPasswordInputVal()||this.$password.hasClass("placeholder")?(this.showError("emptyPassword"),!1):!0},disableForm:function(){this.$loginButton.html("LOGGING IN...").addClass("disabled")},enableForm:function(){this.$loginButton.html("LOG IN").removeClass("disabled")},getUsernameInputVal:function(){return $.trim(this.$username.val())},getPasswordInputVal:function(){return $.trim(this.$password.val())},resetPasswordInput:function(){this.$password.val("").trigger("blur").focus()},gotoSignup:function(){IS.CONS.MOBILE_DEVICE&&IS.et.pe("Home Page Mobile","Click","Signup"),window.location="/signup"},fbLoginClicked:function(){IS.CONS.MOBILE_DEVICE&&IS.et.pe("Home Page Mobile","Click","Facebook Login")}}),IS.Views.AuthResetPassword=Backbone.View.extend({el:"#reset-password-new",events:{"click form .yellow-btn":"submit","submit form":"submit"},activeRequest:!1,initialize:function(){_.extend(this,IS.Views.Mixins.Auth),this.currentStep=1,this.showBackground(3),this.$error=this.$("section.error"),this.$firstStep=this.$("section.page.first"),this.$successStep=this.$("section.page.success"),this.$password=this.$('input[name="password"]'),this.$confirm=this.$('input[name="confirm"]'),this.$submitButton=this.$("form .yellow-btn"),this.$("input, textarea").placeholder()},validate:function(){var a=$.trim(this.$password.val()),b=$.trim(this.$confirm.val());return a?b?a.length<=5?(this.showError("passwordLength"),!1):a!=b?(this.showError("passwordMismatch"),!1):!0:(this.showError("emptyPasswordConfirm"),!1):(this.showError("emptyPassword"),!1)},submit:function(a){return a.preventDefault(),this.activeRequest?!1:this.validate()?(this.hideError(),this.activeRequest=!0,this.disableForm(),void IS.Models.User.resetPassword({email:this.options.email,password:$.trim(this.$password.val()),auth:this.options.token},function(){this.showSuccess(),this.activeRequest=!1}.bind(this),function(a){this.showError(a.error&&3==a.error.error_code?"accountDoesNotExist":"apiFailure"),this.enableForm(),this.activeRequest=!1}.bind(this))):!1},disableForm:function(){this.$submitButton.html("RESETTING...").addClass("disabled")},enableForm:function(){this.$submitButton.html("RESET PASSWORD").removeClass("disabled")},showSuccess:function(){this.$firstStep.fadeOut(200,function(){this.$successStep.fadeIn(400)}.bind(this))}}),IS.Views.AuthSignup=Backbone.View.extend({el:"#signup-new",initialize:function(a){_.extend(this,IS.Views.Mixins.Auth),this.currentStep=1,this.nextPage=a.nextPage,this.token=a.token,this.setupVersion=a.setupVersion,this.firstStepView=new IS.Views.AuthSignupFirstStep({parentView:this,token:this.token,setupVersion:this.setupVersion}),this.secondStepView=new IS.Views.AuthSignupSecondStep({parentView:this,nextPage:this.nextPage}),this.promoStepView=new IS.Views.AuthSignupPromoStep({parentView:this,nextPage:this.nextPage}),this.$error=this.$("section.error"),this.$firstStep=this.$(".page.first"),this.$successStep=this.$(".page.success"),this.$secondStep=this.$(".page.second"),this.$("input, textarea").placeholder(),this.setupVersion&&(this.showBackground(2),this.$secondStep.fadeIn(400))}}),IS.Views.AuthSignupFirstStep=Backbone.View.extend({el:"section.page.first",events:{"click .yellow-btn":"submit","submit form":"submit","click form .fb-btn":"trackFB","click form .login-btn":"gotoLogin"},activeRequest:!1,initialize:function(){this.parentView=this.options.parentView,this.token=this.options.token,this.options.setupVersion||this.parentView.showBackground(1),this.fbAuthButtonView=new IS.Views.FBAuthButton({el:"form .fb-btn"}),this.$email=this.$('input[name="email"]'),this.$username=this.$('input[name="username"]'),this.$password=this.$('input[name="password"]'),this.$passwordConfirm=this.$('input[name="password_confirm"]'),this.$signupButton=this.$("form .yellow-btn"),this.$referral=this.$("#referral"),this.$email.focus()},submit:function(a){$.trim(this.$email.val());return a.preventDefault(),IS.et.pe("Sign Up","Click","Signup Button"),this.activeRequest?!1:this.validate()?(this.parentView.hideError(),this.activeRequest=!0,this.disableForm(),void IS.Models.User.signup({email:$.trim(this.$email.val()),username:$.trim(this.$username.val()),password:$.trim(this.$password.val()),set_cookies:!0,ref:this.$referral.val(),reg_token:this.token},function(a){a.success?IS.CONS.MOBILE_DEVICE?(IS.currentUser=new IS.Models.User({authToken:a.result.auth_token,email:a.result.email}),this.parentView.transitionToNextStep()):this.showSuccess():(this.activeRequest=!1,this.parentView.showError("apiFailure"),this.enableForm())}.bind(this),function(a){a.error&&30==a.error.error_code?this.parentView.showError("emailExists"):a.error&&29==a.error.error_code?this.parentView.showError("usernameExists"):a.error&&3==a.error.error_code?this.parentView.showError("invalidUsername"):this.parentView.showError("apiFailure"),this.activeRequest=!1,this.enableForm()}.bind(this))):!1},validate:function(){var a=$.trim(this.$email.val()),b=$.trim(this.$username.val()),c=$.trim(this.$password.val()),d=$.trim(this.$passwordConfirm.val());return a?b?b.length<IS.CONS.MIN_USERNAME_LENGTH?(this.parentView.showError("usernameLength"),!1):b.split(" ").length>1?(this.parentView.showError("usernameSpaces"),!1):c?d?a.isValidEmail()?c!=d?(this.parentView.showError("passwordMismatch"),!1):c.length<IS.CONS.MIN_PASSWORD_LENGTH?(this.parentView.showError("passwordLength"),!1):!0:(this.parentView.showError("invalidEmail"),!1):(this.parentView.showError("emptyPasswordConfirm"),!1):(this.parentView.showError("emptyPassword"),!1):(this.parentView.showError("emptyUsername"),!1):(this.parentView.showError("emptyEmail"),!1)},disableForm:function(){this.$signupButton.html("SIGNING UP...").addClass("disabled")},enableForm:function(){this.$signupButton.html("SIGN UP FOR 30 DAY TRIAL").removeClass("disabled")},trackFB:function(){IS.et.pe("Sign Up","Click","Facebook Button")},gotoLogin:function(){IS.et.pe("Sign Up","Click","Login Button"),window.location="/login"},showSuccess:function(){this.$el.fadeOut(200,function(){this.parentView.$successStep.fadeIn(400)}.bind(this))}}),IS.Views.AuthSignupPromoStep=Backbone.View.extend({el:"section.page.promo",events:{"click .plan-trigger":"showPromoPaymentBox","click .side .skip-btn":"skipStep"},initialize:function(a){this.nextStep=a.nextStep},showPromoPaymentBox:function(){IS.et.pe("Signup Promo","Click","Select Plan"),IS.helpers.showSubForm(IS.subs.PROMO.NEW_USERS)},skipStep:function(){IS.et.pe("Signup Promo","Click","Skip Step"),window.location=this.nextStep||"/"}}),IS.Views.AuthSignupSecondStep=Backbone.View.extend({el:"section.page.second",events:{"click form .yellow-btn":"submit","click section.avatar":"avatarClicked","change .avatar-input":"avatarChanged","click form .skip-btn":"skipButtonClicked","submit form.main":"submit"},initialize:function(a){this.parentView=a.parentView,this.nextPage=a.nextPage,this.$avatarForm=this.$("form.avatar-upload"),this.$description=this.$('textarea[name="bio"]'),this.$location=this.$('input[name="location"]'),this.$completeButton=this.$("form .yellow-btn"),this.$skipButton=this.$("form .skip"),this.$fileInput=this.$("input.avatar-input"),this.$newAvatar=this.$("section.avatar img.avatar"),this.$avatarButton=this.$("section.avatar .button"),this.$avatarInner=this.$("section.avatar .inner"),this.activeRequest=!1,this.avatarUploading=!1,this.newAvatar={server:null,filename:null}},avatarClicked:function(){this.$fileInput.click()},avatarChanged:function(){this.avatarLoading=!0,this.showAvatarLoading(),IS.et.pe("Sign Up","Upload","Avatar"),this.$avatarForm.ajaxSubmit({dataType:"json",data:{auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY,avatar:!0},resetForm:!0,success:function(a){if(a&&a.success&&a.result&&a.result.images&&a.result.images.length){var b=a.result.images.shift();this.newAvatar.server=b.server,this.newAvatar.filename=b.filename;var c=IS.helpers.getImagizerLink({server:this.newAvatar.server,filename:this.newAvatar.filename,width:150,height:150,cropped:!0}),d=this;this.$newAvatar.attr("src",c).on("load",function(){d.$avatarButton.hide(),d.$avatarInner.addClass("light"),$(this).show(),d.avatarLoading=!1,d.hideAvatarLoading()})}else this.avatarLoading=!1,this.hideAvatarLoading(),IS.helpers.displayUserError(IS.Views.Mixins.Messages.avatarUploadFailed)}.bind(this),error:function(a){this.avatarLoading=!1,this.hideAvatarLoading(),IS.logger.error("Sign up avatar upload failed",a),IS.helpers.displayUserError(IS.Views.Mixins.Messages.avatarUploadFailed)}.bind(this)})},submit:function(a){return a.preventDefault(),IS.et.pe("Sign Up","Click","Complete Button"),this.activeRequest||this.avatarUploading?!1:(this.activeRequest=!0,this.disableForm(!0),void IS.Models.User.update({auth_token:IS.currentUser.get("authToken"),description:$.trim(this.$description.val()),location:$.trim(this.$location.val()),avatar_server:this.newAvatar.server,avatar_filename:this.newAvatar.filename},function(a){a.success?this.nextPage?window.location=this.nextPage:window.location="/":(this.activeRequest=!1,this.enableForm(!0))}.bind(this)))},skipButtonClicked:function(){IS.et.pe("Sign Up","Click","Skip"),this.nextPage?window.location=this.nextPage:window.location="/"},disableForm:function(a){a&&this.$completeButton.html("COMPLETING..."),this.$completeButton.addClass("disabled")},enableForm:function(a){a&&this.$completeButton.html("COMPLETE"),this.$completeButton.removeClass("disabled")},showAvatarLoading:function(){this.$("section.avatar").addClass("pulse")},hideAvatarLoading:function(){this.$("section.avatar").removeClass("pulse")}}),IS.Views.Body=Backbone.View.extend({el:"body",events:{click:"clicked",keyup:"keyup",keydown:"keydown","focusin .bordered-input":"inputFocused","focusout .bordered-input":"inputBlurred","mouseenter *[data-tooltip]":"displayTooltip","click a.slider-option":"onOffToggle","click .fading-button":"fadingButtonToggle",dragenter:"dragEntered",dragstart:"dragStarted",dragleave:"dragLeft",dragend:"dragEnded","click .system-message-promo-trigger":"showPromoPaymentBox","click #survey-monkey .close-box":"closeSurveyBox",copy:"clipboardCopied"},initialize:function(){this.dragTargets=$(),this.pageEelementGrabbed=!1,this.timeout=null,this.interval=300,this.$dropZone=null,IS.vent.on({"body:show:credit_card_overlay":this.showCCOverlay,"body:disable_scrolling":this.disableScrolling,"body:enable_scrolling":this.enableScrolling},this);var a=window.location.search.split("?")[1];if(a&&(a=a.split("="),"sub"==a[0]&&1==a[1]&&IS.helpers.showSubForm(IS.subs.PROMO.NEW_USERS)),IS.currentUser&&IS.currentUser.attributes&&!IS.currentUser.attributes.hasPaidSubscription&&store.enabled){var b=store.get(IS.CONS.STORAGE.AUTO_PROMO_POP);(!b||(new Date).getTime()-b>864e5)&&(IS.et.pe("Subscription Flow","AutoPop"),store.set(IS.CONS.STORAGE.AUTO_PROMO_POP,(new Date).getTime()),IS.helpers.showSubForm(IS.subs.PROMO.NEW_USERS,"PRO",!0))}else if(IS.currentUser&&IS.currentUser.attributes&&IS.currentUser.attributes.hasPaidSubscription&&IS.currentUser.attributes.subRenewalDate&&!IS.currentUser.attributes.isSubRecurring){var c=1e3*IS.currentUser.attributes.subRenewalDate,d=(new Date).getTime(),e=d+6048e5;if(c>(new Date).getTime()&&e>c){var f=store.get(IS.CONS.STORAGE.AUTO_PROMO_POP_SUB_EXP);(!f||d-f>864e5)&&(IS.et.pe("Subscription Flow","AutoPopSubExpire"),store.set(IS.CONS.STORAGE.AUTO_PROMO_POP_SUB_EXP,(new Date).getTime()),IS.helpers.showSubForm(IS.subs.PROMO.NEW_USERS,"PRO",!1,!0))}}},clicked:function(a){IS.vent.trigger("body:clicked",{event:a})},keyup:function(a){IS.helpers.isEscapeKey(a.which)&&IS.vent.trigger("body:keyup:escape",{event:a}),IS.helpers.isShiftKey(a.which)&&IS.vent.trigger("body:keyup:shift",{event:a}),IS.helpers.isLeftArrowKey(a.which)&&IS.vent.trigger("body:keyup:left_arrow",{event:a}),IS.helpers.isRightArrowKey(a.which)&&IS.vent.trigger("body:keyup:right_arrow",{event:a})},keydown:function(a){IS.helpers.isShiftKey(a.which)&&IS.vent.trigger("body:keydown:shift",{event:a})},inputFocused:function(a){$(a.currentTarget).addClass("focused")},inputBlurred:function(a){$(a.currentTarget).removeClass("focused")},displayTooltip:function(a){var b,c=$(a.currentTarget),d=parseInt(c.data("tooltip-delay")||0),e=c.data("tooltip-disabled")||!1,f=new IS.Views.Tooltip({elem:c,model:new Backbone.Model({message:c.data("tooltip")})});e||(this.$el.append(f.render().el),b=setTimeout(function(){f.show()},d),c.one("mouseleave",function(){clearTimeout(b),f.hide()}))},onOffToggle:function(a){var b=$(a.currentTarget),c=b.hasClass("on");b.toggleClass("on"),b.hasClass("reverse-grouped")&&$(b.data("other-selector"))[c?"addClass":"removeClass"]("on"),b.hasClass("other-off-toggle")&&!c&&$(b.data("other-selector")).removeClass("on")},fadingButtonToggle:function(a){var b=$(a.currentTarget);(!b.data("force-login")||IS.currentUser)&&b.toggleClass("on")},dragEntered:function(a){IS.currentUser&&!this.pageEelementGrabbed&&(a.preventDefault(),a.stopPropagation(),0===this.dragTargets.length&&this.showDropZone(),$(a.target).hasClass("container")||(this.dragTargets=this.dragTargets.add(a.target)))},dragStarted:function(a){a&&a.originalEvent&&a.originalEvent.dataTransfer&&(this.pageEelementGrabbed=!0,a.originalEvent.dataTransfer.effectAllowed="copy",a.originalEvent.dataTransfer.dropEffect="copy")},dragLeft:function(a){a.stopPropagation(),setTimeout(function(){this.dragTargets=this.dragTargets.not(a.target),0===this.dragTargets.length&&this.hideDropZone()}.bind(this),1)},dragEnded:function(){this.pageEelementGrabbed=!1},showDropZone:function(){this.$dropZone?(clearTimeout(this.timeout),this.$dropZone.addClass("visible")):(this.$el.append(Mustache.render(IS.inlineTemplates.file_uploader_drop_zone,{limited:IS.currentUser&&IS.currentUser.get("freeAccount")})),this.$dropZone=$("#uploader-drop-zone"),this.$dropZone.on("dragenter dragover",function(a){a.preventDefault()}).one("drop",function(a){a.preventDefault(),this.filesDropped(a.originalEvent.dataTransfer.files)}.bind(this)),_.defer(function(){this.$dropZone.addClass("visible")}.bind(this)))},hideDropZone:function(){this.$dropZone&&(this.$dropZone.removeClass("visible"),this.timeout=setTimeout(function(){this.$dropZone.off().remove(),this.$dropZone=null}.bind(this),this.interval))},filesDropped:function(a){this.dragTargets=$(),this.hideDropZone();var b=IS.Views.Mixins.Messages;return IS.currentUser&&IS.currentUser.get("isBanned")?void IS.helpers.confirmAction({message:b.acctBanned,sub_message:Mustache.render(b.acctBannedSub),confirm_text:"Upgrade",centered:!0}).done(function(){window.location="/upgrade"}):IS.currentUser.canUpload()?void IS.helpers.initFileUploader({files:a}):void IS.helpers.showTrialExpiredDialog()},showPromoPaymentBox:function(a){var b=$(a.currentTarget);IS.et.pe("Site Banner","Click","CTA - "+b.data("promo-type"));var c=b.data("sub"),d=IS.subs.PROMO[c];IS.helpers.showSubForm(d)},showCCOverlay:function(a){var b=IS.helpers.showCreditCardFormOverlay({model:a});b.once("success",function(){IS.helpers.displayUserMessage(IS.Views.Mixins.Messages.successCardProcess,300),a.get("noRedirect")?IS.vent.trigger("payment:success"):window.location="/my/settings/subscription",$(".system-msg.promo").remove(),$("#trial-countdown, #trial-over").remove(),this.$el.removeClass("active-system-msg")},this),b.on({error:function(){IS.vent.trigger("global_overlay:display:error",IS.Views.Mixins.Messages.failedCardProcess)},"fail:validation":function(a){IS.vent.trigger("global_overlay:display:error",a)}},this)},disableScrolling:function(){document.ontouchmove=function(a){a.preventDefault()}},enableScrolling:function(){document.ontouchmove=null},closeSurveyBox:function(){store.enabled&&store.set(IS.CONS.STORAGE.SURVEY_MONKEY,!0),$("#survey-monkey").remove()},clipboardCopied:function(){IS.vent.trigger("clipboard:copy")}}),IS.Views.Discover=Backbone.View.extend({tagName:"section",id:"discover",events:{},initialize:function(a){if(IS.vent.trigger("app_layout:content:max_width"),this.categories=[],this.adMode=!!a.adMode,this.adCount=2,IS.vent.on("app_layout:content:size:change",this.resize,this),$(window).trigger("resize"),!this.photos)if(this.photos={},"string"==typeof a.photos)try{this.photos=$.parseJSON(a.photos)}catch(b){IS.logger.error("Discover view failed to parse json string",a.photos)}else this.photos=a.photos;this.attachCategoryViews(),IS.vent.trigger("app_layout:content:bind:scroll"),IS.helpers.showSurveyBox()},render:function(){return _.each(this.photos,function(a){var b=new IS.Views.DiscoverCategory({photos:a.images,category:a.category,type:a.class_name});this.$el.append(b.render().el),this.categories.push(b)}.bind(this)),this},attachCategoryViews:function(){this.$(".category").each(function(a,b){var c=$(b),d=c.data("type"),e=this.photos[d],f=new IS.Views.DiscoverCategory({el:c,photos:e.images,category:e.category,type:e.class_name,heroAd:this.adMode&&a<this.adCount});this.adMode&&a<this.adCount&&f.renderHeroAd(a),this.categories.push(f)}.bind(this))},resize:function(a){this.$el.css("width",a.width)},destroy:function(){IS.vent.trigger("app_layout:content:unbind:scroll"),_.each(this.categories,function(a){a.destroy()}),Backbone.View.prototype.destroy.call(this)}},{TITLE:"Discover",CLASS:"discover"}),IS.Views.DiscoverCategory=Backbone.View.extend({tagName:"article",className:"category",events:{"click .arrow.right":"rightArrowClicked","click .arrow.left":"leftArrowClicked"},initialize:function(a){this.category=a.category,this.type=a.type,this.heroAd=a.heroAd,this.template=IS.helpers.loadTemplate("discover_category"),this.setupView(),this.$window=$(window),this.leftRatio=5/7,this.photoViews=[],this.heroWidth=a.heroAd?300:285,this.padding=20,this.photoWidth=145,this.collection=new IS.Collections.DiscoverCategory(a.photos),this.pushExistingViews();var b=this;_.delay(function(){b.render(!0),b.showVisibleImages(),b.$el.addClass("visible")},250),IS.vent.on("app_layout:content:scrolled",this.showVisibleImages,this),IS.vent.on("app_layout:content:size:change",function(){this.render().showVisibleImages()},this)},setupView:function(){var a=this.$(".images").length,b=this;return a?(this.$images=this.$(".images"),this.$wrapper=this.$(".wrapper"),_.defer(function(){b.$el.addClass("visible")}),this):(this.$el.html(IS.helpers.renderTemplate(this.template,{category:this.category,right_arrow:!0})).addClass(this.type),this.$images=this.$(".images"),this.$wrapper=this.$(".wrapper"),this)},render:function(a){var b,c,d=this.$wrapper.width(),e=this.$images.find("img").length,f=Math.ceil((d-this.heroWidth-2*this.padding)/this.photoWidth),g=e%2;b=a?f-Math.ceil((e-1)/2):f+1,b=Math.max(0,b),c=Math.min(this.collection.length,e+(0==e?1:0)+2*b),this.setAreaWidth(c);for(var h=e;c>h;h++){var i=g++%2==1?".top":".bottom",j=new IS.Views.DiscoverCategoryPhoto({className:0==h?"hero":"photo",model:this.collection.at(h)});0==h?this.$images.prepend(j.render().$el):this.$images.find(i).append(j.render().$el),this.photoViews.push(j)}var k=(new Date).getTime();return this.$("a").each(function(a){this.className+=" g"+((k+a)%4+1)}),this},showVisibleImages:function(a){var b=this,c=this.$window.height();a=isNaN(a)?0:a,_.each(this.photoViews,function(d,e){d.$el.offset().top<=c&&!function(c){setTimeout(function(){b.collection.at(c).set("preloaded",!0)},a)}(e)});var d=_.filter(this.collection.models,function(a){return!a.get("preloaded")});return d.length||(IS.vent.off("app_layout:content:scrolled",this.showVisibleImages,this),IS.vent.off("app_layout:content:size:change",null,this)),this},setAreaWidth:function(a){return this.$images.css("width",2*this.padding+this.heroWidth+Math.ceil((a-1)/2)*this.photoWidth+10),this},pushExistingViews:function(){var a=this;return this.$images.find("img").each(function(b){a.photoViews.push(new IS.Views.DiscoverCategoryPhoto({el:this.parentNode,model:a.collection.at(b)}))}),this},rightArrowClicked:function(){this.render(!1).showVisibleImages(400);var a=parseInt(this.$images.css("left").replace(/px/i,"")),b=Math.ceil(this.$images.width()-Math.abs(a)-this.$wrapper.width()),c=b<=this.$wrapper.width()*this.leftRatio;this.$images.css({left:a-(c?b+100:this.$el.width()*this.leftRatio)+"px"}),c&&this.$wrapper.removeClass("right-arrow"),this.$wrapper.addClass("left-arrow");
},leftArrowClicked:function(){var a=parseInt(this.$images.css("left").replace(/px/i,""));a+=this.$el.width()*this.leftRatio,a>0&&(a=0),this.$images.css({left:a+"px"}),0==a&&this.$wrapper.removeClass("left-arrow"),this.$wrapper.addClass("right-arrow")},renderHeroAd:function(a){this.$(".hero-promo").html(IS.helpers.getAdHTML({code:IS.CONS.ADS["D"+a]}))},destroy:function(){_.each(this.photoViews,function(a){a.destroy()}),Backbone.View.prototype.destroy.call(this)}}),IS.Views.DiscoverCategoryPhoto=Backbone.View.extend({tagName:"a",events:{click:"clicked"},initialize:function(){this.template=IS.helpers.loadTemplate("discover_category_photo"),this.timeout=null,this.model.on("change:preloaded",this.preLoadImage,this)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,this.model.attributes)),this.$el.attr("href",IS.Models.Photo.landingURL(this.model.get("id"))),this},preLoadImage:function(){var a=this;IS.helpers.preloadImages([IS.helpers.getImagizerLink({server:this.model.get("server"),filename:this.model.get("filename"),width:this.model.get("hero")?285:260,height:this.model.get("hero")?280:260,cropped:!0})],function(){a.$("img").attr("src",this.src).removeClass("pending")})},clicked:function(){IS.et.pe("Discover","Click","Photo")}}),IS.Views.Featured=Backbone.View.extend({tagName:"section",id:"featured",initialize:function(){IS.vent.trigger("app_layout:content:max_width"),this.$template=IS.helpers.loadTemplate("featured"),this.userViews=[],this.condensedViews=[],this.timelineWidget=null,this.constants={RIGHT_WIDTH:310,GAP:30,USER_AREA:300,MIN_WIDTH:810,MAX_WIDTH:1060},IS.vent.on("app_layout:content:size:change",this.resize,this),this.options.bootstrapped&&this.setupElements().renderWidget().renderUsers().renderFollowList()},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,{})),this.setupElements().renderWidget().renderUsers().renderFollowList(),this},setupElements:function(){return this.$result=this.$("section.result"),this.$side=this.$("aside.more"),this.$bottom=this.$side.find(".bottom"),this},renderUsers:function(){return this.collection.each(function(a){var b=new IS.Views.Photographer({model:a});this.userViews.push(b),this.$result.append(b.render().el)}.bind(this)),this},renderFollowList:function(){for(var a=_.sample(this.collection.models,8),b=0;b<a.length;b++){var c=a[b],d=new IS.Views.PhotographerCondensed({model:c});this.condensedViews.push(d),this.$bottom.append(d.render().el)}return this},show:function(){return $(window).trigger("resize"),_.defer(function(){this.$el.addClass("visible")}.bind(this)),this},resize:function(a){a=_.extend({$el:this.$el,max:this.constants.MAX_WIDTH},a),IS.Views.Mixins.Header.resizeToGrid(a);var b;this.$el.width()<this.constants.MIN_WIDTH?(this.$el.addClass("no-side"),b=this.$el.width(),530>b?(this.$el.removeClass("mode2"),this.$el.addClass("mode1")):(this.$el.addClass("mode2"),this.$el.removeClass("mode1"))):(this.$el.removeClass("no-side mode2 mode1"),b=this.$el.width()-this.constants.RIGHT_WIDTH-this.constants.GAP),_.each(this.userViews,function(a){a.trigger("resize",b)}),this.$result.css("width",b)},renderWidget:function(){var a=this.collection.shuffle()[0];return this.timelineWidget=new IS.Views.TimelineWidget({username:a.get("username"),category:"Featured"}),this.$side.find(".widget-area").append(this.timelineWidget.render().el),this},destroy:function(){IS.vent.off("app_layout:content:size:change",this.resize,this),_.each(this.userViews,function(a){a.destroy()}),_.each(this.condensedViews,function(a){a.destroy()}),this.timelineWidget&&this.timelineWidget.destroy(),Backbone.View.prototype.destroy.call(this)}},{TITLE:"Featured Photographer",CLASS:"featured"}),IS.Views.Photographer=Backbone.View.extend({tagName:"article",className:"photog",initialize:function(){this.$template=IS.helpers.loadTemplate("photographer")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,{bio:this.model.get("bio"),username:this.model.get("username"),firstName:this.model.get("first_name"),lastName:this.model.get("last_name"),hasWebsite:!!this.model.get("website"),website:this.model.get("website"),publishDate:IS.helpers.getDateString(1e3*Number(this.model.get("pub_date")),!0),dateTime:IS.helpers.getDateTime(1e3*Number(this.model.get("pub_date"))),isFollowed:this.model.get("is_following"),followValue:this.model.get("is_following")?1:0,avatarURL:function(){var a=this.model.get("avatar");return IS.helpers.getImagizerLink({server:a.server,filename:a.filename,width:90,height:90,cropped:!0})}.bind(this),websiteClean:function(){return this.model.get("website").replace("http://","")}.bind(this),image1URL:function(){return this.getImageLink(0,552,346,!1)}.bind(this),image2URL:function(){return this.getImageLink(1,172,172,!0)}.bind(this),image3URL:function(){return this.getImageLink(2,172,172,!0)}.bind(this),image1LP:function(){return this.model.get("latest_images")[0].id}.bind(this),image2LP:function(){return this.model.get("latest_images")[1].id}.bind(this),image3LP:function(){return this.model.get("latest_images")[2].id}.bind(this),socialSites:function(){var a="",b=this.model.get("sites");if(b&&b.length)for(var c=0;c<b.length;c++){var d=b[c];a+=Mustache.render(IS.inlineTemplates.social_site,{profileURL:d.profile_url,siteName:d.site_name})}return a}.bind(this),hasLatestImages:function(){return!!this.model.get("latest_images").length}.bind(this)})),this.setupElements(),this},setupElements:function(){new IS.Views.FollowButton({el:this.$(".follow-button"),username:this.model.get("username")})},getImageLink:function(a,b,c,d){var e=this.model.get("latest_images")[a];return IS.helpers.getImagizerLink({server:e.server,filename:e.filename,width:b,height:c,cropped:d})}}),IS.Views.BrowserUpgrade=Backbone.View.extend({tagName:"div",className:"browser-upgrade",initialize:function(){return this.template=IS.helpers.loadTemplate("browser_upgrade"),IS.et.pe("Browser Upgrade","Show"),this},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{})),this}}),IS.Views.Contact=Backbone.View.extend({el:"#contact",events:{"click #submit-button":"verify","change #select-country":"checkState","keypress .phone":"allowNumerals"},initialize:function(){this.headerMainView=new IS.Views.HeaderMain,this.model=new IS.Models.Contact({contactType:this.options.contactType}),this.$("input").placeholder()},verify:function(a){a.preventDefault();var b={},c=this;$("input, option:selected, textarea",this.$el.find("#submit")).each(function(){var a=$(this),c=a.attr("name")?a.attr("name"):a.parents("select").attr("name"),d="checkbox"==this.type?a.is(":checked"):a.val(),e=""===d||"--"==d?null:d;"submit"!==this.type&&(b[c]=e)}),this.model.save(b,{directSend:!0,success:function(a,b){b?"api"==c.options.contactType?window.location="/contact/success?api_key="+b:window.location="/contact/success":IS.helpers.displayUserError("Please try Captcha again!")}}),this.model.validationError&&IS.helpers.displayUserError(this.model.validationError)},checkState:function(a){var b=$(a.target),c=this.$("#select-state"),d=c.find("option:selected"),e=d.clone();"US"!==b.val()?"00"!==d.val()&&(e.insertAfter(d),d.html("--").val("00"),"--"==e.val()?c.find('option[value="00"]:eq(1)').remove():c.find('option[value="00"]:eq(0)').remove()):"00"==d.val()&&(e.insertAfter(d),d.html("STATE / PROVINCE / REGION").val("--"),c.find('option[value="--"]:eq(1)').remove())},allowNumerals:function(a){var b=a.keyCode||a.which,c=[8,37,38,39,40,46],d=String.fromCharCode(b),e=/[0-9]|\./;e.test(d)||-1!=c.indexOf(b)||(a.returnValue=!1,a.preventDefault&&a.preventDefault())}}),IS.Views.CreditCardForm=Backbone.View.extend({tagName:"section",id:"credit-card-form",events:{"submit form.cc":"formSubmitted","click a.button-large-white":"close","change .states-dd select":"stateSelected","change .country-dd select":"countrySelected","focus select":"selectFocused","blur select":"selectBlurred"},initialize:function(){this.template=IS.helpers.loadTemplate("credit_card_form"),this.updateMode=!!this.model.get("transaction_id"),this.stateTabIndex=903},render:function(){this.$el.html(IS.helpers.renderTemplate(this.template,_.extend(this.model.toJSON(),{authToken:IS.currentUser.get("authToken"),user_id:IS.currentUser.get("userId"),user_email:IS.currentUser.get("email"),updateMode:this.updateMode,formAction:"https://secure.itransact.com/cgi-bin/rc/ord.cgi",prettyCost:parseFloat(this.model.get("cost")).toFixed(2),isRecurring:!!this.model.get("reps"),recipe:this.model.get("term").toLowerCase(),hasPaypal:!!this.model.get("paypal_id"),paypalInvoice:IS.currentUser?IS.currentUser.get("userId")+"-"+Math.round((new Date).getTime()/1e3):""}))),this.setupElements(),this.$("input").placeholder();var a=IS.inlineTemplates.option,b={value:"",name:"Select One"},c=Mustache.render(a,b);return _.each(IS.helpers.getStatesList(),function(b){c+=Mustache.render(a,{value:b.v,name:b.n})}),this.$stateDD.html(c),c=c=Mustache.render(a,b),_.each(IS.helpers.getCountryList(),function(b){c+=Mustache.render(a,{value:b.v,name:b.n})}),this.$countryDD.html(c),this},formSubmitted:function(a){var b="",c=this.$form.serialize().split("&");_.each(c,function(a){switch(a=a.split("="),a[0]){case"address":case"city":case"country":if(a[1]){if("country"==a[0])var c=a[1]}else b=IS.Views.Mixins.Messages.invalidAddress;break;case"zip":a[1]||(b=IS.Views.Mixins.Messages.invalidAddress);break;case"state":"USA"!=c||a[1]||(b=IS.Views.Mixins.Messages.invalidAddress);break;case"phone":a[1]||(b=IS.Views.Mixins.Messages.invalidPhoneNumber);break;case"cc_number":(!a[1]||isNaN(a[1]))&&(b=IS.Views.Mixins.Messages.invalidCCInfo);break;case"ccmo":(!a[1]||isNaN(a[1])||+a[1]<1||+a[1]>12)&&(b=IS.Views.Mixins.Messages.invalidExpMonth);break;case"ccyr":(!a[1]||isNaN(a[1])||+a[1]<(new Date).getFullYear())&&(b=IS.Views.Mixins.Messages.invalidExpYear);break;case"first":case"last":a[1]||(b=IS.Views.Mixins.Messages.invalidName)}}),""!=b?(this.trigger("fail:validation",b),a.preventDefault()):this.$saveButton.prop("disabled",!0).prop("value","PROCESSING...")},setupElements:function(){return this.$form=this.$("form.cc"),this.$stateDD=this.$(".states-dd select"),this.$countryDD=this.$(".country-dd select"),this.$stateInput=this.$("#cc-state"),this.$provinceInput=this.$("#cc-province"),this.$countryInput=this.$("#cc-country"),this.$saveButton=this.$("input.button-large-yellow"),this},validate:function(a){var b="",c=_.find(a,function(a){return"country"==a.name});return _.every(a,function(a){if(b)return!1;switch(a.name){case"address":case"city":case"country":a.value||(b=IS.Views.Mixins.Messages.invalidAddress);break;case"zip":a.value||(b=IS.Views.Mixins.Messages.invalidAddress);break;case"state":"USA"!=c.value||a.value||(b=IS.Views.Mixins.Messages.invalidAddress);break;case"phone":a.value||(b=IS.Views.Mixins.Messages.invalidPhoneNumber);break;case"cc_number":(!a.value||isNaN(a.value))&&(b=IS.Views.Mixins.Messages.invalidCCInfo);break;case"exp_month":(!a.value||isNaN(a.value)||+a.value<1||+a.value>12)&&(b=IS.Views.Mixins.Messages.invalidExpMonth);break;case"exp_year":(!a.value||isNaN(a.value)||+a.value<(new Date).getFullYear())&&(b=IS.Views.Mixins.Messages.invalidExpYear);break;case"first":case"last":a.value||(b=IS.Views.Mixins.Messages.invalidName)}return!0}),b?(this.trigger("fail:validation",b),!1):(this.$saveButton.addClass("disabled").html("PROCESSING..."),!0)},error:function(a){IS.et.pe(this.model.get("category")||"Credit Card Form","Fail","Credit Card Payment"),this.$saveButton.removeClass("disabled").html(this.updateMode?"SAVE":"CONFIRM PAYMENT"),this.trigger("error",a)},success:function(a){this.$saveButton.removeClass("disabled").html(this.updateMode?"SAVE":"CONFIRM PAYMENT"),a.result?(optimizely.push(["trackEvent","subscription"]),optimizely.push(["trackEvent","subscription",{revenue:100*this.model.get("cost")}]),IS.et.pe(this.model.get("category")||"Credit Card Form","Success","Credit Card Payment"),this.close(),this.trigger("success",a)):(IS.et.pe(this.model.get("category")||"Credit Card Form","Fail","Credit Card Payment"),this.trigger("error",a))},handleFormSubmission:function(){this.$saveButton.hasClass("disabled")||(IS.et.pe(this.model.get("category")||"Credit Card Form","Click","Confirm Payment"),this.$form.ajaxSubmit({dataType:"json",beforeSubmit:function(a){return this.validate(a)}.bind(this),error:function(a){this.error(a)}.bind(this),success:function(a){this.success(a)}.bind(this)}))},selectFocused:function(a){$("#cc-"+a.currentTarget.name).addClass("focused")},selectBlurred:function(a){$("#cc-"+a.currentTarget.name).removeClass("focused")},stateSelected:function(a){this.$stateInput.val(a.currentTarget.options[a.currentTarget.selectedIndex].innerHTML)},countrySelected:function(a){var b=a.currentTarget.options[a.currentTarget.selectedIndex];this.$countryInput.val(b.innerHTML),"USA"==b.value?(this.$stateDD.prop({tabIndex:this.stateTabIndex,name:"state"}).parent().show(),this.$stateInput.show(),this.$provinceInput.prop({tabIndex:-1,name:""}).hide()):(this.$stateDD.prop({tabIndex:-1,name:""}).parent().hide(),this.$stateInput.hide(),this.$provinceInput.prop({tabIndex:this.stateTabIndex,name:"state"}).show())},close:function(){this.trigger("close")}},{WIDTH:800}),IS.Views.Dropdown=Backbone.View.extend({el:".dropdown",events:{click:"clicked","click .selection .item":"itemClicked"},hideSelection:!1,initialize:function(a){a=a||{},this.hideSelection=a.hideSelection||!1,_.extend(this,IS.Views.Mixins.Dropdown),this.setupElements()}}),IS.Views.EmailPromo=Backbone.View.extend({el:"#email-promo",initialize:function(){new IS.Views.HeaderMain,this.$window=$(window),this.$window.on("resize",function(){this.adjustContentHeight()}.bind(this)),this.$content=this.$("> .content"),this.adjustContentHeight()},adjustContentHeight:function(){this.$content.css("height",Math.max(400,this.$window.height()-252))}}),IS.Views.FBAuthButton=Backbone.View.extend({el:".button-large-facebook",events:{click:"clicked"},initialize:function(){this.noRedirect=!!this.options.noRedirect,this.standAlone=!!this.options.standAlone,this.fetchAlbums=!!this.options.fetchAlbums},clicked:function(a){FB.getLoginStatus(function(a){"connected"===a.status?this.login():"not_authorized"===a.status?this.login():this.login()}.bind(this))},login:function(){var a=this;FB.login(function(b){b.authResponse&&FB.api("/me",function(c){IS.Models.User.facebookLogin(c.email,c.id,b.authResponse.accessToken,c.first_name,c.last_name,c.gender||"",c.username,!0,function(b){b.success&&(IS.et.pe("Login","Facebook","Success"),a.trigger("facebook_auth:success",b),a.noRedirect||(a.standAlone?window.location.reload():b.result&&b.result.new_account?window.location="/setup":window.location="/"))},a.fetchAlbums)})},{scope:"email"})}}),IS.Views.FeaturesOverlay=Backbone.View.extend({tagName:"section",id:"features-overlay",events:{"click .close-trigger":"close","click .upgrade-trigger":"upgrade"},initialize:function(){IS.et.pe("Features Overlay","Show","View"),this.$template=IS.helpers.loadTemplate("features_overlay")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,{verb:IS.currentUser?"UPGRADE":"SIGNUP"})),this},close:function(){IS.et.pe("Features Overlay","Click","Close"),this.trigger("close")},upgrade:function(){IS.et.pe("Features Overlay","Click",IS.currentUser?"Upgrade":"Signup"),window.top.location=IS.currentUser?"/upgrade":"/signup"}},{WIDTH:480}),IS.Views.FeedNoResults=Backbone.View.extend({tagName:"section",className:"no-results",initialize:function(a){a=a||{},this.template=IS.helpers.loadTemplate("feed_no_results"),this.type=a.type,this.headerText=a.headerText,this.bodyText=a.bodyText},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{})),this.setupElements(),this},setupElements:function(){return this.$regular=this.$("section.regular"),this.$myImages=this.$("section.my-images"),this},show:function(a){return a=a||{},this.$regular.hide(),this.$myImages.hide(),this.type==IS.Views.FeedNoResults.TYPES.MY_IMAGES&&IS.currentUser&&IS.currentUser.canUpload()?(this.$myImages.show(),IS.vent.trigger("header_main_mobile:show_upload_arrow")):this._showRegular(),this.$el.show(),this},_showRegular:function(){this.$regular.find("h1").html(this.headerText),this.$regular.find("p").html(this.bodyText),this.$regular.show()},hide:function(){this.$el.hide()}},{TYPES:{MY_IMAGES:1,REGULAR:2}}),IS.Views.FeedPhoto=Backbone.View.extend({tagName:"figure",className:"feed-photo",events:{"click img":"heroClicked","click .username":"usernameClicked"},initialize:function(){this.template=IS.helpers.loadTemplate("feed_photo")},setupElements:function(){},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{showOwner:!this.model.get("is_owner"),title:function(){var a;return a=this.model.get("title")?this.model.get("title"):this.model.get("original_filename"),IS.helpers.shortenText(a,32)}.bind(this),hero:function(){var a=320;return"tablet"==IS.helpers.getScreenType()&&(a=768),IS.helpers.getImagizerLink({server:this.model.get("server"),filename:this.model.get("filename"),width:a,cropped:!1},this.model.isGif())}.bind(this),owner:function(){var a=this.model.get("owner");return _.has(a,"username")?a.username:null}.bind(this)})),this},heroClicked:function(){IS.et.pe("Feed Photo","Click","Hero"),Backbone.history.navigate(this.model.landingURL(),!0)},usernameClicked:function(){IS.et.pe("Feed Photo","Click","Username");var a=this.model.get("owner");a.username&&Backbone.history.navigate("/user/"+a.username,!0)}}),IS.Views.Feedback=Backbone.View.extend({tagName:"div",className:"feedback-box",events:{"click .button":"send"},initialize:function(){this.template=IS.helpers.loadTemplate("feedback")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{})),this.$("textarea,input").placeholder(),this},send:function(a){a.stopPropagation();var b=$.trim(IS.helpers.stripHTML(this.$("textarea").val())),c=$.trim(IS.helpers.stripHTML(this.$("input").val()));b&&($.ajax({type:"POST",data:{text:b,email:c},url:"/contact/feedback"}),this.trigger("close"),IS.helpers.displayUserMessage("Thank you for your feedback.",300))}},{HEIGHT:445,WIDTH:640}),IS.Views.FileUploader=Backbone.View.extend({tagName:"section",id:"file-uploader",events:{"click .options .option":"uploadOptionClicked","change input.file":"filesSelected","click .dropdown":"stopBubble","click .control.select-text":"toggleTextSelection","focus textarea":"textareaFocused",click:"hideDropdowns","click .buttons .done":"close","click .buttons .link":"redirect","keyup input.trans":"inputKeyUp","click .tabs .tab.url > a":"submitTransload","click .arrow.left":"scrollLeft","click .arrow.right":"scrollRight","mouseenter .album-selector":"displayAlbumsList","mouseleave .album-selector":"hideAlbumsList","click .albums-list li":"albumSelected","click .move-albums-list li":"bottomAlbumSelected","click .add-new-album":"renderAlbumInput","click .cancel-upload":"cancelUpload","click .bottom-part .thumbnails a":"toggleSelectedThumb"},initialize:function(){this.$template=IS.helpers.loadTemplate("file_uploader"),this.$body=$("body"),this.minimizedView=null,this.files=new Backbone.Collection,this.queue=new Backbone.Collection,this.totalLoadSize=0,this.currentLoadSize=0,this.processedLoadSize=0,this.currentProcessedSize=0,this.xhrs=[],this.constants={IMG_WIDTH:70,IMG_MARGIN:12,THS_WIDTH:670},this.on({"drag:enter":this.dragEntered,"drag:leave":this.dragLeft,"drop:files":function(a){var b=this.isInProgress();this.pushFiles(a),b||this.processQueue()}.bind(this),"hide:dropdowns":this.hideDropdowns,"force:quit":this.vent},this),this.files.on("add",this.fileAdded,this),IS.vent.on("global_overlay:fade:in",this.destroyMinimizedView,this),IS.vent.once("body:keyup:escape",this.close,this)},render:function(){this.$el.html(IS.helpers.renderTemplate(this.$template,_.extend(this.model.toJSON(),{inActiveAlbum:!!IS.currentUser.get("activeAlbum"),otherClass:function(){return!IS.currentUser||IS.currentUser.get("freeAccount")?"prevent-click disabled":""},freeAccount:!(IS.currentUser&&!IS.currentUser.get("freeAccount"))}))),this.setupElements(),this.renderAlbums(),this.typeDropdown=new IS.Views.Dropdown({el:this.$top.find(".types .dropdown")}),this.typeDropdown.on("change",function(a){IS.et.pe("Uploader","Select",a.value.toUpperCase()),this.generateLinks()}.bind(this),this),this.sizeDropdown=new IS.Views.Dropdown({el:this.$top.find(".sizes .dropdown")}),this.sizeDropdown.on("change",function(a){IS.et.pe("Uploader","Select",a.value||"Fullsize"),this.generateLinks()}.bind(this),this),this.albumDropdown=new IS.Views.Dropdown({el:this.$(".top-part .options .albums .dropdown")}),this.bottomAlbumDropdown=new IS.Views.Dropdown({el:this.$(".bottom-part .options .albums .dropdown")}),this.resizeDropdown=new IS.Views.Dropdown({el:this.$(".options .resize .dropdown")}),this.resizeDropdown.on("change",function(a){IS.currentUser.setSetting("resize",a.value)},this);var a=IS.currentUser.get("activeAlbum");return a&&this.albumDropdown.setValue(a.get("album_title")||a.get("title"),a.get("id")),this.setDropdownValues(),this},setDropdownValues:function(){var a=IS.currentUser.get("settings");return this.resizeDropdown.setValue(a.resize?IS.CONS.SIZE_OPTIONS[a.resize]:"Do not resize",a.resize),this.typeDropdown.setValue(IS.CONS.LINK_OPTIONS[a.linkType],a.linkType),this.sizeDropdown.setValue(a.linkSize?IS.CONS.SIZE_OPTIONS[a.linkSize]:"Fullsize",a.linkSize),this},setupElements:function(){this.$uploadOptions=this.$(".options"),this.$tabs=this.$(".tabs"),this.$progressStatus=this.$tabs.find(".progress-text .status"),this.$progressSize=this.$tabs.find(".uploaded-size"),this.$progressBar=this.$tabs.find(".progress-bar span"),this.$bottom=this.$(".bottom-part"),this.$top=this.$(".top-part"),this.$resultLinks=this.$top.find(".result-links"),this.$textarea=this.$resultLinks.find("textarea"),this.$thumbsWrapper=this.$bottom.find(".thumbnails .wrapper"),this.$resultImages=this.$thumbsWrapper.find("figure"),this.$leftArrow=this.$bottom.find(".arrow.left"),this.$rightArrow=this.$bottom.find(".arrow.right"),this.$albums=this.$(".albums-list ul"),this.$bottomAlbums=this.$bottom.find(".move-albums-list ul"),this.$urlInput=this.$("input.trans"),this.setupAlbumsInfiniteScroll(),this.$urlInput.placeholder();var a=_.throttle(function(){this.toggleArrows()}.bind(this),100);return this.$thumbsWrapper.on("scroll",a),this},uploadOptionClicked:function(a){var b=$(a.currentTarget),c=b.data("tab");b.hasClass("active")||(b.addClass("active").siblings(".option").removeClass("active"),"url"==c||this.$progressStatus.text()?this.$tabs.removeClass("inactive regular url").addClass(c):this.$tabs.addClass("inactive").removeClass("regular url"),"url"==c&&this.$urlInput.focus())},dragEntered:function(){this.$tabs.addClass("dragged")},dragLeft:function(){this.$tabs.removeClass("dragged")},pushFiles:function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];IS.et.pe("Uploader","File Type",d.type.toLowerCase()),IS.CONS.UPLOADER.ACCEPTED_TYPES[d.type.toLowerCase()]?d.size>IS.CONS.UPLOADER.SIZE_LIMITS.pro?(IS.et.pe("Uploader","Error","File size is too big"),IS.et.pe("Uploader","Failed File Size",IS.helpers.getPrettyFileSize(d.size,0)),IS.vent.trigger("global_overlay:display:error",IS.Views.Mixins.Messages.uploaderFileTooBig)):(this.queue.add(new Backbone.Model({content:d,size:d.size,size_string:IS.helpers.getPrettyFileSize(d.size),name:d.name,type:d.type,uploaded:!1,processed:!1,loaded:0})),b+=d.size):(IS.vent.trigger("global_overlay:display:error",IS.Views.Mixins.Messages.uploaderUnsupportedFile),IS.logger.error("Uploader failed file.type check",{username:IS.currentUser.get("username"),fileType:d.type}))}return this.currentLoadSize+=b,this.totalLoadSize+=b,this},processQueue:function(){var a=this.getNextFileInQueue();return a&&this.upload(a),this},getNextFileInQueue:function(){return this.queue.find(function(a){return!a.get("uploaded")})},getUploadedCount:function(){return this.queue.filter(function(a){return a.get("uploaded")}).length},queueIsProcessed:function(){return!this.queue.length||this.queue.every(function(a){return a.get("processed")})},performPostUploadChecks:function(a){return this.queueIsProcessed()?(a.set("uploaded",!0),this.processedLoadSize=this.totalLoadSize,this.currentProcessedSize=this.currentLoadSize,this.updateProgressView(),this.currentLoadSize=0,this.currentProcessedSize=0):(this.updateProgressView(),a.get("uploaded")||(a.set("uploaded",!0),this.processQueue())),this},updateProgressView:function(){if(0==this.currentLoadSize)return this;var a=Math.min(100,Math.round(this.currentProcessedSize/this.currentLoadSize*100));return this.$progressBar.css("width",a+"%"),this.$progressStatus.html(Mustache.render(IS.inlineTemplates.file_uploader_progress_status,{count:this.getUploadedCount(),total:this.queue.length,progress:a,noun:1==this.queue.length?"image":"images"})),IS.vent.trigger("uploader:progress",{count:this.getUploadedCount(),total:this.queue.length,progress:a}),this.$progressSize.html(Mustache.render(IS.inlineTemplates.file_uploader_progress_size,{loaded:IS.helpers.getPrettyFileSize(this.processedLoadSize),total:IS.helpers.getPrettyFileSize(this.totalLoadSize)})),this},filesSelected:function(a){if(IS.et.pe("Uploader","Select","Input Files"),a.currentTarget.value){var b=this.isInProgress();this.pushFiles(a.originalEvent.target.files),b||this.processQueue(),a.currentTarget.value=""}},hideDropdowns:function(){this.$(".dropdown").removeClass("active")},fileAdded:function(a){this.generateLinks(),this.$resultImages.css("width",this.files.length*(this.constants.IMG_WIDTH+this.constants.IMG_MARGIN)-this.constants.IMG_MARGIN).append(Mustache.render(IS.inlineTemplates.file_uploader_img,{id:a.get("id"),index:this.files.length-1,imageURL:IS.helpers.getImagizerLink({width:this.constants.IMG_WIDTH,height:this.constants.IMG_WIDTH,server:a.get("server"),filename:a.get("filename"),cropped:!0})})),this.toggleArrows(),this.model.get("expanded")||(this.model.set("expanded",!0),this.$el.addClass("expanded"),this.$bottom.addClass("visible")),this.$textarea.stop().animate({scrollTop:18*Math.max(0,this.files.length-1)},1e3)},toggleArrows:function(){var a=this.$resultImages.width();this.constants.THS_WIDTH>=a?this.$leftArrow.add(this.$rightArrow).addClass("disabled"):(0==this.$thumbsWrapper.scrollLeft()?this.$leftArrow.addClass("disabled"):this.$leftArrow.removeClass("disabled"),this.$thumbsWrapper.scrollLeft()==a-this.constants.THS_WIDTH?this.$rightArrow.addClass("disabled"):this.$rightArrow.removeClass("disabled"))},scrollLeft:function(a){IS.et.pe("Uploader","Click","Left Arrow"),a.currentTarget.className.indexOf("disabled")>=0||IS.helpers.animateScrollLeft(this.$thumbsWrapper,Math.max(0,this.$thumbsWrapper.scrollLeft()-Math.round(.9*this.constants.THS_WIDTH)))},scrollRight:function(a){if(IS.et.pe("Uploader","Click","Right Arrow"),!(a.currentTarget.className.indexOf("disabled")>=0)){var b=this.$resultImages.width()-this.constants.THS_WIDTH;IS.helpers.animateScrollLeft(this.$thumbsWrapper,Math.min(b,this.$thumbsWrapper.scrollLeft()+Math.round(.9*this.constants.THS_WIDTH)))}},generateLinks:function(){var a="",b=this.typeDropdown.getValue(),c=(this.sizeDropdown.getValue()||"").split("x");IS.currentUser.setSetting("linkType",this.typeDropdown.getValue()).setSetting("linkSize",this.sizeDropdown.getValue()),this.files.each(function(d){a+=IS.inlineTemplates[b]({id:d.get("id"),server:d.get("server"),filename:d.get("filename"),bucket:d.get("bucket"),width:c[0]||null,height:c[1]||null,cropped:!!c[2]})+"\n"}),this.$textarea.val(a&&a.slice(0,-1))},toggleTextSelection:function(a){var b=$(a.currentTarget);b.hasClass("all")?(IS.et.pe("Uploader","Click","Select All"),this.$textarea.select(),b.find("h3").text("UNSELECT ALL")):(IS.et.pe("Uploader","Click","Deselect All"),document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),b.find("h3").text("SELECT ALL")),b.toggleClass("all none")},inputKeyUp:function(a){IS.helpers.isEnterKey(a.keyCode)&&this.submitTransload()},submitTransload:function(){this.$urlInput.prop("disabled",!0);var a=this.$urlInput.val(),b=this.albumDropdown.getValue(),c=this.resizeDropdown.getValue();if(!a)return this;var d=new Backbone.Model({urls:[a],min_model:!0},{url:IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES});return b&&d.set("album",b),c&&d.set("resize",c),IS.et.pe("Uploader","Submit","Transload"),d.save(null,{success:function(a,b){this.$urlInput.prop("disabled",!1).val("").focus(),b&&b.result&&b.result.images&&(IS.et.pe("Uploader","Upload","Transload"),this.addFiles(b.result.images)),this.files.length&&IS.cm.invalidateByCacheKey("my_images")}.bind(this),error:function(){IS.vent.trigger("global_overlay:display:error",IS.Views.Mixins.Messages.uploaderFailed),this.$urlInput.prop("disabled",!1).focus().select()}.bind(this)}),this},displayAlbumsList:function(a){var b=$(a.currentTarget);b.addClass("visible")},hideAlbumsList:function(a){var b=$(a.currentTarget);b.removeClass("visible")},renderAlbums:function(){IS.currentUser.get("albums").each(function(a){this.renderAlbum(a),this.renderBottomAlbum(a)}.bind(this))},renderAlbum:function(a){this.$albums.append(this.getAlbumHTML(a))},renderBottomAlbum:function(a){this.$bottomAlbums.append(this.getAlbumHTML(a))},getAlbumHTML:function(a){return Mustache.render(IS.inlineTemplates.uploader_album_li,{id:a.get("id"),name:a.get("album_title")||a.get("title")||"Untitled"})},albumSelected:function(a){IS.et.pe("Uploader","Click","Album");var b=$(a.currentTarget);this.albumDropdown.setValue(b.html(),b.data("value"))},bottomAlbumSelected:function(a){IS.et.pe("Uploader","Click","Move Album");var b=$(a.currentTarget);this.bottomAlbumDropdown.setValue(b.html(),b.data("value")),this.moveSelectedToAlbum()},moveSelectedToAlbum:function(){var a=this.files.filter(function(a){return a.get("selected")}),b=a.map(function(a){return a.get("id")}),c=this.bottomAlbumDropdown.getValue();if(!c||this.$bottom.hasClass("processing"))return this;if(_.isEmpty(b))return IS.vent.trigger("global_overlay:display:error",IS.Views.Mixins.Messages.selectImages),this;this.$bottom.addClass("processing");var d=$.ajax({url:IS.CONS.API_BASE+"/albums/"+c+"/add_files",type:"PUT",data:{files:b,auth_token:IS.currentUser.get("authToken")}});return $.when(d).always(function(c){this.$bottom.removeClass("processing"),c.success?(IS.vent.trigger("global_overlay:display:success",Mustache.render(IS.inlineTemplates.moved_to_album,{count:b.length,noun:1==b.length?"image":"images"})),_.each(a,function(a){a.set("selected",!1)}),this.$bottom.find(".thumbnails .selected").removeClass("selected")):IS.vent.trigger("global_overlay:display:error",IS.Views.Mixins.Messages.processFailed)}.bind(this)),this},addFiles:function(a){_.each(a,function(a){this.files.add(new Backbone.Model(a))}.bind(this))},setupAlbumsInfiniteScroll:function(){var a=new IS.Collections.MyAlbums({},{limit:100,image_limit:0}),b=function(){a.isFetching||a.nextPage({success:function(a,b){b.areMorePages||IS.helpers.removeInfiniteScroll({$target:this.$albums}),a.result&&a.result.albums&&_.each(a.result.albums,function(a){this.renderAlbum(new Backbone.Model(a))}.bind(this))}.bind(this)})}.bind(this);IS.helpers.infiniteScroll({$target:this.$albums,$reference:this.$albums,threshold:200,callback:b})},renderAlbumInput:function(a){var b=$(a.currentTarget),c=b.hasClass("moving")?this.$bottomAlbums:this.$albums,d=c.siblings("input");return d.length?void d.focus():(d=$(Mustache.render(IS.inlineTemplates.uploader_album_input,{})),d.insertBefore(c).focus().placeholder(),void this.assignAlbumInputListener(d))},assignAlbumInputListener:function(a){a.on("keyup",function(b){IS.helpers.isEnterKey(b.keyCode)&&this.addNewAlbum(a)}.bind(this))},addNewAlbum:function(a){var b=a.val();b&&(a.attr("readonly","true"),new IS.Models.Album({server:1,title:b}).save(null,{success:function(b,c){c&&c.success&&c.result&&(IS.et.pe("Uploader","Add","New Album"),
b.set({id:c.result.id,album_title:c.result.title,title:c.result.title,album_title_short:IS.helpers.shortenText(c.result.title,15),is_private:!c.result["public"]&&!c.result.password_protected,is_private_password:c.result.password_protected}),this.$albums.add(this.$bottomAlbums).prepend(this.getAlbumHTML(b)),IS.currentUser.get("albums").add(b),IS.vent.trigger("app_layout:navbar:add_album_link",{album:b,updateSelectedItem:!1}),IS.cm.invalidateByCacheKey("my_albums")),a.off("keyup").remove()}.bind(this)}))},resetQueue:function(){_.each(this.xhrs,function(a){a&&"abort"in a&&a.abort()}),this.queue=new Backbone.Collection},upload:function(a){IS.et.pe("Uploader","Submit","Modern XHR2");var b=new FormData,c=this.albumDropdown.getValue(),d=this.resizeDropdown.getValue(),e=new XMLHttpRequest;return this.$uploadOptions.find(".url").removeClass("active").end().find(".browse").addClass("active"),this.$tabs.removeClass("inactive url").addClass("regular"),this.updateProgressView(),c&&b.append("album",c),d&&b.append("resize",d),IS.et.pe("Uploader","Resize",d||"Fullsize"),b.append("auth_token",IS.currentUser.get("authToken")),b.append("min_model",!0),b.append("api_key",IS.CONS.API_KEY),b.append("file",a.get("content")),e.onload=function(){if(200===e.status)try{var b=$.parseJSON(e.responseText);if(!b||!b.result||!_.isArray(b.result.images))throw IS.et.pe("Uploader","Error",'"images" property is null or an empty array'),IS.et.pe("Uploader","Error - XHR1",e.responseText),"Something went wrong on back end, 'images' property of the response is null";IS.et.pe("Uploader","Upload","Success Modern XHR2"),this.addFiles(b.result.images),a.set("processed",!0),this.performPostUploadChecks(a),this.files.length&&(IS.cm.invalidateByCacheKey("my_images"),c&&IS.cm.invalidateByCacheKey("my_albums"))}catch(d){a.set("processed",!0),this.performPostUploadChecks(a),IS.logger.error("Uploader XHR exception ",d),IS.et.pe("Uploader","Error",d),IS.et.pe("Uploader","Error - XHR2",e.responseText),IS.vent.trigger("global_overlay:display:error",IS.Views.Mixins.Messages.uploaderFailed)}else a.set("processed",!0),this.performPostUploadChecks(a),IS.logger.error("Uploader XHR failed ",JSON.stringify(e||{})),IS.et.pe("Uploader","Error - XHR3",e?e.responseText:"Null XHR object"),IS.et.pe("Uploader","Error",JSON.stringify(e||{})),IS.vent.trigger("global_overlay:display:error",IS.Views.Mixins.Messages.uploaderFailed)}.bind(this),e.upload.onprogress=function(b){if(b.lengthComputable){var c,d=b.loaded/b.total*100|0;d>=98?(c=b.total-b.loaded,this.processedLoadSize+=c,this.currentProcessedSize+=c,a.set("loaded",a.get("size")),a.get("uploaded")||(a.set({uploaded:!0,processed:!0}),this.processQueue())):(c=b.loaded-a.get("loaded"),this.processedLoadSize+=c,this.currentProcessedSize+=c,a.set("loaded",b.loaded)),this.processedLoadSize=Math.min(this.processedLoadSize,this.totalLoadSize),this.currentProcessedSize=Math.min(this.currentProcessedSize,this.currentLoadSize),this.updateProgressView()}}.bind(this),e.open("POST",IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES),e.send(b),a.set("uploading",!0),this.xhrs.push(e),this},stopBubble:function(a){a.stopPropagation()},textareaFocused:function(a){IS.et.pe("Uploader","Click","Links Box"),a.currentTarget.select()},close:function(){this.triggerClose()},minimize:function(){IS.vent.trigger("global_overlay:fade:out");var a=Math.min(100,Math.round(this.currentProcessedSize/this.currentLoadSize*100));this.minimizedView=new IS.Views.MinimizedUploader({model:new Backbone.Model({count:this.getUploadedCount(),total:this.queue.length,progress:a})}),this.$body.append(this.minimizedView.render().el),_.defer(function(){this.minimizedView.show()}.bind(this)),this.minimizedView.once("closed",function(){IS.vent.trigger("global_overlay:fade:in")}.bind(this),this)},isInProgress:function(){return this.processedLoadSize<this.totalLoadSize&&0!==this.processedLoadSize},triggerClose:function(){this.cancelUpload(!0);var a=null;return this.files.first()&&(a=this.files.first().get("id")),this.trigger("closed",{firstImageId:a}),this},redirect:function(a){return a.preventDefault(),IS.currentUser.get("activeAlbum")||"/my/images"==window.location.pathname?void this.vent():(window.mainRouter?Backbone.history.navigate("/my/images",!0):window.top.location="/my/images",void this.triggerClose())},vent:function(){return IS.vent.trigger("uploader:closed",{count:this.files.length,photos:this.files.models}),this.triggerClose(),this},setResizeToFull:function(){return this.resizeDropdown.setValue("Do not resize",""),this},destroyMinimizedView:function(){this.minimizedView&&this.minimizedView.destroy(),this.minimizedView=null},cancelUpload:function(a){a="boolean"==typeof a&&a;var b=this.queue.filter(function(a){return!a.get("processed")&&!a.get("uploading")});this.queue.remove(b),_.each(this.xhrs,function(a){a&&"abort"in a&&1!=a.readyState&&a.abort()}),a||IS.vent.trigger("global_overlay:display:success",IS.Views.Mixins.Messages.uploadCanceled)},toggleSelectedThumb:function(a){a.preventDefault();var b=$(a.currentTarget),c=+b.data("index"),d=this.files.at(c);b.toggleClass("selected"),d.set("selected",!d.get("selected"))},destroy:function(){this.off(null,null,this),this.$thumbsWrapper.off("scroll"),IS.vent.off("global_overlay:fade:in",this.destroyMinimizedView,this),_.each(this.xhrs,function(a){a&&"abort"in a&&a.abort()}),this.xhrs=null,window.fileUploader=null,Backbone.View.prototype.destroy.call(this)}},{WIDTH:750,HEIGHT:586}),IS.Views.FollowButton=Backbone.View.extend({events:{click:"clicked"},initialize:function(a){this.ventEnabled=!!a.ventEnabled,this.category=a.category||"Follow Button",this.model=new Backbone.Model({following:+this.$el.data("following")},{url:IS.CONS.API_BASE+IS.CONS.APIS.FOLLOW.FOLLOWS+"/"+a.username})},clicked:function(a,b){return IS.currentUser?(this.model.once("sync",function(){b?window.location.reload():this.ventEnabled&&IS.vent.trigger("user:"+(this.model.get("following")?"follow":"unfollow"),new Backbone.Model({avatar:{id:IS.currentUser.get("userId"),server:IS.currentUser.get("avatarServer"),filename:IS.currentUser.get("avatarFilename")},is_following:!1,username:IS.currentUser.get("username"),location:IS.currentUser.get("location"),target_username:this.options.username}))},this).once("error",function(a,b){b=b.responseJSON,this.$el.toggleClass("on"),this.model.set("following",this.model.get("following")?0:1),IS.helpers.displayUserError(b.error&&3===b.error.error_code?b.error.error_message:IS.Views.Mixins.Messages.processFailed)},this),void(this.model.get("following")?(IS.et.pe(this.category,"Click","Unfollow"),this.model.set({following:0,id:1}).destroy()):(IS.et.pe(this.category,"Click","Follow"),this.model.clear({silent:!0}).set("following",1).save()))):void IS.helpers.showLoginSignupOverlay(function(){this.clicked({},!0)}.bind(this),null)}}),IS.Views.FollowButtonMobile=Backbone.View.extend({events:{click:"clicked"},initialize:function(a){this.model=new Backbone.Model({following:+this.$el.data("following")},{url:IS.CONS.API_BASE+IS.CONS.APIS.FOLLOW.FOLLOWS+"/"+a.username}),IS.currentUser?this.model.get("following")?this.showUnfollow():this.model.get("following")||this.showFollow():this.showLogin()},clicked:function(){return IS.currentUser?void(this.model.get("following")?(IS.et.pe("Follow Button Mobile","Click","Unfollow"),this.model.set({following:0,id:1}).destroy(),this.showFollow()):(IS.et.pe("Follow Button Mobile","Click","Follow"),this.model.clear({silent:!0}).set("following",1).save(),this.showUnfollow())):void(window.location="/login?r="+window.location.pathname)},showLogin:function(){this.hideAll(),this.$("span.login").show()},showFollow:function(){this.hideAll(),this.$("span.follow").show()},showUnfollow:function(){this.hideAll(),this.$("span.unfollow").show()},hideAll:function(){this.$("> span").hide()}}),IS.Views.FollowParent=Backbone.View.extend({tagName:"section",className:"follow-parent faded",initialize:function(){IS.vent.trigger("app_layout:content:max_width"),_.extend(this,IS.Views.Mixins.Header),_.extend(this,IS.Views.Mixins.UserProfile),this.columnSpace=35,this.maxWidth=1350,this.$template=IS.helpers.loadTemplate("follow_parent"),this.setupElements(),this.peopleViews=[],this.collection||(this.bootstrapped=!0,this.collection=new IS.Collections.FollowingFollowers($.parseJSON(this.options.users),{limit:IS.CONS.FOLLOW_FETCH_COUNT,useEndOffset:!0,endOffset:this.options.endOffset,username:this.options.username,useFollowing:this.options.useFollowing}),this.$(".person").each(function(a,b){var c=new IS.Views.FollowPerson({el:b,model:this.collection.at(a)});c.initFollowButton(),this.peopleViews.push(c)}.bind(this))),this.collection.on("request",this.showLoading,this),this.collection.on("sync",this.synced,this),this.collection.on("add",this.added,this),IS.vent.on("app_layout:content:size:change",this.resize,this),this.bootstrapped&&(this.options.endOffset?this.setupInfiniteScroll():this.collection.length||this.showNoResults()),this.options.useFollowing||IS.vent.on({"user:follow":function(a){this.collection.add(a)}.bind(this),"user:unfollow":this.removePersonView},this),_.defer(function(){$(window).resize()}.bind(this)),_.delay(function(){this.$el.removeClass("faded")}.bind(this),250)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,{})),this},resize:function(a){a=_.extend(a,{$el:this.$wrapper,max:this.maxWidth});var b=this.resizeToGrid(a),c=Math.round((b-this.columnSpace)/2);this.$columns.css("width",c),_.each(this.peopleViews,function(a){a.trigger("resize",c)})},setupElements:function(){return this.$wrapper=this.$("> .wrapper"),this.$columns=this.$(".column"),this.$loading=this.$(".loading"),this.$gridNoResults=$(".grid-no-results"),this},setupInfiniteScroll:function(){IS.helpers.infiniteScroll({$target:this.$el.parent().parent(),$reference:this.$el,callback:function(){this.collection.hasNextPage()?this.collection.nextPage():IS.helpers.removeInfiniteScroll({$target:this.$el.parent().parent()})}.bind(this)})},showLoading:function(){this.$loading.addClass("active")},hideLoading:function(){this.$loading.removeClass("active")},synced:function(){this.hideLoading(),this.collection.hasNextPage()||this.showEndOfFeed()},showEndOfFeed:function(){this.$loading.html("ALL USERS LOADED.").addClass("active")},showNoResults:function(){this.$el.hide(),this.options.useFollowing?this.showProfileNoResults({type:"FOLLOWING"}):this.showProfileNoResults({type:"FOLLOWERS"})},added:function(a){this.peopleViews.length||this.hideLoading();var b=new IS.Views.FollowPerson({model:a}),c=this.$columns.eq(0).find("> .person").length,d=this.$columns.eq(1).find("> .person").length;this.$columns.eq(d>=c?0:1).append(b.render().el),this.peopleViews.push(b),_.defer(function(){$(window).resize()}.bind(this))},removePersonView:function(a){_.each(this.peopleViews,function(b,c){b.model.get("username")==a.get("username")&&(b.destroy(),this.peopleViews.splice(c,1))}.bind(this)),this.collection.remove(this.collection.find(function(b){return b.get("username")==a.get("username")}),{silent:!0}),this.peopleViews.length||this.showNoResults()},renderInitialSet:function(){return _.each(this.collection.models,function(a){this.added(a)}.bind(this)),$(window).resize(),this},destroy:function(){IS.helpers.removeInfiniteScroll({$target:this.$el.parent().parent()}),_.each(this.peopleViews,function(a){a.destroy()}),Backbone.View.prototype.destroy.call(this)}}),IS.Views.FollowPerson=Backbone.View.extend({tagName:"article",className:"clearfix person",initialize:function(){this.$template=IS.helpers.loadTemplate("follow_person"),this.followButtonView=null,this.thresholds=[400,550],this.on("resize",this.resized,this)},render:function(){var a=this;return this.$el.html(IS.helpers.renderTemplate(this.$template,_.extend(this.model.attributes,{hasAvatar:function(){return!(!a.model.get("avatar")||!a.model.get("avatar").id)},isFollowed:function(){return a.model.get("is_following")},disableFollowButton:function(){return!a.model.get("following_allowed")||IS.currentUser&&IS.currentUser.get("username")==a.model.get("username")},followValue:function(){return a.model.get("is_following")?1:0},hasLatestImages:function(){return a.model.get("latest_images")&&a.model.get("latest_images").length},infoAreaClass:function(){var b=this.disableFollowButton(),c=!a.model.get("location");return b&&c?"none":c?"no-location":b?"no-follow":""},showPremiumBadge:function(){return"premium"==a.model.get("membership")},avatarUrl:function(){var b;return b=this.hasAvatar()?IS.helpers.getAvatarLink(70,a.model.get("avatar")):IS.Models.User.getDefaultAvatar(70)}}))),_.each(this.model.get("latest_images"),function(a){this.$(".images").append(new IS.Views.FollowPersonImage({model:new Backbone.Model(a)}).render().el)}.bind(this)),this.initFollowButton(),this},initFollowButton:function(){this.followButtonView=new IS.Views.FollowButton({el:this.$(".follow-button"),username:this.model.get("username")})},destroy:function(){this.followButtonView&&this.followButtonView.destroy(),Backbone.View.prototype.destroy.call(this)},resized:function(a){var b=this.$(".images > a"),c=this.$(".location");b.length&&(a<this.thresholds[0]?(b.hide(),c.addClass("trimmed")):a<this.thresholds[1]?(b.eq(-1).hide(),b.eq(-2).show(),b.eq(-3).show(),c.removeClass("trimmed")):(b.show(),c.removeClass("trimmed")))}}),IS.Views.FollowPersonImage=Backbone.View.extend({tagName:"a",initialize:function(){this.$template=IS.helpers.loadTemplate("follow_person_image")},render:function(){var a=this;return this.$el.html(IS.helpers.renderTemplate(this.$template,_.extend(this.model.attributes,{imageUrl:function(){return IS.helpers.getImagizerLink({server:a.model.get("server"),filename:a.model.get("filename"),width:70,height:70,cropped:!0})}}))),this.$el.attr("href",IS.Models.Photo.landingURL(this.model.get("id"))),this}}),IS.Views.FreeLanding=Backbone.View.extend({el:"#free-lp",events:{"click .track-click":"trackClick","click input.gsc-input":"trackGSCInput","click input.gsc-search-button":"trackGSCButton"},initialize:function(){IS.et.pp("/free_landingpage"),new IS.Views.HeaderMain,this.$window=$(window),this.resizeTimeout=null;var a=!!IS.currentUser,b=this.model.get("server")?IS.helpers.isNewServer(this.model.get("server")):!1;IS.et.pe("Free Landing Page",a?"Logged In":"Logged Out",b?"New Image":"Old Image"),IS.et.pe("Free Landing Page","View",a?"Logged In":"Logged Out"),this.assignResizeListener(),this.$window.trigger("resize")},trackClick:function(a){var b=$(a.currentTarget);IS.et.pe("Free Landing Page","Click",b.data("label"))},trackGSCInput:function(){IS.et.pe("Free Landing Page","Click","Custom Search Input")},trackGSCButton:function(){IS.et.pe("Free Landing Page","Click","Custom Search Button")},assignResizeListener:function(){this.$window.width()<1245||this.$window.on("resize",function(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.$el.css("margin-left",(this.$window.width()-1200-315)/2),this.$(".promo-footer").css({left:Math.max(0,(this.$window.width()-728-315)/2),"margin-left":"0px"})}.bind(this),150)}.bind(this))}}),IS.Views.GaugeChart=Backbone.View.extend({tagName:"div",className:"gauge-chart",initialize:function(){this.template=IS.helpers.loadTemplate("gauge_chart"),this.animationSpeed=350,this.value=0},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,this.model.attributes)),this.setupElements(),this},update:function(a){var b=180*a/100,c=this.value,d=setInterval(function(){a>c?this.$speedValue.html(++c+"%"):c>a?this.$speedValue.html(--c+"%"):(this.value=a,clearInterval(d))}.bind(this),Math.floor(this.animationSpeed/Math.abs(this.value-a)));IS.helpers.applyCSS(this.$arrow,"transform","rotate("+b+"deg)")},setupElements:function(){return this.$arrow=this.$(".arrow"),this.$speedValue=this.$(".value"),this}}),IS.Views.GEOAutoComplete=Backbone.View.extend({events:{"click .ac-results li":"clicked","mouseenter .ac-results li":"mouseEntered","mouseleave .ac-results li":"mouseLeft"},initialize:function(){this.$input=this.$("input.geo"),this.maxCount=this.options.maxCount||6,this.value="",this.assignListeners()},render:function(a){return this.$list=this.$("ul.ac-results"),this.$list.length||(this.$el.append($('<ul class="ac-results"></ul>')),this.$list=this.$("ul.ac-results")),this.$list.empty(),_.each(a,function(a){this.$list.append(Mustache.render(IS.inlineTemplates.auto_complete_location,{latitude:a.latitude,longitude:a.longitude,city:a.city&&a.city.replace("\\N",""),region:a.region&&a.region.replace("\\N",""),country:a.country&&a.country.replace("\\N","")}))},this),IS.vent.on("body:clicked",this.saveValue,this),IS.vent.on("body:clicked",this.emptyList,this),this},assignListeners:function(){var a=this,b=_.debounce(function(b){if(!(IS.helpers.isUpArrowKey(b.keyCode)||IS.helpers.isDownArrowKey(b.keyCode)||IS.helpers.isEnterKey(b.keyCode))){var c=$(b.currentTarget),d=$.trim(c.val());if(!d||d.length<2)return void a.emptyList();a.$el.addClass("ac-loading"),a.lookUp({name:d.toLowerCase().replace(/,/g,"")}).then(function(b){b&&b.success&&b.result&&b.result.length?a.render(b.result.splice(0,a.maxCount)):a.emptyList()}).always(function(){a.$el.removeClass("ac-loading")})}},250);this.$input.on("keyup focus",b).on("keyup",function(a){this.handleSpecialKeys(a)}.bind(this)).on("click",function(a){a.stopPropagation()})},lookUp:function(a){return $.ajax({url:IS.Views.GEOAutoComplete.API,type:"GET",data:a,dataType:"jsonp"})},emptyList:function(){this.$("ul.ac-results").remove(),IS.vent.off("body:clicked",this.emptyList,this)},saveValue:function(){this.value=this.$input.val(),this.trigger("change",{value:this.value})},getValue:function(){return this.value},clicked:function(a){a.stopPropagation();var b=$(a.currentTarget);this.value=b.text(),this.trigger("change",{value:this.value}),this.emptyList(),IS.et.pe("Location AC","Select","Location")},destroy:function(){this.$input.off("click keyup focus",null,this),Backbone.View.prototype.destroy.call(this)},mouseEntered:function(a){$(a.currentTarget).addClass("active")},mouseLeft:function(a){$(a.currentTarget).removeClass("active")},handleSpecialKeys:function(a){var b=a.keyCode,c=this.$("li.active");if(IS.helpers.isEnterKey(b)&&c.length)c.click();else if(IS.helpers.isUpArrowKey(b))if(c.length){var d=c.prev();d.length&&c.add(d).toggleClass("active")}else this.$(".ac-results li:last-child").addClass("active");else if(IS.helpers.isDownArrowKey(b))if(c.length){var e=c.next();e.length&&c.add(e).toggleClass("active")}else this.$(".ac-results li:first-child").addClass("active")}},{API:"//api.yfrog.com/rest/v1/location/find_cities"}),IS.Views.GlobalConfirm=Backbone.View.extend({tagName:"section",className:"global-confirm-box",events:{"click .buttons a.cancel":"canceled","click .buttons a.confirm":"confirmed"},initialize:function(a){this.$template=IS.helpers.loadTemplate("global_confirm"),this.centered=a.centered},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,_.extend({hasSubMessage:!!this.model.get("sub_message")},this.model.attributes))),this.centered&&this.$el.addClass("centered"),this},canceled:function(){this.trigger("action:cancel")},confirmed:function(){this.trigger("action:confirm")}},{WIDTH:530}),IS.Views.GlobalLoginSignup=Backbone.View.extend({tagName:"section",className:"global-login-signup-box",events:{"click .initial-step .log-in":"showLogin","click .login-box .log-in":"login","click .reset-login-box":"resetLogin","keyup .enter-key":"submitOnEnterKey"},initialize:function(){this.signupExtraData=this.options.signupExtraData||function(){return{}},this.$template=IS.helpers.loadTemplate("global_login_signup"),this.fetchAlbums=!!this.options.fetchAlbums,IS.et.pe("Global Login/Signup","Start","Initialize")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,this.model.attributes)),this},postRenderSetup:function(){return this.$loginUsername=this.$(".login-box input.username"),this.$loginPassword=this.$(".login-box input.password"),this.$("input").placeholder(),this},submitOnEnterKey:function(a){IS.helpers.isEnterKey(a.keyCode)&&$(a.currentTarget).parents(".interaction-box:eq(0)").find(".action-button").click()},initFbButton:function(){return this.fbView=new IS.Views.FBAuthButton({el:this.$(".initial-step .fb"),noRedirect:!0,fetchAlbums:this.fetchAlbums}),this.fbView.on("facebook_auth:success",this.fbAuthSuccess,this),this},showLogin:function(){IS.et.pe("Global Login/Signup","Display","Login"),this.$el.addClass("login-shown").find(".login-box input.username").focus()},login:function(){this.hideError();var a=this.$(".login-box .log-in"),b=$.trim(this.$loginUsername.val()),c=$.trim(this.$loginPassword.val());if(!a.hasClass("disabled")){if(!b||!c)return void this.showError("emptyBoth");a.addClass("disabled").html("PROCESSING..."),IS.Models.User.login(b,c,!0,function(b){if(a.removeClass("disabled").html("LOG IN"),b&&b.success&&b.result)IS.et.pe("Global Login/Signup","Login","Success"),this.initCurrentUser(b.result);else if(b&&b.error)switch(b.error.error_code){case 18:this.showError("invalidLoginOrPassword");break;default:this.showError("apiFailure")}else this.showError("apiFailure")}.bind(this),function(c){if(a.removeClass("disabled").html("LOG IN"),c&&c.error)switch(c.error.error_code){case 18:this.showError("invalidLoginOrPassword");break;case 32:this.showError("inactiveAccount",b);break;default:this.showError("apiFailure")}else this.showError("apiFailure")}.bind(this),this.fetchAlbums)}},resetLogin:function(){this.$el.removeClass("login-shown signup-shown"),this.hideError()},fbAuthSuccess:function(a){a&&a.result&&(IS.et.pe("Global Login/Signup","Facebook","Success"),this.initCurrentUser(a.result))},initCurrentUser:function(a){var b=[];a.albums&&a.albums.length&&_.each(a.albums,function(a){b.push({id:a.id,album_title:a.title,album_title_short:IS.helpers.shortenText(a.title,13),is_private:!a["public"]})}),IS.currentUser=new IS.Models.User({id:a.userid,userId:a.userid,authToken:a.auth_token,username:a.username,albums:new Backbone.Collection(b)}),a.avatar&&(IS.currentUser.set("avatarServer",a.avatar.server),IS.currentUser.set("avatarFilename",a.avatar.filename)),this.trigger("login:success")},showError:function(a,b){var c=IS.Views.Mixins.Auth.errorMessages[a].replace("%s",b);this.$(".error").html(c)},hideError:function(){this.$(".error").empty()},destroy:function(){this.fbView.destroy(),Backbone.View.prototype.destroy.call(this)}},{WIDTH:540}),IS.Views.GlobalOverlay=Backbone.View.extend({tagName:"section",className:"global-overlay",events:{"click .close":"close",click:"close","click .content-box":"stopProp",dragenter:"dragEntered",dragover:"dragOver",dragleave:"dragLeft",drop:"filesDropped"},initialize:function(a){this.template=IS.helpers.loadTemplate("global_overlay"),this.dragTargets=$(),this.$body=$("body"),this.defaultTop=50,this.$window=$(window),this.transitionDelay=300,this.messageTimeout=null,this.messageDelay=3500,this.content="",this.width=a.width,this.height=a.height,this.otherClassName=a.otherClassName||"",this.view=null,this.ignoreEscKey=!!a.ignoreEscKey,this.skipHeightCSS=!!a.skipHeightCSS,this.enableErrorHandling=!!a.enableErrorHandling,this.enableSuccessHandling=!!a.enableSuccessHandling,a.content instanceof Backbone.View?(this.view=a.content,this.content=a.content.render().el):a.content instanceof Function?this.content=a.content():this.content=a.content,!this.ignoreEscKey&&IS.vent.once("body:keyup:escape",this.close,this),this.on("change:height",function(a){this.$contentBox.css("height",a.height)}.bind(this),this),this.enableErrorHandling&&IS.vent.on("global_overlay:display:error",this.showError,this),this.enableSuccessHandling&&IS.vent.on("global_overlay:display:success",this.showSuccess,this),IS.vent.on({"global_overlay:fade:out":this.fadeOut,"global_overlay:fade:in":this.fadeIn},this)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{enableErrorHandling:this.enableErrorHandling,enableSuccessHandling:this.enableSuccessHandling})),this.setupElements(),this.width&&this.$contentBox.css({width:this.width,"margin-left":"-"+Math.round(this.width/2)+"px"}),this.height?(this.$contentBox.css({top:"50%","margin-top":"-"+Math.round(this.height/2)+"px"}),this.skipHeightCSS||this.$contentBox.css("height",this.height)):this.$contentBox.css("top",this.defaultTop),this.$el.addClass(this.otherClassName),this.$content.html(this.content),this},setupElements:function(){this.$error=this.$(".overlay-error"),this.$success=this.$(".overlay-success"),this.$contentBox=this.$(".content-box"),this.$content=this.$(".content")},show:function(){this.$body.addClass("no-overflow"),this.$el.addClass("visible")},close:function(a){this.$el.removeClass("visible"),this.$body.removeClass("no-overflow"),this.trigger("action:close"),a&&a.stopPropagation&&a.stopPropagation(),_.delay(function(){this.destroy()}.bind(this),this.transitionDelay),!this.ignoreEscKey&&IS.vent.off("body:keyup:escape",this.close,this)},stopProp:function(a){this.trigger("content:clicked"),a.stopPropagation()},dragEntered:function(a){a.preventDefault(),a.stopPropagation(),this.trigger("drag:enter")},dragOver:function(a){a.preventDefault()},dragLeft:function(a){a.stopPropagation(),setTimeout(function(){this.dragTargets=this.dragTargets.not(a.target),0===this.dragTargets.length&&this.trigger("drag:leave")}.bind(this),1)},filesDropped:function(a){a.preventDefault(),this.trigger("drag:leave"),this.trigger("drop:files",a.originalEvent.dataTransfer.files)},showError:function(a){this.messageTimeout&&clearTimeout(this.messageTimeout),this.$error.html(a),this.$el.addClass("error-shown"),_.defer(function(){this.$error.addClass("visible")}.bind(this)),this.messageTimeout=setTimeout(function(){this.$error.removeClass("visible"),_.delay(function(){this.$el.removeClass("error-shown")}.bind(this),250)}.bind(this),this.messageDelay)},showSuccess:function(a){this.messageTimeout&&clearTimeout(this.messageTimeout),this.$success.html(a),this.$el.addClass("success-shown"),_.defer(function(){this.$success.addClass("visible")}.bind(this)),this.messageTimeout=setTimeout(function(){this.$success.removeClass("visible"),_.delay(function(){this.$el.removeClass("success-shown")}.bind(this),250)}.bind(this),this.messageDelay)},fadeOut:function(){this.$body.removeClass("no-overflow"),this.$el.removeClass("visible"),_.delay(function(){this.$el.addClass("hidden")}.bind(this),250)},fadeIn:function(){this.$el.removeClass("hidden"),_.defer(function(){this.show()}.bind(this))},destroy:function(){this.view&&!_.isUndefined(this.view.isInProgress)&&this.view.isInProgress()||(this.$el.off(),this.view&&this.view.destroy(),this.enableErrorHandling&&IS.vent.off("global_overlay:display:error",this.showError,this),this.enableSuccessHandling&&IS.vent.off("global_overlay:display:success",this.showSuccess,this),Backbone.View.prototype.destroy.call(this))}}),IS.Views.GlobalUserMessage=Backbone.View.extend({className:"global-user-message",tagName:"div",events:{"click a.close":"close"},initialize:function(){this.slideSpeed=300,this.visibilityDelay=3500},render:function(){return this.$el.html(Mustache.render(IS.inlineTemplates.global_user_message,this.model.attributes)),this.model.get("is_error")&&this.$el.addClass("error"),$("body").hasClass("app-layout")?this.$el.addClass("app"):this.$el.addClass("static"),_.delay(function(){this.show()}.bind(this),100),this},show:function(){this.$el.addClass("visible"),_.delay(function(){this.close()}.bind(this),this.visibilityDelay)},close:function(){this.$el.removeClass("visible"),_.delay(function(){this.destroy()}.bind(this),this.slideSpeed)}}),IS.Views.GridAlbum=Backbone.View.extend({tagName:"div",className:"grid-album",events:{"click .edit-container":"sendToDetails","click .view-btn":"sendToDetails","click footer .right .icon-menu":"bottomMenuIconClicked","click footer .right nav.menu-dark":"bottomMenuClicked","click footer .right nav.menu-dark li.share":"toggleBottomShareSubmenu","click footer .right nav.menu-dark li.delete":"removeFromServer","click footer .right nav.menu-dark ul.top input":"highlightLink","click footer .right nav.menu-dark-sub .share-options li":"shareAlbum","click footer .right ul.bottom li.private":"updatePrivacy","click section.follow a.btn":"followBtnClicked","click footer .top input.disabled":"inputDisabled"},profileMode:!1,profileModeIsFollowed:!1,thumbsPreloaded:!1,initialize:function(){_.extend(this,IS.Views.Mixins.GridItem),_.extend(this,IS.Views.Mixins.Share),this.options.profileMode&&(this.profileMode=this.options.profileMode),this.options.profileModeIsFollowed&&(this.profileModeIsFollowed=this.options.profileModeIsFollowed),this.model.bind("change",this.render,this),_.bindAll(this,"render"),this.template=IS.helpers.loadTemplate("grid_album"),this.setupElements(),IS.vent.on({"grid_item:bottom_menu:clicked":this.hideBottomMenu,"body:clicked":this.hideBottomMenu,"body:keyup:escape":this.hideBottomMenu,"app_layout:content:loaded":this.lazyLoadImages,"grid_items:grid_album:show_follow_btn":this.forceShowFollowBtn,"grid_items:grid_album:hide_follow_btn":this.forceHideFollowBtn},this)},setupElements:function(){this.setupSharedElements(),this.$hero=this.$el.find(".hero img"),this.$followFooter=this.$("section.follow"),this.profileMode||(this.gridPhotoTitleView=new IS.Views.GridEditableTitle({el:this.$("footer > .left .info-album .title-wrapper"),model:this.model}))},render:function(){var a=this,b=!1;b=this.model.get("is_owner")?IS.currentUser&&IS.currentUser.get("isFeatured"):!!this.model.get("owner").featured_photographer;var c=_.extend(this.model.toJSON(),{profileMode:this.profileMode,albumTitle:this.model.friendlyTitle({len:22}),hasHero:!(!this.model.get("images")||!this.model.get("images").length),hero:this.model.heroURL(),username:this.model.get("owner").username,isPublic:this.model.get("public"),iOSDevice:IS.CONS.IOS_DEVICE,isFeatured:b,freeAccount:!IS.currentUser,isPrivate:this.model.isPrivate(),isPrivatePass:this.model.isPrivatePass(),thumbUrl:function(a){return IS.helpers.getImagizerLink({server:a.server,filename:a.filename,width:59,height:59,cropped:!0})},thumb1:function(){return this.thumbUrl(a.model.get("images")[1])},thumb1Src:function(){return a.thumbsPreloaded?this.thumb1():"/v2_images/empty.png"},thumb2:function(){return this.thumbUrl(a.model.get("images")[2])},thumb2Src:function(){return a.thumbsPreloaded?this.thumb2():"/v2_images/empty.png"},thumb3:function(){return this.thumbUrl(a.model.get("images")[3])},thumb3Src:function(){return a.thumbsPreloaded?this.thumb3():"/v2_images/empty.png"},thumb4:function(){return this.thumbUrl(a.model.get("images")[4])},thumb4Src:function(){return a.thumbsPreloaded?this.thumb4():"/v2_images/empty.png"},directLink:function(){return"https://imageshack.com"+a.model.detailURL()},total:function(){return IS.helpers.numberWithCommas(a.model.get("total"))},avatarURL:function(){return a.model.get("owner").avatar&&a.model.get("owner").avatar.server?IS.helpers.getImagizerLink({server:a.model.get("owner").avatar.server,filename:a.model.get("owner").avatar.filename,width:28,height:28,cropped:!0}):IS.Models.User.getDefaultAvatar(28)},hasThumb1:function(){var b=a.model.get("images");return!(!b||!b[1])},hasThumb2:function(){var b=a.model.get("images");return!(!b||!b[2])},hasThumb3:function(){var b=a.model.get("images");return!(!b||!b[3])},hasThumb4:function(){var b=a.model.get("images");return!(!b||!b[4])},adjustedWidth:function(){var b=a.model.get("images")[0];return IS.helpers.getAdjustedDimensions({width:b.width,height:b.height,maxWidth:242}).width},showFollowBtn:function(){return a.profileMode&&!(a.profileModeIsFollowed||IS.currentUser&&IS.currentUser.get("username")==a.model.get("owner").username)?!!a.model.get("owner").allow_following:void 0},followBtnText:function(){return a.model.get("is_following")?"UNFOLLOW":"FOLLOW"},followBtnType:function(){return IS.currentUser&&a.model.get("is_following")?void 0:"follow"}});return this.$el.html(IS.helpers.renderTemplate(this.template,c)),
this.setupElements(),this.setupHeroCrop(),this},setupHeroCrop:function(){this.cropHero(),this.$hero.on("load",function(){this.cropHero()}.bind(this))},cropHero:function(){var a=this.$hero.height();this.$hero.css({top:"50%","margin-top":-1*Math.abs(a/2)})},removeFromServer:function(){IS.et.pe("Grid Album","Click","Delete"),IS.helpers.confirmAction({message:"Are you sure you want to delete this album?",confirm_text:"delete"}).done(function(){this.model.destroy({success:function(){IS.et.pe("Grid Album","Delete","Album"),IS.cm.invalidateByCacheKey("my_albums"),IS.vent.trigger("grid_items:reset"),_.delay(function(){IS.helpers.displayUserMessage('Your album "'+this.model.friendlyTitle()+'" was deleted.')}.bind(this),500),IS.vent.trigger("app_layout:navbar:remove_album_link",{id:this.model.get("id")})}.bind(this),error:function(){IS.helpers.displayUserError('Unable to delete your album "'+this.model.friendlyTitle()+'".'),IS.logger.error("Unable to delete grid album",this.model)}.bind(this)})}.bind(this))},sendToDetails:function(){this.profileMode?Backbone.history.navigate(this.model.detailURL(),!0):(IS.vent.trigger("app_layout:navbar:activate_album_link",{id:this.model.id}),Backbone.history.navigate(this.model.detailURL(),!0))},lazyLoadImages:function(){this.thumbsPreloaded||(this.thumbsPreloaded=!0,_.delay(function(){this.$(".thumb img").each(function(){var a=$(this);a.attr("src",a.data("url")).css("visibility","visible")})}.bind(this),250))},followBtnClicked:function(a,b){var c=$(a.currentTarget);return IS.currentUser?void(c.hasClass("follow")?(this.model.follow(function(){b&&window.location.reload()}),c.html("UNFOLLOW").removeClass("follow")):(this.model.unfollow(function(){b&&window.location.reload()}),c.html("FOLLOW").addClass("follow"))):void IS.helpers.showLoginSignupOverlay(function(){this.followBtnClicked(a,!0)}.bind(this),null)},forceShowFollowBtn:function(){this.$followFooter.show()},forceHideFollowBtn:function(){this.$followFooter.hide()}},{DIMENSIONS:{WIDTH:250,PADDING:20}}),IS.Views.GridAlbumMobile=Backbone.View.extend({tagName:"div",className:"grid-album-mobile",events:{click:"clicked"},style:null,initialize:function(a){a=a||{},this.model.bind("change",this.render,this),this.template=IS.helpers.loadTemplate("grid_album_mobile"),this.style=a.style||IS.Views.GridAlbumMobile.STYLE.PHONE,this.setupElements()},setupElements:function(){return this},render:function(){var a=function(a){return a?IS.helpers.getImagizerLink({server:a.server,filename:a.filename,width:77,height:77,cropped:!0}):void 0};return this.$el.html(IS.helpers.renderTemplate(this.template,{thumb1:a(this.model.get("images")[1]),thumb2:a(this.model.get("images")[2]),thumb3:a(this.model.get("images")[3]),count:IS.helpers.numberWithCommas(this.model.get("total")),title:function(){return this.style==IS.Views.GridAlbumMobile.STYLE.PHONE?this.model.friendlyTitle({len:22}):this.style==IS.Views.GridAlbumMobile.STYLE.TABLET?this.model.friendlyTitle({len:30}):void 0}.bind(this),hero:function(){var a=this.model.get("images");if(a.length){var b,c,d=new IS.Models.Photo(a[0]);return this.style==IS.Views.GridAlbumMobile.STYLE.PHONE?(b=IS.Views.GridAlbumMobile.SIZES.PHONE.WIDTH,c=IS.Views.GridAlbumMobile.SIZES.PHONE.HEIGHT):this.style==IS.Views.GridAlbumMobile.STYLE.TABLET&&(b=IS.Views.GridAlbumMobile.SIZES.TABLET.WIDTH,c=IS.Views.GridAlbumMobile.SIZES.TABLET.HEIGHT),IS.helpers.getImagizerLink({server:d.get("server"),filename:d.get("filename"),width:b,height:c,cropped:!0})}}.bind(this),heroAdjustedWidth:function(){var a=this.model.get("images")[0];if(a)return IS.helpers.getAdjustedDimensions({width:a.width,height:a.height,maxWidth:function(){return this.style==IS.Views.GridAlbumMobile.STYLE.PHONE?IS.Views.GridAlbumMobile.SIZES.PHONE.WIDTH:this.style==IS.Views.GridAlbumMobile.STYLE.TABLET?IS.Views.GridAlbumMobile.SIZES.TABLET.WIDTH:void 0}.bind(this)()}).width}.bind(this)})),this.style==IS.Views.GridAlbumMobile.STYLE.PHONE?this.$el.addClass("phone"):this.style==IS.Views.GridAlbumMobile.STYLE.TABLET&&this.$el.addClass("tablet"),this.setupElements(),this},clicked:function(){Backbone.history.navigate(this.model.detailURL(),!0)}},{SIZES:{PHONE:{WIDTH:145,PADDING:10},TABLET:{WIDTH:235,PADDING:10}},STYLE:{PHONE:1,TABLET:2}}),IS.Views.GridEditableTitle=Backbone.View.extend({events:{click:"clicked",mouseenter:"mouseentered",mouseleave:"mouseleaved","keyup input.edit":"inputKeyup","focusout input.edit":"inputFocusout"},active:!1,initialize:function(){this.template=IS.inlineTemplates.grid_photo_title,this.inputTemplate=IS.inlineTemplates.grid_photo_title_input,this.setupElements()},render:function(){return this.$el.html(Mustache.render(this.template,{title:function(){return this.model.get("title")?this.model.get("title"):this.model.get("original_filename")}.bind(this)})),this.setupElements(),this.delegateEvents(),this},renderInput:function(){return this.$el.html(Mustache.render(this.inputTemplate,{title:this.model.get("title")||this.model.get("original_filename")})),this.setupElements(),this.delegateEvents(),this},setupElements:function(){return this.$title=this.$(".title"),this},activate:function(){this.active=!0,IS.vent.trigger("grid_items:edit_widget:disable")},deactivate:function(){this.active=!1,this.mouseleaved(),IS.vent.trigger("grid_items:edit_widget:enable")},clicked:function(){this.active||this.parentInEditMode()||(this.mouseleaved(),this.$title.remove(),this.renderInput(),this.$("input.edit").focus().select(),this.activate())},mouseentered:function(){this.active||this.parentInEditMode()||this.$el.addClass("hovered")},mouseleaved:function(){this.active||this.$el.removeClass("hovered")},inputKeyup:function(a){IS.helpers.isEnterKey(a.which)&&this.active&&this.sendModel()},inputFocusout:function(){this.deactivate(),(this.model.get("title")||this.model.get("original_filename"))!=this.$("input.edit").val()&&this.sendModel()},sendModel:function(){var a=this.model.get("title");this.model.save({title:$.trim(this.$("input.edit").val())},{silent:!0,success:function(){if(IS.et.pe("Grid Item","Edit","Title"),this.model instanceof IS.Models.Album){IS.vent.trigger("app_layout:navbar:rename_album_link",{id:this.model.id,name:this.model.friendlyTitle({len:13})});var a=IS.currentUser.get("albums").find(function(a){return a.get("id")==this.model.get("id")}.bind(this));a&&a.set({title:this.model.get("title"),album_title:this.model.get("title")})}this.deactivate(),this.render()}.bind(this),error:function(b,c,d){this.model.set({title:a}),this.deactivate(),this.render();var e="Unable to update title. Try again later.";if(null!=c.responseText){var f=$.parseJSON(c.responseText);f.error&&31==f.error.error_code&&(e="Album title already exists.")}IS.logger.error(e,b.attributes),IS.helpers.displayUserError(e)}.bind(this)})},parentInEditMode:function(){return this.$el.parents('.grid-photo[class~="edit-mode"]').length}}),IS.Views.GridItemsEditWidget=Backbone.View.extend({el:".grid-items-edit-widget",events:{"hover .icons div":"iconHovered","click .icons div":"iconClicked","click .select-all":"selectAllClicked"},initialize:function(){this.enabled=!1,this.timeout=null,this.activeLightboxView=null,this.activeLightboxSel=null,this.selectedPhotosCollection=new IS.Collections.SelectedPhotos,this.selectAllEnabled=!1,this.lightboxNewAlbumView=new IS.Views.LightboxNewAlbum({editWidgetMode:!0}),this.lightboxPrivacyView=new IS.Views.LightboxPrivacy,this.lightboxDeleteImagesView=new IS.Views.LightboxDeleteImages,this.lightboxGetLinksView=new IS.Views.LightboxGetLinks,this.lightboxAddFiltersView=new IS.Views.LightboxAddFilters,this.lightboxAddTagsView=new IS.Views.LightboxAddTags,this.lightboxRotateView=new IS.Views.LightboxRotate,this.$icons=this.$(".icons"),this.$body=$("body"),this.$error=this.$(".error"),this.$selectAll=this.$(".select-all"),IS.vent.on({"grid_items:edit_widget:hide":this.hide,"grid_items:edit_widget:show":this.show,"grid_items:edit_widget:disable":this.disable,"grid_items:edit_widget:enable":this.enable,"grid_items:edit_widget:reset_selected_photos":this.resetSelectedPhotos,"grid_items:edit_widget:hide_privacy_icon":this.hidePrivacyIcon,"grid_items:edit_widget:show_privacy_icon":this.showPrivacyIcon,"grid_items:edit_widget:show_rotate_lightbox":this.showRotateLightbox,"grid_items:add_selected_photo":this.addSelectedPhoto,"grid_items:remove_selected_photo":this.removeSelectedPhoto,"grid_items:show:get_links":this.showGetLinks,"app_layout:lightbox_close":this.resetLightboxState,"app_layout:content:subdue":this.subdue,"app_layout:content:remove_subdue":this.removeSubdue,"body:keyup:escape":this.closeByEscape},this)},destroy:function(){this.lightboxNewAlbumView.destroy(),this.lightboxPrivacyView.destroy(),this.lightboxDeleteImagesView.destroy(),this.lightboxGetLinksView.destroy(),this.lightboxAddFiltersView.destroy(),this.lightboxAddTagsView.destroy(),this.lightboxRotateView.destroy(),Backbone.View.prototype.destroy.call(this),IS.logger.log("[GridItemsEditWidget] View destroyed")},show:function(){this.enabled&&(this.$body.addClass("no-user-select"),this.$el.removeClass("fadeOut").addClass("fadeIn").show(),clearTimeout(this.timeout))},hide:function(){clearTimeout(this.timeout),this.$body.removeClass("no-user-select"),this.$el.removeClass("fadeIn"),this.$el.hide(),this.lightboxNewAlbumView.hide(),this.lightboxPrivacyView.hide(),this.lightboxDeleteImagesView.hide(),this.lightboxGetLinksView.hide(),this.lightboxAddFiltersView.hide(),this.lightboxAddTagsView.hide(),this.lightboxRotateView.hide()},iconHovered:function(a){var b=$(a.currentTarget),c=b.data("id")+"TooltipView";"mouseenter"==a.type?this[c].showWithOffset(b.offset()):this[c].hide()},iconClicked:function(a){var b=$(a.currentTarget),c=null;if(!this.selectedPhotosCollection.length)return void this.showNoneSelectedError();switch(this.hideNoneSelectedError(),b.data("id")){case"links":IS.et.pe("Edit Widget","Click","Get Links"),c=this.lightboxGetLinksView;break;case"album":IS.et.pe("Edit Widget","Click","Create Album"),c=this.lightboxNewAlbumView;break;case"tags":IS.et.pe("Edit Widget","Click","Add Tags"),c=this.lightboxAddTagsView;break;case"filter":IS.et.pe("Edit Widget","Click","Filter"),c=this.lightboxAddFiltersView;break;case"delete":IS.et.pe("Edit Widget","Click","Delete"),c=this.lightboxDeleteImagesView;break;case"privacy":IS.et.pe("Edit Widget","Click","Privacy"),c=this.lightboxPrivacyView}this.showLightbox(c,b,"Edit Widget")},showLightbox:function(a,b,c){this.activeLightboxView&&this.activeLightboxView.cid==a.cid||(this.activeLightboxView&&this.activeLightboxView.hide(),IS.vent.trigger("app_layout:content:subdue"),b&&b.addClass("active"),a.show({collection:this.selectedPhotosCollection,page:c}),this.activeLightboxView=a)},showRotateLightbox:function(a){this.lightboxRotateView.photoModel=a.photoModel,this.showLightbox(this.lightboxRotateView,null,"Edit Widget")},resetLightboxState:function(){this.activeLightboxView=null,this.$el.find(".icons div.active").removeClass("active"),IS.vent.trigger("app_layout:content:remove_subdue")},addSelectedPhoto:function(a){a.view&&_.isObject(a.view)?this.selectedPhotosCollection.add(a.view.model):a.model&&_.isObject(a.model)&&this.selectedPhotosCollection.add(a.model)},removeSelectedPhoto:function(a){a.view&&_.isObject(a.view)?this.selectedPhotosCollection.remove(a.view.model):a.model&&_.isObject(a.model)&&this.selectedPhotosCollection.remove(a.model)},resetSelectedPhotos:function(){this.selectedPhotosCollection.reset()},closeByEscape:function(){this.enabled&&_.isNull(this.activeLightboxView)&&(this.selectedPhotosCollection.reset(),IS.vent.trigger("grid_item:edit_mode:reset"),this.$selectAll.html("SELECT ALL"),this.selectAllEnabled=!1)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0,this.showPrivacyIcon(),this.selectAllEnabled=!1,this.$selectAll.html("SELECT ALL")},showGetLinks:function(a){IS.vent.trigger("app_layout:content:subdue"),this.lightboxGetLinksView.show({collection:this.selectedPhotosCollection,page:a.page}),this.activeLightboxView=this.lightboxGetLinksView,this.lightboxGetLinksView.once("closed",function(){this.selectedPhotosCollection.reset()},this)},hidePrivacyIcon:function(){this.$el.addClass("privacy-hidden")},showPrivacyIcon:function(){this.$el.removeClass("privacy-hidden")},showNoneSelectedError:function(){this.$error.show(),_.defer(function(){this.$error.addClass("show")}.bind(this)),_.delay(function(){this.hideNoneSelectedError()}.bind(this),3500)},hideNoneSelectedError:function(){this.$error.removeClass("show"),_.delay(function(){this.$error.hide()}.bind(this),200)},selectAllClicked:function(){this.selectAllEnabled?(IS.vent.trigger("grid_items:shift_deselect_all_for_current_page"),this.$selectAll.html("SELECT ALL"),this.selectAllEnabled=!1):(IS.vent.trigger("grid_items:shift_select_all_for_current_page"),this.$selectAll.html("CLEAR ALL"),this.selectAllEnabled=!0)},subdue:function(){this.$el.removeClass("fadeIn").addClass("subdued")},removeSubdue:function(){this.$el.removeClass("subdued")}}),IS.Views.GridPhoto=Backbone.View.extend({tagName:"div",className:"grid-photo",events:{click:"clicked","click .select-button":"selectButtonClicked","click footer .top input.disabled":"inputDisabled","click .icon-gif":"playGif","click footer .right .icon-menu":"bottomMenuIconClicked","click footer .right nav.menu-dark":"bottomMenuClicked","click footer .right nav.menu-dark li.add-to-album":"toggleBottomAlbumSubmenu","click footer .right nav.menu-dark li.share":"toggleBottomShareSubmenu","click footer .right nav.menu-dark li.delete":"removeFromServer","click footer .right nav.menu-dark li.edit":"editClicked","click footer .right nav.menu-dark li.crop":"cropClicked","click footer .right nav.menu-dark li.remove-from-album":"removeFromAlbum","click footer .right nav.menu-dark li.rotate":"rotateClicked","click footer .right nav.menu-dark-sub .albums li":"addToAlbum","click footer .right nav.menu-dark ul.top input":"highlightLink","click footer .right nav.menu-dark ul.links-button a":"showGetLinksLightbox","click footer .right nav.menu-dark-sub .share-options li":"sharePhoto","click footer .right ul.bottom li.private":"updatePrivacy","mouseenter footer .right nav.menu-dark-sub":"mouseenterAlbums","mouseleave footer .right nav.menu-dark-sub":"mouseleaveAlbums","click .inner .hero-wrapper":"showImageOverlay","click .inner .like-button":"handleLikeUnlike"},profileMode:!1,initialize:function(a){_.extend(this,IS.Views.Mixins.GridItem),_.extend(this,IS.Views.Mixins.Share),a.profileMode&&(this.profileMode=a.profileMode),this.removeOnMove=a.removeOnMove,this.disableLike=a.disableLike||!1,this.showSelect=a.showSelect||!1,this.style=a.style||IS.Views.GridPhoto.STYLE.MASONRY,this.enableLightbox=!!a.enableLightbox,this.disableLightboxNav=!!a.disableLightboxNav,this.nextPrevAlbum=!!a.nextPrevAlbum,this.eventPage=a.eventPage,this.style==IS.Views.GridPhoto.STYLE.MASONRY?this.adjustedDimensions=IS.helpers.getAdjustedDimensions({width:this.model.get("width"),height:this.model.get("height"),maxWidth:IS.Views.GridPhoto.DIMENSIONS.IMAGE_WIDTH}):this.style==IS.Views.GridPhoto.STYLE.SQUARE?this.adjustedDimensions={width:240,height:null}:this.style==IS.Views.GridPhoto.STYLE.MINI&&(this.adjustedDimensions={width:121,height:121}),this.removeOnBecomingPublic=a.removeOnBecomingPublic,this.albumModel=null,a.albumModel&&(this.albumModel=a.albumModel),this.model.bind("change",this.render,this),_.bindAll(this,"render"),this.template=IS.helpers.loadTemplate("grid_photo"),this.setupElements(),IS.vent.on({"grid_item:bottom_menu:clicked":this.hideBottomMenu,"body:clicked":this.hideBottomMenu,"body:keyup:escape":this.hideBottomMenu,"grid_item:edit_mode:reset":this.disableEditModeClass,"grid_item:edit_mode:enable":this.enableEditModeClass,"grid_item:rerender":this.reRender},this)},setupElements:function(){return this.setupSharedElements(),this.$hero=this.$("img.hero"),this.profileMode||new IS.Views.GridEditableTitle({el:this.$("footer > .left .info .title-wrapper"),model:this.model}),this},render:function(){var a=this,b=_.extend(this.model.toJSON(),{profileMode:this.profileMode,isPublic:this.model.get("public"),adjustedWidth:this.adjustedDimensions.width,adjustedHeight:this.adjustedDimensions.height||"auto",landingURL:this.model.landingURL(),link:"https://imageshack.com"+this.model.landingURL(),disableLike:this.disableLike,showSelect:this.showSelect,iOSDevice:IS.CONS.IOS_DEVICE,defaultAvatarURL:IS.Models.User.getDefaultAvatar(28),username:this.model.get("owner").username,showRotate:!this.model.isGif(),freeAccount:!IS.currentUser,showFooterLeft:!(this.style==IS.Views.GridPhoto.STYLE.MINI),showEdit:Modernizr.blobconstructor,hero:function(){return IS.helpers.getImagizerLink({server:this.model.get("server"),filename:this.model.get("filename"),width:this.adjustedDimensions.width,height:this.adjustedDimensions.height,cropped:function(){return this.style==IS.Views.GridPhoto.STYLE.SQUARE?!0:this.style==IS.Views.GridPhoto.STYLE.MINI?!0:!1}},this.model.isGif())}.bind(this),imageTitle:function(){if(this.model.get("title"))var a=this.model.get("title");else var a=this.model.get("original_filename");return IS.helpers.shortenText(a,20)}.bind(this),directLink:function(){return IS.inlineTemplates.direct({server:this.model.get("server"),filename:this.model.get("filename"),bucket:this.model.get("bucket")})}.bind(this),externalLink:function(a){return IS.inlineTemplates[a]({id:this.model.get("id"),server:this.model.get("server"),filename:this.model.get("filename"),bucket:this.model.get("bucket"),width:150,height:100})}.bind(this),showAlbumRemove:function(){return this.albumModel&&this.albumModel.id}.bind(this),avatarURL:function(){return a.model.get("owner").avatar&&a.model.get("owner").avatar.server?IS.helpers.getAvatarLink(28,a.model.get("owner").avatar):this.defaultAvatarURL},showPrivateInfo:function(){return this.model.get("is_owner")?!0:this.model.get("public")}.bind(this),belongsToAlbum:function(){return!(!this.model.get("album")||!this.model.get("album").id)}.bind(this),albumTitle:function(){return this.model.friendlyAlbumTitle({len:24})}.bind(this),albumId:function(){return this.model.get("album")&&this.model.get("album").id}.bind(this),showGifIcon:function(){var a=this.model.get("filename"),b=IS.helpers.isGif(a);return b}.bind(this)});return this.$el.html(IS.helpers.renderTemplate(this.template,b)),this.style==IS.Views.GridPhoto.STYLE.SQUARE?this.$el.addClass("grid-photo square"):this.style==IS.Views.GridPhoto.STYLE.MINI&&this.$el.addClass("grid-photo mini"),this.setupElements(),this},reRender:function(a){return _.isNull(a.ids)?IS.logger.error("[Views.GridPhoto] Missing IDs"):void(_.contains(a.ids,this.model.get("id"))&&(IS.logger.log("[Views.GridPhoto] Rerendering photo #"+this.model.get("id")),_.isEmpty(a.updates)||(this.model.set(a.updates),a.updates["public"]&&this.model.get("album")&&this.model.get("album").id&&!this.model.get("album")["public"]&&this.model.set("album",{id:"",title:""})),this.render().renderHero()))},renderHero:function(){return this.$hero.attr("src",this.$hero.data("src")),this},clicked:function(a){return IS.CONS.IOS_DEVICE?void Backbone.history.navigate(this.model.landingURL(),!0):void(key.shift&&(this.profileMode||(a.preventDefault(),a.stopPropagation(),this.$el.hasClass("edit-mode")?(IS.et.pe("Grid Photo","Deselect","Shift Key Photo"),IS.vent.trigger("grid_items:remove_selected_photo",{view:this})):(IS.et.pe("Grid Photo","Select","Shift Key Photo"),IS.vent.trigger("grid_items:add_selected_photo",{view:this})),this.$el.toggleClass("edit-mode"))))},enableEditModeClass:function(){this.$el.addClass("edit-mode")},disableEditModeClass:function(){this.$el.removeClass("edit-mode")},addToAlbum:function(a){var b=$(a.currentTarget);if(!b.data("id"))return IS.logger.error("Missing album id");var c=new IS.Models.Album({id:b.data("id"),title:b.data("title"),"public":b.data("public")}),d=this.model.get("album")&&this.model.get("album").id;c.on("added_images",function(a){a.success?(IS.et.pe("Grid Photo",d?"Moved":"Added","To Album"),IS.cm.invalidateByCacheKey("my_images"),IS.cm.invalidateByCacheKey("my_albums"),IS.helpers.displayUserMessage("Your image was "+(d?"moved":"added")+' to "'+b.data("title")+'" album.'),this.model.set("album",{id:c.get("id"),title:c.get("title"),"public":c.get("public")}),c.get("public")===!1&&this.model.set("public",!1),this.renderHero(),d&&this.removeOnMove&&IS.vent.trigger("grid_items:reset"),this.mouseleaveAlbums()):(IS.helpers.displayUserError('Unable to add your image to "'+b.data("title")+'" album.'),IS.logger.error("[Views.GridPhoto] Unable to add image to album",c.attributes))}.bind(this)),c.addImages([this.model])},removeFromServer:function(){IS.et.pe("Grid Photo","Click","Delete"),IS.helpers.confirmAction({message:"Are you sure you want to delete this image?",confirm_text:"delete"}).done(function(){this.model.once("removed_from_server",function(a){a.success?(IS.cm.invalidateByCacheKey("my_images"),IS.cm.invalidateByCacheKey("user_tags"),this.model.get("album")&&this.model.get("album").id&&IS.cm.invalidateByCacheKey("my_albums"),IS.vent.trigger("grid_items:reset"),IS.vent.trigger("app_layout:navbar:tags_refresh"),_.delay(function(){IS.helpers.displayUserMessage("Your image was deleted.")},500)):IS.helpers.displayUserError("Unable to delete your image.")}.bind(this)),this.model.removeFromServer()}.bind(this))},removeFromAlbum:function(){IS.et.pe("Grid Photo","Click","Remove From Album"),IS.helpers.confirmAction({message:"Are you sure you want to remove this image from your album?",confirm_text:"remove"}).done(function(){this.albumModel.once("removed_image",function(a){a.success?(IS.cm.invalidateByCacheKey("my_images"),IS.cm.invalidateByCacheKey("my_albums"),IS.vent.trigger("grid_items:reset"),_.delay(function(){IS.helpers.displayUserMessage("Your image was removed from this album.")},500),this.model.set("album",{id:"",title:""})):IS.helpers.displayUserError("Unable to remove your image from album.")}.bind(this)),this.albumModel.removeImage(this.model)}.bind(this))},mouseenterAlbums:function(){IS.vent.trigger("app_layout:content:disable_scroll")},mouseleaveAlbums:function(){IS.vent.trigger("app_layout:content:enable_scroll")},handleLikeUnlike:function(a){a.stopPropagation();var b=$(a.currentTarget);this.model.get("liked")?this.unlike(b,!1):this.like(b,!1)},like:function(a,b){return IS.currentUser?void(a.hasClass("processing")||(a.addClass("processing"),IS.et.pe("Grid Photo","Click","Like"),this.model.set({likes:this.model.get("likes")+1,liked:!0},{silent:!0}),a.addClass("liked").find(".count").text(this.model.get("likes")),this.model.once("liked",function(){a.removeClass("processing"),IS.cm.invalidateByCacheKey("my_images"),b&&window.location.reload()},this),this.model.like())):void IS.helpers.showLoginSignupOverlay(function(){this.like(a,!0)}.bind(this),null)},unlike:function(a,b){return IS.currentUser?void(a.hasClass("processing")||(a.addClass("processing"),IS.et.pe("Grid Photo","Click","Unlike"),this.model.set({likes:Math.max(0,this.model.get("likes")-1),liked:!1},{silent:!0}),a.removeClass("liked").find(".count").text(this.model.get("likes")),this.model.once("unliked",function(){a.removeClass("processing"),IS.cm.invalidateByCacheKey("my_images"),b&&window.location.reload()},this),this.model.unlike())):void IS.helpers.showLoginSignupOverlay(function(){this.unlike(a,!0)}.bind(this),null)},showGetLinksLightbox:function(){IS.et.pe("Grid Photo","Click","Select Image Size"),IS.vent.trigger("grid_items:add_selected_photo",{model:this.model}),IS.vent.trigger("grid_items:show:get_links",{page:this.eventPage}),this.toggleBottomMenu()},rotateClicked:function(){IS.vent.trigger("grid_items:edit_widget:show_rotate_lightbox",{photoModel:this.model}),this.toggleBottomMenu()},selectButtonClicked:function(a){a.preventDefault(),a.stopPropagation(),this.profileMode||(this.$el.hasClass("edit-mode")?(IS.et.pe("Grid Photo","Deselect","Button"),IS.vent.trigger("grid_items:remove_selected_photo",{view:this})):(IS.et.pe("Grid Photo","Select","Button"),IS.vent.trigger("grid_items:add_selected_photo",{view:this})),this.$el.toggleClass("edit-mode"))},editClicked:function(){this.imageEditorView=new IS.Views.ImageEditor({model:this.model}),$("body").append(this.imageEditorView.render().el)},cropClicked:function(){IS.helpers.initImageCropper({server:this.model.get("server"),filename:this.model.get("filename"),width:this.model.get("width"),height:this.model.get("height"),type:IS.Views.ImageCropper.TYPE.IMAGE,id:this.model.id})},playGif:function(a){a.stopPropagation();var b=$(a.currentTarget);return b.hasClass("playing")?this.$hero.attr("src",this.$hero.data("src")):this.$hero.attr("src",IS.inlineTemplates.direct({server:this.model.get("server"),bucket:this.model.get("bucket"),filename:this.model.get("filename")}).replace("http:","")),b.toggleClass("playing"),this},showImageOverlay:function(a){!key.shift&&this.enableLightbox&&(a.preventDefault(),a.stopPropagation(),IS.helpers.showImageOverlay({id:this.model.get("id"),disableNav:this.disableLightboxNav,likeCallback:function(){this.model.set({likes:this.model.get("likes")+1,liked:!0}),this.render().renderHero()}.bind(this),unlikeCallback:function(){this.model.set({likes:Math.max(0,this.model.get("likes")-1),liked:!1}),this.render().renderHero()}.bind(this),nextPrevAlbum:this.nextPrevAlbum}))}},{DIMENSIONS:{WIDTH:250,PADDING:20,IMAGE_WIDTH:240,MINI:{WIDTH:129,HEIGHT:149,PADDING:20}},STYLE:{MASONRY:1,SQUARE:2,MINI:3}}),IS.Views.GridPhotoMobile=Backbone.View.extend({tagName:"div",className:"grid-photo-mobile",events:{click:"clicked"},style:null,initialize:function(a){a=a||{},this.template=IS.helpers.loadTemplate("grid_photo_mobile"),this.model&&this.model.bind("change",this.render,this),this.style=a.style||IS.Views.GridPhotoMobile.STYLE.PHONE,this.setupElements()},setupElements:function(){},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{hero:function(){var a,b;return this.style==IS.Views.GridPhotoMobile.STYLE.PHONE?(a=IS.Views.GridPhotoMobile.SIZES.PHONE.WIDTH,b=IS.Views.GridPhotoMobile.SIZES.PHONE.HEIGHT):this.style==IS.Views.GridPhotoMobile.STYLE.TABLET&&(a=IS.Views.GridPhotoMobile.SIZES.TABLET.WIDTH,b=IS.Views.GridPhotoMobile.SIZES.TABLET.HEIGHT),IS.helpers.getImagizerLink({server:this.model.get("server"),filename:this.model.get("filename"),width:a,height:b,cropped:!0})}.bind(this)})),this.style==IS.Views.GridPhotoMobile.STYLE.PHONE?this.$el.addClass("phone"):this.style==IS.Views.GridPhotoMobile.STYLE.TABLET&&this.$el.addClass("tablet"),this.setupElements(),this},clicked:function(a){IS.et.pe("Grid Photo Mobile","Click"),Backbone.history.navigate(this.model.landingURL(),!0)}},{SIZES:{PHONE:{WIDTH:94,HEIGHT:94,PADDING:1},TABLET:{WIDTH:240,HEIGHT:240,PADDING:1}},STYLE:{PHONE:1,TABLET:2}}),IS.Views.HeaderAlbumDetail=Backbone.View.extend({tagName:"header",className:"my-albums",events:{"click img.avatar":"avatarClicked","click .menu":"toggleOwnerOptions","click .owner-options ul.top input":"highlightLink","click .owner-options ul.bottom li.private":"showEditLightbox","click .owner-options li.add":"addImages","click .owner-options li.delete":"deleteAlbum","click .owner-options li.share":"toggleShareSubmenu","click .owner-options nav.menu-dark-sub .share-options li":"shareAlbum","click .grid-selector .mini":"miniClicked","click .grid-selector .square":"squareClicked","click .grid-selector .masonry":"masonryClicked","click .bottom .edit":"editClicked","click .top .edit-mode a.save":"saveClicked","click .top .edit-mode a.cancel":"cancelClicked"},animationDuration:200,editMode:!1,ownerMode:!1,editAlbumLightboxView:null,initialize:function(a){_.extend(this,IS.Views.Mixins.GridItem),_.extend(this,IS.Views.Mixins.Header),_.extend(this,IS.Views.Mixins.Share),this.template=IS.helpers.loadTemplate("header_album_detail"),this.ownerMode=a.ownerMode||!1,this.sizesEnabled=a.sizesEnabled||!1,this.editAlbumLightboxView=new IS.Views.LightboxNewAlbum({id:"lightbox-add-album-edit",model:this.model}),this.dropdownSort=null,this.dropdownGrid=null,this.model.bind("change",this.render,this),store.enabled&&!store.get(IS.CONS.STORAGE.GRID_STYLE)&&store.set(IS.CONS.STORAGE.GRID_STYLE,IS.Views.GridPhoto.STYLE.MASONRY),this.setupElements(),this.$(".input, textarea").placeholder(),IS.vent.on("app_layout:content:size:change",this.resize,this)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{title:this.model.friendlyTitle({shorten:!1}),description:this.model.get("description"),date:IS.helpers.getDateString(1e3*this.model.get("creation_date")),showDescription:!(!this.model.get("description")||!this.model.get("description").length),isPublic:this.model.get("public"),directLink:"https:"+IS.CONS.SITE_URL+this.model.detailURL(),iOSDevice:IS.CONS.IOS_DEVICE,ownerMode:this.ownerMode,avatarURL:this.model.ownerAvatarURL({width:34,height:34}),isPrivate:this.model.isPrivate(),isPrivatePass:this.model.isPrivatePass(),showUserInfo:this.model.isPublic(),username:function(){var a=this.model.get("owner");return a&&a.username?a.username:"Unknown"}.bind(this),total:function(){return this.model.get("total")?IS.helpers.numberWithCommas(this.model.get("total")):0}.bind(this),squareActive:function(){return store.get(IS.CONS.STORAGE.GRID_STYLE)==IS.Views.GridPhoto.STYLE.SQUARE}.bind(this),masonryActive:function(){return store.get(IS.CONS.STORAGE.GRID_STYLE)==IS.Views.GridPhoto.STYLE.MASONRY}.bind(this),miniActive:function(){return store.get(IS.CONS.STORAGE.GRID_STYLE)==IS.Views.GridPhoto.STYLE.MINI}.bind(this)})),this.setupElements(),$(window).resize(),this},setupElements:function(){return this.$normalMode=this.$(".top .normal-mode"),this.$editMode=this.$(".top .edit-mode"),this.$ownerOptions=this.$(".owner-options"),this.$optionsTrigger=this.$(".menu .icon-menu-tall"),this.$description=this.$(".top .normal-mode .description"),this.$descriptionEdit=this.$(".top .edit-mode textarea"),this.$name=this.$(".top .normal-mode h1"),this.$nameEdit=this.$(".top .edit-mode input"),this.$shareSubmenu=this.$(".owner-options nav.menu-dark-sub.share"),this.$editTooltip=this.$(".edit*[data-tooltip]"),this.$editBtnIcon=this.$(".bottom .edit .icon"),this.$date=this.$(".top .date"),this.$saveBtn=this.$(".top .edit-mode a.save"),this.setupDropdowns(),this},setupDropdowns:function(){var a=IS.CONS.STORAGE.ALBUM_SORT_TYPE;this.dropdownSort=new IS.Views.Dropdown({el:this.$(".dropdown-sort"),hideSelection:!0}),this.dropdownGrid=new IS.Views.Dropdown({el:this.$(".dropdown-grid"),hideSelection:!0}),this.dropdownSort.on("change",function(b){b.value&&(store.enabled&&store.set(a,b.value),IS.et.pe("My Albums Header","Sort",b.name),IS.vent.trigger("grid_items:reset"))}),this.dropdownSort.on("clicked",function(){this.dropdownGrid.close()}.bind(this)),store.get(a)&&this.dropdownSort.setValue(IS.Collections.MyAlbumsDetail.SORT_TYPES[store.get(a).toUpperCase()],store.get(a)),this.dropdownGrid.on("change",function(a){a.value&&(store.enabled&&store.set(IS.CONS.STORAGE.GRID_STYLE,a.value),IS.vent.trigger("grid_items:reset"),IS.et.pe("My Albums Header","Grid",a.value))}),this.dropdownGrid.on("clicked",function(){this.dropdownSort.close()}.bind(this)),store.get(IS.CONS.STORAGE.GRID_STYLE)&&this.dropdownGrid.setValue(null,store.get(IS.CONS.STORAGE.GRID_STYLE),function(){switch(store.get(IS.CONS.STORAGE.GRID_STYLE)){case 1:return"icon-masonry-grid";case 2:return"icon-square-grid";case 3:return"icon-thumbnail-grid"}}())},resize:function(a){a=_.extend(a,{$el:this.$el,windowPadding:200,sizesEnabled:this.sizesEnabled}),this.resizeToGrid(a)},reset:function(){this.model.fetch({success:function(){this.render()}.bind(this),error:function(){IS.logger.error("Unable to reset album header",this.model.attributes)}.bind(this)})},addImages:function(){return IS.et.pe("My Albums Header","Click","Add New Images"),IS.currentUser.canUpload()?(IS.helpers.initFileUploader(),void this.hideOwnerOptions()):void IS.helpers.showTrialExpiredDialog()},deleteAlbum:function(){this.hideOwnerOptions(),
IS.et.pe("My Albums Header","Click","Delete Album"),IS.helpers.confirmAction({message:"Are you sure you want to delete this album?"}).done(function(){this.model.destroy({success:function(){IS.et.pe("My Albums Header","Delete","Album"),IS.cm.invalidateByCacheKey("my_albums"),IS.vent.trigger("app_layout:navbar:remove_album_link",{id:this.model.get("id")}),Backbone.history.navigate("/my/albums/1",!0),_.defer(function(){var a=this.model.friendlyTitle();IS.helpers.displayUserMessage('Successfully deleted "'+a+'" album.')}.bind(this))}.bind(this)})}.bind(this))},show:function(){this.$el.addClass("show")},hide:function(){this.$el.removeClass("show")},hideOwnerOptions:function(){this.$optionsTrigger.removeClass("active"),this.$ownerOptions.removeClass("fadeInDown").addClass("fadeOutUp"),this.$shareSubmenu.hasClass("fadeInDown")&&this.toggleShareSubmenu(),_.delay(function(){this.$ownerOptions.hide()}.bind(this),this.animationDuration)},showOwnerOptions:function(){this.$ownerOptions.removeClass("fadeOutUp").show().addClass("fadeInDown"),_.delay(function(){this.$ownerOptions.addClass("visible")}.bind(this),50)},toggleOwnerOptions:function(){this.$optionsTrigger.toggleClass("active"),this.$optionsTrigger.hasClass("active")?this.showOwnerOptions():this.hideOwnerOptions()},toggleShareSubmenu:function(a){var b=this.$shareSubmenu.hasClass("fadeInDown");b?(this.$shareSubmenu.removeClass("fadeInDown").addClass("fadeOutUp"),setTimeout(function(){this.$shareSubmenu.hide()}.bind(this),150)):(IS.et.pe("Grid Item","Click","Share"),this.$shareSubmenu.removeClass("fadeOutUp").show().addClass("fadeInDown"))},highlightLink:function(a){IS.et.pe("My Albums Header","Click","Direct Textfield"),$(a.currentTarget).focus().select()},showEditLightbox:function(){this.editAlbumLightboxView.show(),this.hideOwnerOptions()},editClicked:function(){this.editMode||(this.editMode=!0,this.dropdownSort&&this.dropdownSort.close(),this.dropdownGrid&&this.dropdownGrid.close(),this.$editBtnIcon.addClass("active"),this.$editTooltip.trigger("mouseleave"),this.$normalMode.hide(),this.$editMode.show(),this.$date.hide(),this.$nameEdit.select().focus(),IS.et.pe("My Albums Header","Edit","Opened"))},cancelClicked:function(){this.$normalMode.show(),this.$editMode.hide(),this.$date.show(),this.$editBtnIcon.removeClass("active"),this.editMode=!1},saveClicked:function(){var a=this.$descriptionEdit.val(),b=this.$nameEdit.val();this.$saveBtn.html("SAVING..."),this.$saveBtn.addClass("disabled"),this.model.save({description:a,title:b},{success:function(){this.$description.html(a),this.$descriptionEdit.html(a),this.$name.html(b),this.$nameEdit.val(b),this.$editTooltip.trigger("mouseleave"),this.$normalMode.show(),this.$editMode.hide(),this.$date.show(),this.$editBtnIcon.removeClass("active"),this.$saveBtn.html("SAVE"),this.$saveBtn.removeClass("disabled"),this.editMode=!1,IS.vent.trigger("app_layout:navbar:rename_album_link",{id:this.model.id,name:this.model.friendlyTitle({len:13})});var c=IS.currentUser.get("albums").find(function(a){return a.get("id")==this.model.get("id")}.bind(this));c&&c.set({title:this.model.get("title"),album_title:this.model.get("title")}),IS.vent.trigger("grid_items:rerender",{updates:{album:{title:b,id:this.model.id}}})}.bind(this),error:function(){IS.helpers.displayUserError("Something went wrong. Please try again later."),IS.logger.error("Unable to update album description",this.model.attributes),this.resetEditFields(),this.editMode=!1}.bind(this)}),IS.et.pe("My Albums Header","Edit","Saved")},avatarClicked:function(){var a=this.model.get("owner").username;a&&Backbone.history.navigate("/user/"+a,!0)},destroy:function(){this.editAlbumLightboxView.destroy(),Backbone.View.prototype.destroy.call(this)}}),IS.Views.HeaderAlbumDetailMobile=Backbone.View.extend({className:"album-detail-mobile clearfix",tagName:"header",events:{"click .left .icon-menu":"menuClicked"},initialize:function(){this.template=IS.helpers.loadTemplate("header_album_detail_mobile")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{title:this.model.friendlyTitle({shorten:!1}),hasDescription:!!this.model.get("description").length,description:IS.helpers.shortenText(this.model.get("description"),40),count:this.model.get("total")||0,isPrivate:this.model.isPrivate(),isPrivatePass:this.model.isPrivatePass(),showLock:!this.model.get("public"),showMenu:IS.currentUser&&this.model.isUserOwner(IS.currentUser)})),this},menuClicked:function(){IS.vent.trigger("mobile_layout:show_edit_album_overlay",{model:this.model})}}),IS.Views.HeaderLegacy=Backbone.View.extend({el:"header.legacy",events:{"hover .right .search":"searchHover","focus .right .search input":"searchActive","blur .right .search input":"searchInactive","keyup .right .search input":"searchKeyup"},initialize:function(){this.$searchInput=this.$(".right .search input"),this.$searchIcon=this.$(".right .search .icon"),this.$searchIconDark=this.$(".right .search .icon-dark"),this.searchIconDarkActive=!1},searchActive:function(){this.searchIconDarkActive=!0},searchInactive:function(){this.$searchInput.val().length<=0&&(this.searchIconDarkActive=!1,this.$searchIconDark.cssFade("out",150))},searchHover:function(a){"mouseenter"==a.type?this.$searchIconDark.cssFade("in",150):this.searchIconDarkActive||this.$searchIconDark.cssFade("out",150)},searchKeyup:function(a){IS.helpers.isEnterKey(a.which)&&$.trim(this.$searchInput.val()).length>=1&&(window.location="/photos/"+this.$searchInput.val())}}),IS.Views.HeaderMain=Backbone.View.extend({el:"header.main",events:{"click .h-trackable":"trackEvent"},initialize:function(){this.loggedInView=new IS.Views.HeaderMainLoggedIn,this.loggedOutView=new IS.Views.HeaderMainLoggedOut({noFBRedirect:this.options.noFBRedirect})},trackEvent:function(a){IS.et.pe("Header","Click",$(a.currentTarget).data("label"))}}),IS.Views.HeaderMainLoggedIn=Backbone.View.extend({el:".logged-in",events:{"keyup .search input":"searchKeypress","click .search input":"searchClicked","click .nav-box":"navboxClicked","click .activity":"activityClicked","click .upload-button":"openUploader","click .nav-box .bb-history":"navigateTo","click a.username":"usernameClicked","click .avatar":"avatarClicked","click .trackable":"trackEvent"},activityCount:0,initialize:function(){this.$navbox=this.$(".nav-box"),this.$nav=this.$navbox.find("nav"),this.$avatar=this.$(".avatar"),this.$username=this.$("a.username"),this.$activity=this.$(".activity"),this.$activityLoading=this.$activity.find(".loading"),this.$activityNoResults=this.$activity.find(".no-results"),this.$activityBadge=this.$activity.find(".badge"),this.activityPollTimer=null,this.activityPollXhr=null,IS.vent.on({"body:clicked":this.bodyClicked,"header_main:update_avatar":this.updateAvatar,"header_main:update_username":this.updateUsername,"header_main:show:search":this.showSearch,"header_main:hide:search":this.hideSearch,"header_main:open_uploader":this.openUploader},this),this.$(".right .search input").placeholder(),this.pollForActivity(!0),this.setupAutocomplete()},pollForActivity:function(a){if(IS.currentUser){var b=function(){this.activityPollXhr=IS.Collections.Activities.newCount(function(a){a.success&&(this.activityCount=a.result,this.activityCount>0?this.$activityBadge.html(a.result).addClass("show"):this.activityCount<=0&&this.$activityBadge.html(a.result).removeClass("show"))}.bind(this))}.bind(this);this.activityPollTimer=setInterval(b,2e4),a&&b()}},stopActivityPoll:function(){clearInterval(this.activityPollTimer),this.activityPollXhr&&4!=this.activityPollXhr.readystate&&this.activityPollXhr.abort()},searchKeypress:function(a){var b=$(a.currentTarget);if(IS.helpers.isEnterKey(a.which)){var c=$(".autocomplete-suggestions.type-search > .autocomplete-selected");if(!c.length){IS.et.pe("Header","Search","Submit By Enter");var d=encodeURIComponent($.trim(b.val()));Backbone.history.navigate("/search/"+d+"/1/?g=0",!0),b.val("").removeClass("active")}}},searchClicked:function(a){IS.et.pe("Header","Search","Clicked")},bodyClicked:function(a){var b=$(a.event.target);b[0]!=this.$navbox[0]&&b[0]!=this.$activity[0]&&(b.parents(".nav-box, .activity").length||(this.$navbox.hasClass("active")&&this.navboxClicked(),this.$activity.hasClass("active")&&this.activityClicked()))},navboxClicked:function(){IS.et.pe("Header","Click","Navbox"),this.$navbox.toggleClass("active"),this.$nav.toggleClass("active"),this.$activity.removeClass("active"),this.$username.focus()},openUploader:function(){IS.et.pe("Header","Click","Upload Button");var a=IS.Views.Mixins.Messages;return IS.currentUser&&IS.currentUser.get("isBanned")?void IS.helpers.confirmAction({message:a.acctBanned,sub_message:Mustache.render(a.acctBannedSub),confirm_text:"Upgrade",centered:!0}).done(function(){IS.et.pe("Confirm Action","Click","Upgrade - Upload Button Account Banned"),window.location="/upgrade"}):void IS.helpers.initFileUploader()},navigateTo:function(){IS.vent.trigger("app_layout:navbar:reset_nav_state")},usernameClicked:function(){IS.et.pe("Header","Click","Username")},avatarClicked:function(){IS.et.pe("Header","Click","Avatar")},updateAvatar:function(a){if(!a.avatar)return IS.logger.error("Must pass avatar to update");var b=this.$avatar.find("img");if(b.length)b.attr("src",a.avatar);else{var c=$('<img src="'+a.avatar+'" />');this.$avatar.append(c)}},updateUsername:function(a){return a.username?void this.$username.html(a.username).attr("href","/user/"+a.username):IS.logger.error("Must pass username to update")},trackEvent:function(a){IS.et.pe("Main Menu","Click",$(a.currentTarget).data("label"))},showSearch:function(){this.$(".search").removeClass("hidden")},hideSearch:function(){this.$(".search").addClass("hidden")},activityClicked:function(a){IS.et.pe("Header","Click","Activity");var b=this;this.$activity.toggleClass("active"),this.$navbox.removeClass("active"),this.$nav.removeClass("active");var c=this.$el.find(".activity-dropdown"),d=c.find(".wrapper");if(this.$activity.hasClass("active")){this.stopActivityPoll(),this.activityCount>0&&(this.$activityBadge.removeClass("show"),IS.Collections.Activities.viewed(function(a){this.activityCount=0}.bind(this))),this.$activityNoResults.hide(),this.$activityLoading.show(),this.setupActivityInfiniteScroll(),c.find(".item").remove();var e=new IS.Collections.Activities(null,{limit:20});e.on("fetch:success",function(){this.length&&c.addClass("loaded"),this.each(function(a){var b=new IS.Views.HeaderMainLoggedInActivityItem({model:a});d.append(b.render().el)})}),e.on("fetch:completed",function(){b.$activityLoading.hide(),this.length||b.$activityNoResults.show()}),e.fetch()}else c.removeClass("loaded"),this.pollForActivity(!1)},setupActivityInfiniteScroll:function(){var a=this.$el.find(".activity-dropdown"),b=a.find(".wrapper"),c=new IS.Collections.Activities(null,{limit:20}),d=function(){c.isFetching||c.nextPage({success:function(c,d){IS.et.pe("Header","Activity","Next Page Loaded"),d.areMorePages||IS.helpers.removeInfiniteScroll({$target:a}),c.result&&c.result.activities&&_.each(c.result.activities,function(a){var c=new IS.Views.HeaderMainLoggedInActivityItem({model:new IS.Models.Album(a)});b.append(c.render().el)})}})};IS.helpers.infiniteScroll({$target:a,$reference:b,threshold:700,callback:d})},setupAutocomplete:function(){IS.currentUser&&this.$("div.search input").autocomplete({serviceUrl:"/rest_api/v2/user/"+IS.currentUser.get("username")+"/combined_search",paramName:"keywords",groupBy:"category",width:284,maxHeight:350,deferRequestBy:50,triggerSelectOnValidInput:!1,showNoSuggestionNotice:!0,noSuggestionNotice:"No Results",params:{auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY,wildcard:!0,limit:5},beforeRender:function(a){$(a).addClass("type-search")},formatResult:function(a,b){var c="";if("PEOPLE"==a.data.category){if(c+='<div class="avatar">',a.data.avatar&&a.data.avatar.id.length){var d=IS.helpers.getAvatarLink(20,a.data.avatar);c+='<img src="'+d+'"></img>'}c+="</div>"}return c+='<div class="suggestion">',c+=IS.helpers.shortenText(a.value,28),c+="</div>"},onSelect:function(a){var b=a.data;switch(b.category){case"IMAGES":IS.et.pe("Header","Search","Image Clicked");var c="/search/"+a.value+"/1/?g=0";Backbone.history.navigate(c,!0);break;case"ALBUMS":IS.et.pe("Header","Search","Album Clicked");var d=new IS.Models.Album({id:b.id});Backbone.history.navigate(d.detailURL(),!0);break;case"PEOPLE":IS.et.pe("Header","Search","User Clicked");var c="/user/"+b.username;Backbone.history.navigate(c,!0)}$(this).val("")},transformResult:function(a){var a=$.parseJSON(a),b={};a.result&&(b=a.result);var c={suggestions:[]};return b.images_keywords&&b.images_keywords.length&&_.each(b.images_keywords,function(a,b){c.suggestions.push({value:a,data:{category:"IMAGES",id:a.id}})}),b.albums&&b.albums.length&&_.each(b.albums,function(a,b){a.title&&a.title.length&&c.suggestions.push({value:a.title,data:{category:"ALBUMS",id:a.id}})}),b.users&&b.users.length&&_.each(b.users,function(a,b){var d,e="",f="";a.first_name&&a.first_name.length&&(e=a.first_name),a.last_name&&a.last_name.length&&(f=a.last_name),d=e||f?$.trim(e+" "+f):a.username,c.suggestions.push({value:d,data:{category:"PEOPLE",username:a.username,avatar:a.avatar}})}),c}})}}),IS.Views.HeaderMainLoggedInActivityItem=Backbone.View.extend({tagName:"div",className:"item",events:{click:"clicked"},initialize:function(){this.template=IS.helpers.loadTemplate("activity_item")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{text:this.model.get("text"),time:IS.helpers.getPrettyDate(1e3*this.model.get("date"),!0)+" ago",hasAvatar:function(){var a=this.model.get("object");return 4==this.model.get("objectType")?!!a.avatar.filename:!0}.bind(this),imageUrl:function(){var a=this.model.get("object");if(4==this.model.get("objectType")){var b=a.avatar;return IS.helpers.getImagizerLink({server:b.server,filename:b.filename,width:34,height:34,cropped:!0})}return IS.helpers.getImagizerLink({server:a.server,filename:a.filename,width:34,height:34,cropped:!0})}.bind(this),hasManyImgs:function(){return 6==this.model.get("actionType")}.bind(this),imgs:function(){var a="";return _.each(this.model.get("images"),function(b,c){c>5||(a+=Mustache.render(IS.inlineTemplates.activity_image,{imageUrl:IS.helpers.getImagizerLink({server:b.server,filename:b.filename,width:34,height:34,cropped:!0})}))}),a}.bind(this)})),this.$el.attr("data-action-type",this.model.get("actionType")),this},clicked:function(){var a;switch(IS.et.pe("Header","Activity","Item Clicked"),this.model.get("objectType")){case 1:a="/i/"+this.model.get("object").id;break;case 4:a=1==this.model.get("images").length?"/i/"+this.model.get("images")[0].id:"/user/"+this.model.get("actor").username}Backbone.history.navigate(a,!0)}}),IS.Views.HeaderMainLoggedOut=Backbone.View.extend({el:".logged-out",events:{"click .signup-button":"signupClicked","click a.login":"loginClicked","click nav.dropdown a.keep":"keepLoggedClicked","click nav.dropdown .login-button":"doLogin","click .forgot":"forgotClicked","submit form":"doLogin","click .button-large-facebook":"trackFB"},initialize:function(){_.extend(this,IS.Views.Mixins.Auth),this.$loginButton=this.$("a.login"),this.$nav=this.$("nav.dropdown"),this.$usernameInput=this.$("input.username"),this.$passwordInput=this.$("input.password"),this.$keepCheckbox=this.$nav.find(".keep-checkbox"),this.$error=this.$(".error"),this.$loginButton=this.$(".login-button"),this.$nextPage=this.$(".next-page").length?this.$(".next-page").val():null,this.FBAuthButtonView=new IS.Views.FBAuthButton({noRedirect:this.options.noFBRedirect}),this.$("input").placeholder(),this.activeRequest=!1},signupClicked:function(){IS.et.pe("Header","Click","Signup"),window.location="/signup"},loginClicked:function(a){return a.preventDefault(),IS.et.pe("Header","Click","Login"),window.location.hostname.match(".us")?void(window.location="http://imageshack.com/login"):($(a.currentTarget).toggleClass("active"),this.$nav.toggle(),void this.$usernameInput.focus())},keepLoggedClicked:function(){IS.et.pe("Header","Click","Keep Me Logged In"),this.$keepCheckbox.prop("checked",!this.$keepCheckbox.prop("checked"))},forgotClicked:function(){IS.et.pe("Header","Click","Forgot Password")},doLogin:function(a){var b=this;return a.preventDefault(),this.activeRequest?!1:this.validate()?(this.hideError(),IS.et.pe("Header","Click","Login Button"),this.activeRequest=!0,this.disableForm(),void IS.Models.User.login(this.getUsernameInputVal(),this.getPasswordInputVal(),this.$keepCheckbox.is(":checked"),function(a){setTimeout(function(){if(a.success){IS.et.pe("Header","Login","Success"),IS.currentUser=new IS.Models.User({authToken:a.result.auth_token});var c=new IS.Models.Settings;c.once("sync",function(a){if(b.$nextPage)window.location=b.$nextPage;else switch(parseInt(a.get("start_page"))){case IS.Models.Settings.START_PAGE.MY_ALBUMS:window.location="/my/albums";break;case IS.Models.Settings.START_PAGE.FOLLOWING:window.location="/my/following";break;default:window.location="/my/images"}}),c.fetch()}else b.enableForm(),b.resetPasswordInput(),a.error&&32==a.error.error_code?b.showError("inactiveAccount",!1,b.getUsernameInputVal()):b.showError("badAuth",!1);b.activeRequest=!1},300)},function(){b.enableForm(),b.resetPasswordInput(),b.showError("badAuth",!1),b.activeRequest=!1})):!1},validate:function(){return this.getUsernameInputVal()||this.getPasswordInputVal()?this.getUsernameInputVal()?this.getPasswordInputVal()?!0:(this.showError("emptyPassword",!1),!1):(this.showError("emptyUsername",!1),!1):(this.showError("emptyBoth",!1),!1)},getUsernameInputVal:function(){return $.trim(this.$usernameInput.val())},getPasswordInputVal:function(){return $.trim(this.$passwordInput.val())},resetPasswordInput:function(){this.$passwordInput.val("")},disableForm:function(){this.$loginButton.html("LOGGING IN...").addClass("disabled")},enableForm:function(){this.$loginButton.html("LOG IN").removeClass("disabled")},trackFB:function(){IS.et.pe("Header","Click","Facebook Button")}}),IS.Views.HeaderMainMobile=Backbone.View.extend({tagName:"header",className:"main-mobile",TYPES:{0:"normal",1:"landing",2:"profile",3:"back_arrow"},type:null,uploaderView:null,events:{'click section[data-type="normal"] > span.icon-menu':"menuClicked","click section.menu > span.icon-menu":"menuCloseClicked","click span.icon-back-arrow":"backButtonClicked",'click section[data-type="landing"] span.icon-delete':"deleteButtonClicked","click section.menu img.avatar":"toMyProfile","click section.menu .content .name":"toMyProfile","click section.menu section.bottom a":"menuOptionClicked","click a.icon-frog":"logoClicked"},initialize:function(a){a=a||{},_.defaults(a,{type:"normal"},{}),this.template=IS.helpers.loadTemplate("header_main_mobile"),this.type=a.type,IS.vent.on({"header_main_mobile:show_upload_arrow":this.showUploadArrow,"header_main_mobile:show_delete_button":this.showDeleteButton,"header_main_mobile:hide_delete_button":this.hideDeleteButton},this)},render:function(){var a=function(a){return Backbone.history.getFragment()==a};return this.$el.html(IS.helpers.renderTemplate(this.template,{activeMyImages:a("my/images"),activeMyAlbums:a("my/albums"),activeMyFollowing:a("my/following"),username:IS.currentUser?IS.currentUser.get("username"):null,userLoggedIn:!!IS.currentUser,activeProfile:function(){return IS.currentUser?a("user/"+IS.currentUser.get("username")):!1},avatarURL:function(){return IS.currentUser?IS.helpers.getImagizerLink({server:IS.currentUser.get("avatarServer"),filename:IS.currentUser.get("avatarFilename"),cropped:!0,width:112,height:112}):null}})),this.setupElements(),"landing"==this.type?this.showLandingState():"profile"==this.type?this.showProfileState():"back_arrow"==this.type?this.showBackArrowState():this.showNormalState(),this.uploaderView&&this.uploaderView.destroy&&this.uploaderView.destroy(),this.uploaderView=new IS.Views.HeaderMainMobileUploader({el:this.$el}),_.defer(function(){this.renderAvatarBlurredBG()}.bind(this)),this},setupElements:function(){return this.$sectionNormal=this.$('section[data-type="normal"]'),this.$sectionLanding=this.$('section[data-type="landing"]'),this.$menu=this.$("section.menu"),this.$menuButton=this.$("span.icon-menu"),this.$menuBlurredBG=this.$menu.find(".blurred-bg"),this.$backArrowButton=this.$("span.icon-back-arrow"),this.$uploadArrow=this.$("span.icon-arrow"),this.$deleteButton=this.$("span.icon-delete"),this.$uploadButton=this.$(".upload-icon-wrapper"),this},menuClicked:function(){IS.et.pe("Header Mobile","Click","Menu Show"),this.$menu.show(),IS.vent.trigger("body:disable_scrolling")},menuCloseClicked:function(){IS.et.pe("Header Mobile","Click","Menu Hide"),this.$menu.hide(),IS.vent.trigger("body:enable_scrolling")},backButtonClicked:function(){IS.et.pe("Header Mobile","Click","Back Button"),window.history.back()},deleteButtonClicked:function(){IS.et.pe("Header Mobile","Click","Landing Delete Button"),IS.vent.trigger("header_main_mobile:delete_clicked")},showNormalState:function(){this.$sectionNormal.show(),this.$sectionLanding.hide()},showLandingState:function(){this.$sectionNormal.hide(),this.$sectionLanding.show()},showProfileState:function(){this.showNormalState(),this.$menuButton.hide(),this.$backArrowButton.show()},showBackArrowState:function(){this.$menuButton.hide(),this.$backArrowButton.show(),this.$sectionNormal.show()},showUploadArrow:function(){this.$uploadArrow.show()},showDeleteButton:function(){this.$deleteButton.show()},hideDeleteButton:function(){this.$deleteButton.hide()},toMyProfile:function(){var a=IS.currentUser.get("username");a&&Backbone.history.navigate("/user/"+a,!0)},renderAvatarBlurredBG:function(){if(IS.currentUser&&IS.currentUser.get("avatarFilename")&&IS.currentUser.get("avatarServer")){var a=new Image,b=IS.helpers.getImagizerLink({server:IS.currentUser.get("avatarServer"),filename:IS.currentUser.get("avatarFilename"),width:this.$menu.width(),height:185,quality:60},!0);a.onload=function(){this.$menuBlurredBG.css("background-image",'url("'+b+'")').addClass("visible")}.bind(this),a.src=b}},menuOptionClicked:function(a){var b=$(a.currentTarget),c=b.data("type");c&&IS.et.pe("Header Mobile","Click",c)},logoClicked:function(){IS.et.pe("Header Mobile","Click","Logo")},destroy:function(){IS.vent.trigger("body:enable_scrolling"),this.uploaderView&&this.uploaderView.destroy(),Backbone.View.prototype.destroy.call(this)}}),IS.Views.HeaderMainMobileUploader=Backbone.View.extend({tagName:"header",className:"main-mobile",currentAlbum:null,uploaderBarTimeout:null,events:{"click form.main input":"uploaderIconClicked","change form.fake-upload":"formChanged","click section.upload-overlay a.cancel":"cancelUploadClicked","click section.upload-overlay > .icon-close":"closeClicked","click section.upload-overlay section.error a.close":"closeClicked"},initialize:function(){this.$uploadBtn=this.$(".upload-icon-wrapper"),this.$fakeInput=this.$("form input.file-input-first"),this.$overlay=this.$("section.upload-overlay"),this.$uploaderBar=this.$overlay.find(".uploader .bar"),this.$closeBtn=this.$overlay.find("> .icon-close"),this.$uploadingText=this.$overlay.find("section.uploading h1"),this.$sectionUploading=this.$overlay.find("section.uploading"),this.$sectionError=this.$overlay.find("section.error"),this.$sectionAlbum=this.$overlay.find("section.location"),this.$albumInput=this.$("input.album-id"),this.$uploadBtn.show(),IS.vent.on({"mobile_uploader:set_current_album":this.setCurrentAlbum,"mobile_uploader:show":this.showOverlay,"mobile_uploader:upload_file":this.fileToUploadSent},this)},uploaderIconClicked:function(a){IS.et.pe("Header Mobile","Click","Upload Button"),this.currentAlbum&&(a&&a.preventDefault(),this.$closeBtn.show(),this.showOverlay(),this.$sectionAlbum.show())},formChanged:function(a){var b=$(a.currentTarget);return this.$sectionAlbum.hide(),this.$sectionUploading.show(),this.showOverlay(),this.isValidFile(b)?(this.uploaderBarTimeout=_.delay(function(){this.$uploaderBar.addClass("loading")}.bind(this),1e3),void this.uploadFile(b)):void this.showErrorSection()},isValidFile:function(a){var b=a.find('input[type="file"]'),c=b[0].files[0].type.toLowerCase();return IS.CONS.UPLOADER.ACCEPTED_TYPES[c]},uploadFile:function(a){a.ajaxSubmit({resetForm:!0,dataType:"json",data:{auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY_MOBILE},success:function(b){b&&b.success&&b.result&&b.result.images&&b.result.images.length?(IS.et.pe("Uploader Mobile","Success"),this.$uploaderBar.addClass("loaded"),this.$uploadingText.html("Finishing up..."),_.delay(function(){IS.cm.invalidateByCacheKey("my_images"),IS.cm.invalidateByCacheKey("my_albums"),"album"==a.data("type")?Backbone.history.loadUrl():-1!=Backbone.history.fragment.indexOf("my/images")?Backbone.history.loadUrl():Backbone.history.navigate("/my/images",!0),this.hideOverlay()}.bind(this),1500)):(IS.et.pe("Uploader Mobile","Error",b.result),this.showErrorSection())}.bind(this),error:function(a){IS.et.pe("Uploader Mobile","Error",a.result),this.showErrorSection()}.bind(this)})},showOverlay:function(){this.$overlay.show(),IS.vent.trigger("body:disable_scrolling")},hideOverlay:function(){this.$overlay.hide(),IS.vent.trigger("body:enable_scrolling")},cancelUploadClicked:function(){IS.et.pe("Uploader Mobile","Click","Cancel Upload"),window.stop(),this.hideOverlay(),this.resetState()},showErrorSection:function(){this.$sectionUploading.hide(),this.$sectionError.show(),this.$closeBtn.show()},closeClicked:function(){IS.et.pe("Uploader Mobile","Click","Close Overlay"),this.cancelUploadClicked()},resetState:function(){clearTimeout(this.uploaderBarTimeout),this.$uploaderBar.removeClass("loaded").removeClass("loading"),this.$uploadingText.html("Uploading..."),this.$sectionUploading.hide(),this.$sectionError.hide(),this.$sectionAlbum.hide(),this.$closeBtn.hide()},tryAgainClicked:function(){IS.et.pe("Uploader Mobile","Click","Try Again"),this.$fakeInput.click()},setCurrentAlbum:function(a){(a.album||a.album.id)&&(!IS.currentUser||a.album.isUserOwner(IS.currentUser))&&(this.currentAlbum=a.album,this.$albumInput.attr("value",this.currentAlbum.id))},fileToUploadSent:function(a){this.formChanged(a.event)}}),IS.Views.HeaderManage=Backbone.View.extend({tagName:"header",className:"manage",events:{},initialize:function(a){_.extend(this,IS.Views.Mixins.Header),this.template=IS.helpers.loadTemplate("header_manage"),0==a.windowPadding?this.windowPadding=0:this.windowPadding=a.windowPadding||200,this.maxWidth=a.maxWidth||Number.MAX_VALUE,store.enabled&&!store.get(IS.CONS.STORAGE.GRID_STYLE)&&store.set(IS.CONS.STORAGE.GRID_STYLE,IS.Views.GridPhoto.STYLE.MASONRY),this.setupElements(),IS.vent.on("app_layout:content:size:change",this.resize,this)},render:function(){var a=IS.helpers.renderTemplate(this.template,_.extend(this.model.toJSON(),{squareActive:function(){return store.get(IS.CONS.STORAGE.GRID_STYLE)==IS.Views.GridPhoto.STYLE.SQUARE}.bind(this),masonryActive:function(){return store.get(IS.CONS.STORAGE.GRID_STYLE)==IS.Views.GridPhoto.STYLE.MASONRY}.bind(this),miniActive:function(){return store.get(IS.CONS.STORAGE.GRID_STYLE)==IS.Views.GridPhoto.STYLE.MINI}.bind(this),disableGridDropdown:!store.enabled}));return this.$el.html(a),this.setupElements(),this.model.get("showControls")&&(this.dropdownGrid=new IS.Views.Dropdown({el:this.$(".dropdown-grid"),hideSelection:!0}),this.dropdownGrid.on("change",function(a){a.value&&(store.enabled&&store.set(IS.CONS.STORAGE.GRID_STYLE,a.value),IS.vent.trigger("grid_items:reset"),IS.et.pe("Grid Selector","Click",a.value))}),store.get(IS.CONS.STORAGE.GRID_STYLE)&&this.dropdownGrid.setValue(null,store.get(IS.CONS.STORAGE.GRID_STYLE),function(){switch(store.get(IS.CONS.STORAGE.GRID_STYLE)){case 1:return"icon-masonry-grid";case 2:return"icon-square-grid";case 3:return"icon-thumbnail-grid"}}())),this},setupElements:function(){return this},show:function(){return $(window).trigger("resize"),_.defer(function(){this.$el.addClass("show")}.bind(this)),this},resize:function(a){a=_.extend({$el:this.$el,windowPadding:this.windowPadding,sizesEnabled:this.model&&this.model.get("sizesEnabled"),max:this.maxWidth},a),this.resizeToGrid(a)}}),IS.Views.HeaderPremiumBanner=Backbone.View.extend({tagName:"header",className:"premium-banner",events:{"click a.upgrade":"upgradeClicked","click .icon-close":"close"},cookieKey:"header_premium_banner",initialize:function(a){a=a||{},this.template=IS.helpers.loadTemplate("header_premium_banner"),this.setupElements()},render:function(){if(!this.shouldShow())return this.$el;var a=IS.helpers.renderTemplate(this.template,{});return this.$el.html(a),this.setupElements(),this},setupElements:function(){return this},shouldShow:function(){return!1},show:function(){return this.shouldShow()?(IS.et.pe("Header Premium Banner","Show"),this):void 0},close:function(){IS.et.pe("Header Premium Banner","Click","Close"),$.cookie(this.cookieKey,1,{expires:1825,path:"/"}),this.destroy()},upgradeClicked:function(){IS.et.pe("Header Premium Banner","Click","Upgrade"),$.cookie(this.cookieKey,1,{expires:1825,path:"/"})}}),IS.Views.HeaderProfile=Backbone.View.extend({tagName:"header",className:"user-profile",events:{"click .footer ul li":"liClicked","click .avatar .edit":"editProfile"},initialize:function(){_.extend(this,IS.Views.Mixins.Header),this.template=IS.helpers.loadTemplate("header_profile"),this.threshold=530,this.setupElements(),IS.vent.on("app_layout:content:size:change",this.resize,this),_.defer(function(){$(window).resize(),_.defer(function(){this.show()}.bind(this))}.bind(this)),IS.vent.on({"user:follow":this.incFollowCount,"user:unfollow":this.decFollowCount},this)},render:function(){var a=this,b=!1;return b=this.model.get("is_own_page")?IS.currentUser.get("isFeatured"):this.model.get("profile_user").is_featured,this.$el.html(IS.helpers.renderTemplate(this.template,{hasAvatar:function(){return!!this.avatarUrl()},avatarUrl:function(){var b;return b=a.model.get("is_own_page")?a.model.get("current_user").avatar_url:a.model.get("profile_user").avatar_url},username:function(){return a.model.get("is_own_page")?a.model.get("current_user").username:a.model.get("profile_user").username},bio:function(){return a.model.get("is_own_page")?a.model.get("current_user").description:a.model.get("profile_user").description},location:function(){return a.model.get("is_own_page")?a.model.get("current_user").location:a.model.get("profile_user").location},hasLocation:function(){return a.model.get("is_own_page")?!!a.model.get("current_user").location:!!a.model.get("profile_user").location},currentPagePhotos:function(){return-1==Backbone.history.location.pathname.indexOf("albums")},currentPageAlbums:function(){return-1!=Backbone.history.location.pathname.indexOf("albums")},currentPageFollowers:function(){return-1!=Backbone.history.location.pathname.indexOf("followers")},currentPageFollowing:function(){return-1!=Backbone.history.location.pathname.indexOf("following")},photosTotal:function(){return IS.helpers.numberWithCommas(a.model.get("photos_total"))},albumsTotal:function(){return IS.helpers.numberWithCommas(a.model.get("albums_total"))},followersTotal:function(){return IS.helpers.numberWithCommas(a.model.get("followers_total"))},followingTotal:function(){return IS.helpers.numberWithCommas(a.model.get("following_total"))},likedTotal:function(){return a.model.get("liked_images_total")?IS.helpers.numberWithCommas(a.model.get("liked_images_total")):0},disableFollowButton:function(){var b=a.model.get("profile_user");return!b.following_allowed&&!b.is_followed},followValue:function(){return a.model.get("profile_user").is_followed?1:0},isFollowed:function(){return a.model.get("profile_user").is_followed},isOwnPage:function(){var b=a.model.get("profile_user")||a.model.get("current_user");return IS.currentUser&&IS.currentUser.get("username")==b.username},enabledFollowing:function(){return IS.currentUser&&!IS.currentUser.get("disabledFollow")},editProfileEnabled:function(){return!!a.model.get("is_own_page");
},showPremiumBadge:function(){return a.model.get("is_own_page")?"premium"==a.model.get("current_user").membership:"premium"==a.model.get("profile_user").membership},isFeatured:b})),this.setupElements(),this},setupElements:function(){this.$inner=this.$el.find(".inner"),this.$footer=this.$el.find(".footer"),this.$footerNav=this.$el.find(".footer nav"),this.$followerCount=this.$(".followers-total"),this.model.get("profile_user")&&new IS.Views.FollowButton({el:this.$(".footer .follow-button"),username:this.model.get("profile_user").username,ventEnabled:!0})},resize:function(a){a=_.extend(a,{$el:this.$inner}),this.resizeToGrid(a),a=_.extend(a,{$el:this.$footerNav});var b=this.resizeToGrid(a);b<this.threshold?(this.$inner.addClass("narrow"),this.$footer.addClass("narrow")):(this.$inner.removeClass("narrow"),this.$footer.removeClass("narrow"))},show:function(){return this.$el.addClass("active"),this},setCurrentPage:function(a){return this.$(".footer li.selected").removeClass("selected"),this.$(".footer li."+a).addClass("selected"),this},liClicked:function(a){var b=$(a.currentTarget).find("a").attr("href");Backbone.history.navigate(b,!0)},incFollowCount:function(){var a=+this.$followerCount.eq(0).text();this.$followerCount.text(a+1),this.model.get("profile_user").is_followed=!0},decFollowCount:function(){var a=+this.$followerCount.eq(0).text();this.$followerCount.text(a-1),this.model.get("profile_user").is_followed=!1},editProfile:function(){IS.et.pe("Header Profile","Click","Edit Profile"),Backbone.history.navigate("/my/settings",!0)}}),IS.Views.HeaderProfileMobile=Backbone.View.extend({tagName:"header",className:"user-profile-mobile",events:{"click section.bottom .icon-my-images":"toImages","click section.bottom .icon-my-albums":"toAlbums","click section.bottom .icon-like":"toLiked","click section.bottom a.follow-btn":"followClicked"},followButtonView:null,initialize:function(a){a=a||{},this.template=IS.helpers.loadTemplate("header_profile_mobile"),this.activeTab=a.activeTab,this.setupElements(),this.setupScroll()},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{imagesActive:"images"==this.activeTab,albumsActive:"albums"==this.activeTab,likedActive:"liked"==this.activeTab,avatarURL:function(){return this.model.get("is_own_page")?this.model.get("current_user").avatar_url:this.model.get("profile_user").avatar_url}.bind(this),username:function(){return this.model.get("is_own_page")?this.model.get("current_user").username:this.model.get("profile_user").username}.bind(this),isOwnPage:function(){var a=this.model.get("profile_user")||this.model.get("current_user");return IS.currentUser&&IS.currentUser.get("username")==a.username}.bind(this),disableFollowButton:function(){var a=this.model.get("profile_user");return!a.following_allowed&&!a.is_followed}.bind(this),followValue:function(){return this.model.get("profile_user").is_followed?1:0}.bind(this)})),this.setupElements(),this.setBackgroundImage(),this},setBackgroundImage:function(){var a;a=this.model.get("is_own_page")?this.model.get("current_user").avatar_url:this.model.get("profile_user").avatar_url,this.$backgroundBlur.css("background-image","url('"+a+"')")},setupElements:function(){this.$backgroundBlur=this.$("section.background-blur"),this.$bottomLarge=this.$("section.bottom section.large"),this.$bottomMini=this.$("section.bottom section.mini"),this.followButtonView=new IS.Views.FollowButtonMobile({el:this.$(".follow-btn"),username:this.model.get("username")})},toImages:function(){IS.et.pe("Header Profile Mobile","Click","Images");var a=this.model.get("username");Backbone.history.navigate("/user/"+a,!0)},toAlbums:function(){IS.et.pe("Header Profile Mobile","Click","Albums");var a=this.model.get("username");Backbone.history.navigate("/user/"+a+"/a",!0)},toLiked:function(){IS.et.pe("Header Profile Mobile","Click","Liked");var a=this.model.get("username");Backbone.history.navigate("/user/"+a+"/liked",!0)},enableMiniVersion:function(){this.$el.addClass("mini"),this.$bottomMini.show(),this.$bottomLarge.hide()},disableMiniVersion:function(){this.$el.removeClass("mini"),this.$bottomMini.hide(),this.$bottomLarge.show()},setupScroll:function(){var a=$(window),b=_.throttle(function(){a.scrollTop()>=150?this.enableMiniVersion():this.disableMiniVersion()}.bind(this),50);a.on("scroll",b)},followClicked:function(a){IS.currentUser?IS.et.pe("Header Profile Mobile","Click","Follow/Unfollow"):IS.et.pe("Header Profile Mobile","Click","Login To Follow")}}),IS.Views.HeaderSelectorMobile=Backbone.View.extend({tagName:"header",className:"selector clearfix",events:{"click section.left .icon-my-images":"toMyImages","click section.left .icon-my-albums":"toMyAlbums","click section.left .icon-following":"toFollowing","click section.left .icon-like":"toLiked","click section.right .icon-selector-feed":"enableFeed","click section.right .icon-selector-grid":"enableGrid","click section.right .icon-add-album":"addAlbumIconClicked"},initialize:function(a){a=a||{},this.template=IS.helpers.loadTemplate("header_selector_mobile"),this.activeTab=a.activeTab,this.gridSelectorVisible=a.gridSelectorVisible,this.addAlbumIconVisible=a.addAlbumIconVisible},setupElements:function(){this.$gridSelector=this.$("section.right")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{myImagesActive:"myImages"==this.activeTab,myAlbumsActive:"myAlbums"==this.activeTab,myLikedActive:"myLiked"==this.activeTab,followingActive:"following"==this.activeTab,gridSelectorVisible:!!this.gridSelectorVisible,addAlbumIconVisible:!!this.addAlbumIconVisible,feedIconVisible:function(){var a=store.get(IS.CONS.STORAGE.MOBILE_FEED_STYLE);return a==IS.CONS.MOBILE_FEED_STYLES.GRID},gridIconVisible:function(){var a=store.get(IS.CONS.STORAGE.MOBILE_FEED_STYLE);return a==IS.CONS.MOBILE_FEED_STYLES.FEED}})),this.setupElements(),this},toMyImages:function(){IS.et.pe("Header Selector Mobile","Click","My Images"),Backbone.history.navigate("/my/images",!0)},toMyAlbums:function(){IS.et.pe("Header Selector Mobile","Click","Albums"),Backbone.history.navigate("/my/albums",!0)},toFollowing:function(){IS.et.pe("Header Selector Mobile","Click","Following"),Backbone.history.navigate("/my/following",!0)},toLiked:function(){IS.et.pe("Header Selector Mobile","Click","Liked"),Backbone.history.navigate("/my/liked",!0)},enableGrid:function(){IS.et.pe("Header Selector Mobile","Click","Enable Grid"),store.enabled&&store.set(IS.CONS.STORAGE.MOBILE_FEED_STYLE,IS.CONS.MOBILE_FEED_STYLES.GRID),Backbone.history.loadUrl()},enableFeed:function(){IS.et.pe("Header Selector Mobile","Click","Enable Feed"),store.enabled&&store.set(IS.CONS.STORAGE.MOBILE_FEED_STYLE,IS.CONS.MOBILE_FEED_STYLES.FEED),Backbone.history.loadUrl()},addAlbumIconClicked:function(){IS.vent.trigger("mobile_layout:show_add_album_overlay")}}),IS.Views.HeaderUpgradeBanner=Backbone.View.extend({tagName:"header",className:"upgrade-banner",events:{"click a.upgrade":"upgradeClicked"},initialize:function(a){a=a||{},_.extend(this,IS.Views.Mixins.Header),this.template=IS.helpers.loadTemplate("header_upgrade_banner"),this.model=new Backbone.Model({sizesEnabled:!0}),0==a.windowPadding?this.windowPadding=0:this.windowPadding=a.windowPadding||200,this.maxWidth=a.maxWidth||Number.MAX_VALUE,this.setupElements(),IS.vent.on("app_layout:content:size:change",this.resize,this)},render:function(){if(!this.shouldShow())return this.$el;var a=IS.helpers.renderTemplate(this.template,{actionVerb:IS.currentUser.get("trialAccount")?"keep":"add"});return this.$el.html(a),this.setupElements(),this},setupElements:function(){return this},shouldShow:function(){return IS.currentUser&&IS.currentUser.get("creationDate")<1451606400&&(IS.currentUser.get("freeAccount")||IS.currentUser.get("trialAccount"))},show:function(){return this.shouldShow()?($(window).trigger("resize"),_.defer(function(){this.$el.addClass("show")}.bind(this)),IS.et.pe("Header Upgrade Banner","Show"),this):void 0},resize:function(a){a=_.extend({$el:this.$el,windowPadding:this.windowPadding,sizesEnabled:this.model&&this.model.get("sizesEnabled"),max:this.maxWidth},a),this.resizeToGrid(a)},upgradeClicked:function(){IS.et.pe("Header Upgrade Banner","Click","Upgrade")}}),IS.Views.Help=Backbone.View.extend({el:"#help",events:{"click .video-trigger":"showVideo"},initialize:function(){new IS.Views.HeaderMain,this.$video=$("#video-frame")},showVideo:function(a){this.$video.html(Mustache.render(IS.inlineTemplates.vimeo_src,{id:$(a.currentTarget).data("id"),width:510,height:290}))}}),IS.Views.HelpVideos=Backbone.View.extend({el:"#help-videos",events:{"click nav li":"navClicked","click .video-trigger":"showVideoPopup","click .contact a.button-large-yellow":"contactClicked"},initialize:function(){new IS.Views.HeaderMain,this.minScrollDuration=100,this.extraSpace=80,this.$window=$(window),this.$body=$("body"),this.animationDuration=450,this.defaultVideoHeight=557,this.videos={images:{height:609,id:"68335052",title:"HOW TO MANAGE IMAGES",desc:'You can only manage images under the "my images" panel. To do so select your images by holding down the the shift key which will give you a tool bar.'},uploader:{id:"68335053",title:"HOW TO USE THE UPLOADER"},delete_single_image:{id:"74671185",title:"HOW TO DELETE AN IMAGE"},delete_multi_images:{id:"74670995",title:"HOW TO DELETE MULTIPLE IMAGES"},image_privacy:{id:"74670937",title:"HOW TO CHANGE IMAGE PRIVACY"},delete_album:{id:"74671408",title:"HOW TO DELETE AN ALBUM"},share:{id:"74670406",title:"HOW TO SHARE"},get_links:{id:"83698365",title:"HOW TO GET LINKS"},use_lp:{id:"83695737",title:"HOW OUR LANDING PAGE WORKS"},rotate:{id:"83705245",title:"HOW TO ROTATE YOUR IMAGES"},change_size:{id:"83705135",title:"HOW TO CHANGE THE SIZE OF YOUR IMAGES"},add_tags:{id:"83699143",title:"HOW TO ADD TAGS"}},this.transitionDelay=400},navClicked:function(a){var b=$(a.currentTarget);if(IS.et.pe("Help","Click",b.data("label")),!b.hasClass("active")){b.addClass("active").siblings(".active").removeClass("active");var c=$("#"+b.data("id")),d=c.offset().top,e=this.$window.scrollTop()+this.$window.height();if(d+c.height()+this.extraSpace<e&&d>this.$window.scrollTop()+this.extraSpace)return void this.animateBox(c);var f=d-2*this.extraSpace;$("body,html").stop().animate({scrollTop:f},Math.max(this.minScrollDuration,f/2),"linear",function(){this.animateBox(c)}.bind(this))}},animateBox:function(a){a.addClass("scaleUp"),_.delay(function(){a.removeClass("scaleUp")}.bind(this),this.animationDuration)},showVideoPopup:function(a){var b=$(a.currentTarget),c=this.videos[b.data("video")],d=c.height||this.defaultVideoHeight;IS.helpers.displayOverlay({content:Mustache.render(IS.inlineTemplates.help_video,{video:Mustache.render(IS.inlineTemplates.vimeo_src,{id:c.id,width:749,height:421}),title:c.title,desc:c.desc||""}),width:829,height:d,otherClassName:"help-video"}),IS.et.pe("Help","Play Video",IS.helpers.capitalizeFirstLetter(b.data("video")))},contactClicked:function(){IS.et.pe("Help","Click","Contact Button")}}),IS.Views.Homepage=Backbone.View.extend({el:"#homepage",events:{"click .trackable":"trackableClicked","click .signup .button-large-yellow.signup":"goToSignup","click .grid .inner > a":"trackClick"},initialize:function(){new IS.Views.HeaderMain,this.$window=$(window)},trackableClicked:function(a){var b=$(a.currentTarget);IS.et.pe("Homepage","Click",b.data("label"))},goToSignup:function(){IS.et.pe("Homepage","Click","Bottom Signup Button"),window.location="/signup"},trackClick:function(){IS.et.pe("Homepage","Click","Grid Photo")}}),IS.Views.HomepageComing=Backbone.View.extend({el:"section.coming",events:{"click .arrow.left":"leftArrowClicked","click .arrow.right":"rightArrowClicked"},initialize:function(){this.currentPage=0,this.$leftArrow=this.$(".arrow.left"),this.$rightArrow=this.$(".arrow.right")},leftArrowClicked:function(){var a=this,b=this.currentPage-1;0>b||(0==b?this.$leftArrow.addClass("disabled"):this.$leftArrow.removeClass("disabled"),this.$rightArrow.removeClass("disabled"),this.getFrameAtIndex(this.currentPage).cssFade("out",350,function(c){c.hide(),a.getFrameAtIndex(b).cssFade("in",600)}),this.currentPage=b)},rightArrowClicked:function(){var a=this,b=this.currentPage+1;b>2||(2==b?this.$rightArrow.addClass("disabled"):this.$rightArrow.removeClass("disabled"),this.$leftArrow.removeClass("disabled"),this.getFrameAtIndex(this.currentPage).cssFade("out",350,function(c){c.hide(),a.getFrameAtIndex(b).cssFade("in",600)}),this.currentPage=b)},getFrameAtIndex:function(a){return this.$('.slide[data-index="'+a+'"]')}}),IS.Views.ImageCropper=Backbone.View.extend({tagName:"section",id:"image-cropper",events:{"click .controls .icon-close":"close","click .controls .cancel":"close","click .controls .save":"save"},initialize:function(a){this.template=IS.helpers.loadTemplate("image_cropper"),this.$body=$("body"),this.$window=$(window),this.coords=[],this.CONSTANTS={imageMargin:70,headerHeight:75,opacity:.35,boxSize:300},this.model.get("type")==IS.Views.ImageCropper.TYPE.AVATAR?this.$el.addClass("type-avatar"):this.model.get("type")==IS.Views.ImageCropper.TYPE.IMAGE&&this.$el.addClass("type-image"),IS.vent.once("body:keyup:escape",this.close,this)},render:function(){var a=this.getImageDimensions();return this.$el.html(IS.helpers.renderTemplate(this.template,{width:a.width,height:a.height,avatarType:this.model.get("type")==IS.Views.ImageCropper.TYPE.AVATAR,imageType:this.model.get("type")==IS.Views.ImageCropper.TYPE.IMAGE})),this.setupElements().loadImage().renderBlurredBG(),this},setupElements:function(){return this.$blurredBG=this.$(".blurred-bg"),this.$img=this.$(".crop-box img"),this.$saveBtn=this.$("article.controls a.save"),this},loadImage:function(){var a=new Image,b=this.getImageDimensions(),c=IS.helpers.getImagizerLink({server:this.model.get("server"),filename:this.model.get("filename"),width:b.width,height:b.height});return a.onload=function(){this.$img.attr("src",c),_.defer(function(){this.startCropper()}.bind(this))}.bind(this),a.src=c,this},renderBlurredBG:function(){var a=new Image,b=IS.helpers.getImagizerLink({server:this.model.get("server"),filename:this.model.get("filename"),width:this.$window.width(),height:this.$window.height(),quality:50},!0);return a.onload=function(){this.$blurredBG.css("background-image",'url("'+b+'")').addClass("visible")}.bind(this),a.src=b,this},startCropper:function(){var a,b,c=this.getImageDimensions(),d=c.width,e=c.height,f=this.CONSTANTS.boxSize;(f>d||f>e)&&(f=Math.min(d,e)),a=Math.max(0,Math.round((d-f)/2)),b=Math.max(0,Math.round((e-f)/2));var g,h;return this.model.get("type")==IS.Views.ImageCropper.TYPE.AVATAR?(g=1,h=[f,f]):(g=null,h=[100,100]),this.$img.Jcrop({aspectRatio:g,minSize:h,setSelect:[a,b,a+f,b+f],bgOpacity:this.CONSTANTS.opacity,onSelect:function(a){var b=this.model.get("width")/d;this.coords=[a.x,a.y,a.w,a.h].map(function(a){return Math.round(a*b)})}.bind(this)}),this},getImageDimensions:function(){var a=2*this.CONSTANTS.imageMargin,b=this.$window.width()-a,c=this.$window.height()-a-this.CONSTANTS.headerHeight;return IS.helpers.getAdjustedDimensions({width:this.model.get("width"),height:this.model.get("height"),maxWidth:b,maxHeight:c})},save:function(){if(!_.isEmpty(this.coords)){var a=this.coords[0],b=this.coords[1],c=this.coords[2],d=this.coords[3];if(this.model.get("type")==IS.Views.ImageCropper.TYPE.AVATAR){var e={x_pos:a,y_pos:b,x_length:c,y_length:d},f=new Backbone.Model({id:IS.currentUser.get("id"),auth_token:IS.currentUser.get("authToken")},{url:IS.CONS.API_BASE+IS.CONS.APIS.USER.USER});_.extend(f.attributes,e),this.trigger("save",e),f.save(),this.close()}else if(this.model.get("type")==IS.Views.ImageCropper.TYPE.IMAGE){this.disableSaveBtn();var g="https://imagizer.imageshack.us/v2/q100/https://imagizer.imageshack.us/v2/"+this.model.get("width")+"x"+this.model.get("height")+"q100/"+a+","+b+","+c+","+d+"/"+this.model.get("server")+"/"+this.model.get("filename");IS.Models.Photo.replacePhotoWithURL(this.model.id,g,function(a){IS.cm.invalidateByCacheKey("my_images"),IS.vent.trigger("grid_items:reset"),this.close(),this.enableSaveBtn()}.bind(this))}}},show:function(){this.$el.addClass("visible")},close:function(){this.$el.removeClass("visible"),_.delay(function(){this.destroy()}.bind(this),400)},disableSaveBtn:function(){this.$saveBtn.html("SAVING...").addClass("processing").show()},enableSaveBtn:function(){this.$saveBtn.html("SAVE").removeClass("processing")}},{TYPE:{AVATAR:1,IMAGE:2}}),IS.Views.ImageEditor=Backbone.View.extend({tagName:"section",className:"image-editor",events:{"click section.main a.save":"saveClicked","click section.main .icon-close":"closeClicked","click section.left li":"editOptionClicked"},stateModel:null,$slider:null,camanObj:null,specialCamanObj:null,lastNprogressType:null,initialize:function(a){this.template=IS.helpers.loadTemplate("image_editor"),this.$window=$(window),this.stateModel=new IS.Models.ImageEditor,this.lastNprogressType=NProgress.settings.type,NProgress.configure({type:"image-editor"}),this.stateModel.on({change:this.stateModelChanged},this),IS.vent.once("body:keyup:escape",this.destroy,this)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{heroURL:function(){var a=this.model.toJSON();return"/camanjs/v2/1280x800q90/"+a.server+"/"+a.filename}.bind(this)})),NProgress.start(),this.setupElements(),this.renderBlurredBG(),this.setupSlider(),this.setupCaman(),IS.et.pe("Image Editor","Show"),this},renderBlurredBG:function(){var a=new Image,b=IS.helpers.getImagizerLink({server:this.model.get("server"),filename:this.model.get("filename"),width:this.$window.width(),height:this.$window.height(),quality:50},!0);a.onload=function(){this.$blurredBG.css("background-image",'url("'+b+'")').addClass("visible")}.bind(this),a.src=b},setupElements:function(){this.$saveBtn=this.$("header section.right a.save"),this.$saveError=this.$("header section.right section.save-error"),this.$imageHero=this.$("img.hero"),this.$blurredBG=this.$("figure.blurred-bg"),this.$valueBar=this.$("section.value"),this.$valueBarName=this.$("section.value section.left .name"),this.$valueBarValue=this.$("section.value .right .value")},setupSlider:function(){this.$slider=this.$(".slider").noUiSlider({start:0,range:{min:-100,max:100}}).on("change",function(a,b){this.stateModel.setNewValue(b)}.bind(this))},setupCaman:function(){this.camanObj=Caman("img.editor-hero",function(){this.render()}),Caman.Event.listen("renderStart",function(){NProgress.start()}),Caman.Event.listen("renderFinished",function(){NProgress.done(),this.stateModel.hasChanged()&&this.$saveBtn.show()}.bind(this))},setupSpecialCaman:function(a){var a=a||function(){},b=this.model.toJSON(),c="/camanjs/v2/q90/"+b.server+"/"+b.filename,d=this;this.specialCamanObj=Caman("#special",c,function(){d.updateCaman(d.specialCamanObj,!1),this.render(a)})},saveClicked:function(){IS.et.pe("Image Editor","Click","Save"),_.defer(function(){this.disableSaveBtn()}.bind(this)),this.setupSpecialCaman(function(){var a=this.$("#special");a[0].toBlob&&a[0].toBlob(function(a){IS.Models.Photo.replacePhotoWithBlob(this.model.id,a,function(a){a.success?this.destroy():(this.$saveError.show(),_.delay(function(){this.$saveError.hide()}.bind(this),5e3),this.enableSaveBtn())}.bind(this))}.bind(this),"image/png")}.bind(this))},closeClicked:function(){IS.et.pe("Image Editor","Click","Close"),this.destroy()},editOptionClicked:function(a){IS.et.pe("Image Editor","Click","Edit Option");var b=$(a.currentTarget);this.$("section.left .active").removeClass("active"),b.addClass("active"),this.stateModel.set("activeOption",b.data("name")),this.showValueBar(b.data("name"))},showValueBar:function(a){this.$valueBarName.html(a.toUpperCase()),this.$slider.val(this.stateModel.getActiveValue()),this.updateSliderValueLabel(),this.$valueBar.show()},updateSliderValueLabel:function(){this.$valueBarValue.html(this.stateModel.getActiveValue())},updateCaman:function(a,b){a.revert(!1),_.each(this.stateModel.attributes,function(b,c){"activeOption"!=c&&this.stateModel.attributeChanged(c)&&a[c](this.stateModel.get(c))}.bind(this)),b&&a.render()},stateModelChanged:function(a){var b=_.keys(a.changedAttributes());"activeOption"!=b[0]&&(NProgress.start(),this.updateSliderValueLabel(),this.updateCaman(this.camanObj,!0))},disableSaveBtn:function(){this.$saveBtn.html("SAVING...").addClass("processing").show()},enableSaveBtn:function(){this.$saveBtn.html("SAVE").removeClass("processing")},destroy:function(){NProgress.remove(),NProgress.configure({type:this.lastNprogressType}),!IS.CONS.MOBILE_DEVICE&&this.stateModel.hasChanged()&&(IS.cm.invalidateByCacheKey("my_images"),IS.vent.trigger("grid_items:reset")),Backbone.View.prototype.destroy.call(this)}}),IS.Views.ImageOverlay=Backbone.View.extend({tagName:"section",id:"image-overlay",events:{"click .close-trigger":"close","click .share-list li":"sharePhoto","click .button.like":"handleLikeUnlike","mouseenter .button.share":"showShareOptions","mouseleave .button.share":"hideShareOptions","click .button.share":"toggleShareOptions","click .is-arrow.prev":"navigatePrev","click .is-arrow.next":"navigateNext","click footer.touch .details-trigger":"toggleBottomArea","click section.ad img":"adClicked","click section.ad .icon-close":"closeAdClicked","click .c-item img.center":"redirectToLanding","click section.details article .label.direct":"directLinkLabelClicked","click footer .info a":"usernameClicked","click section.details input":"linkClicked","click article.related-images ul a":"relatedImgClicked"},initialize:function(a){_.extend(this,IS.Views.Mixins.Share),this.template=IS.helpers.loadTemplate("image_overlay"),this.$body=$("body"),this.$window=$(window),this.models=[],this.modelIndex=0,this.isTouchDevice=Modernizr.touch,this.disableNav=!!a.disableNav,this.enableLandingLink=!!a.enableLandingLink,this.standAlone=!!a.standAlone,this.nextPrevAlbum=!!a.nextPrevAlbum,this.touchTimeout=null,this.CONSTANTS={quality:90,swipeThreshold:.7,dragThreshold:.7,timingFunction:"ease-in-out",transitionDuration:"0.25s",touchDelay:250,relatedImageWidth:90,relatedImageMargin:7},IS.vent.once("body:keyup:escape",this.close,this),this.models.push(this.model),this.preloadModels(),IS.vent.on({"app_layout:content:size:change":this.adjustContentDimensions,"mobile_layout:content:size:change":this.adjustContentDimensions,"body:keyup:left_arrow":this.leftArrowPushed,"body:keyup:right_arrow":this.rightArrowPushed,"landing_page:destroy":this.close,"header_main_mobile:delete_clicked":this.deleteCurrent},this),this.on("destroy",this.destroy,this)},render:function(){return IS.et.pe("Lightbox","Render","Image"),this.$el.html(IS.helpers.renderTemplate(this.template,_.extend(this.model.toJSON(),{imageTitle:function(){return this.model.get("title")||this.model.get("original_filename")}.bind(this),isTouchDevice:this.isTouchDevice,username:this.model.get("owner")?this.model.get("owner").username:"",disableArrows:this.isTouchDevice||this.disableNav,enableLandingLink:this.enableLandingLink}))),this.standAlone&&this.$el.addClass("stand-alone"),this.$el.css("height",this.$window.height()),this.setupElements().renderLinks(),this.isTouchDevice?(this.setupTouchEvents().fetchRelatedImages(),this.model.get("is_owner")&&IS.vent.trigger("header_main_mobile:show_delete_button")):this.renderBlurredBG(),this.renderMobileAds(),this.adjustContentDimensions(),this},renderBlurredBG:function(){IS.vent.trigger("app_layout:content:loading"),this.$blurredBG.removeClass("visible");var a=new Image,b=IS.helpers.getImagizerLink({server:this.model.get("server"),filename:this.model.get("filename"),width:this.$window.width(),height:this.$window.height(),quality:50},!0);a.onload=function(){IS.vent.trigger("app_layout:content:loaded"),this.$blurredBG.css("background-image",'url("'+b+'")').addClass("visible")}.bind(this),a.src=b},renderMobileAds:function(){IS.CONS.MOBILE_DEVICE&&(!IS.currentUser||IS.currentUser.get("freeAccount"))&&this.$mobileAds.append(IS.helpers.getAdHTML({code:IS.CONS.ADS.MLP1,width:320,height:50}))},fetchRelatedImages:function(){var a=new Backbone.Collection({},{url:IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES+"/"+this.model.get("id")+"/related?limit=30&offset=0"});return a.parse=function(a){return(a||{}).result||[]},a.on("sync",function(a){this.renderRelatedImages(a.models)}.bind(this),this),a.fetch({cache:!0,expires:IS.cm.TIMES.HOUR}),this},renderRelatedImages:function(a){var b=a.length;return this.$relatedImages.empty().css("width",b*this.CONSTANTS.relatedImageWidth+(b-1)*this.CONSTANTS.relatedImageMargin),_.each(a,function(a){var b=new IS.Views.LandingRelatedImage({model:a});this.$relatedImages.append(b.render().el)}.bind(this)),this.$relatedImagesParent.scrollLeft(0),this},setupElements:function(){return this.$blurredBG=this.$(".blurred-bg"),this.$outerWrapper=this.$("> .wrapper"),this.$carouselItems=this.$(".c-item"),this.$viewPortWidths=this.$(".vp-width"),this.$outerHeights=this.$(".o-height"),this.$touchElem=this.$(".touch-events"),this.$relatedImagesParent=this.$(".related-images .parent"),this.$relatedImages=this.$relatedImagesParent.find(".images"),this.$bottomArea=this.$("footer.touch"),this.$linkInputs=this.$bottomArea.find(".details input"),this.$ad=this.$("section.ad"),this.$mobileAds=this.$("section.mobile-ads"),this},toggleBottomArea:function(){this.$bottomArea[this.$bottomArea.hasClass("open")?"removeClass":"addClass"]("open")},adjustContentDimensions:function(){var a=this.$window.width(),b=this.getOuterWrapperHeight();this.$el.css("height",this.$window.height()),this.$outerWrapper.css({width:3*a,left:-1*a}),this.$viewPortWidths.css("width",a),this.$outerHeights.css("height",b),this.renderCarouselImages(!1)},renderCarouselImages:function(a){for(var b=this.getOuterWrapperHeight(),c=[this.model.nextImageURL()?this.getImageData(this.model.get("next_images")[0],b):{width:0,height:0},a?{}:this.getImageData(this.model.attributes,b),this.model.prevImageURL()?this.getImageData(this.model.get("prev_images")[0],b):{width:0,height:0}],d=0;d<this.$carouselItems.length;d++)1==d&&a||this.renderImage(this.$carouselItems.eq(d).find("img"),c[d])},renderImage:function(a,b){var c="",d=a.data("width")||a.data("height");c=b.width&&b.height?b.isGif?IS.inlineTemplates.direct({server:b.img.server,filename:b.img.filename,bucket:b.img.bucket}).replace("http:",""):IS.helpers.getImagizerLink({server:b.img.server,filename:b.img.filename,width:d?b.img.width:b.width,height:d?b.img.height:b.height,quality:this.CONSTANTS.quality},!1):"/v2_images/empty.png";var e=d||b.isGif?b.img.width:b.width,f=d||b.isGif?b.img.height:b.height;a.attr("src",c).data({width:e,height:f}).css({top:b.margin+"px",left:(this.$window.width()-(b.isGif?b.img.width:b.width))/2,width:b.isGif?b.img.width:b.width,height:b.isGif?b.img.height:b.height})},slideWrapper:function(a){var b="next"==a,c=(b?1:-1)*this.$window.width();this.translateTo(c,!0,function(){this.applyCSS("transition",""),this.applyCSS("transform","");var a=this.$carouselItems.eq(b?-1:1).detach();a.find("img").data({width:0,height:0}).attr("src","/v2_images/empty.png"),this.$outerWrapper[b?"prepend":"append"](a),this.$carouselItems=this.$(".c-item"),this.updateView()}.bind(this))},translateTo:function(a,b,c){c=c||function(){},this.applyCSS("transition-property","all"),b&&(this.$outerWrapper.one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){c()}.bind(this)),this.applyCSS("transition-timing-function",this.CONSTANTS.timingFunction),this.applyCSS("transition-duration",this.CONSTANTS.transitionDuration)),this.applyCSS("transform","translate("+a+"px, 0)")},applyCSS:function(a,b){_.each("moz webkit ms o".split(" "),function(c){this.$outerWrapper.css("-"+c+"-"+a,b)},this),this.$outerWrapper.css(a,b)},setupTouchEvents:function(){var a=this.$touchElem[0];return Hammer(a).on("drag",function(a){this.touchTimeout&&clearTimeout(this.touchTimeout),a.preventDefault(),a.stopPropagation(),a.gesture.preventDefault(),a.gesture.stopPropagation();var b=a.gesture,c=b.velocityX>=this.CONSTANTS.swipeThreshold,d=b.deltaX<0;if(d&&0===this.modelIndex||!d&&this.modelIndex===this.models.length-1){var e=0;return d&&!this.model.prevImageURL()?e=Math.max(-0.1*this.$window.width(),b.deltaX):d||this.model.nextImageURL()||(e=Math.min(.1*this.$window.width(),b.deltaX)),void(e&&this.translateTo(e,!1))}c?(b.stopDetect(),d?this.hideControls().navigatePrev():this.hideControls().navigateNext()):Math.abs(b.deltaX)/this.$window.width()>this.CONSTANTS.dragThreshold?(b.stopDetect(),d?this.navigatePrev():this.navigateNext()):this.translateTo(b.deltaX,!1)}.bind(this)).on("release",function(a){var b=a.gesture;Math.abs(b.deltaX)/this.$window.width()<=this.CONSTANTS.dragThreshold&&this.translateTo(0,!0)}.bind(this)).on("touch",function(){this.touchTimeout=setTimeout(function(){this.showControls()}.bind(this),this.CONSTANTS.touchDelay)}.bind(this)),this},getImageData:function(a,b){var c=this.$window.width(),d=IS.helpers.getAdjustedDimensions({width:a.width,height:a.height,maxWidth:c,maxHeight:b});return d.margin=Math.max(0,Math.floor((b-d.height)/2)),d.isGif=IS.helpers.isGif(a.filename),d.img=a,d},getOuterWrapperHeight:function(){return this.$window.height()},close:function(){this.trigger("close",this.model),this.$el.removeClass("visible"),_.delay(function(){this.destroy()}.bind(this),400)},show:function(){this.$el.addClass("visible")},showShareOptions:function(){this.$el.addClass("share-options")},hideShareOptions:function(){this.$el.removeClass("share-options")},toggleShareOptions:function(){this.$el.toggleClass("share-options")},updateView:function(){this.model=this.models[this.modelIndex],this.navigateRoute().fetchRelatedImages().renderLinks();var a=this.model.get("title")||this.model.get("original_filename"),b=!!this.model.nextImageURL(),c=!!this.model.prevImageURL();return this.$("footer").find(".info h1").attr("title",a).html(a).end(),this.isTouchDevice?this.model.get("is_owner")?IS.vent.trigger("header_main_mobile:show_delete_button"):IS.vent.trigger("header_main_mobile:hide_delete_button"):(this.$(".is-arrow.next")[b?"removeClass":"addClass"]("disabled"),this.$(".is-arrow.prev")[c?"removeClass":"addClass"]("disabled")),this.$("footer .button.like")[this.model.get("liked")?"addClass":"removeClass"]("liked"),this.renderCarouselImages(!0),this},renderLinks:function(){return this.isTouchDevice?(this.$linkInputs.each(function(a,b){var c=$(b),d=c.data("type"),e="link"==d?"https:"+IS.CONS.SITE_URL+IS.Models.Photo.landingURL(this.model.get("id")):IS.inlineTemplates[d]({id:this.model.get("id"),server:this.model.get("server"),filename:this.model.get("filename"),bucket:this.model.get("bucket"),width:"direct"==d?0:150,height:"direct"==d?0:100});c.val(e)}.bind(this)),this):this},navigateRoute:function(){return this.isTouchDevice?this:(IS.vent.trigger("route:navigate",{route:IS.Models.Photo.landingURL(this.model.get("id")),trigger:!1,replace:!0}),this)},showControls:function(){return this.isTouchDevice?this:(this.$el.removeClass("hidden-controls"),this)},hideControls:function(){return this.isTouchDevice?this:(this.$el.addClass("hidden-controls"),this.$el.one("mousemove",function(){this.showControls()}.bind(this)),this)},leftArrowPushed:function(){this.disableNav||this.hideControls().navigateNext()},rightArrowPushed:function(){this.disableNav||this.hideControls().navigatePrev()},navigateNext:function(){var a=this.model.nextImageURL();return this.isTouchDevice&&window.location.replace(a),a&&this.modelIndex!==this.models.length-1&&(IS.et.pe("Lightbox","Push","Left Arrow Key"),this.modelIndex++,this.preloadModels(),this.isTouchDevice?this.slideWrapper("next"):this.reRender()),this},navigatePrev:function(){var a=this.model.prevImageURL();return this.isTouchDevice&&window.location.replace(a),a&&0!==this.modelIndex&&(IS.et.pe("Lightbox","Push","Right Arrow Key"),this.modelIndex--,this.preloadModels(),this.isTouchDevice?this.slideWrapper("prev"):this.reRender()),this},reRender:function(){this.$carouselItems.find(".center").removeClass("loaded"),
this.model=this.models[this.modelIndex],this.navigateRoute().render()},handleLikeUnlike:function(a){var b=$(a.currentTarget);IS.et.pe("Landing Page Mobile","Click","Like"),this.model.get("liked")?this.unlike(b,!1):this.like(b,!1)},like:function(a,b){return IS.currentUser?void(a.hasClass("processing")||(a.addClass("processing"),a.addClass("liked"),this.model.set("likes",this.model.get("likes")+1),this.model.once("liked",function(){IS.et.pe("Lightbox","Like","Image"),a.removeClass("processing"),this.model.set("liked",!0),b?window.location.reload():this.trigger("liked")},this),this.model.like())):void IS.helpers.showLoginSignupOverlay(function(){this.like(a,!0)}.bind(this),null)},unlike:function(a,b){return IS.currentUser?void(a.hasClass("processing")||(a.addClass("processing"),a.removeClass("liked"),this.model.set("likes",Math.max(0,this.model.get("likes")-1)),this.model.once("unliked",function(){IS.et.pe("Lightbox","Unlike","Image"),a.removeClass("processing"),this.model.set("liked",!1),b?window.location.reload():this.trigger("unliked")},this),this.model.unlike())):void IS.helpers.showLoginSignupOverlay(function(){this.unlike(a,!0)}.bind(this),null)},preloadModels:function(){var a=this.models[this.modelIndex];return 0==this.modelIndex&&a.get("prev_images").length&&this.preloadModel(a.get("prev_images")[0],!0),this.modelIndex==this.models.length-1&&a.get("next_images").length&&this.preloadModel(a.get("next_images")[0],!1),this},preloadModel:function(a,b){var c=new IS.Models.Landing({id:a.id,nextPrevAlbum:this.nextPrevAlbum});c.once("sync",function(a){this.models[b?"unshift":"push"](a);var c,d=a.get(b?"prev_images":"next_images")[0];if(b&&this.modelIndex++,d){var e=this.getImageData(d,this.getOuterWrapperHeight());c=IS.helpers.getImagizerLink({server:e.img.server,filename:e.img.filename,width:e.width,height:e.height,quality:this.CONSTANTS.quality},!1),e.isGif&&(c=IS.inlineTemplates.direct({server:d.server,filename:d.filename,bucket:d.bucket}).replace("http:","")),(new Image).src=c}}.bind(this)),c.fetch()},deleteCurrent:function(){var a="Delete this image?";if(confirm(a)){if(!this.model)return;this.model.removeFromServer(),IS.cm.invalidateAll(),_.delay(function(){Backbone.history.navigate("/my/images",!0)},250)}},displayMobileAdOverlay:function(){var a="mobile_ad";!IS.currentUser&&IS.CONS.MOBILE_DEVICE&&($.cookie(a)?$.cookie(a)<2&&($.cookie(a,parseInt($.cookie(a))+1,{expires:1}),this.$ad.show()):($.cookie(a,1,{expires:1}),this.$ad.show()))},adClicked:function(){IS.CONS.MOBILE_DEVICE&&IS.et.pe("Landing Page Mobile","Click","Ad"),window.location="/signup"},closeAdClicked:function(){IS.CONS.MOBILE_DEVICE&&IS.et.pe("Landing Page Mobile","Click","Ad Close"),this.$ad.hide()},usernameClicked:function(){IS.CONS.MOBILE_DEVICE&&IS.et.pe("Landing Page Mobile","Click","Profile")},linkClicked:function(a){if(IS.CONS.MOBILE_DEVICE){var b=$(a.currentTarget),c=b.data("type");IS.et.pe("Landing Page Mobile","Click",c)}},directLinkLabelClicked:function(a){a.preventDefault(),window.location=IS.inlineTemplates.direct({id:this.model.get("id"),server:this.model.get("server"),filename:this.model.get("filename"),bucket:this.model.get("bucket"),width:0,height:0})},relatedImageClicked:function(){IS.CONS.MOBILE_DEVICE&&IS.et.pe("Landing Page Mobile","Click","Related Image")},redirectToLanding:function(){this.enableLandingLink&&(this.destroy(),Backbone.history.loadUrl())},destroy:function(){this.off("destory",this.destroy,this),IS.vent.off({"app_layout:content:size:change":this.adjustContentDimensions,"mobile_layout:content:size:change":this.adjustContentDimensions,"body:keyup:left_arrow":this.navigateNext,"body:keyup:right_arrow":this.navigatePrev,"landing_page:destroy":this.destroy},this),Backbone.View.prototype.destroy.call(this)}}),IS.Views.ImageStats=Backbone.View.extend({tagName:"section",id:"image-stats",className:"loading",events:{"click .chart-trigger":"toggleChartMode","click .dp-go":"fetchCustomRange","click .close-trigger":"destroy"},initialize:function(){this.$window=$(window),this.template=IS.helpers.loadTemplate("image_stats"),this.CONSTANTS={TH_WIDTH:160,TH_HEIGHT:160,POINT_STROKE:"rgba(62, 62, 62, 1)",POINT_COLOR:"rgba(245, 188, 34, 1)",STROKE_COLOR:"rgba(245, 188, 34, 1)",FILL_COLOR:"rgba(245, 188, 34, 0)",FONT_FAMILY:'"Open Sans", sans-serif',FONT_COLOR:"rgba(131, 130, 130, 1)",GRID_COLOR:"rgba(131, 130, 130, 0.25)",DOT_RADIUS:5,DOT_STROKE:2,DATA_STROKE_WIDTH:2,CHART_WIDTH:880,CHART_HEIGHT:268,SCALE_STEPS:8},this.mode="daily",this.cache={},this.totalStats=null,this.currentXHR=null,IS.vent.once("body:keyup:escape",this.destroy,this),IS.et.pe("Image Stats","Start","Overlay")},render:function(){var a=this.CONSTANTS;return this.$el.html(IS.helpers.renderTemplate(this.template,_.extend({thumbnailURL:function(){return IS.helpers.getImagizerLink({server:this.model.get("server"),filename:this.model.get("filename"),width:a.TH_WIDTH,height:a.TH_HEIGHT,cropped:!0})}.bind(this),chartWidth:a.CHART_WIDTH,chartHeight:a.CHART_HEIGHT},this.model.attributes))),this.setupElements().setupDatePickers().fetchStatsModel().renderBlurredBG(),this},setupElements:function(){return this.$blurredBG=this.$(".blurred-bg"),this.$pageViewCount=this.$(".count.page-views"),this.$likesCount=this.$(".count.image-likes"),this.$commentsCount=this.$(".count.comments"),this.$chart=this.$("canvas"),this.$refResults=this.$(".ref-results"),this.$modeTitle=this.$(".mode-text h2"),this.$modeSub=this.$(".mode-text span"),this.$progressBar=this.$(".progress-bar span"),this.$resultLoading=this.$(".result-loading"),this.$fromDate=this.$(".dp-input.from"),this.$toDate=this.$(".dp-input.to"),this},setupDatePickers:function(){var a=new Date,b=+a-2592e6;return this.fromPicker=new Pikaday({field:this.$fromDate[0],position:"bottom right",defaultDate:new Date(b),setDefaultDate:!0,onSelect:function(){var a=this.fromPicker.getDate();this.$fromDate.val(IS.helpers.getSlashedDate(a)),this.toPicker.setMinDate(+a)}.bind(this)}),this.toPicker=new Pikaday({field:this.$toDate[0],position:"bottom right",defaultDate:a,setDefaultDate:!0,onSelect:function(){var a=this.toPicker.getDate();this.$toDate.val(IS.helpers.getSlashedDate(a)),this.fromPicker.setMaxDate(+a)}.bind(this)}),this.toPicker.setMaxDate(+new Date),this.fromPicker.setMaxDate(+new Date),this.$fromDate.val(IS.helpers.getSlashedDate(b)),this.$toDate.val(IS.helpers.getSlashedDate(+a)),this},showLoader:function(){this.$resultLoading.find("h3").html("Loading "+this.mode+" stats..."),IS.helpers.applyCSS(this.$progressBar,"transition-duration","15s"),_.delay(function(){this.$resultLoading.addClass("visible"),this.$progressBar.css("width","100%"),this.$el.addClass("loading")}.bind(this),100)},hideLoader:function(){IS.helpers.applyCSS(this.$progressBar,"transition-duration","0s"),_.delay(function(){this.$resultLoading.removeClass("visible"),this.$progressBar.css("width","0%"),this.$el.removeClass("loading")}.bind(this),100)},renderChartLabel:function(a){var b,c,d=IS.helpers;switch(this.mode){case"daily":b="DAY";var e=this.fromPicker.getDate(),f=this.toPicker.getDate();c=e&&f?d.getSlashedDate(e)+" - "+d.getSlashedDate(f):this.getDailyText();break;case"weekly":b="WEEK",c=this.getDailyText();break;case"monthly":b="MONTH",c=this.getDailyText();break;default:if(b="HOUR",a.length){var g=1e3*a[0].time_stamp;if(a.length>1){var h=1e3*a[a.length-1].time_stamp;c=d.getSlashedDate(g)+" - "+d.getSlashedDate(h)}else c=d.getSlashedDate(g)}else c=this.getDailyText()}return this.$modeTitle.html("VIEWS PER "+b+":"),this.$modeSub.html(c),this},fetchStatsModel:function(a,b){if(IS.et.pe("Image Stats","Display",IS.helpers.capitalizeFirstLetter(this.mode)),this.cache[this.mode]){var c=this.cache[this.mode].stats;return this.renderChartLabel(c).renderViewsReferrals(c,this.cache[this.mode].totalStats).renderChart(c),this}this.showLoader();var d=new IS.Models.ImageStats({id:this.model.get("id"),mode:this.mode,timestamp:a,count:b});return d.once("sync",function(a){this.currentXHR=null,this.totalStats||(this.totalStats=a.get("total_stats"),this.renderTotalStats());var b=a.get(this.mode+"_stats");b.sort(function(a,b){return a.time_stamp-b.time_stamp}),this.cache[this.mode]={stats:b,totalStats:a.get("total_stats")},this.renderChartLabel(b).renderViewsReferrals(b,a.get("total_stats")).renderChart(b)}.bind(this)),this.currentXHR=d.fetch(),this},renderTotalStats:function(){return this.$likesCount.html(this.totalStats.likes),this.$commentsCount.html(this.totalStats.comments),this},getHourlyLabel:function(a){var b=new Date(a),c=b.getHours(),d=c>11?"pm":"am";return c>12&&(c-=12),(0===c?12:c)+d},renderChart:function(a){this.hideLoader(),a=a||[];var b=this.CONSTANTS;this.$chart.replaceWith('<canvas width="'+b.CHART_WIDTH+'" height="'+b.CHART_HEIGHT+'"></canvas>'),this.$chart=this.$("canvas");for(var c=[],d=[],e=this.$chart.get(0).getContext("2d"),f=0,g=0;g<a.length;g++){var h=a[g];"hourly"==this.mode?c.push(this.getHourlyLabel(1e3*h.time_stamp)):c.push(IS.helpers.getMonthDayDate(1e3*h.time_stamp)),d.push(h.visits),f=Math.max(h.visits,f)}for(f||(f=b.SCALE_STEPS);f%(5*b.SCALE_STEPS)!==0;)f++;var i={scaleFontFamily:b.FONT_FAMILY,scaleFontColor:b.FONT_COLOR,scaleGridLineColor:b.GRID_COLOR,datasetStrokeWidth:b.DATA_STROKE_WIDTH,pointDotRadius:b.DOT_RADIUS,pointDotStrokeWidth:b.DOT_STROKE,scaleOverride:!0,scaleSteps:b.SCALE_STEPS,scaleStartValue:0,scaleStepWidth:f/b.SCALE_STEPS},j=[{fillColor:b.FILL_COLOR,strokeColor:b.STROKE_COLOR,pointColor:b.POINT_COLOR,pointStrokeColor:b.POINT_STROKE,data:d}];return d.length&&_.max(d)==_.min(d)&&(c.push(""),j.push({fillColor:"rgba(255, 255, 255, 0)",strokeColor:"rgba(255, 255, 255, 0)",pointColor:"rgba(255, 255, 255, 0)",pointStrokeColor:"rgba(255, 255, 255, 0)",data:[0]})),new Chart(e).Line({labels:c,datasets:j},i),this},renderViewsReferrals:function(a,b){var c=a.reduce(function(a,b){return a+b.visits},0);this.$pageViewCount.html(IS.helpers.numberWithCommas(c));var d="";return _.each(b.top_refs,function(a,b){d+=Mustache.render(IS.Templates.Desktop.imageReferrer,{url:b,count:IS.helpers.numberWithCommas(a)})}),this.$refResults.html(d),this.$(".ref-area")[d?"show":"hide"](),this},renderBlurredBG:function(){var a=new Image,b=IS.helpers.getImagizerLink({server:this.model.get("server"),filename:this.model.get("filename"),width:this.$window.width(),height:this.$window.height(),quality:50},!0);a.onload=function(){this.$blurredBG.css("background-image",'url("'+b+'")').addClass("visible")}.bind(this),a.src=b},toggleChartMode:function(a){var b=$(a.currentTarget),c=b.data("mode");b.hasClass("active")||(this.currentXHR&&this.currentXHR.abort&&(this.currentXHR.abort(),this.currentXHR=null),b.addClass("active").siblings(".active").removeClass("active"),this.mode=c,this.fetchStatsModel())},getDailyText:function(){var a=new Date,b="January February March April May June July August September October November December".split(" ");return b[a.getMonth()].toUpperCase()+" "+a.getFullYear()},fetchCustomRange:function(){var a,b=this.toPicker.getDate(),c=this.fromPicker.getDate(),d=864e5;!b||!c||+c>+b||(a=Math.ceil((+b-+c)/d)+1,this.mode="daily",this.$(".chart-trigger.daily").addClass("active").siblings(".active").removeClass("active"),delete this.cache[this.mode],this.fetchStatsModel(+c/1e3,a))}}),IS.Views.ImageTag=Backbone.View.extend({tagName:"a",className:"tag",events:{"click .delete":"removeFromServer"},initialize:function(){this.template=IS.helpers.loadTemplate("image_tag"),this.landingModel=this.options.landingModel,this.lightboxMode=this.options.lightboxMode},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,this.model.toJSON())),this.$el.attr("data-name",this.model.get("name")).attr("href","/search/"+this.model.get("name")+"/1/?g=1"),this},removeFromServer:function(a){if(a.stopPropagation(),a.preventDefault(),!this.lightboxMode){if(!this.model.get("name"))return;this.landingModel.removeTags([this.model.get("name")],function(a){a.success||IS.logger.error("Unable to remove tag",this.model.attributes)})}IS.vent.trigger("app_layout:navbar:decrement_tag_link",{tags:[this.model.get("name")]}),this.remove(),this.lightboxMode?IS.et.pe("Lightbox","Click","Tag Delete"):IS.et.pe("Landing Page","Click","Tag Delete")},remove:function(){this.$el.remove(),this.trigger("removed",{model:this.model})}}),IS.Views.ImagizerDashboard=Backbone.View.extend({el:"#imagizer-dashboard",events:{"change #chart-dd":"changeChartType"},initialize:function(){new IS.Views.HeaderMain,this.CONSTANTS={intervalDelay:500,heatMap:{WIDTH:this.$el.width(),CHART_EXTRA_WIDTH:130,HEIGHT:300,MAX_VALUE:4e3,BOX_WIDTH:16,BOX_HEIGHT:8,MARGIN:1,FILL_COLOR:"#f5bc22",STROKE_COLOR:"#f1f1f1",TRANSITION_SPEED:60},colors:{TRANS:"rgba(0, 0, 0, 0)",HIT:{STROKE:"rgb(136, 195, 67)",FILL:"rgba(136, 195, 67, 0.4)"},MISS:{STROKE:"rgb(245, 188, 34)",FILL:"rgba(245, 188, 34, 0.4)"},CPU:{STROKE:"rgb(159, 28, 28)",FILL:"rgba(159, 28, 28, 0.4)"},DISK:{STROKE:"rgb(28, 150, 190)",FILL:"rgba(28, 150, 190, 0.4)"},BW:{STROKE:"rgb(174, 121, 19)",FILL:"rgba(174, 121, 19, 0.4)"}}},this.avgComp=0,this.avgMobileComp=0,this.compCount=0,this.mobileCompCount=0,this.socket=null,this.chartType="rq",this.hitGauge=null,this.cpuGauge=null,this.diskGauge=null,this.firstFetchTS=null,this.setupElements(),this.chart=new SmoothieChart({grid:{strokeStyle:"rgb(67, 67, 67)",fillStyle:"rgb(34, 34, 34)",lineWidth:1,millisPerLine:1e3,verticalSections:4},labels:{fillStyle:"rgb(255, 255, 255)",precision:0},millisPerPixel:55,interpolation:"linear",yRangeFunction:function(a){var b="cd"==this.chartType?100:"bw"==this.chartType?1e3:a.max;return this.$maxLabel.html(b),{min:0,max:b}}.bind(this)}),this.chart.streamTo(this.$lineChart[0],this.CONSTANTS.intervalDelay),this.hitsSeries=new TimeSeries,this.missSeries=new TimeSeries,this.cpuSeries=new TimeSeries,this.diskSeries=new TimeSeries,this.bwSeries=new TimeSeries;var a=this.CONSTANTS.colors;this.chart.addTimeSeries(this.hitsSeries,{strokeStyle:a.HIT.STROKE,fillStyle:a.HIT.FILL,lineWidth:2}),this.chart.addTimeSeries(this.missSeries,{strokeStyle:a.MISS.STROKE,fillStyle:a.MISS.FILL,lineWidth:2}),this.chart.addTimeSeries(this.cpuSeries,{strokeStyle:a.TRANS,fillStyle:a.TRANS,lineWidth:2}),this.chart.addTimeSeries(this.diskSeries,{strokeStyle:a.TRANS,fillStyle:a.TRANS,lineWidth:2}),this.chart.addTimeSeries(this.bwSeries,{strokeStyle:a.TRANS,fillStyle:a.TRANS,lineWidth:2}),this.maxBoxCount=Math.floor(this.CONSTANTS.heatMap.HEIGHT/(this.CONSTANTS.heatMap.BOX_HEIGHT+this.CONSTANTS.heatMap.MARGIN)),this.bucketSize=Math.floor(this.CONSTANTS.heatMap.MAX_VALUE/this.maxBoxCount),this.initHeatMap().startHeatMapTransition(),this.hitGauge=new IS.Views.GaugeChart({model:new Backbone.Model({label:"hitometer"})}),this.cpuGauge=new IS.Views.GaugeChart({model:new Backbone.Model({label:"cpu"})}),this.diskGauge=new IS.Views.GaugeChart({model:new Backbone.Model({label:"disk"})}),this.compGauge=new IS.Views.GaugeChart({model:new Backbone.Model({label:"compression"})}),this.$gauges.append([this.hitGauge.render().el,this.cpuGauge.render().el,this.diskGauge.render().el,this.compGauge.render().el]),this.setupSocket()},setupElements:function(){return this.$gauges=this.$(".gauges"),this.$arrow=this.$(".arrow"),this.$speedValue=this.$(".speedometer .value"),this.$lineChart=this.$("#line-chart"),this.$ts=this.$("#ts"),this.$errors=this.$("#errors"),this.$requests=this.$("#requests"),this.$bw=this.$("#bw"),this.$hits=this.$("#hits"),this.$misses=this.$("#misses"),this.$compression=this.$("#compression"),this.$mobileCompression=this.$("#compression-mobile"),this.$chartLabel=this.$("#chart-label"),this.$maxLabel=this.$(".line-chart .label.max"),this.$el.css("width",this.CONSTANTS.heatMap.WIDTH+15),this.$lineChart.attr("width",this.CONSTANTS.heatMap.WIDTH+this.CONSTANTS.heatMap.CHART_EXTRA_WIDTH),this},setupSocket:function(){this.socket=io.connect("http://zero.imageshack.us"),this.socket.on("message",function(a){this.firstFetchTS||(this.firstFetchTS=+new Date);var b=this.parseData("string"==typeof a?JSON.parse(a):a);this.updateView(b)}.bind(this))},parseData:function(a){var b=/5\d{2}/,c=parseInt(a.hits),d=parseInt(a.misses),e=0,f=_.keys(a),g=1e3*parseInt(a.timestamp),h=0===parseInt(a.mobile_compressed_size)||0===parseInt(a.mobile_original_size),i=100*(1-parseInt(a.compressed_size)/parseInt(a.original_size)),j=100*(1-parseInt(a.mobile_compressed_size)/parseInt(a.mobile_original_size));return f.forEach(function(c){b.test(c)&&(e+=parseInt(a[c]))}),this.avgComp+=i,this.compCount++,h||(this.avgMobileComp+=j,this.mobileCompCount++),{requests:c+d+e,hits:c,misses:d,ts:g,tsString:IS.helpers.getTimeString(g),compression:(this.avgComp/this.compCount).toFixed(2),mobile_compression:(this.avgMobileComp/this.mobileCompCount).toFixed(2),cpu:parseInt(a.system_cpu)+parseInt(a.user_cpu),disk:a.avg_disk_util||0,errors:e,buckets:this.getBucket(a.miss_latencies),bw:IS.helpers.getPrettyFileSize(parseInt(a.total_size),0)}},updateHeatMap:function(a){var b=this.CONSTANTS.heatMap,c=this.heatMap.append("g").attr("transform",function(){return"translate("+b.WIDTH+", 0)"}).attr("class","waiting"),d=c.selectAll("rect").data(a);return d.enter().append("rect").attr("x",0).attr("y",function(a,c){return b.HEIGHT-(c+1)*(b.BOX_HEIGHT+b.MARGIN)}).attr("width",b.BOX_WIDTH).attr("height",b.BOX_HEIGHT).attr("fill",b.FILL_COLOR).attr("fill-opacity",function(a){return a}),this},startHeatMapTransition:function(){var a=this.CONSTANTS.heatMap;return setInterval(function(){var b=this.heatMap.select("g.waiting");b.attr("class","").transition().attr("transform","translate("+-1*(a.BOX_WIDTH+a.MARGIN)+", 0)").duration(a.WIDTH*a.TRANSITION_SPEED).ease("linear").remove()}.bind(this),(a.BOX_WIDTH+a.MARGIN)*a.TRANSITION_SPEED),this},getBucket:function(a){for(var b=new Array(this.maxBoxCount),c=0;c<b.length;c++)b[c]=0;a=a.sort(function(a,b){return a-b});for(var d=0,e=0;e<b.length;e++){for(;(a[d]<=(e+1)*this.bucketSize||e==b.length-1)&&(b[e]++,d++,!(d>=a.length)););b[e]=(b[e]/a.length).toFixed(2)}return b},initHeatMap:function(){for(var a=this.CONSTANTS.heatMap.WIDTH,b=this.CONSTANTS.heatMap.HEIGHT,c=["1s","2s","3s","> 4s"],d=[{x1:0,y1:b,x2:a,y2:b},{x1:0,y1:0,x2:a,y2:0,transform:"translate(0, 1)"},{x1:a/3,y1:0,x2:a/3,y2:b},{x1:2*a/3,y1:0,x2:2*a/3,y2:b}],e=[],f=0;f<c.length;f++)e.push(b-(f+1)*b/c.length);var g=d3.scale.ordinal().domain(c).range(e);return this.heatMap=d3.select("#heatmap").attr("width",a).attr("height",b),this.heatMap.selectAll("text.label.left").data(c).enter().append("text").attr("class","label left").attr("x",0).attr("y",function(a){return g(a)}).attr("dy","15px").text(function(a){return a}),this.heatMap.selectAll("line").data(d).enter().append("line").attr("x1",function(a){return a.x1}).attr("y1",function(a){return a.y1}).attr("x2",function(a){return a.x2}).attr("y2",function(a){return a.y2}).attr("stroke-width",1).attr("stroke",this.CONSTANTS.heatMap.STROKE_COLOR).attr("transform",function(a){return a.transform||""}),this},updateView:function(a){var b=Math.round(100*a.hits/a.requests),c=+new Date;this.hitGauge.update(b),this.cpuGauge.update(a.cpu),this.diskGauge.update(a.disk),this.compGauge.update(Math.round(parseFloat(a.compression))),this.hitsSeries.append(a.ts,a.hits),this.missSeries.append(a.ts,a.misses),this.cpuSeries.append(a.ts,a.cpu),this.diskSeries.append(a.ts,a.disk),this.bwSeries.append(a.ts,parseInt(a.bw.match(/\d{1,}/)[0])||0),this.$ts.html(a.tsString),this.$errors.html(a.errors),this.$requests.html(a.requests),this.$bw.html(a.bw),this.$hits.html(a.hits),this.$misses.html(a.misses),this.$compression.html(a.compression+"%"),this.$mobileCompression.html(a.mobile_compression+"%"),c-this.firstFetchTS>this.CONSTANTS.intervalDelay&&this.updateHeatMap(a.buckets)},changeChartType:function(a){var b=$(a.currentTarget.options[a.currentTarget.selectedIndex]),c=this.CONSTANTS.colors;this.$chartLabel.html(b.val()),this.chartType=b.data("type"),"rq"==this.chartType?(this.chart.seriesSet[0].options.strokeStyle=c.HIT.STROKE,this.chart.seriesSet[0].options.fillStyle=c.HIT.FILL,this.chart.seriesSet[1].options.strokeStyle=c.MISS.STROKE,this.chart.seriesSet[1].options.fillStyle=c.MISS.FILL,this.chart.seriesSet[2].options.strokeStyle=c.TRANS,this.chart.seriesSet[2].options.fillStyle=c.TRANS,this.chart.seriesSet[3].options.strokeStyle=c.TRANS,this.chart.seriesSet[3].options.fillStyle=c.TRANS,this.chart.seriesSet[4].options.strokeStyle=c.TRANS,this.chart.seriesSet[4].options.fillStyle=c.TRANS):"cd"==this.chartType?(this.chart.seriesSet[0].options.strokeStyle=c.TRANS,this.chart.seriesSet[0].options.fillStyle=c.TRANS,this.chart.seriesSet[1].options.strokeStyle=c.TRANS,this.chart.seriesSet[1].options.fillStyle=c.TRANS,this.chart.seriesSet[2].options.strokeStyle=c.CPU.STROKE,this.chart.seriesSet[2].options.fillStyle=c.CPU.FILL,this.chart.seriesSet[3].options.strokeStyle=c.DISK.STROKE,this.chart.seriesSet[3].options.fillStyle=c.DISK.FILL,this.chart.seriesSet[4].options.strokeStyle=c.TRANS,this.chart.seriesSet[4].options.fillStyle=c.TRANS):(this.chart.seriesSet[0].options.strokeStyle=c.TRANS,this.chart.seriesSet[0].options.fillStyle=c.TRANS,this.chart.seriesSet[1].options.strokeStyle=c.TRANS,this.chart.seriesSet[1].options.fillStyle=c.TRANS,this.chart.seriesSet[2].options.strokeStyle=c.TRANS,this.chart.seriesSet[2].options.fillStyle=c.TRANS,this.chart.seriesSet[3].options.strokeStyle=c.TRANS,this.chart.seriesSet[3].options.fillStyle=c.TRANS,this.chart.seriesSet[4].options.strokeStyle=c.BW.STROKE,this.chart.seriesSet[4].options.fillStyle=c.BW.FILL)}}),IS.Views.LandingCameraSettings=Backbone.View.extend({tagName:"ul",className:"content",initialize:function(){this.$template=IS.helpers.loadTemplate("landing_camera_settings")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,_.extend({},this.model.attributes,{hasMake:!!this.model.get("make"),hasModel:!!this.model.get("model"),hasAperture:!!this.model.get("aperture"),hasDate:!!this.model.get("datetime"),hasExposureTime:!!this.model.get("exposuretime"),hasFocalLength:!!this.model.get("focallength"),hasISO:!!this.model.get("iso"),hasDimensions:!!this.model.get("width")&&!!this.model.get("height"),hasSize:!!this.model.get("filesize"),formattedSize:IS.helpers.numberWithCommas(this.model.get("filesize"))+" bytes",parsedSize:IS.helpers.getPrettyFileSize(this.model.get("filesize"),2),noSettings:function(){var a=!0;return _.each("make model aperture datetime exposuretime focallength iso filesize width".split(" "),function(b){a=a&&!this.model.get(b)}.bind(this)),!!a}.bind(this)}))),this}}),IS.Views.LandingComment=Backbone.View.extend({tagName:"article",className:"clearfix",events:{"click .destroy":"removeComment","click .avatar":"avatarClicked","click .profile-link":"usernameClicked"},initialize:function(){this.$template=IS.helpers.loadTemplate("landing_comment"),this.messageWidth=this.options.messageWidth,this.interval=setInterval(function(){this.messageWidth=this.$(".message .text").width(),this.render()}.bind(this),3e4),this.model.on("change:id",function(){this.$el.attr("id","c-"+this.model.get("id"))}.bind(this)),this.model.on("change:comment",this.render,this)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,_.extend(this.model.attributes,{showPremiumBadge:"premium"==this.model.get("owner").membership}))),this.$el.attr("id","c-"+this.model.get("id")),this.messageWidth&&this.$(".message .text").css("width",this.messageWidth),this},show:function(){_.defer(function(){this._destroyed||this.$el.addClass("loaded")}.bind(this))},removeComment:function(a){$(a.currentTarget).trigger("mouseleave"),this.model.remove(),this.$el.removeClass("loaded"),_.delay(function(){this.destroy()}.bind(this),225),IS.et.pe("Landing Page","Delete","Comment")},destroy:function(){clearInterval(this.interval),Backbone.View.prototype.destroy.call(this)},avatarClicked:function(){IS.et.pe("Landing Page","Click","Comment Avatar")},usernameClicked:function(){IS.et.pe("Landing Page","Click","Comment Username")}}),IS.Views.LandingCommentsPagination=Backbone.View.extend({tagName:"div",className:"paginator clearfix",events:{click:"clicked"},initialize:function(){this.$template=IS.helpers.loadTemplate("landing_comments_pagination"),this.model.on("change",this.render,this)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,this.model.attributes)),this.$el.removeClass("loading"),this},clicked:function(){this.$el.hasClass("loading")||(this.$el.addClass("loading"),this.trigger("clicked"),IS.et.pe("Landing Page","Click","Comments Pagination"))},destroy:function(){this._destroyed||Backbone.View.prototype.destroy.call(this)}}),IS.Views.Landing=Backbone.View.extend({tagName:"section",id:"landing",events:{"click .right-side .details > article > a.trigger":"expandLinksDetail","click .right-side .share-options .external":"sharePhoto","click .left-side .likes":"handleLikeUnlike","keyup .left-side .comment-input textarea":"textAreaKeyUp","click .left-side .submit-button":"submitComment","click .right-side .profile-link":"ownerAvatarClicked","click .right-side .user-area > header h2 a":"ownerUsernameClicked","click #share-dl":"downloadClicked","click .left-side .related-images > a.left":"scrollRelatedLeft","click .left-side .related-images > a.right":"scrollRelatedRight","click .left-side figure.image a.prev":"prevClicked","click .left-side figure.image a.next":"nextClicked","click .lb-trigger":"showImageOverlay","click .left-side figure.image img":"showImageOverlay","click .left-side .you-shall-not-pass":"showImageOverlay","click .right-side .get-links":"showGetLinksLightbox","mouseenter figure.image":"preloadOverlayImage","click .stats-trigger":"displayImageStats"},initialize:function(){IS.vent.trigger("app_layout:content:max_width"),_.extend(this,IS.Views.Mixins.Share),this.$window=$(window),this.options.bootstrapped&&this.setupElements(),IS.vent.on("app_layout:content:size:change",this.resize,this),this.$template=IS.helpers.loadTemplate("landing"),this.maxCommentLength=500,this.linksView=null,this.tagsView=null,this.lbView=null,this.paginator=null,this.paginatorModel=null,this.titleEditable=null,this.timelineWidget=null,this.similarImages=null,this.cameraSettings=null,this.imageStats=null,this.previousUsername="",this.commentsViews=[],this.models=[],this.modelIndex=0,this.transitionSpeed=125,this.margin=20,this.rightSideMargin="firefox"==IS.CONS.BROWSER||"ie"==IS.CONS.BROWSER?35:20,this.imageQuality={LOW:50,HIGH:90},this.adjustments={COMMENT_INPUT:122,TEXTAREA:229,RELATED_PARENT:57,TAGS_PARENT:57,IMAGE_STATS:410},this.rightSideWidth=305,this.relatedImageWidth=120,this.relatedImageMargin=10,this.ratioThreshold=.5,this.pageTopMargin=60,this.titleAreaHeight=150,this.maxImagePadding=30,this.models.push(this.model),this.preloadModels(),_.defer(function(){this.$window.resize()}.bind(this)),this.options.bootstrapped&&this.renderFollowButton().renderTimelineWidget().renderSimilarImages().renderFacebookButton().fetchCameraSettings().fetchRelatedImages(),this.renderedFirstCommentSet=!1,this.$("textarea.comment").placeholder(),this.comments||(this.comments=new IS.Collections.LandingComments(this.options.comments?$.parseJSON(this.options.comments):[]),_.each(this.comments.models,function(a){this.commentsViews.push(new IS.Views.LandingComment({el:"#c-"+a.get("id"),model:a})),a.trigger("change:comment")}.bind(this))),this.comments.setProps({server:this.model.get("server"),filename:this.model.get("filename"),offset:this.options.offset,limit:this.model.get("comments_limit")}),this.comments.on("add",this.commentAdded,this),this.options.bootstrapped?(this.tagsView=new IS.Views.LandingTags({model:this.model,el:this.$(".right-side .details .tags > .content")}),this.tagsView.on("change:tags",this.adjustTagsAreaHeight,this)):this.fetchComments(),this.options.offset&&this.options.comments_total>this.model.get("comments_limit")&&(this.renderedFirstCommentSet=!0,this.paginatorModel=new Backbone.Model({total:this.options.comments_total,current:this.model.get("comments_limit")}),this.paginator=new IS.Views.LandingCommentsPagination({el:".left-side .comments-area .paginator",model:this.paginatorModel}),this.initPaginatorListener()),IS.vent.on("body:keyup:left_arrow",this.navigatePrev,this),IS.vent.on("body:keyup:right_arrow",this.navigateNext,this),!this.model.get("is_owner")&&this.model.incrementViewCount(),IS.helpers.setPageTitle(this.model.get("title")||this.model.get("original_filename")),this.on("transition:start",function(){IS.et.pe("Landing Page","Start","Transition"),IS.helpers.animateScrollTop($(".app-layout-content "),0,1e3),IS.vent.trigger("landing_page:start:transition"),this.lbView&&this.lbView.trigger("destroy"),this.$heroImage.data("width",0).data("height",0).addClass("invisible").removeClass("broken direct-linked"),this.renderedFirstCommentSet=!1,this.comments.reset(),_.each(this.commentsViews,function(a){a.destroy()}),this.commentsViews=[],this.paginator&&this.paginator.destroy(),this.paginator=null,this.$el.addClass("processing")},this),this.on("transition:end",function(){IS.vent.trigger("app_layout:content:loaded")},this),this.options.bootstrapped&&this.model.get("is_owner")&&(this.titleEditable=new IS.Views.LandingTitleEditable({el:this.$(".left-side .image-info header"),model:this.model})),_.delay(function(){this.$relatedImagesParent.scrollLeft(0)}.bind(this),this.transitionSpeed),IS.helpers.showSurveyBox(),this.handleEventTracking()},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,_.extend(this.model.attributes,{imageTitle:function(){return this.model.get("title")||this.model.get("original_filename")}.bind(this),isGif:function(){return IS.helpers.isGif(this.model.get("filename"))}.bind(this),showPremiumBadge:function(){return"pro"==this.model.get("owner").membership}.bind(this),blockedDownload:!this.model.get("is_owner")&&this.model.get("block_downloading"),showAd:!0}))),this.model.get("is_owner")||this.model.get("public")||this.$el.addClass("private"),this.setupElements().renderFollowButton().renderTimelineWidget().renderSimilarImages().renderFacebookButton().fetchCameraSettings().fetchRelatedImages().renderTags(),this.model.get("is_owner")&&(this.titleEditable=new IS.Views.LandingTitleEditable({el:this.$(".left-side .image-info header"),model:this.model})),_.defer(function(){this.$window.resize(),this.setupTouchEvents()}.bind(this)),this},fetchComments:function(){return this.comments.fetch({success:function(a,b){this.handlePagination(b)}.bind(this)}),this},renderTags:function(){var a=this.$(".right-side .details .tags > .content"),b=a.parent();return this.tagsView&&this.tagsView.off("change:tags",this.adjustTagsAreaHeight,this),this.tagsView=new IS.Views.LandingTags({model:this.model}),this.tagsView.on("change:tags",this.adjustTagsAreaHeight,this),a.length?a.replaceWith(this.tagsView.render().el):this.$(".right-side .details .tags").append(this.tagsView.render().el),b.hasClass("expanded")&&this.adjustTagsAreaHeight(),this},adjustTagsAreaHeight:function(){var a=this.$(".right-side .details .tags");a.css("height",this.adjustments.TAGS_PARENT+a.find(".tags-wrapper").height())},initPaginatorListener:function(){this.paginator.on("clicked",function(){this.comments.fetch({success:function(a,b){this.handlePagination(b)}.bind(this)})}.bind(this),this)},handlePagination:function(a){if(a&&a.result){var b,c=a.result.total;this.paginator?(b=Math.min(c,this.paginatorModel.get("current")+a.result.comments.length),c>b?this.paginatorModel.set("current",b):this.paginator.destroy()):(b=a.result.comments.length,c>b&&(this.paginatorModel=new Backbone.Model({total:c,current:b}),this.paginator=new IS.Views.LandingCommentsPagination({model:this.paginatorModel}),this.$(".left-side .comments-area").prepend(this.paginator.render().el),this.initPaginatorListener()))}else this.paginator.destroy()},fetchRelatedImages:function(){var a=new Backbone.Collection({},{url:IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES+"/"+this.model.get("id")+"/related?limit=30&offset=0"});return a.parse=function(a){
return(a||{}).result||[]},a.on("sync",function(a){this.renderRelatedImages(a.models)}.bind(this),this),a.fetch({cache:!0,expires:IS.cm.TIMES.HOUR}),this},fetchCameraSettings:function(){this.cameraSettings&&this.cameraSettings.destroy();var a=new Backbone.Model({},{url:IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES+"/"+this.model.get("id")+"/exif"});return a.parse=function(a){return(a||{}).result||[]},a.once("sync",function(a){this.cameraSettings=new IS.Views.LandingCameraSettings({model:a}),this.$settings.append(this.cameraSettings.render().el),this.$settings.hasClass("expanded")&&this.$settings.css("height",this.adjustments.TAGS_PARENT+this.$settings.find(".content").height())}.bind(this),this),a.fetch({cache:!0,expires:IS.cm.TIMES.DAY}),this},renderRelatedImages:function(a){var b=a.length;return this.$relatedImages.empty().css("width",b*this.relatedImageWidth+(b-1)*this.relatedImageMargin),_.each(a,function(a){var b=new IS.Views.LandingRelatedImage({model:a});this.$relatedImages.append(b.render().el)}.bind(this)),this.$relatedImagesParent.scrollLeft(0),this.$relatedImagesParent.width()>=this.$relatedImages.width()?(this.$relatedRightArrow.addClass("disabled"),this.$relatedLeftArrow.addClass("disabled")):this.toggleRelatedArrows(),this},renderTimelineWidget:function(){return IS.currentUser?(this.timelineWidget&&this.timelineWidget.destroy(),this.timelineWidget=new IS.Views.TimelineWidget({username:this.model.get("owner").username,category:"Landing Page"}),this.$userArea.append(this.timelineWidget.render().el),this):(this.renderAd(),this)},renderAd:function(){"f08MMPcVj"==this.model.get("id")&&this.$promo.html(IS.helpers.getAdHTML({code:IS.CONS.ADS.LP1}))},renderFollowButton:function(){if(this.model.get("is_owner")||!IS.currentUser)return this.$followArea.empty(),this;var a=new Backbone.Model({},{url:IS.CONS.API_BASE+IS.CONS.APIS.FOLLOW.IS_FOLLOWING+"/"+this.model.get("owner").username});return a.parse=function(a){return(a||{}).result||[]},a.once("sync",function(a){var b=!!a.get(this.model.get("owner").username);this.$followArea.html(Mustache.render(IS.inlineTemplates.follow_button,{isFollowed:b,followValue:b?1:0})),new IS.Views.FollowButton({el:this.$followArea.find(".follow-button"),username:this.model.get("owner").username,category:"Landing Page"})}.bind(this),this),a.fetch(),this},renderSimilarImages:function(){return this},renderFacebookButton:function(){return this.$stats.find(".facebook-like").remove().end().append(Mustache.render(IS.inlineTemplates.facebook_like_button,{url:encodeURIComponent("http:"+IS.CONS.SITE_URL+IS.Models.Photo.landingURL(this.model.get("id")))})),this},expandLinksDetail:function(a){IS.et.pe("Landing Page","Toggle","Links");var b=$(a.currentTarget),c=b.parent();if(c.toggleClass("expanded"),b.data("height-selector")){var d=c.find(b.data("height-selector")).height();c.css("height",c.hasClass("expanded")?this.adjustments.TAGS_PARENT+d:46)}},handleLikeUnlike:function(a){var b=$(a.currentTarget);this.model.get("liked")?this.unlike(b,!1):this.like(b,!1)},like:function(a,b){return IS.currentUser?void(a.hasClass("processing")||(a.addClass("processing"),a.addClass("liked"),this.model.set("likes",this.model.get("likes")+1),this.updateLikeCount(),this.model.once("liked",function(){IS.et.pe("Landing Page","Like","Image"),a.removeClass("processing"),this.model.set("liked",!0),b&&window.location.reload()},this),this.model.like())):void IS.helpers.showLoginSignupOverlay(function(){this.like(a,!0)}.bind(this),null)},unlike:function(a,b){return IS.currentUser?void(a.hasClass("processing")||(a.addClass("processing"),a.removeClass("liked"),this.model.set("likes",Math.max(0,this.model.get("likes")-1)),this.updateLikeCount(),this.model.once("unliked",function(){IS.et.pe("Landing Page","Unlike","Image"),a.removeClass("processing"),this.model.set("liked",!1),b&&window.location.reload()},this),this.model.unlike())):void IS.helpers.showLoginSignupOverlay(function(){this.unlike(a,!0)}.bind(this),null)},updateLikeCount:function(){this.$(".left-side .likes b").html(this.model.get("likes"))},textAreaKeyUp:function(a){var b=$(a.currentTarget),c=this.$(".left-side .submit-button"),d=this.$(".left-side .counter"),e=b.val();c[e?"fadeIn":"fadeOut"](100),e?(d.html(Math.max(0,this.maxCommentLength-e.length)).show(),e.length>=this.maxCommentLength&&b.val(e.substring(0,this.maxCommentLength))):d.hide()},submitComment:function(){IS.currentUser?this.postComment(!1):IS.helpers.showLoginSignupOverlay(function(){this.postComment(!0)}.bind(this))},postComment:function(a){var b=IS.helpers.stripHTML($.trim(this.$(".left-side .comment-input textarea").val()));if(!b)return void IS.helpers.displayUserError(IS.Views.Mixins.Messages.missingCommentText);var c=new IS.Models.LandingComment({owner:{username:IS.currentUser.get("username"),avatar:{server:IS.currentUser.get("avatarServer"),filename:IS.currentUser.get("avatarFilename")},membership:IS.currentUser.get("membership")},server:this.model.get("server"),filename:this.model.get("filename"),comment:b,creation_date:(new Date).getTime()/1e3,is_owner:!0});this.comments.add(c),this.$window.resize(),c.save(c.attributes,{success:function(b,c){b.set("id",c.result||""),IS.et.pe("Landing Page","Post","Comment"),a&&window.location.reload()}.bind(this)})},commentAdded:function(a){var b=new IS.Views.LandingComment({model:a,messageWidth:this.$dynamicElems.eq(0).width()-this.adjustments.COMMENT_INPUT});this.$(".left-side .comments-area .comments")[this.renderedFirstCommentSet&&!a.isNew()?"prepend":"append"](b.render().el),this.commentsViews.push(b),this.resetCommentBox(),b.show(),this.renderedFirstCommentSet||this.commentsViews.length!=this.model.get("comments_limit")||(this.renderedFirstCommentSet=!0)},resetCommentBox:function(){this.$(".left-side .comment-input textarea").val("").trigger("keyup")},ignoreNavigation:function(a){return a.target&&a.target.nodeName&&("textarea"==a.target.nodeName.toLowerCase()||"input"==a.target.nodeName.toLowerCase())},navigatePrev:function(a){if(!(this.lbView||this.$el.hasClass("processing")||this.ignoreNavigation(a.event))){var b=this.model.nextImageURL();b&&(IS.et.pe("Landing Page","Push","Left Arrow Key"),Backbone.history.navigate(b,!0))}},navigateNext:function(a){if(!(this.lbView||this.$el.hasClass("processing")||this.ignoreNavigation(a.event))){var b=this.model.prevImageURL();b&&(IS.et.pe("Landing Page","Push","Right Arrow Key"),Backbone.history.navigate(b,!0))}},navigatePrevSwipe:function(){var a=this.model.nextImageURL();a&&(IS.et.pe("Landing Page","Push","Swipe Prev"),Backbone.history.navigate(a,!0))},navigateNextSwipe:function(){var a=this.model.prevImageURL();a&&(IS.et.pe("Landing Page","Push","Swipe Next"),Backbone.history.navigate(a,!0))},show:function(){return _.defer(function(){IS.vent.trigger("app_layout:content:loaded"),this._destroyed||(this.$el.show(),_.delay(function(){this.$el.addClass("loaded")}.bind(this),100))}.bind(this)),this},updateView:function(){var a=this.model.get("datetime").call(this.model.attributes),b=this.model.get("date_string").call(this.model.attributes),c=this.model.get("has_prev_image").call(this.model.attributes),d=this.model.get("has_next_image").call(this.model.attributes),e=this.model.get("title")||this.model.get("original_filename"),f=this.model.get("owner"),g="pro"==f.membership,h=f.avatar;return c?this.$prevAnchor.removeClass("hidden").attr("href",IS.Models.Photo.landingURL(this.model.get("prev_image_id").call(this.model.attributes))):this.$prevAnchor.addClass("hidden"),d?this.$nextAnchor.removeClass("hidden").attr("href",IS.Models.Photo.landingURL(this.model.get("next_image_id").call(this.model.attributes))):this.$nextAnchor.addClass("hidden"),this.$rightSide.find(".user-area .profile-username")[g?"addClass":"removeClass"]("premium-badge"),this.$el.find(".user-anchor").attr("href",f.username?"/user/"+f.username:"").end().find(".user-avatar").attr("src",h.server?IS.helpers.getImagizerLink({width:56,height:56,cropped:!0,server:h.server,filename:h.filename}):IS.Models.User.getDefaultAvatar(56)).end().find(".profile-username").html(f.username||"").end().find(".left-side").find(".image-info header h1").html(e).attr("title",e).end().find(".stats .likes").removeClass("liked").addClass(this.model.get("liked")?"liked":"").find("b").html(this.model.get("likes")).end().end().find(".stats .views b").html(this.model.get("views")).end().end().find(".right-side").find(".user-area header").find("time").attr("datetime",a).html("Uploaded "+b).end().end().find("#share-dl").attr("href",Mustache.render(IS.inlineTemplates.download_link,{server:this.model.get("server"),filename:this.model.get("filename")})),this.model.get("is_owner")||this.model.get("public")?this.$el.removeClass("private"):this.$el.addClass("private"),this},switchImage:function(){return _.delay(function(){(function(a){var b=new Image,c=IS.helpers.getImagizerLink(_.extend(this.getImageData(),{quality:this.imageQuality.LOW}));IS.helpers.isGif(a.get("filename"))&&(c=IS.inlineTemplates.direct({server:a.get("server"),filename:a.get("filename"),bucket:a.get("bucket")}).replace("http:","")),b.onload=function(){this.$el.removeClass("processing"),a.get("id")==this.model.get("id")&&(this.$heroImage.attr("src",c),_.defer(function(){var a=this.getImageData();this.$heroParent.css({padding:a.padding?a.padding+"px 0":0,height:a.height+2*a.padding}),this.$heroImage.css({width:a.width,height:a.height}),this.$heroImage.removeClass("invisible"),this.loadHigherQuality(!1)}.bind(this)))}.bind(this),b.onerror=function(){this.$el.removeClass("processing"),this.$heroImage.removeClass("invisible"),IS.helpers.isGif(this.model.get("filename"))?this.$heroImage.hasClass("broken")||this.$heroImage.addClass("broken").attr("src","/v2_images/empty.png"):this.$heroImage.hasClass("direct-linked")?this.$heroImage.addClass("broken").attr("src","/v2_images/empty.png"):this.$heroImage.addClass("direct-linked").attr("src","/a/img"+this.model.get("server")+"/"+this.model.get("bucket")+"/"+this.model.get("filename"))}.bind(this),b.src=c}).bind(this)(this.model)}.bind(this),this.transitionSpeed),this},setModel:function(a){this.previousUsername=this.model.get("owner").username,this.model=a,IS.currentUser||this.renderAd();for(var b=0;b<this.models.length;b++)if(this.models[b].id==this.model.get("id")){this.modelIndex=b;break}this.preloadModels().handleEventTracking(),IS.vent.trigger("landing_page:end:transition",this.model),!this.model.get("is_owner")&&this.model.incrementViewCount(),IS.helpers.setPageTitle(this.model.get("title")||this.model.get("original_filename")),this.comments.setProps({server:this.model.get("server"),filename:this.model.get("filename"),offset:null,limit:this.model.get("comments_limit")}),this.updateView().switchImage().renderFacebookButton().fetchCameraSettings().fetchRelatedImages().renderSimilarImages().renderTags().fetchComments(),this.previousUsername!=this.model.get("owner").username&&this.renderFollowButton().renderTimelineWidget(),this.model.get("is_owner")?this.titleEditable?(this.titleEditable.setModel(this.model),this.titleEditable.enable()):this.titleEditable=new IS.Views.LandingTitleEditable({el:this.$(".left-side .image-info header"),model:this.model}):this.titleEditable&&this.titleEditable.disable()},ownerAvatarClicked:function(){IS.et.pe("Landing Page","Click","Owner Avatar")},ownerUsernameClicked:function(){IS.et.pe("Landing Page","Click","Owner Username")},downloadClicked:function(){IS.et.pe("Landing Page","Click","Download")},resize:function(a){var b=a.width-this.rightSideMargin-this.rightSideWidth-2*this.margin,c=this.$(".left-side .comments .message .text");this.$inputParent.add(c).css("width",b-this.adjustments.COMMENT_INPUT),this.$inputTextarea.css("width",b-this.adjustments.TEXTAREA),this.$dynamicElems.css("width",b),this.$relatedImagesParent.css("width",b-this.adjustments.RELATED_PARENT),this.$titleParent.css("width",Math.max(100,b-this.adjustments.IMAGE_STATS));var d=this.getImageData(b);+this.$heroImage.data("width")||+this.$heroImage.data("height")?d.width>+this.$heroImage.data("width")&&(this.$heroImage.data("width",this.model.get("width")),this.$heroImage.data("height",this.model.get("height")),this.loadHigherQuality(!0)):(this.$heroImage.data("width",d.width),this.$heroImage.data("height",d.height),this.loadHigherQuality(!1)),_.delay(function(){this.$heroParent.css({padding:d.padding?d.padding+"px 0":0,height:d.height+2*d.padding}),this.$heroImage.css({width:d.width,height:d.height})}.bind(this),50),this.$relatedImagesParent.width()>=this.$relatedImages.width()?(this.$relatedRightArrow.addClass("disabled"),this.$relatedLeftArrow.addClass("disabled")):this.toggleRelatedArrows()},loadHigherQuality:function(a){return IS.helpers.isGif(this.model.get("filename"))?this:(function(a,b){var c=new Image,d={quality:this.imageQuality.HIGH};b&&(d.width=this.model.get("width"),d.height=this.model.get("height"));var e=IS.helpers.getImagizerLink(_.extend(this.getImageData(),d));c.onload=function(){a.get("id")==this.model.get("id")&&this.$heroImage.attr("src",e)}.bind(this),c.src=e}.bind(this)(this.model,a),this)},getImageData:function(a){a=a||{};var b=a.width||this.$dynamicElems.eq(0).width(),c=a.model||this.model,d=(this.$window.width()/this.$window.height()).toFixed(2)>this.ratioThreshold,e=Math.min(b,c.get("width")),f=e==c.get("width")?c.get("height"):e*c.get("height")/c.get("width"),g=0;if(e=Math.round(e),f=Math.round(f),b>e&&(g=Math.min(this.maxImagePadding,Math.round((b-e)/2))),d&&this.pageTopMargin+2*g+f+this.titleAreaHeight>this.$window.height()){var h=this.$window.height()-this.pageTopMargin-this.titleAreaHeight;c.get("height")>=h?(f=h-2*this.maxImagePadding,g=this.maxImagePadding):(f=c.get("height"),g=Math.min(this.maxImagePadding,Math.round((h-f)/2))),e=f*c.get("width")/c.get("height"),e=Math.round(e),f=Math.round(f)}return{width:e,height:f,padding:g,server:c.get("server"),filename:c.get("filename")}},setupElements:function(){return this.$rightSide=this.$(".right-side"),this.$leftSide=this.$(".left-side"),this.$heroParent=this.$leftSide.find("figure.image"),this.$heroImage=this.$heroParent.find("img"),this.$dynamicElems=this.$(".dynamic-width"),this.$inputParent=this.$leftSide.find(".comment-input .input"),this.$inputTextarea=this.$leftSide.find(".comment-input textarea"),this.$prevAnchor=this.$leftSide.find(".image a.prev"),this.$nextAnchor=this.$leftSide.find(".image a.next"),this.$relatedImagesParent=this.$leftSide.find(".related-images .images"),this.$relatedImages=this.$relatedImagesParent.find("> .wrapper"),this.$relatedLeftArrow=this.$leftSide.find(".related-images a.left"),this.$relatedRightArrow=this.$leftSide.find(".related-images a.right"),this.$userArea=this.$rightSide.find(".user-area"),this.$promo=this.$userArea.find(".is-promo"),this.$bottom=this.$(".bottom-part"),this.$settings=this.$rightSide.find(".details .settings"),this.$stats=this.$leftSide.find(".image-info .stats"),this.$titleParent=this.$leftSide.find(".image-info header"),this.$likeParent=this.$leftSide.find(".stats .likes"),this.$followArea=this.$rightSide.find(".user-area .follow"),this.assignListeners(),this},assignListeners:function(){var a=_.throttle(function(){this.toggleRelatedArrows()}.bind(this),100);this.$relatedImagesParent.on("scroll",a)},toggleRelatedArrows:function(){this.$relatedImagesParent.scrollLeft()==this.$relatedImages.width()-this.$relatedImagesParent.width()?this.$relatedRightArrow.addClass("disabled"):this.$relatedRightArrow.removeClass("disabled"),0==this.$relatedImagesParent.scrollLeft()?this.$relatedLeftArrow.addClass("disabled"):this.$relatedLeftArrow.removeClass("disabled")},scrollRelatedLeft:function(a){a.currentTarget.className.indexOf("disabled")>=0||IS.helpers.animateScrollLeft(this.$relatedImagesParent,Math.max(0,this.$relatedImagesParent.scrollLeft()-Math.round(.9*this.$relatedImagesParent.width())))},scrollRelatedRight:function(a){if(!(a.currentTarget.className.indexOf("disabled")>=0)){var b=this.$relatedImages.width()-this.$relatedImagesParent.width();IS.helpers.animateScrollLeft(this.$relatedImagesParent,Math.min(b,this.$relatedImagesParent.scrollLeft()+Math.round(.9*this.$relatedImagesParent.width())))}},showImageOverlay:function(a){var b=$(a.currentTarget);IS.et.pe("Landing Page","Lightbox Trigger",b.hasClass("lb-trigger")?"Trigger":"Image"),this.lbView=new IS.Views.ImageOverlay({model:this.model}),$("body").append(this.lbView.render().el),this.lbView.on({close:function(a){this.lbView=null,this.$heroImage.addClass("invisible"),this.setModel(a)}.bind(this),liked:function(){this.$likeParent.addClass("liked"),this.updateLikeCount()}.bind(this),unliked:function(){this.$likeParent.removeClass("liked"),this.updateLikeCount()}.bind(this)},this),_.defer(function(){this.lbView.show()}.bind(this))},prevClicked:function(){IS.et.pe("Landing Page","Click","Prev Arrow")},nextClicked:function(){IS.et.pe("Landing Page","Click","Next Arrow")},preloadOverlayImage:function(a,b){b=b||this.model;var c=b.attributes;if(IS.helpers.isGif(c.filename))return void((new Image).src=IS.inlineTemplates.direct({server:c.server,filename:c.filename,bucket:c.bucket}).replace("http:",""));var d=this.$window.width(),e=this.$window.height(),f=IS.helpers.getAdjustedDimensions({width:c.width,height:c.height,maxWidth:d,maxHeight:e});(new Image).src=IS.helpers.getImagizerLink({server:c.server,filename:c.filename,width:f.width,height:f.height,quality:90},!1)},showGetLinksLightbox:function(){IS.et.pe("Landing Page","Click","Get Links/Image Sizes"),IS.vent.trigger("grid_items:add_selected_photo",{model:this.model}),IS.vent.trigger("grid_items:show:get_links",{page:"Landing Page"})},setupTouchEvents:function(){this.$heroParent.horizon({callback:function(a){"L"==a&&this.navigateNextSwipe(),"R"==a&&this.navigatePrevSwipe()}.bind(this)})},getPreloadedModel:function(a){for(var b=null,c=0;c<this.models.length;c++)if(this.models[c].get("id")==a){b=this.models[c];break}return b},preloadModels:function(){var a=this.models[this.modelIndex];return 0==this.modelIndex&&a.get("prev_images").length&&this.preloadModel(a.get("prev_images")[0],!0),this.modelIndex==this.models.length-1&&a.get("next_images").length&&this.preloadModel(a.get("next_images")[0],!1),this},preloadModel:function(a,b){var c=new IS.Models.Landing({id:a.id});c.once("sync",function(a){this.models[b?"unshift":"push"](a),this.preloadOverlayImage({},a);var d=IS.helpers.getImagizerLink(_.extend(this.getImageData({model:a}),{quality:this.imageQuality.LOW}));IS.helpers.isGif(c.get("filename"))&&(d=IS.inlineTemplates.direct({server:a.get("server"),filename:a.get("filename"),bucket:a.get("bucket")}).replace("http:","")),(new Image).src=d}.bind(this)),c.fetch()},displayImageStats:function(a){var b=$(a.currentTarget);return IS.et.pe("Landing Page","Click","Image Stats - "+b.data("label")),!IS.currentUser||IS.currentUser.get("freeAccount")?void IS.helpers.showFeaturesOverlay():(this.imageStats=new IS.Views.ImageStats({model:this.model}),void $("body").append(this.imageStats.render().el))},handleEventTracking:function(){var a=!!IS.currentUser,b=IS.helpers.isNewServer(this.model.get("server"));return IS.et.pe("Landing Page",a?"Logged In":"Logged Out",b?"New Image":"Old Image"),IS.et.pe("Landing Page","View",a?"Logged In":"Logged Out"),this},destroy:function(){IS.vent.trigger("landing_page:destroy"),IS.vent.off("app_layout:content:size:change",this.resize,this),this.$relatedImagesParent.off("scroll"),_.each(this.commentsViews,function(a){a.destroy()}),this.commentsViews=[],this.imageStats&&this.imageStats.destroy&&this.imageStats.destroy(),this.paginator&&this.paginator.destroy(),this.linksView&&this.linksView.destroy(),this.tagsView&&this.tagsView.destroy(),this.titleEditable&&this.titleEditable.destroy(),this.timelineWidget&&this.timelineWidget.destroy(),this.similarImages&&this.similarImages.destroy(),this.cameraSettings&&this.cameraSettings.destroy(),Backbone.View.prototype.destroy.call(this)}}),IS.Views.LandingRelatedImage=Backbone.View.extend({tagName:"a",events:{click:"clicked"},render:function(){var a=this;return this.$el.html(Mustache.render(IS.inlineTemplates.landing_related_img,_.extend(this.model.attributes,{imageUrl:function(){return IS.helpers.getImagizerLink({server:a.model.get("server"),filename:a.model.get("filename"),width:120,height:120,cropped:!0})}}))),this.$el.attr("href",IS.Models.Photo.landingURL(this.model.get("id"))),this},clicked:function(){IS.et.pe("Landing Page","Click","Related Image")}}),IS.Views.LandingStream=Backbone.View.extend({tagName:"section",className:"stream",events:{"click .arrow":"arrowClicked","click .thumbs a":"thumbnailClicked"},initialize:function(){this.template=IS.helpers.loadTemplate("landing_stream")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,this.model.attributes)),this},arrowClicked:function(a){var b=$(a.currentTarget);b.hasClass("disabled")||(this.trigger("change:direction",{value:b.hasClass("prev")?"right":"left"}),IS.et.pe("Landing Page","Click",(b.hasClass("prev")?"Prev":"Next")+" Arrow"))},thumbnailClicked:function(a){IS.et.pe("Landing Page","Click",($(a.currentTarget).hasClass("prev")?"Prev":"Next")+" Thumbnail")}}),IS.Views.LandingTags=Backbone.View.extend({tagName:"div",className:"content",tagViews:[],currentTags:[],events:{"keypress .add-tags input":"inputKeypress","click .add-tags input":"inputClick"},initialize:function(){this.template=IS.helpers.loadTemplate("landing_tags"),this.tagViews=[],this.currentTags=[],this.slideSpeed=200,this.setupElements(),this.$items.find(".tag").length&&!this.tagViews.length&&this.attachTagViews(),this.$("input, textarea").placeholder(),this.setupAutocomplete()},setupElements:function(){this.$items=this.$(".items"),this.$addSectionInput=this.$(".add-tags input")},render:function(){var a=this;return this.$el.html(IS.helpers.renderTemplate(this.template,_.extend(this.model.attributes,{isOwner:this.model.get("is_owner"),areTags:!!this.model.get("tags").length,tagsHtml:function(){var b="";return _.each(this.model.get("tags"),function(c){var d=new IS.Views.ImageTag({model:new IS.Models.ImageTag({name:c,isOwner:a.model.get("is_owner")})});b+=d.render().el.outerHTML}.bind(this)),b}.bind(this)}))),this.$el.attr("data-name",this.model.get("name")),this.setupElements(),this.attachTagViews(),this.setupAutocomplete(),this},attachTagViews:function(){var a=this;this.$items.find(".tag").each(function(){var b=$(this),c=new IS.Views.ImageTag({el:b,model:new IS.Models.ImageTag({name:b.data("name"),isOwner:a.model.get("is_owner")}),landingModel:a.model});c.once("removed",function(b){a.trigger("change:tags"),a.removeTagFromList(b.model)},this),a.tagViews.push(c),a.currentTags.push(b.data("name"))})},inputKeypress:function(a){var b=this;if(IS.helpers.isEnterKey(a.keyCode)){var c=$(a.currentTarget),d=IS.helpers.parseTags(c.val());if(d.length){var e=[];e=this.currentTags.length?_.difference(d,this.currentTags):d,this.model.addTags(e,function(a){a.success?IS.cm.invalidateByCacheKey("user_tags"):IS.helpers.displayUserError("Unable to add tags at this time.")}.bind(this)),_.each(e,function(a){var c=new IS.Views.ImageTag({model:new IS.Models.ImageTag({name:a,isOwner:this.model.get("is_owner")}),landingModel:this.model});c.once("removed",function(a){b.trigger("change:tags"),b.removeTagFromList(a.model)}.bind(this),this),this.tagViews.push(c),this.$items.append(c.render().el),this.currentTags.push(a)}.bind(this)),c.val(""),IS.vent.trigger("app_layout:navbar:increment_tag_link",{tags:e}),IS.et.pe("Landing Page","Push","Tags Input Enter"),this.trigger("change:tags")}}},inputClick:function(){IS.et.pe("Landing Page","Click","Tags Input")},setupAutocomplete:function(){IS.currentUser&&this.$addSectionInput.autocomplete({serviceUrl:IS.CONS.API_BASE+"/user/"+IS.currentUser.get("username")+"/tags",paramName:"tags_by_letter",width:284,params:{auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY,limit:20,image_limit:0},beforeRender:function(a){$(a).addClass("type-landing")},transformResult:function(a){var b=$.parseJSON(a),c={suggestions:[]};return b.result.total?(c.suggestions=_.map(b.result.tags,function(a,b){return b}),c):c}})},removeTagFromList:function(a){a&&a.get("name")&&(this.currentTags=_.without(this.currentTags,a.get("name")))},destroy:function(){_.each(this.tagViews,function(a){a.destroy()}),Backbone.View.prototype.destroy.call(this)}}),IS.Views.LandingTitleEditable=Backbone.View.extend({events:{click:"clicked",mouseenter:"mouseentered",mouseleave:"mouseleaved","keyup input.edit":"inputKeyup","blur input.edit":"inputFocusout"},active:!1,enabled:!0,initialize:function(){this.template=IS.inlineTemplates.landing_photo_title,this.inputTemplate=IS.inlineTemplates.landing_photo_title_input,this.setupElements()},render:function(){return this.$el.html(Mustache.render(this.template,{title:this.model.get("title")||this.model.get("original_filename")})),this.setupElements(),this.delegateEvents(),this},renderInput:function(){return this.$el.html(Mustache.render(this.inputTemplate,{title:function(){return this.model.get("title")?this.model.get("title"):this.model.get("original_filename")}.bind(this)})),this.setupElements(),this.delegateEvents(),this},setupElements:function(){return this.$title=this.$("h1"),this},activate:function(){this.active=!0},deactivate:function(){this.active=!1,this.mouseleaved()},clicked:function(){!this.active&&this.enabled&&(this.mouseleaved(),this.$title.remove(),this.renderInput(),this.$("input.edit").focus().select(),this.activate())},mouseentered:function(){!this.active&&this.enabled&&this.$title.addClass("hovered")},mouseleaved:function(){!this.active&&this.enabled&&this.$title.removeClass("hovered")},inputKeyup:function(a){IS.helpers.isEnterKey(a.which)&&this.active&&this.sendModel()},sendModel:function(){var a=this.model.get("title");this.model.save({title:$.trim(this.$("input.edit").val())},{silent:!0,success:function(){IS.et.pe("Landing","Edit","Title"),this.deactivate(),this.render(),IS.helpers.setPageTitle(this.model.get("title")),IS.cm.invalidateByCacheKey("my_images"),IS.cm.invalidateByCacheKey("my_albums")}.bind(this),error:function(b,c,d){this.model.set({title:a}),this.deactivate(),this.render();var e="Unable to update title. Try again later.";IS.logger.error(e,b.attributes),IS.helpers.displayUserError(e)}.bind(this)})},inputFocusout:function(){this.deactivate(),this.model.get("title")!=this.$("input.edit").val()?this.sendModel():this.render()},setModel:function(a){this.model=a},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}}),IS.Views.Lightbox=Backbone.View.extend({tagName:"div",className:"lightbox",initialize:function(){return this.wrapperTemplate=IS.helpers.loadTemplate("lightbox"),this.id?void IS.vent.on("body:keyup:escape",this.hide,this):IS.logger.error("[Views.Lightbox] Must have an ID")},render:function(a){return a?(this.$el.html(IS.helpers.renderTemplate(this.wrapperTemplate,{content:a})),this):IS.logger.error("[Views.Lightbox] Content is required to render")},appendToPage:function(){return $("#"+this.id).length?IS.logger.error("[Views.Lightbox] Already appended"):void $("body").append(this.$el)},show:function(){this.$el.show(),this.$el.removeClass("fadeOutUp"),this.$el.addClass("animated fadeInDown")},hide:function(){return this.$el.is(":visible")?(this.$(".is-promo").empty(),this.$el.removeClass("fadeInDown"),this.$el.addClass("animated fadeOutUp"),Modernizr.cssanimations?setTimeout(function(){this.$el.hide()}.bind(this),200):this.$el.hide(),IS.vent.trigger("app_layout:lightbox_close"),this.trigger("closed"),!0):!1},toggleGreenRadio:function(a){var b=$(a.currentTarget),c=this.$(".radio-green");c.removeClass("selected"),b.toggleClass("selected")}}),IS.Views.LightboxAddFilters=IS.Views.Lightbox.extend({id:"lightbox-add-filters",events:{"click .button-grey-cancel":"hide"},initialize:function(){IS.Views.Lightbox.prototype.initialize.call(this),this.template=IS.helpers.loadTemplate("lightbox_add_filters"),this.render(),this.appendToPage(),this.dropdownView=new IS.Views.Dropdown({el:".lightbox-filters.dropdown"})},render:function(){var a=IS.helpers.renderTemplate(this.template,{});return IS.Views.Lightbox.prototype.render.call(this,a),this}}),IS.Views.LightboxAddTags=IS.Views.Lightbox.extend({id:"lightbox-add-tags",events:{"click .close":"hide","click .button-grey-cancel":"hide","keypress .add-tags input":"inputKeypress","click .button-dark":"submitClicked","click .button-dark.send":"sendTagsToServer"},selectedPhotosCollection:null,activeRequest:!1,tagsToBeAdded:[],initialize:function(){IS.Views.Lightbox.prototype.initialize.call(this),this.template=IS.helpers.loadTemplate("lightbox_add_tags"),this.render(),this.appendToPage()},render:function(){var a=IS.helpers.renderTemplate(this.template,{count:function(){return this.selectedPhotosCollection?this.selectedPhotosCollection.length:0}.bind(this)});return IS.Views.Lightbox.prototype.render.call(this,a),this.tagsToBeAdded=[],this.setupElements(),this.$("input, textarea").placeholder(),this},setupElements:function(){this.$items=this.$(".items"),this.$addSection=this.$(".add-tags"),this.$addSectionInput=this.$(".add-tags input"),this.$sendBtn=this.$(".button-dark.send")},show:function(a){this.selectedPhotosCollection=a.collection,this.tagsToBeAdded=[],this.render(),IS.Views.Lightbox.prototype.show.call(this)},submitClicked:function(){this.$addSectionInput.val().length&&this.submitTags()},inputKeypress:function(a){IS.helpers.isEnterKey(a.which)&&this.submitTags()},submitTags:function(){var a=IS.helpers.parseTags(this.$addSectionInput.val());if(a.length){var b=_.difference(a,this.tagsToBeAdded);_.each(b,function(a){this.tagsToBeAdded.push(a)}.bind(this)),_.each(b,function(a){var b=new IS.Views.ImageTag({lightboxMode:!0,model:new IS.Models.ImageTag({name:a,isOwner:1})}).on("removed",function(a){a.model.get("name")&&(this.tagsToBeAdded=_.without(this.tagsToBeAdded,a.model.get("name")))}.bind(this)),c=b.render().el;this.$items.append(c)}.bind(this)),this.$addSectionInput.val("")}},sendTagsToServer:function(){if(this.tagsToBeAdded.length&&!this.activeRequest){this.activeRequest=!0,this.disableSendButton();var a=this.selectedPhotosCollection.pluck("id");IS.Models.Photo.addTags(a,this.tagsToBeAdded,function(a){a.success?($("body").trigger($.Event("keyup",{which:27})),_.delay(function(){IS.helpers.displayUserMessage("Successfully added tags.")},500),this.tagsToBeAdded=[],IS.vent.trigger("app_layout:navbar:tags_refresh"),IS.cm.invalidateByCacheKey("user_tags")):(IS.helpers.displayUserError("Unable to add tags at this time."),this.enableSendButton()),this.activeRequest=!1}.bind(this))}},disableSendButton:function(){this.$sendBtn.html("SENDING...").addClass("disabled")},enableSendButton:function(){this.$sendBtn.html("ADD TAGS").removeClass("disabled")}}),IS.Views.LightboxDeleteImages=IS.Views.Lightbox.extend({id:"lightbox-delete-images",events:{"click .button-grey-cancel":"hide","click .button-dark":"deleteClicked"},selectedPhotosCollection:null,activeRequest:!1,initialize:function(){IS.Views.Lightbox.prototype.initialize.call(this),this.template=IS.helpers.loadTemplate("lightbox_delete_images"),this.render(),this.appendToPage(),this.$images=this.$(".images"),this.$tipCount=this.$(".tip span.count"),this.$deleteBtn=this.$(".button-dark"),this.$error=this.$(".error")},render:function(){var a=IS.helpers.renderTemplate(this.template,{});return IS.Views.Lightbox.prototype.render.call(this,a),this},show:function(a){this.selectedPhotosCollection=a.collection,this.generateThumbs(),IS.Views.Lightbox.prototype.show.call(this)},generateThumbs:function(){this.$images.empty(),this.selectedPhotosCollection.each(function(a){var b=a.imagizerURL({width:64,height:64,cropped:!0});this.$images.append($("<img />").attr("src",b))}.bind(this)),this.$tipCount.html(this.selectedPhotosCollection.size())},deleteClicked:function(){var a=this;if(!this.activeRequest){this.activeRequest=!0,this.hideError(),this.disableDeleteButton();var b=this.selectedPhotosCollection.pluck("id");
IS.Models.Photo.removeFromServer(b,function(c){c.success?(IS.et.pe("App","Delete","Bulk Images"),a.hide(),IS.cm.invalidateByCacheKey("my_images"),IS.vent.trigger("grid_items:reset",{deletedCount:_.size(b)}),_.delay(function(){a.resetState()},200)):(IS.logger.error("Unable to delete images",b),a.enableDeleteButton(),a.showError()),a.activeRequest=!1})}},disableDeleteButton:function(){this.$deleteBtn.html("DELETING...").addClass("disabled")},enableDeleteButton:function(){this.$deleteBtn.html("DELETE IMAGES").removeClass("disabled")},showError:function(){this.$error.show()},hideError:function(){this.$error.hide()},resetState:function(){this.hideError(),this.enableDeleteButton(),this.activeRequest=!1}}),IS.Views.LightboxGetLinks=IS.Views.Lightbox.extend({id:"lightbox-get-links",selectedPhotosCollection:null,events:{"click .dropdown":"stopBubbling","click .button-grey-cancel":"hide","click .close":"hide","focus textArea":"boxFocused","blur textArea":"boxBlurred","click .select-toggle":"toggleTextSelection"},initialize:function(){IS.Views.Lightbox.prototype.initialize.call(this),this.template=IS.helpers.loadTemplate("lightbox_get_links"),this.eventPage="",this.render(),this.appendToPage(),this.typeDropdownView=new IS.Views.Dropdown({el:this.$(".types .dropdown")}),this.typeDropdownView.on("change",function(a){IS.et.pe("Get Links/Image Sizes","Click",a.value.toUpperCase()),this.dropdownChanged()}.bind(this),this),this.sizeDropdownView=new IS.Views.Dropdown({el:this.$(".sizes .dropdown")}),this.sizeDropdownView.on("change",function(a){IS.et.pe("Get Links/Image Sizes","Click",a.value||"Fullsize"),this.dropdownChanged()}.bind(this),this),this.$links=this.$("textarea.links"),IS.vent.on({"body:clicked":this.hideDropdowns},this)},render:function(){var a=IS.helpers.renderTemplate(this.template,{otherClass:function(){return IS.currentUser?"":"prevent-click disabled"},freeAccount:!IS.currentUser});return IS.Views.Lightbox.prototype.render.call(this,a),this},show:function(a){this.renderAd(),this.eventPage=a.page,IS.et.pe("Get Links/Image Sizes","Page",this.eventPage),this.selectedPhotosCollection=a.collection,this.setDropdownValues().generateLinks(),IS.Views.Lightbox.prototype.show.call(this),this.$links.select()},renderAd:function(){},generateLinks:function(){var a="",b=(this.sizeDropdownView.getValue()||"").split("x"),c=this.typeDropdownView.getValue()||"direct";IS.currentUser&&IS.currentUser.setSetting("linkType",this.typeDropdownView.getValue()).setSetting("linkSize",this.sizeDropdownView.getValue()),this.selectedPhotosCollection.each(function(d){a+=IS.inlineTemplates[c]({id:d.get("id"),server:d.get("server"),filename:d.get("filename"),bucket:d.get("bucket"),width:b[0]||null,height:b[1]||null,cropped:!!b[2]})+"\n"}),this.$links.val(a?a.slice(0,-1):"")},dropdownChanged:function(){this.generateLinks(),this.$links.select()},hideDropdowns:function(){this.$(".dropdown").removeClass("active")},setDropdownValues:function(){if(!IS.currentUser)return this;var a=IS.currentUser.get("settings");return this.typeDropdownView.setValue(IS.CONS.LINK_OPTIONS[a.linkType],a.linkType),this.sizeDropdownView.setValue(a.linkSize?IS.CONS.SIZE_OPTIONS[a.linkSize]:"Fullsize",a.linkSize),this},stopBubbling:function(a){a.stopPropagation()},boxFocused:function(){IS.vent.on("clipboard:copy",function(){var a=IS.helpers.capitalizeFirstLetter(this.typeDropdownView.getValue()),b=this.sizeDropdownView.getValue()||"Fullsize";IS.et.pe("Get Links/Image Sizes","Select",a),IS.et.pe("Get Links/Image Sizes","Select",b),IS.et.pe("Get Links/Image Sizes","Copy",a+" @ "+b)}.bind(this),this)},boxBlurred:function(){IS.vent.off("clipboard:copy",null,this)},toggleTextSelection:function(){IS.et.pe("Get Links/Image Sizes","Click","Select All"),this.$links.select()}}),IS.Views.LightboxNewAlbum=IS.Views.Lightbox.extend({id:"lightbox-add-album",events:{"click .radio-green":"toggleGreenRadio","click .button-grey-cancel":"hide","click .button-dark.add":"submit","click .trackable":"trackEvent","click .privacy .item .radio-green":"privacyRadioClicked"},selectedPhotosCollection:null,dropdownView:null,initialize:function(){IS.Views.Lightbox.prototype.initialize.call(this),this.template=IS.helpers.loadTemplate("lightbox_new_album"),IS.vent.on("change:album_privacy",this.render,this),this.render(),this.appendToPage(),this.$("input, textarea").placeholder(),this.setupElements()},destroy:function(){this.dropdownView&&this.dropdownView.destroy(),IS.Views.Lightbox.prototype.destroy.call(this)},render:function(){var a="lightbox-add-album-edit"===this.id,b=IS.helpers.renderTemplate(this.template,{regularVersion:"lightbox-add-album"===this.id,navbarVersion:"lightbox-add-album-navbar"===this.id,editVersion:a,privateSelected:function(){return a?!this.model.get("public"):!(!IS.currentUser||!IS.currentUser.get("privateAlbums"))}.bind(this),showTitle:function(){return!a},addThumbCount:function(){return this.selectedPhotosCollection?this.selectedPhotosCollection.filter(function(a){return a.get("album")&&!a.get("album").id}).length:void 0}.bind(this),moveThumbCount:function(){return this.selectedPhotosCollection?this.selectedPhotosCollection.filter(function(a){return a.get("album")&&a.get("album").id}).length:void 0}.bind(this),showAddMsg:function(){return this.selectedPhotosCollection?!!this.selectedPhotosCollection.filter(function(a){return a.get("album")&&!a.get("album").id}).length:!1}.bind(this),showMoveMsg:function(){return this.selectedPhotosCollection?!!this.selectedPhotosCollection.filter(function(a){return a.get("album")&&a.get("album").id}).length:!1}.bind(this),passPlaceholder:function(){return a?"CHANGE PASSWORD":"ADD PASSWORD"},passConfirmPlaceholder:function(){return a?"CONFIRM CHANGE PASSWORD":"CONFIRM PASSWORD"}});return IS.Views.Lightbox.prototype.render.call(this,b),this.setupElements(),this},setupElements:function(){this.$inputTitle=this.$("input.title"),this.$addFields=this.$(".add-fields"),this.$addBtn=this.$(".button-dark.add"),this.$albumName=this.$(".msg span.album-name"),this.$moveSectionThumbs=this.$(".move > .thumbs"),this.$addSectionThumbs=this.$(".add > .thumbs"),this.$privatePasswords=this.$(".privacy .item .passwords"),this.$publicRadio=this.$(".radio-green.public-trigger"),this.$privateRadio=this.$(".radio-green.private-trigger"),"lightbox-add-album"==this.id&&(this.dropdownView=new IS.Views.LightboxNewAlbumDropdown({el:this.$(".dropdown")}).on("change",this.dropdownChange,this))},show:function(a){a&&a.collection&&(this.selectedPhotosCollection=a.collection),this.render(),"lightbox-add-album"===this.id&&(IS.vent.trigger("app_layout:navbar:disable_album_icon"),IS.vent.trigger("app_layout:navbar:hide_album_lightbox"),this.generateAddThumbs(),this.generateMoveThumbs()),IS.Views.Lightbox.prototype.show.call(this),this.$inputTitle.focus()},hide:function(){IS.Views.Lightbox.prototype.hide.call(this)&&("lightbox-add-album"===this.id&&IS.vent.trigger("app_layout:navbar:enable_album_icon"),_.delay(function(){this.render()}.bind(this),300))},generateAddThumbs:function(){this.$addSectionThumbs.empty(),this.selectedPhotosCollection.each(function(a){if(a.get("album")&&!a.get("album").id){var b=a.imagizerURL({width:45,height:45,cropped:!0});this.$addSectionThumbs.append($("<img />").attr("src",b))}}.bind(this))},generateMoveThumbs:function(){this.$moveSectionThumbs.empty(),this.selectedPhotosCollection.each(function(a){if(a.get("album")&&a.get("album").id){var b=a.imagizerURL({width:45,height:45,cropped:!0});this.$moveSectionThumbs.append($("<img />").attr("src",b))}}.bind(this))},submit:function(){"lightbox-add-album-edit"===this.id&&this.model?this.updateAlbumPrivacy():this.createAlbum()},updateAlbumPrivacy:function(){var a={title:this.$inputTitle.val(),description:this.$("textarea").val()},b=this.$(".radio-green.selected").data("id");if("public"==b)a["public"]=!0;else if("private-pass"==b){if(!this.validatePassword())return;var c=this.$privatePasswords.find("input.pass").val();a.password=c,a["public"]=!1}else"private"==b&&(a["public"]=!1,a.password_protected=!1);this.model.save(a,{patch:!0,success:function(a){IS.vent.trigger("app_layout:navbar:update_album_link_privacy",{album:a}),IS.helpers.displayUserMessage("Sucessfully update album privacy."),IS.cm.invalidateByCacheKey("my_images"),IS.cm.invalidateByCacheKey("my_albums"),this.hide()}.bind(this),error:function(){IS.helpers.displayUserError("Unable to update album privacy."),this.enableForm()}.bind(this)}),this.disableForm()},createAlbum:function(){var a;if(IS.et.pe("Add Album Menu","Click","Add Album"),this.dropdownView&&this.dropdownView.getValue())a=new IS.Models.Album({id:this.dropdownView.getValue()}),a.fetch({success:function(a,b){a.once("added_images",function(b){b.success?(IS.et.pe("App","Create Album","Add to Existing"),this.hide(),IS.cm.invalidateByCacheKey("my_images"),IS.cm.invalidateByCacheKey("my_albums"),Backbone.history.navigate(a.detailURL(),!0)):(IS.helpers.displayUserError("Unable to add images to album. Try again later."),this.enableForm())}.bind(this)),a.addImages(this.selectedPhotosCollection.models)}.bind(this),error:function(){IS.helpers.displayUserError("Unable to create new album. Try again later."),IS.logger.error("[Views.LightboxNewAlbum] Unable to retrieve model")}});else{if(a=new IS.Models.Album({title:this.$inputTitle.val(),description:this.$("textarea").val(),"public":!0}),"public"!=this.$(".radio-green.selected").data("id")&&a.set("public",!1),"private-pass"==this.$(".radio-green.selected").data("id")){if(!this.validatePassword())return;var b=this.$privatePasswords.find("input.pass").val();a.set("password",b)}a.save(null,{success:function(a){if(a.get("id")){var b=function(){IS.vent.trigger("app_layout:navbar:add_album_link",{album:a}),IS.currentUser.get("albums").add(a),_.delay(function(){this.hide(),IS.cm.invalidateByCacheKey("my_images"),IS.cm.invalidateByCacheKey("my_albums"),Backbone.history.navigate(a.detailURL(),!0)}.bind(this),750)}.bind(this);this.selectedPhotosCollection&&this.selectedPhotosCollection.length?(a.once("added_images",function(a){a.success?b():(IS.helpers.displayUserError("Unable to create new album. Try again later."),this.enableForm())}.bind(this)),a.addImages(this.selectedPhotosCollection.models)):b()}else IS.logger.error("[Views.LightboxNewAlbum] Missing album id in result",a.attributes)}.bind(this),error:function(a,b){var c=$.parseJSON(b.responseText);c&&(31==c.error.error_code?(IS.helpers.displayUserError("An album with that name already exists."),this.$inputTitle.focus()):IS.helpers.displayUserError("Unable to create new album. Try again later.")),IS.logger.error("[Views.LightboxNewAlbum] Unable to create new album",c),this.enableForm()}.bind(this)})}this.disableForm()},validatePassword:function(){var a=this.$privatePasswords.find("input.pass").val(),b=this.$privatePasswords.find("input.pass-confirm").val();return a.length&&b.length&&a==b?a.length<4?(IS.helpers.displayUserError("Password must be at least 4 characters."),!1):!0:(IS.helpers.displayUserError("Passwords don't match up."),!1)},disableForm:function(){this.$addBtn.html("ADDING...")},enableForm:function(){this.$addBtn.html("ADD ALBUM")},dropdownChange:function(a){a.value&&(this.$addFields.hide(),this.$(".line:last").hide()),this.$albumName.html(a.name),this.$addBtn.html("ADD TO ALBUM")},trackEvent:function(a){IS.et.pe("Add Album Menu","Click",IS.helpers.capitalizeFirstLetter($(a.currentTarget).data("id")))},privacyRadioClicked:function(a){var b=$(a.currentTarget);b.hasClass("private-password-trigger")?(this.$privatePasswords.show(),this.$privatePasswords.find("input.pass").focus()):this.$privatePasswords.hide()}}),IS.Views.LightboxNewAlbumDropdown=Backbone.View.extend({el:".dropdown",events:{click:"customClick","click .selection .item":"customItemClicked"},fetchStart:null,initialize:function(){_.extend(this,IS.Views.Mixins.Dropdown),this.setupElements(),this.collection=new IS.Collections.MyAlbums({},{image_limit:0,limit:50}),this.$selection=this.$(".selection"),this.$loading=this.$(".loading"),this.$noResults=this.$(".no-results"),this.collection.on("fetch:success",function(a){if(1!=a.page||this.collection.length){var b,c=Date.now()-this.fetchStart;b=c>=200?0:200-c,_.delay(function(){this.$loading.hide(),this.$selection.show(),_.each(this.collection.newest(),function(a){var b=Mustache.render(IS.inlineTemplates.lightbox_album_link,{id:a.get("id"),name:a.friendlyTitle({len:16})});this.$selection.append(b)}.bind(this))}.bind(this),200-c)}else this.$loading.hide(),this.$noResults.show()}.bind(this)),IS.helpers.infiniteScroll({$target:this.$selection,$reference:this.$selection,threshold:200,callback:function(){this.collection.isFetching||this.collection.nextPage()}.bind(this)})},customClick:function(a){this.isOpen()?(this.$loading.hide(),this.$noResults.hide(),this.fetchStart=null):(this.$selection.empty(),this.$loading.show(),this.collection.page=1,this.collection.fetch(),this.fetchStart=Date.now()),this.clicked(a)},customItemClicked:function(a){a.stopPropagation();var b=$(a.target);b.hasClass("prevent-click")||(this.$el.toggleClass("active"),this.itemClicked(a))}}),IS.Views.LightboxPrivacy=IS.Views.Lightbox.extend({id:"lightbox-privacy",events:{"click .radio-green":"toggleGreenRadio","click .button-grey-cancel":"hide","click .button-dark.save":"updatePrivacy"},selectedPhotosCollection:null,initialize:function(){IS.Views.Lightbox.prototype.initialize.call(this),this.template=IS.helpers.loadTemplate("lightbox_privacy"),IS.vent.on("change:image_privacy",this.render,this),this.render(),this.appendToPage()},render:function(){var a=IS.helpers.renderTemplate(this.template,{imageCount:function(){return this.selectedPhotosCollection?this.selectedPhotosCollection.length:0}.bind(this),private_images:IS.currentUser?IS.currentUser.get("privateImages"):null});return IS.Views.Lightbox.prototype.render.call(this,a),this.setupElements(),this},setupElements:function(){this.$saveBtn=this.$(".button-dark.save")},show:function(a){a&&a.collection&&(this.selectedPhotosCollection=a.collection),this.render(),IS.Views.Lightbox.prototype.show.call(this)},updatePrivacy:function(){this.disableForm();var a=this.selectedPhotosCollection.pluck("id"),b=!0;"private"==this.getPrivacyValue()&&(b=!1),IS.Models.Photo.updatePrivacy(a,b,function(c){c.success?(this.hide(),$("body").trigger($.Event("keyup",{which:27})),IS.cm.invalidateByCacheKey("my_images"),IS.vent.trigger("grid_item:rerender",{ids:a,updates:{"public":b}}),IS.helpers.displayUserMessage("Successfully updated images.",200)):(IS.helpers.displayUserError("Unable to update images. Try again later."),IS.logger.error("[Views.LightboxPrivacy] Unable to update images")),this.enableForm()}.bind(this))},getPrivacyValue:function(){var a;return this.$(".radio-green").each(function(){var b=$(this);return b.hasClass("selected")?(a=b.data("id"),!1):void 0}),a},disableForm:function(){this.$saveBtn.html("SAVING...")},enableForm:function(){this.$saveBtn.html("SAVE")}}),IS.Views.LightboxRotate=IS.Views.Lightbox.extend({id:"lightbox-rotate",events:{"click .button-grey-cancel":"hide","click .button-dark.save":"save","click .button.rotate":"rotate"},photoModel:null,currentRotation:0,initialize:function(){IS.Views.Lightbox.prototype.initialize.call(this),this.template=IS.helpers.loadTemplate("lightbox_rotate"),this.render(),this.appendToPage()},render:function(){var a=IS.helpers.renderTemplate(this.template,{heroURL:function(){return this.photoModel?this.photoModel.imagizerURL({width:500,height:500}):void 0}.bind(this)});return IS.Views.Lightbox.prototype.render.call(this,a),this.setupElements(),this},setupElements:function(){this.$saveBtn=this.$(".button-dark.save"),this.$hero=this.$(".hero img")},show:function(a){this.currentRotation=0,this.render(),IS.Views.Lightbox.prototype.show.call(this)},disableForm:function(){this.$saveBtn.html("SAVING...")},enableForm:function(){this.$saveBtn.html("SAVE")},rotate:function(a){var b=$(a.currentTarget);switch(b.data("action")){case 180:this.currentRotation+=180;break;case"90-left":this.currentRotation-=90;break;case"90-right":this.currentRotation+=90}this.$hero.css("transform","rotate("+this.currentRotation+"deg)")},save:function(){var a=this.currentRotation%360;switch(a){case-90:a=90;break;case-180:a=180;break;case-270:a=270;break;case 90:a=270;break;case 180:a=180;break;case 270:a=90}this.disableForm(),this.photoModel.updateRotation(a,function(a){a.success?(IS.helpers.displayUserMessage("Successfully rotated image.",500),IS.cm.invalidateByCacheKey("my_images"),Backbone.history.loadUrl(),this.hide()):(IS.helpers.displayUserError("Unable to rotate image. Try again later."),IS.logger.error("[Views.LightboxRotate] Unable to rotate image",this.photoModel.attributes),this.enableForm())}.bind(this))}}),IS.Views.MinimizedUploader=Backbone.View.extend({tagName:"section",id:"minimized-uploader",events:{"click .close-me":"close",mousedown:"assignMouseMove",mouseup:"removeMouseMove",mouseleave:"removeMouseMove"},initialize:function(){this.$template=IS.helpers.loadTemplate("minimized_uploader"),IS.vent.on("uploader:progress",this.updateView,this)},render:function(){this.$el.html(IS.helpers.renderTemplate(this.$template,this.model.attributes));var a=store.get(IS.CONS.STORAGE.MIN_UPLOADER);return a&&this.$el.css({top:a.y,left:a.x}),this.setupElements(),this},setupElements:function(){this.$h3=this.$("h3"),this.$count=this.$(".count"),this.$progress=this.$("figure span")},show:function(){this.$el.addClass("visible")},updateView:function(a){this.$count.html(a.count+" of "+a.total),this.$progress.css("width",a.progress+"%"),100==a.progress?this.$h3.html("DONE"):this.$h3.html("UPLOADING IMAGES...")},assignMouseMove:function(a){var b={x:a.pageX,y:a.pageY},c=this.$el.offset();this.$el.on("mousemove",function(a){this.$el.css({top:c.top+(a.pageY-b.y),left:c.left+(a.pageX-b.x)})}.bind(this))},removeMouseMove:function(){this.$el.off("mousemove"),store.enabled&&store.set(IS.CONS.STORAGE.MIN_UPLOADER,{x:this.$el.offset().left,y:this.$el.offset().top})},close:function(a){a.stopPropagation(),this.trigger("closed")},destroy:function(){IS.vent.off("uploader:progress",this.updateView,this),Backbone.View.prototype.destroy.call(this)}}),IS.Views.Mixins.Auth={errorMessages:{emptyEmail:"Please enter your email.",emptyUsername:"Please enter your username.",emptyPassword:"Please enter your password.",emptyPasswordConfirm:"Please confirm your password.",emptyBoth:"Please enter your username and password.",invalidEmail:"Please enter a valid email address.",passwordMismatch:"Your passwords do not match.",passwordLength:"Your password must be at least 6 characters long.",usernameLength:"Your username must be at least 4 characters long.",emailNonexistant:"That email doesn't exist in our records. Try again?",usernameExists:"That username already exists.",emailExists:"That email already exists. Please choose a different one.",badAuth:"Can't log you in. Is everything correct?",apiFailure:"We're experiencing issues. Please try back later.",invalidLoginOrPassword:"Invalid login or password specified.",accountDoesNotExist:"This account does not exist",usernameSpaces:"Your username must not contain spaces.",invalidUsername:"Please enter a valid username.",inactiveAccount:'Please activate your account with the email we sent you. <a href="/resend_activation?u=%s">Resend email</a>.'},transitionToNextStep:function(){return 1!=this.currentStep?!1:(this.showBackground(2),this.$firstStep.fadeOut(200,function(){this.$secondStep.fadeIn(400)}.bind(this)),this.currentStep=2,!0)},showError:function(a,b,c){void 0==b&&(b=!0);var d=this.errorMessages[a].replace("%s",c);this.$error.find(".message").html(d).end().show(),b&&this.$error.addClass("animated fadeInUp")},hideError:function(){this.$error.hide()},showBackground:function(a){var b,c;if(1==a)b="bg1",c="first";else if(2==a)b="bg2",c="second";else{if(3!=a)throw"Missing num param";b="bg3",c="third"}IS.CONS.MOBILE_DEVICE&&(b+="_small",c+="-small");var d=$("body"),e="/v2_images/auth/"+b+".jpg";IS.helpers.preloadImages([e],function(){d.removeClass("first first-small second second-small third third-small").addClass(c)})}},IS.Views.Mixins.Dropdown={setupElements:function(){this.$selectedLabel=this.$(".selected-label")},clicked:function(a){var b=$(a.target);if(!b.hasClass("prevent-click")){if(this.$el.toggleClass("active"),this.getValue()){var c=this.getValue();this.hideSelection&&(this.$(".item").show(),this.$('.item[data-value="'+c+'"]').hide()),this.$(".item.last").removeClass("last"),this.$(".item").filter(":visible").last().addClass("last")}this.trigger("clicked")}},itemClicked:function(a){var b=$(a.currentTarget),c=b.data("value"),d=b.html();return b.hasClass("disabled")?void IS.helpers.showFeaturesOverlay():void(b.hasClass("prevent-click")||(this.$selectedLabel.removeClass("initial").data("value",c).html(b.text()),b.data("class")&&this.$selectedLabel.addClass(b.data("class")),this.trigger("change",{value:c,name:d})))},getValue:function(){return this.$selectedLabel.data("value")},setValue:function(a,b,c){return this.$selectedLabel.data("value",b).html(a),c&&this.$selectedLabel.addClass(c),this},reset:function(a){this.$selectedLabel.data("value","").html(a)},isOpen:function(){return this.$el.hasClass("active")},close:function(){this.$el.removeClass("active")}},IS.Views.Mixins.Feed={insertNewPhotos:function(a){a=a||{};var b=this.collection.newest(),c=[];_.each(b,function(a){var b=new IS.Views.FeedPhoto({model:a});this.photoViews.push(b),c.push(b.render().el)}.bind(this)),this.$images.append(c),a.initial&&!this.collection.length&&this.showNoResults()},setupElements:function(){return this.$images=this.$("section.images"),this.$noResults=this.$("section.no-results"),this},setupInfiniteScroll:function(){IS.helpers.infiniteScroll({callback:function(){this.collection.hasNextPage()&&this.collection.nextPage()}.bind(this)})},showNoResults:function(){this.noResultsView&&this.noResultsView.show()},hideNoResults:function(){this.noResultsView&&this.noResultsView.hide()}},IS.Views.Mixins.Grid={lazyCache:[],scrollCallback:null,setupLaceGrid:function(a){if(this.$selector=a.selector,a=_.extend({bootstrapped:!0,centered:!0,lazyLoaded:!1,sizesEnabled:!1,windowPadding:function(){return 0==this.windowPadding?50:this.windowPadding}.bind(this)(),minCols:3,$centerRefDiv:$(".app-layout-content > .content")},a),a.sizesEnabled){var b=store.get(IS.CONS.STORAGE.GRID_STYLE);b&&b==IS.Views.GridPhoto.STYLE.MINI?b==IS.Views.GridPhoto.STYLE.MINI&&(a.colWidth=IS.Views.GridPhoto.DIMENSIONS.MINI.WIDTH,a.colPadding=IS.Views.GridPhoto.DIMENSIONS.MINI.PADDING,a.additionalColClass="mini"):(a.colWidth=IS.Views.GridPhoto.DIMENSIONS.WIDTH,a.colPadding=IS.Views.GridPhoto.DIMENSIONS.PADDING)}else a.colWidth=IS.Views.GridAlbum.DIMENSIONS.WIDTH,a.colPadding=IS.Views.GridAlbum.DIMENSIONS.PADDING,a.additionaColClass=null;return _.defer(function(){this.$el.removeClass("faded").lace(a),a.lazyLoaded&&(this.lazyCache=this.$(a.selector),this.checkPhotosVisibility()),_.delay(function(){$(window).trigger("resize")},300),_.delay(function(){a.lazyLoaded||this.$(a.selector).addClass("loaded")}.bind(this),150),IS.vent.trigger("app_layout:content:loaded")}.bind(this)),this},assignBackgroundClasses:function(){_.each(this.lazyCache,function(a,b){return a.className&&a.className.match(/g\d{1}/gi)?!0:void(a.className+=" g"+(b%4+1))})},setupElements:function(){return this.$loading=$(".grid-loading"),this.$gridNoResults=$(".grid-no-results"),this.$window=$(window),this},setupInfiniteScroll:function(){return this.collection.length<this.collection.count?this.showEndOfLoading():(this.scrollCallback=IS.helpers.infiniteScroll({$target:this.$el.parent().parent(),$reference:this.$el,callback:function(){this.collection.isFetching||this.collection.nextPage()}.bind(this)}),_.delay(function(){this.$el.height()<=$(window).height()&&_.delay(function(){this.collection.nextPage()}.bind(this),1e3)}.bind(this),150)),this},removeInfiniteScroll:function(){IS.helpers.removeInfiniteScroll({$target:this.$el.parent().parent(),callback:this.scrollCallback})},attachPhotoViews:function(a){var b=this;return a=_.extend({profileMode:!1,albumModel:null,removeOnMove:!1,removeOnBecomingPublic:!1,enableLightbox:!1,disableLightboxNav:!0},a),this.$(".grid-photo").each(function(){var c=$(this),d=new IS.Views.GridPhoto({model:b.collection.get(c.data("id")),albumModel:a.albumModel,el:c,profileMode:a.profileMode,removeOnMove:a.removeOnMove,removeOnBecomingPublic:a.removeOnBecomingPublic,disableLike:a.disableLike||!1,enableLightbox:a.enableLightbox,disableLightboxNav:a.disableLightboxNav,eventPage:a.eventPage});d.convertToRetina(),b.photoViews.push(d)}),this},attachAlbumViews:function(a){var b=this;return a=_.extend({profileMode:!1},a),this.$(".grid-album").each(function(){var c=$(this),d=new IS.Views.GridAlbum({model:b.collection.get(c.data("id")),el:c,profileMode:a.profileMode});d.convertToRetina(),d.setupHeroCrop(),b.albumViews.push(d)}),this},insertNewPhotos:function(a){a=a||{},a.areMorePages||this.removeInfiniteScroll();var b=this.collection.newest(),c=[];_.each(b,function(b){var d=new IS.Views.GridPhoto({model:b,profileMode:this.profileMode,albumModel:this.albumModel,style:this.gridStyleEnabled&&store.get(IS.CONS.STORAGE.GRID_STYLE),enableLightbox:this.enableLightbox,disableLightboxNav:this.disableLightboxNav,eventPage:a.eventPage});this.photoViews.push(d);var e=d.render().el;this.lazyCache.push(e),c.push(e)}.bind(this)),this.$el.lace("append",$(c)),_.defer(function(){this._destroyed||(a.areMorePages?this.hideLoading():this.collection.totalCount<=0?(this.hideLoading(),this.profileMode&&this.showEndOfLoading("NO IMAGES.")):this.collection.hasNextPage()?this.hideLoading():this.showEndOfLoading("ALL IMAGES LOADED."),IS.vent.trigger("app_layout:content:loaded"),this.checkPhotosVisibility())}.bind(this))},insertNewAlbums:function(a){a=a||{};var b=this.collection.newest(),c=[],d=!1;this.headerModel&&this.headerModel.get("profile_user")&&(d=this.headerModel.get("profile_user").is_followed),_.each(b,function(a){var b=new IS.Views.GridAlbum({model:a,profileMode:this.profileMode,profileModeIsFollowed:d});c.push(b.render().el),this.albumViews.push(b)}.bind(this));var e=$(c);this.$el.lace("append",e),_.delay(function(){this._destroyed||(a.areMorePages?this.hideLoading():(this.removeInfiniteScroll(),this.collection.totalCount<=0?(this.hideLoading(),this.profileMode&&this.showEndOfLoading("NO ALBUMS.")):this.showEndOfLoading("ALL ALBUMS LOADED.")),e.addClass("loaded"),IS.vent.trigger("app_layout:content:loaded"))}.bind(this),500)},resize:function(a){this.$el.parent().css("width",a.width)},contentLoaded:function(a){a=_.extend({preloadNextPage:!0,disableNoResults:!1},a),this.collection.totalCount>0?a.preloadNextPage&&_.delay(function(){this.collection.nextPage()}.bind(this),500):(IS.vent.trigger("grid_items:edit_widget:disable"),this.profileMode?this.collection.length||(this.collection instanceof IS.Collections.ProfileAlbums?this.showProfileNoResults({type:"ALBUMS"}):this.collection instanceof IS.Collections.ProfileLiked?this.showProfileNoResults({type:"LIKED"}):this.collection instanceof IS.Collections.ProfileImages&&this.showProfileNoResults({type:"IMAGES"})):_.delay(function(){a.disableNoResults||this.showUserNoResults(),this.collection.length||IS.vent.trigger("app_layout:content:loaded")}.bind(this),250))},reset:function(){IS.vent.trigger("app_layout:content:unbind:scroll"),Backbone.history.loadUrl()},uploaderClosed:function(a){a.count>0&&this.reset()},gridItemsRerender:function(a){if(a.updates&&this.collection.length){var b=this.collection.models,c=_.pluck(b,"id");IS.vent.trigger("grid_item:rerender",{ids:c,updates:a.updates})}},showLoading:function(a){a=_.extend({msg:"LOADING MORE..."},a),this.$loading.html(a.msg),this.$loading.show(),this.$loading.addClass("active")},hideLoading:function(){this.$loading.removeClass("active"),_.delay(function(){this.$loading.hide()}.bind(this),100)},showEndOfLoading:function(a){this.$loading.show().html(a).addClass("active")},showUserNoResults:function(){this.$gridNoResults.html(IS.Templates.Desktop.grid.noResultsBg).addClass("active"),this.$gridNoResults.find("a.button").on("click",function(){IS.vent.trigger("header_main:open_uploader")})},showUserNoFollowingResults:function(){this.$gridNoResults.html(IS.Templates.Desktop.grid.noFollowingResultsBg).addClass("active"),this.$gridNoResults.find("a.button").on("click",function(){Backbone.history.navigate("/featured",!0)})},checkPhotosVisibility:function(){if(this.lazyCache.length){var a=[];_.each(this.lazyCache,function(b){var c=$(b),d=this.$window.height(),e=.5*d;if(c.offset().top<d+this.$window.scrollTop()+e){var f=c.find("img.hero");f.attr("src",f.data("src"))}else a.push(b)}.bind(this)),this.lazyCache=a}},shiftSelectAllForCurrentPage:function(){_.each(this.collection.models,function(a){IS.vent.trigger("grid_items:add_selected_photo",{model:a})}.bind(this)),IS.vent.trigger("grid_item:edit_mode:enable")},shitDeselectAllForCurrentPage:function(){_.each(this.collection.models,function(a){IS.vent.trigger("grid_items:remove_selected_photo",{model:a})}.bind(this)),IS.vent.trigger("grid_item:edit_mode:reset")}},IS.Views.Mixins.GridItem={setupSharedElements:function(){this.$bottomMenuIcon=this.$("footer .right .icon-menu"),this.$bottomMenu=this.$("footer .right nav.menu-dark"),this.$bottomMenuAlbums=this.$("footer .right nav.menu-dark-sub.albums"),this.$bottomMenuAlbumsLoading=this.$bottomMenuAlbums.find(".loading"),this.$bottomMenuAlbumsNoResults=this.$bottomMenuAlbums.find(".no-results"),this.$bottomMenuShare=this.$("footer .right nav.menu-dark-sub.share"),this.$bottomMenuPrivacy=this.$("footer .right ul.bottom li.private"),this.$window=$("window")},toggleBottomMenu:function(){var a=this;IS.vent.trigger("grid_item:bottom_menu:clicked",{$el:this.$el?this.$el:null}),this.$bottomMenu&&this.$bottomMenu.length&&this.$bottomMenuIcon&&this.$bottomMenuIcon.length&&(this.$bottomMenuIcon.offset().top<350?this.$bottomMenu.addClass("inverted"):this.$bottomMenu.removeClass("inverted"),this.$bottomMenuIcon.hasClass("active")?(this.$bottomMenuIcon.removeClass("active"),this.$bottomMenu.removeClass("fadeInDown").addClass("fadeOutUp"),setTimeout(function(){a.$bottomMenu.hide()},150)):(this.$bottomMenuIcon.addClass("active"),this.$bottomMenu.removeClass("fadeOutUp").show().addClass("fadeInDown")),this.hideOpenSubmenus(),this.removeActiveMenu())},hideBottomMenu:function(a){a.$el!=this.$el&&this.$bottomMenuIcon.hasClass("active")&&(IS.et.pe("Grid Item","Hide","Bottom Menu"),this.toggleBottomMenu(),IS.vent.trigger("app_layout:content:enable_scroll"))},bottomMenuClicked:function(a){a.stopPropagation()},bottomMenuIconClicked:function(a){a.stopPropagation(),IS.et.pe("Grid Item","Click","Bottom Menu Icon"),this.toggleBottomMenu()},toggleBottomAlbumSubmenu:function(a){var b=this.$bottomMenuAlbums.hasClass("fadeInDown");if(this.$bottomMenuIcon.offset().top<350?this.$bottomMenuAlbums.addClass("inverted"):this.$bottomMenuAlbums.removeClass("inverted"),a&&(this.removeActiveMenu(),this.hideOpenSubmenus(),b||$(a.currentTarget).toggleClass("active")),b)this.$bottomMenuAlbums.removeClass("fadeInDown").addClass("fadeOutUp"),setTimeout(function(){this.$bottomMenuAlbums.hide()}.bind(this),150);else{IS.et.pe("Grid Photo","Click","Add To Album");var c=this.$bottomMenuAlbums.find("ul .albums"),d=new IS.Collections.MyAlbums(null,{image_limit:0,limit:50});d.on("fetch:success",function(a){1!=a.page||d.length?(this.$bottomMenuAlbumsLoading.hide(),this.$bottomMenuAlbums.find("ul").show(),_.each(d.newest(),function(a){var b=$("<li>"+a.friendlyTitle({len:16})+"</li>");b.attr({"data-id":a.id,"data-title":a.friendlyTitle({shorten:!1}),"data-public":a.get("public")}),c.append(b)})):(this.$bottomMenuAlbumsLoading.hide(),this.$bottomMenuAlbumsNoResults.show())}.bind(this)),c.find("li").length&&(c.empty(),this.$bottomMenuAlbums.find("ul").hide(),this.$bottomMenuAlbumsLoading.show()),this.$bottomMenuAlbumsNoResults.is(":visible")||d.fetch(),
IS.helpers.infiniteScroll({$target:this.$bottomMenuAlbums,$reference:this.$bottomMenuAlbums,threshold:200,callback:function(){d.isFetching||d.nextPage()}}),this.$bottomMenuAlbums.removeClass("fadeOutUp").show().addClass("fadeInDown")}},toggleBottomShareSubmenu:function(a){var b=this.$bottomMenuShare.hasClass("fadeInDown");this.$bottomMenuIcon.offset().top<350?this.$bottomMenuShare.addClass("inverted"):this.$bottomMenuShare.removeClass("inverted"),a&&(this.removeActiveMenu(),this.hideOpenSubmenus(),b?$(a.currentTarget).removeClass("active"):$(a.currentTarget).addClass("active")),b?(this.$bottomMenuShare.removeClass("fadeInDown").addClass("fadeOutUp"),setTimeout(function(){this.$bottomMenuShare.hide()}.bind(this),150)):(IS.et.pe("Grid Item","Click","Share"),this.$bottomMenuShare.removeClass("fadeOutUp").show().addClass("fadeInDown"))},removeActiveMenu:function(){this.$bottomMenu.find("li.active").removeClass("active")},hideOpenSubmenus:function(){this.$bottomMenuAlbums.hasClass("fadeInDown")&&this.toggleBottomAlbumSubmenu(),this.$bottomMenuShare.hasClass("fadeInDown")&&this.toggleBottomShareSubmenu()},highlightLink:function(a){var b=$(a.currentTarget);b.hasClass("disabled")||(IS.et.pe(b.data("category"),"Click",b.data("label")+" Textfield"),b.focus().select())},updatePrivacy:function(){this.toggleBottomMenu(),IS.et.pe("Grid "+(this.model instanceof IS.Models.Photo?"Photo":"Album"),"Click","Make "+(this.model.get("public")?"Private":"Public")),this.model instanceof IS.Models.Photo&&!this.model.get("public")&&this.model.get("album").id.length&&!this.model.get("album")["public"]?IS.helpers.confirmAction({message:"Do you want to make it public?",sub_message:"This image is in a private album, it will be moved out of the album if you make it public.",confirm_text:"make public"}).done(function(){this.handlePrivacyUpdate(this.removeOnBecomingPublic)}.bind(this)):this.handlePrivacyUpdate(!1)},handlePrivacyUpdate:function(a){var b,c=this.model instanceof IS.Models.Photo?"photo":"album";this.model.save({"public":!this.model.get("public")},{silent:!0,success:function(d){IS.cm.invalidateByCacheKey("my_images"),a&&d.get("public")?IS.vent.trigger("grid_items:reset"):(this.model.has("images")&&this.model.set("images",this.model.previousAttributes().images,{silent:!0}),IS.vent.trigger("app_layout:navbar:update_album_link_privacy",{album:this.model}),this.render(),d instanceof IS.Models.Photo&&this.renderHero()),b=d.get("public")?"Successfully made "+c+" public.":"Successfully made "+c+" private.",IS.helpers.displayUserMessage(b,200),d instanceof IS.Models.Album&&IS.vent.trigger("grid_items:grid_album:change:privacy",{value:d.get("public")})}.bind(this),error:function(){IS.helpers.displayUserError("Unable to update "+c+" privacy."),IS.logger.error("[GridItem] Unable to update "+c+" privacy",this.model.attributes)}.bind(this)})},convertToRetina:function(){IS.helpers.isRetinaDevice()&&this.render()},inputDisabled:function(){IS.helpers.showFeaturesOverlay()}},IS.Views.Mixins.GridMobile={setupLaceGrid:function(a){a=_.extend({bootstrapped:!0,centered:!0,minCols:2,windowPadding:25},a),this.$grid.lace(a)},insertNewAlbums:function(a){a=a||{};var b=this.collection.newest(),c=[];_.each(b,function(a){var b=new IS.Views.GridAlbumMobile({model:a,style:function(){return"phone"==this.screenType?IS.Views.GridAlbumMobile.STYLE.PHONE:"tablet"==this.screenType?IS.Views.GridAlbumMobile.STYLE.TABLET:void 0}.bind(this)()});this.albumViews.push(b),c.push(b.render().el)}.bind(this)),this.$grid.lace("append",$(c)),a.initial&&!this.collection.length&&this.showNoResults()},insertNewPhotos:function(a){a=a||{};var b=this.collection.newest(),c=[];_.each(b,function(a){var b=new IS.Views.GridPhotoMobile({model:a,style:function(){return"phone"==this.screenType?IS.Views.GridPhotoMobile.STYLE.PHONE:"tablet"==this.screenType?IS.Views.GridPhotoMobile.STYLE.TABLET:void 0}.bind(this)()});this.photoViews.push(b),c.push(b.render().el)}.bind(this)),this.$grid.lace("append",$(c)),a.initial&&!this.collection.length&&this.showNoResults()},setupElements:function(){return this.$grid=this.$("> section.grid"),this},setupInfiniteScroll:function(){IS.helpers.infiniteScroll({callback:function(){this.collection.hasNextPage()&&this.collection.nextPage()}.bind(this)})},showNoResults:function(){this.noResultsView&&this.noResultsView.show()}},IS.Views.Mixins.Header={resizeToGrid:function(a){if(a=a||{},a.sizesEnabled=a.sizesEnabled,!a.width)return IS.logger.error("Missing width",a);if(!a.$el.length)return IS.logger.error("Missing $el",a);var b,c=a.windowPadding||50;if(a.sizesEnabled){var d=store.get(IS.CONS.STORAGE.GRID_STYLE);d&&d==IS.Views.GridPhoto.STYLE.MINI?d==IS.Views.GridPhoto.STYLE.MINI&&(b=IS.Views.GridPhoto.DIMENSIONS.MINI.WIDTH+IS.Views.GridPhoto.DIMENSIONS.MINI.PADDING):b=IS.Views.GridPhoto.DIMENSIONS.WIDTH+IS.Views.GridPhoto.DIMENSIONS.PADDING}else b=IS.Views.GridPhoto.DIMENSIONS.WIDTH+IS.Views.GridPhoto.DIMENSIONS.PADDING;var e=Math.floor((a.width-c)/b);3>e&&(e=3);var f=e*b-IS.Views.GridPhoto.DIMENSIONS.PADDING;return a.max&&f>a.max&&(f=a.max),a.$el.css("width",f),f}},IS.Views.Mixins.Messages={avatarUploadFailed:"Could not upload your avatar at this time, try again later",settingsSaveSuccessful:"Your changes have been saved",settingsSaveFailed:"Could not save your changes, try again later",missingCommentText:"You must enter some text",unavailablePhoto:"This photo is currently unavailable",deletedPhoto:"This photo has been deleted",defaultPhotoShareMessage:"Check out this photo",defaultAlbumShareMessage:"Check out this album",processFailed:"Could not process your request, try again later",usernameHasSpace:"Your username must not contain spaces",invalidAddress:"You must enter a valid address",invalidPhoneNumber:"You must enter a valid phone number",invalidCCInfo:"You must enter a valid credit card number and an expiration date",invalidExpMonth:"You must enter a valid expiration month. Example: 03 or 11",invalidExpYear:"You must enter a valid expiration year. Example: 2016",invalidName:"You must enter a first and last name",failedCardUpdate:"We couldn't update your payment method, please try again",successCardUpdate:"Your payment method has been updated",failedCardProcess:"We couldn't process your payment, please check all fields and try again",successCardProcess:"You are all set! Your card has been successfully charged",successCancellation:"Your subscription has been successfully canceled",uploaderFileTooBig:"One or more files exceed 25MB file size limit",uploaderFailed:"One or more files failed to upload, try again later",uploaderUnsupportedFile:"Supported file types are jpg, png, gif, bmp, and tiff",uploadCanceled:"Canceled uploads",hasPaidSubscription:"You are already subscribed to a paid membership",uploadTrialExpired:'You no longer have a free trial. <a href="/upgrade" data-bypass="true">Upgrade</a> now!',trialExpired:"Don't worry. Upgrade now and<br/>you can start uploading",trialExpiredSub:"Your already uploaded photos will stay safely on the site{{extra}}.<br/>You can still login, browse, share &amp; even get links. However, in order to upload you must have a premium account.",acctBanned:"Don't worry. Upgrade now <br/>and regain your access",acctBannedSub:"Your account has been suspended. You must have a premium account to access your photos, upload, share and get links.",cancelSubscriptionFirst:"You must cancel your subscription before you can delete your account",accountDeleted:"Your account was successfully deleted. You are being logged out",accountDeletionFailed:'Could not delete your account at this time. Please <a href="/contact" data-bypass="true">contact us</a> for assistance',uPopup:"Your free trial ends in {{count}} {{noun}}.",uPopupSub:"After your trial ends you can still login, browse, share and get links but you won't be able to upload unless you upgrade.",uPopupSubOld:"Upgrade now to save <strong>30%</strong> and have access to all features with no interruption.",selectImages:"You must select one or more images to be moved to this album."},IS.Views.Mixins.Share={shareAlbum:function(a){var b=$(a.currentTarget);IS.et.pe(b.data("category"),"Click",IS.helpers.capitalizeFirstLetter(b.data("channel"))),this.post({url:"https:"+IS.CONS.SITE_URL+this.model.detailURL(),channel:$(a.currentTarget).data("channel"),title:this.model.get("title")||IS.Views.Mixins.Messages.defaultAlbumShareMessage})},sharePhoto:function(a){var b=$(a.currentTarget);IS.et.pe(b.data("category"),"Click",IS.helpers.capitalizeFirstLetter(b.data("channel"))),this.post({url:"https:"+IS.CONS.SITE_URL+IS.Models.Photo.landingURL(this.model.get("id")),channel:$(a.currentTarget).data("channel"),title:this.model.get("title")||IS.Views.Mixins.Messages.defaultPhotoShareMessage,image:IS.inlineTemplates.direct(_.extend({},{width:800,height:600},this.model.attributes))})},post:function(a){IS.logger.log("Share args: ",a);var b=screen.height/2-this.POPUP_HEIGHT/2,c=screen.width/2-this.POPUP_WIDTH/2,d=this.BASE_URL+"/"+a.channel+"?publisherKey="+this.PUBLISHER_KEY+"&url="+encodeURIComponent(a.url)+"&title="+encodeURIComponent(a.title)+"&track=false";"twitter"==a.channel?d+="&via="+IS.CONS.TWITTER_HANDLE:"pinterest"==a.channel&&(d+="&image="+encodeURIComponent(a.image)),window.open(d,a.channel,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+this.POPUP_WIDTH+", height="+this.POPUP_HEIGHT+", top="+b+", left="+c)},BASE_URL:"http://po.st/v1/share",PUBLISHER_KEY:"yFrog",POPUP_WIDTH:850,POPUP_HEIGHT:700},IS.Views.Mixins.ShareHomebrew={albumTitle:"Check out this album on ImageShack",popupOptions:"height=800,width=600",generateEmailMailtoForAlbum:function(a){var b="Check out the album ";return b+=a.get("title")+" by ",b+=a.get("owner").username,b+="%0D%0A"+a.detailURLWithDomain(),b+="%0D%0A%0D%0A-%0D%0A",b+="ImageShack - Best place for all of your image hosting and image sharing needs","mailto:?subject="+this.albumTitle+"&body="+b},shareAlbumToTwitter:function(a){window.open("https://twitter.com/intent/tweet?text="+this.albumTitle+"&url="+a.detailURLWithDomain(),"Share to Twitter",this.popupOptions)},shareAlbumToFacebook:function(a){FB.ui({method:"share",href:a.detailURLWithDomain()})}},IS.Views.Mixins.UserProfile={showProfileNoResults:function(a){if(_.has(a,"type")){var b,c='Interested in browsing some other profiles? Check out our <a href="/featured">featured photographers</a>.';switch(a.type){case"IMAGES":b="THIS PERSON HAS NO IMAGES.";break;case"ALBUMS":b="THIS PERSON HAS NO ALBUMS.";break;case"FOLLOWERS":b="THIS PERSON HAS NO FOLLOWERS.";break;case"FOLLOWING":b="THIS PERSON ISN'T FOLLOWING ANYONE.";break;case"LIKED":b="THIS PERSON HAS NO LIKED IMAGES."}var d=new IS.Collections.Discover(null,{skip_parse:!0});d.once("sync",function(a){var b=a.shuffle()[0],c=new IS.Views.TimelineWidget({username:b.get("username"),category:"Featured"});this.$gridNoResults.find(".widget").html(c.render().el)}.bind(this));var e=Mustache.render(IS.inlineTemplates.user_profile_no_results,{headerTxt:b,subTxt:c});this.$gridNoResults.html(e).addClass("active"),d.fetch()}}},IS.Views.MobileLayout=Backbone.View.extend({tagName:"section",className:"mobile-layout",el:".mobile-layout",messageView:null,overlayView:null,initialize:function(a){a=a||{},this.$content=this.$("> section.content"),this.$window=$(window),FastClick.attach(document.body),NProgress.configure({showSpinner:!1,minimum:.22,type:"mobile"}),this.$window.on("resize",_.debounce(function(){this.windowResize()}.bind(this),50)),IS.vent.on({"mobile_layout:show_add_album_overlay":this.showAddAlbumOverlay,"mobile_layout:show_edit_album_overlay":this.showEditAlbumOverlay,"mobile_layout:show_album_pass_overlay":this.showAlbumPassOverlay,"mobile_layout:hide_overlay":this.hideOverlay,"mobile_layout:show_error":this.showError,"mobile_layout:show_success":this.showSuccess},this)},insertContent:function(a){return this.$content.append(a),this},insertContentInto:function(a){a=a||{},_.defaults(a,{selector:null,html:null});var b=$(a.selector);return b.length?(b.append(a.html),this):this},prependContent:function(a){return this.$content.prepend(a),this},emptyContent:function(){return this.$content.empty(),this},loaderStart:function(){return NProgress.start(),this},loaderFinish:function(){return NProgress.done(),this},windowResize:function(){IS.vent.trigger("mobile_layout:content:size:change",{width:this.$window.width(),height:this.$window.height()})},showError:function(a){this.messageView&&this.messageView.destroy(),_.extend(a,{type:"error"}),this.messageView=new IS.Views.MobileLayoutMessage(a),$("body").append(this.messageView.render().el),this.messageView.show()},showSuccess:function(a){this.messageView&&this.messageView.destroy(),_.extend(a,{type:"success "}),this.messageView=new IS.Views.MobileLayoutMessage(a),$("body").append(this.messageView.render().el),this.messageView.show()},showOverlay:function(a){this.overlayView=new IS.Views.MobileLayoutOverlay(a),$("body").append(this.overlayView.render().el),this.overlayView.show()},hideOverlay:function(){this.overlayView&&this.overlayView.close()},showAddAlbumOverlay:function(){this.showOverlay({content:new IS.Views.MobileLayoutOverlayAddAlbum})},showEditAlbumOverlay:function(a){a.model&&this.showOverlay({content:new IS.Views.MobileLayoutOverlayEditAlbum({model:a.model})})},showAlbumPassOverlay:function(a){this.showOverlay({hideCloseBtn:!0,content:new IS.Views.MobileLayoutOverlayAlbumPass({model:a.model})})}}),IS.Views.MobileLayoutMessage=Backbone.View.extend({tagName:"section",className:"mobile-layout-message",message:null,type:null,hideDelay:3500,initialize:function(a){a=a||{},this.template=IS.Templates.Mobile.message,this.message=a.message,this.type=a.type},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{message:this.message})),"error"==this.type?(this.$el.addClass("error"),this.$el.removeClass("success")):(this.$el.addClass("success"),this.$el.removeClass("error")),this},show:function(){this.$el.show(),_.delay(function(){this.hide()}.bind(this),this.hideDelay)},hide:function(){this.$el.hide()}}),IS.Views.MobileLayoutOverlay=Backbone.View.extend({tagName:"section",className:"mobile-layout-overlay",events:{"click .icon-close":"close"},view:null,content:null,hideCloseBtn:!1,initialize:function(a){a=a||{},this.template=IS.Templates.Mobile.overlay,a.content instanceof Backbone.View?(this.view=a.content,this.content=a.content.render().el):a.content instanceof Function?this.content=a.content():this.content=a.content,this.hideCloseBtn=a.hideCloseBtn,IS.vent.on({"mobile_layout_overlay:close":this.close},this)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{hideCloseBtn:this.hideCloseBtn})),this.setupElements(),this.$content.html(this.content),this.$("input, textarea").placeholder(),this},setupElements:function(){this.$content=this.$("section.content")},show:function(){this.$el.show(),IS.vent.trigger("body:disable_scrolling")},close:function(){this.remove(),IS.vent.trigger("body:enable_scrolling")},destroy:function(){this.view&&this.view.destroy(),IS.vent.trigger("body:enable_scrolling"),Backbone.View.prototype.destroy.call(this)}}),IS.Views.MobileLayoutOverlayAddAlbum=Backbone.View.extend({tagName:"section",className:"mobile-layout-overlay-add-album",events:{"click a.submit":"submit","submit form":"submit","click .selector .option":"privacyOptionClicked","click .ask-password .checkbox":"passCheckboxClicked"},activeRequest:!1,initialize:function(a){a=a||{},this.template=IS.helpers.loadTemplate("mobile_layout_overlay_add_album")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{privateAlbums:!!(IS.currentUser?IS.currentUser.get("privateAlbums"):null)})),this.setupElements(),this},setupElements:function(){this.$title=this.$('input[name="title"]'),this.$description=this.$("textarea"),this.$submitButtom=this.$("a.submit"),this.$askPassword=this.$(".ask-password"),this.$askPasswordPass=this.$(".ask-password .password"),this.$askPasswordInput=this.$('.ask-password input[type="password"]'),this.$askPasswordCheckbox=this.$(".ask-password .checkbox")},submit:function(a){if(a.preventDefault(),this.validate()){var b=null;this.$askPasswordCheckbox.is(":checked")&&(b=this.$askPasswordInput.val());var c=new IS.Models.Album({title:this.$title.val(),description:this.$description.val(),"public":"public"==this.$(".option.active").data("value"),password:b});this.disableForm(),c.save(null,{success:function(a){a.get("id")?(IS.cm.invalidateByCacheKey("my_images"),IS.cm.invalidateByCacheKey("my_albums"),IS.vent.trigger("mobile_layout:hide_overlay"),Backbone.history.navigate(a.detailURL(),!0)):(IS.logger.error("Failed to create mobel album",a.attributes),IS.vent.trigger("mobile_layout:show_error",{message:"Unable to create an album at this time."})),this.enableForm()}.bind(this),error:function(a,b){var c=$.parseJSON(b.responseText);c&&(31==c.error.error_code?(IS.vent.trigger("mobile_layout:show_error",{message:"An album with that name already exists."}),this.$title.focus()):IS.vent.trigger("mobile_layout:show_error",{message:"Unable to create new album. Try again later."})),this.enableForm()}.bind(this)})}},validate:function(){if(this.$askPasswordCheckbox.is(":checked")){var a=this.$askPasswordInput.val();if(a.length<=3)return IS.vent.trigger("mobile_layout:show_error",{message:"Password must be at least 4 characters in length."}),!1}return!0},disableForm:function(){this.$submitButtom.html("CREATING ALBUM...")},enableForm:function(){this.$submitButtom.html("CREATE ALBUM")},privacyOptionClicked:function(a){var b=$(a.currentTarget);this.$(".selector .option").removeClass("active"),b.addClass("active"),"public"==b.data("value")?(this.$askPassword.hide(),this.$askPasswordCheckbox.attr("checked",!1),this.$askPasswordPass.hide()):"private"==b.data("value")&&this.$askPassword.show()},passCheckboxClicked:function(a){var b=$(a.currentTarget);b.is(":checked")?(this.$askPasswordPass.show(),this.$askPasswordInput.focus()):this.$askPasswordPass.hide()}}),IS.Views.MobileLayoutOverlayAlbumPass=Backbone.View.extend({tagName:"section",className:"mobile-layout-overlay-album-pass",events:{"click a.submit":"submit"},activeRequest:!1,initialize:function(a){a=a||{},this.template=IS.helpers.loadTemplate("mobile_layout_overlay_album_pass")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{})),this.setupElements(),this},setupElements:function(){this.$inputPassword=this.$('input[name="password"]'),this.$submitButtom=this.$("a.submit")},submit:function(a){var b=this.$inputPassword.val(),c="Bad password provided.";return b?(this.disableForm(),void this.model.authWithPassword(b,function(a){a.success?(Backbone.history.loadUrl(),IS.vent.trigger("mobile_layout:hide_overlay")):IS.vent.trigger("mobile_layout:show_error",{message:c}),this.enableForm()}.bind(this),function(a){IS.vent.trigger("mobile_layout:show_error",{message:c}),this.enableForm()}.bind(this))):void IS.vent.trigger("mobile_layout:show_error",{message:"You must provide a password."})},disableForm:function(){this.$submitButtom.html("SENDING...")},enableForm:function(){this.$inputPassword.val(""),this.$inputPassword.focus(),this.$submitButtom.html("VIEW ALBUM")}}),IS.Views.MobileLayoutOverlayEditAlbum=Backbone.View.extend({tagName:"section",className:"mobile-layout-overlay-edit-album",events:{"click nav a.share":"shareClicked","click nav a.make-private":"privateClicked","click nav a.make-public":"publicClicked","click nav a.delete":"deleteClicked","click nav a.edit":"editClicked","click nav a.add":"addImagesClicked","change form.fake-upload":"uploadFormChanged","click form.edit-album a.submit":"submitChanges","click section.share a":"shareItemClicked"},initialize:function(a){a=a||{},_.extend(this,IS.Views.Mixins.ShareHomebrew),this.template=IS.helpers.loadTemplate("mobile_layout_overlay_edit_album")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{isPublic:this.model.get("public"),isPrivate:!this.model.get("public"),title:this.model.get("title"),description:this.model.get("description"),albumId:this.model.get("id"),emailMailto:this.generateEmailMailtoForAlbum(this.model),canUpload:!0})),this.setupElements(),this},setupElements:function(){this.$navMain=this.$("nav.main"),this.$editSection=this.$("section.edit"),this.$form=this.$("form.edit-album"),this.$formTitle=this.$form.find('input[name="title"]'),this.$formDescription=this.$form.find('textarea[name="description"]'),this.$formSave=this.$form.find("a.submit"),this.$shareSubMenu=this.$("section.sub.share")},uploadFormChanged:function(a){IS.vent.trigger("mobile_layout_overlay:close"),IS.vent.trigger("mobile_uploader:upload_file",{event:a})},shareClicked:function(){this.$shareSubMenu.toggle()},privateClicked:function(){IS.et.pe("Album Mobile","Click","Make Private");var a="Do you want to make this album private?";confirm(a)&&this.model.save({"public":!1},{slient:!0,success:function(){IS.vent.trigger("mobile_layout:hide_overlay"),IS.cm.invalidateByCacheKey("my_albums"),IS.cm.invalidateByCacheKey("my_images"),Backbone.history.loadUrl(),IS.vent.trigger("mobile_layout:show_success",{message:"Successfully made album private."})},error:function(){IS.vent.trigger("mobile_layout:show_error",{message:"Unable to make album private."})}})},publicClicked:function(){IS.et.pe("Album Mobile","Click","Make Public");var a="Do you want to make this album public?";confirm(a)&&this.model.save({"public":!0},{slient:!0,success:function(){IS.vent.trigger("mobile_layout:hide_overlay"),IS.cm.invalidateByCacheKey("my_albums"),IS.cm.invalidateByCacheKey("my_images"),Backbone.history.loadUrl(),IS.vent.trigger("mobile_layout:show_success",{message:"Successfully made album public."})},error:function(){IS.vent.trigger("mobile_layout:show_error",{message:"Unable to make album public."})}})},deleteClicked:function(){IS.et.pe("Album Mobile","Click","Delete");var a="Are you sure you want to delete this album?";confirm(a)&&this.model.destroy({success:function(){IS.vent.trigger("mobile_layout:hide_overlay"),IS.cm.invalidateByCacheKey("my_albums"),Backbone.history.navigate("/my/albums",!0),IS.vent.trigger("mobile_layout:show_success",{message:"Successfully deleted album."})},error:function(){IS.vent.trigger("mobile_layout:show_error",{message:"Unable to delete this album."})}})},editClicked:function(){IS.et.pe("Album Mobile","Click","Edit Info"),this.$navMain.hide(),this.$editSection.show()},submitChanges:function(a){a.preventDefault(),IS.et.pe("Album Mobile","Click","Submit Edit Info"),this.disableForm(),this.model.save({title:this.$formTitle.val(),description:this.$formDescription.val()},{success:function(a){a.get("id")&&(IS.vent.trigger("mobile_layout:hide_overlay"),IS.cm.invalidateByCacheKey("my_albums"),IS.cm.invalidateByCacheKey("my_images"),Backbone.history.loadUrl(),IS.vent.trigger("mobile_layout:show_success",{message:"Successfully updated album."})),this.enableForm()}.bind(this),error:function(a,b){var c=$.parseJSON(b.responseText);c&&(31==c.error.error_code?IS.vent.trigger("mobile_layout:show_error",{message:"An album with that name already exists."}):IS.vent.trigger("mobile_layout:show_error",{message:"Unable to update album."})),this.enableForm()}.bind(this)})},disableForm:function(){this.$formSave.addClass("disabled").html("SAVING...")},enableForm:function(){this.$formSave.removeClass("disabled").html("SAVE")},shareItemClicked:function(a){var b=$(a.currentTarget);"twitter"==b.data("type")?(IS.et.pe("Album Mobile","Click","Share Twitter"),this.shareAlbumToTwitter(this.model)):"fb"==b.data("type")?(IS.et.pe("Album Mobile","Click","Share Facebook"),this.shareAlbumToFacebook(this.model)):"email"==b.data("type")&&IS.et.pe("Album Mobile","Click","Share Email")},addImagesClicked:function(){IS.et.pe("Album Mobile","Click","Add Images")}}),IS.Views.MyAlbums=Backbone.View.extend({tagName:"div",className:"grid-container",bootstrapped:!1,loading:!1,profileMode:!1,windowPadding:0,albumViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),this.setupElements(),this.collection||(this.bootstrapped=!0,this.collection=new IS.Collections.MyAlbums($.parseJSON(this.options.albums),{totalCount:parseInt(this.options.albumsTotal),limit:20}),this.attachAlbumViews({profileMode:this.profileMode})),this.setupLaceGrid({selector:".grid-album"}),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.insertNewAlbums,this),IS.vent.on({"grid_items:reset":this.reset,"app_layout:content:size:change":this.resize},this),IS.vent.once("app_layout:content:loaded",this.customContentLoaded,this)},render:function(){return this.collection.each(function(a){var b=new IS.Views.GridAlbum({model:a});this.$el.append(b.render().el)}.bind(this)),this},customContentLoaded:function(){this.contentLoaded({preloadNextPage:!1}),IS.vent.trigger("app_layout_pagination:show")},destroy:function(){this.collection.off(),_.each(this.albumViews,function(a){a.destroy()}),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyAlbumsView] View destroyed")}},{TITLE:"Albums",CLASS:"albums"}),IS.Views.MyAlbumsDetail=Backbone.View.extend({tagName:"div",className:"grid-container faded",pageLoaded:!1,profileMode:!1,windowPadding:200,loading:!1,albumModel:null,photoViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),this.setupElements(),this.model||(this.model=new IS.Models.Album($.parseJSON(this.options.currentAlbum))),this.albumModel=this.model,IS.vent.trigger("app_layout:content:bind:scroll"),this.setupLaceGrid({selector:".grid-photo",lazyLoaded:!0,sizesEnabled:!0}),IS.vent.on("app_layout:content:scrolled",this.checkPhotosVisibility,this),IS.currentUser.set("activeAlbum",this.model),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.insertNewPhotos,this),IS.vent.on({"app_layout:content:size:change":this.resize,"grid_items:reset":this.reset,"grid_items:rerender":this.gridItemsRerender,"uploader:closed":this.uploaderClosed,"album:change:empty":this.showNoResults,"grid_items:grid_album:change:privacy":this.updateCollectionPrivacy,"grid_items:shift_select_all_for_current_page":this.shiftSelectAllForCurrentPage,"grid_items:shift_deselect_all_for_current_page":this.shitDeselectAllForCurrentPage},this),IS.vent.once("app_layout:content:loaded",this.customContentLoaded,this),this.collection.length&&IS.vent.trigger("grid_items:edit_widget:show")},render:function(){var a=this;return this.collection.each(function(b){var c=new IS.Views.GridPhoto({model:b,albumModel:a.model,removeOnMove:!0,removeOnBecomingPublic:!0,disableLike:!0,showSelect:!0,style:store.get(IS.CONS.STORAGE.GRID_STYLE),eventPage:"Album Page",enableLightbox:!0,nextPrevAlbum:!0});a.$el.append(c.render().el)}),this},customContentLoaded:function(){this.contentLoaded({preloadNextPage:!1}),IS.vent.trigger("app_layout_pagination:show")},updateCollectionPrivacy:function(a){var b=[];_.each(this.collection.models,function(c){var d=c.get("album");d["public"]=a.value,c.set("public",a.value),c.set("album",d),b.push(c.get("id"))}),IS.vent.trigger("grid_item:rerender",{ids:b})},destroy:function(){_.each(this.photoViews,function(a){a.destroy()}),IS.vent.trigger("grid_items:edit_widget:reset_selected_photos"),IS.vent.trigger("app_layout:content:unbind:scroll"),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyAlbumsDetailView] View destroyed")}},{TITLE:"My Albums",CLASS:"albums"}),IS.Views.MyAlbumsDetailMobile=Backbone.View.extend({className:"feed-container",tagName:"div",events:{"click section.load-more":"loadMore"},photoViews:[],noResultsView:null,hasRendered:!1,albumModel:null,initialize:function(a){a=a||{},_.extend(this,IS.Views.Mixins.Feed),this.collection.on("fetch:success",this.insertNewPhotos,this),this.noResultsView=new IS.Views.FeedNoResults({type:IS.Views.FeedNoResults.TYPES.REGULAR,headerText:"No images in this album yet.",bodyText:null}),this.albumModel=a.albumModel,this.setupInfiniteScroll(),IS.vent.trigger("mobile_uploader:set_current_album",{album:this.albumModel})},render:function(){if(!this.hasRendered){var a=new IS.Views.HeaderAlbumDetailMobile({model:this.albumModel});this.$el.append([a.render().el,IS.Templates.Mobile.sectionImages,this.noResultsView.render().el]),this.setupElements()}return this.insertNewPhotos({initial:!this.hasRendered}),this.hasRendered=!0,this},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),this.noResultsView&&this.noResultsView.destroy(),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyAlbumsDetailMobile] View destroyed")}},{TITLE:"Albums",CLASS:"albums"}),IS.Views.MyAlbumsMobile=Backbone.View.extend({tagName:"div",className:"grid-container-mobile",events:{"click section.load-more":"loadMore"},albumViews:[],hasRendered:!1,noResultsView:null,screenType:null,initialize:function(){_.extend(this,IS.Views.Mixins.GridMobile),this.collection.on("fetch:success",this.insertNewAlbums,this),this.noResultsView=new IS.Views.FeedNoResults({type:IS.Views.FeedNoResults.TYPES.REGULAR,headerText:"You don't have any albums yet.",bodyText:null}),this.screenType=IS.helpers.getScreenType(),this.setupInfiniteScroll()},render:function(){return this.hasRendered||(this.$el.append([IS.Templates.Mobile.sectionGrid,this.noResultsView.render().el]),this.setupElements()),"tablet"==this.screenType?this.setupLaceGrid({selector:".grid-album-mobile",additionalColClass:"album tablet",colWidth:IS.Views.GridAlbumMobile.SIZES.TABLET.WIDTH,colPadding:IS.Views.GridAlbumMobile.SIZES.TABLET.PADDING}):this.setupLaceGrid({selector:".grid-album-mobile",additionalColClass:"album",colWidth:IS.Views.GridAlbumMobile.SIZES.PHONE.WIDTH,colPadding:IS.Views.GridAlbumMobile.SIZES.PHONE.PADDING}),this.insertNewAlbums({initial:!this.hasRendered}),this.hasRendered=!0,this},destroy:function(){this.collection.off(),_.each(this.albumViews,function(a){a.destroy()}),this.noResultsView&&this.noResultsView.destroy(),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyAlbumsMobileView] View destroyed")}},{TITLE:"Albums",CLASS:"albums"}),IS.Views.MyFollowings=Backbone.View.extend({tagName:"div",className:"grid-container faded",pageLoaded:!1,profileMode:!0,windowPadding:0,loading:!1,gridStyleEnabled:!0,photoViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),this.enableLightbox=!0,this.disableLightboxNav=!0,this.eventPage="Following Page",this.setupElements(),IS.vent.trigger("app_layout:content:bind:scroll"),this.setupLaceGrid({selector:".grid-photo",lazyLoaded:!0,sizesEnabled:!0}),this.options.endOffset&&this.setupInfiniteScroll(),IS.vent.on("app_layout:content:scrolled",this.checkPhotosVisibility,this),_.delay(function(){this.checkPhotosVisibility()}.bind(this),150),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.addNewPhotos,this),IS.vent.on({"app_layout:content:size:change":this.resize,"grid_items:reset":this.reset},this)},render:function(){return this.collection.each(function(a){var b=new IS.Views.GridPhoto({model:a,profileMode:this.profileMode,style:store.get(IS.CONS.STORAGE.GRID_STYLE),enableLightbox:this.enableLightbox,disableLightboxNav:this.disableLightboxNav,eventPage:this.eventPage});this.$el.append(b.render().el)}.bind(this)),_.delay(function(){this.checkPhotosVisibility()}.bind(this),150),this},addNewPhotos:function(a){this.insertNewPhotos(_.extend(a,{eventPage:this.eventPage}))},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),IS.vent.trigger("app_layout:content:unbind:scroll"),Backbone.View.prototype.destroy.call(this)}},{TITLE:"My Following",CLASS:"following"}),IS.Views.MyFollowingsMobile=Backbone.View.extend({tagName:"div",events:{"click section.load-more":"loadMore"},photoViews:[],hasRendered:!1,noResultsView:null,feedStyle:null,initialize:function(){this.feedStyle=store.get(IS.CONS.STORAGE.MOBILE_FEED_STYLE),this.feedStyle==IS.CONS.MOBILE_FEED_STYLES.GRID?_.extend(this,IS.Views.Mixins.GridMobile):_.extend(this,IS.Views.Mixins.Feed),
this.collection.on("fetch:success",this.insertNewPhotos,this),this.noResultsView=new IS.Views.FeedNoResults({type:IS.Views.FeedNoResults.TYPES.REGULAR,headerText:"You aren't following anyone yet.",bodyText:null}),this.screenType=IS.helpers.getScreenType(),this.setupInfiniteScroll()},render:function(){return this.hasRendered||(this.feedStyle==IS.CONS.MOBILE_FEED_STYLES.GRID?(this.$el.addClass("grid-container-mobile"),this.$el.append([IS.Templates.Mobile.sectionGrid,this.noResultsView.render().el]),this.setupElements(),"tablet"==this.screenType?this.setupLaceGrid({selector:".grid-photo-mobile",additionalColClass:"photo tablet",colWidth:IS.Views.GridPhotoMobile.SIZES.TABLET.WIDTH,colPadding:IS.Views.GridPhotoMobile.SIZES.TABLET.PADDING}):this.setupLaceGrid({selector:".grid-photo-mobile",additionalColClass:"photo",colWidth:IS.Views.GridPhotoMobile.SIZES.PHONE.WIDTH,colPadding:IS.Views.GridPhotoMobile.SIZES.PHONE.PADDING})):(this.$el.addClass("feed-container"),this.$el.append([IS.Templates.Mobile.sectionImages,this.noResultsView.render().el]),this.setupElements())),this.insertNewPhotos({initial:!this.hasRendered}),this.hasRendered=!0,this},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),this.noResultsView&&this.noResultsView.destroy(),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyFollowingsMobileView] View destroyed")}},{TITLE:"My Following",CLASS:"following"}),IS.Views.MyImages=Backbone.View.extend({tagName:"div",className:"grid-container faded",bootstrapped:!1,loading:!1,pageLoaded:!1,profileMode:!1,windowPadding:200,photoViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),this.setupElements(),IS.vent.trigger("app_layout:content:bind:scroll"),this.setupLaceGrid({selector:".grid-photo",lazyLoaded:!0,sizesEnabled:!0}),IS.vent.on("app_layout:content:scrolled",this.checkPhotosVisibility,this),_.delay(function(){this.checkPhotosVisibility()}.bind(this),150),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.insertNewPhotos,this),IS.vent.on({"app_layout:content:size:change":this.resize,"grid_items:reset":this.reset,"grid_items:shift_select_all_for_current_page":this.shiftSelectAllForCurrentPage,"grid_items:shift_deselect_all_for_current_page":this.shitDeselectAllForCurrentPage,"uploader:closed":this.uploaderClosed},this),IS.vent.once("app_layout:content:loaded",this.customContentLoaded,this),IS.currentUser.get("finishedOnboarding")||(this.onboardingView=new IS.Views.OnBoarding({bootstrapped:this.bootstrapped})),this.collection.length&&IS.vent.trigger("grid_items:edit_widget:show"),IS.helpers.showSurveyBox()},render:function(){return this.collection.each(function(a){var b=new IS.Views.GridPhoto({model:a,disableLike:!0,showSelect:!0,style:store.get(IS.CONS.STORAGE.GRID_STYLE),eventPage:"My Images"});this.photoViews.push(b),this.$el.append(b.render().el)}.bind(this)),_.delay(function(){this.checkPhotosVisibility()}.bind(this),150),this},customContentLoaded:function(){this.contentLoaded({preloadNextPage:!1}),IS.vent.trigger("app_layout_pagination:show")},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),this.onboardingView&&this.onboardingView.destroy(),IS.vent.trigger("grid_items:edit_widget:reset_selected_photos"),IS.vent.trigger("app_layout:content:unbind:scroll"),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyImagesView] View destroyed")}},{TITLE:"All Images",CLASS:"images"}),IS.Views.MyImagesMobile=Backbone.View.extend({tagName:"div",events:{"click section.load-more":"loadMore"},photoViews:[],hasRendered:!1,noResultsView:null,feedStyle:null,initialize:function(a){this.feedStyle=store.get(IS.CONS.STORAGE.MOBILE_FEED_STYLE),this.feedStyle==IS.CONS.MOBILE_FEED_STYLES.GRID?_.extend(this,IS.Views.Mixins.GridMobile):_.extend(this,IS.Views.Mixins.Feed),this.collection.on("fetch:success",this.insertNewPhotos,this),this.noResultsView=new IS.Views.FeedNoResults({type:IS.Views.FeedNoResults.TYPES.MY_IMAGES,headerText:"You don't have any images yet.",bodyText:null}),this.screenType=IS.helpers.getScreenType(),this.setupInfiniteScroll()},render:function(){return this.hasRendered||(this.feedStyle==IS.CONS.MOBILE_FEED_STYLES.GRID?(this.$el.addClass("grid-container-mobile"),this.$el.append([IS.Templates.Mobile.sectionGrid,this.noResultsView.render().el]),this.setupElements(),"tablet"==this.screenType?this.setupLaceGrid({selector:".grid-photo-mobile",additionalColClass:"photo tablet",colWidth:IS.Views.GridPhotoMobile.SIZES.TABLET.WIDTH,colPadding:IS.Views.GridPhotoMobile.SIZES.TABLET.PADDING}):this.setupLaceGrid({selector:".grid-photo-mobile",additionalColClass:"photo",colWidth:IS.Views.GridPhotoMobile.SIZES.PHONE.WIDTH,colPadding:IS.Views.GridPhotoMobile.SIZES.PHONE.PADDING})):(this.$el.addClass("feed-container"),this.$el.append([IS.Templates.Mobile.sectionImages,this.noResultsView.render().el]),this.setupElements())),this.insertNewPhotos({initial:!this.hasRendered}),this.hasRendered=!0,this},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),this.noResultsView&&this.noResultsView.destroy(),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyImagesMobileView] View destroyed")}},{TITLE:"My Images",CLASS:"images"}),IS.Views.MyImagesTimelineNav=Backbone.View.extend({el:".my-images-timeline",events:{"click li.parent":"parentClicked","click li ul.sub li":"childClicked"},initialize:function(){IS.vent.on({"my_images:timeline:show":this.show,"my_images:timeline:hide":this.hide},this)},show:function(){return this.$el.removeClass("hidden"),this},hide:function(){return this.$el.addClass("hidden"),this},removeParentSelected:function(){this.$("li.parent.selected").removeClass("selected").find("ul.sub").removeClass("expanded")},removeChildSelected:function(){this.$("li.parent.selected ul.sub li.selected").removeClass("selected")},parentClicked:function(a){var b=$(a.currentTarget);this.removeParentSelected(),b.addClass("selected");var c=b.find("ul.sub");c.length&&c.addClass("expanded")},childClicked:function(){this.removeChildSelected()}},{WIDTH:0}),IS.Views.MyLiked=Backbone.View.extend({tagName:"div",className:"grid-container faded",pageLoaded:!1,profileMode:!0,windowPadding:0,loading:!1,gridStyleEnabled:!0,photoViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),this.enableLightbox=!0,this.disableLightboxNav=!0,this.eventPage="Liked Page",this.setupElements(),IS.vent.trigger("app_layout:content:bind:scroll"),this.setupLaceGrid({selector:".grid-photo",lazyLoaded:!0,sizesEnabled:!0}),this.options.endOffset&&this.setupInfiniteScroll(),IS.vent.on("app_layout:content:scrolled",this.checkPhotosVisibility,this),_.delay(function(){this.checkPhotosVisibility()}.bind(this),150),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.addNewPhotos,this),IS.vent.on({"app_layout:content:size:change":this.resize,"grid_items:reset":this.reset},this)},render:function(){return this.collection.each(function(a){var b=new IS.Views.GridPhoto({model:a,profileMode:this.profileMode,style:store.get(IS.CONS.STORAGE.GRID_STYLE),enableLightbox:this.enableLightbox,disableLightboxNav:this.disableLightboxNav,eventPage:this.eventPage});this.$el.append(b.render().el)}.bind(this)),_.delay(function(){this.checkPhotosVisibility()}.bind(this),150),this},addNewPhotos:function(a){this.insertNewPhotos(_.extend(a,{eventPage:this.eventPage}))},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),IS.vent.trigger("app_layout:content:unbind:scroll"),Backbone.View.prototype.destroy.call(this)}},{TITLE:"Liked",CLASS:"liked"}),IS.Views.MyLikedMobile=Backbone.View.extend({tagName:"div",events:{"click section.load-more":"loadMore"},photoViews:[],hasRendered:!1,noResultsView:null,feedStyle:null,initialize:function(a){this.feedStyle=store.get(IS.CONS.STORAGE.MOBILE_FEED_STYLE),this.feedStyle==IS.CONS.MOBILE_FEED_STYLES.GRID?_.extend(this,IS.Views.Mixins.GridMobile):_.extend(this,IS.Views.Mixins.Feed),this.collection.on("fetch:success",this.insertNewPhotos,this),this.noResultsView=new IS.Views.FeedNoResults({type:IS.Views.FeedNoResults.TYPES.REGULAR,headerText:"You don't have any liked images yet.",bodyText:null}),this.screenType=IS.helpers.getScreenType(),this.setupInfiniteScroll()},render:function(){return this.hasRendered||(this.feedStyle==IS.CONS.MOBILE_FEED_STYLES.GRID?(this.$el.addClass("grid-container-mobile"),this.$el.append([IS.Templates.Mobile.sectionGrid,this.noResultsView.render().el]),this.setupElements(),"tablet"==this.screenType?this.setupLaceGrid({selector:".grid-photo-mobile",additionalColClass:"photo tablet",colWidth:IS.Views.GridPhotoMobile.SIZES.TABLET.WIDTH,colPadding:IS.Views.GridPhotoMobile.SIZES.TABLET.PADDING}):this.setupLaceGrid({selector:".grid-photo-mobile",additionalColClass:"photo",colWidth:IS.Views.GridPhotoMobile.SIZES.PHONE.WIDTH,colPadding:IS.Views.GridPhotoMobile.SIZES.PHONE.PADDING})):(this.$el.addClass("feed-container"),this.$el.append([IS.Templates.Mobile.sectionImages,this.noResultsView.render().el]),this.setupElements())),this.insertNewPhotos({initial:!this.hasRendered}),this.hasRendered=!0,this},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),this.noResultsView&&this.noResultsView.destroy(),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyLikedMobile] View destroyed")}},{TITLE:"Liked"}),IS.Views.MyPrivateAlbums=Backbone.View.extend({tagName:"div",className:"grid-container",bootstrapped:!1,loading:!1,profileMode:!1,albumViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),this.setupElements(),this.collection||(this.bootstrapped=!0,this.collection=new IS.Collections.MyPrivateAlbums($.parseJSON(this.options.albums),{totalCount:parseInt(this.options.albumsTotal),limit:20}),this.attachAlbumViews({profileMode:this.profileMode}),this.setupIsotopeGrid({className:".grid-album"}),this.setupInfiniteScroll()),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.insertNewAlbums,this),IS.vent.on("app_layout:content:size:change",this.resize,this),IS.vent.once("app_layout:content:loaded",this.contentLoaded,this)},render:function(){var a=this;return this.collection.each(function(b){var c=new IS.Views.GridAlbum({model:b});a.$el.append(c.render().el)}),this},destroy:function(){this.removeInfiniteScroll(),this.collection.off(),_.each(this.albumViews,function(a){a.destroy()}),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyPrivateAlbums] View destroyed")}},{TITLE:"Private Albums",CLASS:"private"}),IS.Views.MyPrivateImages=Backbone.View.extend({tagName:"div",className:"grid-container",bootstrapped:!1,loading:!1,pageLoaded:!1,profileMode:!1,photoViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),this.setupElements(),this.collection||(this.bootstrapped=!0,this.collection=new IS.Collections.MyPrivateImages($.parseJSON(this.options.photos),{totalCount:parseInt(this.options.photosTotal),limit:35}),this.attachPhotoViews({profileMode:this.profileMode}),this.setupIsotopeGrid({className:".grid-photo"}),this.setupInfiniteScroll()),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.insertNewPhotos,this),IS.vent.on({"app_layout:content:size:change":this.resize,"grid_items:reset":this.reset,"uploader:closed":this.uploaderClosed},this),IS.vent.once("app_layout:content:loaded",this.contentLoaded,this)},render:function(){return this.collection.each(function(a){var b=new IS.Views.GridPhoto({model:a});this.$el.append(b.render().el)}.bind(this)),this},destroy:function(){this.removeInfiniteScroll(),this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),IS.vent.trigger("grid_items:edit_widget:reset_selected_photos"),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyPrivateImages] View destroyed")}},{TITLE:"Private Images",CLASS:"private"}),IS.Views.MyTags=Backbone.View.extend({tagName:"div",className:"my-tags",subViews:[],initialize:function(){this.collection||(this.bootstrapped=!0,this.collection=new IS.Collections.UserTags($.parseJSON(this.options.tags),{totalCount:parseInt(this.options.tagsTotal),limit:36})),IS.vent.trigger("app_layout:content:max_width"),IS.vent.on("app_layout:content:size:change",this.resize,this),this.setupElements(),this.bindSubviews()},render:function(){this.$el.append($('<div class="left-col" />'),$('<div class="right-col" />'),$('<div class="clearer" />')),this.setupElements();var a=0;return this.collection.each(function(b){var c=new IS.Views.MyTagsItem({model:b});a%2==0?this.$leftCol.append(c.render().el):this.$rightCol.append(c.render().el),a++}.bind(this)),this},setupElements:function(){this.$leftCol=this.$(".left-col"),this.$rightCol=this.$(".right-col")},show:function(){return _.defer(function(){this.$el.addClass("show")}.bind(this)),this},bindSubviews:function(){var a=this;return this.$(".tag").each(function(){var b=$(this),c=new IS.Views.MyTagsItem({el:b});a.subViews.push(c)}),this},resize:function(a){a=_.extend({$el:this.$el},a),IS.Views.Mixins.Header.resizeToGrid(a)},destroy:function(){_.each(this.subViews,function(a){a&&a.destroy&&a.destroy()}),Backbone.View.prototype.destroy.call(this)}},{CLASS:"tags",TITLE:"My Tags"}),IS.Views.MyTagsDetail=Backbone.View.extend({tagName:"div",className:"grid-container faded",bootstrapped:!1,loading:!1,pageLoaded:!1,profileMode:!1,windowPadding:200,photoViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),this.setupElements(),IS.vent.trigger("app_layout:content:bind:scroll"),this.setupLaceGrid({selector:".grid-photo",lazyLoaded:!0,sizesEnabled:!0}),IS.vent.on("app_layout:content:scrolled",this.checkPhotosVisibility,this),_.delay(function(){this.checkPhotosVisibility()}.bind(this),150),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.insertNewPhotos,this),IS.vent.on({"app_layout:content:size:change":this.resize,"grid_items:reset":this.reset,"uploader:closed":this.uploaderClosed,"grid_items:shift_select_all_for_current_page":this.shiftSelectAllForCurrentPage,"grid_items:shift_deselect_all_for_current_page":this.shitDeselectAllForCurrentPage},this),IS.vent.once("app_layout:content:loaded",this.customContentLoaded,this),this.collection.length&&IS.vent.trigger("grid_items:edit_widget:show")},render:function(){return this.collection.each(function(a){var b=new IS.Views.GridPhoto({model:a,disableLike:!0,showSelect:!0,style:store.get(IS.CONS.STORAGE.GRID_STYLE)});this.$el.append(b.render().el)}.bind(this)),_.delay(function(){this.checkPhotosVisibility()}.bind(this),150),this},customContentLoaded:function(){this.contentLoaded({preloadNextPage:!1}),IS.vent.trigger("app_layout_pagination:show")},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),IS.vent.trigger("grid_items:edit_widget:reset_selected_photos"),IS.vent.trigger("app_layout:content:unbind:scroll"),Backbone.View.prototype.destroy.call(this),IS.logger.log("[MyImagesView] View destroyed")}},{TITLE:"My Tags",CLASS:"tags"}),IS.Views.MyTagsItem=Backbone.View.extend({tagName:"div",className:"tag",events:{"click .thumb":"thumbClicked"},initialize:function(){this.template=IS.helpers.loadTemplate("my_tags_item")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{id:this.model.id,name:this.model.get("name"),count:this.model.get("count"),thumbs:function(){if(this.model.get("images").length){var a="";return _.each(this.model.get("images"),function(b){null!=b&&(a+=Mustache.render(IS.inlineTemplates.my_tags_item_thumb,{server:b.server,filename:b.filename,id:b.id}))}),a}}.bind(this)})),this},thumbClicked:function(a){var b=$(a.currentTarget).children("img");Backbone.history.navigate("/i/"+b.data("id"),!0)}}),IS.Views.OnBoarding=Backbone.View.extend({initialize:function(){this.$body=$("body"),this.currentStep=null,this.model=new Backbone.Model({id:IS.currentUser.get("userId"),onboarding:!1},{url:IS.CONS.API_BASE+IS.CONS.APIS.USER.SETTINGS}),this.$step4Parent=$(".grid-photo:eq(0) > .inner"),this.stepTemplates=[IS.helpers.loadTemplate("onboarding_step_1"),IS.helpers.loadTemplate("onboarding_step_2"),IS.helpers.loadTemplate("onboarding_step_3"),IS.helpers.loadTemplate("onboarding_step_4"),IS.helpers.loadTemplate("onboarding_step_5")],_.delay(function(){this.showStep1()}.bind(this),350),IS.currentUser.set("finishedOnboarding",!0),this.model.set("onboarding",!0).save()},showStep1:function(){this.showStep(0),this.assignNextListener(2)},showStep2:function(){this.showStep(1),this.assignNextListener(3)},showStep3:function(){this.showStep(2),this.assignNextListener(4)},showStep4:function(){return this.$step4Parent.length||(this.$step4Parent=$(".grid-photo:eq(0) > .inner")),this.$step4Parent.length?(this.showStep(3,this.$step4Parent),void this.assignNextListener(5)):void this.showStep5()},showStep5:function(){this.done()},assignNextListener:function(a){this.currentStep.find("a").one("click",function(){this["showStep"+a]()}.bind(this))},showStep:function(a,b){b=b||this.$body,this.currentStep&&!function(a){a.removeClass("loaded"),_.delay(function(){a.remove()},500)}(this.currentStep);var c=IS.helpers.renderTemplate(this.stepTemplates[a],{nextText:function(){return 2==a?$(".grid-photo:eq(0) > .inner").length?"NEXT":"DONE":3==a?"DONE":"NEXT"}.bind(this)});b.append(c),this.currentStep=$(".ob-step"),this.currentStep.length>1&&(this.currentStep=this.currentStep.eq(3==a?0:1)),IS.et.pe("Onboarding","Click","Next "+(a+1)),_.delay(function(){this.currentStep.addClass("loaded")}.bind(this),150)},done:function(){this.remove()},remove:function(){IS.vent.trigger("header_main:show:search"),this.currentStep&&this.currentStep.removeClass("loaded"),_.delay(function(){this.currentStep&&this.currentStep.remove()}.bind(this),350)}}),IS.Views.PhotographerCondensed=Backbone.View.extend({tagName:"article",className:"condensed",initialize:function(){this.$template=IS.helpers.loadTemplate("photographer_condensed")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,{username:this.model.get("username"),firstName:this.model.get("first_name"),lastName:this.model.get("last_name"),publishDate:IS.helpers.getDateString(1e3*Number(this.model.get("pub_date")),!0),dateTime:IS.helpers.getDateTime(1e3*Number(this.model.get("pub_date"))),avatarURL:function(){var a=this.model.get("avatar");return IS.helpers.getImagizerLink({server:a.server,filename:a.filename,width:60,height:60,cropped:!0})}.bind(this)})),this}}),IS.Views.PromoUpgrade=Backbone.View.extend({el:"#promo-upgrade",events:{"click .trigger":"toggleArea","click .types .type":"handlePayment"},initialize:function(){new IS.Views.HeaderMain},toggleArea:function(){this.$(".selection.active").removeClass("active"),this.$(".choices").addClass("active")},handlePayment:function(a){var b=$(a.currentTarget).data("type"),c=IS.subs.PROMO.FIFTY_OFF[b];IS.helpers.showSubForm(c)}}),IS.Views.Search=Backbone.View.extend({tagName:"div",className:"grid-container faded",bootstrapped:!1,loading:!1,pageLoaded:!1,profileMode:!0,windowPadding:0,photoViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),this.setupElements(),this.collection||(this.bootstrapped=!0,this.collection=new IS.Collections.Search($.parseJSON(this.options.photos),{totalCount:parseInt(this.options.photosTotal),limit:IS.CONS.PHOTO_FETCH_COUNT,query:this.options.query}),this.attachPhotoViews({profileMode:this.profileMode})),IS.vent.trigger("app_layout:content:bind:scroll"),this.setupLaceGrid({selector:".grid-photo",lazyLoaded:!0,sizesEnabled:!0}),IS.vent.on("app_layout:content:scrolled",this.checkPhotosVisibility,this),_.delay(function(){this.checkPhotosVisibility()}.bind(this),150),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.insertNewPhotos,this),IS.vent.on({"app_layout:content:size:change":this.resize,"grid_items:reset":this.reset,"uploader:closed":this.uploaderClosed},this),IS.vent.once("app_layout:content:loaded",this.customContentLoaded,this)},render:function(){return this.collection.each(function(a){var b=new IS.Views.GridPhoto({model:a,profileMode:this.profileMode,style:store.get(IS.CONS.STORAGE.GRID_STYLE)});this.$el.append(b.render().el)}.bind(this)),_.delay(function(){this.checkPhotosVisibility()}.bind(this),150),this},customContentLoaded:function(){this.contentLoaded({preloadNextPage:!1,disableNoResults:!0}),this.collection.length||this.showEndOfLoading("NO IMAGES FOUND."),IS.vent.trigger("app_layout_pagination:show")},showProfileNoResults:function(){},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),IS.vent.trigger("grid_items:edit_widget:reset_selected_photos"),IS.vent.trigger("app_layout:content:unbind:scroll"),Backbone.View.prototype.destroy.call(this),IS.logger.log("[SearchView] View destroyed")}}),IS.Views.SettingsMenu=Backbone.View.extend({tagName:"aside",className:"no-user-select menu",events:{"click .tabs a":"clicked","click .delete-account":"confirmDeletion"},initialize:function(){this.template=IS.helpers.loadTemplate("settings_menu"),this.tab=this.options.tab,this.on("update:state",function(a){var b=this.$(".tabs ."+a.view);b.hasClass("active")||b.trigger("click")},this)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{})),this.$(".tabs").addClass(this.tab).find("."+this.tab).addClass("active"),this},clicked:function(a){var b=$(a.currentTarget);b.hasClass("active")||(b.addClass("active").siblings(".active:eq(0)").removeClass("active"),b.parent().removeClass().addClass("tabs "+b.attr("class")))},confirmDeletion:function(){return IS.currentUser.get("isSubRecurring")?void IS.helpers.displayUserError(IS.Views.Mixins.Messages.cancelSubscriptionFirst):void IS.helpers.confirmAction({message:"Are you sure you want to delete your account?",confirm_text:"Delete"}).done(function(){IS.currentUser.destroy({success:function(a,b){b.success&&b.result?(IS.et.pe("User","Delete","Account"),IS.helpers.displayUserMessage(IS.Views.Mixins.Messages.accountDeleted),window.location="/auth/logout"):b.error&&b.error.error_message?IS.helpers.displayUserError(b.error.error_message):IS.helpers.displayUserError(IS.Views.Mixins.Messages.accountDeletionFailed)},error:function(){IS.helpers.displayUserError(IS.Views.Mixins.Messages.accountDeletionFailed)}})}.bind(this))}}),IS.Views.SettingsNotifications=Backbone.View.extend({tagName:"div",className:"tab notifications",events:{"click .save-button a":"save"},initialize:function(){this.template=IS.helpers.loadTemplate("settings_notifications")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,this.model.attributes)),this},save:function(a){var b=$(a.currentTarget);b.hasClass("disabled")||(this.updateModel(),b.addClass("disabled").html(IS.Views.Settings.SAVE_BUTTON_DISABLED_TEXT),this.model.save(null,{success:function(){IS.et.pe("Settings","Save","Notifications"),b.removeClass("disabled").html(IS.Views.Settings.SAVE_BUTTON_TEXT),IS.helpers.displayUserMessage(IS.Views.Mixins.Messages.settingsSaveSuccessful)},error:function(a,c){b.removeClass("disabled").html(IS.Views.Settings.SAVE_BUTTON_TEXT);try{c=$.parseJSON(c.responseText),c.error&&c.error.error_message?IS.helpers.displayUserError(c.error.error_message):IS.helpers.displayUserError(IS.Views.Mixins.Messages.settingsSaveFailed)}catch(d){IS.helpers.displayUserError(IS.Views.Mixins.Messages.settingsSaveFailed),IS.logger.error("[Views.SettingsNotifications]",c)}}}))},updateModel:function(){this.$(".slider-option").each(function(a,b){var c=$(b);this.model.set(c.data("attribute"),c.hasClass("on"))}.bind(this))}}),IS.Views.SettingsPrivacy=Backbone.View.extend({tagName:"div",className:"tab privacy",events:{"click .option a.radio":"toggleRadio","click .option a.check":"toggleCheck","click .save-button a":"save","change .watermark-parent input":"watermarkChanged","click .toggle-watermark":"removeWatermark"},dropdownView:null,initialize:function(){this.template=IS.helpers.loadTemplate("settings_privacy"),this.setupElements()},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,this.model.attributes)),this.setupElements(),this},setupElements:function(){switch(this.dropdownView=new IS.Views.Dropdown({el:this.$(".dropdown"),hideSelection:!0}).on("change",this.toggleStartPage,this),parseInt(this.model.get("start_page"))){case IS.Models.Settings.START_PAGE.MY_ALBUMS:this.dropdownView.setValue("My Albums","2");break;case IS.Models.Settings.START_PAGE.FOLLOWING:this.dropdownView.setValue("Following","3");break;default:this.dropdownView.setValue("My Images","1")}},toggleRadio:function(a){var b=$(a.currentTarget),c=b.data("value");this.model.set(b.data("attribute"),"private"==c),b.parent().removeClass("public private").addClass(c)},toggleCheck:function(a){var b=$(a.currentTarget);b.toggleClass("on"),this.model.set(b.data("attribute"),b.hasClass("on"))},toggleStartPage:function(a){this.model.set("start_page",a.value)},save:function(a){var b=$(a.currentTarget);b.hasClass("disabled")||(b.addClass("disabled").html(IS.Views.Settings.SAVE_BUTTON_DISABLED_TEXT),this.model.save(null,{success:function(){IS.et.pe("Settings","Save","Privacy"),b.removeClass("disabled").html(IS.Views.Settings.SAVE_BUTTON_TEXT),IS.helpers.displayUserMessage(IS.Views.Mixins.Messages.settingsSaveSuccessful),IS.currentUser.set("privateAlbums",this.model.get("private_albums")),IS.vent.trigger("change:album_privacy"),IS.currentUser.set("privateImages",this.model.get("private_images")),IS.vent.trigger("change:image_privacy"),IS.currentUser.set("disabledFollow",this.model.get("private_followings"))}.bind(this),error:function(a,c){b.removeClass("disabled").html(IS.Views.Settings.SAVE_BUTTON_TEXT);try{c=$.parseJSON(c.responseText),c.error&&c.error.error_message?IS.helpers.displayUserError(c.error.error_message):IS.helpers.displayUserError(IS.Views.Mixins.Messages.settingsSaveFailed)}catch(d){IS.helpers.displayUserError(IS.Views.Mixins.Messages.settingsSaveFailed),IS.logger.error("[Views.SettingsPrivacy]",c)}}}))},watermarkChanged:function(){return IS.currentUser.get("freeAccount")?void IS.helpers.showFeaturesOverlay():void(this.$el.hasClass("watermark-uploading")||(IS.et.pe("Settings","Submit","Watermark"),this.$(".watermark-parent form").ajaxSubmit({dataType:"json",data:{auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY,watermark:!0},resetForm:!0,success:function(a){if(a&&a.success&&a.result&&a.result.images&&a.result.images.length){this.$el.removeClass("watermark-uploading"),IS.et.pe("Settings","Upload","Success Watermark");var b=a.result.images.shift(),c={id:b.id,server:b.server,bucket:b.bucket,filename:b.filename,width:b.width,height:b.height};IS.currentUser.set("watermark",c),this.model.set("use_watermark",!0),this.render()}else this.$el.removeClass("watermark-uploading"),IS.helpers.displayUserError(a.error&&a.error.error_message?a.error.error_message:IS.Views.Mixins.Messages.avatarUploadFailed)}.bind(this),error:function(a){this.$el.removeClass("watermark-uploading"),IS.helpers.displayUserError(a.error&&a.error.error_message?a.error.error_message:IS.Views.Mixins.Messages.avatarUploadFailed)}.bind(this),beforeSubmit:function(){this.$el.addClass("watermark-uploading")}.bind(this)})))},removeWatermark:function(){this.model.set("use_watermark",!1),IS.currentUser.set("watermark",{id:null}),this.$(".save-button a").click(),this.render()},destroy:function(){this.dropdownView&&this.dropdownView.destroy(),Backbone.View.prototype.destroy.call(this)}}),IS.Views.SettingsProfile=Backbone.View.extend({tagName:"div",className:"tab profile",events:{"change .upload-form .avatar-input":"avatarChanged","keyup .about-input":"restrictBioLength","click .save-button a":"save","blur .model-attribute":"saveAttribute","click article.gender a":"setGender","click .trackable":"trackEvent","click .upload-form .avatar-crop":"openImageCropper"},initialize:function(){this.template=IS.helpers.loadTemplate("settings_profile"),this.prevAttributes=JSON.parse(JSON.stringify(this.model.attributes)),this.model.on("invalid",this.invalidModel,this).on("change:avatar_filename",this.render,this),this.avatarData=null,this.fetchAvatarData(),this.initLocationAC()},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,_.extend(this.model.attributes,{hasAvatar:function(){return!!this.model.get("avatar_server")}.bind(this),canUploadAvatar:function(){return!0},isFeatured:IS.currentUser.get("isFeatured")}))),this.geoAC&&this.geoAC.destroy(),this},fetchAvatarData:function(){if(this.model.get("avatar_server")){var a=new IS.Models.Landing({id:IS.currentUser.get("avatarID")});a.on("sync",function(){this.avatarData={server:a.get("server"),filename:a.get("filename"),width:a.get("width"),height:a.get("height"),type:IS.Views.ImageCropper.TYPE.AVATAR}}.bind(this)),a.fetch()}},openImageCropper:function(){if(this.avatarData){var a=IS.helpers.initImageCropper(this.avatarData);a.on("save",function(a){var b=this.model.get("avatar");IS.currentUser.set("avatarCoords",a),this.model.set("avatar",{server:b.server,filename:b.filename,x_pos:a.x_pos,y_pos:a.y_pos,x_length:a.x_length,y_length:a.y_length,cropped:!0}),this.$(".save-button a").click(),this.render()}.bind(this))}},changedAttributes:function(){var a={};return _.each(this.model.attributes,function(b,c){"object"==typeof this.prevAttributes[c]&&JSON.stringify(this.prevAttributes[c])!=JSON.stringify(b)?a[c]=b:this.prevAttributes[c]!=b&&(a[c]=b)}.bind(this)),a},initLocationAC:function(){return this.geoAC=new IS.Views.GEOAutoComplete({el:"article.location .input-parent"}).on("change",this.locationChanged,this),this},locationChanged:function(a){this.$(".location-input.geo").val(a.value),this.model.set("location",a.value)},avatarChanged:function(){var a=this;this.$el.hasClass("avatar-loading")||(IS.et.pe("Settings","Submit","Avatar"),this.$(".upload-form form").ajaxSubmit({dataType:"json",data:{auth_token:IS.currentUser.get("authToken"),api_key:IS.CONS.API_KEY,avatar:!0},resetForm:!0,success:function(b){if(b&&b.success&&b.result&&b.result.images&&b.result.images.length){IS.et.pe("Settings","Upload","Success Avatar");var c=b.result.images.shift(),d=new Image;d.onload=function(){a.model.set("avatar",{server:c.server,filename:c.filename,cropped:!1}),IS.currentUser.set({avatarServer:c.server,avatarFilename:c.filename,avatarID:c.id,avatarCoords:[]}),a.avatarData={server:c.server,filename:c.filename,width:c.width,height:c.height,type:IS.Views.ImageCropper.TYPE.AVATAR},a.model.set({avatar_server:c.server,avatar_filename:c.filename}),_.defer(function(){a.$el.removeClass("avatar-uploading")}),a.$(".upload-form .avatar-crop").removeClass("hidden"),a.$(".save-button a").click()},d.onerror=function(){a.model.set("avatar",{server:c.server,filename:c.filename,cropped:!1}),a.$el.removeClass("avatar-uploading"),a.model.set({avatar_server:c.server,avatar_filename:c.filename})},d.src=IS.helpers.getImagizerLink({server:c.server,filename:c.filename,width:100,height:100,cropped:!0})}else a.$el.removeClass("avatar-uploading"),IS.helpers.displayUserError(IS.Views.Mixins.Messages.avatarUploadFailed)},error:function(b){a.$el.removeClass("avatar-uploading"),IS.logger.error("Settings page avatar upload failed",b),IS.helpers.displayUserError(IS.Views.Mixins.Messages.avatarUploadFailed)},beforeSubmit:function(){a.$el.addClass("avatar-uploading")}}))},restrictBioLength:function(a){a.currentTarget.value=a.currentTarget.value?a.currentTarget.value.substring(0,140):""},saveAttribute:function(a){var b=$(a.currentTarget),c=b.prop("name").split(".");if(1===c.length)this.model.set(c[0],b.val());else if("sites"==c[0]){for(var d=this.model.get("sites"),e=-1,f=0;f<d.length;f++){var g=d[f];if(g.site_name==c[1]){e=f;break}}e>=0&&d.splice(e,1),b.val()&&d.push({site_name:c[1],profile_url:b.val()}),this.model.set("sites",d)}},save:function(a){
var b=$(a.currentTarget),c=this.changedAttributes(),d=this;if(!_.isEmpty(c)&&!b.hasClass("disabled")){if(c.username&&/\s/.test(c.username))return void IS.helpers.displayUserError(IS.Views.Mixins.Messages.usernameHasSpace);b.addClass("disabled").html(IS.Views.Settings.SAVE_BUTTON_DISABLED_TEXT),this.model.once("invalid",function(){b.removeClass("disabled").html(IS.Views.Settings.SAVE_BUTTON_TEXT)}),this.model.save(c,{success:function(){IS.et.pe("Settings","Save","Profile"),d.model.off("invalid"),b.removeClass("disabled").html(IS.Views.Settings.SAVE_BUTTON_TEXT),d.prevAttributes=JSON.parse(JSON.stringify(d.model.attributes)),IS.helpers.displayUserMessage(IS.Views.Mixins.Messages.settingsSaveSuccessful),IS.currentUser.set("socialSites",d.model.get("sites")),IS.vent.trigger("header_main:update_avatar",{avatar:IS.helpers.getAvatarLink(28,d.model.get("avatar"))}),IS.vent.trigger("header_main:update_username",{username:d.model.get("username")})},error:function(a,c){d.model.off("invalid"),b.removeClass("disabled").html(IS.Views.Settings.SAVE_BUTTON_TEXT);try{c=$.parseJSON(c.responseText),c.error&&c.error.error_message?IS.helpers.displayUserError(c.error.error_message):IS.helpers.displayUserError(IS.Views.Mixins.Messages.settingsSaveFailed)}catch(e){IS.helpers.displayUserError(IS.Views.Mixins.Messages.settingsSaveFailed),IS.logger.error("[Views.SettingsProfile]",c)}}})}},invalidModel:function(a,b){IS.helpers.displayUserError(b)},setGender:function(a){var b=$(a.currentTarget),c=b.data("gender");this.model.set("gender",c),b.parent().removeClass("male female").addClass(c)},destroy:function(){this.geoAC.destroy(),Backbone.View.prototype.destroy.call(this)},trackEvent:function(a){IS.et.pe("Settings","Click",$(a.currentTarget).data("label"))}}),IS.Views.Settings=Backbone.View.extend({tagName:"section",id:"settings",initialize:function(a){IS.vent.trigger("app_layout:content:max_width"),IS.vent.on("app_layout:content:size:change",this.resize,this),this.template=IS.helpers.loadTemplate("settings"),this.menuView=null,this.subView=null,this.sub=a.sub,a.bootstrapped&&(this.menuView=new IS.Views.SettingsMenu({el:this.$("aside.menu"),tab:this.sub}),this.subView=new IS.Views[IS.Views.Settings.VIEWS[this.sub]]({el:this.$(".my-tabs .tab"),model:this.model,bootstrapped:!0}),"referral"==this.sub&&this.subView.fetchUsers()),$(window).resize(),this.on("transition:start",function(a){this.subView.destroy(),this.$(".my-tabs").removeClass("visible"),this.menuView.trigger("update:state",a)},this),this.on("transition:end",function(){this.renderSubView(),this.doPostRenderTasks().show()},this)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,this.model.attributes)),this.menuView=new IS.Views.SettingsMenu({tab:this.sub}),this.$el.prepend(this.menuView.render().el),this.renderSubView(),this},renderSubView:function(){this.subView=new IS.Views[IS.Views.Settings.VIEWS[this.sub]]({model:this.model}),this.$(".my-tabs").html(this.subView.render().el)},setProps:function(a){_.each(a,function(a,b){this[b]=a}.bind(this))},show:function(){return _.defer(function(){this.$el.addClass("visible"),this.$(".my-tabs").addClass("visible")}.bind(this)),this},destroy:function(){this.menuView&&this.menuView.destroy(),this.subView&&this.subView.destroy(),Backbone.View.prototype.destroy.call(this)},resize:function(a){this.$el.css({width:a.width,height:a.height})},doPostRenderTasks:function(){return"profile"==this.sub&&this.subView.initLocationAC(),this}},{TITLE:"Settings",SAVE_BUTTON_DISABLED_TEXT:"PROCESSING...",SAVE_BUTTON_TEXT:"SAVE SETTINGS",VIEWS:{profile:"SettingsProfile",privacy:"SettingsPrivacy",notifications:"SettingsNotifications",subscription:"SettingsSubscription",referral:"SettingsReferral"},MODELS:{profile:"SettingsProfile",privacy:"Settings",notifications:"Settings",subscription:"SettingsSubscription",referral:"SettingsReferral"}}),IS.Views.SettingsReferral=Backbone.View.extend({tagName:"div",className:"tab referral",events:{"click input":"select"},initialize:function(){this.$template=IS.helpers.loadTemplate("settings_referral")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,_.extend({},this.model.attributes,{referralLink:this.model.get("referral")}))),this.fetchUsers(),this},setupElements:function(){return this.$count=this.$(".referral-count"),this.$referralUsers=this.$(".referral-users"),this},fetchUsers:function(){this.setupElements();var a=new IS.Models.SettingsReferralUsers;return a.on("sync",function(){this.renderReferralResult(a)}.bind(this)),a.fetch(),this},renderReferralResult:function(a){this.$count.html(a.get("total")),a.get("total")>0&&_.each(a.get("users"),function(a){var b;b=a.avatar&&a.avatar.server?IS.helpers.getAvatarLink(36,a.avatar):"/v2_images/default_avatar_70x70.jpg",this.$referralUsers.append(Mustache.render(IS.inlineTemplates.referred_user,{username:a.username,avatarUrl:b,datetime:a.date,dateString:IS.helpers.getDateString(1e3*a.date,!0)}))}.bind(this))},select:function(a){a.currentTarget.select()}}),IS.Models.SettingsReferralUsers=Backbone.Model.extend({url:IS.CONS.API_BASE+IS.CONS.APIS.USER.REFERRAL_USERS,parse:function(a){return a.result}}),IS.Views.SettingsSubscription=Backbone.View.extend({tagName:"div",className:"tab subscription",events:{"click .all-plans-trigger":"showAllPlans","click .upgrade-button":"showPlan","click .invoice-trigger":"popupInvoice"},initialize:function(){this.template=IS.helpers.loadTemplate("settings_subscription"),this.options.bootstrapped&&this.initSubViews().setupElements()},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,this.model.attributes)),this.initSubViews().setupElements(),this},initSubViews:function(){return this.$("article.sub").each(function(a,b){new IS.Views.SettingsSubscriptionType({el:b,model:new IS.Models.SettingsSubscriptionType(this.model.get("subs")[a])})}.bind(this)),this},setupElements:function(){this.$allPlansTrigger=this.$(".all-plans-trigger"),this.$allPlans=this.$(".all-plans")},showAllPlans:function(){IS.et.pe("Settings","Click","View All Plans"),this.$allPlansTrigger.hide(),this.$allPlans.show()},showPlan:function(a){var b=$(a.currentTarget).data("type");IS.et.pe("Settings","Click","Upgrade - "+b),IS.helpers.showSubForm(null,b)},popupInvoice:function(){IS.et.pe("Settings","Click","Get Invoice"),IS.helpers.openWindow({width:800,height:700,name:"My Invoice",url:"https://imageshack.com/my/invoice"},!0)}}),IS.Views.SettingsSubscriptionType=Backbone.View.extend({tagName:"article",className:"sub",events:{"click .cc-update":"showCardUpdateBox","click .cc-cancel":"confirmCancellation"},initialize:function(){this.template=IS.helpers.loadTemplate("settings_subscription_type")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,this.model.attributes)),this},showCardUpdateBox:function(){var a=IS.helpers.showCreditCardFormOverlay({model:this.model});a.once("success",function(){IS.helpers.displayUserMessage(IS.Views.Mixins.Messages.successCardUpdate,300),Backbone.history.loadUrl()},this),a.on({error:function(){IS.vent.trigger("global_overlay:display:error",IS.Views.Mixins.Messages.failedCardUpdate)},"fail:validation":function(a){IS.vent.trigger("global_overlay:display:error",a)}},this)},confirmCancellation:function(a){var b=$(a.currentTarget);b.hasClass("processing")||IS.helpers.confirmAction({message:"Are you sure you want to cancel your subscription?"}).done(function(){var a=new Backbone.Model({transaction_id:this.model.get("transaction_id"),payment_method:this.model.get("payment_method"),sub_id:this.model.get("id")},{url:IS.CONS.API_BASE+IS.CONS.APIS.SUBSCRIPTIONS.CANCEL});b.addClass("processing"),a.save(null,{success:function(a,c){b.removeClass("processing"),c.success&&c.result&&(optimizely.push(["trackEvent","subscription_canceled"]),IS.helpers.displayUserMessage(IS.Views.Mixins.Messages.successCancellation),Backbone.history.loadUrl())},error:function(){b.removeClass("processing"),IS.helpers.displayUserError(IS.Views.Mixins.Messages.processFailed)}})}.bind(this))}}),IS.Views.ShackitHome=Backbone.View.extend({el:"#shackit",initialize:function(){this.headerMainView=new IS.Views.HeaderMain}}),IS.Views.ShackitUpload=Backbone.View.extend({el:"#shackit-uploader",events:{"click div.trigger":"toggleSelected","click #upload":"uploadImages","click .get-links":"getLinks"},successStr:'Your images have loaded successfully!  Click "Get Link" or <button class="white-button border-radius-3 get-links">Get All Links</button>',emailSuccessStr:'Your images have loaded successfully!  Please check your email to verify your account.  Click "Get Link" or <button class="white-button border-radius-3 get-links">Get All Links</button>',initialize:function(){this.FBAuthButtonView=new IS.Views.FBAuthButton({noRedirect:!1,standAlone:!0}),this.shackitUploadLoginView=new IS.Views.ShackitUploadLogin({parentView:this}),this.headerMainView=new IS.Views.HeaderMain,_.bindAll(this,"uploadImages")},toggleSelected:function(a){var b=$(a.currentTarget);b.toggleClass("selected")},uploadImages:function(){var a=[],b=$("div.selected img",this.$el);if(b.length){b.each(function(){a.push($(this).attr("src"))});var c=new Backbone.Model({urls:a,min_model:!0,api_key:IS.CONS.API_KEY,auth_token:IS.currentUser.get("authToken")},{url:IS.CONS.API_BASE+IS.CONS.APIS.IMAGES.IMAGES});this.progress(!0),c.save(null,{success:function(a,b){b&&b.success?(this.progress(!1),this.message(this.successStr),this.parseData(b.result.images)):(this.progress(!1),alert(b&&b.error&&b.error.error_message?b.error.error_message:"Failed to upload some of the images."))}.bind(this),error:function(a,b){alert(b&&b.error&&b.error.error_message?b.error.error_message:"Failed to upload some of the images.")}.bind(this)})}},progress:function(a){var b=$("#progress");a?b.slideDown("fast").addClass("loading"):b.slideUp("fast").removeClass("loading")},getLinks:function(){var a=$("#get-all-links");a.slideDown("fast").find("textarea").select()},setLinks:function(a){var b=$("#get-all-links");b.find("textarea").val(a)},message:function(a){var b=$("#message");b.html(a)},parseData:function(a){for(var b=$("#get-all-links"),c=[],d=[],e=0;e<a.length;e++){var f=a[e],g=f.original_filename,h="https://imageshack.com/i/"+f.id,i={id:g,link:h};c.push(i),d.push(h)}b.find("textarea").css("height",15*d.length+15+"px"),this.setLinks(d.join("\n")),this.wrapLinks(c)},wrapLinks:function(a){var b=a.length,c=0;for(c;b>c;c++){var d=a[c],e=d.id,f=d.link;$("#image-container img[data-id='"+e+"']").parent().removeClass("selected trigger").append(function(){return"<a href="+f+" target='_blank' class='image-link clearfix' />"})}}}),IS.Views.ShackitUploadLogin=Backbone.View.extend({el:".login-prompt",events:{"click .login-trigger.login":"showLogin","submit #login-form":"doLogin"},initialize:function(){_.extend(IS.Views.HeaderMainLoggedOut.prototype,IS.Views.Mixins.Auth),this.$loginForm=this.$("#login-form"),this.parentView=this.options.parentView},showLogin:function(a){var b=$(a.currentTarget);b.parent().addClass("show-form"),this.$loginForm.find(".focus").focus()},doLogin:function(a){a.preventDefault();var b=this,c=$("#username").val(),d=$("#password").val();return b.activeRequest?!1:(b.activeRequest=!0,void IS.Models.User.login(c,d,!0,function(){document.location.reload()},function(){b.showError(),b.activeRequest=!1}))},showError:function(){var a=this.$el.find("input.show-error","#login-form");a.addClass("flag-error"),setTimeout(function(){a.removeClass("flag-error")},1200)}}),IS.Views.Ad=Backbone.View.extend({initialize:function(){this.$template=IS.helpers.loadTemplate("ad")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,this.model.attributes)),this}}),IS.Views.LandingAd=Backbone.View.extend({initialize:function(){this.$template=IS.helpers.loadTemplate("landing_ad")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,{})),this}}),IS.Views.StaticResize=Backbone.View.extend({el:"#static-resize",events:{"change #filters":"selectFilter","mouseenter img":"displayUrl"},initialize:function(){this.setupElements()},setupElements:function(){this.thumbnails=$(".filters-thumb img")},selectFilter:function(a){var b=$(a.currentTarget).val();this.thumbnails.each(function(a,c){c.src=c.src.replace(/f\d+/g,"f"+b)})},displayUrl:function(a){var b=a.currentTarget.src;$("#resize-request-url").text(b)}}),IS.Views.StaticSkypath=Backbone.View.extend({el:"#static-skypath",events:{"mouseenter #top":"showNavigation","mouseleave #top":"hideNavigation","click #download":"showDropdown","click #prev-button":"previousSlide","click #next-button":"nextSlide","click .button":"stopSlideShow","click video":"playSlideVideo"},initialize:function(){this.setupElements(),this.slideIndex=0,this.interval=null,this.intervalLength=3500,this.startSlideShow()},setupElements:function(){this.$slides=$(".slide")},startSlideShow:function(){this.interval=setInterval(function(){this.nextSlide()}.bind(this),this.intervalLength)},stopSlideShow:function(){this.interval&&(clearInterval(this.interval),this.interval=null)},showNavigation:function(){$(".button").removeClass("hidden").addClass("visible")},hideNavigation:function(){$(".button").removeClass("visible").addClass("hidden")},showDropdown:function(){$("#dropdown").toggle("fast")},previousSlide:function(){this.$slides.eq(this.slideIndex).removeClass("visible").addClass("hidden"),this.slideIndex--,-1==this.slideIndex&&(this.slideIndex=this.$slides.length-1),this.$slides.eq(this.slideIndex).addClass("visible").removeClass("hidden")},nextSlide:function(){this.$slides.eq(this.slideIndex).removeClass("visible").addClass("hidden"),this.slideIndex++,this.slideIndex==this.$slides.length&&(this.slideIndex=0),this.$slides.eq(this.slideIndex).addClass("visible").removeClass("hidden")},playSlideVideo:function(){$(".video-wrapper img").addClass("hidden")}}),IS.Views.Static=Backbone.View.extend({el:".is-static",initialize:function(){this.headerMainView=new IS.Views.HeaderMain}}),IS.Views.StaticErrorMobile=Backbone.View.extend({el:"section.four-oh-four",initialize:function(){this.renderAds()},renderAds:function(){(!IS.currentUser||IS.currentUser.get("freeAccount"))&&(this.$el.prepend(IS.helpers.getAdHTML({code:IS.CONS.ADS.E2})),this.$el.prepend(IS.helpers.getAdHTML({code:IS.CONS.ADS.E1,width:320,height:50})))}}),IS.Views.StaticFaq=Backbone.View.extend({el:"#static-faq",events:{"click section.content section.navs nav a":"scrollToSection","click section.videos section.left nav a":"showVideo"},initialize:function(){this.headerMainView=new IS.Views.HeaderMain,this.videoSrc='<iframe src="//player.vimeo.com/video/#id#?portrait=0&amp;color=f7bd25&amp;autoplay=1" width="490" height="270" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>',this.$video=this.$("figure.video")},scrollToSection:function(a){var b=$(a.currentTarget),c=b.attr("class"),d=$("h1.main."+c),e=d.offset().top-3*d.height();IS.helpers.animateScrollTop($("html, body"),e,300)},showVideo:function(a){var b=$(a.currentTarget),c=b.attr("class"),d=null;$("section.videos nav a.active").removeClass("active"),b.addClass("active"),"started"==c?d=83692896:"uploader"==c?d=68335053:"bulk"==c?d=74670995:"links"==c&&(d=83698365),this.$video.html(this.videoSrc.replace("#id#",d))}}),IS.Views.StaticPromo=Backbone.View.extend({el:"#static-promo",events:{"click section.slideshow .icon":"iconClicked","click a.letter":"showLetter","click section.top .right .video":"showVideo","click section.top .bottom .computer":"computerClicked","click section.top .bottom .apps":"appsClicked","click section.top .bottom .subscribe":"subscribeClicked","click section.think .button":"tryItOutClicked","click section.go-pro .button":"showPromoPaymentBox"},initialize:function(){this.headerMainView=new IS.Views.HeaderMain},iconClicked:function(a){var b=$(a.currentTarget),c=b.data("index");this.$(".slideshow .icons .icon").each(function(){$(this).removeClass("active")});var d=this.$('.slideshow .icons .icon[data-index="'+c+'"]');d.addClass("active"),this.$(".slideshow .titles .title.active").removeClass("active"),this.$('.slideshow .titles .title[data-index="'+c+'"]').addClass("active"),this.$(".slideshow .hero.active").removeClass("active"),_.delay(function(){this.$('.slideshow .hero[data-index="'+c+'"]').addClass("active")}.bind(this),300)},showLetter:function(){IS.helpers.displayOverlay({content:$("#tpl-letter").html(),width:768,height:365})},showVideo:function(){IS.helpers.displayOverlay({content:$("#tpl-video").html(),width:768,height:494})},computerClicked:function(){IS.helpers.animateScrollTop($("html, body"),574,300)},appsClicked:function(){IS.helpers.animateScrollTop($("html, body"),1080,300)},subscribeClicked:function(){IS.helpers.animateScrollTop($("html, body"),1458,300)},tryItOutClicked:function(){return IS.currentUser?void(window.location="/my/images"):void(window.location="/signup")},showPromoPaymentBox:function(){return IS.et.pe("Promo Page","Click","Get It Now"),IS.currentUser?void IS.helpers.showSubForm():void IS.helpers.showLoginSignupOverlay(function(){this.showPromoPaymentBox()}.bind(this))}}),IS.Views.StaticSliderGallery=Backbone.View.extend({events:{"click .arrow-large.left":"leftArrowClicked","click .arrow-large.right":"rightArrowClicked"},initialize:function(){this.imageIndex=0,this.options.slideCount||$.error("slideCount required"),this.options.interval||$.error("interval required"),this.options.el||$.error("el required"),this.slideCount=this.options.slideCount,this.interval=this.options.interval,this.fire=this.options.fire,this.$slider=this.$(".slider"),this.$leftArrow=this.$(".arrow-large.left"),this.$rightArrow=this.$(".arrow-large.right"),this.cycle(),this.classes=".first,.second,.third,.fourth".split(",")},leftArrowClicked:function(){this.fire=!1;var a=this.imageIndex-1;0>a||(0==a?this.$leftArrow.addClass("disabled"):this.$leftArrow.removeClass("disabled"),this.renderBG(a),this.$rightArrow.removeClass("disabled"),this.$slider.css("margin-left","-"+a*this.interval+"px"),this.imageIndex=a,IS.et.pe("Homepage","Click","Gallery Left Arrow"))},rightArrowClicked:function(){this.fire=!1;var a=this.imageIndex+1;a>this.slideCount||(a==this.slideCount?this.$rightArrow.addClass("disabled"):this.$rightArrow.removeClass("disabled"),this.renderBG(a),this.$leftArrow.removeClass("disabled"),this.$slider.css("margin-left","-"+a*this.interval+"px"),this.imageIndex=a,IS.et.pe("Homepage","Click","Gallery Right Arrow"))},renderBG:function(a){this.$(this.classes[a]).find(".background").css("backgroundImage","url(/v2_images/home-slider-sprite-"+(a+1)+".jpg)")},cycle:function(){var a=this;setInterval(function(){if(a.fire){var b=a.imageIndex+1;a.$leftArrow.removeClass("disabled"),b>a.slideCount?(b=0,a.$leftArrow.addClass("disabled"),a.$rightArrow.removeClass("disabled")):b==a.slideCount&&a.$rightArrow.addClass("disabled"),a.$slider.css("margin-left","-"+b*a.interval+"px"),a.imageIndex=b}},5e3)}}),IS.Views.StaticUpgrade=Backbone.View.extend({el:"#static-page",events:{"click .plan-trigger":"showPaymentBox","click .bottom .wrapper a":"trackButtonEvent","click .business-plan-trigger":"showBusinessPaymentBox"},initialize:function(){IS.et.pe("Page","Load","/upgrade"),new IS.Views.HeaderMain,this.$plans=this.$(".top .plans"),this.$leftArrow=this.$(".top .plan-arrow.left"),this.$rightArrow=this.$(".top .plan-arrow.right"),this.assignListeners()},showPaymentBox:function(a){var b=$(a.currentTarget);IS.et.pe("Upgrade Page","Click","Subscribe Premium"),b.parent().hasClass("basic")?IS.helpers.showSubForm(null,"WF_BASIC"):b.parent().hasClass("pro")?IS.helpers.showSubForm(null,"WF_PRO"):b.parent().hasClass("premium")&&IS.helpers.showSubForm(null,"WF_PREMIUM")},trackButtonEvent:function(){IS.et.pe("Upgrade Page","Click","Try It / Love It")},assignListeners:function(){this.$leftArrow.on("click",function(){this.$rightArrow.show(),this.$leftArrow.hide(),this.$plans.css("left",0)}.bind(this)),this.$rightArrow.on("click",function(){this.$leftArrow.show(),this.$rightArrow.hide(),this.$plans.css("left","-291px")}.bind(this))},showBusinessPaymentBox:function(a){IS.et.pe("Business Page","Click","Subscribe Business");var b=$(a.currentTarget),c=b.data("type"),d=IS.subs.BUS[c];IS.helpers.showSubForm(d)}}),IS.Views.WelcomeVideo=Backbone.View.extend({tagName:"section",id:"welcome-video",initialize:function(){this.$template=IS.helpers.loadTemplate("welcome_video")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,{})),this}},{WIDTH:730,HEIGHT:550}),IS.Views.SubForm=Backbone.View.extend({tagName:"section",id:"sub-form",events:{click:"stopProp","click .type-selector":"setSelectedSub","click .payment-types .trigger":"subSelected","click .payment-types .cab-trigger":"getCABLink"},initialize:function(a){this.template=IS.helpers.loadTemplate("sub_form"),this.category=a.category,this.overrideMessage=a.overrideMessage,this.expireMessage=a.expireMessage},render:function(){var a=IS.subs[this.category],b=this.model;return this.$el.html(IS.helpers.renderTemplate(this.template,_.extend(this.model?this.model.toJSON():{},{typeChosen:!!b,hasAnnualDiscount:!!(a&&a.ANNUAL&&a.ANNUAL.discount),annualDiscount:100*a.ANNUAL.discount,proMonthlyCost:a.MONTHLY.cost,proAnnualCost:a.ANNUAL.cost,hasOneTimePayment:b&&!!b.get("ONE_TIME"),hasRecurringPayment:b&&!!b.get("RECUR"),isPromotion:b&&!!b.get("discount"),oneTimePaypalID:b&&b.get("ONE_TIME")?b.get("ONE_TIME").paypal_id:"",oneTimeType:b&&b.get("ONE_TIME")?b.get("ONE_TIME").type:"",paypalInvoice:IS.currentUser?IS.currentUser.get("userId")+"-"+Math.round((new Date).getTime()/1e3):"",recurPaypalID:b&&b.get("RECUR")?b.get("RECUR").paypal_id:"",recurType:b&&b.get("RECUR")?b.get("RECUR").type:"",hasClickAndBuy:!!(b&&b.get("ONE_TIME")?b.get("ONE_TIME").enable_cab:!1),overrideMessage:this.overrideMessage,expireMessage:this.expireMessage}))),this},setSelectedSub:function(a){var b=$(a.currentTarget).data("type");return this.model=new Backbone.Model(IS.subs[this.category][b]),this.overrideMessage?IS.et.pe("Subscription Flow","AutoPop Step 1","Pro - "+b+" ($"+this.model.get("cost")+")"):IS.et.pe("Subscription Flow","Step 1","Pro - "+b+" ($"+this.model.get("cost")+")"),this.render(),this},subSelected:function(a){var b=$(a.currentTarget).data("type");_.extend(this.model.attributes,this.model.get(b)),this.overrideMessage?IS.et.pe("Subscription Flow","AutoPop Step 2",this.model.get("type")+" - "+b+" ($"+this.model.get("cost")+")"):IS.et.pe("Subscription Flow","Step 2",this.model.get("type")+" - "+b+" ($"+this.model.get("cost")+")"),IS.vent.trigger("body:show:credit_card_overlay",this.model),this.trigger("close")},getCABLink:function(a){var b=$(a.currentTarget),c=this.model.get(b.data("type"));b.parents(".cab:eq(0)").addClass("processing");var d=$.ajax({url:IS.CONS.API_BASE+IS.CONS.APIS.SUBSCRIPTIONS.CAB,type:"POST",data:{payment_method:"cab",auth_token:IS.currentUser.get("authToken"),item_number:c.type}});$.when(d).always(function(a){a=a.responseText?$.parseJSON(a.responseText):a,a&&a.success&&a.result?window.location=a.result:b.parents(".cab:eq(0)").removeClass("processing")}).fail(function(){b.parents(".cab:eq(0)").removeClass("processing")})},stopProp:function(a){a.stopPropagation()}}),IS.Views.SystemMessage=Backbone.View.extend({tagName:"div",className:"system-msg",events:{"click .icon-close":"closeClicked"},initialize:function(){this.template=IS.helpers.loadTemplate("system_message"),this.$body=$("body")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,_.extend(this.model.toJSON(),{type:function(){return 2==this.model.get("messageType")?"announcement":1==this.model.get("messageType")?"error":3==this.model.get("messageType")?"promo":void 0}.bind(this)}))),this},show:function(){return IS.et.pe("System Message","Show",""),this.$body.addClass("active-system-msg"),this},hide:function(){return IS.et.pe("System Message","Click","Hide"),this.$body.removeClass("active-system-msg"),this.destroy(),this},closeClicked:function(){this.model.hide&&this.model.hide(),this.hide()}}),IS.Views.TimelineWidget=Backbone.View.extend({tagName:"section",className:"timeline-widget",events:{"click .arrow.top":"scrollGridTop","click .arrow.bottom":"scrollGridBottom","click .timeline-photo":"trackEvent"},initialize:function(a){this.dimensions={WIDTH:92,PADDING:5},this.eventCategory=a.category||"Timeline Widget",this.scrollThreshold=300,this.scrollCallback=null,this.$template=IS.helpers.loadTemplate("timeline_widget"),this.collection=new IS.Collections.TimelineWidget,this.collection.setProp({username:a.username}),this.collection.on("parsed",this.parse,this),this.collection.once({request:function(){this.$el.addClass("first-fetch")}.bind(this),sync:function(){this.$el.removeClass("first-fetch")}.bind(this)},this)},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.$template,{})),this.setupElements(),this.$timeline[0].scrollTop=0,this.$grid.lace({selector:".timeline-photo",colWidth:this.dimensions.WIDTH,colPadding:this.dimensions.PADDING,bootstrapped:!1,minCols:3,centered:!1}),this.collection.fetch(),this},parse:function(a){var b=[],c=this;_.each(a,function(a){a.width=a.width||c.dimensions.WIDTH,a.height=a.height||0;var d=IS.helpers.getAdjustedDimensions(_.extend(a,{maxWidth:c.dimensions.WIDTH})),e=Mustache.render(IS.inlineTemplates.timeline_widget_img,_.extend(a,{imageUrl:function(){return IS.helpers.getImagizerLink({server:a.server,filename:a.filename,width:d.width,quality:85})},adjustedWidth:function(){return d.width+"px"},adjustedHeight:function(){return d.height?d.height+"px":"auto"}}));b.push($(e))}),this.$grid.lace("append",$(b)),this.scrollCallback||this.collection.hasReachedEnd()?!this.scrollCallback&&this.collection.hasReachedEnd()?a.length||this.$grid.find(".timeline-photo").length?this.$grid.height()<240?this.$bottomArrow.addClass("disabled"):this.$bottomArrow.removeClass("disabled"):this.destroy():this.scrollCallback&&this.collection.hasReachedEnd()?this.stopScrollLoad():this.$bottomArrow.removeClass("disabled"):(this.setupScrollLoad(),this.$bottomArrow.removeClass("disabled"))},setupScrollLoad:function(){this.scrollCallback=IS.helpers.infiniteScroll({$target:this.$timeline,$reference:this.$grid,callback:function(){this.collection.isFetching()||this.collection.fetch()}.bind(this),threshold:this.scrollThreshold})},stopScrollLoad:function(){IS.helpers.removeInfiniteScroll({callback:this.scrollCallback,$target:this.$timeline}),this.scrollCallback=null},setupElements:function(){this.$grid=this.$(".user-grid"),this.$timeline=this.$(".timeline"),this.$topArrow=this.$(".arrow.top"),this.$bottomArrow=this.$(".arrow.bottom");var a=_.throttle(function(){this.toggleArrows()}.bind(this),100);this.$timeline.on("scroll",a)},toggleArrows:function(){this.$timeline.scrollTop()>=this.$grid.height()-this.$timeline.height()-20?this.$bottomArrow.addClass("disabled"):this.$bottomArrow.removeClass("disabled"),0==this.$timeline.scrollTop()?this.$topArrow.addClass("disabled"):this.$topArrow.removeClass("disabled")},scrollGridTop:function(a){a.currentTarget.className.indexOf("disabled")>=0||IS.helpers.animateScrollTop(this.$timeline,Math.max(0,this.$timeline.scrollTop()-Math.round(.9*this.$timeline.height())),200)},scrollGridBottom:function(a){if(!(a.currentTarget.className.indexOf("disabled")>=0)){var b=this.$grid.height()-this.$timeline.height();IS.helpers.animateScrollTop(this.$timeline,Math.min(b,this.$timeline.scrollTop()+Math.round(.9*this.$timeline.height())),200)}},trackEvent:function(){IS.et.pe(this.eventCategory,"Click","Timeline Image")},destroy:function(){this.scrollCallback&&this.stopScrollLoad(),this.$timeline.off("scroll"),Backbone.View.prototype.destroy.call(this)}}),IS.Views.Tooltip=Backbone.View.extend({tagName:"div",className:"tooltip animated",initialize:function(){this.$elem=this.options.elem,this.leftOffset=parseInt(this.$elem.data("tooltip-left")||0),this.topOffset=parseInt(this.$elem.data("tooltip-top")||0),this.topAnimation=parseInt(this.$elem.data("tooltip-animate-top")||0),this.noAnimation=$("html").hasClass("no-cssanimations"),this.offset=this.$elem.offset(),this.animationDelay=150,this.template=IS.helpers.loadTemplate("tooltip")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,this.model.attributes)),this.$el.css({top:this.offset.top-40-this.topOffset,left:this.offset.left-27-this.leftOffset}),this},show:function(){this.$el.css("top","-="+this.topAnimation).addClass(this.topAnimation?"fadeInUp":"fadeIn")},hide:function(){this.$el.hasClass("fadeInUp")||this.$el.hasClass("fadeIn")?(this.$el.removeClass(this.topAnimation?"fadeInUp":"fadeIn").addClass(this.topAnimation?"fadeOutDown":"fadeOut"),_.delay(function(){this.destroy()}.bind(this),this.noAnimation?0:this.animationDelay)):this.destroy()}}),IS.Views.TrackEmail=Backbone.View.extend({locationHash:{facebook:"https://www.facebook.com/pages/Imageshack/125060927538976",twitter:"https://twitter.com/imageshack",blog:"http://blog.imageshack.us/",instagram:"http://instagram.com/imageshackcorp"},initialize:function(){var a=this.options.type;"facebook"==a&&window._gaq.push(["_trackEvent","IS2-email-footer","Facebook_Like"]),"twitter"==a&&window._gaq.push(["_trackEvent","IS2-email-footer","Twitter_Follow"]),"blog"==a&&window._gaq.push(["_trackEvent","IS2-email-footer","Imageshack_Blog"]),"instagram"==a&&window._gaq.push(["_trackEvent","IS2-email-footer","Instagram_Follow"]),window.location=this.locationHash[a]}}),IS.Views.Unsubscribe=Backbone.View.extend({initialize:function(){this.headerMainView=new IS.Views.HeaderMain}}),IS.Views.UserProfileAlbums=Backbone.View.extend({tagName:"div",className:"grid-container",bootstrapped:!1,loading:!1,profileMode:!0,windowPadding:0,headerModel:null,albumViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),_.extend(this,IS.Views.Mixins.UserProfile),this.setupElements(),this.collection||(this.bootstrapped=!0,this.collection=new IS.Collections.ProfileAlbums($.parseJSON(this.options.albums),{totalCount:parseInt(this.options.albumsTotal),limit:20,username:this.options.username}),this.attachAlbumViews({profileMode:this.profileMode}),this.setupLaceGrid({selector:".grid-album"}),this.setupInfiniteScroll()),this.headerModel=this.options.headerModel,this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.insertNewAlbums,this),IS.vent.once("app_layout:content:loaded",this.contentLoaded,this),IS.vent.on({"app_layout:content:size:change":this.resize,"user:follow":this.userFollowed,"user:unfollow":this.userUnfollowed},this)},render:function(){var a=this.headerModel.get("profile_user")&&this.headerModel.get("profile_user").is_followed;return this.collection.each(function(b){var c=new IS.Views.GridAlbum({model:b,profileMode:this.profileMode,profileModeIsFollowed:a});this.albumViews.push(c),this.$el.append(c.render().el)}.bind(this)),this},userFollowed:function(a){a&&a.get("target_username")&&this.options&&this.options.username&&a.get("target_username")==this.options.username&&IS.vent.trigger("grid_items:grid_album:hide_follow_btn")},userUnfollowed:function(a){a&&a.get("target_username")&&this.options&&this.options.username&&a.get("target_username")==this.options.username&&IS.vent.trigger("grid_items:grid_album:show_follow_btn")},destroy:function(){this.removeInfiniteScroll(),this.collection.off(),_.each(this.albumViews,function(a){a.destroy()}),Backbone.View.prototype.destroy.call(this),IS.logger.log("[UserProfileAlbums] View destroyed")}}),IS.Views.UserProfileAlbumsDetail=Backbone.View.extend({tagName:"div",className:"grid-container faded",events:{},bootstrapped:!1,loading:!1,pageLoaded:!1,profileMode:!0,windowPadding:200,photoViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),this.enableLightbox=!0,this.eventPage="Album Page",this.setupElements(),this.collection||(this.bootstrapped=!0,this.collection=new IS.Collections.ProfileAlbumsImages($.parseJSON(this.options.photos),{
totalCount:parseInt(this.options.photosTotal),limit:IS.CONS.PHOTO_FETCH_COUNT,albumId:this.options.albumId}),this.attachPhotoViews({profileMode:this.profileMode,eventPage:this.eventPage}),this.setupLaceGrid({selector:".grid-photo",lazyLoaded:!0}),this.setupInfiniteScroll()),IS.vent.trigger("app_layout:content:bind:scroll"),IS.vent.on("app_layout:content:scrolled",this.checkPhotosVisibility,this),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.addNewPhotos,this),IS.vent.on("app_layout:content:size:change",this.resize,this),IS.vent.once("app_layout:content:loaded",this.contentLoaded,this)},render:function(){return this.collection.each(function(a){var b=new IS.Views.GridPhoto({model:a,profileMode:this.profileMode,eventPage:this.eventPage,enableLightbox:this.enableLightbox,nextPrevAlbum:!0});this.$el.append(b.render().el)}.bind(this)),this},addNewPhotos:function(a){this.insertNewPhotos(_.extend(a,{eventPage:this.eventPage}))},destroy:function(){this.removeInfiniteScroll(),this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),IS.vent.trigger("app_layout:content:unbind:scroll"),Backbone.View.prototype.destroy.call(this),IS.logger.log("[UserProfileAlbumsDetail] View destroyed")}}),IS.Views.UserProfileAlbumsMobile=Backbone.View.extend({tagName:"div",className:"grid-container-mobile",events:{"click section.load-more":"loadMore"},albumViews:[],hasRendered:!1,noResultsView:null,initialize:function(){_.extend(this,IS.Views.Mixins.GridMobile),this.collection.on("fetch:success",this.insertNewAlbums,this),this.noResultsView=new IS.Views.FeedNoResults({type:IS.Views.FeedNoResults.TYPES.REGULAR,headerText:"This user has no albums yet.",bodyText:null}),this.screenType=IS.helpers.getScreenType(),this.setupInfiniteScroll()},render:function(){return this.hasRendered||(this.$el.append([IS.Templates.Mobile.sectionGrid,this.noResultsView.render().el]),this.setupElements(),this.$grid.addClass("profile")),"tablet"==this.screenType?this.setupLaceGrid({selector:".grid-album-mobile",additionalColClass:"album tablet",colWidth:IS.Views.GridAlbumMobile.SIZES.TABLET.WIDTH,colPadding:IS.Views.GridAlbumMobile.SIZES.TABLET.PADDING}):this.setupLaceGrid({selector:".grid-album-mobile",additionalColClass:"album",colWidth:IS.Views.GridAlbumMobile.SIZES.PHONE.WIDTH,colPadding:IS.Views.GridAlbumMobile.SIZES.PHONE.PADDING}),this.insertNewAlbums({initial:!this.hasRendered}),this.hasRendered=!0,this},destroy:function(){this.collection.off(),_.each(this.albumViews,function(a){a.destroy()}),this.noResultsView&&this.noResultsView.destroy(),Backbone.View.prototype.destroy.call(this),IS.logger.log("[UserProfileAlbumsMobile] View destroyed")}}),IS.Views.UserProfileAlbumsPassDialog=Backbone.View.extend({tagName:"section",className:"album-pass-dialog",events:{"click .submit":"submit","submit form":"submit"},initialize:function(){this.template=IS.helpers.loadTemplate("user_profile_albums_pass_dialog")},render:function(){return this.$el.html(IS.helpers.renderTemplate(this.template,{})),this.setupElements(),this.$inputPassword.focus(),this},setupElements:function(){this.$inputPassword=this.$("input.password")},submit:function(a){a.preventDefault();var b=this.$inputPassword.val(),c="Bad password provided.";if(!b){var d="You must provide a password.";return void IS.helpers.displayUserError(d)}this.model.authWithPassword(b,function(a){a.success?Backbone.history.loadUrl():IS.helpers.displayUserError(c)}.bind(this),function(a){IS.helpers.displayUserError(c)}.bind(this))}}),IS.Views.UserProfileBanner=Backbone.View.extend({tagName:"section",id:"profile-photo-banner",initialize:function(){_.extend(this,IS.Views.Mixins.Header),this.parentView=this.options.parentView,_.isString(this.options.photos)?this.collection=new IS.Collections.RandomPhotos($.parseJSON(this.options.photos)):this.collection=new IS.Collections.RandomPhotos(this.options.photos),this.collection.shuffle(),this.boxTemplates={single:IS.helpers.loadTemplate("profile_banner_single"),multi:IS.helpers.loadTemplate("profile_banner_multi")},this.currentPhotoIndex=-1,this.minBoxNumber=3,this.boxWidth=272,this.childClassName=".banner-box",this.delays=[50,550],this.switchInterval=null,this.switchIntervalValue=4e3,this.setupBanner(),$(window).on("resize",function(){this.setupBanner()}.bind(this))},render:function(a,b){return"single"==a?_.extend(b,{imageUrl:function(){return IS.helpers.getImagizerLink({server:b.server,filename:b.filename,width:272,height:272,cropped:!0})}}):_.extend(b,{imageUrl:function(){return IS.helpers.getImagizerLink({server:b.server,filename:b.filename,width:136,height:136,cropped:!0})},imageUrl1:function(){return IS.helpers.getImagizerLink({server:b.server_1,filename:b.filename_1,width:136,height:136,cropped:!0})},imageUrl2:function(){return IS.helpers.getImagizerLink({server:b.server_2,filename:b.filename_2,width:272,height:272,cropped:!0})}}),this.$el.append(IS.helpers.renderTemplate(this.boxTemplates[a],b)),$(this.$(this.childClassName).get(-1)).find("img").on("load",function(a){this.photoLoaded(a)}.bind(this)),this},getNextPhoto:function(){return this.currentPhotoIndex=++this.currentPhotoIndex%this.collection.length,this.collection.at(this.currentPhotoIndex)},setupBanner:function(){var a=this.$(this.childClassName).length,b=Math.max(this.minBoxNumber,Math.round(this.$el.width()/this.boxWidth));if(a!=b)if(a>b)$(this.$(this.childClassName).get(b-a)).remove();else{for(var c=0,d=b-a;d>0;d--){var e=(a+c+1)%3==0?"multi":"single",f=this.getNextPhoto();if(f){var g={box_type:e,server:f.get("server"),filename:f.get("filename"),id:f.get("id"),left:(a+c)*this.boxWidth,hasImg:!0};"multi"==e&&(f=this.getNextPhoto(),_.extend(g,{server_1:f.get("server"),filename_1:f.get("filename"),id_1:f.get("id")}),f=this.getNextPhoto(),_.extend(g,{server_2:f.get("server"),filename_2:f.get("filename"),id_2:f.get("id")}))}else var g={box_type:e,server:null,filename:null,id:null,left:(a+c)*this.boxWidth,hasImg:!1};this.render(e,g),c++}!this.switchInterval&&this.collection.length&&(this.switchInterval=setInterval(function(){this.switchPhoto()}.bind(this),this.switchIntervalValue))}},photoLoaded:function(a){var b=$(a.target);if(b.hasClass("active")){var c=Math.floor(Math.random()*this.delays.length-1);setTimeout(function(){b.parents("div:eq(0)").find(".loaded").removeClass("loaded"),b.addClass("loaded")},c)}},switchPhoto:function(){var a=this.$(this.childClassName),b=a.length,c=Math.floor(Math.random()*b),d=$(a[c]),e={};d.hasClass("multi")?(d=$(d.find(".wrapper > div")[Math.floor(3*Math.random())]),e=d.hasClass("box-0")||d.hasClass("box-1")?{width:136,height:136}:{width:272,height:272}):(d=d.find(".wrapper"),e={width:272,height:272});var f=this.getNextPhoto(),g=IS.helpers.getImagizerLink(_.extend({server:f.get("server"),filename:f.get("filename"),cropped:!0},e)),h=IS.Models.Photo.landingURL(f.get("id")),i=d.find(".active");i.hasClass("front")?i.parents("div:eq(0)").find(".back").addClass("active").attr("src",g).parent().attr("href",h):i.parents("div:eq(0)").find(".front").addClass("active").attr("src",g).parent().attr("href",h),i.removeClass("active")},resize:function(a){a=_.extend(a,{$el:this.$el}),this.resizeToGrid(a)},destroy:function(){this.switchInterval&&clearInterval(this.switchInterval),Backbone.View.prototype.destroy.call(this)}}),IS.Views.UserProfileImages=Backbone.View.extend({tagName:"div",className:"grid-container faded",bootstrapped:!1,loading:!1,pageLoaded:!1,profileMode:!0,windowPadding:0,photoViews:[],initialize:function(a){_.extend(this,IS.Views.Mixins.Grid),_.extend(this,IS.Views.Mixins.UserProfile),this.enableLightbox=!0,this.disableLightboxNav=!1,this.eventPage="Profile Page",this.setupElements(),this.collection||(this.bootstrapped=!0,this.collection=new IS.Collections.ProfileImages($.parseJSON(a.photos),{totalCount:parseInt(a.photosTotal),limit:IS.CONS.PHOTO_FETCH_COUNT,username:a.username}),this.attachPhotoViews({profileMode:this.profileMode,enableLightbox:this.enableLightbox,disableLightboxNav:this.disableLightboxNav,eventPage:this.eventPage}),this.setupLaceGrid({selector:".grid-photo",lazyLoaded:!0}),this.setupInfiniteScroll()),IS.vent.trigger("app_layout:content:bind:scroll"),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.addNewPhotos,this),IS.vent.on("app_layout:content:size:change",this.resize,this),IS.vent.on("app_layout:content:scrolled",this.checkPhotosVisibility,this),IS.vent.once("app_layout:content:loaded",this.contentLoaded,this)},render:function(){return this.collection.each(function(a){var b=new IS.Views.GridPhoto({model:a,profileMode:this.profileMode,enableLightbox:this.enableLightbox,disableLightboxNav:this.disableLightboxNav,eventPage:this.eventPage});this.$el.append(b.render().el)}.bind(this)),this},addNewPhotos:function(a){this.insertNewPhotos(_.extend(a,{eventPage:this.eventPage}))},destroy:function(){this.removeInfiniteScroll(),this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),IS.vent.trigger("app_layout:content:unbind:scroll"),Backbone.View.prototype.destroy.call(this),IS.logger.log("[UserProfileImages] View destroyed")}},{CLASS:"profile"}),IS.Views.UserProfileImagesMobile=Backbone.View.extend({className:"feed-container",tagName:"div",events:{"click section.load-more":"loadMore"},photoViews:[],hasRendered:!1,noResultsView:null,initialize:function(a){_.extend(this,IS.Views.Mixins.Feed),this.collection.on("fetch:success",this.insertNewPhotos,this),this.noResultsView=new IS.Views.FeedNoResults({type:IS.Views.FeedNoResults.TYPES.MY_IMAGES,headerText:"This user has no images yet.",bodyText:null}),this.setupInfiniteScroll()},render:function(){return this.hasRendered||(this.$el.append([IS.Templates.Mobile.sectionImages,this.noResultsView.render().el]),this.setupElements(),this.$images.addClass("profile")),this.insertNewPhotos({initial:!this.hasRendered}),this.hasRendered=!0,this},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),this.noResultsView&&this.noResultsView.destroy(),Backbone.View.prototype.destroy.call(this),IS.logger.log("[UserProfileImagesMobile] View destroyed")}}),IS.Views.UserProfileLiked=Backbone.View.extend({tagName:"div",className:"grid-container faded",bootstrapped:!1,loading:!1,pageLoaded:!1,profileMode:!0,windowPadding:0,photoViews:[],initialize:function(){_.extend(this,IS.Views.Mixins.Grid),_.extend(this,IS.Views.Mixins.UserProfile),this.enableLightbox=!0,this.disableLightboxNav=!0,this.setupElements(),IS.vent.trigger("app_layout:content:bind:scroll"),this.collection.on("fetch:started",this.showLoading,this),this.collection.on("fetch:success",this.insertNewPhotos,this),IS.vent.on("app_layout:content:size:change",this.resize,this),IS.vent.on("app_layout:content:scrolled",this.checkPhotosVisibility,this),IS.vent.once("app_layout:content:loaded",this.contentLoaded,this)},render:function(){return this.collection.each(function(a){var b=new IS.Views.GridPhoto({model:a,profileMode:this.profileMode,enableLightbox:this.enableLightbox,disableLightboxNav:this.disableLightboxNav});this.$el.append(b.render().el)}.bind(this)),this},destroy:function(){this.removeInfiniteScroll(),this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),IS.vent.trigger("app_layout:content:unbind:scroll"),Backbone.View.prototype.destroy.call(this),IS.logger.log("[UserProfileLiked] View destroyed")}},{CLASS:"profile"}),IS.Views.UserProfileLikedMobile=Backbone.View.extend({className:"feed-container",tagName:"div",events:{"click section.load-more":"loadMore"},photoViews:[],hasRendered:!1,noResultsView:null,initialize:function(a){_.extend(this,IS.Views.Mixins.Feed),this.collection.on("fetch:success",this.insertNewPhotos,this),this.noResultsView=new IS.Views.FeedNoResults({type:IS.Views.FeedNoResults.TYPES.MY_IMAGES,headerText:"This user has no liked images yet.",bodyText:null}),this.setupInfiniteScroll()},render:function(){return this.hasRendered||(this.$el.append([IS.Templates.Mobile.sectionImages,this.noResultsView.render().el]),this.setupElements(),this.$images.addClass("profile")),this.insertNewPhotos({initial:!this.hasRendered}),this.hasRendered=!0,this},destroy:function(){this.collection.off(),_.each(this.photoViews,function(a){a.destroy()}),this.noResultsView&&this.noResultsView.destroy(),Backbone.View.prototype.destroy.call(this),IS.logger.log("[UserProfileLikedMobile] View destroyed")}});