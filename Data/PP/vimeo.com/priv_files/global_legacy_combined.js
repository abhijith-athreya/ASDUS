(function(){this.MooTools={version:"1.4.5",build:"ab8ea8824dc3b24b6666867a2c4ed58ebb762cf0"};var typeOf=this.typeOf=function(item){if(item==null)return"null";if(item.$family!=null)return item.$family();if(item.nodeName){if(item.nodeType==1)return"element";if(item.nodeType==3)return/\S/.test(item.nodeValue)?"textnode":"whitespace"}else if(typeof item.length=="number"){if(item.callee)return"arguments";if("item"in item)return"collection"}return typeof item};var instanceOf=this.instanceOf=function(item,object){if(item==null)return false;var constructor=item.$constructor||item.constructor;while(constructor){if(constructor===object)return true;constructor=constructor.parent}if(!item.hasOwnProperty)return false;return item instanceof object};var Function=this.Function;var enumerables=true;for(var i in{toString:1})enumerables=null;if(enumerables)enumerables=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"];Function.prototype.overloadSetter=function(usePlural){var self=this;return function(a,b){if(a==null)return this;if(usePlural||typeof a!="string"){for(var k in a)self.call(this,k,a[k]);if(enumerables)for(var i=enumerables.length;i--;){k=enumerables[i];if(a.hasOwnProperty(k))self.call(this,k,a[k])}}else{self.call(this,a,b)}return this}};Function.prototype.overloadGetter=function(usePlural){var self=this;return function(a){var args,result;if(typeof a!="string")args=a;else if(arguments.length>1)args=arguments;else if(usePlural)args=[a];if(args){result={};for(var i=0;i<args.length;i++)result[args[i]]=self.call(this,args[i])}else{result=self.call(this,a)}return result}};Function.prototype.extend=function(key,value){this[key]=value}.overloadSetter();Function.prototype.implement=function(key,value){this.prototype[key]=value}.overloadSetter();var slice=Array.prototype.slice;Function.from=function(item){return typeOf(item)=="function"?item:function(){return item}};Array.from=function(item){if(item==null)return[];return Type.isEnumerable(item)&&typeof item!="string"?typeOf(item)=="array"?item:slice.call(item):[item]};Number.from=function(item){var number=parseFloat(item);return isFinite(number)?number:null};String.from=function(item){return item+""};Function.implement({hide:function(){this.$hidden=true;return this},protect:function(){this.$protected=true;return this}});var Type=this.Type=function(name,object){if(name){var lower=name.toLowerCase();var typeCheck=function(item){return typeOf(item)==lower};Type["is"+name]=typeCheck;if(object!=null){object.prototype.$family=function(){return lower}.hide()}}if(object==null)return null;object.extend(this);object.$constructor=Type;object.prototype.$constructor=object;return object};var toString=Object.prototype.toString;Type.isEnumerable=function(item){return item!=null&&typeof item.length=="number"&&toString.call(item)!="[object Function]"};var hooks={};var hooksOf=function(object){var type=typeOf(object.prototype);return hooks[type]||(hooks[type]=[])};var implement=function(name,method){if(method&&method.$hidden)return;var hooks=hooksOf(this);for(var i=0;i<hooks.length;i++){var hook=hooks[i];if(typeOf(hook)=="type")implement.call(hook,name,method);else hook.call(this,name,method)}var previous=this.prototype[name];if(previous==null||!previous.$protected)this.prototype[name]=method;if(this[name]==null&&typeOf(method)=="function")extend.call(this,name,function(item){return method.apply(item,slice.call(arguments,1))})};var extend=function(name,method){if(method&&method.$hidden)return;var previous=this[name];if(previous==null||!previous.$protected)this[name]=method};Type.implement({implement:implement.overloadSetter(),extend:extend.overloadSetter(),alias:function(name,existing){implement.call(this,name,this.prototype[existing])}.overloadSetter(),mirror:function(hook){hooksOf(this).push(hook);return this}});new Type("Type",Type);var force=function(name,object,methods){var isType=object!=Object,prototype=object.prototype;if(isType)object=new Type(name,object);for(var i=0,l=methods.length;i<l;i++){var key=methods[i],generic=object[key],proto=prototype[key];if(generic)generic.protect();if(isType&&proto)object.implement(key,proto.protect())}if(isType){var methodsEnumerable=prototype.propertyIsEnumerable(methods[0]);object.forEachMethod=function(fn){if(!methodsEnumerable)for(var i=0,l=methods.length;i<l;i++){fn.call(prototype,prototype[methods[i]],methods[i])}for(var key in prototype)fn.call(prototype,prototype[key],key)}}return force};force("String",String,["charAt","charCodeAt","concat","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","trim","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",Function,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]);Object.extend=extend.overloadSetter();Date.extend("now",function(){return+new Date});new Type("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide();Number.extend("random",function(min,max){return Math.floor(Math.random()*(max-min+1)+min)});var hasOwnProperty=Object.prototype.hasOwnProperty;Object.extend("forEach",function(object,fn,bind){for(var key in object){if(hasOwnProperty.call(object,key))fn.call(bind,object[key],key,object)}});Object.each=Object.forEach;Array.implement({forEach:function(fn,bind){for(var i=0,l=this.length;i<l;i++){if(i in this)fn.call(bind,this[i],i,this)}},each:function(fn,bind){Array.forEach(this,fn,bind);return this}});var cloneOf=function(item){switch(typeOf(item)){case"array":return item.clone();case"object":return Object.clone(item);default:return item}};Array.implement("clone",function(){var i=this.length,clone=new Array(i);while(i--)clone[i]=cloneOf(this[i]);return clone});var mergeOne=function(source,key,current){switch(typeOf(current)){case"object":if(typeOf(source[key])=="object")Object.merge(source[key],current);else source[key]=Object.clone(current);break;case"array":source[key]=current.clone();break;default:source[key]=current}return source};Object.extend({merge:function(source,k,v){if(typeOf(k)=="string")return mergeOne(source,k,v);for(var i=1,l=arguments.length;i<l;i++){var object=arguments[i];for(var key in object)mergeOne(source,key,object[key])}return source},clone:function(object){var clone={};for(var key in object)clone[key]=cloneOf(object[key]);return clone},append:function(original){for(var i=1,l=arguments.length;i<l;i++){var extended=arguments[i]||{};for(var key in extended)original[key]=extended[key]}return original}});["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(name){new Type(name)});var UID=Date.now();String.extend("uniqueID",function(){return(UID++).toString(36)})})();Array.implement({every:function(fn,bind){for(var i=0,l=this.length>>>0;i<l;i++){if(i in this&&!fn.call(bind,this[i],i,this))return false}return true},filter:function(fn,bind){var results=[];for(var value,i=0,l=this.length>>>0;i<l;i++)if(i in this){value=this[i];if(fn.call(bind,value,i,this))results.push(value)}return results},indexOf:function(item,from){var length=this.length>>>0;for(var i=from<0?Math.max(0,length+from):from||0;i<length;i++){if(this[i]===item)return i}return-1},map:function(fn,bind){var length=this.length>>>0,results=Array(length);for(var i=0;i<length;i++){if(i in this)results[i]=fn.call(bind,this[i],i,this)}return results},some:function(fn,bind){for(var i=0,l=this.length>>>0;i<l;i++){if(i in this&&fn.call(bind,this[i],i,this))return true}return false},clean:function(){return this.filter(function(item){return item!=null})},invoke:function(methodName){var args=Array.slice(arguments,1);return this.map(function(item){return item[methodName].apply(item,args)})},associate:function(keys){var obj={},length=Math.min(this.length,keys.length);for(var i=0;i<length;i++)obj[keys[i]]=this[i];return obj},link:function(object){var result={};for(var i=0,l=this.length;i<l;i++){for(var key in object){if(object[key](this[i])){result[key]=this[i];delete object[key];break}}}return result},contains:function(item,from){return this.indexOf(item,from)!=-1},append:function(array){this.push.apply(this,array);return this},getLast:function(){return this.length?this[this.length-1]:null},getRandom:function(){return this.length?this[Number.random(0,this.length-1)]:null},include:function(item){if(!this.contains(item))this.push(item);return this},combine:function(array){for(var i=0,l=array.length;i<l;i++)this.include(array[i]);return this},erase:function(item){for(var i=this.length;i--;){if(this[i]===item)this.splice(i,1)}return this},empty:function(){this.length=0;return this},flatten:function(){var array=[];for(var i=0,l=this.length;i<l;i++){var type=typeOf(this[i]);if(type=="null")continue;array=array.concat(type=="array"||type=="collection"||type=="arguments"||instanceOf(this[i],Array)?Array.flatten(this[i]):this[i])}return array},pick:function(){for(var i=0,l=this.length;i<l;i++){if(this[i]!=null)return this[i]}return null},hexToRgb:function(array){if(this.length!=3)return null;var rgb=this.map(function(value){if(value.length==1)value+=value;return value.toInt(16)});return array?rgb:"rgb("+rgb+")"},rgbToHex:function(array){if(this.length<3)return null;if(this.length==4&&this[3]==0&&!array)return"transparent";var hex=[];for(var i=0;i<3;i++){var bit=(this[i]-0).toString(16);hex.push(bit.length==1?"0"+bit:bit)}return array?hex:"#"+hex.join("")}});String.implement({test:function(regex,params){return(typeOf(regex)=="regexp"?regex:new RegExp(""+regex,params)).test(this)},contains:function(string,separator){return separator?(separator+this+separator).indexOf(separator+string+separator)>-1:String(this).indexOf(string)>-1},trim:function(){return String(this).replace(/^\s+|\s+$/g,"")},clean:function(){return String(this).replace(/\s+/g," ").trim()},camelCase:function(){return String(this).replace(/-\D/g,function(match){return match.charAt(1).toUpperCase()})},hyphenate:function(){return String(this).replace(/[A-Z]/g,function(match){return"-"+match.charAt(0).toLowerCase()})},capitalize:function(){return String(this).replace(/\b[a-z]/g,function(match){return match.toUpperCase()})},escapeRegExp:function(){return String(this).replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(base){return parseInt(this,base||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(array){var hex=String(this).match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return hex?hex.slice(1).hexToRgb(array):null},rgbToHex:function(array){var rgb=String(this).match(/\d{1,3}/g);return rgb?rgb.rgbToHex(array):null},substitute:function(object,regexp){return String(this).replace(regexp||/\\?\{([^{}]+)\}/g,function(match,name){if(match.charAt(0)=="\\")return match.slice(1);return object[name]!=null?object[name]:""})},htmlEncode:function(){return this.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}});Number.implement({limit:function(min,max){return Math.min(max,Math.max(min,this))},round:function(precision){precision=Math.pow(10,precision||0).toFixed(precision<0?-precision:0);return Math.round(this*precision)/precision},times:function(fn,bind){for(var i=0;i<this;i++)fn.call(bind,i,this)},toFloat:function(){return parseFloat(this)},toInt:function(base){return parseInt(this,base||10)}});Number.alias("each","times");(function(math){var methods={};math.each(function(name){if(!Number[name])methods[name]=function(){return Math[name].apply(null,[this].concat(Array.from(arguments)))}});Number.implement(methods)})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);Function.extend({attempt:function(){for(var i=0,l=arguments.length;i<l;i++){try{return arguments[i]()}catch(e){}}return null}});Function.implement({attempt:function(args,bind){try{return this.apply(bind,Array.from(args))}catch(e){}return null},bind:function(that){var self=this,args=arguments.length>1?Array.slice(arguments,1):null,F=function(){};var bound=function(){var context=that,length=arguments.length;if(this instanceof bound){F.prototype=self.prototype;context=new F}var result=!args&&!length?self.call(context):self.apply(context,args&&length?args.concat(Array.slice(arguments)):args||arguments);return context==that?result:context};return bound},pass:function(args,bind){var self=this;if(args!=null)args=Array.from(args);return function(){return self.apply(bind,args||arguments)}},delay:function(delay,bind,args){return setTimeout(this.pass(args==null?[]:args,bind),delay)},periodical:function(periodical,bind,args){return setInterval(this.pass(args==null?[]:args,bind),periodical)}});(function(){var hasOwnProperty=Object.prototype.hasOwnProperty;Object.extend({subset:function(object,keys){var results={};for(var i=0,l=keys.length;i<l;i++){var k=keys[i];if(k in object)results[k]=object[k]}return results},map:function(object,fn,bind){var results={};for(var key in object){if(hasOwnProperty.call(object,key))results[key]=fn.call(bind,object[key],key,object)}return results},filter:function(object,fn,bind){var results={};for(var key in object){var value=object[key];if(hasOwnProperty.call(object,key)&&fn.call(bind,value,key,object))results[key]=value}return results},every:function(object,fn,bind){for(var key in object){if(hasOwnProperty.call(object,key)&&!fn.call(bind,object[key],key))return false}return true},some:function(object,fn,bind){for(var key in object){if(hasOwnProperty.call(object,key)&&fn.call(bind,object[key],key))return true}return false},keys:function(object){var keys=[];for(var key in object){if(hasOwnProperty.call(object,key))keys.push(key)}return keys},values:function(object){var values=[];for(var key in object){if(hasOwnProperty.call(object,key))values.push(object[key])}return values},getLength:function(object){return Object.keys(object).length},keyOf:function(object,value){for(var key in object){if(hasOwnProperty.call(object,key)&&object[key]===value)return key}return null},contains:function(object,value){return Object.keyOf(object,value)!=null},toQueryString:function(object,base){var queryString=[];Object.each(object,function(value,key){if(base)key=base+"["+key+"]";var result;switch(typeOf(value)){case"object":result=Object.toQueryString(value,key);break;case"array":var qs={};value.each(function(val,i){qs[i]=val});result=Object.toQueryString(qs,key);break;default:result=key+"="+encodeURIComponent(value)}if(value!=null)queryString.push(result)});return queryString.join("&")}})})();(function(){var document=this.document;var window=document.window=this;var ua=navigator.userAgent.toLowerCase(),platform=navigator.platform.toLowerCase(),UA=ua.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],mode=UA[1]=="ie"&&document.documentMode;var Browser=this.Browser={extend:Function.prototype.extend,name:UA[1]=="version"?UA[3]:UA[1],version:mode||parseFloat(UA[1]=="opera"&&UA[4]?UA[4]:UA[2]),Platform:{name:ua.match(/ip(?:ad|od|hone)/)?"ios":(ua.match(/(?:webos|android)/)||platform.match(/mac|win|linux/)||["other"])[0]},Features:{xpath:!!document.evaluate,air:!!window.runtime,query:!!document.querySelector,json:!!window.JSON},Plugins:{}};Browser[Browser.name]=true;Browser[Browser.name+parseInt(Browser.version,10)]=true;Browser.Platform[Browser.Platform.name]=true;Browser.Request=function(){var XMLHTTP=function(){return new XMLHttpRequest};var MSXML2=function(){return new ActiveXObject("MSXML2.XMLHTTP")};var MSXML=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt(function(){XMLHTTP();return XMLHTTP},function(){MSXML2();return MSXML2},function(){MSXML();return MSXML})}();Browser.Features.xhr=!!Browser.Request;var version=(Function.attempt(function(){return navigator.plugins["Shockwave Flash"].description},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")})||"0 r0").match(/\d+/g);Browser.Plugins.Flash={version:Number(version[0]||"0."+version[1])||0,build:Number(version[2])||0};Browser.exec=function(text){if(!text)return text;if(window.execScript){window.execScript(text)}else{var script=document.createElement("script");script.setAttribute("type","text/javascript");script.text=text;document.head.appendChild(script);document.head.removeChild(script)}return text};String.implement("stripScripts",function(exec){var scripts="";var text=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(all,code){scripts+=code+"\n";return""});if(exec===true)Browser.exec(scripts);else if(typeOf(exec)=="function")exec(scripts,text);return text});Browser.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event});this.Window=this.$constructor=new Type("Window",function(){});this.$family=Function.from("window").hide();Window.mirror(function(name,method){window[name]=method});this.Document=document.$constructor=new Type("Document",function(){});document.$family=Function.from("document").hide();Document.mirror(function(name,method){document[name]=method});document.html=document.documentElement;if(!document.head)document.head=document.getElementsByTagName("head")[0];if(document.execCommand)try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}if(this.attachEvent&&!this.addEventListener){var unloadEvent=function(){this.detachEvent("onunload",unloadEvent);document.head=document.html=document.window=null};this.attachEvent("onunload",unloadEvent)}var arrayFrom=Array.from;try{arrayFrom(document.html.childNodes)}catch(e){Array.from=function(item){if(typeof item!="string"&&Type.isEnumerable(item)&&typeOf(item)!="array"){var i=item.length,array=new Array(i);while(i--)array[i]=item[i];return array}return arrayFrom(item)};var prototype=Array.prototype,slice=prototype.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(name){var method=prototype[name];Array[name]=function(item){return method.apply(Array.from(item),slice.call(arguments,1))}})}})();(function(){var _keys={};var DOMEvent=this.DOMEvent=new Type("DOMEvent",function(event,win){if(!win)win=window;event=event||win.event;if(event.$extended)return event;this.event=event;this.$extended=true;this.shift=event.shiftKey;this.control=event.ctrlKey;this.alt=event.altKey;this.meta=event.metaKey;var type=this.type=event.type;var target=event.target||event.srcElement;while(target&&target.nodeType==3)target=target.parentNode;this.target=document.id(target);if(type.indexOf("key")==0){var code=this.code=event.which||event.keyCode;this.key=_keys[code];if(type=="keydown"){if(code>111&&code<124)this.key="f"+(code-111);else if(code>95&&code<106)this.key=code-96}if(this.key==null)this.key=String.fromCharCode(code).toLowerCase()}else if(type=="click"||type=="dblclick"||type=="contextmenu"||type=="DOMMouseScroll"||type.indexOf("mouse")==0){var doc=win.document;doc=!doc.compatMode||doc.compatMode=="CSS1Compat"?doc.html:doc.body;this.page={x:event.pageX!=null?event.pageX:event.clientX+doc.scrollLeft,y:event.pageY!=null?event.pageY:event.clientY+doc.scrollTop};this.client={x:event.pageX!=null?event.pageX-win.pageXOffset:event.clientX,y:event.pageY!=null?event.pageY-win.pageYOffset:event.clientY};if(type=="DOMMouseScroll"||type=="mousewheel")this.wheel=event.wheelDelta?event.wheelDelta/120:-(event.detail||0)/3;this.rightClick=event.which==3||event.button==2;if(type=="mouseover"||type=="mouseout"){var related=event.relatedTarget||event[(type=="mouseover"?"from":"to")+"Element"];while(related&&related.nodeType==3)related=related.parentNode;this.relatedTarget=document.id(related)}}else if(type.indexOf("touch")==0||type.indexOf("gesture")==0){this.rotation=event.rotation;this.scale=event.scale;this.targetTouches=event.targetTouches;this.changedTouches=event.changedTouches;var touches=this.touches=event.touches;if(touches&&touches[0]){var touch=touches[0];this.page={x:touch.pageX,y:touch.pageY};this.client={x:touch.clientX,y:touch.clientY}}}if(!this.client)this.client={};if(!this.page)this.page={}});DOMEvent.implement({stop:function(){return this.preventDefault().stopPropagation()},stopPropagation:function(){if(this.event.stopPropagation)this.event.stopPropagation();else this.event.cancelBubble=true;return this},preventDefault:function(){if(this.event.preventDefault)this.event.preventDefault();else this.event.returnValue=false;return this}});DOMEvent.defineKey=function(code,key){_keys[code]=key;return this};DOMEvent.defineKeys=DOMEvent.defineKey.overloadSetter(true);DOMEvent.defineKeys({38:"up",40:"down",37:"left",39:"right",27:"esc",32:"space",8:"backspace",9:"tab",46:"delete",13:"enter"})})();(function(){var Class=this.Class=new Type("Class",function(params){if(instanceOf(params,Function))params={initialize:params};var newClass=function(){reset(this);if(newClass.$prototyping)return this;this.$caller=null;var value=this.initialize?this.initialize.apply(this,arguments):this;this.$caller=this.caller=null;return value}.extend(this).implement(params);newClass.$constructor=Class;newClass.prototype.$constructor=newClass;newClass.prototype.parent=parent;return newClass});var parent=function(){if(!this.$caller)throw new Error('The method "parent" cannot be called.');var name=this.$caller.$name,parent=this.$caller.$owner.parent,previous=parent?parent.prototype[name]:null;if(!previous)throw new Error('The method "'+name+'" has no parent.');return previous.apply(this,arguments)};var reset=function(object){for(var key in object){var value=object[key];switch(typeOf(value)){case"object":var F=function(){};F.prototype=value;object[key]=reset(new F);break;case"array":object[key]=value.clone();break}}return object};var wrap=function(self,key,method){if(method.$origin)method=method.$origin;var wrapper=function(){if(method.$protected&&this.$caller==null)throw new Error('The method "'+key+'" cannot be called.');var caller=this.caller,current=this.$caller;this.caller=current;this.$caller=wrapper;var result=method.apply(this,arguments);this.$caller=current;this.caller=caller;return result}.extend({$owner:self,$origin:method,$name:key});return wrapper};var implement=function(key,value,retain){if(Class.Mutators.hasOwnProperty(key)){value=Class.Mutators[key].call(this,value);if(value==null)return this}if(typeOf(value)=="function"){if(value.$hidden)return this;this.prototype[key]=retain?value:wrap(this,key,value)}else{Object.merge(this.prototype,key,value)}return this};var getInstance=function(klass){klass.$prototyping=true;var proto=new klass;delete klass.$prototyping;return proto};Class.implement("implement",implement.overloadSetter());Class.Mutators={Extends:function(parent){this.parent=parent;this.prototype=getInstance(parent)},Implements:function(items){Array.from(items).each(function(item){var instance=new item;for(var key in instance)implement.call(this,key,instance[key],true)},this)}}})();(function(){this.Chain=new Class({$chain:[],chain:function(){this.$chain.append(Array.flatten(arguments));return this},callChain:function(){return this.$chain.length?this.$chain.shift().apply(this,arguments):false},clearChain:function(){this.$chain.empty();return this}});var removeOn=function(string){return string.replace(/^on([A-Z])/,function(full,first){return first.toLowerCase()})};this.Events=new Class({$events:{},addEvent:function(type,fn,internal){type=removeOn(type);this.$events[type]=(this.$events[type]||[]).include(fn);if(internal)fn.internal=true;return this},addEvents:function(events){for(var type in events)this.addEvent(type,events[type]);return this},fireEvent:function(type,args,delay){type=removeOn(type);var events=this.$events[type];if(!events)return this;args=Array.from(args);events.each(function(fn){if(delay)fn.delay(delay,this,args);else fn.apply(this,args)},this);return this},removeEvent:function(type,fn){type=removeOn(type);var events=this.$events[type];if(events&&!fn.internal){var index=events.indexOf(fn);if(index!=-1)delete events[index]}return this},removeEvents:function(events){var type;if(typeOf(events)=="object"){for(type in events)this.removeEvent(type,events[type]);return this}if(events)events=removeOn(events);for(type in this.$events){if(events&&events!=type)continue;var fns=this.$events[type];for(var i=fns.length;i--;)if(i in fns){this.removeEvent(type,fns[i])}}return this}});this.Options=new Class({setOptions:function(){var options=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(this.addEvent)for(var option in options){if(typeOf(options[option])!="function"||!/^on[A-Z]/.test(option))continue;this.addEvent(option,options[option]);delete options[option]}return this}})})();(function(){var parsed,separatorIndex,combinatorIndex,reversed,cache={},reverseCache={},reUnescape=/\\/g;var parse=function(expression,isReversed){if(expression==null)return null;if(expression.Slick===true)return expression;expression=(""+expression).replace(/^\s+|\s+$/g,"");reversed=!!isReversed;var currentCache=reversed?reverseCache:cache;if(currentCache[expression])return currentCache[expression];parsed={Slick:true,expressions:[],raw:expression,reverse:function(){return parse(this.raw,true)}};separatorIndex=-1;while(expression!=(expression=expression.replace(regexp,parser)));parsed.length=parsed.expressions.length;return currentCache[parsed.raw]=reversed?reverse(parsed):parsed};var reverseCombinator=function(combinator){if(combinator==="!")return" ";else if(combinator===" ")return"!";else if(/^!/.test(combinator))return combinator.replace(/^!/,"");else return"!"+combinator};var reverse=function(expression){var expressions=expression.expressions;for(var i=0;i<expressions.length;i++){var exp=expressions[i];var last={parts:[],tag:"*",combinator:reverseCombinator(exp[0].combinator)};for(var j=0;j<exp.length;j++){var cexp=exp[j];if(!cexp.reverseCombinator)cexp.reverseCombinator=" ";cexp.combinator=cexp.reverseCombinator;delete cexp.reverseCombinator}exp.reverse().push(last)}return expression};var escapeRegExp=function(string){return string.replace(/[-[\]{}()*+?.\\^$|,#\s]/g,function(match){return"\\"+match})};var regexp=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+escapeRegExp(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])"));function parser(rawMatch,separator,combinator,combinatorChildren,tagName,id,className,attributeKey,attributeOperator,attributeQuote,attributeValue,pseudoMarker,pseudoClass,pseudoQuote,pseudoClassQuotedValue,pseudoClassValue){if(separator||separatorIndex===-1){parsed.expressions[++separatorIndex]=[];combinatorIndex=-1;if(separator)return""}if(combinator||combinatorChildren||combinatorIndex===-1){combinator=combinator||" ";var currentSeparator=parsed.expressions[separatorIndex];if(reversed&&currentSeparator[combinatorIndex])currentSeparator[combinatorIndex].reverseCombinator=reverseCombinator(combinator);currentSeparator[++combinatorIndex]={combinator:combinator,tag:"*"}}var currentParsed=parsed.expressions[separatorIndex][combinatorIndex];if(tagName){currentParsed.tag=tagName.replace(reUnescape,"")}else if(id){currentParsed.id=id.replace(reUnescape,"")}else if(className){className=className.replace(reUnescape,"");if(!currentParsed.classList)currentParsed.classList=[];if(!currentParsed.classes)currentParsed.classes=[];currentParsed.classList.push(className);currentParsed.classes.push({value:className,regexp:new RegExp("(^|\\s)"+escapeRegExp(className)+"(\\s|$)")})}else if(pseudoClass){pseudoClassValue=pseudoClassValue||pseudoClassQuotedValue;pseudoClassValue=pseudoClassValue?pseudoClassValue.replace(reUnescape,""):null;if(!currentParsed.pseudos)currentParsed.pseudos=[];currentParsed.pseudos.push({key:pseudoClass.replace(reUnescape,""),value:pseudoClassValue,type:pseudoMarker.length==1?"class":"element"})}else if(attributeKey){attributeKey=attributeKey.replace(reUnescape,"");attributeValue=(attributeValue||"").replace(reUnescape,"");var test,regexp;switch(attributeOperator){case"^=":regexp=new RegExp("^"+escapeRegExp(attributeValue));break;case"$=":regexp=new RegExp(escapeRegExp(attributeValue)+"$");break;case"~=":regexp=new RegExp("(^|\\s)"+escapeRegExp(attributeValue)+"(\\s|$)");break;case"|=":regexp=new RegExp("^"+escapeRegExp(attributeValue)+"(-|$)");break;case"=":test=function(value){return attributeValue==value};break;case"*=":test=function(value){return value&&value.indexOf(attributeValue)>-1};break;case"!=":test=function(value){return attributeValue!=value};break;default:test=function(value){return!!value}}if(attributeValue==""&&/^[*$^]=$/.test(attributeOperator))test=function(){return false};if(!test)test=function(value){return value&&regexp.test(value)};if(!currentParsed.attributes)currentParsed.attributes=[];currentParsed.attributes.push({key:attributeKey,operator:attributeOperator,value:attributeValue,test:test})}return""}var Slick=this.Slick||{};Slick.parse=function(expression){return parse(expression)};Slick.escapeRegExp=escapeRegExp;if(!this.Slick)this.Slick=Slick}).apply(typeof exports!="undefined"?exports:this);(function(){var local={},featuresCache={},toString=Object.prototype.toString;local.isNativeCode=function(fn){return/\{\s*\[native code\]\s*\}/.test(""+fn)};local.isXML=function(document){return!!document.xmlVersion||!!document.xml||toString.call(document)=="[object XMLDocument]"||document.nodeType==9&&document.documentElement.nodeName!="HTML"};local.setDocument=function(document){var nodeType=document.nodeType;if(nodeType==9);else if(nodeType)document=document.ownerDocument;else if(document.navigator)document=document.document;else return;if(this.document===document)return;this.document=document;var root=document.documentElement,rootUid=this.getUIDXML(root),features=featuresCache[rootUid],feature;if(features){for(feature in features){this[feature]=features[feature]}return}features=featuresCache[rootUid]={};features.root=root;features.isXMLDocument=this.isXML(document);features.brokenStarGEBTN=features.starSelectsClosedQSA=features.idGetsName=features.brokenMixedCaseQSA=features.brokenGEBCN=features.brokenCheckedQSA=features.brokenEmptyAttributeQSA=features.isHTMLDocument=features.nativeMatchesSelector=false;var starSelectsClosed,starSelectsComments,brokenSecondClassNameGEBCN,cachedGetElementsByClassName,brokenFormAttributeGetter;var selected,id="slick_uniqueid";var testNode=document.createElement("div");var testRoot=document.body||document.getElementsByTagName("body")[0]||root;testRoot.appendChild(testNode);try{testNode.innerHTML='<a id="'+id+'"></a>';features.isHTMLDocument=!!document.getElementById(id)}catch(e){}if(features.isHTMLDocument){testNode.style.display="none";testNode.appendChild(document.createComment(""));starSelectsComments=testNode.getElementsByTagName("*").length>1;try{testNode.innerHTML="foo</foo>";selected=testNode.getElementsByTagName("*");starSelectsClosed=selected&&!!selected.length&&selected[0].nodeName.charAt(0)=="/"}catch(e){}features.brokenStarGEBTN=starSelectsComments||starSelectsClosed;try{testNode.innerHTML='<a name="'+id+'"></a><b id="'+id+'"></b>';features.idGetsName=document.getElementById(id)===testNode.firstChild}catch(e){}if(testNode.getElementsByClassName){try{testNode.innerHTML='<a class="f"></a><a class="b"></a>';testNode.getElementsByClassName("b").length;testNode.firstChild.className="b";
cachedGetElementsByClassName=testNode.getElementsByClassName("b").length!=2}catch(e){}try{testNode.innerHTML='<a class="a"></a><a class="f b a"></a>';brokenSecondClassNameGEBCN=testNode.getElementsByClassName("a").length!=2}catch(e){}features.brokenGEBCN=cachedGetElementsByClassName||brokenSecondClassNameGEBCN}if(testNode.querySelectorAll){try{testNode.innerHTML="foo</foo>";selected=testNode.querySelectorAll("*");features.starSelectsClosedQSA=selected&&!!selected.length&&selected[0].nodeName.charAt(0)=="/"}catch(e){}try{testNode.innerHTML='<a class="MiX"></a>';features.brokenMixedCaseQSA=!testNode.querySelectorAll(".MiX").length}catch(e){}try{testNode.innerHTML='<select><option selected="selected">a</option></select>';features.brokenCheckedQSA=testNode.querySelectorAll(":checked").length==0}catch(e){}try{testNode.innerHTML='<a class=""></a>';features.brokenEmptyAttributeQSA=testNode.querySelectorAll('[class*=""]').length!=0}catch(e){}}try{testNode.innerHTML='<form action="s"><input id="action"/></form>';brokenFormAttributeGetter=testNode.firstChild.getAttribute("action")!="s"}catch(e){}features.nativeMatchesSelector=root.matchesSelector||root.mozMatchesSelector||root.webkitMatchesSelector;if(features.nativeMatchesSelector)try{features.nativeMatchesSelector.call(root,":slick");features.nativeMatchesSelector=null}catch(e){}}try{root.slick_expando=1;delete root.slick_expando;features.getUID=this.getUIDHTML}catch(e){features.getUID=this.getUIDXML}testRoot.removeChild(testNode);testNode=selected=testRoot=null;features.getAttribute=features.isHTMLDocument&&brokenFormAttributeGetter?function(node,name){var method=this.attributeGetters[name];if(method)return method.call(node);var attributeNode=node.getAttributeNode(name);return attributeNode?attributeNode.nodeValue:null}:function(node,name){var method=this.attributeGetters[name];return method?method.call(node):node.getAttribute(name)};features.hasAttribute=root&&this.isNativeCode(root.hasAttribute)?function(node,attribute){return node.hasAttribute(attribute)}:function(node,attribute){node=node.getAttributeNode(attribute);return!!(node&&(node.specified||node.nodeValue))};var nativeRootContains=root&&this.isNativeCode(root.contains),nativeDocumentContains=document&&this.isNativeCode(document.contains);features.contains=nativeRootContains&&nativeDocumentContains?function(context,node){return context.contains(node)}:nativeRootContains&&!nativeDocumentContains?function(context,node){return context===node||(context===document?document.documentElement:context).contains(node)}:root&&root.compareDocumentPosition?function(context,node){return context===node||!!(context.compareDocumentPosition(node)&16)}:function(context,node){if(node)do{if(node===context)return true}while(node=node.parentNode);return false};features.documentSorter=root.compareDocumentPosition?function(a,b){if(!a.compareDocumentPosition||!b.compareDocumentPosition)return 0;return a.compareDocumentPosition(b)&4?-1:a===b?0:1}:"sourceIndex"in root?function(a,b){if(!a.sourceIndex||!b.sourceIndex)return 0;return a.sourceIndex-b.sourceIndex}:document.createRange?function(a,b){if(!a.ownerDocument||!b.ownerDocument)return 0;var aRange=a.ownerDocument.createRange(),bRange=b.ownerDocument.createRange();aRange.setStart(a,0);aRange.setEnd(a,0);bRange.setStart(b,0);bRange.setEnd(b,0);return aRange.compareBoundaryPoints(Range.START_TO_END,bRange)}:null;root=null;for(feature in features){this[feature]=features[feature]}};var reSimpleSelector=/^([#.]?)((?:[\w-]+|\*))$/,reEmptyAttribute=/\[.+[*$^]=(?:""|'')?\]/,qsaFailExpCache={};local.search=function(context,expression,append,first){var found=this.found=first?null:append||[];if(!context)return found;else if(context.navigator)context=context.document;else if(!context.nodeType)return found;var parsed,i,uniques=this.uniques={},hasOthers=!!(append&&append.length),contextIsDocument=context.nodeType==9;if(this.document!==(contextIsDocument?context:context.ownerDocument))this.setDocument(context);if(hasOthers)for(i=found.length;i--;)uniques[this.getUID(found[i])]=true;if(typeof expression=="string"){var simpleSelector=expression.match(reSimpleSelector);simpleSelectors:if(simpleSelector){var symbol=simpleSelector[1],name=simpleSelector[2],node,nodes;if(!symbol){if(name=="*"&&this.brokenStarGEBTN)break simpleSelectors;nodes=context.getElementsByTagName(name);if(first)return nodes[0]||null;for(i=0;node=nodes[i++];){if(!(hasOthers&&uniques[this.getUID(node)]))found.push(node)}}else if(symbol=="#"){if(!this.isHTMLDocument||!contextIsDocument)break simpleSelectors;node=context.getElementById(name);if(!node)return found;if(this.idGetsName&&node.getAttributeNode("id").nodeValue!=name)break simpleSelectors;if(first)return node||null;if(!(hasOthers&&uniques[this.getUID(node)]))found.push(node)}else if(symbol=="."){if(!this.isHTMLDocument||(!context.getElementsByClassName||this.brokenGEBCN)&&context.querySelectorAll)break simpleSelectors;if(context.getElementsByClassName&&!this.brokenGEBCN){nodes=context.getElementsByClassName(name);if(first)return nodes[0]||null;for(i=0;node=nodes[i++];){if(!(hasOthers&&uniques[this.getUID(node)]))found.push(node)}}else{var matchClass=new RegExp("(^|\\s)"+Slick.escapeRegExp(name)+"(\\s|$)");nodes=context.getElementsByTagName("*");for(i=0;node=nodes[i++];){className=node.className;if(!(className&&matchClass.test(className)))continue;if(first)return node;if(!(hasOthers&&uniques[this.getUID(node)]))found.push(node)}}}if(hasOthers)this.sort(found);return first?null:found}querySelector:if(context.querySelectorAll){if(!this.isHTMLDocument||qsaFailExpCache[expression]||this.brokenMixedCaseQSA||this.brokenCheckedQSA&&expression.indexOf(":checked")>-1||this.brokenEmptyAttributeQSA&&reEmptyAttribute.test(expression)||!contextIsDocument&&expression.indexOf(",")>-1||Slick.disableQSA)break querySelector;var _expression=expression,_context=context;if(!contextIsDocument){var currentId=_context.getAttribute("id"),slickid="slickid__";_context.setAttribute("id",slickid);_expression="#"+slickid+" "+_expression;context=_context.parentNode}try{if(first)return context.querySelector(_expression)||null;else nodes=context.querySelectorAll(_expression)}catch(e){qsaFailExpCache[expression]=1;break querySelector}finally{if(!contextIsDocument){if(currentId)_context.setAttribute("id",currentId);else _context.removeAttribute("id");context=_context}}if(this.starSelectsClosedQSA)for(i=0;node=nodes[i++];){if(node.nodeName>"@"&&!(hasOthers&&uniques[this.getUID(node)]))found.push(node)}else for(i=0;node=nodes[i++];){if(!(hasOthers&&uniques[this.getUID(node)]))found.push(node)}if(hasOthers)this.sort(found);return found}parsed=this.Slick.parse(expression);if(!parsed.length)return found}else if(expression==null){return found}else if(expression.Slick){parsed=expression}else if(this.contains(context.documentElement||context,expression)){found?found.push(expression):found=expression;return found}else{return found}this.posNTH={};this.posNTHLast={};this.posNTHType={};this.posNTHTypeLast={};this.push=!hasOthers&&(first||parsed.length==1&&parsed.expressions[0].length==1)?this.pushArray:this.pushUID;if(found==null)found=[];var j,m,n;var combinator,tag,id,classList,classes,attributes,pseudos;var currentItems,currentExpression,currentBit,lastBit,expressions=parsed.expressions;search:for(i=0;currentExpression=expressions[i];i++)for(j=0;currentBit=currentExpression[j];j++){combinator="combinator:"+currentBit.combinator;if(!this[combinator])continue search;tag=this.isXMLDocument?currentBit.tag:currentBit.tag.toUpperCase();id=currentBit.id;classList=currentBit.classList;classes=currentBit.classes;attributes=currentBit.attributes;pseudos=currentBit.pseudos;lastBit=j===currentExpression.length-1;this.bitUniques={};if(lastBit){this.uniques=uniques;this.found=found}else{this.uniques={};this.found=[]}if(j===0){this[combinator](context,tag,id,classes,attributes,pseudos,classList);if(first&&lastBit&&found.length)break search}else{if(first&&lastBit)for(m=0,n=currentItems.length;m<n;m++){this[combinator](currentItems[m],tag,id,classes,attributes,pseudos,classList);if(found.length)break search}else for(m=0,n=currentItems.length;m<n;m++)this[combinator](currentItems[m],tag,id,classes,attributes,pseudos,classList)}currentItems=this.found}if(hasOthers||parsed.expressions.length>1)this.sort(found);return first?found[0]||null:found};local.uidx=1;local.uidk="slick-uniqueid";local.getUIDXML=function(node){var uid=node.getAttribute(this.uidk);if(!uid){uid=this.uidx++;node.setAttribute(this.uidk,uid)}return uid};local.getUIDHTML=function(node){return node.uniqueNumber||(node.uniqueNumber=this.uidx++)};local.sort=function(results){if(!this.documentSorter)return results;results.sort(this.documentSorter);return results};local.cacheNTH={};local.matchNTH=/^([+-]?\d*)?([a-z]+)?([+-]\d+)?$/;local.parseNTHArgument=function(argument){var parsed=argument.match(this.matchNTH);if(!parsed)return false;var special=parsed[2]||false;var a=parsed[1]||1;if(a=="-")a=-1;var b=+parsed[3]||0;parsed=special=="n"?{a:a,b:b}:special=="odd"?{a:2,b:1}:special=="even"?{a:2,b:0}:{a:0,b:a};return this.cacheNTH[argument]=parsed};local.createNTHPseudo=function(child,sibling,positions,ofType){return function(node,argument){var uid=this.getUID(node);if(!this[positions][uid]){var parent=node.parentNode;if(!parent)return false;var el=parent[child],count=1;if(ofType){var nodeName=node.nodeName;do{if(el.nodeName!=nodeName)continue;this[positions][this.getUID(el)]=count++}while(el=el[sibling])}else{do{if(el.nodeType!=1)continue;this[positions][this.getUID(el)]=count++}while(el=el[sibling])}}argument=argument||"n";var parsed=this.cacheNTH[argument]||this.parseNTHArgument(argument);if(!parsed)return false;var a=parsed.a,b=parsed.b,pos=this[positions][uid];if(a==0)return b==pos;if(a>0){if(pos<b)return false}else{if(b<pos)return false}return(pos-b)%a==0}};local.pushArray=function(node,tag,id,classes,attributes,pseudos){if(this.matchSelector(node,tag,id,classes,attributes,pseudos))this.found.push(node)};local.pushUID=function(node,tag,id,classes,attributes,pseudos){var uid=this.getUID(node);if(!this.uniques[uid]&&this.matchSelector(node,tag,id,classes,attributes,pseudos)){this.uniques[uid]=true;this.found.push(node)}};local.matchNode=function(node,selector){if(this.isHTMLDocument&&this.nativeMatchesSelector){try{return this.nativeMatchesSelector.call(node,selector.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(matchError){}}var parsed=this.Slick.parse(selector);if(!parsed)return true;var expressions=parsed.expressions,simpleExpCounter=0,i;for(i=0;currentExpression=expressions[i];i++){if(currentExpression.length==1){var exp=currentExpression[0];if(this.matchSelector(node,this.isXMLDocument?exp.tag:exp.tag.toUpperCase(),exp.id,exp.classes,exp.attributes,exp.pseudos))return true;simpleExpCounter++}}if(simpleExpCounter==parsed.length)return false;var nodes=this.search(this.document,parsed),item;for(i=0;item=nodes[i++];){if(item===node)return true}return false};local.matchPseudo=function(node,name,argument){var pseudoName="pseudo:"+name;if(this[pseudoName])return this[pseudoName](node,argument);var attribute=this.getAttribute(node,name);return argument?argument==attribute:!!attribute};local.matchSelector=function(node,tag,id,classes,attributes,pseudos){if(tag){var nodeName=this.isXMLDocument?node.nodeName:node.nodeName.toUpperCase();if(tag=="*"){if(nodeName<"@")return false}else{if(nodeName!=tag)return false}}if(id&&node.getAttribute("id")!=id)return false;var i,part,cls;if(classes)for(i=classes.length;i--;){cls=this.getAttribute(node,"class");if(!(cls&&classes[i].regexp.test(cls)))return false}if(attributes)for(i=attributes.length;i--;){part=attributes[i];if(part.operator?!part.test(this.getAttribute(node,part.key)):!this.hasAttribute(node,part.key))return false}if(pseudos)for(i=pseudos.length;i--;){part=pseudos[i];if(!this.matchPseudo(node,part.key,part.value))return false}return true};var combinators={" ":function(node,tag,id,classes,attributes,pseudos,classList){var i,item,children;if(this.isHTMLDocument){getById:if(id){item=this.document.getElementById(id);if(!item&&node.all||this.idGetsName&&item&&item.getAttributeNode("id").nodeValue!=id){children=node.all[id];if(!children)return;if(!children[0])children=[children];for(i=0;item=children[i++];){var idNode=item.getAttributeNode("id");if(idNode&&idNode.nodeValue==id){this.push(item,tag,null,classes,attributes,pseudos);break}}return}if(!item){if(this.contains(this.root,node))return;else break getById}else if(this.document!==node&&!this.contains(node,item))return;this.push(item,tag,null,classes,attributes,pseudos);return}getByClass:if(classes&&node.getElementsByClassName&&!this.brokenGEBCN){children=node.getElementsByClassName(classList.join(" "));if(!(children&&children.length))break getByClass;for(i=0;item=children[i++];)this.push(item,tag,id,null,attributes,pseudos);return}}getByTag:{children=node.getElementsByTagName(tag);if(!(children&&children.length))break getByTag;if(!this.brokenStarGEBTN)tag=null;for(i=0;item=children[i++];)this.push(item,tag,id,classes,attributes,pseudos)}},">":function(node,tag,id,classes,attributes,pseudos){if(node=node.firstChild)do{if(node.nodeType==1)this.push(node,tag,id,classes,attributes,pseudos)}while(node=node.nextSibling)},"+":function(node,tag,id,classes,attributes,pseudos){while(node=node.nextSibling)if(node.nodeType==1){this.push(node,tag,id,classes,attributes,pseudos);break}},"^":function(node,tag,id,classes,attributes,pseudos){node=node.firstChild;if(node){if(node.nodeType==1)this.push(node,tag,id,classes,attributes,pseudos);else this["combinator:+"](node,tag,id,classes,attributes,pseudos)}},"~":function(node,tag,id,classes,attributes,pseudos){while(node=node.nextSibling){if(node.nodeType!=1)continue;var uid=this.getUID(node);if(this.bitUniques[uid])break;this.bitUniques[uid]=true;this.push(node,tag,id,classes,attributes,pseudos)}},"++":function(node,tag,id,classes,attributes,pseudos){this["combinator:+"](node,tag,id,classes,attributes,pseudos);this["combinator:!+"](node,tag,id,classes,attributes,pseudos)},"~~":function(node,tag,id,classes,attributes,pseudos){this["combinator:~"](node,tag,id,classes,attributes,pseudos);this["combinator:!~"](node,tag,id,classes,attributes,pseudos)},"!":function(node,tag,id,classes,attributes,pseudos){while(node=node.parentNode)if(node!==this.document)this.push(node,tag,id,classes,attributes,pseudos)},"!>":function(node,tag,id,classes,attributes,pseudos){node=node.parentNode;if(node!==this.document)this.push(node,tag,id,classes,attributes,pseudos)},"!+":function(node,tag,id,classes,attributes,pseudos){while(node=node.previousSibling)if(node.nodeType==1){this.push(node,tag,id,classes,attributes,pseudos);break}},"!^":function(node,tag,id,classes,attributes,pseudos){node=node.lastChild;if(node){if(node.nodeType==1)this.push(node,tag,id,classes,attributes,pseudos);else this["combinator:!+"](node,tag,id,classes,attributes,pseudos)}},"!~":function(node,tag,id,classes,attributes,pseudos){while(node=node.previousSibling){if(node.nodeType!=1)continue;var uid=this.getUID(node);if(this.bitUniques[uid])break;this.bitUniques[uid]=true;this.push(node,tag,id,classes,attributes,pseudos)}}};for(var c in combinators)local["combinator:"+c]=combinators[c];var pseudos={empty:function(node){var child=node.firstChild;return!(child&&child.nodeType==1)&&!(node.innerText||node.textContent||"").length},not:function(node,expression){return!this.matchNode(node,expression)},contains:function(node,text){return(node.innerText||node.textContent||"").indexOf(text)>-1},"first-child":function(node){while(node=node.previousSibling)if(node.nodeType==1)return false;return true},"last-child":function(node){while(node=node.nextSibling)if(node.nodeType==1)return false;return true},"only-child":function(node){var prev=node;while(prev=prev.previousSibling)if(prev.nodeType==1)return false;var next=node;while(next=next.nextSibling)if(next.nodeType==1)return false;return true},"nth-child":local.createNTHPseudo("firstChild","nextSibling","posNTH"),"nth-last-child":local.createNTHPseudo("lastChild","previousSibling","posNTHLast"),"nth-of-type":local.createNTHPseudo("firstChild","nextSibling","posNTHType",true),"nth-last-of-type":local.createNTHPseudo("lastChild","previousSibling","posNTHTypeLast",true),index:function(node,index){return this["pseudo:nth-child"](node,""+(index+1))},even:function(node){return this["pseudo:nth-child"](node,"2n")},odd:function(node){return this["pseudo:nth-child"](node,"2n+1")},"first-of-type":function(node){var nodeName=node.nodeName;while(node=node.previousSibling)if(node.nodeName==nodeName)return false;return true},"last-of-type":function(node){var nodeName=node.nodeName;while(node=node.nextSibling)if(node.nodeName==nodeName)return false;return true},"only-of-type":function(node){var prev=node,nodeName=node.nodeName;while(prev=prev.previousSibling)if(prev.nodeName==nodeName)return false;var next=node;while(next=next.nextSibling)if(next.nodeName==nodeName)return false;return true},enabled:function(node){return!node.disabled},disabled:function(node){return node.disabled},checked:function(node){return node.checked||node.selected},focus:function(node){return this.isHTMLDocument&&this.document.activeElement===node&&(node.href||node.type||this.hasAttribute(node,"tabindex"))},root:function(node){return node===this.root},selected:function(node){return node.selected}};for(var p in pseudos)local["pseudo:"+p]=pseudos[p];var attributeGetters=local.attributeGetters={"for":function(){return"htmlFor"in this?this.htmlFor:this.getAttribute("for")},href:function(){return"href"in this?this.getAttribute("href",2):this.getAttribute("href")},style:function(){return this.style?this.style.cssText:this.getAttribute("style")},tabindex:function(){var attributeNode=this.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?attributeNode.nodeValue:null},type:function(){return this.getAttribute("type")},maxlength:function(){var attributeNode=this.getAttributeNode("maxLength");return attributeNode&&attributeNode.specified?attributeNode.nodeValue:null}};attributeGetters.MAXLENGTH=attributeGetters.maxLength=attributeGetters.maxlength;var Slick=local.Slick=this.Slick||{};Slick.version="1.1.7";Slick.search=function(context,expression,append){return local.search(context,expression,append)};Slick.find=function(context,expression){return local.search(context,expression,null,true)};Slick.contains=function(container,node){local.setDocument(container);return local.contains(container,node)};Slick.getAttribute=function(node,name){local.setDocument(node);return local.getAttribute(node,name)};Slick.hasAttribute=function(node,name){local.setDocument(node);return local.hasAttribute(node,name)};Slick.match=function(node,selector){if(!(node&&selector))return false;if(!selector||selector===node)return true;local.setDocument(node);return local.matchNode(node,selector)};Slick.defineAttributeGetter=function(name,fn){local.attributeGetters[name]=fn;return this};Slick.lookupAttributeGetter=function(name){return local.attributeGetters[name]};Slick.definePseudo=function(name,fn){local["pseudo:"+name]=function(node,argument){return fn.call(node,argument)};return this};Slick.lookupPseudo=function(name){var pseudo=local["pseudo:"+name];if(pseudo)return function(argument){return pseudo.call(this,argument)};return null};Slick.override=function(regexp,fn){local.override(regexp,fn);return this};Slick.isXML=local.isXML;Slick.uidOf=function(node){return local.getUIDHTML(node)};if(!this.Slick)this.Slick=Slick}).apply(typeof exports!="undefined"?exports:this);var Element=function(tag,props){var konstructor=Element.Constructors[tag];if(konstructor)return konstructor(props);if(typeof tag!="string")return document.id(tag).set(props);if(!props)props={};if(!/^[\w-]+$/.test(tag)){var parsed=Slick.parse(tag).expressions[0][0];tag=parsed.tag=="*"?"div":parsed.tag;if(parsed.id&&props.id==null)props.id=parsed.id;var attributes=parsed.attributes;if(attributes)for(var attr,i=0,l=attributes.length;i<l;i++){attr=attributes[i];if(props[attr.key]!=null)continue;if(attr.value!=null&&attr.operator=="=")props[attr.key]=attr.value;else if(!attr.value&&!attr.operator)props[attr.key]=true}if(parsed.classList&&props["class"]==null)props["class"]=parsed.classList.join(" ")}return document.newElement(tag,props)};if(Browser.Element){Element.prototype=Browser.Element.prototype;Element.prototype._fireEvent=function(fireEvent){return function(type,event){return fireEvent.call(this,type,event)}}(Element.prototype.fireEvent)}new Type("Element",Element).mirror(function(name){if(Array.prototype[name])return;var obj={};obj[name]=function(){var results=[],args=arguments,elements=true;for(var i=0,l=this.length;i<l;i++){var element=this[i],result=results[i]=element[name].apply(element,args);elements=elements&&typeOf(result)=="element"}return elements?new Elements(results):results};Elements.implement(obj)});if(!Browser.Element){Element.parent=Object;Element.Prototype={$constructor:Element,$family:Function.from("element").hide()};Element.mirror(function(name,method){Element.Prototype[name]=method})}Element.Constructors={};var IFrame=new Type("IFrame",function(){var params=Array.link(arguments,{properties:Type.isObject,iframe:function(obj){return obj!=null}});var props=params.properties||{},iframe;if(params.iframe)iframe=document.id(params.iframe);var onload=props.onload||function(){};delete props.onload;props.id=props.name=[props.id,props.name,iframe?iframe.id||iframe.name:"IFrame_"+String.uniqueID()].pick();iframe=new Element(iframe||"iframe",props);var onLoad=function(){onload.call(iframe.contentWindow)};if(window.frames[props.id])onLoad();else iframe.addListener("load",onLoad);return iframe});var Elements=this.Elements=function(nodes){if(nodes&&nodes.length){var uniques={},node;for(var i=0;node=nodes[i++];){var uid=Slick.uidOf(node);if(!uniques[uid]){uniques[uid]=true;this.push(node)}}}};Elements.prototype={length:0};Elements.parent=Array;new Type("Elements",Elements).implement({filter:function(filter,bind){if(!filter)return this;return new Elements(Array.filter(this,typeOf(filter)=="string"?function(item){return item.match(filter)}:filter,bind))}.protect(),push:function(){var length=this.length;for(var i=0,l=arguments.length;i<l;i++){var item=document.id(arguments[i]);if(item)this[length++]=item}return this.length=length}.protect(),unshift:function(){var items=[];for(var i=0,l=arguments.length;i<l;i++){var item=document.id(arguments[i]);if(item)items.push(item)}return Array.prototype.unshift.apply(this,items)}.protect(),concat:function(){var newElements=new Elements(this);for(var i=0,l=arguments.length;i<l;i++){var item=arguments[i];if(Type.isEnumerable(item))newElements.append(item);else newElements.push(item)}return newElements}.protect(),append:function(collection){for(var i=0,l=collection.length;i<l;i++)this.push(collection[i]);return this}.protect(),empty:function(){while(this.length)delete this[--this.length];return this}.protect()});(function(){var splice=Array.prototype.splice,object={0:0,1:1,length:2};splice.call(object,1,1);if(object[1]==1)Elements.implement("splice",function(){var length=this.length;var result=splice.apply(this,arguments);while(length>=this.length)delete this[length--];return result}.protect());Array.forEachMethod(function(method,name){Elements.implement(name,method)});Array.mirror(Elements);var createElementAcceptsHTML;try{createElementAcceptsHTML=document.createElement("<input name=x>").name=="x"}catch(e){}var escapeQuotes=function(html){return(""+html).replace(/&/g,"&amp;").replace(/"/g,"&quot;")};Document.implement({newElement:function(tag,props){if(props&&props.checked!=null)props.defaultChecked=props.checked;if(createElementAcceptsHTML&&props){tag="<"+tag;if(props.name)tag+=' name="'+escapeQuotes(props.name)+'"';if(props.type)tag+=' type="'+escapeQuotes(props.type)+'"';tag+=">";delete props.name;delete props.type}return this.id(this.createElement(tag)).set(props)}})})();(function(){Slick.uidOf(window);Slick.uidOf(document);Document.implement({newTextNode:function(text){return this.createTextNode(text)},getDocument:function(){return this},getWindow:function(){return this.window},id:function(){var types={string:function(id,nocash,doc){id=Slick.find(doc,"#"+id.replace(/(\W)/g,"\\$1"));return id?types.element(id,nocash):null},element:function(el,nocash){Slick.uidOf(el);if(!nocash&&!el.$family&&!/^(?:object|embed)$/i.test(el.tagName)){var fireEvent=el.fireEvent;el._fireEvent=function(type,event){return fireEvent(type,event)};Object.append(el,Element.Prototype)}return el},object:function(obj,nocash,doc){if(obj.toElement)return types.element(obj.toElement(doc),nocash);return null}};types.textnode=types.whitespace=types.window=types.document=function(zero){return zero};return function(el,nocash,doc){if(el&&el.$family&&el.uniqueNumber)return el;var type=typeOf(el);return types[type]?types[type](el,nocash,doc||document):null}}()});if(window.$==null)Window.implement("$",function(el,nc){return document.id(el,nc,this.document)});Window.implement({getDocument:function(){return this.document},getWindow:function(){return this}});[Document,Element].invoke("implement",{getElements:function(expression){return Slick.search(this,expression,new Elements)},getElement:function(expression){return document.id(Slick.find(this,expression))}});var contains={contains:function(element){return Slick.contains(this,element)}};if(!document.contains)Document.implement(contains);if(!document.createElement("div").contains)Element.implement(contains);var injectCombinator=function(expression,combinator){if(!expression)return combinator;expression=Object.clone(Slick.parse(expression));var expressions=expression.expressions;for(var i=expressions.length;i--;)expressions[i][0].combinator=combinator;return expression};Object.forEach({getNext:"~",getPrevious:"!~",getParent:"!"},function(combinator,method){Element.implement(method,function(expression){return this.getElement(injectCombinator(expression,combinator))})});Object.forEach({getAllNext:"~",getAllPrevious:"!~",getSiblings:"~~",getChildren:">",getParents:"!"},function(combinator,method){Element.implement(method,function(expression){return this.getElements(injectCombinator(expression,combinator))})});Element.implement({getFirst:function(expression){return document.id(Slick.search(this,injectCombinator(expression,">"))[0])},getLast:function(expression){return document.id(Slick.search(this,injectCombinator(expression,">")).getLast())},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(id){return document.id(Slick.find(this,"#"+(""+id).replace(/(\W)/g,"\\$1")))},match:function(expression){return!expression||Slick.match(this,expression)}});if(window.$$==null)Window.implement("$$",function(selector){if(arguments.length==1){if(typeof selector=="string")return Slick.search(this.document,selector,new Elements);else if(Type.isEnumerable(selector))return new Elements(selector)}return new Elements(arguments)});var inserters={before:function(context,element){var parent=element.parentNode;if(parent)parent.insertBefore(context,element)},after:function(context,element){var parent=element.parentNode;if(parent)parent.insertBefore(context,element.nextSibling)},bottom:function(context,element){element.appendChild(context)},top:function(context,element){element.insertBefore(context,element.firstChild)}};inserters.inside=inserters.bottom;var propertyGetters={},propertySetters={};var properties={};Array.forEach(["type","value","defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","rowSpan","tabIndex","useMap"],function(property){properties[property.toLowerCase()]=property});properties.html="innerHTML";properties.text=document.createElement("div").textContent==null?"innerText":"textContent";Object.forEach(properties,function(real,key){propertySetters[key]=function(node,value){node[real]=value};propertyGetters[key]=function(node){return node[real]}});var bools=["compact","nowrap","ismap","declare","noshade","checked","disabled","readOnly","multiple","selected","noresize","defer","defaultChecked","autofocus","controls","autoplay","loop"];var booleans={};Array.forEach(bools,function(bool){var lower=bool.toLowerCase();booleans[lower]=bool;propertySetters[lower]=function(node,value){node[bool]=!!value};propertyGetters[lower]=function(node){return!!node[bool]}});Object.append(propertySetters,{"class":function(node,value){"className"in node?node.className=value||"":node.setAttribute("class",value)},"for":function(node,value){"htmlFor"in node?node.htmlFor=value:node.setAttribute("for",value)},style:function(node,value){node.style?node.style.cssText=value:node.setAttribute("style",value)},value:function(node,value){node.value=value!=null?value:""}});propertyGetters["class"]=function(node){return"className"in node?node.className||null:node.getAttribute("class")};var el=document.createElement("button");try{el.type="button"}catch(e){}if(el.type!="button")propertySetters.type=function(node,value){node.setAttribute("type",value)};el=null;var input=document.createElement("input");input.value="t";input.type="submit";if(input.value!="t")propertySetters.type=function(node,type){var value=node.value;node.type=type;node.value=value};input=null;var pollutesGetAttribute=function(div){div.random="attribute";return div.getAttribute("random")=="attribute"}(document.createElement("div"));Element.implement({setProperty:function(name,value){var setter=propertySetters[name.toLowerCase()];if(setter){setter(this,value)}else{if(pollutesGetAttribute)var attributeWhiteList=this.retrieve("$attributeWhiteList",{});if(value==null){this.removeAttribute(name);if(pollutesGetAttribute)delete attributeWhiteList[name]}else{this.setAttribute(name,""+value);if(pollutesGetAttribute)attributeWhiteList[name]=true}}return this},setProperties:function(attributes){for(var attribute in attributes)this.setProperty(attribute,attributes[attribute]);return this},getProperty:function(name){var getter=propertyGetters[name.toLowerCase()];if(getter)return getter(this);if(pollutesGetAttribute){var attr=this.getAttributeNode(name),attributeWhiteList=this.retrieve("$attributeWhiteList",{});if(!attr)return null;if(attr.expando&&!attributeWhiteList[name]){var outer=this.outerHTML;if(outer.substr(0,outer.search(/\/?['"]?>(?![^<]*<['"])/)).indexOf(name)<0)return null;attributeWhiteList[name]=true}}var result=Slick.getAttribute(this,name);return!result&&!Slick.hasAttribute(this,name)?null:result},getProperties:function(){var args=Array.from(arguments);return args.map(this.getProperty,this).associate(args)},removeProperty:function(name){return this.setProperty(name,null)},removeProperties:function(){Array.each(arguments,this.removeProperty,this);return this},set:function(prop,value){var property=Element.Properties[prop];property&&property.set?property.set.call(this,value):this.setProperty(prop,value)}.overloadSetter(),get:function(prop){var property=Element.Properties[prop];return property&&property.get?property.get.apply(this):this.getProperty(prop)}.overloadGetter(),erase:function(prop){var property=Element.Properties[prop];property&&property.erase?property.erase.apply(this):this.removeProperty(prop);return this},hasClass:function(className){return this.className.clean().contains(className," ")},addClass:function(className){if(!this.hasClass(className))this.className=(this.className+" "+className).clean();return this},removeClass:function(className){this.className=this.className.replace(new RegExp("(^|\\s)"+className+"(?:\\s|$)"),"$1");return this},toggleClass:function(className,force){if(force==null)force=!this.hasClass(className);return force?this.addClass(className):this.removeClass(className)},adopt:function(){var parent=this,fragment,elements=Array.flatten(arguments),length=elements.length;if(length>1)parent=fragment=document.createDocumentFragment();
for(var i=0;i<length;i++){var element=document.id(elements[i],true);if(element)parent.appendChild(element)}if(fragment)this.appendChild(fragment);return this},appendText:function(text,where){return this.grab(this.getDocument().newTextNode(text),where)},grab:function(el,where){inserters[where||"bottom"](document.id(el,true),this);return this},inject:function(el,where){inserters[where||"bottom"](this,document.id(el,true));return this},replaces:function(el){el=document.id(el,true);el.parentNode.replaceChild(this,el);return this},wraps:function(el,where){el=document.id(el,true);return this.replaces(el).grab(el,where)},getSelected:function(){this.selectedIndex;return new Elements(Array.from(this.options).filter(function(option){return option.selected}))},toQueryString:function(){var queryString=[];this.getElements("input, select, textarea").each(function(el){var type=el.type;if(!el.name||el.disabled||type=="submit"||type=="reset"||type=="file"||type=="image")return;var value=el.get("tag")=="select"?el.getSelected().map(function(opt){return document.id(opt).get("value")}):(type=="radio"||type=="checkbox")&&!el.checked?null:el.get("value");Array.from(value).each(function(val){if(typeof val!="undefined")queryString.push(encodeURIComponent(el.name)+"="+encodeURIComponent(val))})});return queryString.join("&")}});var collected={},storage={};var get=function(uid){return storage[uid]||(storage[uid]={})};var clean=function(item){var uid=item.uniqueNumber;if(item.removeEvents)item.removeEvents();if(item.clearAttributes)item.clearAttributes();if(uid!=null){delete collected[uid];delete storage[uid]}return item};var formProps={input:"checked",option:"selected",textarea:"value"};Element.implement({destroy:function(){var children=clean(this).getElementsByTagName("*");Array.each(children,clean);Element.dispose(this);return null},empty:function(){Array.from(this.childNodes).each(Element.dispose);return this},dispose:function(){return this.parentNode?this.parentNode.removeChild(this):this},clone:function(contents,keepid){contents=contents!==false;var clone=this.cloneNode(contents),ce=[clone],te=[this],i;if(contents){ce.append(Array.from(clone.getElementsByTagName("*")));te.append(Array.from(this.getElementsByTagName("*")))}for(i=ce.length;i--;){var node=ce[i],element=te[i];if(!keepid)node.removeAttribute("id");if(node.clearAttributes){node.clearAttributes();node.mergeAttributes(element);node.removeAttribute("uniqueNumber");if(node.options){var no=node.options,eo=element.options;for(var j=no.length;j--;)no[j].selected=eo[j].selected}}var prop=formProps[element.tagName.toLowerCase()];if(prop&&element[prop])node[prop]=element[prop]}if(Browser.ie){var co=clone.getElementsByTagName("object"),to=this.getElementsByTagName("object");for(i=co.length;i--;)co[i].outerHTML=to[i].outerHTML}return document.id(clone)}});[Element,Window,Document].invoke("implement",{addListener:function(type,fn){if(type=="unload"){var old=fn,self=this;fn=function(){self.removeListener("unload",fn);old()}}else{collected[Slick.uidOf(this)]=this}if(this.addEventListener)this.addEventListener(type,fn,!!arguments[2]);else this.attachEvent("on"+type,fn);return this},removeListener:function(type,fn){if(this.removeEventListener)this.removeEventListener(type,fn,!!arguments[2]);else this.detachEvent("on"+type,fn);return this},retrieve:function(property,dflt){var storage=get(Slick.uidOf(this)),prop=storage[property];if(dflt!=null&&prop==null)prop=storage[property]=dflt;return prop!=null?prop:null},store:function(property,value){var storage=get(Slick.uidOf(this));storage[property]=value;return this},eliminate:function(property){var storage=get(Slick.uidOf(this));delete storage[property];return this}});if(window.attachEvent&&!window.addEventListener)window.addListener("unload",function(){Object.each(collected,clean);if(window.CollectGarbage)CollectGarbage()});Element.Properties={};Element.Properties.style={set:function(style){this.style.cssText=style},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}};Element.Properties.html={set:function(html){if(html==null)html="";else if(typeOf(html)=="array")html=html.join("");this.innerHTML=html},erase:function(){this.innerHTML=""}};var div=document.createElement("div");div.innerHTML="<nav></nav>";var supportsHTML5Elements=div.childNodes.length==1;if(!supportsHTML5Elements){var tags="abbr article aside audio canvas datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video".split(" "),fragment=document.createDocumentFragment(),l=tags.length;while(l--)fragment.createElement(tags[l])}div=null;var supportsTableInnerHTML=Function.attempt(function(){var table=document.createElement("table");table.innerHTML="<tr><td></td></tr>";return true});var tr=document.createElement("tr"),html="<td></td>";tr.innerHTML=html;var supportsTRInnerHTML=tr.innerHTML==html;tr=null;if(!supportsTableInnerHTML||!supportsTRInnerHTML||!supportsHTML5Elements){Element.Properties.html.set=function(set){var translations={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};translations.thead=translations.tfoot=translations.tbody;return function(html){var wrap=translations[this.get("tag")];if(!wrap&&!supportsHTML5Elements)wrap=[0,"",""];if(!wrap)return set.call(this,html);var level=wrap[0],wrapper=document.createElement("div"),target=wrapper;if(!supportsHTML5Elements)fragment.appendChild(wrapper);wrapper.innerHTML=[wrap[1],html,wrap[2]].flatten().join("");while(level--)target=target.firstChild;this.empty().adopt(target.childNodes);if(!supportsHTML5Elements)fragment.removeChild(wrapper);wrapper=null}}(Element.Properties.html.set)}var testForm=document.createElement("form");testForm.innerHTML="<select><option>s</option></select>";if(testForm.firstChild.value!="s")Element.Properties.value={set:function(value){var tag=this.get("tag");if(tag!="select")return this.setProperty("value",value);var options=this.getElements("option");for(var i=0;i<options.length;i++){var option=options[i],attr=option.getAttributeNode("value"),optionValue=attr&&attr.specified?option.value:option.get("text");if(optionValue==value)return option.selected=true}},get:function(){var option=this,tag=option.get("tag");if(tag!="select"&&tag!="option")return this.getProperty("value");if(tag=="select"&&!(option=option.getSelected()[0]))return"";var attr=option.getAttributeNode("value");return attr&&attr.specified?option.value:option.get("text")}};testForm=null;if(document.createElement("div").getAttributeNode("id"))Element.Properties.id={set:function(id){this.id=this.getAttributeNode("id").value=id},get:function(){return this.id||null},erase:function(){this.id=this.getAttributeNode("id").value=""}}})();(function(){var html=document.html;var el=document.createElement("div");el.style.color="red";el.style.color=null;var doesNotRemoveStyles=el.style.color=="red";el=null;Element.Properties.styles={set:function(styles){this.setStyles(styles)}};var hasOpacity=html.style.opacity!=null,hasFilter=html.style.filter!=null,reAlpha=/alpha\(opacity=([\d.]+)\)/i;var setVisibility=function(element,opacity){element.store("$opacity",opacity);element.style.visibility=opacity>0||opacity==null?"visible":"hidden"};var setOpacity=hasOpacity?function(element,opacity){element.style.opacity=opacity}:hasFilter?function(element,opacity){var style=element.style;if(!element.currentStyle||!element.currentStyle.hasLayout)style.zoom=1;if(opacity==null||opacity==1)opacity="";else opacity="alpha(opacity="+(opacity*100).limit(0,100).round()+")";var filter=style.filter||element.getComputedStyle("filter")||"";style.filter=reAlpha.test(filter)?filter.replace(reAlpha,opacity):filter+opacity;if(!style.filter)style.removeAttribute("filter")}:setVisibility;var getOpacity=hasOpacity?function(element){var opacity=element.style.opacity||element.getComputedStyle("opacity");return opacity==""?1:opacity.toFloat()}:hasFilter?function(element){var filter=element.style.filter||element.getComputedStyle("filter"),opacity;if(filter)opacity=filter.match(reAlpha);return opacity==null||filter==null?1:opacity[1]/100}:function(element){var opacity=element.retrieve("$opacity");if(opacity==null)opacity=element.style.visibility=="hidden"?0:1;return opacity};var floatName=html.style.cssFloat==null?"styleFloat":"cssFloat";Element.implement({getComputedStyle:function(property){if(this.currentStyle)return this.currentStyle[property.camelCase()];var defaultView=Element.getDocument(this).defaultView,computed=defaultView?defaultView.getComputedStyle(this,null):null;return computed?computed.getPropertyValue(property==floatName?"float":property.hyphenate()):null},setStyle:function(property,value){if(property=="opacity"){if(value!=null)value=parseFloat(value);setOpacity(this,value);return this}property=(property=="float"?floatName:property).camelCase();if(typeOf(value)!="string"){var map=(Element.Styles[property]||"@").split(" ");value=Array.from(value).map(function(val,i){if(!map[i])return"";return typeOf(val)=="number"?map[i].replace("@",Math.round(val)):val}).join(" ")}else if(value==String(Number(value))){value=Math.round(value)}this.style[property]=value;if((value==""||value==null)&&doesNotRemoveStyles&&this.style.removeAttribute){this.style.removeAttribute(property)}return this},getStyle:function(property){if(property=="opacity")return getOpacity(this);property=(property=="float"?floatName:property).camelCase();var result=this.style[property];if(!result||property=="zIndex"){result=[];for(var style in Element.ShortStyles){if(property!=style)continue;for(var s in Element.ShortStyles[style])result.push(this.getStyle(s));return result.join(" ")}result=this.getComputedStyle(property)}if(result){result=String(result);var color=result.match(/rgba?\([\d\s,]+\)/);if(color)result=result.replace(color[0],color[0].rgbToHex())}if(Browser.opera||Browser.ie){if(/^(height|width)$/.test(property)&&!/px$/.test(result)){var values=property=="width"?["left","right"]:["top","bottom"],size=0;values.each(function(value){size+=this.getStyle("border-"+value+"-width").toInt()+this.getStyle("padding-"+value).toInt()},this);return this["offset"+property.capitalize()]-size+"px"}if(Browser.ie&&/^border(.+)Width|margin|padding/.test(property)&&isNaN(parseFloat(result))){return"0px"}}return result},setStyles:function(styles){for(var style in styles)this.setStyle(style,styles[style]);return this},getStyles:function(){var result={};Array.flatten(arguments).each(function(key){result[key]=this.getStyle(key)},this);return result}});Element.Styles={left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@"};Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};["Top","Right","Bottom","Left"].each(function(direction){var Short=Element.ShortStyles;var All=Element.Styles;["margin","padding"].each(function(style){var sd=style+direction;Short[style][sd]=All[sd]="@px"});var bd="border"+direction;Short.border[bd]=All[bd]="@px @ rgb(@, @, @)";var bdw=bd+"Width",bds=bd+"Style",bdc=bd+"Color";Short[bd]={};Short.borderWidth[bdw]=Short[bd][bdw]=All[bdw]="@px";Short.borderStyle[bds]=Short[bd][bds]=All[bds]="@";Short.borderColor[bdc]=Short[bd][bdc]=All[bdc]="rgb(@, @, @)"})})();(function(){Element.Properties.events={set:function(events){this.addEvents(events)}};[Element,Window,Document].invoke("implement",{addEvent:function(type,fn){var events=this.retrieve("events",{});if(!events[type])events[type]={keys:[],values:[]};if(events[type].keys.contains(fn))return this;events[type].keys.push(fn);var realType=type,custom=Element.Events[type],condition=fn,self=this;if(custom){if(custom.onAdd)custom.onAdd.call(this,fn,type);if(custom.condition){condition=function(event){if(custom.condition.call(this,event,type))return fn.call(this,event);return true}}if(custom.base)realType=Function.from(custom.base).call(this,type)}var defn=function(){return fn.call(self)};var nativeEvent=Element.NativeEvents[realType];if(nativeEvent){if(nativeEvent==2){defn=function(event){event=new DOMEvent(event,self.getWindow());if(condition.call(self,event)===false)event.stop()}}this.addListener(realType,defn,arguments[2])}events[type].values.push(defn);return this},removeEvent:function(type,fn){var events=this.retrieve("events");if(!events||!events[type])return this;var list=events[type];var index=list.keys.indexOf(fn);if(index==-1)return this;var value=list.values[index];delete list.keys[index];delete list.values[index];var custom=Element.Events[type];if(custom){if(custom.onRemove)custom.onRemove.call(this,fn,type);if(custom.base)type=Function.from(custom.base).call(this,type)}return Element.NativeEvents[type]?this.removeListener(type,value,arguments[2]):this},addEvents:function(events){for(var event in events)this.addEvent(event,events[event]);return this},removeEvents:function(events){var type;if(typeOf(events)=="object"){for(type in events)this.removeEvent(type,events[type]);return this}var attached=this.retrieve("events");if(!attached)return this;if(!events){for(type in attached)this.removeEvents(type);this.eliminate("events")}else if(attached[events]){attached[events].keys.each(function(fn){this.removeEvent(events,fn)},this);delete attached[events]}return this},fireEvent:function(type,args,delay){var events=this.retrieve("events");if(!events||!events[type])return this;args=Array.from(args);events[type].keys.each(function(fn){if(delay)fn.delay(delay,this,args);else fn.apply(this,args)},this);return this},cloneEvents:function(from,type){from=document.id(from);var events=from.retrieve("events");if(!events)return this;if(!type){for(var eventType in events)this.cloneEvents(from,eventType)}else if(events[type]){events[type].keys.each(function(fn){this.addEvent(type,fn)},this)}return this}});Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,orientationchange:2,touchstart:2,touchmove:2,touchend:2,touchcancel:2,gesturestart:2,gesturechange:2,gestureend:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,paste:2,input:2,load:2,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1};Element.Events={mousewheel:{base:Browser.firefox?"DOMMouseScroll":"mousewheel"}};if("onmouseenter"in document.documentElement){Element.NativeEvents.mouseenter=Element.NativeEvents.mouseleave=2}else{var check=function(event){var related=event.relatedTarget;if(related==null)return true;if(!related)return false;return related!=this&&related.prefix!="xul"&&typeOf(this)!="document"&&!this.contains(related)};Element.Events.mouseenter={base:"mouseover",condition:check};Element.Events.mouseleave={base:"mouseout",condition:check}}if(!window.addEventListener){Element.NativeEvents.propertychange=2;Element.Events.change={base:function(){var type=this.type;return this.get("tag")=="input"&&(type=="radio"||type=="checkbox")?"propertychange":"change"},condition:function(event){return this.type!="radio"||event.event.propertyName=="checked"&&this.checked}}}})();(function(){var eventListenerSupport=!!window.addEventListener;Element.NativeEvents.focusin=Element.NativeEvents.focusout=2;var bubbleUp=function(self,match,fn,event,target){while(target&&target!=self){if(match(target,event))return fn.call(target,event,target);target=document.id(target.parentNode)}};var map={mouseenter:{base:"mouseover"},mouseleave:{base:"mouseout"},focus:{base:"focus"+(eventListenerSupport?"":"in"),capture:true},blur:{base:eventListenerSupport?"blur":"focusout",capture:true}};var _key="$delegation:";var formObserver=function(type){return{base:"focusin",remove:function(self,uid){var list=self.retrieve(_key+type+"listeners",{})[uid];if(list&&list.forms)for(var i=list.forms.length;i--;){list.forms[i].removeEvent(type,list.fns[i])}},listen:function(self,match,fn,event,target,uid){var form=target.get("tag")=="form"?target:event.target.getParent("form");if(!form)return;var listeners=self.retrieve(_key+type+"listeners",{}),listener=listeners[uid]||{forms:[],fns:[]},forms=listener.forms,fns=listener.fns;if(forms.indexOf(form)!=-1)return;forms.push(form);var _fn=function(event){bubbleUp(self,match,fn,event,target)};form.addEvent(type,_fn);fns.push(_fn);listeners[uid]=listener;self.store(_key+type+"listeners",listeners)}}};var inputObserver=function(type){return{base:"focusin",listen:function(self,match,fn,event,target){var events={blur:function(){this.removeEvents(events)}};events[type]=function(event){bubbleUp(self,match,fn,event,target)};event.target.addEvents(events)}}};if(!eventListenerSupport)Object.append(map,{submit:formObserver("submit"),reset:formObserver("reset"),change:inputObserver("change"),select:inputObserver("select")});var proto=Element.prototype,addEvent=proto.addEvent,removeEvent=proto.removeEvent;var relay=function(old,method){return function(type,fn,useCapture){if(type.indexOf(":relay")==-1)return old.call(this,type,fn,useCapture);var parsed=Slick.parse(type).expressions[0][0];if(parsed.pseudos[0].key!="relay")return old.call(this,type,fn,useCapture);var newType=parsed.tag;parsed.pseudos.slice(1).each(function(pseudo){newType+=":"+pseudo.key+(pseudo.value?"("+pseudo.value+")":"")});old.call(this,type,fn);return method.call(this,newType,parsed.pseudos[0].value,fn)}};var delegation={addEvent:function(type,match,fn){var storage=this.retrieve("$delegates",{}),stored=storage[type];if(stored)for(var _uid in stored){if(stored[_uid].fn==fn&&stored[_uid].match==match)return this}var _type=type,_match=match,_fn=fn,_map=map[type]||{};type=_map.base||_type;match=function(target){return Slick.match(target,_match)};var elementEvent=Element.Events[_type];if(elementEvent&&elementEvent.condition){var __match=match,condition=elementEvent.condition;match=function(target,event){return __match(target,event)&&condition.call(target,event,type)}}var self=this,uid=String.uniqueID();var delegator=_map.listen?function(event,target){if(!target&&event&&event.target)target=event.target;if(target)_map.listen(self,match,fn,event,target,uid)}:function(event,target){if(!target&&event&&event.target)target=event.target;if(target)bubbleUp(self,match,fn,event,target)};if(!stored)stored={};stored[uid]={match:_match,fn:_fn,delegator:delegator};storage[_type]=stored;return addEvent.call(this,type,delegator,_map.capture)},removeEvent:function(type,match,fn,_uid){var storage=this.retrieve("$delegates",{}),stored=storage[type];if(!stored)return this;if(_uid){var _type=type,delegator=stored[_uid].delegator,_map=map[type]||{};type=_map.base||_type;if(_map.remove)_map.remove(this,_uid);delete stored[_uid];storage[_type]=stored;return removeEvent.call(this,type,delegator)}var __uid,s;if(fn)for(__uid in stored){s=stored[__uid];if(s.match==match&&s.fn==fn)return delegation.removeEvent.call(this,type,match,fn,__uid)}else for(__uid in stored){s=stored[__uid];if(s.match==match)delegation.removeEvent.call(this,type,match,s.fn,__uid)}return this}};[Element,Window,Document].invoke("implement",{addEvent:relay(addEvent,delegation.addEvent),removeEvent:relay(removeEvent,delegation.removeEvent)})})();(function(){var element=document.createElement("div"),child=document.createElement("div");element.style.height="0";element.appendChild(child);var brokenOffsetParent=child.offsetParent===element;element=child=null;var isOffset=function(el){return styleString(el,"position")!="static"||isBody(el)};var isOffsetStatic=function(el){return isOffset(el)||/^(?:table|td|th)$/i.test(el.tagName)};Element.implement({scrollTo:function(x,y){try{if(isBody(this)){this.getWindow().scrollTo(x,y)}else{this.scrollLeft=x;this.scrollTop=y}}catch(x){}return this},getSize:function(){if(isBody(this))return this.getWindow().getSize();return{x:this.offsetWidth,y:this.offsetHeight}},getScrollSize:function(){if(isBody(this))return this.getWindow().getScrollSize();return{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){if(isBody(this))return this.getWindow().getScroll();return{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){var element=this.parentNode,position={x:0,y:0};while(element&&!isBody(element)){position.x+=element.scrollLeft;position.y+=element.scrollTop;element=element.parentNode}return position},getOffsetParent:brokenOffsetParent?function(){var element=this;if(isBody(element)||styleString(element,"position")=="fixed")return null;var isOffsetCheck=styleString(element,"position")=="static"?isOffsetStatic:isOffset;while(element=element.parentNode){if(isOffsetCheck(element))return element}return null}:function(){var element=this;if(isBody(element)||styleString(element,"position")=="fixed")return null;try{return element.offsetParent}catch(e){}return null},getOffsets:function(){if(this.getBoundingClientRect&&!Browser.Platform.ios){var bound=this.getBoundingClientRect(),html=document.id(this.getDocument().documentElement),htmlScroll=html.getScroll(),elemScrolls=this.getScrolls(),isFixed=styleString(this,"position")=="fixed";return{x:bound.left.toInt()+elemScrolls.x+(isFixed?0:htmlScroll.x)-html.clientLeft,y:bound.top.toInt()+elemScrolls.y+(isFixed?0:htmlScroll.y)-html.clientTop}}var element=this,position={x:0,y:0};if(isBody(this))return position;while(element&&!isBody(element)){position.x+=element.offsetLeft;position.y+=element.offsetTop;if(Browser.firefox){if(!borderBox(element)){position.x+=leftBorder(element);position.y+=topBorder(element)}var parent=element.parentNode;if(parent&&styleString(parent,"overflow")!="visible"){position.x+=leftBorder(parent);position.y+=topBorder(parent)}}else if(element!=this&&Browser.safari){position.x+=leftBorder(element);position.y+=topBorder(element)}element=element.offsetParent}if(Browser.firefox&&!borderBox(this)){position.x-=leftBorder(this);position.y-=topBorder(this)}return position},getPosition:function(relative){var offset=this.getOffsets(),scroll=this.getScrolls();var position={x:offset.x-scroll.x,y:offset.y-scroll.y};if(relative&&(relative=document.id(relative))){var relativePosition=relative.getPosition();return{x:position.x-relativePosition.x-leftBorder(relative),y:position.y-relativePosition.y-topBorder(relative)}}return position},getCoordinates:function(element){if(isBody(this))return this.getWindow().getCoordinates();var position=this.getPosition(element),size=this.getSize();var obj={left:position.x,top:position.y,width:size.x,height:size.y};obj.right=obj.left+obj.width;obj.bottom=obj.top+obj.height;return obj},computePosition:function(obj){return{left:obj.x-styleNumber(this,"margin-left"),top:obj.y-styleNumber(this,"margin-top")}},setPosition:function(obj){return this.setStyles(this.computePosition(obj))}});[Document,Window].invoke("implement",{getSize:function(){var doc=getCompatElement(this);return{x:doc.clientWidth,y:doc.clientHeight}},getScroll:function(){var win=this.getWindow(),doc=getCompatElement(this);return{x:win.pageXOffset||doc.scrollLeft,y:win.pageYOffset||doc.scrollTop}},getScrollSize:function(){var doc=getCompatElement(this),min=this.getSize(),body=this.getDocument().body;return{x:Math.max(doc.scrollWidth,body.scrollWidth,min.x),y:Math.max(doc.scrollHeight,body.scrollHeight,min.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var size=this.getSize();return{top:0,left:0,bottom:size.y,right:size.x,height:size.y,width:size.x}}});var styleString=Element.getComputedStyle;function styleNumber(element,style){return styleString(element,style).toInt()||0}function borderBox(element){return styleString(element,"-moz-box-sizing")=="border-box"}function topBorder(element){return styleNumber(element,"border-top-width")}function leftBorder(element){return styleNumber(element,"border-left-width")}function isBody(element){return/^(?:body|html)$/i.test(element.tagName)}function getCompatElement(element){var doc=element.getDocument();return!doc.compatMode||doc.compatMode=="CSS1Compat"?doc.html:doc.body}})();Element.alias({position:"setPosition"});[Window,Document,Element].invoke("implement",{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}});(function(){var Fx=this.Fx=new Class({Implements:[Chain,Events,Options],options:{fps:60,unit:false,duration:500,frames:null,frameSkip:true,link:"ignore"},initialize:function(options){this.subject=this.subject||this;this.setOptions(options)},getTransition:function(){return function(p){return-(Math.cos(Math.PI*p)-1)/2}},step:function(now){if(this.options.frameSkip){var diff=this.time!=null?now-this.time:0,frames=diff/this.frameInterval;this.time=now;this.frame+=frames}else{this.frame++}if(this.frame<this.frames){var delta=this.transition(this.frame/this.frames);this.set(this.compute(this.from,this.to,delta))}else{this.frame=this.frames;this.set(this.compute(this.from,this.to,1));this.stop()}},set:function(now){return now},compute:function(from,to,delta){return Fx.compute(from,to,delta)},check:function(){if(!this.isRunning())return true;switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));return false}return false},start:function(from,to){if(!this.check(from,to))return this;this.from=from;this.to=to;this.frame=this.options.frameSkip?0:-1;this.time=null;this.transition=this.getTransition();var frames=this.options.frames,fps=this.options.fps,duration=this.options.duration;this.duration=Fx.Durations[duration]||duration.toInt();this.frameInterval=1e3/fps;this.frames=frames||Math.round(this.duration/this.frameInterval);this.fireEvent("start",this.subject);pushInstance.call(this,fps);return this},stop:function(){if(this.isRunning()){this.time=null;pullInstance.call(this,this.options.fps);if(this.frames==this.frame){this.fireEvent("complete",this.subject);if(!this.callChain())this.fireEvent("chainComplete",this.subject)}else{this.fireEvent("stop",this.subject)}}return this},cancel:function(){if(this.isRunning()){this.time=null;pullInstance.call(this,this.options.fps);this.frame=this.frames;this.fireEvent("cancel",this.subject).clearChain()}return this},pause:function(){if(this.isRunning()){this.time=null;pullInstance.call(this,this.options.fps)}return this},resume:function(){if(this.frame<this.frames&&!this.isRunning())pushInstance.call(this,this.options.fps);return this},isRunning:function(){var list=instances[this.options.fps];return list&&list.contains(this)}});Fx.compute=function(from,to,delta){return(to-from)*delta+from};Fx.Durations={"short":250,normal:500,"long":1e3};var instances={},timers={};var loop=function(){var now=Date.now();for(var i=this.length;i--;){var instance=this[i];if(instance)instance.step(now)}};var pushInstance=function(fps){var list=instances[fps]||(instances[fps]=[]);list.push(this);if(!timers[fps])timers[fps]=loop.periodical(Math.round(1e3/fps),list)};var pullInstance=function(fps){var list=instances[fps];if(list){list.erase(this);if(!list.length&&timers[fps]){delete instances[fps];timers[fps]=clearInterval(timers[fps])}}}})();Fx.CSS=new Class({Extends:Fx,prepare:function(element,property,values){values=Array.from(values);var from=values[0],to=values[1];if(to==null){to=from;from=element.getStyle(property);var unit=this.options.unit;if(unit&&from.slice(-unit.length)!=unit&&parseFloat(from)!=0){element.setStyle(property,to+unit);var value=element.getComputedStyle(property);if(!/px$/.test(value)){value=element.style[("pixel-"+property).camelCase()];if(value==null){var left=element.style.left;element.style.left=to+unit;value=element.style.pixelLeft;element.style.left=left}}from=(to||1)/(parseFloat(value)||1)*(parseFloat(from)||0);element.setStyle(property,from+unit)}}return{from:this.parse(from),to:this.parse(to)}},parse:function(value){value=Function.from(value)();value=typeof value=="string"?value.split(" "):Array.from(value);return value.map(function(val){val=String(val);var found=false;Object.each(Fx.CSS.Parsers,function(parser,key){if(found)return;var parsed=parser.parse(val);if(parsed||parsed===0)found={value:parsed,parser:parser}});found=found||{value:val,parser:Fx.CSS.Parsers.String};return found})},compute:function(from,to,delta){var computed=[];Math.min(from.length,to.length).times(function(i){computed.push({value:from[i].parser.compute(from[i].value,to[i].value,delta),parser:from[i].parser})});computed.$family=Function.from("fx:css:value");return computed},serve:function(value,unit){if(typeOf(value)!="fx:css:value")value=this.parse(value);var returned=[];value.each(function(bit){returned=returned.concat(bit.parser.serve(bit.value,unit))});return returned},render:function(element,property,value,unit){element.setStyle(property,this.serve(value,unit))},search:function(selector){if(Fx.CSS.Cache[selector])return Fx.CSS.Cache[selector];var to={},selectorTest=new RegExp("^"+selector.escapeRegExp()+"$");Array.each(document.styleSheets,function(sheet,j){var href=sheet.href;if(href&&href.contains("://")&&!href.contains(document.domain))return;var rules=sheet.rules||sheet.cssRules;Array.each(rules,function(rule,i){if(!rule.style)return;var selectorText=rule.selectorText?rule.selectorText.replace(/^\w+/,function(m){return m.toLowerCase()}):null;if(!selectorText||!selectorTest.test(selectorText))return;Object.each(Element.Styles,function(value,style){if(!rule.style[style]||Element.ShortStyles[style])return;value=String(rule.style[style]);to[style]=/^rgb/.test(value)?value.rgbToHex():value})})});return Fx.CSS.Cache[selector]=to}});Fx.CSS.Cache={};Fx.CSS.Parsers={Color:{parse:function(value){if(value.match(/^#[0-9a-f]{3,6}$/i))return value.hexToRgb(true);return(value=value.match(/(\d+),\s*(\d+),\s*(\d+)/))?[value[1],value[2],value[3]]:false},compute:function(from,to,delta){return from.map(function(value,i){return Math.round(Fx.compute(from[i],to[i],delta))})},serve:function(value){return value.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(value,unit){return unit?value+unit:value}},String:{parse:Function.from(false),compute:function(zero,one){return one},serve:function(zero){return zero}}};Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(element,options){this.element=this.subject=document.id(element);this.parent(options)},set:function(property,now){if(arguments.length==1){now=property;property=this.property||this.options.property}this.render(this.element,property,now,this.options.unit);return this},start:function(property,from,to){if(!this.check(property,from,to))return this;var args=Array.flatten(arguments);this.property=this.options.property||args.shift();var parsed=this.prepare(this.element,this.property,args);return this.parent(parsed.from,parsed.to)}});Element.Properties.tween={set:function(options){this.get("tween").cancel().setOptions(options);return this},get:function(){var tween=this.retrieve("tween");if(!tween){tween=new Fx.Tween(this,{link:"cancel"});this.store("tween",tween)}return tween}};Element.implement({tween:function(property,from,to){this.get("tween").start(property,from,to);return this},fade:function(how){var fade=this.get("tween"),method,args=["opacity"].append(arguments),toggle;
if(args[1]==null)args[1]="toggle";switch(args[1]){case"in":method="start";args[1]=1;break;case"out":method="start";args[1]=0;break;case"show":method="set";args[1]=1;break;case"hide":method="set";args[1]=0;break;case"toggle":var flag=this.retrieve("fade:flag",this.getStyle("opacity")==1);method="start";args[1]=flag?0:1;this.store("fade:flag",!flag);toggle=true;break;default:method="start"}if(!toggle)this.eliminate("fade:flag");fade[method].apply(fade,args);var to=args[args.length-1];if(method=="set"||to!=0)this.setStyle("visibility",to==0?"hidden":"visible");else fade.chain(function(){this.element.setStyle("visibility","hidden");this.callChain()});return this},highlight:function(start,end){if(!end){end=this.retrieve("highlight:original",this.getStyle("background-color"));end=end=="transparent"?"#fff":end}var tween=this.get("tween");tween.start("background-color",start||"#ffff88",end).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));tween.callChain()}.bind(this));return this}});Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(element,options){this.element=this.subject=document.id(element);this.parent(options)},set:function(now){if(typeof now=="string")now=this.search(now);for(var p in now)this.render(this.element,p,now[p],this.options.unit);return this},compute:function(from,to,delta){var now={};for(var p in from)now[p]=this.parent(from[p],to[p],delta);return now},start:function(properties){if(!this.check(properties))return this;if(typeof properties=="string")properties=this.search(properties);var from={},to={};for(var p in properties){var parsed=this.prepare(this.element,p,properties[p]);from[p]=parsed.from;to[p]=parsed.to}return this.parent(from,to)}});Element.Properties.morph={set:function(options){this.get("morph").cancel().setOptions(options);return this},get:function(){var morph=this.retrieve("morph");if(!morph){morph=new Fx.Morph(this,{link:"cancel"});this.store("morph",morph)}return morph}};Element.implement({morph:function(props){this.get("morph").start(props);return this}});Fx.implement({getTransition:function(){var trans=this.options.transition||Fx.Transitions.Sine.easeInOut;if(typeof trans=="string"){var data=trans.split(":");trans=Fx.Transitions;trans=trans[data[0]]||trans[data[0].capitalize()];if(data[1])trans=trans["ease"+data[1].capitalize()+(data[2]?data[2].capitalize():"")]}return trans}});Fx.Transition=function(transition,params){params=Array.from(params);var easeIn=function(pos){return transition(pos,params)};return Object.append(easeIn,{easeIn:easeIn,easeOut:function(pos){return 1-transition(1-pos,params)},easeInOut:function(pos){return(pos<=.5?transition(2*pos,params):2-transition(2*(1-pos),params))/2}})};Fx.Transitions={linear:function(zero){return zero}};Fx.Transitions.extend=function(transitions){for(var transition in transitions)Fx.Transitions[transition]=new Fx.Transition(transitions[transition])};Fx.Transitions.extend({Pow:function(p,x){return Math.pow(p,x&&x[0]||6)},Expo:function(p){return Math.pow(2,8*(p-1))},Circ:function(p){return 1-Math.sin(Math.acos(p))},Sine:function(p){return 1-Math.cos(p*Math.PI/2)},Back:function(p,x){x=x&&x[0]||1.618;return Math.pow(p,2)*((x+1)*p-x)},Bounce:function(p){var value;for(var a=0,b=1;1;a+=b,b/=2){if(p>=(7-4*a)/11){value=b*b-Math.pow((11-6*a-11*p)/4,2);break}}return value},Elastic:function(p,x){return Math.pow(2,10*--p)*Math.cos(20*p*Math.PI*(x&&x[0]||1)/3)}});["Quad","Cubic","Quart","Quint"].each(function(transition,i){Fx.Transitions[transition]=new Fx.Transition(function(p){return Math.pow(p,i+2)})});(function(){var empty=function(){},progressSupport="onprogress"in new Browser.Request;var Request=this.Request=new Class({Implements:[Chain,Events,Options],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:true,format:false,method:"post",link:"ignore",isSuccess:null,emulation:true,urlEncoded:true,encoding:"utf-8",evalScripts:false,evalResponse:false,timeout:0,noCache:false},initialize:function(options){this.xhr=new Browser.Request;this.setOptions(options);this.headers=this.options.headers},onStateChange:function(){var xhr=this.xhr;if(xhr.readyState!=4||!this.running)return;this.running=false;this.status=0;Function.attempt(function(){var status=xhr.status;this.status=status==1223?204:status}.bind(this));xhr.onreadystatechange=empty;if(progressSupport)xhr.onprogress=xhr.onloadstart=empty;clearTimeout(this.timer);this.response={text:this.xhr.responseText||"",xml:this.xhr.responseXML};if(this.options.isSuccess.call(this,this.status))this.success(this.response.text,this.response.xml);else this.failure()},isSuccess:function(){var status=this.status;return status>=200&&status<300},isRunning:function(){return!!this.running},processScripts:function(text){if(this.options.evalResponse||/(ecma|java)script/.test(this.getHeader("Content-type")))return Browser.exec(text);return text.stripScripts(this.options.evalScripts)},success:function(text,xml){this.onSuccess(this.processScripts(text),xml)},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(){this.onFailure()},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr)},loadstart:function(event){this.fireEvent("loadstart",[event,this.xhr])},progress:function(event){this.fireEvent("progress",[event,this.xhr])},timeout:function(){this.fireEvent("timeout",this.xhr)},setHeader:function(name,value){this.headers[name]=value;return this},getHeader:function(name){return Function.attempt(function(){return this.xhr.getResponseHeader(name)}.bind(this))},check:function(){if(!this.running)return true;switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));return false}return false},send:function(options){if(!this.check(options))return this;this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.running=true;var type=typeOf(options);if(type=="string"||type=="element")options={data:options};var old=this.options;options=Object.append({data:old.data,url:old.url,method:old.method},options);var data=options.data,url=String(options.url),method=options.method.toLowerCase();switch(typeOf(data)){case"element":data=document.id(data).toQueryString();break;case"object":case"hash":data=Object.toQueryString(data)}if(this.options.format){var format="format="+this.options.format;data=data?format+"&"+data:format}if(this.options.emulation&&!["get","post"].contains(method)){var _method="_method="+method;data=data?_method+"&"+data:_method;method="post"}if(this.options.urlEncoded&&["post","put"].contains(method)){var encoding=this.options.encoding?"; charset="+this.options.encoding:"";this.headers["Content-type"]="application/x-www-form-urlencoded"+encoding}if(!url)url="//"+document.domain+document.location.pathname;var trimPosition=url.lastIndexOf("/");if(trimPosition>-1&&(trimPosition=url.indexOf("#"))>-1)url=url.substr(0,trimPosition);if(this.options.noCache)url+=(url.contains("?")?"&":"?")+String.uniqueID();if(data&&method=="get"){url+=(url.contains("?")?"&":"?")+data;data=null}var xhr=this.xhr;if(progressSupport){xhr.onloadstart=this.loadstart.bind(this);xhr.onprogress=this.progress.bind(this)}xhr.open(method.toUpperCase(),url,this.options.async,this.options.user,this.options.password);if((this.options.user||this.options.withCredentials)&&"withCredentials"in xhr)xhr.withCredentials=true;xhr.onreadystatechange=this.onStateChange.bind(this);Object.each(this.headers,function(value,key){try{xhr.setRequestHeader(key,value)}catch(e){this.fireEvent("exception",[key,value])}},this);this.fireEvent("request");xhr.send(data);if(!this.options.async)this.onStateChange();else if(this.options.timeout)this.timer=this.timeout.delay(this.options.timeout,this);return this},cancel:function(){if(!this.running)return this;this.running=false;var xhr=this.xhr;xhr.abort();clearTimeout(this.timer);xhr.onreadystatechange=empty;if(progressSupport)xhr.onprogress=xhr.onloadstart=empty;this.xhr=new Browser.Request;this.fireEvent("cancel");return this}});var methods={};["get","post","put","delete","GET","POST","PUT","DELETE"].each(function(method){methods[method]=function(data){var object={method:method};if(data!=null)object.data=data;return this.send(object)}});Request.implement(methods);Element.Properties.send={set:function(options){var send=this.get("send").cancel();send.setOptions(options);return this},get:function(){var send=this.retrieve("send");if(!send){send=new Request({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")});this.store("send",send)}return send}};Element.implement({send:function(url){var sender=this.get("send");sender.send({data:this,url:url||sender.options.url});return this}})})();Request.HTML=new Class({Extends:Request,options:{update:false,append:false,evalScripts:true,filter:false,headers:{Accept:"text/html, application/xml, text/xml, */*"}},success:function(text){var options=this.options,response=this.response;response.html=text.stripScripts(function(script){response.javascript=script});var match=response.html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(match)response.html=match[1];var temp=new Element("div").set("html",response.html);response.tree=temp.childNodes;response.elements=temp.getElements(options.filter||"*");if(options.filter)response.tree=response.elements;if(options.update){var update=document.id(options.update).empty();if(options.filter)update.adopt(response.elements);else update.set("html",response.html)}else if(options.append){var append=document.id(options.append);if(options.filter)response.elements.reverse().inject(append);else append.adopt(temp.getChildren())}if(options.evalScripts)Browser.exec(response.javascript);this.onSuccess(response.tree,response.elements,response.html,response.javascript)}});Element.Properties.load={set:function(options){var load=this.get("load").cancel();load.setOptions(options);return this},get:function(){var load=this.retrieve("load");if(!load){load=new Request.HTML({data:this,link:"cancel",update:this,method:"get"});this.store("load",load)}return load}};Element.implement({load:function(){this.get("load").send(Array.link(arguments,{data:Type.isObject,url:Type.isString}));return this}});if(typeof JSON=="undefined")this.JSON={};(function(){var special={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var escape=function(chr){return special[chr]||"\\u"+("0000"+chr.charCodeAt(0).toString(16)).slice(-4)};JSON.validate=function(string){string=string.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(string)};JSON.encode=JSON.stringify?function(obj){return JSON.stringify(obj)}:function(obj){if(obj&&obj.toJSON)obj=obj.toJSON();switch(typeOf(obj)){case"string":return'"'+obj.replace(/[\x00-\x1f\\"]/g,escape)+'"';case"array":return"["+obj.map(JSON.encode).clean()+"]";case"object":case"hash":var string=[];Object.each(obj,function(value,key){var json=JSON.encode(value);if(json)string.push(JSON.encode(key)+":"+json)});return"{"+string+"}";case"number":case"boolean":return""+obj;case"null":return"null"}return null};JSON.decode=function(string,secure){if(!string||typeOf(string)!="string")return null;if(secure||JSON.secure){if(JSON.parse)return JSON.parse(string);if(!JSON.validate(string))throw new Error("JSON could not decode the input; security is enabled and the value is not secure.")}return eval("("+string+")")}})();Request.JSON=new Class({Extends:Request,options:{secure:true},initialize:function(options){this.parent(options);Object.append(this.headers,{Accept:"application/json","X-Request":"JSON"})},success:function(text){var json;try{json=this.response.json=JSON.decode(text,this.options.secure)}catch(error){this.fireEvent("error",[text,error]);return}if(json==null)this.onFailure();else this.onSuccess(json,text)}});var Cookie=new Class({Implements:Options,options:{path:"/",domain:false,duration:false,secure:false,document:document,encode:true},initialize:function(key,options){this.key=key;this.setOptions(options)},write:function(value){if(this.options.encode)value=encodeURIComponent(value);if(this.options.domain)value+="; domain="+this.options.domain;if(this.options.path)value+="; path="+this.options.path;if(this.options.duration){var date=new Date;date.setTime(date.getTime()+this.options.duration*24*60*60*1e3);value+="; expires="+date.toGMTString()}if(this.options.secure)value+="; secure";this.options.document.cookie=this.key+"="+value;return this},read:function(){var value=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return value?decodeURIComponent(value[1]):null},dispose:function(){new Cookie(this.key,Object.merge({},this.options,{duration:-1})).write("");return this}});Cookie.write=function(key,value,options){return new Cookie(key,options).write(value)};Cookie.read=function(key){return new Cookie(key).read()};Cookie.dispose=function(key,options){return new Cookie(key,options).dispose()};(function(window,document){var ready,loaded,checks=[],shouldPoll,timer,testElement=document.createElement("div");var domready=function(){clearTimeout(timer);if(ready)return;Browser.loaded=ready=true;document.removeListener("DOMContentLoaded",domready).removeListener("readystatechange",check);document.fireEvent("domready");window.fireEvent("domready")};var check=function(){for(var i=checks.length;i--;)if(checks[i]()){domready();return true}return false};var poll=function(){clearTimeout(timer);if(!check())timer=setTimeout(poll,10)};document.addListener("DOMContentLoaded",domready);var doScrollWorks=function(){try{testElement.doScroll();return true}catch(e){}return false};if(testElement.doScroll&&!doScrollWorks()){checks.push(doScrollWorks);shouldPoll=true}if(document.readyState)checks.push(function(){var state=document.readyState;return state=="loaded"||state=="complete"});if("onreadystatechange"in document)document.addListener("readystatechange",check);else shouldPoll=true;if(shouldPoll)poll();Element.Events.domready={onAdd:function(fn){if(ready)fn.call(this)}};Element.Events.load={base:"load",onAdd:function(fn){if(loaded&&this==window)fn.call(this)},condition:function(){if(this==window){domready();delete Element.Events.load}return true}};window.addEvent("load",function(){loaded=true})})(window,document);MooTools.More={version:"1.4.0.1",build:"a4244edf2aa97ac8a196fc96082dd35af1abab87"};(function(){var wait={wait:function(duration){return this.chain(function(){this.callChain.delay(duration==null?500:duration,this);return this}.bind(this))}};Chain.implement(wait);if(this.Fx)Fx.implement(wait);if(this.Element&&Element.implement&&this.Fx){Element.implement({chains:function(effects){Array.from(effects||["tween","morph","reveal"]).each(function(effect){effect=this.get(effect);if(!effect)return;effect.setOptions({link:"chain"})},this);return this},pauseFx:function(duration,effect){this.chains(effect).get(effect||"tween").wait(duration);return this}})}})();(function(nil){Array.implement({min:function(){return Math.min.apply(null,this)},max:function(){return Math.max.apply(null,this)},average:function(){return this.length?this.sum()/this.length:0},sum:function(){var result=0,l=this.length;if(l){while(l--)result+=this[l]}return result},unique:function(){return[].combine(this)},shuffle:function(){for(var i=this.length;i&&--i;){var temp=this[i],r=Math.floor(Math.random()*(i+1));this[i]=this[r];this[r]=temp}return this},reduce:function(fn,value){for(var i=0,l=this.length;i<l;i++){if(i in this)value=value===nil?this[i]:fn.call(null,value,this[i],i,this)}return value},reduceRight:function(fn,value){var i=this.length;while(i--){if(i in this)value=value===nil?this[i]:fn.call(null,value,this[i],i,this)}return value}})})();(function(){var defined=function(value){return value!=null};var hasOwnProperty=Object.prototype.hasOwnProperty;Object.extend({getFromPath:function(source,parts){if(typeof parts=="string")parts=parts.split(".");for(var i=0,l=parts.length;i<l;i++){if(hasOwnProperty.call(source,parts[i]))source=source[parts[i]];else return null}return source},cleanValues:function(object,method){method=method||defined;for(var key in object)if(!method(object[key])){delete object[key]}return object},erase:function(object,key){if(hasOwnProperty.call(object,key))delete object[key];return object},run:function(object){var args=Array.slice(arguments,1);for(var key in object)if(object[key].apply){object[key].apply(object,args)}return object}})})();(function(){var current=null,locales={},inherits={};var getSet=function(set){if(instanceOf(set,Locale.Set))return set;else return locales[set]};var Locale=this.Locale={define:function(locale,set,key,value){var name;if(instanceOf(locale,Locale.Set)){name=locale.name;if(name)locales[name]=locale}else{name=locale;if(!locales[name])locales[name]=new Locale.Set(name);locale=locales[name]}if(set)locale.define(set,key,value);if(!current)current=locale;return locale},use:function(locale){locale=getSet(locale);if(locale){current=locale;this.fireEvent("change",locale)}return this},getCurrent:function(){return current},get:function(key,args){return current?current.get(key,args):""},inherit:function(locale,inherits,set){locale=getSet(locale);if(locale)locale.inherit(inherits,set);return this},list:function(){return Object.keys(locales)}};Object.append(Locale,new Events);Locale.Set=new Class({sets:{},inherits:{locales:[],sets:{}},initialize:function(name){this.name=name||""},define:function(set,key,value){var defineData=this.sets[set];if(!defineData)defineData={};if(key){if(typeOf(key)=="object")defineData=Object.merge(defineData,key);else defineData[key]=value}this.sets[set]=defineData;return this},get:function(key,args,_base){var value=Object.getFromPath(this.sets,key);if(value!=null){var type=typeOf(value);if(type=="function")value=value.apply(null,Array.from(args));else if(type=="object")value=Object.clone(value);return value}var index=key.indexOf("."),set=index<0?key:key.substr(0,index),names=(this.inherits.sets[set]||[]).combine(this.inherits.locales).include("en-US");if(!_base)_base=[];for(var i=0,l=names.length;i<l;i++){if(_base.contains(names[i]))continue;_base.include(names[i]);var locale=locales[names[i]];if(!locale)continue;value=locale.get(key,args,_base);if(value!=null)return value}return""},inherit:function(names,set){names=Array.from(names);if(set&&!this.inherits.sets[set])this.inherits.sets[set]=[];var l=names.length;while(l--)(set?this.inherits.sets[set]:this.inherits.locales).unshift(names[l]);return this}})})();Locale.define("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",firstDayOfWeek:0,ordinal:function(dayOfMonth){return dayOfMonth>3&&dayOfMonth<21?"th":["th","st","nd","rd","th"][Math.min(dayOfMonth%10,4)]},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"});(function(){var Date=this.Date;var DateMethods=Date.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"};["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds","UTCMilliseconds"].each(function(method){Date.Methods[method.toLowerCase()]=method});var pad=function(n,digits,string){if(digits==1)return n;return n<Math.pow(10,digits-1)?(string||"0")+pad(n,digits-1,string):n};Date.implement({set:function(prop,value){prop=prop.toLowerCase();var method=DateMethods[prop]&&"set"+DateMethods[prop];if(method&&this[method])this[method](value);return this}.overloadSetter(),get:function(prop){prop=prop.toLowerCase();var method=DateMethods[prop]&&"get"+DateMethods[prop];if(method&&this[method])return this[method]();return null}.overloadGetter(),clone:function(){return new Date(this.get("time"))},increment:function(interval,times){interval=interval||"day";times=times!=null?times:1;switch(interval){case"year":return this.increment("month",times*12);case"month":var d=this.get("date");this.set("date",1).set("mo",this.get("mo")+times);return this.set("date",d.min(this.get("lastdayofmonth")));case"week":return this.increment("day",times*7);case"day":return this.set("date",this.get("date")+times)}if(!Date.units[interval])throw new Error(interval+" is not a supported interval");return this.set("time",this.get("time")+times*Date.units[interval]())},decrement:function(interval,times){return this.increment(interval,-1*(times!=null?times:1))},isLeapYear:function(){return Date.isLeapYear(this.get("year"))},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0})},diff:function(date,resolution){if(typeOf(date)=="string")date=Date.parse(date);return((date-this)/Date.units[resolution||"day"](3,3)).round()},getLastDayOfMonth:function(){return Date.daysInMonth(this.get("mo"),this.get("year"))},getDayOfYear:function(){return(Date.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-Date.UTC(this.get("year"),0,1))/Date.units.day()},setDay:function(day,firstDayOfWeek){if(firstDayOfWeek==null){firstDayOfWeek=Date.getMsg("firstDayOfWeek");if(firstDayOfWeek==="")firstDayOfWeek=1}day=(7+Date.parseDay(day,true)-firstDayOfWeek)%7;var currentDay=(7+this.get("day")-firstDayOfWeek)%7;return this.increment("day",day-currentDay)},getWeek:function(firstDayOfWeek){if(firstDayOfWeek==null){firstDayOfWeek=Date.getMsg("firstDayOfWeek");if(firstDayOfWeek==="")firstDayOfWeek=1}var date=this,dayOfWeek=(7+date.get("day")-firstDayOfWeek)%7,dividend=0,firstDayOfYear;if(firstDayOfWeek==1){var month=date.get("month"),startOfWeek=date.get("date")-dayOfWeek;if(month==11&&startOfWeek>28)return 1;if(month==0&&startOfWeek<-2){date=new Date(date).decrement("day",dayOfWeek);dayOfWeek=0}firstDayOfYear=new Date(date.get("year"),0,1).get("day")||7;if(firstDayOfYear>4)dividend=-7}else{firstDayOfYear=new Date(date.get("year"),0,1).get("day")}dividend+=date.get("dayofyear");dividend+=6-dayOfWeek;dividend+=(7+firstDayOfYear-firstDayOfWeek)%7;return dividend/7},getOrdinal:function(day){return Date.getMsg("ordinal",day||this.get("date"))},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},getGMTOffset:function(){var off=this.get("timezoneOffset");return(off>0?"-":"+")+pad((off.abs()/60).floor(),2)+pad(off%60,2)},setAMPM:function(ampm){ampm=ampm.toUpperCase();var hr=this.get("hr");if(hr>11&&ampm=="AM")return this.decrement("hour",12);else if(hr<12&&ampm=="PM")return this.increment("hour",12);return this},getAMPM:function(){return this.get("hr")<12?"AM":"PM"},parse:function(str){this.set("time",Date.parse(str));return this},isValid:function(date){if(!date)date=this;return typeOf(date)=="date"&&!isNaN(date.valueOf())},format:function(format){if(!this.isValid())return"invalid date";if(!format)format="%x %X";if(typeof format=="string")format=formats[format.toLowerCase()]||format;if(typeof format=="function")return format(this);var d=this;return format.replace(/%([a-z%])/gi,function($0,$1){switch($1){case"a":return Date.getMsg("days_abbr")[d.get("day")];case"A":return Date.getMsg("days")[d.get("day")];case"b":return Date.getMsg("months_abbr")[d.get("month")];case"B":return Date.getMsg("months")[d.get("month")];case"c":return d.format("%a %b %d %H:%M:%S %Y");case"d":return pad(d.get("date"),2);case"e":return pad(d.get("date"),2," ");case"H":return pad(d.get("hr"),2);case"I":return pad(d.get("hr")%12||12,2);case"j":return pad(d.get("dayofyear"),3);case"k":return pad(d.get("hr"),2," ");case"l":return pad(d.get("hr")%12||12,2," ");case"L":return pad(d.get("ms"),3);case"m":return pad(d.get("mo")+1,2);case"M":return pad(d.get("min"),2);case"o":return d.get("ordinal");case"p":return Date.getMsg(d.get("ampm"));case"s":return Math.round(d/1e3);case"S":return pad(d.get("seconds"),2);case"T":return d.format("%H:%M:%S");case"U":return pad(d.get("week"),2);case"w":return d.get("day");case"x":return d.format(Date.getMsg("shortDate"));case"X":return d.format(Date.getMsg("shortTime"));case"y":return d.get("year").toString().substr(2);case"Y":return d.get("year");case"z":return d.get("GMTOffset");case"Z":return d.get("Timezone")}return $1})},toISOString:function(){return this.format("iso8601")}}).alias({toJSON:"toISOString",compare:"diff",strftime:"format"});var rfcDayAbbr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],rfcMonthAbbr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var formats={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S","short":"%d %b %H:%M","long":"%B %d, %Y %H:%M",rfc822:function(date){return rfcDayAbbr[date.get("day")]+date.format(", %d ")+rfcMonthAbbr[date.get("month")]+date.format(" %Y %H:%M:%S %Z")},rfc2822:function(date){return rfcDayAbbr[date.get("day")]+date.format(", %d ")+rfcMonthAbbr[date.get("month")]+date.format(" %Y %H:%M:%S %z")},iso8601:function(date){return date.getUTCFullYear()+"-"+pad(date.getUTCMonth()+1,2)+"-"+pad(date.getUTCDate(),2)+"T"+pad(date.getUTCHours(),2)+":"+pad(date.getUTCMinutes(),2)+":"+pad(date.getUTCSeconds(),2)+"."+pad(date.getUTCMilliseconds(),3)+"Z"}};var parsePatterns=[],nativeParse=Date.parse;var parseWord=function(type,word,num){var ret=-1,translated=Date.getMsg(type+"s");switch(typeOf(word)){case"object":ret=translated[word.get(type)];break;case"number":ret=translated[word];if(!ret)throw new Error("Invalid "+type+" index: "+word);break;case"string":var match=translated.filter(function(name){return this.test(name)},new RegExp("^"+word,"i"));if(!match.length)throw new Error("Invalid "+type+" string");if(match.length>1)throw new Error("Ambiguous "+type);ret=match[0]}return num?translated.indexOf(ret):ret};var startCentury=1900,startYear=70;Date.extend({getMsg:function(key,args){return Locale.get("Date."+key,args)},units:{ms:Function.from(1),second:Function.from(1e3),minute:Function.from(6e4),hour:Function.from(36e5),day:Function.from(864e5),week:Function.from(6084e5),month:function(month,year){var d=new Date;return Date.daysInMonth(month!=null?month:d.get("mo"),year!=null?year:d.get("year"))*864e5},year:function(year){year=year||(new Date).get("year");return Date.isLeapYear(year)?316224e5:31536e6}},daysInMonth:function(month,year){return[31,Date.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},isLeapYear:function(year){return year%4===0&&year%100!==0||year%400===0},parse:function(from){var t=typeOf(from);if(t=="number")return new Date(from);if(t!="string")return from;from=from.clean();if(!from.length)return null;var parsed;parsePatterns.some(function(pattern){var bits=pattern.re.exec(from);return bits?parsed=pattern.handler(bits):false});if(!(parsed&&parsed.isValid())){parsed=new Date(nativeParse(from));if(!(parsed&&parsed.isValid()))parsed=new Date(from.toInt())}return parsed},parseDay:function(day,num){return parseWord("day",day,num)},parseMonth:function(month,num){return parseWord("month",month,num)},parseUTC:function(value){var localDate=new Date(value);var utcSeconds=Date.UTC(localDate.get("year"),localDate.get("mo"),localDate.get("date"),localDate.get("hr"),localDate.get("min"),localDate.get("sec"),localDate.get("ms"));return new Date(utcSeconds)},orderIndex:function(unit){return Date.getMsg("dateOrder").indexOf(unit)+1},defineFormat:function(name,format){formats[name]=format;return this},defineParser:function(pattern){parsePatterns.push(pattern.re&&pattern.handler?pattern:build(pattern));return this},defineParsers:function(){Array.flatten(arguments).each(Date.defineParser);return this},define2DigitYearStart:function(year){startYear=year%100;startCentury=year-startYear;return this}}).extend({defineFormats:Date.defineFormat.overloadSetter()});var regexOf=function(type){return new RegExp("(?:"+Date.getMsg(type).map(function(name){return name.substr(0,3)}).join("|")+")[a-z]*")};var replacers=function(key){switch(key){case"T":return"%H:%M:%S";case"x":return(Date.orderIndex("month")==1?"%m[-./]%d":"%d[-./]%m")+"([-./]%y)?";case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%z?"}return null};var keys={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,z:/Z|[+-]\d{2}(?::?\d{2})?/};keys.m=keys.I;keys.S=keys.M;var currentLanguage;var recompile=function(language){currentLanguage=language;keys.a=keys.A=regexOf("days");keys.b=keys.B=regexOf("months");parsePatterns.each(function(pattern,i){if(pattern.format)parsePatterns[i]=build(pattern.format)})};var build=function(format){if(!currentLanguage)return{format:format};var parsed=[];var re=(format.source||format).replace(/%([a-z])/gi,function($0,$1){return replacers($1)||$0}).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,function($0,$1){var p=keys[$1];if(!p)return $1;parsed.push($1);return"("+p.source+")"}).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff;&]");return{format:format,re:new RegExp("^"+re+"$","i"),handler:function(bits){bits=bits.slice(1).associate(parsed);var date=(new Date).clearTime(),year=bits.y||bits.Y;if(year!=null)handle.call(date,"y",year);if("d"in bits)handle.call(date,"d",1);if("m"in bits||bits.b||bits.B)handle.call(date,"m",1);for(var key in bits)handle.call(date,key,bits[key]);return date}}};var handle=function(key,value){if(!value)return this;switch(key){case"a":case"A":return this.set("day",Date.parseDay(value,true));case"b":case"B":return this.set("mo",Date.parseMonth(value,true));case"d":return this.set("date",value);case"H":case"I":return this.set("hr",value);case"m":return this.set("mo",value-1);case"M":return this.set("min",value);case"p":return this.set("ampm",value.replace(/\./g,""));case"S":return this.set("sec",value);case"s":return this.set("ms",("0."+value)*1e3);case"w":return this.set("day",value);case"Y":return this.set("year",value);case"y":value=+value;if(value<100)value+=startCentury+(value<startYear?100:0);return this.set("year",value);case"z":if(value=="Z")value="+00";var offset=value.match(/([+-])(\d{2}):?(\d{2})?/);offset=(offset[1]+"1")*(offset[2]*60+(+offset[3]||0))+this.getTimezoneOffset();return this.set("time",this-offset*6e4)}return this};Date.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %z %Y","%T","%H:%M( ?%p)?");Locale.addEvent("change",function(language){if(Locale.get("Date"))recompile(language)}).fireEvent("change",Locale.getCurrent())})();Date.implement({timeDiffInWords:function(to){return Date.distanceOfTimeInWords(this,to||new Date)},timeDiff:function(to,separator){if(to==null)to=new Date;var delta=((to-this)/1e3).floor().abs();
var vals=[],durations=[60,60,24,365,0],names=["s","m","h","d","y"],value,duration;for(var item=0;item<durations.length;item++){if(item&&!delta)break;value=delta;if(duration=durations[item]){value=delta%duration;delta=(delta/duration).floor()}vals.unshift(value+(names[item]||""))}return vals.join(separator||":")}}).extend({distanceOfTimeInWords:function(from,to){return Date.getTimePhrase(((to-from)/1e3).toInt())},getTimePhrase:function(delta){var suffix=delta<0?"Until":"Ago";if(delta<0)delta*=-1;var units={minute:60,hour:60,day:24,week:7,month:52/12,year:12,eon:Infinity};var msg="lessThanMinute";for(var unit in units){var interval=units[unit];if(delta<1.5*interval){if(delta>.75*interval)msg=unit;break}delta/=interval;msg=unit+"s"}delta=delta.round();return Date.getMsg(msg+suffix,delta).substitute({delta:delta})}}).defineParsers({re:/^(?:tod|tom|yes)/i,handler:function(bits){var d=(new Date).clearTime();switch(bits[0]){case"tom":return d.increment();case"yes":return d.decrement();default:return d}}},{re:/^(next|last) ([a-z]+)$/i,handler:function(bits){var d=(new Date).clearTime();var day=d.getDay();var newDay=Date.parseDay(bits[2],true);var addDays=newDay-day;if(newDay<=day)addDays+=7;if(bits[1]=="last")addDays-=7;return d.set("date",d.getDate()+addDays)}}).alias("timeAgoInWords","timeDiffInWords");Locale.define("en-US","Number",{decimal:".",group:",",currency:{prefix:"$"}});Number.implement({format:function(options){var value=this;options=options?Object.clone(options):{};var getOption=function(key){if(options[key]!=null)return options[key];return Locale.get("Number."+key)};var negative=value<0,decimal=getOption("decimal"),precision=getOption("precision"),group=getOption("group"),decimals=getOption("decimals");if(negative){var negativeLocale=getOption("negative")||{};if(negativeLocale.prefix==null&&negativeLocale.suffix==null)negativeLocale.prefix="-";["prefix","suffix"].each(function(key){if(negativeLocale[key])options[key]=getOption(key)+negativeLocale[key]});value=-value}var prefix=getOption("prefix"),suffix=getOption("suffix");if(decimals!==""&&decimals>=0&&decimals<=20)value=value.toFixed(decimals);if(precision>=1&&precision<=21)value=(+value).toPrecision(precision);value+="";var index;if(getOption("scientific")===false&&value.indexOf("e")>-1){var match=value.split("e"),zeros=+match[1];value=match[0].replace(".","");if(zeros<0){zeros=-zeros-1;index=match[0].indexOf(".");if(index>-1)zeros-=index-1;while(zeros--)value="0"+value;value="0."+value}else{index=match[0].lastIndexOf(".");if(index>-1)zeros-=match[0].length-index-1;while(zeros--)value+="0"}}if(decimal!=".")value=value.replace(".",decimal);if(group){index=value.lastIndexOf(decimal);index=index>-1?index:value.length;var newOutput=value.substring(index),i=index;while(i--){if((index-i-1)%3==0&&i!=index-1)newOutput=group+newOutput;newOutput=value.charAt(i)+newOutput}value=newOutput}if(prefix)value=prefix+value;if(suffix)value+=suffix;return value},formatCurrency:function(decimals){var locale=Locale.get("Number.currency")||{};if(locale.scientific==null)locale.scientific=false;locale.decimals=decimals!=null?decimals:locale.decimals==null?2:locale.decimals;return this.format(locale)},formatPercentage:function(decimals){var locale=Locale.get("Number.percentage")||{};if(locale.suffix==null)locale.suffix="%";locale.decimals=decimals!=null?decimals:locale.decimals==null?2:locale.decimals;return this.format(locale)}});String.implement({levenshtein:function(c){var s,l=(s=this.split("")).length,t=(c=c.split("")).length,i,j,m,n;if(!(l||t))return Math.max(l,t);for(var a=[],i=l+1;i;a[--i]=[i]);for(i=t+1;a[0][--i]=i;);for(i=-1,m=s.length;++i<m;)for(j=-1,n=c.length;++j<n;)a[(i*=1)+1][(j*=1)+1]=Math.min(a[i][j+1]+1,a[i+1][j]+1,a[i][j]+(s[i]!=c[j]));return a[l][t]},parseQueryString:function(decodeKeys,decodeValues){if(decodeKeys==null)decodeKeys=true;if(decodeValues==null)decodeValues=true;var vars=this.split(/[&;]/),object={};if(!vars.length)return object;vars.each(function(val){var index=val.indexOf("=")+1,value=index?val.substr(index):"",keys=index?val.substr(0,index-1).match(/([^\]\[]+|(\B)(?=\]))/g):[val],obj=object;if(!keys)return;if(decodeValues)value=decodeURIComponent(value);keys.each(function(key,i){if(decodeKeys)key=decodeURIComponent(key);var current=obj[key];if(i<keys.length-1)obj=obj[key]=current||{};else if(typeOf(current)=="array")current.push(value);else obj[key]=current!=null?[current,value]:value})});return object},cleanQueryString:function(method){return this.split("&").filter(function(val){var index=val.indexOf("="),key=index<0?"":val.substr(0,index),value=val.substr(index+1);return method?method.call(null,key,value):value||value===0}).join("&")}});(function(){var toString=function(){return this.get("value")};var URI=this.URI=new Class({Implements:Options,options:{},regex:/^(?:(\w+):)?(?:\/\/(?:(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)?(\.\.?$|(?:[^?#\/]*\/)*)([^?#]*)(?:\?([^#]*))?(?:#(.*))?/,parts:["scheme","user","password","host","port","directory","file","query","fragment"],schemes:{http:80,https:443,ftp:21,rtsp:554,mms:1755,file:0},initialize:function(uri,options){this.setOptions(options);var base=this.options.base||URI.base;if(!uri)uri=base;if(uri&&uri.parsed)this.parsed=Object.clone(uri.parsed);else this.set("value",uri.href||uri.toString(),base?new URI(base):false)},parse:function(value,base){var bits=value.match(this.regex);if(!bits)return false;bits.shift();return this.merge(bits.associate(this.parts),base)},merge:function(bits,base){if((!bits||!bits.scheme)&&(!base||!base.scheme))return false;if(base){this.parts.every(function(part){if(bits[part])return false;bits[part]=base[part]||"";return true})}bits.port=bits.port||this.schemes[bits.scheme.toLowerCase()];bits.directory=bits.directory?this.parseDirectory(bits.directory,base?base.directory:""):"/";return bits},parseDirectory:function(directory,baseDirectory){directory=(directory.substr(0,1)=="/"?"":baseDirectory||"/")+directory;if(!directory.test(URI.regs.directoryDot))return directory;var result=[];directory.replace(URI.regs.endSlash,"").split("/").each(function(dir){if(dir==".."&&result.length>0)result.pop();else if(dir!=".")result.push(dir)});return result.join("/")+"/"},combine:function(bits){return bits.value||bits.scheme+"://"+(bits.user?bits.user+(bits.password?":"+bits.password:"")+"@":"")+(bits.host||"")+(bits.port&&bits.port!=this.schemes[bits.scheme]?":"+bits.port:"")+(bits.directory||"/")+(bits.file||"")+(bits.query?"?"+bits.query:"")+(bits.fragment?"#"+bits.fragment:"")},set:function(part,value,base){if(part=="value"){var scheme=value.match(URI.regs.scheme);if(scheme)scheme=scheme[1];if(scheme&&this.schemes[scheme.toLowerCase()]==null)this.parsed={scheme:scheme,value:value};else this.parsed=this.parse(value,(base||this).parsed)||(scheme?{scheme:scheme,value:value}:{value:value})}else if(part=="data"){this.setData(value)}else{this.parsed[part]=value}return this},get:function(part,base){switch(part){case"value":return this.combine(this.parsed,base?base.parsed:false);case"data":return this.getData()}return this.parsed[part]||""},go:function(){document.location.href=this.toString()},toURI:function(){return this},getData:function(key,part){var qs=this.get(part||"query");if(!(qs||qs===0))return key?null:{};var obj=qs.parseQueryString();return key?obj[key]:obj},setData:function(values,merge,part){if(typeof values=="string"){var data=this.getData();data[arguments[0]]=arguments[1];values=data}else if(merge){values=Object.merge(this.getData(),values)}return this.set(part||"query",Object.toQueryString(values))},clearData:function(part){return this.set(part||"query","")},toString:toString,valueOf:toString});URI.regs={endSlash:/\/$/,scheme:/^(\w+):/,directoryDot:/\.\/|\.$/};URI.base=new URI(Array.from(document.getElements("base[href]",true)).getLast(),{base:document.location});String.implement({toURI:function(options){return new URI(this,options)}})})();(function(){if(this.Hash)return;var Hash=this.Hash=new Type("Hash",function(object){if(typeOf(object)=="hash")object=Object.clone(object.getClean());for(var key in object)this[key]=object[key];return this});this.$H=function(object){return new Hash(object)};Hash.implement({forEach:function(fn,bind){Object.forEach(this,fn,bind)},getClean:function(){var clean={};for(var key in this){if(this.hasOwnProperty(key))clean[key]=this[key]}return clean},getLength:function(){var length=0;for(var key in this){if(this.hasOwnProperty(key))length++}return length}});Hash.alias("each","forEach");Hash.implement({has:Object.prototype.hasOwnProperty,keyOf:function(value){return Object.keyOf(this,value)},hasValue:function(value){return Object.contains(this,value)},extend:function(properties){Hash.each(properties||{},function(value,key){Hash.set(this,key,value)},this);return this},combine:function(properties){Hash.each(properties||{},function(value,key){Hash.include(this,key,value)},this);return this},erase:function(key){if(this.hasOwnProperty(key))delete this[key];return this},get:function(key){return this.hasOwnProperty(key)?this[key]:null},set:function(key,value){if(!this[key]||this.hasOwnProperty(key))this[key]=value;return this},empty:function(){Hash.each(this,function(value,key){delete this[key]},this);return this},include:function(key,value){if(this[key]==undefined)this[key]=value;return this},map:function(fn,bind){return new Hash(Object.map(this,fn,bind))},filter:function(fn,bind){return new Hash(Object.filter(this,fn,bind))},every:function(fn,bind){return Object.every(this,fn,bind)},some:function(fn,bind){return Object.some(this,fn,bind)},getKeys:function(){return Object.keys(this)},getValues:function(){return Object.values(this)},toQueryString:function(base){return Object.toQueryString(this,base)}});Hash.alias({indexOf:"keyOf",contains:"hasValue"})})();(function(){Events.Pseudos=function(pseudos,addEvent,removeEvent){var storeKey="_monitorEvents:";var storageOf=function(object){return{store:object.store?function(key,value){object.store(storeKey+key,value)}:function(key,value){(object._monitorEvents||(object._monitorEvents={}))[key]=value},retrieve:object.retrieve?function(key,dflt){return object.retrieve(storeKey+key,dflt)}:function(key,dflt){if(!object._monitorEvents)return dflt;return object._monitorEvents[key]||dflt}}};var splitType=function(type){if(type.indexOf(":")==-1||!pseudos)return null;var parsed=Slick.parse(type).expressions[0][0],parsedPseudos=parsed.pseudos,l=parsedPseudos.length,splits=[];while(l--){var pseudo=parsedPseudos[l].key,listener=pseudos[pseudo];if(listener!=null)splits.push({event:parsed.tag,value:parsedPseudos[l].value,pseudo:pseudo,original:type,listener:listener})}return splits.length?splits:null};return{addEvent:function(type,fn,internal){var split=splitType(type);if(!split)return addEvent.call(this,type,fn,internal);var storage=storageOf(this),events=storage.retrieve(type,[]),eventType=split[0].event,args=Array.slice(arguments,2),stack=fn,self=this;split.each(function(item){var listener=item.listener,stackFn=stack;if(listener==false)eventType+=":"+item.pseudo+"("+item.value+")";else stack=function(){listener.call(self,item,stackFn,arguments,stack)}});events.include({type:eventType,event:fn,monitor:stack});storage.store(type,events);if(type!=eventType)addEvent.apply(this,[type,fn].concat(args));return addEvent.apply(this,[eventType,stack].concat(args))},removeEvent:function(type,fn){var split=splitType(type);if(!split)return removeEvent.call(this,type,fn);var storage=storageOf(this),events=storage.retrieve(type);if(!events)return this;var args=Array.slice(arguments,2);removeEvent.apply(this,[type,fn].concat(args));events.each(function(monitor,i){if(!fn||monitor.event==fn)removeEvent.apply(this,[monitor.type,monitor.monitor].concat(args));delete events[i]},this);storage.store(type,events);return this}}};var pseudos={once:function(split,fn,args,monitor){fn.apply(this,args);this.removeEvent(split.event,monitor).removeEvent(split.original,fn)},throttle:function(split,fn,args){if(!fn._throttled){fn.apply(this,args);fn._throttled=setTimeout(function(){fn._throttled=false},split.value||250)}},pause:function(split,fn,args){clearTimeout(fn._pause);fn._pause=fn.delay(split.value||250,this,args)}};Events.definePseudo=function(key,listener){pseudos[key]=listener;return this};Events.lookupPseudo=function(key){return pseudos[key]};var proto=Events.prototype;Events.implement(Events.Pseudos(pseudos,proto.addEvent,proto.removeEvent));["Request","Fx"].each(function(klass){if(this[klass])this[klass].implement(Events.prototype)})})();(function(){var pseudos={relay:false},copyFromEvents=["once","throttle","pause"],count=copyFromEvents.length;while(count--)pseudos[copyFromEvents[count]]=Events.lookupPseudo(copyFromEvents[count]);DOMEvent.definePseudo=function(key,listener){pseudos[key]=listener;return this};var proto=Element.prototype;[Element,Window,Document].invoke("implement",Events.Pseudos(pseudos,proto.addEvent,proto.removeEvent))})();(function(){var keysStoreKey="$moo:keys-pressed",keysKeyupStoreKey="$moo:keys-keyup";DOMEvent.definePseudo("keys",function(split,fn,args){var event=args[0],keys=[],pressed=this.retrieve(keysStoreKey,[]);keys.append(split.value.replace("++",function(){keys.push("+");return""}).split("+"));pressed.include(event.key);if(keys.every(function(key){return pressed.contains(key)}))fn.apply(this,args);this.store(keysStoreKey,pressed);if(!this.retrieve(keysKeyupStoreKey)){var keyup=function(event){(function(){pressed=this.retrieve(keysStoreKey,[]).erase(event.key);this.store(keysStoreKey,pressed)}).delay(0,this)};this.store(keysKeyupStoreKey,keyup).addEvent("keyup",keyup)}});DOMEvent.defineKeys({16:"shift",17:"control",18:"alt",20:"capslock",33:"pageup",34:"pagedown",35:"end",36:"home",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",107:"+"}).defineKey(Browser.firefox?109:189,"-")})();Class.Mutators.Binds=function(binds){if(!this.prototype.initialize)this.implement("initialize",function(){});return Array.from(binds).concat(this.prototype.Binds||[])};Class.Mutators.initialize=function(initialize){return function(){Array.from(this.Binds).each(function(name){var original=this[name];if(original)this[name]=original.bind(this)},this);return initialize.apply(this,arguments)}};Class.Occlude=new Class({occlude:function(property,element){element=document.id(element||this.element);var instance=element.retrieve(property||this.property);if(instance&&!this.occluded)return this.occluded=instance;this.occluded=false;element.store(property||this.property,this);return this.occluded}});Class.refactor=function(original,refactors){Object.each(refactors,function(item,name){var origin=original.prototype[name];origin=origin&&origin.$origin||origin||function(){};original.implement(name,typeof item=="function"?function(){var old=this.previous;this.previous=origin;var value=item.apply(this,arguments);this.previous=old;return value}:item)});return original};(function(){var getStylesList=function(styles,planes){var list=[];Object.each(planes,function(directions){Object.each(directions,function(edge){styles.each(function(style){list.push(style+"-"+edge+(style=="border"?"-width":""))})})});return list};var calculateEdgeSize=function(edge,styles){var total=0;Object.each(styles,function(value,style){if(style.test(edge))total=total+value.toInt()});return total};var isVisible=function(el){return!!(!el||el.offsetHeight||el.offsetWidth)};Element.implement({measure:function(fn){if(isVisible(this))return fn.call(this);var parent=this.getParent(),toMeasure=[];while(!isVisible(parent)&&parent!=document.body){toMeasure.push(parent.expose());parent=parent.getParent()}var restore=this.expose(),result=fn.call(this);restore();toMeasure.each(function(restore){restore()});return result},expose:function(){if(this.getStyle("display")!="none")return function(){};var before=this.style.cssText;this.setStyles({display:"block",position:"absolute",visibility:"hidden"});return function(){this.style.cssText=before}.bind(this)},getDimensions:function(options){options=Object.merge({computeSize:false},options);var dim={x:0,y:0};var getSize=function(el,options){return options.computeSize?el.getComputedSize(options):el.getSize()};var parent=this.getParent("body");if(parent&&this.getStyle("display")=="none"){dim=this.measure(function(){return getSize(this,options)})}else if(parent){try{dim=getSize(this,options)}catch(e){}}return Object.append(dim,dim.x||dim.x===0?{width:dim.x,height:dim.y}:{x:dim.width,y:dim.height})},getComputedSize:function(options){options=Object.merge({styles:["padding","border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},options);var styles={},size={width:0,height:0},dimensions;if(options.mode=="vertical"){delete size.width;delete options.planes.width}else if(options.mode=="horizontal"){delete size.height;delete options.planes.height}getStylesList(options.styles,options.planes).each(function(style){styles[style]=this.getStyle(style).toInt()},this);Object.each(options.planes,function(edges,plane){var capitalized=plane.capitalize(),style=this.getStyle(plane);if(style=="auto"&&!dimensions)dimensions=this.getDimensions();style=styles[plane]=style=="auto"?dimensions[plane]:style.toInt();size["total"+capitalized]=style;edges.each(function(edge){var edgesize=calculateEdgeSize(edge,styles);size["computed"+edge.capitalize()]=edgesize;size["total"+capitalized]+=edgesize})},this);return Object.append(size,styles)}})})();(function(original){var local=Element.Position={options:{relativeTo:document.body,position:{x:"center",y:"center"},offset:{x:0,y:0}},getOptions:function(element,options){options=Object.merge({},local.options,options);local.setPositionOption(options);local.setEdgeOption(options);local.setOffsetOption(element,options);local.setDimensionsOption(element,options);return options},setPositionOption:function(options){options.position=local.getCoordinateFromValue(options.position)},setEdgeOption:function(options){var edgeOption=local.getCoordinateFromValue(options.edge);options.edge=edgeOption?edgeOption:options.position.x=="center"&&options.position.y=="center"?{x:"center",y:"center"}:{x:"left",y:"top"}},setOffsetOption:function(element,options){var parentOffset={x:0,y:0},offsetParent=element.measure(function(){return document.id(this.getOffsetParent())}),parentScroll=offsetParent.getScroll();if(!offsetParent||offsetParent==element.getDocument().body)return;parentOffset=offsetParent.measure(function(){var position=this.getPosition();if(this.getStyle("position")=="fixed"){var scroll=window.getScroll();position.x+=scroll.x;position.y+=scroll.y}return position});options.offset={parentPositioned:offsetParent!=document.id(options.relativeTo),x:options.offset.x-parentOffset.x+parentScroll.x,y:options.offset.y-parentOffset.y+parentScroll.y}},setDimensionsOption:function(element,options){options.dimensions=element.getDimensions({computeSize:true,styles:["padding","border","margin"]})},getPosition:function(element,options){var position={};options=local.getOptions(element,options);var relativeTo=document.id(options.relativeTo)||document.body;local.setPositionCoordinates(options,position,relativeTo);if(options.edge)local.toEdge(position,options);var offset=options.offset;position.left=(position.x>=0||offset.parentPositioned||options.allowNegative?position.x:0).toInt();position.top=(position.y>=0||offset.parentPositioned||options.allowNegative?position.y:0).toInt();local.toMinMax(position,options);if(options.relFixedPosition||relativeTo.getStyle("position")=="fixed")local.toRelFixedPosition(relativeTo,position);if(options.ignoreScroll)local.toIgnoreScroll(relativeTo,position);if(options.ignoreMargins)local.toIgnoreMargins(position,options);position.left=Math.ceil(position.left);position.top=Math.ceil(position.top);delete position.x;delete position.y;return position},setPositionCoordinates:function(options,position,relativeTo){var offsetY=options.offset.y,offsetX=options.offset.x,calc=relativeTo==document.body?window.getScroll():relativeTo.getPosition(),top=calc.y,left=calc.x,winSize=window.getSize();switch(options.position.x){case"left":position.x=left+offsetX;break;case"right":position.x=left+offsetX+relativeTo.offsetWidth;break;default:position.x=left+(relativeTo==document.body?winSize.x:relativeTo.offsetWidth)/2+offsetX;break}switch(options.position.y){case"top":position.y=top+offsetY;break;case"bottom":position.y=top+offsetY+relativeTo.offsetHeight;break;default:position.y=top+(relativeTo==document.body?winSize.y:relativeTo.offsetHeight)/2+offsetY;break}},toMinMax:function(position,options){var xy={left:"x",top:"y"},value;["minimum","maximum"].each(function(minmax){["left","top"].each(function(lr){value=options[minmax]?options[minmax][xy[lr]]:null;if(value!=null&&(minmax=="minimum"?position[lr]<value:position[lr]>value))position[lr]=value})})},toRelFixedPosition:function(relativeTo,position){var winScroll=window.getScroll();position.top+=winScroll.y;position.left+=winScroll.x},toIgnoreScroll:function(relativeTo,position){var relScroll=relativeTo.getScroll();position.top-=relScroll.y;position.left-=relScroll.x},toIgnoreMargins:function(position,options){position.left+=options.edge.x=="right"?options.dimensions["margin-right"]:options.edge.x!="center"?-options.dimensions["margin-left"]:-options.dimensions["margin-left"]+(options.dimensions["margin-right"]+options.dimensions["margin-left"])/2;position.top+=options.edge.y=="bottom"?options.dimensions["margin-bottom"]:options.edge.y!="center"?-options.dimensions["margin-top"]:-options.dimensions["margin-top"]+(options.dimensions["margin-bottom"]+options.dimensions["margin-top"])/2},toEdge:function(position,options){var edgeOffset={},dimensions=options.dimensions,edge=options.edge;switch(edge.x){case"left":edgeOffset.x=0;break;case"right":edgeOffset.x=-dimensions.x-dimensions.computedRight-dimensions.computedLeft;break;default:edgeOffset.x=-Math.round(dimensions.totalWidth/2);break}switch(edge.y){case"top":edgeOffset.y=0;break;case"bottom":edgeOffset.y=-dimensions.y-dimensions.computedTop-dimensions.computedBottom;break;default:edgeOffset.y=-Math.round(dimensions.totalHeight/2);break}position.x+=edgeOffset.x;position.y+=edgeOffset.y},getCoordinateFromValue:function(option){if(typeOf(option)!="string")return option;option=option.toLowerCase();return{x:option.test("left")?"left":option.test("right")?"right":"center",y:option.test(/upper|top/)?"top":option.test("bottom")?"bottom":"center"}}};Element.implement({position:function(options){if(options&&(options.x!=null||options.y!=null)){return original?original.apply(this,arguments):this}var position=this.setStyle("position","absolute").calculatePosition(options);return options&&options.returnPos?position:this.setStyles(position)},calculatePosition:function(options){return local.getPosition(this,options)}})})(Element.prototype.position);var IframeShim=new Class({Implements:[Options,Events,Class.Occlude],options:{className:"iframeShim",src:'javascript:false;document.write("");',display:false,zIndex:null,margin:0,offset:{x:0,y:0},browsers:Browser.ie6||Browser.firefox&&Browser.version<3&&Browser.Platform.mac},property:"IframeShim",initialize:function(element,options){this.element=document.id(element);if(this.occlude())return this.occluded;this.setOptions(options);this.makeShim();return this},makeShim:function(){if(this.options.browsers){var zIndex=this.element.getStyle("zIndex").toInt();if(!zIndex){zIndex=1;var pos=this.element.getStyle("position");if(pos=="static"||!pos)this.element.setStyle("position","relative");this.element.setStyle("zIndex",zIndex)}zIndex=(this.options.zIndex!=null||this.options.zIndex===0)&&zIndex>this.options.zIndex?this.options.zIndex:zIndex-1;if(zIndex<0)zIndex=1;this.shim=new Element("iframe",{src:this.options.src,scrolling:"no",frameborder:0,styles:{zIndex:zIndex,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},"class":this.options.className}).store("IframeShim",this);var inject=function(){this.shim.inject(this.element,"after");this[this.options.display?"show":"hide"]();this.fireEvent("inject")}.bind(this);if(!IframeShim.ready)window.addEvent("load",inject);else inject()}else{this.position=this.hide=this.show=this.dispose=Function.from(this)}},position:function(){if(!IframeShim.ready||!this.shim)return this;var size=this.element.measure(function(){return this.getSize()});if(this.options.margin!=undefined){size.x=size.x-this.options.margin*2;size.y=size.y-this.options.margin*2;this.options.offset.x+=this.options.margin;this.options.offset.y+=this.options.margin}this.shim.set({width:size.x,height:size.y}).position({relativeTo:this.element,offset:this.options.offset});return this},hide:function(){if(this.shim)this.shim.setStyle("display","none");return this},show:function(){if(this.shim)this.shim.setStyle("display","block");return this.position()},dispose:function(){if(this.shim)this.shim.dispose();return this},destroy:function(){if(this.shim)this.shim.destroy();return this}});window.addEvent("load",function(){IframeShim.ready=true});var Mask=new Class({Implements:[Options,Events],Binds:["position"],options:{style:{},"class":"mask",maskMargins:false,useIframeShim:true,iframeShimOptions:{}},initialize:function(target,options){this.target=document.id(target)||document.id(document.body);this.target.store("mask",this);this.setOptions(options);this.render();this.inject()},render:function(){this.element=new Element("div",{"class":this.options["class"],id:this.options.id||"mask-"+String.uniqueID(),styles:Object.merge({},this.options.style,{display:"none"}),events:{click:function(event){this.fireEvent("click",event);if(this.options.hideOnClick)this.hide()}.bind(this)}});this.hidden=true},toElement:function(){return this.element},inject:function(target,where){where=where||(this.options.inject?this.options.inject.where:"")||this.target==document.body?"inside":"after";target=target||this.options.inject&&this.options.inject.target||this.target;this.element.inject(target,where);if(this.options.useIframeShim){this.shim=new IframeShim(this.element,this.options.iframeShimOptions);this.addEvents({show:this.shim.show.bind(this.shim),hide:this.shim.hide.bind(this.shim),destroy:this.shim.destroy.bind(this.shim)})}},position:function(){this.resize(this.options.width,this.options.height);this.element.position({relativeTo:this.target,position:"topLeft",ignoreMargins:!this.options.maskMargins,ignoreScroll:this.target==document.body});return this},resize:function(x,y){var opt={styles:["padding","border"]};if(this.options.maskMargins)opt.styles.push("margin");var dim=this.target.getComputedSize(opt);if(this.target==document.body){this.element.setStyles({width:0,height:0});var win=window.getScrollSize();if(dim.totalHeight<win.y)dim.totalHeight=win.y;if(dim.totalWidth<win.x)dim.totalWidth=win.x}this.element.setStyles({width:Array.pick([x,dim.totalWidth,dim.x]),height:Array.pick([y,dim.totalHeight,dim.y])});return this},show:function(){if(!this.hidden)return this;window.addEvent("resize",this.position);this.position();this.showMask.apply(this,arguments);return this},showMask:function(){this.element.setStyle("display","block");this.hidden=false;this.fireEvent("show")},hide:function(){if(this.hidden)return this;window.removeEvent("resize",this.position);this.hideMask.apply(this,arguments);if(this.options.destroyOnHide)return this.destroy();return this},hideMask:function(){this.element.setStyle("display","none");this.hidden=true;this.fireEvent("hide")},toggle:function(){this[this.hidden?"show":"hide"]()},destroy:function(){this.hide();this.element.destroy();this.fireEvent("destroy");this.target.eliminate("mask")}});Element.Properties.mask={set:function(options){var mask=this.retrieve("mask");if(mask)mask.destroy();return this.eliminate("mask").store("mask:options",options)},get:function(){var mask=this.retrieve("mask");if(!mask){mask=new Mask(this,this.retrieve("mask:options"));this.store("mask",mask)}return mask}};Element.implement({mask:function(options){if(options)this.set("mask",options);this.get("mask").show();return this},unmask:function(){this.get("mask").hide();return this}});var Spinner=new Class({Extends:Mask,Implements:Chain,options:{"class":"spinner",containerPosition:{},content:{"class":"spinner-content"},messageContainer:{"class":"spinner-msg"},img:{"class":"spinner-img"},fxOptions:{link:"chain"}},initialize:function(target,options){this.target=document.id(target)||document.id(document.body);this.target.store("spinner",this);this.setOptions(options);this.render();this.inject();var deactivate=function(){this.active=false}.bind(this);this.addEvents({hide:deactivate,show:deactivate})},render:function(){this.parent();this.element.set("id",this.options.id||"spinner-"+String.uniqueID());this.content=document.id(this.options.content)||new Element("div",this.options.content);this.content.inject(this.element);if(this.options.message){this.msg=document.id(this.options.message)||new Element("p",this.options.messageContainer).appendText(this.options.message);this.msg.inject(this.content)}if(this.options.img){this.img=document.id(this.options.img)||new Element("div",this.options.img);this.img.inject(this.content)}this.element.set("tween",this.options.fxOptions)},show:function(noFx){if(this.active)return this.chain(this.show.bind(this));if(!this.hidden){this.callChain.delay(20,this);return this}this.active=true;return this.parent(noFx)},showMask:function(noFx){var pos=function(){this.content.position(Object.merge({relativeTo:this.element},this.options.containerPosition))}.bind(this);if(noFx){this.parent();pos()}else{if(!this.options.style.opacity)this.options.style.opacity=this.element.getStyle("opacity").toFloat();this.element.setStyles({display:"block",opacity:0}).tween("opacity",this.options.style.opacity);pos();this.hidden=false;this.fireEvent("show");this.callChain()}},hide:function(noFx){if(this.active)return this.chain(this.hide.bind(this));if(this.hidden){this.callChain.delay(20,this);return this}this.active=true;return this.parent(noFx)},hideMask:function(noFx){if(noFx)return this.parent();this.element.tween("opacity",0).get("tween").chain(function(){this.element.setStyle("display","none");this.hidden=true;this.fireEvent("hide");this.callChain()}.bind(this))},destroy:function(){this.content.destroy();this.parent();this.target.eliminate("spinner")}});Request=Class.refactor(Request,{options:{useSpinner:false,spinnerOptions:{},spinnerTarget:false},initialize:function(options){this._send=this.send;this.send=function(options){var spinner=this.getSpinner();if(spinner)spinner.chain(this._send.pass(options,this)).show();else this._send(options);return this};this.previous(options)},getSpinner:function(){if(!this.spinner){var update=document.id(this.options.spinnerTarget)||document.id(this.options.update);if(this.options.useSpinner&&update){update.set("spinner",this.options.spinnerOptions);var spinner=this.spinner=update.get("spinner");["complete","exception","cancel"].each(function(event){this.addEvent(event,spinner.hide.bind(spinner))},this)}}return this.spinner}});Element.Properties.spinner={set:function(options){var spinner=this.retrieve("spinner");if(spinner)spinner.destroy();return this.eliminate("spinner").store("spinner:options",options)},get:function(){var spinner=this.retrieve("spinner");if(!spinner){spinner=new Spinner(this,this.retrieve("spinner:options"));this.store("spinner",spinner)}return spinner}};Element.implement({spin:function(options){if(options)this.set("spinner",options);this.get("spinner").show();return this},unspin:function(){this.get("spinner").hide();return this}});if(!window.Form)window.Form={};(function(){Form.Request=new Class({Binds:["onSubmit","onFormValidate"],Implements:[Options,Events,Class.Occlude],options:{requestOptions:{evalScripts:true,useSpinner:true,emulation:false,link:"ignore"},sendButtonClicked:true,extraData:{},resetForm:true},property:"form.request",initialize:function(form,target,options){
this.element=document.id(form);if(this.occlude())return this.occluded;this.setOptions(options).setTarget(target).attach()},setTarget:function(target){this.target=document.id(target);if(!this.request){this.makeRequest()}else{this.request.setOptions({update:this.target})}return this},toElement:function(){return this.element},makeRequest:function(){var self=this;this.request=new Request.HTML(Object.merge({update:this.target,emulation:false,spinnerTarget:this.element,method:this.element.get("method")||"post"},this.options.requestOptions)).addEvents({success:function(tree,elements,html,javascript){["complete","success"].each(function(evt){self.fireEvent(evt,[self.target,tree,elements,html,javascript])})},failure:function(){self.fireEvent("complete",arguments).fireEvent("failure",arguments)},exception:function(){self.fireEvent("failure",arguments)}});return this.attachReset()},attachReset:function(){if(!this.options.resetForm)return this;this.request.addEvent("success",function(){Function.attempt(function(){this.element.reset()}.bind(this));if(window.OverText)OverText.update()}.bind(this));return this},attach:function(attach){var method=attach!=false?"addEvent":"removeEvent";this.element[method]("click:relay(button, input[type=submit])",this.saveClickedButton.bind(this));var fv=this.element.retrieve("validator");if(fv)fv[method]("onFormValidate",this.onFormValidate);else this.element[method]("submit",this.onSubmit);return this},detach:function(){return this.attach(false)},enable:function(){return this.attach()},disable:function(){return this.detach()},onFormValidate:function(valid,form,event){if(!event)return;var fv=this.element.retrieve("validator");if(valid||fv&&!fv.options.stopOnFailure){event.stop();this.send()}},onSubmit:function(event){var fv=this.element.retrieve("validator");if(fv){this.element.removeEvent("submit",this.onSubmit);fv.addEvent("onFormValidate",this.onFormValidate);this.element.validate();return}if(event)event.stop();this.send()},saveClickedButton:function(event,target){var targetName=target.get("name");if(!targetName||!this.options.sendButtonClicked)return;this.options.extraData[targetName]=target.get("value")||true;this.clickedCleaner=function(){delete this.options.extraData[targetName];this.clickedCleaner=function(){}}.bind(this)},clickedCleaner:function(){},send:function(){var str=this.element.toQueryString().trim(),data=Object.toQueryString(this.options.extraData);if(str)str+="&"+data;else str=data;this.fireEvent("send",[this.element,str.parseQueryString()]);this.request.send({data:str,url:this.options.requestOptions.url||this.element.get("action")});this.clickedCleaner();return this}});Element.implement("formUpdate",function(update,options){var fq=this.retrieve("form.request");if(!fq){fq=new Form.Request(this,update,options)}else{if(update)fq.setTarget(update);if(options)fq.setOptions(options).makeRequest()}fq.send();return this})})();Element.implement({isDisplayed:function(){return this.getStyle("display")!="none"},isVisible:function(){var w=this.offsetWidth,h=this.offsetHeight;return w==0&&h==0?false:w>0&&h>0?true:this.style.display!="none"},toggle:function(){return this[this.isDisplayed()?"hide":"show"]()},hide:function(){var d;try{d=this.getStyle("display")}catch(e){}if(d=="none")return this;return this.store("element:_originalDisplay",d||"").setStyle("display","none")},show:function(display){if(!display&&this.isDisplayed())return this;display=display||this.retrieve("element:_originalDisplay")||"block";return this.setStyle("display",display=="none"?"block":display)},swapClass:function(remove,add){return this.removeClass(remove).addClass(add)}});Document.implement({clearSelection:function(){if(window.getSelection){var selection=window.getSelection();if(selection&&selection.removeAllRanges)selection.removeAllRanges()}else if(document.selection&&document.selection.empty){try{document.selection.empty()}catch(e){}}}});(function(){var hideTheseOf=function(object){var hideThese=object.options.hideInputs;if(window.OverText){var otClasses=[null];OverText.each(function(ot){otClasses.include("."+ot.options.labelClass)});if(otClasses)hideThese+=otClasses.join(", ")}return hideThese?object.element.getElements(hideThese):null};Fx.Reveal=new Class({Extends:Fx.Morph,options:{link:"cancel",styles:["padding","border","margin"],transitionOpacity:!Browser.ie6,mode:"vertical",display:function(){return this.element.get("tag")!="tr"?"block":"table-row"},opacity:1,hideInputs:Browser.ie?"select, input, textarea, object, embed":null},dissolve:function(){if(!this.hiding&&!this.showing){if(this.element.getStyle("display")!="none"){this.hiding=true;this.showing=false;this.hidden=true;this.cssText=this.element.style.cssText;var startStyles=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode});if(this.options.transitionOpacity)startStyles.opacity=this.options.opacity;var zero={};Object.each(startStyles,function(style,name){zero[name]=[style,0]});this.element.setStyles({display:Function.from(this.options.display).call(this),overflow:"hidden"});var hideThese=hideTheseOf(this);if(hideThese)hideThese.setStyle("visibility","hidden");this.$chain.unshift(function(){if(this.hidden){this.hiding=false;this.element.style.cssText=this.cssText;this.element.setStyle("display","none");if(hideThese)hideThese.setStyle("visibility","visible")}this.fireEvent("hide",this.element);this.callChain()}.bind(this));this.start(zero)}else{this.callChain.delay(10,this);this.fireEvent("complete",this.element);this.fireEvent("hide",this.element)}}else if(this.options.link=="chain"){this.chain(this.dissolve.bind(this))}else if(this.options.link=="cancel"&&!this.hiding){this.cancel();this.dissolve()}return this},reveal:function(){if(!this.showing&&!this.hiding){if(this.element.getStyle("display")=="none"){this.hiding=false;this.showing=true;this.hidden=false;this.cssText=this.element.style.cssText;var startStyles;this.element.measure(function(){startStyles=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode})}.bind(this));if(this.options.heightOverride!=null)startStyles.height=this.options.heightOverride.toInt();if(this.options.widthOverride!=null)startStyles.width=this.options.widthOverride.toInt();if(this.options.transitionOpacity){this.element.setStyle("opacity",0);startStyles.opacity=this.options.opacity}var zero={height:0,display:Function.from(this.options.display).call(this)};Object.each(startStyles,function(style,name){zero[name]=0});zero.overflow="hidden";this.element.setStyles(zero);var hideThese=hideTheseOf(this);if(hideThese)hideThese.setStyle("visibility","hidden");this.$chain.unshift(function(){this.element.style.cssText=this.cssText;this.element.setStyle("display",Function.from(this.options.display).call(this));if(!this.hidden)this.showing=false;if(hideThese)hideThese.setStyle("visibility","visible");this.callChain();this.fireEvent("show",this.element)}.bind(this));this.start(startStyles)}else{this.callChain();this.fireEvent("complete",this.element);this.fireEvent("show",this.element)}}else if(this.options.link=="chain"){this.chain(this.reveal.bind(this))}else if(this.options.link=="cancel"&&!this.showing){this.cancel();this.reveal()}return this},toggle:function(){if(this.element.getStyle("display")=="none"){this.reveal()}else{this.dissolve()}return this},cancel:function(){this.parent.apply(this,arguments);if(this.cssText!=null)this.element.style.cssText=this.cssText;this.hiding=false;this.showing=false;return this}});Element.Properties.reveal={set:function(options){this.get("reveal").cancel().setOptions(options);return this},get:function(){var reveal=this.retrieve("reveal");if(!reveal){reveal=new Fx.Reveal(this);this.store("reveal",reveal)}return reveal}};Element.Properties.dissolve=Element.Properties.reveal;Element.implement({reveal:function(options){this.get("reveal").setOptions(options).reveal();return this},dissolve:function(options){this.get("reveal").setOptions(options).dissolve();return this},nix:function(options){var params=Array.link(arguments,{destroy:Type.isBoolean,options:Type.isObject});this.get("reveal").setOptions(options).dissolve().chain(function(){this[params.destroy?"destroy":"dispose"]()}.bind(this));return this},wink:function(){var params=Array.link(arguments,{duration:Type.isNumber,options:Type.isObject});var reveal=this.get("reveal").setOptions(params.options);reveal.reveal().chain(function(){(function(){reveal.dissolve()}).delay(params.duration||2e3)})}})})();Elements.from=function(text,excludeScripts){if(excludeScripts||excludeScripts==null)text=text.stripScripts();var container,match=text.match(/^\s*<(t[dhr]|tbody|tfoot|thead)/i);if(match){container=new Element("table");var tag=match[1].toLowerCase();if(["td","th","tr"].contains(tag)){container=new Element("tbody").inject(container);if(tag!="tr")container=new Element("tr").inject(container)}}return(container||new Element("div")).set("html",text).getChildren()};Form.Request.Append=new Class({Extends:Form.Request,options:{useReveal:true,revealOptions:{},inject:"bottom"},makeRequest:function(){this.request=new Request.HTML(Object.merge({url:this.element.get("action"),method:this.element.get("method")||"post",spinnerTarget:this.element},this.options.requestOptions,{evalScripts:false})).addEvents({success:function(tree,elements,html,javascript){var container;var kids=Elements.from(html);if(kids.length==1){container=kids[0]}else{container=new Element("div",{styles:{display:"none"}}).adopt(kids)}container.inject(this.target,this.options.inject);if(this.options.requestOptions.evalScripts)Browser.exec(javascript);this.fireEvent("beforeEffect",container);var finish=function(){this.fireEvent("success",[container,this.target,tree,elements,html,javascript])}.bind(this);if(this.options.useReveal){container.set("reveal",this.options.revealOptions).get("reveal").chain(finish);container.reveal()}else{finish()}}.bind(this),failure:function(xhr){this.fireEvent("failure",xhr)}.bind(this)});this.attachReset()}});(function(){var special={a:/[]/g,A:/[]/g,c:/[]/g,C:/[]/g,d:/[]/g,D:/[]/g,e:/[]/g,E:/[]/g,g:/[]/g,G:/[]/g,i:/[]/g,I:/[]/g,l:/[]/g,L:/[]/g,n:/[]/g,N:/[]/g,o:/[]/g,O:/[]/g,r:/[]/g,R:/[]/g,s:/[]/g,S:/[]/g,t:/[]/g,T:/[]/g,ue:/[]/g,UE:/[]/g,u:/[]/g,U:/[]/g,y:/[]/g,Y:/[]/g,z:/[]/g,Z:/[]/g,th:/[]/g,TH:/[]/g,dh:/[]/g,DH:/[]/g,ss:/[]/g,oe:/[]/g,OE:/[]/g,ae:/[]/g,AE:/[]/g},tidy={" ":/[\xa0\u2002\u2003\u2009]/g,"*":/[\xb7]/g,"'":/[\u2018\u2019]/g,'"':/[\u201c\u201d]/g,"...":/[\u2026]/g,"-":/[\u2013]/g,"&raquo;":/[\uFFFD]/g};var walk=function(string,replacements){var result=string,key;for(key in replacements)result=result.replace(replacements[key],key);return result};var getRegexForTag=function(tag,contents){tag=tag||"";var regstr=contents?"<"+tag+"(?!\\w)[^>]*>([\\s\\S]*?)</"+tag+"(?!\\w)>":"</?"+tag+"([^>]+)?>",reg=new RegExp(regstr,"gi");return reg};String.implement({standardize:function(){return walk(this,special)},repeat:function(times){return new Array(times+1).join(this)},pad:function(length,str,direction){if(this.length>=length)return this;var pad=(str==null?" ":""+str).repeat(length-this.length).substr(0,length-this.length);if(!direction||direction=="right")return this+pad;if(direction=="left")return pad+this;return pad.substr(0,(pad.length/2).floor())+this+pad.substr(0,(pad.length/2).ceil())},getTags:function(tag,contents){return this.match(getRegexForTag(tag,contents))||[]},stripTags:function(tag,contents){return this.replace(getRegexForTag(tag,contents),"")},tidy:function(){return walk(this,tidy)},truncate:function(max,trail,atChar){var string=this;if(trail==null&&arguments.length==1)trail="";if(string.length>max){string=string.substring(0,max);if(atChar){var index=string.lastIndexOf(atChar);if(index!=-1)string=string.substr(0,index)}if(trail)string+=trail}return string}})})();Element.implement({tidy:function(){this.set("value",this.get("value").tidy())},getTextInRange:function(start,end){return this.get("value").substring(start,end)},getSelectedText:function(){if(this.setSelectionRange)return this.getTextInRange(this.getSelectionStart(),this.getSelectionEnd());return document.selection.createRange().text},getSelectedRange:function(){if(this.selectionStart!=null){return{start:this.selectionStart,end:this.selectionEnd}}var pos={start:0,end:0};var range=this.getDocument().selection.createRange();if(!range||range.parentElement()!=this)return pos;var duplicate=range.duplicate();if(this.type=="text"){pos.start=0-duplicate.moveStart("character",-1e5);pos.end=pos.start+range.text.length}else{var value=this.get("value");var offset=value.length;duplicate.moveToElementText(this);duplicate.setEndPoint("StartToEnd",range);if(duplicate.text.length)offset-=value.match(/[\n\r]*$/)[0].length;pos.end=offset-duplicate.text.length;duplicate.setEndPoint("StartToStart",range);pos.start=offset-duplicate.text.length}return pos},getSelectionStart:function(){return this.getSelectedRange().start},getSelectionEnd:function(){return this.getSelectedRange().end},setCaretPosition:function(pos){if(pos=="end")pos=this.get("value").length;this.selectRange(pos,pos);return this},getCaretPosition:function(){return this.getSelectedRange().start},selectRange:function(start,end){if(this.setSelectionRange){this.focus();this.setSelectionRange(start,end)}else{var value=this.get("value");var diff=value.substr(start,end-start).replace(/\r/g,"").length;start=value.substr(0,start).replace(/\r/g,"").length;var range=this.createTextRange();range.collapse(true);range.moveEnd("character",start+diff);range.moveStart("character",start);range.select()}return this},insertAtCursor:function(value,select){var pos=this.getSelectedRange();var text=this.get("value");this.set("value",text.substring(0,pos.start)+value+text.substring(pos.end,text.length));if(select!==false)this.selectRange(pos.start,pos.start+value.length);else this.setCaretPosition(pos.start+value.length);return this},insertAroundCursor:function(options,select){options=Object.append({before:"",defaultMiddle:"",after:""},options);var value=this.getSelectedText()||options.defaultMiddle;var pos=this.getSelectedRange();var text=this.get("value");if(pos.start==pos.end){this.set("value",text.substring(0,pos.start)+options.before+value+options.after+text.substring(pos.end,text.length));this.selectRange(pos.start+options.before.length,pos.end+options.before.length+value.length)}else{var current=text.substring(pos.start,pos.end);this.set("value",text.substring(0,pos.start)+options.before+current+options.after+text.substring(pos.end,text.length));var selStart=pos.start+options.before.length;if(select!==false)this.selectRange(selStart,selStart+current.length);else this.setCaretPosition(selStart+text.length)}return this}});Locale.define("en-US","FormValidator",{required:"This field is required.",length:"Please enter {length} characters (you entered {elLength} characters)",minLength:"Please enter at least {minLength} characters (you entered {length} characters).",maxLength:"Please enter no more than {maxLength} characters (you entered {length} characters).",integer:"Please enter an integer in this field. Numbers with decimals (e.g. 1.25) are not permitted.",numeric:'Please enter only numeric values in this field (i.e. "1" or "1.1" or "-1" or "-1.1").',digits:"Please use numbers and punctuation only in this field (for example, a phone number with dashes or dots is permitted).",alpha:"Please use only letters (a-z) within this field. No spaces or other characters are allowed.",alphanum:"Please use only letters (a-z) or numbers (0-9) in this field. No spaces or other characters are allowed.",dateSuchAs:"Please enter a valid date such as {date}",dateInFormatMDY:'Please enter a valid date such as MM/DD/YYYY (i.e. "12/31/1999")',email:'Please enter a valid email address. For example "fred@domain.com".',url:"Please enter a valid URL such as http://www.example.com.",currencyDollar:"Please enter a valid $ amount. For example $100.00 .",oneRequired:"Please enter something for at least one of these inputs.",errorPrefix:"Error: ",warningPrefix:"Warning: ",noSpace:"There can be no spaces in this input.",reqChkByNode:"No items are selected.",requiredChk:"This field is required.",reqChkByName:"Please select a {label}.",match:"This field needs to match the {matchName} field",startDate:"the start date",endDate:"the end date",currendDate:"the current date",afterDate:"The date should be the same or after {label}.",beforeDate:"The date should be the same or before {label}.",startMonth:"Please select a start month",sameMonth:"These two dates must be in the same month - you must change one or the other.",creditcard:"The credit card number entered is invalid. Please check the number and try again. {length} digits entered."});if(!window.Form)window.Form={};var InputValidator=this.InputValidator=new Class({Implements:[Options],options:{errorMsg:"Validation failed.",test:Function.from(true)},initialize:function(className,options){this.setOptions(options);this.className=className},test:function(field,props){field=document.id(field);return field?this.options.test(field,props||this.getProps(field)):false},getError:function(field,props){field=document.id(field);var err=this.options.errorMsg;if(typeOf(err)=="function")err=err(field,props||this.getProps(field));return err},getProps:function(field){field=document.id(field);return field?field.get("validatorProps"):{}}});Element.Properties.validators={get:function(){return(this.get("data-validators")||this.className).clean().split(" ")}};Element.Properties.validatorProps={set:function(props){return this.eliminate("$moo:validatorProps").store("$moo:validatorProps",props)},get:function(props){if(props)this.set(props);if(this.retrieve("$moo:validatorProps"))return this.retrieve("$moo:validatorProps");if(this.getProperty("data-validator-properties")||this.getProperty("validatorProps")){try{this.store("$moo:validatorProps",JSON.decode(this.getProperty("validatorProps")||this.getProperty("data-validator-properties")))}catch(e){return{}}}else{var vals=this.get("validators").filter(function(cls){return cls.test(":")});if(!vals.length){this.store("$moo:validatorProps",{})}else{props={};vals.each(function(cls){var split=cls.split(":");if(split[1]){try{props[split[0]]=JSON.decode(split[1])}catch(e){}}});this.store("$moo:validatorProps",props)}}return this.retrieve("$moo:validatorProps")}};Form.Validator=new Class({Implements:[Options,Events],Binds:["onSubmit"],options:{fieldSelectors:"input, select, textarea",ignoreHidden:true,ignoreDisabled:true,useTitles:false,evaluateOnSubmit:true,evaluateFieldsOnBlur:true,evaluateFieldsOnChange:true,serial:true,stopOnFailure:true,warningPrefix:function(){return Form.Validator.getMsg("warningPrefix")||"Warning: "},errorPrefix:function(){return Form.Validator.getMsg("errorPrefix")||"Error: "}},initialize:function(form,options){this.setOptions(options);this.element=document.id(form);this.element.store("validator",this);this.warningPrefix=Function.from(this.options.warningPrefix)();this.errorPrefix=Function.from(this.options.errorPrefix)();if(this.options.evaluateOnSubmit)this.element.addEvent("submit",this.onSubmit);if(this.options.evaluateFieldsOnBlur||this.options.evaluateFieldsOnChange)this.watchFields(this.getFields())},toElement:function(){return this.element},getFields:function(){return this.fields=this.element.getElements(this.options.fieldSelectors)},watchFields:function(fields){fields.each(function(el){if(this.options.evaluateFieldsOnBlur)el.addEvent("blur",this.validationMonitor.pass([el,false],this));if(this.options.evaluateFieldsOnChange)el.addEvent("change",this.validationMonitor.pass([el,true],this))},this)},validationMonitor:function(){clearTimeout(this.timer);this.timer=this.validateField.delay(50,this,arguments)},onSubmit:function(event){if(this.validate(event))this.reset()},reset:function(){this.getFields().each(this.resetField,this);return this},validate:function(event){var result=this.getFields().map(function(field){return this.validateField(field,true)},this).every(function(v){return v});this.fireEvent("formValidate",[result,this.element,event]);if(this.options.stopOnFailure&&!result&&event)event.preventDefault();return result},validateField:function(field,force){if(this.paused)return true;field=document.id(field);var passed=!field.hasClass("validation-failed");var failed,warned;if(this.options.serial&&!force){failed=this.element.getElement(".validation-failed");warned=this.element.getElement(".warning")}if(field&&(!failed||force||field.hasClass("validation-failed")||failed&&!this.options.serial)){var validationTypes=field.get("validators");var validators=validationTypes.some(function(cn){return this.getValidator(cn)},this);var validatorsFailed=[];validationTypes.each(function(className){if(className&&!this.test(className,field))validatorsFailed.include(className)},this);passed=validatorsFailed.length===0;if(validators&&!this.hasValidator(field,"warnOnly")){if(passed){field.addClass("validation-passed").removeClass("validation-failed");this.fireEvent("elementPass",[field])}else{field.addClass("validation-failed").removeClass("validation-passed");this.fireEvent("elementFail",[field,validatorsFailed])}}if(!warned){var warnings=validationTypes.some(function(cn){if(cn.test("^warn"))return this.getValidator(cn.replace(/^warn-/,""));else return null},this);field.removeClass("warning");var warnResult=validationTypes.map(function(cn){if(cn.test("^warn"))return this.test(cn.replace(/^warn-/,""),field,true);else return null},this)}}return passed},test:function(className,field,warn){field=document.id(field);if(this.options.ignoreHidden&&!field.isVisible()||this.options.ignoreDisabled&&field.get("disabled"))return true;var validator=this.getValidator(className);if(warn!=null)warn=false;if(this.hasValidator(field,"warnOnly"))warn=true;var isValid=this.hasValidator(field,"ignoreValidation")||(validator?validator.test(field):true);if(validator&&field.isVisible())this.fireEvent("elementValidate",[isValid,field,className,warn]);if(warn)return true;return isValid},hasValidator:function(field,value){return field.get("validators").contains(value)},resetField:function(field){field=document.id(field);if(field){field.get("validators").each(function(className){if(className.test("^warn-"))className=className.replace(/^warn-/,"");field.removeClass("validation-failed");field.removeClass("warning");field.removeClass("validation-passed")},this)}return this},stop:function(){this.paused=true;return this},start:function(){this.paused=false;return this},ignoreField:function(field,warn){field=document.id(field);if(field){this.enforceField(field);if(warn)field.addClass("warnOnly");else field.addClass("ignoreValidation")}return this},enforceField:function(field){field=document.id(field);if(field)field.removeClass("warnOnly").removeClass("ignoreValidation");return this}});Form.Validator.getMsg=function(key){return Locale.get("FormValidator."+key)};Form.Validator.adders={validators:{},add:function(className,options){this.validators[className]=new InputValidator(className,options);if(!this.initialize){this.implement({validators:this.validators})}},addAllThese:function(validators){Array.from(validators).each(function(validator){this.add(validator[0],validator[1])},this)},getValidator:function(className){return this.validators[className.split(":")[0]]}};Object.append(Form.Validator,Form.Validator.adders);Form.Validator.implement(Form.Validator.adders);Form.Validator.add("IsEmpty",{errorMsg:false,test:function(element){if(element.type=="select-one"||element.type=="select")return!(element.selectedIndex>=0&&element.options[element.selectedIndex].value!="");else return element.get("value")==null||element.get("value").length==0}});Form.Validator.addAllThese([["required",{errorMsg:function(){return Form.Validator.getMsg("required")},test:function(element){return!Form.Validator.getValidator("IsEmpty").test(element)}}],["length",{errorMsg:function(element,props){if(typeOf(props.length)!="null")return Form.Validator.getMsg("length").substitute({length:props.length,elLength:element.get("value").length});else return""},test:function(element,props){if(typeOf(props.length)!="null")return element.get("value").length==props.length||element.get("value").length==0;else return true}}],["minLength",{errorMsg:function(element,props){if(typeOf(props.minLength)!="null")return Form.Validator.getMsg("minLength").substitute({minLength:props.minLength,length:element.get("value").length});else return""},test:function(element,props){if(typeOf(props.minLength)!="null")return element.get("value").length>=(props.minLength||0);else return true}}],["maxLength",{errorMsg:function(element,props){if(typeOf(props.maxLength)!="null")return Form.Validator.getMsg("maxLength").substitute({maxLength:props.maxLength,length:element.get("value").length});else return""},test:function(element,props){return element.get("value").length<=(props.maxLength||1e4)}}],["validate-integer",{errorMsg:Form.Validator.getMsg.pass("integer"),test:function(element){return Form.Validator.getValidator("IsEmpty").test(element)||/^(-?[1-9]\d*|0)$/.test(element.get("value"))}}],["validate-numeric",{errorMsg:Form.Validator.getMsg.pass("numeric"),test:function(element){return Form.Validator.getValidator("IsEmpty").test(element)||/^-?(?:0$0(?=\d*\.)|[1-9]|0)\d*(\.\d+)?$/.test(element.get("value"))}}],["validate-digits",{errorMsg:Form.Validator.getMsg.pass("digits"),test:function(element){return Form.Validator.getValidator("IsEmpty").test(element)||/^[\d() .:\-\+#]+$/.test(element.get("value"))}}],["validate-alpha",{errorMsg:Form.Validator.getMsg.pass("alpha"),test:function(element){return Form.Validator.getValidator("IsEmpty").test(element)||/^[a-zA-Z]+$/.test(element.get("value"))}}],["validate-alphanum",{errorMsg:Form.Validator.getMsg.pass("alphanum"),test:function(element){return Form.Validator.getValidator("IsEmpty").test(element)||!/\W/.test(element.get("value"))}}],["validate-date",{errorMsg:function(element,props){if(Date.parse){var format=props.dateFormat||"%x";return Form.Validator.getMsg("dateSuchAs").substitute({date:(new Date).format(format)})}else{return Form.Validator.getMsg("dateInFormatMDY")}},test:function(element,props){if(Form.Validator.getValidator("IsEmpty").test(element))return true;var dateLocale=Locale.getCurrent().sets.Date,dateNouns=new RegExp([dateLocale.days,dateLocale.days_abbr,dateLocale.months,dateLocale.months_abbr].flatten().join("|"),"i"),value=element.get("value"),wordsInValue=value.match(/[a-z]+/gi);if(wordsInValue&&!wordsInValue.every(dateNouns.exec,dateNouns))return false;var date=Date.parse(value),format=props.dateFormat||"%x",formatted=date.format(format);if(formatted!="invalid date")element.set("value",formatted);return date.isValid()}}],["validate-email",{errorMsg:Form.Validator.getMsg.pass("email"),test:function(element){var regex_wo_chars=/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]\.?){0,63}[a-z0-9!#$%&'*+\/=?^_`{|}~-]@(?:(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)*[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\])$/i,regex_w_chars=/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]\.?){0,63}[a-z0-!#$%&'*+\/=?^_`{|}~-]@(?:(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)*[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\])$/i;return Form.Validator.getValidator("IsEmpty").test(element)||regex_w_chars.test(element.get("value"))}}],["validate-url",{errorMsg:Form.Validator.getMsg.pass("url"),test:function(element){return Form.Validator.getValidator("IsEmpty").test(element)||/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(element.get("value"))}}],["validate-currency-dollar",{errorMsg:Form.Validator.getMsg.pass("currencyDollar"),test:function(element){return Form.Validator.getValidator("IsEmpty").test(element)||/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(element.get("value"))}}],["validate-one-required",{errorMsg:Form.Validator.getMsg.pass("oneRequired"),test:function(element,props){var p=document.id(props["validate-one-required"])||element.getParent(props["validate-one-required"]);return p.getElements("input").some(function(el){if(["checkbox","radio"].contains(el.get("type")))return el.get("checked");return el.get("value")})}}]]);Element.Properties.validator={set:function(options){this.get("validator").setOptions(options)},get:function(){var validator=this.retrieve("validator");if(!validator){validator=new Form.Validator(this);this.store("validator",validator)}return validator}};Element.implement({validate:function(options){if(options)this.set("validator",options);return this.get("validator").validate()}});Form.Validator.Inline=new Class({Extends:Form.Validator,options:{showError:function(errorElement){if(errorElement.reveal)errorElement.reveal();else errorElement.setStyle("display","block")},hideError:function(errorElement){if(errorElement.dissolve)errorElement.dissolve();else errorElement.setStyle("display","none")},scrollToErrorsOnSubmit:true,scrollToErrorsOnBlur:false,scrollToErrorsOnChange:false,scrollFxOptions:{transition:"quad:out",offset:{y:-20}}},initialize:function(form,options){this.parent(form,options);this.addEvent("onElementValidate",function(isValid,field,className,warn){var validator=this.getValidator(className);if(!isValid&&validator.getError(field)){if(warn)field.addClass("warning");var advice=this.makeAdvice(className,field,validator.getError(field),warn);this.insertAdvice(advice,field);this.showAdvice(className,field)}else{this.hideAdvice(className,field)}})},makeAdvice:function(className,field,error,warn){var errorMsg=warn?this.warningPrefix:this.errorPrefix;errorMsg+=this.options.useTitles?field.title||error:error;var cssClass=warn?"warning-advice":"validation-advice";var advice=this.getAdvice(className,field);if(advice){advice=advice.set("html",errorMsg)}else{advice=new Element("div",{html:errorMsg,styles:{display:"none"},id:"advice-"+className.split(":")[0]+"-"+this.getFieldId(field)}).addClass(cssClass)}field.store("$moo:advice-"+className,advice);return advice},getFieldId:function(field){return field.id?field.id:field.id="input_"+field.name},showAdvice:function(className,field){var advice=this.getAdvice(className,field);if(advice&&!field.retrieve("$moo:"+this.getPropName(className))&&(advice.getStyle("display")=="none"||advice.getStyle("visiblity")=="hidden"||advice.getStyle("opacity")==0)){field.store("$moo:"+this.getPropName(className),true);this.options.showError(advice);this.fireEvent("showAdvice",[field,advice,className])}},hideAdvice:function(className,field){var advice=this.getAdvice(className,field);if(advice&&field.retrieve("$moo:"+this.getPropName(className))){field.store("$moo:"+this.getPropName(className),false);this.options.hideError(advice);this.fireEvent("hideAdvice",[field,advice,className])}},getPropName:function(className){return"advice"+className},resetField:function(field){field=document.id(field);if(!field)return this;this.parent(field);field.get("validators").each(function(className){this.hideAdvice(className,field)},this);return this},getAllAdviceMessages:function(field,force){var advice=[];if(field.hasClass("ignoreValidation")&&!force)return advice;var validators=field.get("validators").some(function(cn){var warner=cn.test("^warn-")||field.hasClass("warnOnly");if(warner)cn=cn.replace(/^warn-/,"");var validator=this.getValidator(cn);if(!validator)return;advice.push({message:validator.getError(field),warnOnly:warner,passed:validator.test(),validator:validator})},this);return advice},getAdvice:function(className,field){return field.retrieve("$moo:advice-"+className)},insertAdvice:function(advice,field){
var props=field.get("validatorProps");if(!props.msgPos||!document.id(props.msgPos)){if(field.type&&field.type.toLowerCase()=="radio")field.getParent().adopt(advice);else advice.inject(document.id(field),"after")}else{document.id(props.msgPos).grab(advice)}},validateField:function(field,force,scroll){var result=this.parent(field,force);if((this.options.scrollToErrorsOnSubmit&&scroll==null||scroll)&&!result){var failed=document.id(this).getElement(".validation-failed");var par=document.id(this).getParent();while(par!=document.body&&par.getScrollSize().y==par.getSize().y){par=par.getParent()}var fx=par.retrieve("$moo:fvScroller");if(!fx&&window.Fx&&Fx.Scroll){fx=new Fx.Scroll(par,this.options.scrollFxOptions);par.store("$moo:fvScroller",fx)}if(failed){if(fx)fx.toElement(failed);else par.scrollTo(par.getScroll().x,failed.getPosition(par).y-20)}}return result},watchFields:function(fields){fields.each(function(el){if(this.options.evaluateFieldsOnBlur){el.addEvent("blur",this.validationMonitor.pass([el,false,this.options.scrollToErrorsOnBlur],this))}if(this.options.evaluateFieldsOnChange){el.addEvent("change",this.validationMonitor.pass([el,true,this.options.scrollToErrorsOnChange],this))}},this)}});Form.Validator.addAllThese([["validate-enforce-oncheck",{test:function(element,props){var fv=element.getParent("form").retrieve("validator");if(!fv)return true;(props.toEnforce||document.id(props.enforceChildrenOf).getElements("input, select, textarea")).map(function(item){if(element.checked){fv.enforceField(item)}else{fv.ignoreField(item);fv.resetField(item)}});return true}}],["validate-ignore-oncheck",{test:function(element,props){var fv=element.getParent("form").retrieve("validator");if(!fv)return true;(props.toIgnore||document.id(props.ignoreChildrenOf).getElements("input, select, textarea")).each(function(item){if(element.checked){fv.ignoreField(item);fv.resetField(item)}else{fv.enforceField(item)}});return true}}],["validate-nospace",{errorMsg:function(){return Form.Validator.getMsg("noSpace")},test:function(element,props){return!element.get("value").test(/\s/)}}],["validate-toggle-oncheck",{test:function(element,props){var fv=element.getParent("form").retrieve("validator");if(!fv)return true;var eleArr=props.toToggle||document.id(props.toToggleChildrenOf).getElements("input, select, textarea");if(!element.checked){eleArr.each(function(item){fv.ignoreField(item);fv.resetField(item)})}else{eleArr.each(function(item){fv.enforceField(item)})}return true}}],["validate-reqchk-bynode",{errorMsg:function(){return Form.Validator.getMsg("reqChkByNode")},test:function(element,props){return document.id(props.nodeId).getElements(props.selector||"input[type=checkbox], input[type=radio]").some(function(item){return item.checked})}}],["validate-required-check",{errorMsg:function(element,props){return props.useTitle?element.get("title"):Form.Validator.getMsg("requiredChk")},test:function(element,props){return!!element.checked}}],["validate-reqchk-byname",{errorMsg:function(element,props){return Form.Validator.getMsg("reqChkByName").substitute({label:props.label||element.get("type")})},test:function(element,props){var grpName=props.groupName||element.get("name");var oneCheckedItem=$$(document.getElementsByName(grpName)).some(function(item,index){return item.checked});var fv=element.getParent("form").retrieve("validator");if(oneCheckedItem&&fv)fv.resetField(element);return oneCheckedItem}}],["validate-match",{errorMsg:function(element,props){return Form.Validator.getMsg("match").substitute({matchName:props.matchName||document.id(props.matchInput).get("name")})},test:function(element,props){var eleVal=element.get("value");var matchVal=document.id(props.matchInput)&&document.id(props.matchInput).get("value");return eleVal&&matchVal?eleVal==matchVal:true}}],["validate-after-date",{errorMsg:function(element,props){return Form.Validator.getMsg("afterDate").substitute({label:props.afterLabel||(props.afterElement?Form.Validator.getMsg("startDate"):Form.Validator.getMsg("currentDate"))})},test:function(element,props){var start=document.id(props.afterElement)?Date.parse(document.id(props.afterElement).get("value")):new Date;var end=Date.parse(element.get("value"));return end&&start?end>=start:true}}],["validate-before-date",{errorMsg:function(element,props){return Form.Validator.getMsg("beforeDate").substitute({label:props.beforeLabel||(props.beforeElement?Form.Validator.getMsg("endDate"):Form.Validator.getMsg("currentDate"))})},test:function(element,props){var start=Date.parse(element.get("value"));var end=document.id(props.beforeElement)?Date.parse(document.id(props.beforeElement).get("value")):new Date;return end&&start?end>=start:true}}],["validate-custom-required",{errorMsg:function(){return Form.Validator.getMsg("required")},test:function(element,props){return element.get("value")!=props.emptyValue}}],["validate-same-month",{errorMsg:function(element,props){var startMo=document.id(props.sameMonthAs)&&document.id(props.sameMonthAs).get("value");var eleVal=element.get("value");if(eleVal!="")return Form.Validator.getMsg(startMo?"sameMonth":"startMonth")},test:function(element,props){var d1=Date.parse(element.get("value"));var d2=Date.parse(document.id(props.sameMonthAs)&&document.id(props.sameMonthAs).get("value"));return d1&&d2?d1.format("%B")==d2.format("%B"):true}}],["validate-cc-num",{errorMsg:function(element){var ccNum=element.get("value").replace(/[^0-9]/g,"");return Form.Validator.getMsg("creditcard").substitute({length:ccNum.length})},test:function(element){if(Form.Validator.getValidator("IsEmpty").test(element))return true;var ccNum=element.get("value");ccNum=ccNum.replace(/[^0-9]/g,"");var valid_type=false;if(ccNum.test(/^4[0-9]{12}([0-9]{3})?$/))valid_type="Visa";else if(ccNum.test(/^5[1-5]([0-9]{14})$/))valid_type="Master Card";else if(ccNum.test(/^3[47][0-9]{13}$/))valid_type="American Express";else if(ccNum.test(/^6011[0-9]{12}$/))valid_type="Discover";if(valid_type){var sum=0;var cur=0;for(var i=ccNum.length-1;i>=0;--i){cur=ccNum.charAt(i).toInt();if(cur==0)continue;if((ccNum.length-i)%2==0)cur+=cur;if(cur>9){cur=cur.toString().charAt(0).toInt()+cur.toString().charAt(1).toInt()}sum+=cur}if(sum%10==0)return true}var chunks="";while(ccNum!=""){chunks+=" "+ccNum.substr(0,4);ccNum=ccNum.substr(4)}element.getParent("form").retrieve("validator").ignoreField(element);element.set("value",chunks.clean());element.getParent("form").retrieve("validator").enforceField(element);return false}}]]);var OverText=new Class({Implements:[Options,Events,Class.Occlude],Binds:["reposition","assert","focus","hide"],options:{element:"label",labelClass:"overTxtLabel",positionOptions:{position:"upperLeft",edge:"upperLeft",offset:{x:4,y:2}},poll:false,pollInterval:250,wrap:false},property:"OverText",initialize:function(element,options){element=this.element=document.id(element);if(this.occlude())return this.occluded;this.setOptions(options);this.attach(element);OverText.instances.push(this);if(this.options.poll)this.poll()},toElement:function(){return this.element},attach:function(){var element=this.element,options=this.options,value=options.textOverride||element.get("alt")||element.get("title");if(!value)return this;var text=this.text=new Element(options.element,{"class":options.labelClass,styles:{lineHeight:"normal",position:"absolute",cursor:"text"},html:value,events:{click:this.hide.pass(options.element=="label",this)}}).inject(element,"after");if(options.element=="label"){if(!element.get("id"))element.set("id","input_"+String.uniqueID());text.set("for",element.get("id"))}if(options.wrap){this.textHolder=new Element("div.overTxtWrapper",{styles:{lineHeight:"normal",position:"relative"}}).grab(text).inject(element,"before")}return this.enable()},destroy:function(){this.element.eliminate(this.property);this.disable();if(this.text)this.text.destroy();if(this.textHolder)this.textHolder.destroy();return this},disable:function(){this.element.removeEvents({focus:this.focus,blur:this.assert,change:this.assert});window.removeEvent("resize",this.reposition);this.hide(true,true);return this},enable:function(){this.element.addEvents({focus:this.focus,blur:this.assert,change:this.assert});window.addEvent("resize",this.reposition);this.reposition();return this},wrap:function(){if(this.options.element=="label"){if(!this.element.get("id"))this.element.set("id","input_"+String.uniqueID());this.text.set("for",this.element.get("id"))}},startPolling:function(){this.pollingPaused=false;return this.poll()},poll:function(stop){if(this.poller&&!stop)return this;if(stop){clearInterval(this.poller)}else{this.poller=function(){if(!this.pollingPaused)this.assert(true)}.periodical(this.options.pollInterval,this)}return this},stopPolling:function(){this.pollingPaused=true;return this.poll(true)},focus:function(){if(this.text&&(!this.text.isDisplayed()||this.element.get("disabled")))return this;return this.hide()},hide:function(suppressFocus,force){if(this.text&&(this.text.isDisplayed()&&(!this.element.get("disabled")||force))){this.text.hide();this.fireEvent("textHide",[this.text,this.element]);this.pollingPaused=true;if(!suppressFocus){try{this.element.fireEvent("focus");this.element.focus()}catch(e){}}}return this},show:function(){if(this.text&&!this.text.isDisplayed()){this.text.show();this.reposition();this.fireEvent("textShow",[this.text,this.element]);this.pollingPaused=false}return this},test:function(){return!this.element.get("value")},assert:function(suppressFocus){return this[this.test()?"show":"hide"](suppressFocus)},reposition:function(){this.assert(true);if(!this.element.isVisible())return this.stopPolling().hide();if(this.text&&this.test()){this.text.position(Object.merge(this.options.positionOptions,{relativeTo:this.element}))}return this}});OverText.instances=[];Object.append(OverText,{each:function(fn){return OverText.instances.each(function(ot,i){if(ot.element&&ot.text)fn.call(OverText,ot,i)})},update:function(){return OverText.each(function(ot){return ot.reposition()})},hideAll:function(){return OverText.each(function(ot){return ot.hide(true,true)})},showAll:function(){return OverText.each(function(ot){return ot.show()})}});Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(elements,options){this.elements=this.subject=$$(elements);this.parent(options)},compute:function(from,to,delta){var now={};for(var i in from){var iFrom=from[i],iTo=to[i],iNow=now[i]={};for(var p in iFrom)iNow[p]=this.parent(iFrom[p],iTo[p],delta)}return now},set:function(now){for(var i in now){if(!this.elements[i])continue;var iNow=now[i];for(var p in iNow)this.render(this.elements[i],p,iNow[p],this.options.unit)}return this},start:function(obj){if(!this.check(obj))return this;var from={},to={};for(var i in obj){if(!this.elements[i])continue;var iProps=obj[i],iFrom=from[i]={},iTo=to[i]={};for(var p in iProps){var parsed=this.prepare(this.elements[i],p,iProps[p]);iFrom[p]=parsed.from;iTo[p]=parsed.to}}return this.parent(from,to)}});Fx.Accordion=new Class({Extends:Fx.Elements,options:{fixedHeight:false,fixedWidth:false,display:0,show:false,height:true,width:false,opacity:true,alwaysHide:false,trigger:"click",initialDisplayFx:true,resetHeight:true},initialize:function(){var defined=function(obj){return obj!=null};var params=Array.link(arguments,{container:Type.isElement,options:Type.isObject,togglers:defined,elements:defined});this.parent(params.elements,params.options);var options=this.options,togglers=this.togglers=$$(params.togglers);this.previous=-1;this.internalChain=new Chain;if(options.alwaysHide)this.options.link="chain";if(options.show||this.options.show===0){options.display=false;this.previous=options.show}if(options.start){options.display=false;options.show=false}var effects=this.effects={};if(options.opacity)effects.opacity="fullOpacity";if(options.width)effects.width=options.fixedWidth?"fullWidth":"offsetWidth";if(options.height)effects.height=options.fixedHeight?"fullHeight":"scrollHeight";for(var i=0,l=togglers.length;i<l;i++)this.addSection(togglers[i],this.elements[i]);this.elements.each(function(el,i){if(options.show===i){this.fireEvent("active",[togglers[i],el])}else{for(var fx in effects)el.setStyle(fx,0)}},this);if(options.display||options.display===0||options.initialDisplayFx===false){this.display(options.display,options.initialDisplayFx)}if(options.fixedHeight!==false)options.resetHeight=false;this.addEvent("complete",this.internalChain.callChain.bind(this.internalChain))},addSection:function(toggler,element){toggler=document.id(toggler);element=document.id(element);this.togglers.include(toggler);this.elements.include(element);var togglers=this.togglers,options=this.options,test=togglers.contains(toggler),idx=togglers.indexOf(toggler),displayer=this.display.pass(idx,this);toggler.store("accordion:display",displayer).addEvent(options.trigger,displayer);if(options.height)element.setStyles({"padding-top":0,"border-top":"none","padding-bottom":0,"border-bottom":"none"});if(options.width)element.setStyles({"padding-left":0,"border-left":"none","padding-right":0,"border-right":"none"});element.fullOpacity=1;if(options.fixedWidth)element.fullWidth=options.fixedWidth;if(options.fixedHeight)element.fullHeight=options.fixedHeight;element.setStyle("overflow","hidden");if(!test)for(var fx in this.effects){element.setStyle(fx,0)}return this},removeSection:function(toggler,displayIndex){var togglers=this.togglers,idx=togglers.indexOf(toggler),element=this.elements[idx];var remover=function(){togglers.erase(toggler);this.elements.erase(element);this.detach(toggler)}.bind(this);if(this.now==idx||displayIndex!=null){this.display(displayIndex!=null?displayIndex:idx-1>=0?idx-1:0).chain(remover)}else{remover()}return this},detach:function(toggler){var remove=function(toggler){toggler.removeEvent(this.options.trigger,toggler.retrieve("accordion:display"))}.bind(this);if(!toggler)this.togglers.each(remove);else remove(toggler);return this},display:function(index,useFx){if(!this.check(index,useFx))return this;var obj={},elements=this.elements,options=this.options,effects=this.effects;if(useFx==null)useFx=true;if(typeOf(index)=="element")index=elements.indexOf(index);if(index==this.previous&&!options.alwaysHide)return this;if(options.resetHeight){var prev=elements[this.previous];if(prev&&!this.selfHidden){for(var fx in effects)prev.setStyle(fx,prev[effects[fx]])}}if(this.timer&&options.link=="chain"||index===this.previous&&!options.alwaysHide)return this;this.previous=index;this.selfHidden=false;elements.each(function(el,i){obj[i]={};var hide;if(i!=index){hide=true}else if(options.alwaysHide&&(el.offsetHeight>0&&options.height||el.offsetWidth>0&&options.width)){hide=true;this.selfHidden=true}this.fireEvent(hide?"background":"active",[this.togglers[i],el]);for(var fx in effects)obj[i][fx]=hide?0:el[effects[fx]];if(!useFx&&!hide&&options.resetHeight)obj[i].height="auto"},this);this.internalChain.clearChain();this.internalChain.chain(function(){if(options.resetHeight&&!this.selfHidden){var el=elements[index];if(el)el.setStyle("height","auto")}}.bind(this));return useFx?this.start(obj):this.set(obj).internalChain.callChain()}});(function(){Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:true},initialize:function(element,options){this.element=this.subject=document.id(element);this.parent(options);if(typeOf(this.element)!="element")this.element=document.id(this.element.getDocument().body);if(this.options.wheelStops){var stopper=this.element,cancel=this.cancel.pass(false,this);this.addEvent("start",function(){stopper.addEvent("mousewheel",cancel)},true);this.addEvent("complete",function(){stopper.removeEvent("mousewheel",cancel)},true)}},set:function(){var now=Array.flatten(arguments);if(Browser.firefox)now=[Math.round(now[0]),Math.round(now[1])];this.element.scrollTo(now[0],now[1]);return this},compute:function(from,to,delta){return[0,1].map(function(i){return Fx.compute(from[i],to[i],delta)})},start:function(x,y){try{if(!this.check(x,y))return this;var scroll=this.element.getScroll();return this.parent([scroll.x,scroll.y],[x,y])}catch(x){}},calculateScroll:function(x,y){var element=this.element,scrollSize=element.getScrollSize(),scroll=element.getScroll(),size=element.getSize(),offset=this.options.offset,values={x:x,y:y};for(var z in values){if(!values[z]&&values[z]!==0)values[z]=scroll[z];if(typeOf(values[z])!="number")values[z]=scrollSize[z]-size[z];values[z]+=offset[z]}return[values.x,values.y]},toTop:function(){return this.start.apply(this,this.calculateScroll(false,0))},toLeft:function(){return this.start.apply(this,this.calculateScroll(0,false))},toRight:function(){return this.start.apply(this,this.calculateScroll("right",false))},toBottom:function(){return this.start.apply(this,this.calculateScroll(false,"bottom"))},toElement:function(el,axes){axes=axes?Array.from(axes):["x","y"];var scroll=isBody(this.element)?{x:0,y:0}:this.element.getScroll();var position=Object.map(document.id(el).getPosition(this.element),function(value,axis){return axes.contains(axis)?value+scroll[axis]:false});return this.start.apply(this,this.calculateScroll(position.x,position.y))},toElementEdge:function(el,axes,offset){axes=axes?Array.from(axes):["x","y"];el=document.id(el);var to={},position=el.getPosition(this.element),size=el.getSize(),scroll=this.element.getScroll(),containerSize=this.element.getSize(),edge={x:position.x+size.x,y:position.y+size.y};["x","y"].each(function(axis){if(axes.contains(axis)){if(edge[axis]>scroll[axis]+containerSize[axis])to[axis]=edge[axis]-containerSize[axis];if(position[axis]<scroll[axis])to[axis]=position[axis]}if(to[axis]==null)to[axis]=scroll[axis];if(offset&&offset[axis])to[axis]=to[axis]+offset[axis]},this);if(to.x!=scroll.x||to.y!=scroll.y)this.start(to.x,to.y);return this},toElementCenter:function(el,axes,offset){axes=axes?Array.from(axes):["x","y"];el=document.id(el);var to={},position=el.getPosition(this.element),size=el.getSize(),scroll=this.element.getScroll(),containerSize=this.element.getSize();["x","y"].each(function(axis){if(axes.contains(axis)){to[axis]=position[axis]-(containerSize[axis]-size[axis])/2}if(to[axis]==null)to[axis]=scroll[axis];if(offset&&offset[axis])to[axis]=to[axis]+offset[axis]},this);if(to.x!=scroll.x||to.y!=scroll.y)this.start(to.x,to.y);return this}});function isBody(element){return/^(?:body|html)$/i.test(element.tagName)}})();var Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:false,style:true,limit:false,handle:false,invert:false,preventDefault:false,stopPropagation:false,modifiers:{x:"left",y:"top"}},initialize:function(){var params=Array.link(arguments,{options:Type.isObject,element:function(obj){return obj!=null}});this.element=document.id(params.element);this.document=this.element.getDocument();this.setOptions(params.options||{});var htype=typeOf(this.options.handle);this.handles=(htype=="array"||htype=="collection"?$$(this.options.handle):document.id(this.options.handle))||this.element;this.mouse={now:{},pos:{}};this.value={start:{},now:{}};this.selection=Browser.ie?"selectstart":"mousedown";if(Browser.ie&&!Drag.ondragstartFixed){document.ondragstart=Function.from(false);Drag.ondragstartFixed=true}this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.from(false)};this.attach()},attach:function(){this.handles.addEvent("mousedown",this.bound.start);return this},detach:function(){this.handles.removeEvent("mousedown",this.bound.start);return this},start:function(event){var options=this.options;if(event.rightClick)return;if(options.preventDefault)event.preventDefault();if(options.stopPropagation)event.stopPropagation();this.mouse.start=event.page;this.fireEvent("beforeStart",this.element);var limit=options.limit;this.limit={x:[],y:[]};var z,coordinates;for(z in options.modifiers){if(!options.modifiers[z])continue;var style=this.element.getStyle(options.modifiers[z]);if(style&&!style.match(/px$/)){if(!coordinates)coordinates=this.element.getCoordinates(this.element.getOffsetParent());style=coordinates[options.modifiers[z]]}if(options.style)this.value.now[z]=(style||0).toInt();else this.value.now[z]=this.element[options.modifiers[z]];if(options.invert)this.value.now[z]*=-1;this.mouse.pos[z]=event.page[z]-this.value.now[z];if(limit&&limit[z]){var i=2;while(i--){var limitZI=limit[z][i];if(limitZI||limitZI===0)this.limit[z][i]=typeof limitZI=="function"?limitZI():limitZI}}}if(typeOf(this.options.grid)=="number")this.options.grid={x:this.options.grid,y:this.options.grid};var events={mousemove:this.bound.check,mouseup:this.bound.cancel};events[this.selection]=this.bound.eventStop;this.document.addEvents(events)},check:function(event){if(this.options.preventDefault)event.preventDefault();var distance=Math.round(Math.sqrt(Math.pow(event.page.x-this.mouse.start.x,2)+Math.pow(event.page.y-this.mouse.start.y,2)));if(distance>this.options.snap){this.cancel();this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop});this.fireEvent("start",[this.element,event]).fireEvent("snap",this.element)}},drag:function(event){var options=this.options;if(options.preventDefault)event.preventDefault();this.mouse.now=event.page;for(var z in options.modifiers){if(!options.modifiers[z])continue;this.value.now[z]=this.mouse.now[z]-this.mouse.pos[z];if(options.invert)this.value.now[z]*=-1;if(options.limit&&this.limit[z]){if((this.limit[z][1]||this.limit[z][1]===0)&&this.value.now[z]>this.limit[z][1]){this.value.now[z]=this.limit[z][1]}else if((this.limit[z][0]||this.limit[z][0]===0)&&this.value.now[z]<this.limit[z][0]){this.value.now[z]=this.limit[z][0]}}if(options.grid[z])this.value.now[z]-=(this.value.now[z]-(this.limit[z][0]||0))%options.grid[z];if(options.style)this.element.setStyle(options.modifiers[z],this.value.now[z]+options.unit);else this.element[options.modifiers[z]]=this.value.now[z]}this.fireEvent("drag",[this.element,event])},cancel:function(event){this.document.removeEvents({mousemove:this.bound.check,mouseup:this.bound.cancel});if(event){this.document.removeEvent(this.selection,this.bound.eventStop);this.fireEvent("cancel",this.element)}},stop:function(event){var events={mousemove:this.bound.drag,mouseup:this.bound.stop};events[this.selection]=this.bound.eventStop;this.document.removeEvents(events);if(event)this.fireEvent("complete",[this.element,event])}});Element.implement({makeResizable:function(options){var drag=new Drag(this,Object.merge({modifiers:{x:"width",y:"height"}},options));this.store("resizer",drag);return drag.addEvent("drag",function(){this.fireEvent("resize",drag)}.bind(this))}});var Slider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(position){this.setKnobPosition(position)},initialStep:0,snap:false,offset:0,range:false,wheel:false,steps:100,mode:"horizontal"},initialize:function(element,knob,options){this.setOptions(options);options=this.options;this.element=document.id(element);knob=this.knob=document.id(knob);this.previousChange=this.previousEnd=this.step=-1;var limit={},modifiers={x:false,y:false};switch(options.mode){case"vertical":this.axis="y";this.property="top";this.offset="offsetHeight";break;case"horizontal":this.axis="x";this.property="left";this.offset="offsetWidth"}this.setSliderDimensions();this.setRange(options.range);if(knob.getStyle("position")=="static")knob.setStyle("position","relative");knob.setStyle(this.property,-options.offset);modifiers[this.axis]=this.property;limit[this.axis]=[-options.offset,this.full-options.offset];var dragOptions={snap:0,limit:limit,modifiers:modifiers,onDrag:this.draggedKnob,onStart:this.draggedKnob,onBeforeStart:function(){this.isDragging=true}.bind(this),onCancel:function(){this.isDragging=false}.bind(this),onComplete:function(){this.isDragging=false;this.draggedKnob();this.end()}.bind(this)};if(options.snap)this.setSnap(dragOptions);this.drag=new Drag(knob,dragOptions);this.attach();if(options.initialStep!=null)this.set(options.initialStep)},attach:function(){this.element.addEvent("mousedown",this.clickedElement);if(this.options.wheel)this.element.addEvent("mousewheel",this.scrolledElement);this.drag.attach();return this},detach:function(){this.element.removeEvent("mousedown",this.clickedElement).removeEvent("mousewheel",this.scrolledElement);this.drag.detach();return this},autosize:function(){this.setSliderDimensions().setKnobPosition(this.toPosition(this.step));this.drag.options.limit[this.axis]=[-this.options.offset,this.full-this.options.offset];if(this.options.snap)this.setSnap();return this},setSnap:function(options){if(!options)options=this.drag.options;options.grid=Math.ceil(this.stepWidth);options.limit[this.axis][1]=this.full;return this},setKnobPosition:function(position){if(this.options.snap)position=this.toPosition(this.step);this.knob.setStyle(this.property,position);return this},setSliderDimensions:function(){this.full=this.element.measure(function(){this.half=this.knob[this.offset]/2;return this.element[this.offset]-this.knob[this.offset]+this.options.offset*2}.bind(this));return this},set:function(step){if(!(this.range>0^step<this.min))step=this.min;if(!(this.range>0^step>this.max))step=this.max;this.step=Math.round(step);return this.checkStep().fireEvent("tick",this.toPosition(this.step)).end()},setRange:function(range,pos){this.min=Array.pick([range[0],0]);this.max=Array.pick([range[1],this.options.steps]);this.range=this.max-this.min;this.steps=this.options.steps||this.full;this.stepSize=Math.abs(this.range)/this.steps;this.stepWidth=this.stepSize*this.full/Math.abs(this.range);if(range)this.set(Array.pick([pos,this.step]).floor(this.min).max(this.max));return this},clickedElement:function(event){if(this.isDragging||event.target==this.knob)return;var dir=this.range<0?-1:1,position=event.page[this.axis]-this.element.getPosition()[this.axis]-this.half;position=position.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+dir*this.toStep(position));this.checkStep().fireEvent("tick",position).end()},scrolledElement:function(event){var mode=this.options.mode=="horizontal"?event.wheel<0:event.wheel>0;this.set(this.step+(mode?-1:1)*this.stepSize);event.stop()},draggedKnob:function(){var dir=this.range<0?-1:1,position=this.drag.value.now[this.axis];position=position.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+dir*this.toStep(position));this.checkStep()},checkStep:function(){var step=this.step;if(this.previousChange!=step){this.previousChange=step;this.fireEvent("change",step)}return this},end:function(){var step=this.step;if(this.previousEnd!==step){this.previousEnd=step;this.fireEvent("complete",step+"")}return this},toStep:function(position){var step=(position+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?Math.round(step-=step%this.stepSize):step},toPosition:function(step){return this.full*Math.abs(this.min-step)/(this.steps*this.stepSize)-this.options.offset}});Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:false,precalculate:false,includeMargins:true,checkDroppables:true},initialize:function(element,options){this.parent(element,options);element=this.element;this.droppables=$$(this.options.droppables);this.container=document.id(this.options.container);if(this.container&&typeOf(this.container)!="element")this.container=document.id(this.container.getDocument().body);if(this.options.style){if(this.options.modifiers.x=="left"&&this.options.modifiers.y=="top"){var parent=element.getOffsetParent(),styles=element.getStyles("left","top");if(parent&&(styles.left=="auto"||styles.top=="auto")){element.setPosition(element.getPosition(parent))}}if(element.getStyle("position")=="static")element.setStyle("position","absolute")}this.addEvent("start",this.checkDroppables,true);this.overed=null},start:function(event){if(this.container)this.options.limit=this.calculateLimit();if(this.options.precalculate){this.positions=this.droppables.map(function(el){return el.getCoordinates()})}this.parent(event)},calculateLimit:function(){var element=this.element,container=this.container,offsetParent=document.id(element.getOffsetParent())||document.body,containerCoordinates=container.getCoordinates(offsetParent),elementMargin={},elementBorder={},containerMargin={},containerBorder={},offsetParentPadding={};["top","right","bottom","left"].each(function(pad){elementMargin[pad]=element.getStyle("margin-"+pad).toInt();elementBorder[pad]=element.getStyle("border-"+pad).toInt();containerMargin[pad]=container.getStyle("margin-"+pad).toInt();containerBorder[pad]=container.getStyle("border-"+pad).toInt();offsetParentPadding[pad]=offsetParent.getStyle("padding-"+pad).toInt()},this);var width=element.offsetWidth+elementMargin.left+elementMargin.right,height=element.offsetHeight+elementMargin.top+elementMargin.bottom,left=0,top=0,right=containerCoordinates.right-containerBorder.right-width,bottom=containerCoordinates.bottom-containerBorder.bottom-height;if(this.options.includeMargins){left+=elementMargin.left;top+=elementMargin.top}else{right+=elementMargin.right;bottom+=elementMargin.bottom}if(element.getStyle("position")=="relative"){var coords=element.getCoordinates(offsetParent);coords.left-=element.getStyle("left").toInt();coords.top-=element.getStyle("top").toInt();left-=coords.left;top-=coords.top;if(container.getStyle("position")!="relative"){left+=containerBorder.left;top+=containerBorder.top}right+=elementMargin.left-coords.left;bottom+=elementMargin.top-coords.top;if(container!=offsetParent){left+=containerMargin.left+offsetParentPadding.left;top+=(Browser.ie6||Browser.ie7?0:containerMargin.top)+offsetParentPadding.top}}else{left-=elementMargin.left;top-=elementMargin.top;if(container!=offsetParent){left+=containerCoordinates.left+containerBorder.left;top+=containerCoordinates.top+containerBorder.top}}return{x:[left,right],y:[top,bottom]}},getDroppableCoordinates:function(element){var position=element.getCoordinates();if(element.getStyle("position")=="fixed"){var scroll=window.getScroll();position.left+=scroll.x;position.right+=scroll.x;position.top+=scroll.y;position.bottom+=scroll.y}return position},checkDroppables:function(){var overed=this.droppables.filter(function(el,i){el=this.positions?this.positions[i]:this.getDroppableCoordinates(el);var now=this.mouse.now;return now.x>el.left&&now.x<el.right&&now.y<el.bottom&&now.y>el.top},this).getLast();if(this.overed!=overed){if(this.overed)this.fireEvent("leave",[this.element,this.overed]);if(overed)this.fireEvent("enter",[this.element,overed]);this.overed=overed}},drag:function(event){this.parent(event);if(this.options.checkDroppables&&this.droppables.length)this.checkDroppables()},stop:function(event){this.checkDroppables();this.fireEvent("drop",[this.element,this.overed,event]);this.overed=null;return this.parent(event)}});Element.implement({makeDraggable:function(options){var drag=new Drag.Move(this,options);this.store("dragger",drag);return drag}});var Sortables=new Class({Implements:[Events,Options],options:{opacity:1,clone:false,revert:false,handle:false,dragOptions:{}},initialize:function(lists,options){this.setOptions(options);this.elements=[];this.lists=[];this.idle=true;this.addLists($$(document.id(lists)||lists));if(!this.options.clone)this.options.revert=false;if(this.options.revert)this.effect=new Fx.Morph(null,Object.merge({duration:250,link:"cancel"},this.options.revert))},attach:function(){this.addLists(this.lists);return this},detach:function(){this.lists=this.removeLists(this.lists);return this},addItems:function(){Array.flatten(arguments).each(function(element){this.elements.push(element);var start=element.retrieve("sortables:start",function(event){this.start.call(this,event,element)}.bind(this));(this.options.handle?element.getElement(this.options.handle)||element:element).addEvent("mousedown",start)},this);return this},
addLists:function(){Array.flatten(arguments).each(function(list){this.lists.include(list);this.addItems(list.getChildren())},this);return this},removeItems:function(){return $$(Array.flatten(arguments).map(function(element){this.elements.erase(element);var start=element.retrieve("sortables:start");(this.options.handle?element.getElement(this.options.handle)||element:element).removeEvent("mousedown",start);return element},this))},removeLists:function(){return $$(Array.flatten(arguments).map(function(list){this.lists.erase(list);this.removeItems(list.getChildren());return list},this))},getClone:function(event,element){if(!this.options.clone)return new Element(element.tagName).inject(document.body);if(typeOf(this.options.clone)=="function")return this.options.clone.call(this,event,element,this.list);var clone=element.clone(true).setStyles({margin:0,position:"absolute",visibility:"hidden",width:element.getStyle("width")}).addEvent("mousedown",function(event){element.fireEvent("mousedown",event)});if(clone.get("html").test("radio")){clone.getElements("input[type=radio]").each(function(input,i){input.set("name","clone_"+i);if(input.get("checked"))element.getElements("input[type=radio]")[i].set("checked",true)})}return clone.inject(this.list).setPosition(element.getPosition(element.getOffsetParent()))},getDroppables:function(){var droppables=this.list.getChildren().erase(this.clone).erase(this.element);if(!this.options.constrain)droppables.append(this.lists).erase(this.list);return droppables},insert:function(dragging,element){var where="inside";if(this.lists.contains(element)){this.list=element;this.drag.droppables=this.getDroppables()}else{where=this.element.getAllPrevious().contains(element)?"before":"after"}this.element.inject(element,where);this.fireEvent("sort",[this.element,this.clone])},start:function(event,element){if(!this.idle||event.rightClick||["button","input","a","textarea"].contains(event.target.get("tag")))return;this.idle=false;this.element=element;this.opacity=element.getStyle("opacity");this.list=element.getParent();this.clone=this.getClone(event,element);this.drag=new Drag.Move(this.clone,Object.merge({droppables:this.getDroppables()},this.options.dragOptions)).addEvents({onSnap:function(){event.stop();this.clone.setStyle("visibility","visible");this.element.setStyle("opacity",this.options.opacity||0);this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.end.bind(this),onComplete:this.end.bind(this)});this.clone.inject(this.element,"before");this.drag.start(event)},end:function(){this.drag.detach();this.element.setStyle("opacity",this.opacity);if(this.effect){var dim=this.element.getStyles("width","height"),clone=this.clone,pos=clone.computePosition(this.element.getPosition(this.clone.getOffsetParent()));var destroy=function(){this.removeEvent("cancel",destroy);clone.destroy()};this.effect.element=clone;this.effect.start({top:pos.top,left:pos.left,width:dim.width,height:dim.height,opacity:.25}).addEvent("cancel",destroy).chain(destroy)}else{this.clone.destroy()}this.reset()},reset:function(){this.idle=true;this.fireEvent("complete",this.element)},serialize:function(){var params=Array.link(arguments,{modifier:Type.isFunction,index:function(obj){return obj!=null}});var serial=this.lists.map(function(list){return list.getChildren().map(params.modifier||function(element){return element.get("id")},this)},this);var index=params.index;if(this.lists.length==1)index=0;return(index||index===0)&&index>=0&&index<this.lists.length?serial[index]:serial}});Request.JSONP=new Class({Implements:[Chain,Events,Options],options:{onRequest:function(src){if(this.options.log&&window.console&&console.log){console.log("JSONP retrieving script with url:"+src)}},onError:function(src){if(this.options.log&&window.console&&console.warn){console.warn("JSONP "+src+" will fail in Internet Explorer, which enforces a 2083 bytes length limit on URIs")}},url:"",callbackKey:"callback",injectScript:document.head,data:"",link:"ignore",timeout:0,log:false},initialize:function(options){this.setOptions(options)},send:function(options){if(!Request.prototype.check.call(this,options))return this;this.running=true;var type=typeOf(options);if(type=="string"||type=="element")options={data:options};options=Object.merge(this.options,options||{});var data=options.data;switch(typeOf(data)){case"element":data=document.id(data).toQueryString();break;case"object":case"hash":data=Object.toQueryString(data)}var index=this.index=Request.JSONP.counter++;var src=options.url+(options.url.test("\\?")?"&":"?")+options.callbackKey+"=Request.JSONP.request_map.request_"+index+(data?"&"+data:"");if(src.length>2083)this.fireEvent("error",src);Request.JSONP.request_map["request_"+index]=function(){this.success(arguments,index)}.bind(this);var script=this.getScript(src).inject(options.injectScript);this.fireEvent("request",[src,script]);if(options.timeout)this.timeout.delay(options.timeout,this);return this},getScript:function(src){if(!this.script)this.script=new Element("script",{type:"text/javascript",async:true,src:src});return this.script},success:function(args,index){if(!this.running)return;this.clear().fireEvent("complete",args).fireEvent("success",args).callChain()},cancel:function(){if(this.running)this.clear().fireEvent("cancel");return this},isRunning:function(){return!!this.running},clear:function(){this.running=false;if(this.script){this.script.destroy();this.script=null}return this},timeout:function(){if(this.running){this.running=false;this.fireEvent("timeout",[this.script.get("src"),this.script]).fireEvent("failure").cancel()}return this}});Request.JSONP.counter=0;Request.JSONP.request_map={};Request.implement({options:{initialDelay:5e3,delay:5e3,limit:6e4},startTimer:function(data){var fn=function(){if(!this.running)this.send({data:data})};this.lastDelay=this.options.initialDelay;this.timer=fn.delay(this.lastDelay,this);this.completeCheck=function(response){clearTimeout(this.timer);this.lastDelay=response?this.options.delay:(this.lastDelay+this.options.delay).min(this.options.limit);this.timer=fn.delay(this.lastDelay,this)};return this.addEvent("complete",this.completeCheck)},stopTimer:function(){clearTimeout(this.timer);return this.removeEvent("complete",this.completeCheck)}});var Asset={javascript:function(source,properties){if(!properties)properties={};var script=new Element("script",{src:source,type:"text/javascript"}),doc=properties.document||document,load=properties.onload||properties.onLoad;delete properties.onload;delete properties.onLoad;delete properties.document;if(load){if(typeof script.onreadystatechange!="undefined"){script.addEvent("readystatechange",function(){if(["loaded","complete"].contains(this.readyState))load.call(this)})}else{script.addEvent("load",load)}}return script.set(properties).inject(doc.head)},css:function(source,properties){if(!properties)properties={};var link=new Element("link",{rel:"stylesheet",media:"screen",type:"text/css",href:source});var load=properties.onload||properties.onLoad,doc=properties.document||document;delete properties.onload;delete properties.onLoad;delete properties.document;if(load)link.addEvent("load",load);return link.set(properties).inject(doc.head)},image:function(source,properties){if(!properties)properties={};var image=new Image,element=document.id(image)||new Element("img");["load","abort","error"].each(function(name){var type="on"+name,cap="on"+name.capitalize(),event=properties[type]||properties[cap]||function(){};delete properties[cap];delete properties[type];image[type]=function(){if(!image)return;if(!element.parentNode){element.width=image.width;element.height=image.height}image=image.onload=image.onabort=image.onerror=null;event.delay(1,element,element);element.fireEvent(name,element,1)}});image.src=element.src=source;if(image&&image.complete)image.onload.delay(1);return element.set(properties)},images:function(sources,options){sources=Array.from(sources);var fn=function(){},counter=0;options=Object.merge({onComplete:fn,onProgress:fn,onError:fn,properties:{}},options);return new Elements(sources.map(function(source,index){return Asset.image(source,Object.append(options.properties,{onload:function(){counter++;options.onProgress.call(this,counter,index,source);if(counter==sources.length)options.onComplete()},onerror:function(){counter++;options.onError.call(this,counter,index,source);if(counter==sources.length)options.onComplete()}}))}))}};(function(){var Color=this.Color=new Type("Color",function(color,type){if(arguments.length>=3){type="rgb";color=Array.slice(arguments,0,3)}else if(typeof color=="string"){if(color.match(/rgb/))color=color.rgbToHex().hexToRgb(true);else if(color.match(/hsb/))color=color.hsbToRgb();else color=color.hexToRgb(true)}type=type||"rgb";switch(type){case"hsb":var old=color;color=color.hsbToRgb();color.hsb=old;break;case"hex":color=color.hexToRgb(true);break}color.rgb=color.slice(0,3);color.hsb=color.hsb||color.rgbToHsb();color.hex=color.rgbToHex();return Object.append(color,this)});Color.implement({mix:function(){var colors=Array.slice(arguments);var alpha=typeOf(colors.getLast())=="number"?colors.pop():50;var rgb=this.slice();colors.each(function(color){color=new Color(color);for(var i=0;i<3;i++)rgb[i]=Math.round(rgb[i]/100*(100-alpha)+color[i]/100*alpha)});return new Color(rgb,"rgb")},invert:function(){return new Color(this.map(function(value){return 255-value}))},setHue:function(value){return new Color([value,this.hsb[1],this.hsb[2]],"hsb")},setSaturation:function(percent){return new Color([this.hsb[0],percent,this.hsb[2]],"hsb")},setBrightness:function(percent){return new Color([this.hsb[0],this.hsb[1],percent],"hsb")}});this.$RGB=function(r,g,b){return new Color([r,g,b],"rgb")};this.$HSB=function(h,s,b){return new Color([h,s,b],"hsb")};this.$HEX=function(hex){return new Color(hex,"hex")};Array.implement({rgbToHsb:function(){var red=this[0],green=this[1],blue=this[2],hue=0;var max=Math.max(red,green,blue),min=Math.min(red,green,blue);var delta=max-min;var brightness=max/255,saturation=max!=0?delta/max:0;if(saturation!=0){var rr=(max-red)/delta;var gr=(max-green)/delta;var br=(max-blue)/delta;if(red==max)hue=br-gr;else if(green==max)hue=2+rr-br;else hue=4+gr-rr;hue/=6;if(hue<0)hue++}return[Math.round(hue*360),Math.round(saturation*100),Math.round(brightness*100)]},hsbToRgb:function(){var br=Math.round(this[2]/100*255);if(this[1]==0){return[br,br,br]}else{var hue=this[0]%360;var f=hue%60;var p=Math.round(this[2]*(100-this[1])/1e4*255);var q=Math.round(this[2]*(6e3-this[1]*f)/6e5*255);var t=Math.round(this[2]*(6e3-this[1]*(60-f))/6e5*255);switch(Math.floor(hue/60)){case 0:return[br,t,p];case 1:return[q,br,p];case 2:return[p,br,t];case 3:return[p,q,br];case 4:return[t,p,br];case 5:return[br,p,q]}}return false}});String.implement({rgbToHsb:function(){var rgb=this.match(/\d{1,3}/g);return rgb?rgb.rgbToHsb():null},hsbToRgb:function(){var hsb=this.match(/\d{1,3}/g);return hsb?hsb.hsbToRgb():null}})})();var HtmlTable=new Class({Implements:[Options,Events,Class.Occlude],options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[],headers:[],footers:[]},property:"HtmlTable",initialize:function(){var params=Array.link(arguments,{options:Type.isObject,table:Type.isElement,id:Type.isString});this.setOptions(params.options);if(!params.table&&params.id)params.table=document.id(params.id);this.element=params.table||new Element("table",this.options.properties);if(this.occlude())return this.occluded;this.build()},build:function(){this.element.store("HtmlTable",this);this.body=document.id(this.element.tBodies[0])||new Element("tbody").inject(this.element);$$(this.body.rows);if(this.options.headers.length)this.setHeaders(this.options.headers);else this.thead=document.id(this.element.tHead);if(this.thead)this.head=this.getHead();if(this.options.footers.length)this.setFooters(this.options.footers);this.tfoot=document.id(this.element.tFoot);if(this.tfoot)this.foot=document.id(this.tfoot.rows[0]);this.options.rows.each(function(row){this.push(row)},this)},toElement:function(){return this.element},empty:function(){this.body.empty();return this},set:function(what,items){var target=what=="headers"?"tHead":"tFoot",lower=target.toLowerCase();this[lower]=(document.id(this.element[target])||new Element(lower).inject(this.element,"top")).empty();var data=this.push(items,{},this[lower],what=="headers"?"th":"td");if(what=="headers")this.head=this.getHead();else this.foot=this.getHead();return data},getHead:function(){var rows=this.thead.rows;return rows.length>1?$$(rows):rows.length?document.id(rows[0]):false},setHeaders:function(headers){this.set("headers",headers);return this},setFooters:function(footers){this.set("footers",footers);return this},update:function(tr,row,tag){var tds=tr.getChildren(tag||"td"),last=tds.length-1;row.each(function(data,index){var td=tds[index]||new Element(tag||"td").inject(tr),content=(data?data.content:"")||data,type=typeOf(content);if(data&&data.properties)td.set(data.properties);if(/(element(s?)|array|collection)/.test(type))td.empty().adopt(content);else td.set("html",content);if(index>last)tds.push(td);else tds[index]=td});return{tr:tr,tds:tds}},push:function(row,rowProperties,target,tag,where){if(typeOf(row)=="element"&&row.get("tag")=="tr"){row.inject(target||this.body,where);return{tr:row,tds:row.getChildren("td")}}return this.update(new Element("tr",rowProperties).inject(target||this.body,where),row,tag)},pushMany:function(rows,rowProperties,target,tag,where){return rows.map(function(row){return this.push(row,rowProperties,target,tag,where)},this)}});["adopt","inject","wraps","grab","replaces","dispose"].each(function(method){HtmlTable.implement(method,function(){this.element[method].apply(this.element,arguments);return this})});HtmlTable=Class.refactor(HtmlTable,{options:{sortIndex:0,sortReverse:false,parsers:[],defaultParser:"string",classSortable:"table-sortable",classHeadSort:"table-th-sort",classHeadSortRev:"table-th-sort-rev",classNoSort:"table-th-nosort",classGroupHead:"table-tr-group-head",classGroup:"table-tr-group",classCellSort:"table-td-sort",classSortSpan:"table-th-sort-span",sortable:false,thSelector:"th"},initialize:function(){this.previous.apply(this,arguments);if(this.occluded)return this.occluded;this.sorted={index:null,dir:1};if(!this.bound)this.bound={};this.bound.headClick=this.headClick.bind(this);this.sortSpans=new Elements;if(this.options.sortable){this.enableSort();if(this.options.sortIndex!=null)this.sort(this.options.sortIndex,this.options.sortReverse)}},attachSorts:function(attach){this.detachSorts();if(attach!==false)this.element.addEvent("click:relay("+this.options.thSelector+")",this.bound.headClick)},detachSorts:function(){this.element.removeEvents("click:relay("+this.options.thSelector+")")},setHeaders:function(){this.previous.apply(this,arguments);if(this.sortEnabled)this.setParsers()},setParsers:function(){this.parsers=this.detectParsers()},detectParsers:function(){return this.head&&this.head.getElements(this.options.thSelector).flatten().map(this.detectParser,this)},detectParser:function(cell,index){if(cell.hasClass(this.options.classNoSort)||cell.retrieve("htmltable-parser"))return cell.retrieve("htmltable-parser");var thDiv=new Element("div");thDiv.adopt(cell.childNodes).inject(cell);var sortSpan=new Element("span",{"class":this.options.classSortSpan}).inject(thDiv,"top");this.sortSpans.push(sortSpan);var parser=this.options.parsers[index],rows=this.body.rows,cancel;switch(typeOf(parser)){case"function":parser={convert:parser};cancel=true;break;case"string":parser=parser;cancel=true;break}if(!cancel){HtmlTable.ParserPriority.some(function(parserName){var current=HtmlTable.Parsers[parserName],match=current.match;if(!match)return false;for(var i=0,j=rows.length;i<j;i++){var cell=document.id(rows[i].cells[index]),text=cell?cell.get("html").clean():"";if(text&&match.test(text)){parser=current;return true}}})}if(!parser)parser=this.options.defaultParser;cell.store("htmltable-parser",parser);return parser},headClick:function(event,el){if(!this.head||el.hasClass(this.options.classNoSort))return;return this.sort(Array.indexOf(this.head.getElements(this.options.thSelector).flatten(),el)%this.body.rows[0].cells.length)},serialize:function(){var previousSerialization=this.previous.apply(this,arguments)||{};if(this.options.sortable){previousSerialization.sortIndex=this.sorted.index;previousSerialization.sortReverse=this.sorted.reverse}return previousSerialization},restore:function(tableState){if(this.options.sortable&&tableState.sortIndex){this.sort(tableState.sortIndex,tableState.sortReverse)}this.previous.apply(this,arguments)},setSortedState:function(index,reverse){if(reverse!=null)this.sorted.reverse=reverse;else if(this.sorted.index==index)this.sorted.reverse=!this.sorted.reverse;else this.sorted.reverse=this.sorted.index==null;if(index!=null)this.sorted.index=index},setHeadSort:function(sorted){var head=$$(!this.head.length?this.head.cells[this.sorted.index]:this.head.map(function(row){return row.getElements(this.options.thSelector)[this.sorted.index]},this).clean());if(!head.length)return;if(sorted){head.addClass(this.options.classHeadSort);if(this.sorted.reverse)head.addClass(this.options.classHeadSortRev);else head.removeClass(this.options.classHeadSortRev)}else{head.removeClass(this.options.classHeadSort).removeClass(this.options.classHeadSortRev)}},setRowSort:function(data,pre){var count=data.length,body=this.body,group,rowIndex;while(count){var item=data[--count],position=item.position,row=body.rows[position];if(row.disabled)continue;if(!pre){group=this.setGroupSort(group,row,item);this.setRowStyle(row,count)}body.appendChild(row);for(rowIndex=0;rowIndex<count;rowIndex++){if(data[rowIndex].position>position)data[rowIndex].position--}}},setRowStyle:function(row,i){this.previous(row,i);row.cells[this.sorted.index].addClass(this.options.classCellSort)},setGroupSort:function(group,row,item){if(group==item.value)row.removeClass(this.options.classGroupHead).addClass(this.options.classGroup);else row.removeClass(this.options.classGroup).addClass(this.options.classGroupHead);return item.value},getParser:function(){var parser=this.parsers[this.sorted.index];return typeOf(parser)=="string"?HtmlTable.Parsers[parser]:parser},sort:function(index,reverse,pre){if(!this.head)return;if(!pre){this.clearSort();this.setSortedState(index,reverse);this.setHeadSort(true)}var parser=this.getParser();if(!parser)return;var rel;if(!Browser.ie){rel=this.body.getParent();this.body.dispose()}var data=this.parseData(parser).sort(function(a,b){if(a.value===b.value)return 0;return a.value>b.value?1:-1});if(this.sorted.reverse==(parser==HtmlTable.Parsers["input-checked"]))data.reverse(true);this.setRowSort(data,pre);if(rel)rel.grab(this.body);this.fireEvent("stateChanged");return this.fireEvent("sort",[this.body,this.sorted.index])},parseData:function(parser){return Array.map(this.body.rows,function(row,i){var value=parser.convert.call(document.id(row.cells[this.sorted.index]));return{position:i,value:value}},this)},clearSort:function(){this.setHeadSort(false);this.body.getElements("td").removeClass(this.options.classCellSort)},reSort:function(){if(this.sortEnabled)this.sort.call(this,this.sorted.index,this.sorted.reverse);return this},enableSort:function(){this.element.addClass(this.options.classSortable);this.attachSorts(true);this.setParsers();this.sortEnabled=true;return this},disableSort:function(){this.element.removeClass(this.options.classSortable);this.attachSorts(false);this.sortSpans.each(function(span){span.destroy()});this.sortSpans.empty();this.sortEnabled=false;return this}});HtmlTable.ParserPriority=["date","input-checked","input-value","float","number"];HtmlTable.Parsers={date:{match:/^\d{2}[-\/ ]\d{2}[-\/ ]\d{2,4}$/,convert:function(){var d=Date.parse(this.get("text").stripTags());return typeOf(d)=="date"?d.format("db"):""},type:"date"},"input-checked":{match:/ type="(radio|checkbox)" /,convert:function(){return this.getElement("input").checked}},"input-value":{match:/<input/,convert:function(){return this.getElement("input").value}},number:{match:/^\d+[^\d.,]*$/,convert:function(){return this.getAttribute("data-value").stripTags().toInt()},number:true},numberLax:{match:/^[^\d]+\d+$/,convert:function(){return this.get("text").replace(/[^-?^0-9]/,"").stripTags().toInt()},number:true},"float":{match:/^[\d]+\.[\d]+/,convert:function(){return this.get("text").replace(/[^-?^\d.]/,"").stripTags().toFloat()},number:true},floatLax:{match:/^[^\d]+[\d]+\.[\d]+$/,convert:function(){return this.get("text").replace(/[^-?^\d.]/,"").stripTags()},number:true},string:{match:null,convert:function(){return this.get("text").stripTags().toLowerCase()}},title:{match:null,convert:function(){return this.title}}};HtmlTable.defineParsers=function(parsers){HtmlTable.Parsers=Object.append(HtmlTable.Parsers,parsers);for(var parser in parsers){HtmlTable.ParserPriority.unshift(parser)}};[Element].invoke("implement",{exists:function(){return this&&this["tagName"]&&this.tagName.toString().toLowerCase()!=="undefined"},hasParent:function(parent){if(parent===this){return true}var currentElement=$(this).getParent();while(currentElement){if(currentElement===parent){return true}currentElement=$(currentElement).getParent()}return false}});Cookie.setValue=function(name,key,value,params){var cval=Cookie.read(key)||{};cval[key]=value;Cookie.write(name,JSON.stringify(cval),params)};Cookie.getValue=function(name,key){var cval=JSON.parse(Cookie.read(name))||{};return cval[key]};String.implement({squeeze:function(len){if(this.length>len){len-=3;return this.slice(0,Math.floor(len/2))+"..."+this.slice(-Math.floor(len/2))}return this},highlightTerm:function(term){var copy=this;var regex=new RegExp("("+term.split(" ").join("|")+")","igm");copy=copy.replace(regex,"<mark>$1</mark>");return copy},getTimeInSeconds:function(){var values=this.split(":").reverse(),totalSeconds=0;values.forEach(function(val,i){var multiplier=i>0?i*60:1;totalSeconds+=val.toInt()*multiplier});return totalSeconds},singularize:function(){var copy=this;if(copy.substr(copy.length-3,copy.length-1)==="ies"){copy=copy.replace("ies","y")}else if(copy.substr(copy.length-1,copy.length-1)==="s"){copy=copy.substr(0,copy.length-1)}return copy},stripScripts:function(exec){var scripts="";var text=this.replace(/<script(?! type="text\/template")[^>]*>([\s\S]*?)<\/script>/gi,function(all,code){scripts+=code+"\n";return""});if(exec===true)Browser.exec(scripts);else if(typeOf(exec)=="function")exec(scripts,text);return text},htmlEncode:function(){return this.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}});Request=Class.refactor(Request,{send:function(options){if(window["Signal"]&&Signal["request"]){var sopts=Object.buildQueryString(options,["url"]);var url=this.options.url||options.url||"/";var request=[url,sopts?"?":"",sopts].join("");Signal.request.send.dispatch({url:request})}$(document.body).addClass("progress");this.previous(options)},success:function(text,xml){$(document.body).removeClass("progress");this.previous(text,xml)},failure:function(){$(document.body).removeClass("progress");this.previous()},cancel:function(){$(document.body).removeClass("progress");this.previous()}});Request.HTML=Class.refactor(Request.HTML,{success:function(text){$(document.body).removeClass("progress");this.previous(text);if(typeof Global!=="undefined"){Global.xsrfProtect();Global.initToggleBoxes()}if(typeof PlayerManager!=="undefined"){PlayerManager.run()}if(typeof Signal!=="undefined"){Signal.dom.updated.dispatch()}}});Request.JSONP=Class.refactor(Request.JSONP,{send:function(options){if(!Request.prototype.check.call(this,options))return this;this.running=true;var type=typeOf(options);if(type=="string"||type=="element")options={data:options};var old=this.options;options=Object.append({data:old.data,url:old.url,callbackKey:old.callbackKey,link:old.link,timeout:old.timeout,injectScript:old.injectScript},options);var data=options.data;switch(typeOf(data)){case"element":data=document.id(data).toQueryString();break;case"object":case"hash":data=Object.toQueryString(data)}var index=this.index=Request.JSONP.counter++;var src=options.url+(options.url.test("\\?")?"&":"?")+options.callbackKey+"=Request.JSONP.request_map.request_"+index+(data?"&"+data:"");if(src.length>2083)this.fireEvent("error",src);Request.JSONP.request_map["request_"+index]=function(){this.success(arguments,index)}.bind(this);var script=this.getScript(src).inject(options.injectScript);this.fireEvent("request",[src,script]);if(options.timeout)this.timeout.delay(options.timeout,this);return this}});Request.JSON=Class.refactor(Request.JSON,{success:function(text){$(document.body).removeClass("progress");this.previous(text)}});Form.Request=Class.refactor(Form.Request,{submit_value:null,initialize:function(form,target,options){this.element=document.id(form);if(this.element.retrieve("form.request")===null){this.previous(form,target,options)}},send:function(){this.disableSubmit();this.previous()},makeRequest:function(){var self=this;this.request=new Request.HTML(Object.merge({update:this.target,emulation:false,spinnerTarget:this.element,method:this.element.get("method")||"post"},this.options.requestOptions)).addEvents({success:function(tree,elements,html,javascript){self.enableSubmit();["complete","success"].each(function(evt){self.fireEvent(evt,[self.target,tree,elements,html,javascript])})},failure:function(){self.enableSubmit();self.fireEvent("complete",arguments).fireEvent("failure",arguments)},exception:function(){self.enableSubmit();self.fireEvent("failure",arguments)}});return this.attachReset()},attach:function(attach){try{this.element.removeEvent("submit",Global.onStaticFormSubmit)}catch(x){console.log(x)}this.previous(attach)},enableSubmit:function(){var submit_button=this.element.getElement("input[type=submit]");if(submit_button!==null){submit_button.removeClass("btn_disabled").set("disabled",false).set("value",this.submit_value)}},disableSubmit:function(){var submit_button=this.element.getElement("input[type=submit]");if(submit_button!==null){if(this.submit_value===null){this.submit_value=submit_button.get("value")}submit_button.addClass("btn_disabled").set("disabled",true);if(this.options.progress!==false){submit_button.set("value",submit_button.get("data-submit-text")||submit_button.get("value"))}}}});Form.Request.Append=Class.refactor(Form.Request.Append,{makeRequest:function(){this.request=new Request.HTML(Object.merge({url:this.element.get("action"),method:this.element.get("method")||"post",spinnerTarget:this.element},this.options.requestOptions,{evalScripts:false})).addEvents({success:function(tree,elements,html,javascript){this.enableSubmit();var container;var kids=Elements.from(html);if(kids.length==1){container=kids[0]}else{container=new Element("div",{styles:{display:"none"}}).adopt(kids)}container.inject(this.target,this.options.inject);if(this.options.requestOptions.evalScripts){Browser.exec(javascript)}this.fireEvent("beforeEffect",container);var finish=function(){this.fireEvent("success",[container,this.target,tree,elements,html,javascript])}.bind(this);if(this.options.useReveal){container.set("reveal",this.options.revealOptions).get("reveal").chain(finish);container.hide();container.reveal()}else{finish()}}.bind(this),failure:function(xhr){this.enableSubmit();this.fireEvent("failure",xhr)}.bind(this)});this.attachReset()}});Form.Validator=Class.refactor(Form.Validator,{options:{evaluateFieldsOnBlur:false,evaluateFieldsOnChange:false},initialize:function(form,options){this.element=document.id(form);if(this.element===null){return}if(this.element.retrieve("validator")===null){this.previous(form,options)}},validate:function(event,dont_fire){var result=this.getFields().map(function(field){return this.validateField(field,true)},this).every(function(v){return v});if(!dont_fire){this.fireEvent("formValidate",[result,this.element,event])}if(this.options.stopOnFailure&&!result&&event)event.preventDefault();return result},isFieldValid:function(field){field=document.id(field);var passed;if(field){var validationTypes=field.get("validators");var validators=validationTypes.some(function(cn){return this.getValidator(cn)},this);var validatorsFailed=[];validationTypes.each(function(className){var validator=this.getValidator(className);var isValid=this.hasValidator(field,"ignoreValidation")||(validator?validator.test(field):true);if(!isValid)validatorsFailed.include(className)},this);passed=validatorsFailed.length===0}return passed}});Form.Validator.Inline=Class.refactor(Form.Validator.Inline,{initialize:function(form,options){this.parent(form,options);this.addEvent("onElementValidate",function(isValid,field,className,warn){var validator=this.getValidator(className);if(!isValid&&validator.getError(field)){if(!this.hasAdvice(field)){if(warn)field.addClass("warning");var advice=this.makeAdvice(className,field,validator.getError(field),warn);this.insertAdvice(advice,field);this.showAdvice(className,field)}}else{this.hideAdvice(className,field)}});this.addEvent("onShowAdvice",function(field,advice,className){var advices=field.retrieve("$inlineValidatorsAdviceDisplay",{});advices[className]=true;field.store("$inlineValidatorsAdviceDisplay",advices)});this.addEvent("onHideAdvice",function(field,advice,className){var advices=field.retrieve("$inlineValidatorsAdviceDisplay",{});advices[className]=false;field.store("$inlineValidatorsAdviceDisplay",advices)})},hasAdvice:function(field){var hasAdvice=false;var advices=field.retrieve("$inlineValidatorsAdviceDisplay",{});for(var i in advices){if(advices[i]===true){hasAdvice=true}}return hasAdvice}});OverText=Class.refactor(OverText,{enable:function(){this.element.addEvents({focus:this.focus,blur:this.assert,change:this.assert});window.addEvent("resize",this.reposition);this.assert(true);this.reposition();if(this.element.match(":focus")){this.hide()}return this}});Fx.Scroll=Class.refactor(Fx.Scroll,{toElement:function(el,offset){var position=document.id(el).getPosition(this.element),scroll={x:0,y:0},offset=offset||0;return this.start(position.x+scroll.x,position.y+scroll.y+offset)}});Form.Validator.add("IsEmpty",{errorMsg:false,test:function(element){if(element.type=="select-one"||element.type=="select"){return!(element.selectedIndex>=0&&element.options[element.selectedIndex].value!="")}return element.get("value")===null||element.get("value").trim().length===0}});Form.Validator.addAllThese([["clipurl",{errorMsg:Form.Validator.getMsg.pass("url"),test:function(element){return Form.Validator.getValidator("IsEmpty").test(element)||/vimeo.com\/[0-9]+/i.test(element.get("value"))}}],["lazyclipurl",{errorMsg:Form.Validator.getMsg.pass("url"),test:function(element){return Form.Validator.getValidator("IsEmpty").test(element)||/(vimeo.com\/)?[0-9]+/i.test(element.get("value"))}}],["validate-urlazy",{errorMsg:Form.Validator.getMsg.pass("url"),test:function(element){return Form.Validator.getValidator("IsEmpty").test(element)||/^((https?|ftp|rmtp|mms):\/\/)?(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(element.get("value"))}}],["minValue",{errorMsg:"Please enter a number within the valid range.",test:function(element,value){return element.value>=value.minValue}}],["maxValue",{errorMsg:"Please enter a number within the valid range.",test:function(element,value){return element.value<=value.maxValue}}],["custom-url",{errorMsg:"Unavailable",test:function(element,prop){var value=element.get("value"),msg=element.getNext("span.msg");if(value===element.get("data-original-value")){return true}if(value.length===0){return true}if(msg.get("text")==="Unavailable"){return false}if(!Form.Validator.getValidator("validate-alphanum").test(element)){return false}if(!/^([0-9]*[a-z][a-z0-9]*)$/i.test(value)){return false}if(value.length<3){return false}if(value.length>24){return false}return true}}],["custom-clip-url",{
errorMsg:"Unavailable",test:function(element,prop){var value=element.get("value"),msg=element.getNext("span.msg");if(value===element.get("data-original-value")){return true}if(value.length===0){return true}if(msg.get("text")==="Unavailable"){return false}value=ClipSettings.filterCustomUrl(value);if(!/^([a-z0-9\-]*)$/i.test(value)){return false}if(value.length>64){return false}return true}}],["custom-cc-num",{errorMsg:"Invalid credit card number",test:function(element){if(Form.Validator.getValidator("IsEmpty").test(element))return true;var ccNum=element.get("value");var valid_type=false;if(ccNum.test(/^4[0-9]{12}([0-9]{3})?$/))valid_type="Visa";else if(ccNum.test(/^5[1-5]([0-9]{14})$/))valid_type="Master Card";else if(ccNum.test(/^3[47][0-9]{13}$/))valid_type="American Express";else if(ccNum.test(/^6011[0-9]{12}$/))valid_type="Discover";if(valid_type){var sum=0;var cur=0;for(var i=ccNum.length-1;i>=0;--i){cur=ccNum.charAt(i).toInt();if(cur==0)continue;if((ccNum.length-i)%2==0)cur+=cur;if(cur>9){cur=cur.toString().charAt(0).toInt()+cur.toString().charAt(1).toInt()}sum+=cur}if(sum%10==0)return true}return false}}],["custom-tip-num",{errorMsg:"Invalid tip amount",test:function(element){var val=element.get("value");if(Form.Validator.getValidator("IsEmpty").test(element)){return false}if(!/^(?:0$0(?=\d*\.)|[1-9]|0)\d*(\.\d+)?$/.test(val)){return false}if(parseFloat(val)>10){return false}if(parseFloat(val)<.99){return false}return/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(val)}}],["custom-digit-positive",{errorMsg:"Invalid value",test:function(element){var val=element.get("value");if(Form.Validator.getValidator("IsEmpty").test(element)){return false}return parseFloat(val)>0}}],["validate-date-part",{errorMsg:"Invalid value",test:function(element,props){var rawValue=element.get("value");var value=parseInt(rawValue);var allFilled=true;if(!Form.Validator.getValidator("required").test(element))return false;switch(props.part){case"day":if(isNaN(value)||value<1||value>31)return false;break;case"month":if(isNaN(value)||value<1||value>12)return false;break;case"year":if(isNaN(value)||rawValue.length!=4)return false;break}if(typeof props.minDate!=="undefined"&&props.minDate!==""){var minDate=Date.parse(props.minDate)}if(typeof props.maxDate!=="undefined"&&props.maxDate!==""){var maxDate=Date.parse(props.maxDate)}var schema=["day","month","year"];var parts={day:16,month:1,year:1981};props.parts.each(function(item,i){var rawValue=$(item).get("value");var value=parseInt(rawValue);if(rawValue!==null&&rawValue.length>0){parts[schema[i]]=value}else{allFilled=false}});var days_in_month=[31,28,31,30,31,30,31,31,30,31,30,31];if(parts.month==2){if(parts.year%4==0&&(!(parts.year%100==0)||parts.year%400==0)){days_in_month[1]=29}}if(parts.day>days_in_month[parts.month-1]){return false}var inputDate=Date.parse(parts.year+"-"+parts.month+"-"+parts.day);if(allFilled){if(typeof minDate!=="undefined"&&inputDate<minDate){return false}if(typeof maxDate!=="undefined"&&inputDate>maxDate){return false}}return true}}]]);Class.Binds=new Class({$bound:{},bound:function(name){return this.$bound[name]?this.$bound[name]:this.$bound[name]=this[name].bind(this)}});Sortables=Class.refactor(Sortables,{start:function start(event,element){var el=false;if(this.options.handle){el=element.getElement(this.options.handle)}if(!this.idle||event.rightClick||["button","input","a","textarea","select"].contains(event.target.get("tag"))&&el!=event.target)return;this.idle=false;this.element=element;this.opacity=element.get("opacity");this.list=element.getParent();this.clone=this.getClone(event,element);this.drag=new Drag.Move(this.clone,Object.merge({droppables:this.getDroppables()},this.options.dragOptions)).addEvents({onSnap:function(){event.stop();this.clone.setStyle("visibility","visible");this.element.set("opacity",this.options.opacity||0);this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.end.bind(this),onComplete:this.end.bind(this)});this.clone.inject(this.element,"before");this.drag.start(event)}});Array.implement({difference:function(compareArray){var largeArray,smallArray,leftovers;if(this.length>compareArray.length){largeArray=this;smallArray=compareArray}else{largeArray=compareArray;smallArray=this}leftovers=largeArray.filter(function(item,index){return!smallArray.contains(item)});return leftovers}});Number.implement({formatBigNumber:function(){var number=parseInt(this,10);if(number<1e4){return number.format()}if(number<1e5){return(number/1e3).format({decimals:1})+"K"}if(number<1e6){return(number/1e3).format({decimals:0})+"K"}if(number<1e8){return(number/1e6).format({decimals:1})+"M"}if(number<1e9){return(number/1e6).format({decimals:0})+"M"}else{return""}},formatTimecode:function(format){if(!format){format=this>=60*60*60?"hh:mm:ss":"mm:ss";if(this===0){return"00:00"}}var time=this,time_format=format,formatted_time=[],parts=time_format?time_format.split(":"):null,hours,minutes,seconds,i;for(i=0;i<parts.length;i++){switch(parts[i]){case"h":hours=Math.floor(time/60/60);formatted_time.push(hours);break;case"hh":hours=Math.floor(time/60/60);if(hours<10){hours="0"+hours}formatted_time.push(hours);break;case"m":minutes=hours?Math.floor(time/60%60):Math.floor(time/60);formatted_time.push(minutes);break;case"mm":minutes=hours?Math.floor(time/60%60):Math.floor(time/60);if(minutes<10){minutes="0"+minutes}formatted_time.push(minutes);break;case"ss":seconds=Math.floor(time%60);if(seconds<10){seconds="0"+seconds}formatted_time.push(seconds);break;default:formatted_time.push("");break}}return formatted_time.join(":")},formatBytes:function(){var units=["B","KB","MB","GB","TB"],bytes=this,i;for(i=0;bytes>=1024&&i<4;i++){bytes/=1024}return bytes.toFixed(2)+units[i]}});Element.implement("surround",function(els,where){var self=this;Array.slice(els).each(function(e){self.wraps(e,where)});return this});Element.implement("equalize",function(selector,dimension){var children=!selector?this.getChildren():this.getChildren(selector),dimension=dimension||"height";max=0,prop=(typeof document.body.style.maxHeight!=="undefined"?"min-":"")+dimension,offset="offset"+dimension.capitalize();children.each(function(element,i){var calc=element[offset];if(calc>max){max=calc}});children.each(function(element,i){element.setStyle(prop,max-(element[offset]-element.getStyle(dimension).toInt()))});return max});Element.implement("proxyAnchorClick",function(use_hand_cursor){var anchor=this.getElement("a"),show_hand_cursor=use_hand_cursor===false?false:true;if(!anchor){return}this.addEvent("click",function(e){if(e.target!==anchor){anchor.click()}});if(show_hand_cursor){this.setStyle("cursor","pointer")}return this});Element.implement("toQueryStringIgnoringSubForms",function(){var queryString=[];var self=this;this.getElements("input, select, textarea").each(function(el){if(el.getParent("form").id!==self.id){return}var type=el.type;if(!el.name||el.disabled||type=="submit"||type=="reset"||type=="file"||type=="image")return;var value=el.get("tag")=="select"?el.getSelected().map(function(opt){return document.id(opt).get("value")}):(type=="radio"||type=="checkbox")&&!el.checked?null:el.get("value");Array.from(value).each(function(val){if(typeof val!="undefined")queryString.push(encodeURIComponent(el.name)+"="+encodeURIComponent(val))})});return queryString.join("&")});Element.implement("setContextMenu",function(data){if(!("contextMenu"in document.body)||!("HTMLMenuItemElement"in window)){return false}if(typeOf(data)==="menu"){this.set("contextmenu",context_menu);return true}var context_menu=new Element("menu",{id:(new Date).getTime(),type:"context"}).inject($(document.body));function addMenu(menu,parent_menu){var menu_el=new Element("menu",{label:menu.label,icon:menu.icon});parseMenu(menu.items,menu_el);menu_el.inject(parent_menu);return menu_el}function addMenuItem(item,parent_menu){var menu_item_el=new Element("menuitem",{label:item.label,icon:item.icon,events:{click:function(e){e.stop();if(item.url){window.location=item.url}else if(item.action){item.action.call()}}}}).inject(parent_menu);return menu_item_el}function parseMenu(menu_data,parent_menu){menu_data.each(function(menu_item){if(menu_item.items){addMenu(menu_item,parent_menu)}else{addMenuItem(menu_item,parent_menu)}})}if(typeOf(data)==="array"){parseMenu(data,context_menu)}else if(data.items){addMenu(data,context_menu)}else if(data.label){addMenuItem(data,context_menu)}this.set("contextmenu",context_menu.get("id"));return true});Slick.definePseudo("input",function(){var name=this.nodeName.toLowerCase();return name==="input"||name==="select"||name==="textarea"||name==="button"});Slick.definePseudo("textfield",function(){var isInput=this.nodeName.toLowerCase()==="input",type;if(isInput){type=$(this).get("type");return type==="text"||type==="password"||type==="search"||type==="email"||type==="url"||type==="number"}});Object.extend({buildQueryString:function(obj,ignore){ignore=ignore||[];var s=[];for(n in obj){if(typeof obj[n]=="object"){s.push(Object.buildQueryString(obj[n],ignore))}else{if(ignore.indexOf(n)===-1&&(typeof obj[n]=="string"||typeof obj[n]=="number"||typeof obj[n]=="boolean")&&obj[n]!=""){s.push(n+"="+encodeURIComponent(obj[n]))}}}return s.join("&")}});Element.NativeEvents.transitionend=2;Element.NativeEvents.webkitTransitionEnd=2;Element.NativeEvents.oTransitionEnd=2;Element.NativeEvents.msTransitionEnd=2;Element.NativeEvents.message=2;Element.Events.transitionend={base:Browser.safari||Browser.chrome?"webkitTransitionEnd":Browser.opera?"oTransitionEnd":Browser.ie&&Browser.version>8?"msTransitionEnd":"transitionend"};Element.Events.message={base:"message",condition:function(event){if(!event.$message_extended){event.data=event.event.data;event.source=event.event.source;event.origin=event.event.origin;event.$message_extended=true}return true}};Element.implement({supportStyle:function(style){var value=this.style[style];return!!(value||value==="")},supportVendorStyle:function(style){var prefixedStyle=null;return this.supportStyle(style)?style:["webkit","Moz","o","ms"].some(function(prefix){prefixedStyle=prefix+style.capitalize();return this.supportStyle(prefixedStyle)},this)?prefixedStyle:null}});Events.implement({getElapsedTime:function(nativeTime){return nativeTime?this.event.elapsedTime:(this.event.elapsedTime*1e3).toInt()}});(function(){[Element,Window,Document].invoke("implement",{hasEvent:function(event){var events=this.retrieve("events"),list=events&&events[event]?events[event].values:null;if(list){var i=list.length;while(i--)if(i in list){return true}}return false}});var wrap=function(custom,method,extended){method=custom[method];extended=custom[extended];return function(fn,name){if(extended&&!this.hasEvent(name))extended.call(this,fn,name);if(method)method.call(this,fn,name)}};var inherit=function(custom,base,method){return function(fn,name){base[method].call(this,fn,name);custom[method].call(this,fn,name)}};var events=Element.Events;Element.defineCustomEvent=function(name,custom){var base=events[custom.base];custom.onAdd=wrap(custom,"onAdd","onSetup");custom.onRemove=wrap(custom,"onRemove","onTeardown");events[name]=base?Object.append({},custom,{base:base.base,condition:function(event,name){return(!base.condition||base.condition.call(this,event,name))&&(!custom.condition||custom.condition.call(this,event,name))},onAdd:inherit(custom,base,"onAdd"),onRemove:inherit(custom,base,"onRemove")}):custom;return this};Element.enableCustomEvents=function(){Object.each(events,function(event,name){if(event.onEnable)event.onEnable.call(event,name)})};Element.disableCustomEvents=function(){Object.each(events,function(event,name){if(event.onDisable)event.onDisable.call(event,name)})}})();(function(){var name="swipe",distanceKey=name+":distance",cancelKey=name+":cancelVertical",dflt=50;var start={},disabled,active;var clean=function(){active=false};var events={touchstart:function(event){if(event.touches.length>1)return;var touch=event.touches[0];active=true;start={x:touch.pageX,y:touch.pageY}},touchmove:function(event){if(disabled||!active)return;var touch=event.changedTouches[0],end={x:touch.pageX,y:touch.pageY};if(this.retrieve(cancelKey)&&Math.abs(start.y-end.y)>10){active=false;return}var distance=this.retrieve(distanceKey,dflt),delta=end.x-start.x,isLeftSwipe=delta<-distance,isRightSwipe=delta>distance;if(!isRightSwipe&&!isLeftSwipe)return;event.preventDefault();active=false;event.direction=isLeftSwipe?"left":"right";event.start=start;event.end=end;this.fireEvent(name,event)},touchend:clean,touchcancel:clean};Element.defineCustomEvent(name,{onSetup:function(){this.addEvents(events)},onTeardown:function(){this.removeEvents(events)},onEnable:function(){disabled=false},onDisable:function(){disabled=true;clean()}})})();Fx.Tween.CSS3=new Class({Extends:Fx.Tween,transitionTimings:{linear:"0,0,1,1","expo:in":"0.71,0.01,0.83,0","expo:out":"0.14,1,0.32,0.99","expo:in:out":"0.85,0,0.15,1","circ:in":"0.34,0,0.96,0.23","circ:out":"0,0.5,0.37,0.98","circ:in:out":"0.88,0.1,0.12,0.9","sine:in":"0.22,0.04,0.36,0","sine:out":"0.04,0,0.5,1","sine:in:out":"0.37,0.01,0.63,1","quad:in":"0.14,0.01,0.49,0","quad:out":"0.01,0,0.43,1","quad:in:out":"0.47,0.04,0.53,0.96","cubic:in":"0.35,0,0.65,0","cubic:out":"0.09,0.25,0.24,1","cubic:in:out":"0.66,0,0.34,1","quart:in":"0.69,0,0.76,0.17","quart:out":"0.26,0.96,0.44,1","quart:in:out":"0.76,0,0.24,1","quint:in":"0.64,0,0.78,0","quint:out":"0.22,1,0.35,1","quint:in:out":"0.9,0,0.1,1"},initialize:function(element,options){options.transition=options.transition||"sine:in:out";this.parent(element,options);if(typeof this.options.transition!="string")alert("Only short notated transitions (like 'sine:in') are supported by Fx.Tween.CSS3");this.options.transition=this.options.transition.toLowerCase();this.transition=this.element.supportVendorStyle("transition");this.css3Supported=!!this.transition&&!!this.transitionTimings[this.options.transition]},check:function(){if(!this.boundComplete)return true;return this.parent()},start:function(property,from,to){if(this.css3Supported){if(!this.check(property,from,to))return this;var args=Array.flatten(arguments);this.property=this.options.property||args.shift();var parsed=this.prepare(this.element,this.property,args);this.from=parsed.from;this.to=parsed.to;this.boundComplete=function(e){if(e.event.propertyName==this.property){this.element.removeEvent("transitionend",this.boundComplete);this.boundComplete=null;this.fireEvent("complete",this)}}.bind(this);this.element.addEvent("transitionend",this.boundComplete);var trans=function(){this.element.setStyle(this.transition,this.property+" "+this.options.duration+"ms cubic-bezier("+this.transitionTimings[this.options.transition]+")");this.element.setStyle(this.property,this.to[0].value+this.options.unit)}.bind(this);if(args.length>=1){this.element.setStyle(this.transition,"none");this.element.setStyle(this.property,this.from[0].value+this.options.unit);trans.delay(.1)}else{trans()}this.fireEvent("start",this);return this}return this.parent(property,from,to)},cancel:function(){if(this.css3Supported){this.element.setStyle(this.transition,"none");this.element.removeEvent("transitionend",this.boundComplete);this.boundComplete=null}this.parent();return this}});Locale.define("en-US","DatePicker",{select_a_time:"Select a time",use_mouse_wheel:"Use the mouse wheel to quickly change value",time_confirm_button:"OK",apply_range:"Apply",cancel:"Cancel",week:"Wk"});Form.Validator=Class.refactor(Form.Validator,{test:function(className,field,warn){field=document.id(field);if(this.options.ignoreHidden&&!field.isVisible()||this.options.ignoreDisabled&&field.get("disabled"))return true;var validator=this.getValidator(className);if(warn!=null)warn=false;if(this.hasValidator(field,"warnOnly"))warn=true;var isValid=field.hasClass("ignoreValidation")||(validator?validator.test(field):true);if(validator&&field.isVisible())this.fireEvent("elementValidate",[isValid,field,className,warn]);if(warn)return true;return isValid},markValid:function(field){field=document.id(field);field.addClass("validation-passed").removeClass("validation-failed")},markInvalid:function(field){field=document.id(field);field.addClass("validation-failed").removeClass("validation-passed")}});HtmlTable.defineParsers({dollars:{match:/^\$[0-9\.,]+$/,convert:function(){return parseFloat(this.get("text").substr(1).replace(/\.[\d]+$|,[\d]+$|,/g,""))},number:true}});(function(){var events=Element.NativeEvents,location=window.location,base=location.pathname,history=window.history,hashFallback=false,hasPushState="pushState"in history,event=hasPushState?"popstate":"hashchange";this.History=new new Class({Implements:[Class.Binds,Events],_loc_history:[location],hash:null,pathname:null,initialize:function(){events[event]=hasPushState?2:1;window.addEvent(event,this.bound("pop"));this.hash=this.getLocation().hash;if(!hasPushState&&!("onhashchange"in window))this.timer=this.periodical.periodical(200,this)},push:function(url,title,state){if(hasPushState){history.pushState(state||null,title||null,url)}else if(this.hashFallback){location.hash=url}else{window.location=url;return false}this.onChange(url,state)},pushHash:function(hash,title,state){var pathname=this.getLocation().pathname||location.pathname;var to_push;if(hasPushState){to_push=pathname+"#"+hash}else if(this.hashFallback){to_push="#"+pathname+"#"+hash}else{location.hash=hash;return false}this.push(to_push)},replace:hasPushState?function(url,title,state){history.replaceState(state||null,title||null,url)}:function(url){this.hash="#"+url;this.push(url)},pop:hasPushState?function(event){var url=this.getLocation().href;this.hash=this.getLocation().hash;if(url==base){base=null;return}this.onChange(url,event.event.state)}:function(){var hash=this.getLocation().hash;if(this.hash==hash)return;this.hash=hash;this.onChange((hash||null).substr(1))},back:function(){history.back()},forward:function(){history.forward()},onChange:function(url,state){this._loc_history.unshift(this.getLocation());var _2nd=this._loc_history[1],_1st=this._loc_history[0];if(_1st.hash!=_2nd.hash){this.fireEvent("hashchange",[url,state,_1st,{hash_change:true,path_change:_1st.pathname!=_2nd.pathname}||{}])}if(_1st.pathname+_1st.search!=_2nd.pathname+_2nd.search){this.fireEvent("change",[url,state,_1st,{hash_change:_1st.hash!=_2nd.hash,path_change:true}||{}])}},getPath:function(){return this.getLocation().pathname},hasPushState:function(){return hasPushState},periodical:function(){if(this.hash!=location.hash)this.pop()},pageLoad:function(){if(hasPushState===false&&this.hash){this.onChange(this.hash.substr(1))}},getHash:function(){return this.hash},getPathName:function(){return this.getLocation().pathname},getLocation:function(){var a=location.hash.toString().split("#");a.shift();var uri=new URI(location);return{hash:hasPushState?location.hash:a[1],host:location.host,hostname:location.hostname,href:location.href,pathname:hasPushState?location.pathname:a[0],search:(uri.parsed.query?"?":"")+(uri.parsed.query||"")}}})})();function str_repeat(i,m){for(var o=[];m>0;o[--m]=i);return o.join("")}function sprintf(){var i=0,a,f=arguments[i++],o=[],m,p,c,x,s="";while(f){if(m=/^[^\x25]+/.exec(f)){o.push(m[0])}else if(m=/^\x25{2}/.exec(f)){o.push("%")}else if(m=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(f)){if((a=arguments[m[1]||i++])==null||a==undefined){throw"Too few arguments."}if(/[^s]/.test(m[7])&&typeof a!="number"){throw"Expecting number but found "+typeof a}switch(m[7]){case"b":a=a.toString(2);break;case"c":a=String.fromCharCode(a);break;case"d":a=parseInt(a);break;case"e":a=m[6]?a.toExponential(m[6]):a.toExponential();break;case"f":a=m[6]?parseFloat(a).toFixed(m[6]):parseFloat(a);break;case"o":a=a.toString(8);break;case"s":a=(a=String(a))&&m[6]?a.substring(0,m[6]):a;break;case"u":a=Math.abs(a);break;case"x":a=a.toString(16);break;case"X":a=a.toString(16).toUpperCase();break}a=/[def]/.test(m[7])&&m[2]&&a>=0?"+"+a:a;c=m[3]?m[3]=="0"?"0":m[3].charAt(1):" ";x=m[5]-String(a).length-s.length;p=m[5]?str_repeat(c,x):"";o.push(s+(m[4]?a+p:p+a))}else{throw"Huh ?!"}f=f.substring(m[0].length)}return o.join("")}window.namespace=function(namespace_str){var parts=namespace_str.split("."),parent=window,currentPart="";for(var i=0,length=parts.length;i<length;i++){currentPart=parts[i];parent[currentPart]=parent[currentPart]||{};parent=parent[currentPart]}return parent};var ScrollSpy=new Class({Implements:[Options,Events],options:{container:window,max:0,min:0,mode:"vertical"},initialize:function(options){this.setOptions(options);this.container=document.id(this.options.container);this.enters=this.leaves=0;this.inside=false;var self=this;this.listener=function(e){var position=self.container.getScroll(),xy=position[self.options.mode==="vertical"?"y":"x"];if(xy>=self.options.min&&(self.options.max===0||xy<=self.options.max)){if(!self.inside){self.inside=true;self.enters++;self.fireEvent("enter",[position,self.enters,e])}self.fireEvent("tick",[position,self.inside,self.enters,self.leaves,e])}else if(self.inside){self.inside=false;self.leaves++;self.fireEvent("leave",[position,self.leaves,e])}self.fireEvent("scroll",[position,self.inside,self.enters,self.leaves,e])};this.addListener()},start:function(){this.container.addEvent("scroll",this.listener)},stop:function(){this.container.removeEvent("scroll",this.listener)},addListener:function(){this.start()}});var ThrottledScrollSpy=new Class({Extends:ScrollSpy,has_scrolled:true,polling:false,interval:250,e:null,initialize:function(options){this.bound={setHasScrolled:this.setHasScrolled.bind(this)};this.parent(options);setTimeout(this.checkScrollPosition.bind(this),this.interval)},checkScrollPosition:function(){if(this.has_scrolled){this.listener(this.e);this.e=null;this.has_scrolled=false}if(this.polling){setTimeout(this.checkScrollPosition.bind(this),this.interval)}},stopPolling:function(){this.polling=false},setHasScrolled:function(e){this.e=e;this.has_scrolled=true;if(!this.polling){this.polling=true;return this.checkScrollPosition()}setTimeout(this.stopPolling.bind(this),1e3)},start:function(){this.container.addEvent("scroll",this.bound.setHasScrolled)},stop:function(){this.container.removeEvent("scroll",this.bound.setHasScrolled)}});(function(global){var signals={VERSION:"0.6.3"};function SignalBinding(signal,listener,isOnce,listenerContext,priority){this._listener=listener;this._isOnce=isOnce;this.context=listenerContext;this._signal=signal;this._priority=priority||0}SignalBinding.prototype={active:true,params:null,execute:function(paramsArr){var handlerReturn,params;if(this.active&&!!this._listener){params=this.params?this.params.concat(paramsArr):paramsArr;handlerReturn=this._listener.apply(this.context,params);if(this._isOnce){this.detach()}}return handlerReturn},detach:function(){return this.isBound()?this._signal.remove(this._listener):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal;delete this._listener;delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", isBound: "+this.isBound()+", active: "+this.active+"]"}};function validateListener(listener,fnName){if(typeof listener!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",fnName))}}signals.Signal=function(){this._bindings=[]};signals.Signal.prototype={_shouldPropagate:true,active:true,_registerListener:function(listener,isOnce,scope,priority){var prevIndex=this._indexOfListener(listener),binding;if(prevIndex!==-1){binding=this._bindings[prevIndex];if(binding.isOnce()!==isOnce){throw new Error("You cannot add"+(isOnce?"":"Once")+"() then add"+(!isOnce?"":"Once")+"() the same listener without removing the relationship first.")}}else{binding=new SignalBinding(this,listener,isOnce,scope,priority);this._addBinding(binding)}return binding},_addBinding:function(binding){var n=this._bindings.length;do{--n}while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener){var n=this._bindings.length;while(n--){if(this._bindings[n]._listener===listener){return n}}return-1},add:function(listener,scope,priority){validateListener(listener,"add");return this._registerListener(listener,false,scope,priority)},addOnce:function(listener,scope,priority){validateListener(listener,"addOnce");return this._registerListener(listener,true,scope,priority)},remove:function(listener){validateListener(listener,"remove");var i=this._indexOfListener(listener);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1)}return listener},removeAll:function(){var n=this._bindings.length;while(n--){this._bindings[n]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(params){if(!this.active){return}var paramsArr=Array.prototype.slice.call(arguments),bindings=this._bindings.slice(),n=this._bindings.length;this._shouldPropagate=true;do{n--}while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==false)},dispose:function(){this.removeAll();delete this._bindings},toString:function(){return"[Signal active: "+this.active+" numListeners: "+this.getNumListeners()+"]"}};global.signals=signals})(window||this);var Forager=new Class({Implements:[Options],options:{container:"fg",url:"/user/forage_browse",search_element_class:"fg_search",add_email:true,max_favorites:0,defer:true,defer_until_focus:false,expire_favorites:30},FILTER_FAVORITES:"fg_filter_favorites",FILTER_ALL:"fg_filter_all",FILTER_SELECTED:"fg_filter_selected",EMAIL_REGEX:/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/,SELECTED_CLASS:"selected",ONE_DAY:1e3*60*60*24,current_filter:null,previous_filter:null,filter_map:{fg_filter_favorites:"filterFavorites",fg_filter_all:"filterAll",fg_filter_selected:"filterSelected"},initialize:function(options){var self=this;if(options){self.setOptions(options)}self.container=$$("."+self.options.container)[0];self.search=self.container.getElement("."+self.options.search_element_class);if(!self.container){throw new Error("Container required for Forager")}if(self.options.defer||self.options.defer_until_focus){if(self.options.defer_until_focus){self.options.defer_until_focus=false;self.search.addEvent("focus:once",self.forage.bind(self))}return self}self.collection=new ForagerCollection;self.createElements();self.hideLoader();self.attachEvents();if(self.hasFavoritesInStorage()&&vimeo.cur_user){self.current_filter=self.FILTER_FAVORITES;self.setAndRunSelectedFilter();self.filter_favorites.show()}else{self.current_filter=self.FILTER_ALL;self.setSelectedFilter();self.filter_favorites.hide()}if(self.container.hasClass("empty")){self.showForagerMessage(self.FILTER_ALL)}},forage:function(){var self=this;if(self.options.defer===false){return}self.options.defer=false;new Request.HTML({url:self.options.url,method:"get",onSuccess:self.onForagerRequestSuccess.bind(self),onFailure:self.onForagerRequestFailure.bind(self),onTimeout:self.onForagerRequestFailure.bind(self)}).send()},createElements:function(){var self=this;self.filters=self.container.getElement(".fg_filters");self.browse_list=self.container.getElement(".fg_browse");self.filter_favorites=self.filters.getElement("."+self.FILTER_FAVORITES);self.filter_all=self.filters.getElement("."+self.FILTER_ALL);self.filter_selected=self.filters.getElement("."+self.FILTER_SELECTED);self.selected_count=self.container.getElement(".selected_count");self.search_clear=self.container.getElement(".fg_search_clear");self.loader=self.container.getElement(".fg_search_loader");self.forager_messages=self.container.getElements(".fg_search_no_results");self.loader=self.container.getElement(".fg_search_loading");self.no_search=self.container.getElement(".fg_no_search");self.no_favorites=self.container.getElement(".fg_no_favorites");self.no_all=self.container.getElement(".fg_no_all");self.no_selected=self.container.getElement(".fg_no_selected");self.temp_user=self.browse_list.getElement(".fg_temp_user");self.temp_user_name=self.temp_user.getElement(".fg_temp_user_name");self.startCollection()},attachEvents:function(){var self=this;if(self.filter_favorites){self.filter_favorites.addEvent("click",self.onFilterFavorites.bind(self))}self.search.addEvents({keyup:self.onSearchKeyup.bind(self),input:self.onSearchKeyup.bind(self)});self.filter_all.addEvent("click",self.onFilterAll.bind(self));self.filter_selected.addEvent("click",self.onFilterSelected.bind(self));self.search_clear.addEvent("click",self.onSearchClear.bind(self));self.temp_user.addEvent("click",self.onEmailItemAdd.bind(self));Signal.forager.user.selected.add(self.updateCount.bind(self));Signal.forager.user.add_email.add(self.onEmailItemAdd.bind(self));Signal.forager.user.update_favorites.add(self.setFavorites.bind(self));Signal.forager.input.clear.add(self.clearInput.bind(self));Signal.forager.reset.add(self.clearForager.bind(self));Signal.forager.filter.selected.add(self.filterSelected.bind(self));Signal.forager.filter.all.add(self.filterAll.bind(self));Signal.forager.filter.favorites.add(self.filterFavorites.bind(self))},startCollection:function(){var self=this,people=self.browse_list.getElements("li"),image,id,name,portrait,user,count=0;people.each(function(person){id=person.get("data-user-id");if(+id===-1){return}image=person.getElement("img");name=person.getElement("a").get("text");portrait=image.src;user=new ForagerUser({user_id:id,display_name:name,portrait:portrait,element:person});if(user.isSelected()){count=count+=1;self.collection.original_selected_ids.push(+id)}self.collection.add(user)});self.selected_count.set("text",count);self.collection.build()},showLoader:function(){this.loader.show()},hideLoader:function(){this.loader.hide()},onFilterSelected:function(e){e.preventDefault();var self=this;if(self.current_filter===self.FILTER_SELECTED){return}self.filterSelected()},onFilterAll:function(e){e.preventDefault();var self=this;if(self.current_filter===self.FILTER_ALL){return}self.onSearchClear();self.filterAll()},onFilterFavorites:function(e){e.preventDefault();var self=this;if(self.current_filter===self.FILTER_FAVORITES){return}self.filterFavorites()},onSearchKeyup:function(e){var self=this,allow_email=self.options.add_email;if(self.search.value.length>0){self.search_clear.show();self.unsetSelectedFilter();if(self.search.value.test(self.EMAIL_REGEX)&&allow_email){self.handleEmailSearch()}else{self.temp_user.hide();self.handleUserSearch()}}else{self.hideForagerMessages();self.temp_user.hide();self.search_clear.hide();self.setAndRunSelectedFilter()}},onSearchClear:function(){this.clearSearch()},onEmailItemAdd:function(e){var self=this,email=self.temp_user_name.get("text");if(self.collection.inTrie(email)||!email.test(self.EMAIL_REGEX)){return}self.temp_user.toggleClass(self.SELECTED_CLASS);self.createUserFromLi(self.temp_user);if(self.temp_user.hasClass(self.SELECTED_CLASS)){self.collection.selectUserByEmail(email)}else{self.collection.deselectUserByEmail(email)}self.collection.build();self.updateCount()},onForagerClear:function(){this.clearForager()},onForagerRequestSuccess:function(tree){var self=this,user_list=self.container.getElement(".js-userlist");user_list.adopt(tree);self.initialize()},onForagerRequestFailure:function(xhr){console.log(xhr)},deselectAll:function(){this.collection.deselectAll()},filterSelected:function(obj){var self=this,at_least_one=false;if(obj&&obj.key==="enter"&&!self.collection.getSelected().length){return}self.current_filter=self.FILTER_SELECTED;self.setSelectedFilter();self.hideForagerMessages();self.collection.models.each(function(forager_user){if(forager_user.isSelected()){forager_user.show();at_least_one=true}else{forager_user.hide();
}});if(!at_least_one){self.showForagerMessage(self.FILTER_SELECTED)}},filterAll:function(){var self=this;self.current_filter=self.FILTER_ALL;self.setSelectedFilter();self.hideForagerMessages();if(self.collection.models.length){self.collection.models.each(function(forager_user){forager_user.show()})}else{self.showForagerMessage(self.FILTER_ALL)}},filterFavorites:function(){var self=this,at_least_one=false;self.current_filter=self.FILTER_FAVORITES;self.setSelectedFilter();self.hideForagerMessages();self.collection.models.each(function(forager_user){if(forager_user.isFavorite()){forager_user.show();at_least_one=true}else{forager_user.hide()}});if(!at_least_one){self.showForagerMessage(self.FILTER_FAVORITES)}},getFavoritesFromStorage:function(){var self=this,favorites=[],users,now=+new Date,limit=self.ONE_DAY*self.options.expire_favorites;if(self.hasFavoritesInStorage()){if(!!window.localStorage){users=JSON.decode(localStorage.user_forager_favorites)}else{users=JSON.decode(Cookie.read("user_forager_favorites"))}users.each(function(user){if(now-user.added<limit){favorites.push(user)}})}return favorites},hasFavoritesInStorage:function(){var decoded="";if(window.localStorage&&localStorage.user_forager_favorites){decoded=JSON.decode(localStorage.user_forager_favorites)}else if(Cookie.read("user_forager_favorites")){decoded=JSON.decode(Cookie.read("user_forager_favorites"))}return decoded&&decoded.length},setFavorites:function(){var self=this,selected=self.collection.getSelected(),values=self.getFavoritesFromStorage(),now=+new Date;selected.each(function(user){var obj={};if(user.isFavorite()||+user.user_id===-1){return}user.toggleFavorite();obj.user_id=user.user_id;obj.email=user.email;obj.added=now;values.push(obj)});if(!!window.localStorage){localStorage.user_forager_favorites=JSON.encode(values)}else{Cookie.write("user_forager_favorites",JSON.encode(values))}},clearFavorites:function(){var self=this,favorites;if(self.hasFavoritesInStorage()){if(!!window.localStorage){favorites=JSON.decode(localStorage.user_forager_favorites)}else{favorites=JSON.decode(Cookie.read("user_forager_favorites"))}favorites.each(function(favorite){var user;if(+favorite.user_id>-1){user=self.collection.getById(favorite.user_id)}else{user=self.collection.getByEmail(favorite.email)}if(user.isFavorite()){user.toggleFavorite()}});if(!!window.localStorage){localStorage.user_forager_favorites=""}else{Cookie.write("user_forager_favorites","")}}},clearInput:function(obj){var self=this;if(obj&&obj.key==="enter"&&!self.collection.getSelected().length){return}self.search.value="";self.search_clear.hide()},clearSearch:function(){var self=this;self.clearInput();self.filterAll();self.hideForagerMessages();self.deleteDomTempUsers()},clearForager:function(){var self=this;self.clearSearch();self.deselectAll()},getSearchElement:function(){return this.search},setSelectedFilter:function(run_function){var self=this,current=self.filters.getElement("."+self.SELECTED_CLASS),func;if(self.current_filter){if(current){current.removeClass(self.SELECTED_CLASS)}self.filters.getElement("."+self.current_filter).addClass(self.SELECTED_CLASS)}else{self.filters.getElement("."+self.previous_filter).addClass(self.SELECTED_CLASS);self.current_filter=self.previous_filter}if(run_function===true){func=self.filter_map[self.current_filter];self[func]()}},unsetSelectedFilter:function(){var self=this,current=self.filters.getElement("."+self.current_filter);if(current){current.removeClass(self.SELECTED_CLASS);self.previous_filter=self.current_filter;self.current_filter=null}},setAndRunSelectedFilter:function(){this.setSelectedFilter(true)},updateCount:function(){var self=this,count=0;self.collection.models.each(function(model){if(model.isSelected()){count=count+1}});self.selected_count.set("text",count)},handleEmailSearch:function(){var self=this,users,val;clearTimeout(self.search_timer);self.hideForagerMessages();self.search_timer=setTimeout(function(){self.collection.hideAll();self.temp_user.hide();val=self.search.value.trim().toLowerCase();users=self.collection.inTrie(val);if(users){users.each(function(user){user.show()});return}self.temp_user_name.set("text",val);self.temp_user_name.title=val;self.temp_user.show();self.temp_user.removeClass(self.SELECTED_CLASS)},300)},createUserFromEmail:function(){var self=this,li;li=self.temp_user;self.deleteDomTempUsers();self.createUserFromLi(li)},createUserFromLi:function(list_item,selected){var self=this,data={},select_state=selected?true:false,person,evt=window.event,li=list_item.clone();self.browse_list.adopt(li);self.temp_user.hide();data.user_id=li.get("data-user-id");data.display_name=li.get("text").trim();if(li.getElement("img")){data.portrait=li.getElement("img").get("src")}else if(evt&&evt.type==="click"){data.init_no_hover=true}data.email=self.search.value.toLowerCase();data.element=li;person=new ForagerUser(data);person.setSelectState(select_state);self.collection.addAndBuild(person);self.updateCount();return person},deleteDomTempUsers:function(){var self=this,sel;sel='.fg_temp:not("#fg_temp_user"):not(.'+self.SELECTED_CLASS+")";self.browse_list.getElements(sel).destroy()},handleUserSearch:function(){var self=this,value=self.search.value.trim().toLowerCase().replace(/\s+/,""),users=self.collection.models,trie=self.collection.trie,branch=value.charAt(0),results={};clearTimeout(self.search_timer);self.search_timer=setTimeout(function(){users.each(function(user){user.hide()});self.forager_messages.hide();self.collection.removeUnselectedTempUsersAndBuild();self.deleteDomTempUsers();if(value.length>0&&trie[branch]){results=Object.filter(trie[branch],function(v,k){return k.indexOf(value)===0});Object.each(results,function(user){user[0].show()})}else if(value.length===0){users.each(function(user){user.show()});return}if(!Object.getLength(results)||!users.length||value.length>0&&!trie[branch]){self.showForagerMessage()}},100)},hideForagerMessages:function(){this.forager_messages.hide()},showForagerMessage:function(type){var self=this;self.hideForagerMessages();switch(type){case self.FILTER_SELECTED:self.no_selected.show();break;case self.FILTER_FAVORITES:self.no_favorites.show();break;case self.FILTER_ALL:self.no_all.show();break;default:if(vimeo.cur_user){self.no_search.show()}}}});var ForagerCollection=new Class({Implements:[Options],options:{url:null},original_selected_ids:[],models:[],trie:{},initialize:function(options){var self=this;self.setOptions(options)},buildTrie:function(){var self=this;self.trie={};self.models.each(function(model){var words_in_display_name,name;if(model.user_id){self.addTrieLeaf(model.user_id.toString(),model)}if(model.display_name){name=model.display_name.toLowerCase();words_in_display_name=name.split(" ");words_in_display_name.each(function(word){self.addTrieLeaf(word,model)});self.addTrieLeaf(name.replace(/\s+/,""),model)}if(model.email){self.addTrieLeaf(model.email.toLowerCase(),model)}},self)},addTrieLeaf:function(leaf_key,leaf_object){var self=this,trie=self.trie,branch=leaf_key.charAt(0);if(!trie[branch]){trie[branch]={}}if(!trie[branch][leaf_key]){trie[branch][leaf_key]=[]}if(trie[branch][leaf_key].indexOf(leaf_object)<0){trie[branch][leaf_key].push(leaf_object)}},removeTrieLeaf:function(leaf_key){var self=this,trie=self.trie,branch=leaf_key.charAt(0);if(!trie[branch]||!!trie[branch][leaf_key]){return false}delete trie[branch][leaf_key];if(Object.getLength(trie[branch])===0){delete trie[branch]}return true},validateModel:function(model){var self=this,found=false,i,len,user;if(!model){return false}for(i=0,len=self.models.length;i<len;i++){user=self.models[i];if(model.user_id===user.user_id){if(+user.user_id===-1){if(model.email===user.email){found=true;break}}else{found=true;break}}}return!found},setSelectStateOfUserByEmail:function(email,state){var self=this,found=false,i,len,model;for(i=0,len=self.models.length;i<len;i++){model=self.models[i];if(model.email===email){found=true;model.setSelectState(state);break}}return found},add:function(model,build){var self=this,is_new_model=self.validateModel(model);if(is_new_model){self.models.push(model)}if(build===true){self.buildTrie()}},addAndBuild:function(model){this.add(model,true)},remove:function(model,build){var self=this,index=self.models.indexOf(model);if(index===-1){return}self.models.splice(index,1);if(build===true){self.buildTrie()}},removeAndBuild:function(model){this.remove(model,true)},getById:function(id){var self=this,matches=[],found=false,i,len,model;for(i=0,len=self.models.length;i<len;i++){model=self.models[i];if(+model.user_id===+id){found=true;if(+id===-1){matches.push(model)}else{matches=model;break}}}if(!found){return false}return matches},getByEmail:function(email){var self=this,match="",found=false,i,len,model;for(i=0,len=self.models.length;i<len;i++){model=self.models[i];if(model.email===email){found=true;match=model;break}}if(!found){return false}return match},removeTempUsers:function(keep_selected,build){var self=this,index=[],i,len,position,diff=0;self.models.each(function(model,i){if(+model.user_id===-1){if(keep_selected&&model.isSelected()){return}index.push(i)}});for(i=0,len=index.length;i<len;i++){position=index[i]-diff;self.remove(self.models[position]);diff=diff+1}if(build===true){self.buildTrie()}},removeTempUsersAndBuild:function(keep_selected){this.removeTempUsers(keep_selected,true)},removeUnselectedTempUsersAndBuild:function(){this.removeTempUsersAndBuild(true)},deselectAll:function(){this.models.each(function(model){model.setSelectState(false)})},deselectUserByEmail:function(email){return this.setSelectStateOfUserByEmail(email,false)},selectUserByEmail:function(email){return this.setSelectStateOfUserByEmail(email,true)},build:function(){this.buildTrie()},hideAll:function(){this.models.each(function(user){user.hide()})},showAll:function(){this.models.each(function(user){user.show()})},inTrie:function(val){var self=this,first,branch,found=false,leaf;if(!val){return}first=val.charAt(0);branch=self.trie[first];if(!branch){return false}Object.keys(branch).each(function(key){if(key===val){found=true;leaf=key;return}});if(found){return branch[leaf]}return false},getAddedIds:function(){var self=this,added=[],selected=self.getSelectedUserIds();for(var i=0,len=selected.length;i<len;i++){if(self.original_selected_ids.indexOf(selected[i])<0){added.push(selected[i])}}return added},getRemovedIds:function(){var self=this,removed=[],selected=self.getSelectedUserIds();for(var i=0,len=self.original_selected_ids.length;i<len;i++){if(selected.indexOf(self.original_selected_ids[i])<0){removed.push(self.original_selected_ids[i])}}return removed},getSelected:function(ids_only){var self=this,selected=[];self.models.each(function(model){if(model.isSelected()){if(ids_only===true){selected.push(+model.user_id)}else{selected.push(model)}}});return selected},getSelectedUserIds:function(){return this.getSelected(true)},getFavorites:function(ids_only){var self=this,favorites=[];self.models.each(function(model){if(model.isFavorite()){if(ids_only===true){favorites.push(+model.user_id)}else{favorites.push(model)}}});return favorites},getFavoritesUserIds:function(){return this.getFavorites(true)}});var ForagerUser=new Class({Implements:[Options],is_selected:false,is_favorite:false,no_hover_class:"fg_nohover",SELECTED_CLASS:"selected",options:{user_id:null,display_name:null,portrait:null,email:null,element:null},initialize:function(options){var self=this;self.setOptions(options);if(self.options.user_id===null){throw new Error("UserId required for new ForagerUser")}self.is_selected=self.options.element.hasClass(self.SELECTED_CLASS);self.user_id=self.options.user_id;self.display_name=self.options.display_name;self.portrait=self.options.portrait;self.email=self.options.email;self.element=self.options.element;self.init_no_hover=self.options.init_no_hover;self.setupUser();self.attachEvents()},setupUser:function(){var self=this;self.is_favorite=self.checkAgainstFavorites()},attachEvents:function(){var self=this;self.element.addEvent("click",self.toggleSelected.bind(self));if(self.init_no_hover){self.attachNoHoverFunctionality()}},attachNoHoverFunctionality:function(){var self=this;self.addNoHoverClass();self.element.addEvent("mouseleave:once",self.removeNoHoverClass.bind(self))},handleSelectedClass:function(){var self=this;if(self.is_selected){self.element.addClass(self.SELECTED_CLASS)}else{self.element.removeClass(self.SELECTED_CLASS)}},removeNoHoverClass:function(){var self=this;self.element.removeClass(self.no_hover_class)},addNoHoverClass:function(){var self=this;self.element.addClass(self.no_hover_class)},toggleSelected:function(){var self=this;self.is_selected=!self.is_selected;if(self.is_selected){self.attachNoHoverFunctionality()}self.setSelectState(self.is_selected)},setSelectState:function(state){var self=this;if(state!==false&&state!==true){return}self.is_selected=state;self.handleSelectedClass();Signal.forager.user.selected.dispatch({user_id:self.user_id,email:self.email,is_selected:state})},toggleFavorite:function(){var self=this;if(self.is_favorite){self.removeAsFavorite()}else{self.setAsFavorite()}},checkAgainstFavorites:function(){var self=this,favorites,umatch,ematch,found=false,ls=!!window.localStorage&&localStorage.user_forager_favorites,c=Cookie.read("user_forager_favorites"),i,len,user;if(ls||c){if(ls){favorites=JSON.decode(localStorage.user_forager_favorites)}else{favorites=JSON.decode(Cookie.read("user_forager_favorites"))}for(i=0,len=favorites.length;i<len;i++){user=favorites[i];umatch=+self.user_id!==-1&&+self.user_id===+user.user_id;ematch=self.email&&self.email===user.email;if(umatch||ematch){found=true;break}}}return found},hide:function(){this.element.hide()},show:function(){this.element.show()},isFavorite:function(){return this.is_favorite},isSelected:function(){return this.is_selected},setAsSelected:function(){var self=this;self.is_selected=true;self.element.addClass(self.SELECTED_CLASS)},removeAsSelected:function(){var self=this;self.is_selected=false;self.element.removeClass(self.SELECTED_CLASS)},setAsFavorite:function(){this.is_favorite=true},removeAsFavorite:function(){this.is_favorite=false}});var ColorPicker=new Class({Implements:[Options,Events],options:{initial_color:"#00adef",position:{edge:"upperLeft",position:"centerRight",offset:{x:0,y:0}},onUpdate:function(){},onSelect:function(){}},max_value:{H:359,S:100,V:100},color:null,previous_color:null,initialize:function(trigger,options){if($(trigger)===null){throw new Error("Invalid trigger element supplied to ColorPicker")}this.trigger=$(trigger);this.bound={onSatValMouseEvent:this.onSatValMouseEvent.bind(this),onHueMouseEvent:this.onHueMouseEvent.bind(this),onDocumentMouseUp:this.onDocumentMouseUp.bind(this),onBodyClick:this.onBodyClick.bind(this),onKeyUp:this.onKeyUp.bind(this)};this.setOptions(options);this.createElements();this.setDragArea();this.attachEvents();this.previous_color=this.options.initial_color;this.setColor(this.options.initial_color)},isValidHex:function(hex){var uses_hash=hex.split("")[0]==="#",color=uses_hash?hex:"#"+hex;return/^#[0-9a-f]{3}$|^#([0-9a-f]){6}$/i.test(color)},createElements:function(){this.widget=new Element("div",{"class":"color_picker"}).inject($(document.body)).hide();this.sat_val_selector=new Element("div",{"class":"sv_selector"}).inject(this.widget);this.sat_val_cursor=new Element("div",{"class":"sv_cursor"}).inject(this.sat_val_selector);this.hue_wrapper=new Element("div",{"class":"hue_wrapper"}).inject(this.widget);this.hue_selector=new Element("div",{"class":"hue_selector"}).inject(this.hue_wrapper);this.hue_cursor=new Element("div",{"class":"hue_cursor"}).inject(this.hue_wrapper);this.preview=new Element("div",{"class":"preview_swatch"}).inject(this.widget);this.clear_div=new Element("div",{"class":"clear"}).inject(this.widget);this.button_wrapper=new Element("div",{"class":"button_wrapper"}).inject(this.widget);this.select_button=new Element("button",{"class":"btn",html:"Select"}).inject(this.button_wrapper);this.or_span=new Element("span",{html:" or "}).inject(this.button_wrapper);this.close_button=new Element("a",{href:"#","class":"cancel",html:"cancel"}).inject(this.button_wrapper)},setDragArea:function(){var sat_val_dimensions,hue_dimensions;sat_val_dimensions=this.sat_val_selector.measure(function(){return this.getSize()});hue_dimensions=this.hue_selector.measure(function(){return this.getSize()});this.sat_val_cursor_padding=this.sat_val_cursor.measure(function(){return this.getSize().x/2});this.hue_cursor_padding=this.hue_cursor.measure(function(){return this.getSize().y/2});this.sat_val_width=sat_val_dimensions.x;this.sat_val_height=sat_val_dimensions.y;this.hue_width=hue_dimensions.x;this.hue_height=hue_dimensions.y},attachEvents:function(){this.trigger.addEvent("click",this.onToggleClick.bind(this));this.sat_val_selector.addEvent("mousedown",this.bound.onSatValMouseEvent);this.hue_selector.addEvent("mousedown",this.bound.onHueMouseEvent);this.select_button.addEvent("click",this.onSelectClick.bind(this));this.close_button.addEvent("click",this.onCloseClick.bind(this))},moveCursor:function(type,x,y){var padding=this[[type,"_cursor_padding"].join("")],max_width=this[[type,"_width"].join("")]-padding,max_height=this[[type,"_height"].join("")]-padding,x_pos=Math.max(padding,Math.min(x,max_width))-padding,y_pos=Math.max(padding,Math.min(y,max_height))-padding,cursor=this[[type,"_cursor"].join("")];cursor.setStyle("left",x_pos);cursor.setStyle("top",y_pos)},startTracking:function(type){var capital_camel_type=[type.charAt(0).toUpperCase(),type.slice(1)].join(""),drag_area=[type,"_selector"].join(""),drag_event=type==="hue"?"onHueMouseEvent":"onSatValMouseEvent";this[drag_area].addEvent("mousemove",this.bound[drag_event]);$(document.body).addEvent("mouseup",this.bound.onDocumentMouseUp)},update:function(updateSliders){var raw_hue=new Color([this.color.hsb[0],100,100],"hsb");this.sat_val_selector.setStyle("background-color",raw_hue.hex);this.preview.setStyle("background-color",this.color.hex);if(updateSliders===true){this.repositionSliders()}this.fireEvent("onUpdate",[this.color])},repositionSliders:function(){var hue_position={x:0,y:0},sat_val_position={x:0,y:0};hue_position.y=Math.round((360-this.color.hsb[0])/360*(this.hue_height-this.hue_cursor_padding));sat_val_position.x=Math.round(this.color.hsb[1]/100*this.sat_val_width);sat_val_position.y=Math.round((100-this.color.hsb[2])/100*this.sat_val_height);this.moveCursor("hue",hue_position.x,hue_position.y);this.moveCursor("sat_val",sat_val_position.x,sat_val_position.y)},positionWidget:function(){var options=this.options;this.widget.position({relativeTo:this.trigger,edge:options.position.edge,position:options.position.position})},onSatValMouseEvent:function(e){e.stop();var self=this,mouse_pos=e.page,el_pos=self.sat_val_selector.getCoordinates(),x_max=el_pos.width,y_max=el_pos.height,x=Math.max(0,Math.min(x_max,mouse_pos.x-el_pos.left)),y=Math.max(0,Math.min(y_max,mouse_pos.y-el_pos.top));if(e.type==="mousedown"){self.startTracking("sat_val")}self.moveCursor("sat_val",x,y);self.setSaturation(Math.round(x/x_max*100));self.setValue(Math.round(100-y/y_max*100));self.update()},onHueMouseEvent:function(e){e.stop();var self=this,mouse_pos=e.page,el_pos=self.hue_selector.getCoordinates(),x_max=el_pos.width,y_max=el_pos.height,x=Math.max(0,Math.min(x_max,mouse_pos.x-el_pos.left)),y=Math.max(0,Math.min(y_max,mouse_pos.y-el_pos.top));if(e.type==="mousedown"){self.startTracking("hue")}self.moveCursor("hue",0,y);self.setHue(Math.round(360-y/y_max*360));self.update()},onDocumentMouseUp:function(e){this.sat_val_selector.removeEvent("mousemove",this.bound.onSatValMouseEvent);this.hue_selector.removeEvent("mousemove",this.bound.onHueMouseEvent);$(document.body).removeEvent("mouseup",this.bound.onDocumentMouseUp)},onCloseClick:function(e){e.stop();this.revert();this.close()},onToggleClick:function(e){e.preventDefault();if(!this.widget.isVisible()){this.open()}else{this.close()}},onSelectClick:function(e){e.stop();this.fireEvent("onSelect",[this.color]);this.previous_color=this.color.hex;this.close()},onBodyClick:function(e){var parents=$(e.target).getParents();e.preventDefault();if(!parents.contains(this.widget)){this.revert();this.close()}},onKeyUp:function(e){if(e.key==="esc"){this.revert();this.close()}},setHue:function(value,force_update){this.color=this.color.setHue(Math.max(0,Math.min(value,this.max_value.H)));if(force_update===true){this.update()}},setSaturation:function(value,force_update){this.color=this.color.setSaturation(Math.max(0,Math.min(value,this.max_value.S)));if(force_update===true){this.update()}},setValue:function(value,force_update){this.color=this.color.setBrightness(Math.max(0,Math.min(value,this.max_value.V)));if(force_update===true){this.update()}},setColor:function(hex_value){if(this.color!==null){this.previous_color=this.color.hex}if(!this.isValidHex(hex_value)){console.warn("Invalid hex_value supplied to ColorPicker.setColor()",hex_value);hex_value="#ffffff"}this.color=new Color(hex_value);this.update(true)},revert:function(){this.color=new Color(this.previous_color);this.update()},open:function(){this.positionWidget();this.widget.show();$(document).addEvent("mousedown",this.bound.onBodyClick);$(document).addEvent("keyup",this.bound.onKeyUp)},close:function(){this.widget.hide();$(document).removeEvent("mousedown",this.bound.onBodyClick);$(document).removeEvent("keyup",this.bound.onKeyUp)}});var Revolver=new Class({Implements:[Options,Events],options:{startIndex:0,timerDelay:5e3,className:"fading_revolver",height:"auto",showFx:{property:"opacity",duration:525,transition:"sine:out"},hideFx:{property:"opacity",duration:250,transition:"sine:out"},showAllEl:undefined},paused:false,timer:null,effect:null,currentIndex:0,delayCounter:-1,initialize:function(container,elements,options){if($(container)===null){throw new Error("Invalid element supplied to Revolver")}this.setOptions(options);this.container=$(container);this.elements=elements||this.container.getChildren();this.currentIndex=this.options.startIndex;this.bound={next:this.next.bind(this),onItemOver:this.onItemOver.bind(this),onItemOut:this.onItemOut.bind(this)};this.createElements();this.attachEvents();this.start()},createElements:function(){var options=this.options,container=this.container,showAllEl=this.options.showAllEl;if(showAllEl===undefined){this.showAllButton=this.createShowAllButton()}else{this.showAllButton=$(showAllEl)}container.addClass("revolver");container.addClass(options.className);if(typeOf(options.height)==="number"){container.setStyle("height",options.height)}this.elements[this.options.startIndex].addClass("active")},attachEvents:function(){if(this.showAllButton!==null){this.showAllButton.addEvent("click",this.onShowAllToggle.bind(this))}this.container.addEvents({mouseenter:this.bound.onItemOver,mouseleave:this.bound.onItemOut})},createShowAllButton:function(){return new Element("a",{html:"View All","class":"revolver_view_all"}).inject(this.container,"after")},onShowAllToggle:function(e){e.stop();this.stop();this.showAll()},onItemOver:function(){this.paused=true;this.stop()},onItemOut:function(){this.paused=false;this.start()},start:function(){if(this.timer===null){this.timer=setInterval(function(){if(!this.paused){this.next()}}.bind(this),this.options.timerDelay)}},stop:function(){if(this.timer!==null){clearInterval(this.timer);this.timer=null}},show:function(index,callback){var el=this.elements[index];this.effect=new Fx.Tween.CSS3(el,this.options.showFx);this.effect.addEvent("complete",function(){el.addClass("active");if(typeof callback!=="undefined"){callback.call()}}.bind(this));this.effect.start(0,1)},hide:function(index,callback){var el=this.elements[index];this.effect=new Fx.Tween.CSS3(el,this.options.hideFx);this.effect.addEvent("complete",function(){el.removeClass("active");if(typeof callback!=="undefined"){callback.call()}}.bind(this));this.effect.start(1,0)},showAll:function(){this.elements.each(function(item){item.erase("style");item.erase("class")},this);this.container.removeEvents({mouseenter:this.bound.onItemOver,mouseleave:this.bound.onItemOut});this.container.addClass("show_all_revolver");this.showAllButton.destroy()},next:function(){var nextIndex=this.currentIndex+1;if(nextIndex>=this.elements.length){nextIndex=0}this.hide(this.currentIndex,function(){this.show(nextIndex);this.currentIndex=nextIndex}.bind(this))}});var AutoComplete=new Class({Implements:[Options,Events],options:{className:"ac_list",maxHeight:200,parentElement:null,disableParentForm:true,limitedDisabledParent:false,autoSelect:true,hideOnEmptySet:true,url:null,action:"suggest",limit:10,pollingThreshold:125,minimumLength:3,selectionAlwaysFocused:false,onLoadStart:function(){},onLoadComplete:function(){},onOpen:function(){},onClose:function(){},onSuggestionSelect:function(){},showOnFocus:true,showOnClick:true,stopOn:null,requestData:{}},focusIndex:-1,suggestionsLoaded:false,open:false,initialize:function(input,options){if($(input)===null){throw new Error("Invalid element supplied to AutoComplete")}this.setOptions(options);this.input=$(input);this.url=this.options.url||this.input.getParent("form").get("action");this.bound={bodyClick:this.onBodyClick.bind(this),mouseMove:this.onMouseMove.bind(this),suggestionOver:this.onSuggestionOver.bind(this),suggestionOut:this.onSuggestionOut.bind(this),suggestionClick:this.onSuggestionClick.bind(this),delayedSearch:this.delayedSearch.bind(this)};this.createElements();this.createRequest();this.attachEvents()},createElements:function(){var options=this.options,injection_location=options.parentElement===null?this.input.getParent():options.parentElement;this.container=new Element("div",{"class":this.options.className}).setStyles({display:"none",width:this.calculateWidth(),"max-height":this.options.maxHeight+"px"}).inject(injection_location).position({relativeTo:this.input,position:"bottomLeft",edge:"topLeft"});this.input.set("autocomplete","off")},createRequest:function(){this.ajaxRequest=new Request.HTML({url:this.url,method:"get",update:this.container,onSuccess:this.onSearchLoaded.bind(this)})},attachEvents:function(){var events={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this)};if(this.options.showOnClick){events.click=this.onFocus.bind(this)}if(this.options.showOnFocus){events.focus=this.onFocus.bind(this)}this.input.addEvents(events);this.container.addEvent("scroll",this.onListKeyDown.bind(this));this.enableMouseEvents();if(this.options.disableParentForm&&!this.options.limitedDisabledParent){this.input.getParents("form").addEvent("submit",Function.from(false))}},enableMouseEvents:function(){this.container.addEvent("mouseover:relay(li)",this.bound.suggestionOver);this.container.addEvent("mouseout:relay(li)",this.bound.suggestionOut);this.container.addEvent("click:relay(li)",this.bound.suggestionClick);this.container.removeEvent("mousemove",this.bound.mouseMove)},disableMouseEvents:function(){this.container.removeEvent("mouseover:relay(li)",this.bound.suggestionOver);this.container.removeEvent("mouseout:relay(li)",this.bound.suggestionOut);this.container.removeEvent("click:relay(li)",this.onSuggestionClick.bind(this));this.container.addEvent("mousemove",this.bound.mouseMove)},calculateWidth:function(){var input=this.input,inputWidth=parseInt(input.getStyle("width"),10),inputPadding=input.getStyle("padding").split(" "),sidePadding=input.getStyle("box-sizing")==="border-box"?0:parseInt(inputPadding[1],10)+parseInt(inputPadding[3],10),updatedWidth=inputWidth+sidePadding+"px";return updatedWidth},delayedSearch:function(){if(this.ajaxDelay){clearTimeout(this.ajaxDelay)}this.search(this.input.get("value"))},focusNext:function(){var totalResults=this.container.getElements("li");this.focusIndex++;if(this.focusIndex>=totalResults.length){this.focusIndex=totalResults.length-1}this.updateFocus()},focusPrev:function(){this.focusIndex--;if(this.focusIndex<0){this.focusIndex=0}this.updateFocus()},updateFocus:function(){var totalResults=this.container.getElements("li");if(this.focusedItem){this.focusedItem.removeClass("selected")}this.focusedItem=totalResults[this.focusIndex];this.focusedItem.addClass("selected");this.checkScroll()},checkScroll:function(){var el=this.focusedItem,list=this.container,listHeight=list.getSize().y,elHeight=el.getSize().y,centerIndex=Math.floor(listHeight/2/elHeight);this.container.scrollTo(0,elHeight*(this.focusIndex-centerIndex))},getNearestLI:function(el){var target=$(el),closestLI=target.get("tag")==="li"?target:target.getParents("li");return closestLI},isEmptySet:function(){return this.container.getElements("li:not(.no_matches)").length===0},onFocus:function(e){if(!this.suggestionsLoaded){return}if(this.isEmptySet()&&this.options.hideOnEmptySet){this.hideSuggestions()}else{this.showSuggestions()}},onListKeyDown:function(){this.input.focus()},onKeyDown:function(e){if(this.options.stopOn!==null&&this.input.get("value").test(this.options.stopOn)){this.clearSuggestions();return}if(this.options.limitedDisabledParent&&this.container.isDisplayed()){this.input.getParents("form").addClass("disabled");this.input.getParents("form").addEvent("submit",this.empty)}var key=e.key,containerVisible=this.container.isDisplayed();if(e.key==="up"){e.preventDefault()}switch(key){case"up":if(containerVisible){this.focusPrev();this.disableMouseEvents()}break;case"down":if(containerVisible){this.focusNext();this.disableMouseEvents()}break}},onKeyUp:function(e){e.stop();var key=e.key,term=this.input.get("value"),containerVisible=this.container.isDisplayed(),alphaNumericRegEx=/[a-zA-Z0-9]/;if(this.options.limitedDisabledParent&&this.container.isDisplayed()){this.input.getParents("form").removeClass("disabled");this.input.getParents("form").removeEvent("submit",this.empty)}switch(key){case"enter":if(containerVisible&&this.focusedItem){this.hideSuggestions();this.fireEvent("onSuggestionSelect",[this.focusedItem,this.input,e]);this.fireEvent("select",{item:this.focusedItem,input:this.input})}break;case"esc":if(containerVisible){this.hideSuggestions()}break;default:if(term.length>=this.options.minimumLength&&(key.length===1&&key.match(alphaNumericRegEx)||key==="backspace")){this.ajaxDelay=this.bound.delayedSearch.delay(this.options.pollingThreshold)}else if(term.length===0){this.reset()}}},onMouseMove:function(e){this.enableMouseEvents()},onSearchLoaded:function(tree,elements,html,javascript){var emptySet=this.isEmptySet();this.fireEvent("onLoadComplete");if(emptySet&&this.options.hideOnEmptySet){this.hideSuggestions();return false}else{this.suggestionsLoaded=true;this.showSuggestions();if(!emptySet&&this.options.autoSelect){this.focusIndex=-1;this.focusNext()}if(this.options.highlight){this.highlightTerms()}return true}},highlightTerms:function(){var term=this.input.get("value"),list_items=this.container.getElements("li.searchable a");if(list_items){list_items.each(function(item,index,object){item.set("html",item.get("text").toString().highlightTerm(term))})}},onSuggestionOver:function(e){e.stop();if(this.focusedItem){this.focusedItem.removeClass("selected")}this.focusedItem=e.target.tagName.toString().toLowerCase()==="li"?e.target:e.target.getParent("li");this.focusedItem.addClass("selected");this.focusIndex=this.container.getElements("li").indexOf(this.focusedItem)},onSuggestionOut:function(e){e.stop();if(this.options.selectionAlwaysFocused){return}if(this.focusedItem){this.focusedItem.removeClass("selected")}this.focusedItem=null},onSuggestionClick:function(e){this.focusedItem=e.target.tagName.toString().toLowerCase()==="li"?e.target:e.target.getParent("li");this.fireEvent("onSuggestionSelect",[this.focusedItem,this.input]);this.fireEvent("select",{item:this.focusedItem,input:this.input});this.hideSuggestions()},onBodyClick:function(e){var parents=$(e.target).getParents();if(e.target!==this.container&&!parents.contains(this.container)&&!parents.contains(this.input)){if(this.input.getParent("label")&&parents.contains(this.input.getParent("label"))){return;
}this.hideSuggestions()}},onBlur:function(e){this.hideSuggestions();parent.onBlur(e)},refreshPosition:function(){this.container.position({relativeTo:this.input,position:"bottomLeft",edge:"topLeft"})},showSuggestions:function(){if(this.container.getElements("li").length===0){console.warn("no results!");return}this.container.position({relativeTo:this.input,position:"bottomLeft",edge:"topLeft"}).show();$(document).addEvent("mousedown",this.bound.bodyClick);this.open=true;this.fireEvent("onOpen")},hideSuggestions:function(){this.container.hide();$(document).removeEvent("mousedown",this.bound.bodyClick);this.open=false;this.fireEvent("onClose")},clearSuggestions:function(){this.hideSuggestions();this.container.empty()},search:function(term){var options=this.options,request_parameters;this.fireEvent("onLoadStart");request_parameters=Object.merge(options.requestData,{search:term,limit:options.limit,action:options.action});this.ajaxRequest.send({data:request_parameters,link:"cancel"})},reset:function(){this.focusIndex=-1;this.suggestionsLoaded=false;this.clearSuggestions();this.input.set("value","")},empty:function(){return false}});var Lightbox=new Class({Implements:[Options,Events],options:{url:null,html:null,stop_links:true,data:"",uid:"",className:"default_lightbox",position:"fixed",original_position:"",overflow:"auto",width:"auto",height:"auto",scrolling:"auto",top:"auto",scrollIntoView:false,doubleSubmitProtector:false,cache:true,type:null,iframe_id:null,onOpen:function(){},onLoad:function(){},onClose:function(){},prevent_overlay_close:false,prevent_key_close:false,prevent_position_management:false,prevent_subsequent_iframe_opens:false},standAloneMode:false,currentContent:null,defaultOptions:this.options,_iframe_open_count:-1,initialize:function(links,options){var self=this;self.setOptions(options);self.defaultOptions=Object.clone(self.options);if(links!==null){self.attachToLinks(links)}else{self.standAloneMode=true}var uid=self.options.uid;if($("lightbox_container"+uid)!==null){self.container=$("lightbox_container"+uid);self.content=$("lightbox_content"+uid);self.overlay=$("lightbox_overlay"+uid)}else{self.createElements();self.updateStyles();self.attachEvents()}},attachToLinks:function(links){var self=this;$$(links).each(function(link){if(link.get("data-lightbox-defined")!=="true"){link.addEvent("click",self.onLinkClick.bind(self));link.set("data-lightbox-defined","true")}},self)},createElements:function(){var self=this,docBody=$(document.body),uid=self.options.uid,closeCopy;self.wrapper=$("wrap");self.content=new Element("div",{id:"lightbox_content"+uid,"class":"lightbox_content"});if(typeof Copy!=="undefined"&&typeof Copy.dict!=="undefined"&&typeof Copy.dict.close!=="undefined"){closeCopy=Copy.dict.close}else{closeCopy="Close"}self.container=new Element("div",{id:"lightbox_container"+uid}).adopt(self.closeButton,self.content).hide().inject(docBody);self.overlay=new Element("div",{id:"lightbox_overlay"+uid,"class":"lightbox_overlay"}).hide().inject(docBody)},createRequest:function(){var self=this;self.request=new Request.HTML({method:"get",update:self.content,evalScripts:true,onSuccess:self.onAjaxSuccess.bind(self),onFailure:self.onAjaxFailure.bind(self)})},updateStyles:function(){var self=this,opts=self.options,container=self.container,content=self.content;container.erase("class");if(opts.className!==null){container.set("class",opts.className)}self.container.addClass(self.currentContent);container.setStyle("position",opts.position);content.setStyle("width",opts.width);content.setStyle("height",opts.height);!self.options.prevent_position_management&&self.centerWindow()},centerWindow:function(){var self=this,win=$(window),options=self.options,container=self.container,window_size=win.getSize(),container_size=container.getSize(),x_pos=Math.max(0,window_size.x*.5-container_size.x*.5),y_pos=Math.max(0,window_size.y*.5-(container_size.y||480)*.5);if(options.position==="fixed"&&window_size.y<=container_size.y){options.original_position="fixed";options.position="absolute";container.setStyle("position",options.position)}else if(options.original_position==="fixed"&&options.position==="absolute"&&window_size.y>container_size.y+40){options.position="fixed";container.setStyle("position",options.position)}if(options.top!=="auto"){y_pos=options.top}if(options.position==="absolute"){y_pos+=win.getScroll().y}container.setPosition({x:x_pos,y:y_pos})},attachEvents:function(){var self=this;!self.options.prevent_overlay_close&&self.overlay.addEvent("click",self.onCloseClick.bind(self));self.container.addEvent("click:relay(.close)",self.onCloseClick.bind(self))},parseInlineOptions:function(query){var parameters=new Hash,params=query.split("|"),key,value;params.each(function(param){param=param.substr(0,param.indexOf("="))+"|"+param.substr(param.indexOf("=")+1);param=param.split("|");key=param[0];value=param[1].toString();if(key==="width"||key==="height"){if(value.indexOf("px")===-1){value+="px"}}parameters.set(key,value)});return parameters},getContentType:function(url){var self=this,image_regex=/\.(gif|jpg|jpeg|tiff|png)$/i,is_image,content_type;if(!url){return}is_image=image_regex.test(url.toLowerCase());if(self.options.type!==null){content_type=self.options.type}else if(is_image){content_type="image"}else if(url.length>1&&url.substr(0,1)==="#"){content_type="div"}else{content_type="ajax"}self.currentContent=content_type;return content_type},validateHash:function(url){var anchor_id=$(url.substr(1,url.length)),is_valid=anchor_id!==null;return is_valid},onLinkClick:function(e){var self=this;if(self.options.stop_links){e.stop();if(e.target){e.target.removeEvents("click");e.target.addEvent("click",self.onLinkClick.bind(self))}}var target=$(e.target),optionsUrl,hrefUrl,requestUrl,markupOptions,inlineOptions,currentOptions,updatedOptions;if(target.get("data-lightbox")===null){target=$(e.target).getParents("[data-lightbox]")[0]}self.setOptions(self.defaultOptions);optionsUrl=self.options.url;hrefUrl=target?target.get("href"):null;markupOptions=target?target.get("data-lightbox-options"):null;currentOptions=$H(self.defaultOptions);if(markupOptions!==null&&typeof markupOptions!=="object"&&markupOptions.length>0){inlineOptions=self.parseInlineOptions(markupOptions);Object.append(currentOptions,inlineOptions)}updatedOptions=currentOptions.getClean();self.setOptions(updatedOptions);optionsUrl=self.options.url;if(self.options.title&&self.options.description){self.loadHTML(self.createBasicLightbox(self.options.title,self.options.description));return}else if(optionsUrl!==null){requestUrl=optionsUrl.toString()}else if(hrefUrl!==null){requestUrl=hrefUrl.toString()}else if(self.options.html){self.loadHTML(self.options.html);return}else{console.info(updatedOptions);throw new Error('Your element must have an "href" property or you must pass a custom URL in the options parameter of this class')}self.openLink(requestUrl)},openLink:function(requestUrl){var self=this;if(requestUrl!==self.container.get("data-url")){self.load(requestUrl,self.options.data)}else{self.open()}},createBasicLightbox:function(title,description){return"<header><h1>"+title+'</h1></header><div><p class="col">'+description+"</p></div>"},onCloseClick:function(e){this.close()},onKeyUp:function(e){if(e.key==="esc"){this.close()}},onWindowResize:function(e){this.centerWindow()},onAjaxSuccess:function(tree,elements,html,javascript){var self=this;if(self.options.cache===true){self.container.set("data-url",self.lastUrlRequest)}else{self.container.set("data-url",(new Date).getTime())}self.fireEvent("load");self.open()},onAjaxFailure:function(xhr){var json_response=JSON.decode(xhr.response),title=xhr.statusText||Copy.dict.oops,message=json_response.display_message||"This action is currently disabled. Please try later.";try{Singletonbox.alert(title,message)}catch(x){alert(message)}},onImageSuccess:function(){var self=this;self.content.empty().adopt(new Element("img",{src:self.lastUrlRequest}));if(self.options.cache===true){self.container.set("data-url",self.lastUrlRequest)}else{self.container.set("data-url",(new Date).getTime())}self.fireEvent("load");self.open()},load:function(url,data){var self=this,requestUrl=self.options.url||url,contentType=self.getContentType(requestUrl),safeToOpen=requestUrl!==null;if(contentType==="div"){safeToOpen=self.validateHash(requestUrl)}if(safeToOpen){if(contentType==="ajax"){self.loadAjax(requestUrl,data)}else if(contentType==="iframe"){self.loadIFrame(requestUrl)}else if(contentType==="image"){self.loadImage(requestUrl)}else{self.loadDiv(requestUrl)}}else{throw new Error("A null URL was passed to Lightbox.load()")}},loadIFrame:function(url){var self=this;self.lastUrlRequest=url;var html=new IFrame({src:url,id:self.options.iframe_id,frameborder:0,scrolling:self.options.scrolling,events:{load:function(){var iframe=$(self.options.iframe_id);self.fireEvent("load");self.options.prevent_subsequent_iframe_opens&&self._iframe_open_count++;if(self._iframe_open_count<=0){self.open()}if(iframe&&iframe.contentDocument&&iframe.contentDocument.fireEvent){iframe.contentDocument.fireEvent("iframe_loaded")}}},styles:{width:self.options.width,height:self.options.height}});self.content.empty().adopt(html);self.container.set("data-url",self.lastUrlRequest)},loadAjax:function(url,data){var self=this;if(!self.request){self.createRequest()}self.lastUrlRequest=url;self.request.send({url:url,data:data||self.options.data});self.fireEvent("open")},loadImage:function(url){var self=this;self.lastUrlRequest=url;var img=new Asset.image(url,{onLoad:self.onImageSuccess.bind(self)});self.fireEvent("open")},loadDiv:function(url){var source_element=$(url.substr(1,url.length)),self=this;self.placeholder=new Element("div#lightbox_placeholder").wraps(source_element);self.content.empty().adopt(source_element);self.container.set("data-url","#"+source_element.get("id"));self.fireEvent("load");self.open()},loadHTML:function(html_str){var html=Elements.from(html_str),self=this;self.content.empty().adopt(html);self.container.set("data-url",(new Date).getTime());self.fireEvent("load");self.open()},open:function(){var self=this,options=self.options,requestUrl=options.url,contentType=self.getContentType(requestUrl),tf=self.content.getElement(":textfield");self.updateStyles();if(options.doubleSubmitProtector==="true"&&self.double_submit_protector===undefined){self.double_submit_protector=new window.DoubleSubmitProtector}if(!self.wrapper){self.wrapper=$("wrap")}var overlay_opacity=self.overlay.getStyle("opacity"),container_opacity=self.container.getStyle("opacity");self.overlay.setStyle("opacity",0).show();self.container.show();!self.options.prevent_position_management&&self.centerWindow();self.overlay.setStyle("opacity",overlay_opacity);setTimeout(function(){self.container.addClass("active");Signal.lightbox.activated.dispatch({})},100);if(tf&&!tf.get("disabled")&&tf.get("autofocus")){setTimeout(function(){tf.focus()},100)}if(options.position==="absolute"&&(options.scrollIntoView===true||options.scrollIntoView==="true")){self.scroll=self.scroll||new Fx.Scroll(window,{duration:200,transition:Fx.Transitions.Expo.easeOut});self.scroll.toTop()}!self.options.prevent_key_close&&$(document).addEvent("keyup",self.onKeyUp.bind(self));!self.options.prevent_position_management&&$(window).addEvent("resize",self.onWindowResize.bind(self));if(contentType!=="ajax"){self.fireEvent("open")}if(options.overflow!=="auto"){$$("html").setStyle("overflow",options.overflow)}Signal.lightbox.opened.dispatch()},close:function(){var evt,self=this;if(!self.wrapper){self.wrapper=$("wrap")}self.container.removeClass("active");self.overlay.setStyle("opacity",0);if(self.wrapper){self.wrapper.setStyle("-webkit-filter","none")}setTimeout(function(){self.overlay.setStyle("opacity",null).hide();self.container.setStyle("opacity",null).hide();if(self.wrapper){self.wrapper.setStyle("-webkit-filter",null);self.wrapper.setStyle("-webkit-transform",null);self.wrapper.removeClass("tooltip_wrap")}self.fireEvent("close");Signal.lightbox.closed.dispatch({})},200);!self.options.prevent_key_close&&$(document).removeEvent("keyup",self.onKeyUp.bind(self));!self.options.prevent_position_management&&$(window).removeEvent("resize",self.onWindowResize.bind(self));if(self.placeholder){self.content.getFirst().replaces(self.placeholder);self.placeholder=null;self.container.set("data-url","")}var form=self.content.getElement("form");if(form){if(form.retrieve("validator")){form.retrieve("validator").reset()}form.reset()}try{evt=document.createEvent("UIEvent");evt.initEvent("close",false,false);document.dispatchEvent(evt)}catch(x){}if(self.options.overflow!=="auto"){$$("html").setStyle("overflow",null)}},closeAndDestroy:function(){var self=this;self.overlay.destroy();self.container.destroy();if(self.wrapper){self.wrapper.setStyle("-webkit-filter",null);self.wrapper.setStyle("-webkit-transform",null)}}});var Singletonbox={instance:null,open:function(options){var url,html,self=this;if(self.instance!==null){self.instance.closeAndDestroy()}self.instance=new Lightbox(null,options);if((url=options.url)&&url.length>1){if(url.substr(0,1)==="#"){self.instance.loadDiv(url)}else{self.instance.loadAjax(options.url)}}else if(options.html||options.title&&options.description){html=options.html?options.html:self.instance.createBasicLightbox(options.title,options.description);self.instance.loadHTML(html)}return self},close:function(){var self=this;if(self.instance===null){throw new Error("Singletonbox has not been instantiated. Unable to close.")}self.instance.closeAndDestroy();self.instance=null},centerWindow:function(){var self=this;if(self.instance===null){throw new Error("Singletonbox has not been instantiated. Unable to close.")}self.instance.centerWindow()},alert:function(title,message){Singletonbox.open({width:"540px",html:"<header><h1>"+title+'</h1></header><div class="col"><p>'+message+"</p></div>"})}};var ToggleBox=new Class({Implements:[Options,Events],options:{onOpen:function(){},onClose:function(){},onToggle:function(){}},initialize:function(element,options){if($(element)===null){throw new Error("Invalid element supplied to ToggleBox")}else if($($(element).get("data-trigger"))===null){throw new Error("Toggle box is missing a trigger")}this.setOptions(options);this.element=$(element);this.trigger=$(this.element.get("data-trigger"));this.triggerValue=this.element.get("data-trigger-value");if(this.trigger.hasClass("toggle_box_trigger")){return}this.element.store("togglebox",this);this.trigger.store("togglebox",this);this.trigger.addClass("toggle_box_trigger");this.attachEvents()},attachEvents:function(){if(this.trigger.get("type")==="radio"){this.trigger.getParent("form").addEvent('click:relay(input[name="'+this.trigger.get("name")+'"])',this.onToggleRadio.bind(this))}else if(this.trigger.get("type")==="select-one"){this.trigger.addEvent("change",this.onToggle.bind(this))}else{this.trigger.addEvent("click",this.onToggle.bind(this))}},onToggle:function(e){var trigger_type=this.trigger.get("type");if(trigger_type==="checkbox"){this.toggleRadioCheck()}else if(trigger_type==="select-one"){this.toggleSelectCheck()}else{this.toggleNormal();if(e){e.stop()}}},onToggleRadio:function(e){this.toggleRadioCheck()},toggleRadioCheck:function(){if(this.trigger.get("checked")){this.show()}else{this.hide()}},toggleSelectCheck:function(){if(this.trigger.get("value")===this.triggerValue){this.show()}else{this.hide()}},toggleNormal:function(attribute){var current_text,swap_text;if(this.trigger.get("data-swap-text")){current_text=this.trigger.get("text");swap_text=this.trigger.get("data-swap-text");this.trigger.set("text",swap_text);this.trigger.set("data-swap-text",current_text)}if(!this.trigger.get("data-checked")){this.trigger.set("data-checked","off")}if(this.trigger.get("data-checked")==="off"){this.trigger.set("data-checked","on");this.show()}else if(this.trigger.get("data-checked")==="on"){this.trigger.set("data-checked","off");this.hide()}},show:function(){var input=this.element.getElement(":input");this.element.show();if(input&&!input.get("value")&&input.get("autofocus")){input.focus()}if(input&&input.get("data-autoselect")){input.select()}this.fireEvent("open");this.fireEvent("toggle")},hide:function(){this.element.hide();this.fireEvent("close");this.fireEvent("toggle")}});var Toggler=new Class({Implements:[Options,Events],options:{className:"skinned_checkbox",content:"&bull;"},initialize:function(checkboxes,options){this.setOptions(options);this.checkboxes=$$(checkboxes);if(this.checkboxes===null){return false}this.checkboxes.each(function(checkbox){this.createReplacement(checkbox)},this)},createReplacement:function(checkbox){var baseClass=this.options.className,checkboxId=checkbox.get("id")||["checkbox_",Math.floor(Math.random()*999999999)].join(""),replacement=new Element("label",{"class":baseClass,html:this.options.content});if(checkbox.get("checked")===true){replacement.addClass(baseClass+"_active")}replacement.inject(checkbox,"after");checkbox.set("id",checkboxId).addEvent("change",this.onCheckboxChange.bind(this));checkbox.setStyles({position:"absolute",left:"-9999px"});checkbox.store("replacement",replacement);replacement.store("original",checkbox);if(replacement.getParent().get("tag")!=="label"){replacement.set("for",checkboxId)}if(checkbox.get("disabled")){$$('label[for="'+checkboxId+'"]').each(function(label){label.addClass("disabled")})}},onCheckboxChange:function(e){var activeClass=this.options.className+"_active",checkbox=$(e.target),replacement=checkbox.retrieve("replacement");if(checkbox.type==="radio"){if(checkbox.get("checked")===true){this.checkboxes.each(function(checkbox){checkbox.retrieve("replacement").removeClass(activeClass)},this);replacement.addClass(activeClass)}}else{if(checkbox.get("checked")===true){replacement.addClass(activeClass)}else{replacement.removeClass(activeClass)}}}});var KeyManager=new Class({inputFocused:false,initialize:function(){this.document=$(document);this.bound={onKeyUp:this.onKeyUp.bind(this),onInputClick:this.onInputClick.bind(this),onInputFocus:this.onInputFocus.bind(this),onInputBlur:this.onInputBlur.bind(this)};this.attachEvents()},attachEvents:function(){this.document.addEvent("keyup",this.bound.onKeyUp);if(!document.activeElement){this.document.addEvent("click:relay(input)",this.bound.onInputClick);this.document.addEvent("click:relay(textarea)",this.bound.onInputClick)}},trigger:function(keycode){var callback=this["keycode_"+keycode+"_method"],inputFocused,activeElement,elementType;if(document.activeElement){activeElement=$(document.activeElement);elementType=activeElement.get("tag");inputFocused=elementType==="input"||elementType==="textarea"}else{inputFocused=this.inputFocused}if(!inputFocused&&callback){callback.attempt(this["keycode_"+keycode+"_params"])}},onKeyUp:function(e){this.trigger(e.key)},onInputClick:function(e){var target=$(e.target);target.addEvents({focus:this.bound.onInputFocus,blur:this.bound.onInputBlur});target.removeEvent("click",this.bound.onInputClick)},onInputFocus:function(e){this.inputFocused=true},onInputBlur:function(e){this.inputFocused=false},register:function(keycode,callback,parameters){this["keycode_"+keycode+"_method"]=callback;this["keycode_"+keycode+"_params"]=parameters},unregister:function(keycode,callback){this["keycode_"+keycode+"_method"]=null;this["keycode_"+keycode+"_params"]=null}});var TimeUpdater={interval:null,TIMEOUT:30*1e3,update:function(){$$("#comments time").each(function(el){var now=Math.floor((new Date).getTime()/1e3),time=Math.floor(new Date(el.get("datetime")).getTime()/1e3),diff=now-time,display=null,method="";if(diff<60&&(method="seconds_ago")){display=Math.floor(diff)}else if(diff<3600&&(method="minutes_ago")){display=Math.floor(diff/60)}else if(diff<86e3&&(method="hours_ago")){display=Math.floor((now-time)/3600)}if(diff<86400){el.set("html",Copy.translate(method,display!==1,{COUNT:display}))}})},start:function(){TimeUpdater.interval=setInterval(TimeUpdater.update,TimeUpdater.TIMEOUT)},stop:function(){clearInterval(TimeUpdater.interval);TimeUpdater.interval=null}};var Share={storage:null,initialize:function(){var container=$("share_popup"),t;Share.loadDependencies();Share.columns=container.getElements(".col");if(Share.columns.length>=2){Share.columnPadding=Share.columns[0].getStyle("padding-top").toInt()+Share.columns[0].getStyle("padding-bottom").toInt()}if(Cookie.read("embed_preferences")){Share.storage=JSON.decode(Cookie.read("embed_preferences"))}container.getElements(".toggle_box").each(function(element){t=new ToggleBox(element,{onToggle:function(){Share.equalize()}})});Share.equalize();if($("message_input")){$("message_input").addEvent("keyup",this.onMessageUpdate)}},loadDependencies:function(){Share.onForageLoaded()},equalize:function(){var currentHeight,heightToMatch;if(Share.columns.length<2){return false}Share.columns.each(function(col,i){col.erase("style")});Share.columns.each(function(col,i){currentHeight=col.measure(function(){return this.getSize().y});if(i===0||currentHeight>heightToMatch){heightToMatch=currentHeight-Share.columnPadding}});Share.columns.each(function(col,i){col.setStyle("height",heightToMatch+"px")});return true},onForageLoaded:function(){Share.forage=new Forage.Share("fg",{addEmails:!$("fg").hasClass("no_email"),form:"mailer",onUserAdded:function(){setTimeout(function(){Share.equalize()},50)},onUserRemoved:function(){setTimeout(function(){Share.equalize()},50)}});Global.lightbox.centerWindow();if(Global.shareLightbox){Global.shareLightbox.centerWindow()}Global.xsrfProtect()},onColorPickerLoaded:function(){var startColor;if(!$("share_embed")){return}if(Share.storage){startColor=Share.storage.color}if($("color_picker_toggle")){Embed.colorPicker=new ColorPicker("color_picker_toggle",{initial_color:startColor||$("embed_color").get("value"),onUpdate:function(color){var hex=color.hex.toLowerCase();Embed.customizations.colorInput.set("value",hex);Embed.setColor(hex)},onSelect:function(color){var hex=color.hex.toLowerCase();Embed.customizations.colorInput.set("value",hex);Embed.setColor(hex);Embed.refreshEmbedCode()}})}},onMessageUpdate:function(e){$("message").set("text",this.value)}};var Embed={customizations:{},warnings:{},originalValues:{},codeRequest:null,initialize:function(){if(!$("share_embed")){return false}Embed.clipId=$("embed_clip_id").get("value");Embed.textArea=$("embed_code");Embed.customizeView=$("embed_customize");Embed.customizeToggle=$("embed_customize_toggle");Embed.codeToggles=$("embed_generator").getElements("a.embed_code_toggle");Embed.previewPlayer=$("embed_preview").getElement(['*[id*="player',Embed.clipId,'"]'].join(""));Embed.customizations={widthInput:$("embed_width"),heightInput:$("embed_height"),titleCheckbox:$("embed_title"),bylineCheckbox:$("embed_byline"),portraitCheckbox:$("embed_portrait"),badgeCheckbox:$("embed_badge"),autoplayCheckbox:$("embed_autoplay"),loopCheckbox:$("embed_loop"),linkCheckbox:$("embed_link"),descriptionCheckbox:$("embed_description"),staticColors:$("embed_customize").getElements(".color_block"),colorInput:$("embed_color")};Embed.warnings={size:$("size_alert"),autoplay:$("autoplay_alert"),loop:$("loop_alert"),caption:$("text_alert"),link:$("link_alert"),description:$("description_alert"),link_description:$("link_description_alert")};Embed.originalValues={width:$("embed_orig_width").get("value"),height:$("embed_orig_height").get("value")};Embed.codeRequest=new Request({url:"/embed",method:"get",link:"cancel",onSuccess:Embed.onEmbedCodeSuccess});$("embed_customize").getElements(".toggle_box").each(function(element){var t=new ToggleBox(element);t.addEvent("onToggle",function(){Share.equalize()})});Share.onColorPickerLoaded();Embed.attachEvents();Embed.refreshEmbedCode();try{Singletonbox.centerWindow()}catch(x){}},attachEvents:function(){Object.each(Embed.customizations,function(value,key){if($(value)){$(value).addEvent("change",Embed.onOptionChange)}});[Embed.customizations.widthInput,Embed.customizations.heightInput].each(function(item){item.addEvent("keydown",Embed.onDimensionKeyDown);item.addEvent("blur",Embed.onDimensionBlur)});Embed.customizations.staticColors.addEvent("click",Embed.onStaticColorSelected);Embed.customizations.colorInput.addEvent("keydown",Embed.onColorKeyDown);Embed.textArea.addEvent("click",Embed.onTextAreaClick);$("old_code").addEvent("click",function(){Embed.refreshEmbedCode(true)})},resetSize:function(){Embed.customizations.widthInput.set("value",Embed.originalValues.width);Embed.customizations.heightInput.set("value",Embed.originalValues.height)},calculateSize:function(dimension){var oppositeDimension,ratio,adjustedSize;switch(dimension){case"x":case"width":oppositeDimension=Embed.customizations.heightInput.get("value");ratio=Embed.originalValues.width/Embed.originalValues.height;break;case"y":case"height":oppositeDimension=Embed.customizations.widthInput.get("value");ratio=Embed.originalValues.height/Embed.originalValues.width;break;default:throw new Error("Invalid direction")}adjustedSize=Math.round(oppositeDimension*ratio);return adjustedSize},resetWarnings:function(){Object.each(Embed.warnings,function(item){$(item).hide()})},checkWarnings:function(){var options=Embed.customizations,warnings=Embed.warnings;Embed.resetWarnings();if(options.autoplayCheckbox.get("checked")){warnings.autoplay.show()}if(options.loopCheckbox.get("checked")){warnings.loop.show()}if(options.linkCheckbox.get("checked")||options.descriptionCheckbox.get("checked")){warnings.caption.show();if(options.descriptionCheckbox.get("checked")&&options.linkCheckbox.get("checked")){warnings.link_description.show("inline")}else if(options.descriptionCheckbox.get("checked")){warnings.description.show("inline")}else if(options.linkCheckbox.get("checked")){warnings.link.show("inline")}}Share.equalize()},refreshEmbedCode:function(old_version){var options=Embed.customizations;Embed.checkWarnings();Embed.savePreferences();Embed.codeRequest.send({data:{clip_id:Embed.clipId,width:options.widthInput.get("value"),height:options.heightInput.get("value"),title:options.titleCheckbox.get("checked")?1:0,byline:options.bylineCheckbox.get("checked")?1:0,portrait:options.portraitCheckbox.get("checked")?1:0,badge:options.badgeCheckbox&&options.badgeCheckbox.get("checked")?1:0,autoplay:options.autoplayCheckbox.get("checked")?1:0,loop:options.loopCheckbox.get("checked")?1:0,color:options.colorInput.get("value"),link:options.linkCheckbox.get("checked")?1:0,caption:options.descriptionCheckbox.get("checked")?1:0,iframe:old_version===true?false:true}});if(old_version===true){$("code_notice").setStyle("visibility","hidden")}else{$("code_notice").setStyle("visibility","visible")}},savePreferences:function(){var options=Embed.customizations,prefs=JSON.encode({width:options.widthInput.get("value").toInt(),title:options.titleCheckbox.get("checked")?1:0,byline:options.bylineCheckbox.get("checked")?1:0,badge:options.badgeCheckbox&&options.badgeCheckbox.get("checked")?1:0,portrait:options.portraitCheckbox.get("checked")?1:0,autoplay:options.autoplayCheckbox.get("checked")?1:0,loop:options.loopCheckbox.get("checked")?1:0,color:options.colorInput.get("value"),link:options.linkCheckbox.get("checked")?1:0,caption:options.descriptionCheckbox.get("checked")?1:0});Cookie.write("embed_preferences",prefs,{domain:vimeo.domain,path:"/",duration:365})},refreshPreview:function(option){var options=Embed.customizations,value=option.get("checked");switch(option){case options.titleCheckbox:Embed.toggleElement("title",value);break;case options.bylineCheckbox:Embed.toggleElement("byline",value);break;case options.portraitCheckbox:Embed.toggleElement("portrait",value);break;case options.badgeCheckbox:Embed.toggleElement("badge",value);break;default:throw new Error("Invalid option supplied.")}},onTextAreaClick:function(e){if(!this.get("data-ios")){e.stop();this.focus();this.select()}},onDimensionKeyDown:function(e){var el=this,code=e.code,key=e.key,numberKey=code>47&&code<58||code>95&&code<106,modifierKey=key==="delete"||key==="backspace"||key==="tab"||key==="left"||key==="right"||key==="up"||key==="down",validKey=numberKey&&!e.shift||modifierKey,widthInput=Embed.customizations.widthInput,heightInput=Embed.customizations.heightInput;if(validKey){setTimeout(function(){if(el===widthInput){heightInput.set("value",Embed.calculateSize("height"))}else{widthInput.set("value",Embed.calculateSize("width"))}},50)}else{e.preventDefault();return}},onDimensionBlur:function(e){if(Embed.customizations.widthInput.get("value")===""||Embed.customizations.heightInput.get("value")===""){Embed.resetSize()}},onOptionChange:function(e){var options=Embed.customizations;if(this===options.titleCheckbox||this===options.bylineCheckbox||this===options.portraitCheckbox||this===options.badgeCheckbox){Embed.refreshPreview(this)}Embed.refreshEmbedCode()},onStaticColorSelected:function(e){var hex=["#",this.get("data-hex")].join("");e.stop();Embed.customizations.colorInput.set("value",hex);Embed.onOptionChange(null);Embed.colorPicker.setColor(hex)},onColorKeyDown:function(e){var key=e.key,shiftKey=e.shift,modifierKey=key==="delete"||key==="backspace"||key==="tab"||key==="left"||key==="right"||key==="up"||key==="down",validHex=!shiftKey&&/[a-fA-F0-9]/.test(key),poundKey=shiftKey&&key==="3",validKey=validHex||poundKey||modifierKey;if(!validKey){e.preventDefault()}},onEmbedCodeSuccess:function(text,xml){Embed.textArea.set("value",text.clean());Share.equalize()},onPlayerLoaded:function(){},toggleElement:function(element,value){Embed.previewPlayer=Embed.previewPlayer||$("embed_preview").getElement(['*[id*="player',Embed.clipId,'"]'].join(""));Embed.previewPlayer.api_toggleElement(element,value)},setColor:function(color){Embed.previewPlayer=Embed.previewPlayer||$("embed_preview").getElement(['*[id*="player',Embed.clipId,'"]'].join(""));if(color.substr(0,1)==="#"){color=color.substr(1)}try{Embed.previewPlayer.api_changeColor(color)}catch(x){}}};var Hashtag={patterns:[],get:function(pattern){var tag;if(pattern){tag=new URI(location.toString()).get("fragment").toString().match(pattern)}else{tag=new URI(location.toString()).get("fragment").toString()}return tag!==null?tag.toString():null},set:function(hash){location.hash=hash},register:function(pattern,selector){Hashtag.patterns.push({pattern:pattern,selector:selector})},find:function(){var match,el;for(var i=0,a=Hashtag.patterns,l=a.length,obj=a[i];i<l;i++){if(match=Hashtag.get(obj.pattern)){if(obj.selector&&(el=$$(obj.selector.substitute({s:match})))){Signal.hashtag.found.dispatch(el[0])}else if(el=$(match)){Signal.hashtag.found.dispatch(el)}else{Signal.hashtag.not_found.dispatch()}break}}return match}};var Signal=function(signals){function getSignal(){return new signals.Signal}var registered_signals={about:{advertisers:{spy_entered:getSignal(),spy_left:getSignal()}},animation:{tipped:getSignal()},browsable:{change:getSignal()},browse:{ajax:{request:getSignal(),success:getSignal(),error:getSignal()},cache:{success:getSignal()},tabs:{click:getSignal()},attachEvents:getSignal(),infiniteLoad:getSignal()},channel:{jump_to_clip:getSignal(),play_clip:getSignal(),load_comments:getSignal()},dom:{updated:getSignal()},clip:{settings:{caption_upload_completed:getSignal(),caption_upload_failed:getSignal(),thumbnail_changed:getSignal()}},collection_membership:{changed:getSignal(),collection_added:getSignal()},comments:{request:{success:getSignal()},created:getSignal(),replied:getSignal(),appended:getSignal(),edited:getSignal(),deleted:getSignal(),spammed:getSignal(),action_failed:getSignal(),reset:getSignal(),paged:getSignal(),page_appended:getSignal(),loaded:getSignal(),found:getSignal(),not_found:getSignal(),form_submitted:getSignal(),tool:{opened:getSignal(),closed:getSignal()}},forager:{user:{selected:getSignal(),update_favorites:getSignal(),add_email:getSignal()},filter:{selected:getSignal(),favorites:getSignal(),all:getSignal()},input:{clear:getSignal()},reset:getSignal()},forum:{tool:{opened:getSignal()}},hashtag:{found:getSignal(),
not_found:getSignal()},lightbox:{opened:getSignal(),activated:getSignal(),center:getSignal(),closed:getSignal()},messages:{message_sent:getSignal(),inbox:{conversation:{selection_changed:getSignal(),read_state_changed:getSignal(),deleted:getSignal()},conversation_manager:{read_state_changed:getSignal(),deleted:getSignal()}},force_refresh:{}},modworld:{switch_user:getSignal()},player:{ready:getSignal(),play:getSignal(),pause:getSignal(),finish:getSignal(),playProgress:getSignal(),like:getSignal(),unlike:getSignal()},request:{send:getSignal()},scroll_spy_manager:{spy_entered:getSignal(),spy_left:getSignal(),spy_tick:getSignal()},share:{lightbox:{opened:getSignal()},embed_settings:{changed:getSignal(),opened:getSignal(),closed:getSignal(),color:getSignal()}},settings:{new_field:getSignal(),embed_settings:{saved:getSignal(),custom_logo_selected:getSignal()},form_dirtied:getSignal()},uploader:{file_selected:getSignal(),dropbox:getSignal(),started:getSignal(),stopped:getSignal(),completed:getSignal(),canceled:getSignal(),error:getSignal(),progress:getSignal(),reset:getSignal(),paused:getSignal(),resumed:getSignal()},user:{followed:getSignal(),unfollowed:getSignal(),suggestions_returned:getSignal(),settings:{portrait_selected:getSignal(),portrait_deleted:getSignal(),camera_deleted:getSignal(),link_deleted:getSignal(),app_connected:getSignal()}},recruiter:{clip_selected:getSignal(),unselected:getSignal()},tip:{close:getSignal()}};return registered_signals}(signals);namespace("vimeo");(function(window){"use strict";var DynamicPlayerFavicon=function(){var self=this;self.link=document.querySelector('link[rel="shortcut icon"]');if(!self.link){return}self.head=self.link.parentNode;self.play_url=self.link.getAttribute("data-play");self.pause_url=self.link.getAttribute("data-pause");self.original_icon_url=self.link.href;if(typeof Signal!=="undefined"){Signal.player.play.add(function(){self.updateFavicon(self.play_url)});Signal.player.pause.add(function(){self.updateFavicon(self.pause_url)});Signal.player.finish.add(function(){self.updateFavicon(self.original_icon_url)})}};DynamicPlayerFavicon.prototype.updateFavicon=function(url){var self=this;self.head.removeChild(self.link);self.link=document.createElement("link"),self.link.type="image/x-icon";self.link.rel="shortcut icon";self.link.href=url;self.head.appendChild(self.link)};window.vimeo.DynamicPlayerFavicon=DynamicPlayerFavicon})(window);window._gtm=window._gtm||[];var Global={loaded_objects:[],resize_callbacks:[],initialize:function(){Global.lightbox=new Lightbox("[data-lightbox]",{onLoad:Global.onLightboxLoad});Global.keyManager=new KeyManager;Global.keyManager.register("/",function(){$$(".js-topnav_menu_search_input")[0].focus()});Global.testForConsole();Global.xsrfProtect();Global.protectSubmits();Global.setupFormPlaceholders();Global.attachSmoothScroll();Global.teleportElements();Global.initLocale();Global.initGlobalNotifications();Global.bindPrefTips();Global.resize_callbacks.push(Global.onResizeAutoWidth);$(window).addEvent("resize",Global.onWindowResize);Global.onWindowResize();Signal.browse.ajax.success.add(Global.bindPrefTips);Signal.browse.cache.success.add(Global.bindPrefTips);if("pushState"in window.history&&window.History&&History.addEvent){History.addEvent("change",Global.onHistoryChange)}Global.scroll=Global.scroll||new Fx.Scroll(window,{duration:500,transition:Fx.Transitions.Expo.easeOut});Global.initToggleBoxes();Global.initFatalAttraction();window.embedWindowPopup=window.shareWindowPopup=function(clip_id,params){var url="/"+clip_id+"?action=share",is_clip_page=typeof vimeo.config.clip!=="undefined",is_group=typeof vimeo.config.group!=="undefined",is_album=typeof vimeo.config.album!=="undefined",is_channel=typeof vimeo.config.channel!=="undefined",querystring;if(is_channel){url+="&context=channel&context_id="+vimeo.config.channel.id}else if(is_group){url+="&context=group&context_id="+vimeo.config.group.id}else if(is_album){url+="&context=album&context_id="+vimeo.config.album.id}if(params&&typeof params==="object"){querystring=Object.toQueryString(params);url+="&"+querystring}Global.lightbox=Singletonbox.open({url:url,uid:"_share",position:"absolute",width:540,top:is_clip_page?111:"auto",onClose:function(){this.closeAndDestroy()}});return true};window.editWindowPopup=function(type,data,clip_id){Singletonbox.open({url:"/tools/edit?type="+type+"&data="+data+"&clip_id="+clip_id,width:960,position:"absolute",top:50});return true}},initToggleBoxes:function(){$$(".toggle_box").each(function(element){new ToggleBox(element)})},initLocale:function(){if(typeof fullLocale!=="undefined"&&typeof localeConfig!=="undefined"){Locale.inherit(fullLocale,"en-US");for(var i in localeConfig){if(localeConfig.hasOwnProperty(i)){Locale.define(fullLocale,i,localeConfig[i])}}Locale.use(fullLocale)}},testForConsole:function(){if(typeof window.console==="undefined"){window.console={log:function(){},info:function(){},warn:function(){},error:function(){},debug:function(){},clear:function(){}}}},protectSubmits:function(){var btn,formSubmitButton,submit_btn_selector='input[type="submit"],button[type="submit"]';$$("form").each(function(form){form.getElements(submit_btn_selector).addEvent("click",function(){formSubmitButton=this});if(form.get("data-ds-protection")){return false}else{form.set("data-ds-protection","enabled");form.addEvent("submit",function(e){if(!formSubmitButton||formSubmitButton.get("data-disable-protect")){return false}if(form.retrieve("validator")&&!form.retrieve("validator").validate(null,true)){return false}if(form.hasClass("disabled")){return false}formSubmitButton.addClass("btn_gray").set("data-reset-copy",formSubmitButton.get("value")).set("value",formSubmitButton.get("data-submit-text")||formSubmitButton.get("value"));setTimeout(function(){formSubmitButton.set("disabled",true)},100)});form.addEvent("reset",function(e){var btns=this.getElements(submit_btn_selector),reset_copy;btns.each(function(el){if(reset_copy=el.get("data-reset-copy")){el.set("value",reset_copy).removeClass("btn_gray").removeProperties("disabled","data-reset-copy")}})})}})},setupFormPlaceholders:function(){var placeholder_support="placeholder"in document.createElement("input");if(!placeholder_support){$$("[placeholder]").each(function(input){new OverText(input,{textOverride:input.get("placeholder")})})}},teleportElements:function(){var destination;$$("[data-teleport]").each(function(el){destination=$(el.get("data-teleport"));if(destination){el.replaces(destination).erase("data-teleport")}})},bindPrefTips:function(){var tips,tip,request,action;if(vimeo.cur_user===null){return}tips=$$("[data-tip-id]");if(tips.length===0){return}request=new Request({url:vimeo.cur_user.url,method:"post"});tips.each(function(el){el.addEvent("click",function(e){e.preventDefault();request.send({data:{action:"set_tip",token:vimeo.xsrft,data_tip_id:el.get("data-tip-id")}});tip=el.getParent("[data-tip-action]");if(tip){action=tip.get("data-tip-action");if(action==="destroy"){tip.destroy()}else if(action==="hide"){tip.hide()}}Signal.tip.close.dispatch({tipEl:tip})})})},onResizeAutoWidth:function(target){if(window.getSize().x<960){if(!$(document.body).hasClass("min_width")){$(document.body).addClass("min_width")}}else{$(document.body).removeClass("min_width")}},onWindowResize:function(target){Global.resize_callbacks.each(function(func){func(window)})},onHistoryChange:function(url,state){Global.refreshAds();window._gtm.push({event:"pageview",page_path:url})},onLightboxLoad:function(e){var el=this.content,input=el.getElement('form input:not([type="hidden"]):not([type="submit"]):not([type="button"]):not([data-noautofocus])');if(input){setTimeout(function(){input.focus()},500)}},xsrfProtect:function(){var xsrfElement;$$("form[method=post]").each(function(form){if(form.getElement("input[name=token]")!==null){return}xsrfElement=new Element("input",{type:"hidden",name:"token",value:vimeo.xsrft}).inject(form,"bottom");if(form.retrieve("form.request")!==null){return}})},attachSmoothScroll:function(){$(document.body).addEvent("click:relay(a.smooth)",function(e){e.stop();Global.smoothScroll(this.get("href"),null,{set_hash:true})})},smoothScroll:function(href,buffer,scroll_options){var hash,element,tmp,options=Object.merge({set_hash:false,full_href:false,callback:null},scroll_options);if(typeof href==="string"){hash=href.contains("#")?href.split("#")[1]:href;element=$(hash)}else{element=$(href);hash=element.get("id")}tmp=Global.scroll.toElement(element,buffer?-20:0);if(hash&&window.Hashtag&&options.set_hash===true){tmp.chain(function(){Hashtag.set(typeof href==="string"&&options.full_href?href:hash)})}if(typeof options.callback==="function"){tmp.chain(options.callback)}return tmp},getVersion:function(){if(typeof JSON==="undefined"||typeof JSON.encode!=="function"){return}var exclude=["Document","Element","Window","Event"],data=Object.clone(Browser);exclude.each(function(item,index){if(data[item]!==null){delete data[item]}});if(!!navigator.userAgent.match(/Trident\/7\.0/)){data.name="ie";data.version="11"}return JSON.encode(data)},insertAsset:function(type,src,id,props){var asset;props=props||{};if(type!=="css"&&type!=="javascript"){throw new Error('Invalid asset type supplied to Global.insertAsset(). Value can only be one of "css" or "javascript"')}switch(type){case"javascript":var file=new URI(src).parsed.file;if(Global.loaded_objects.indexOf(file)===-1){asset=Asset.javascript(src,props);asset.addEvent("load",function(){Global.loaded_objects.push(file)})}else{Global.executeFunctionsInList(props,"onload")}break;case"css":Asset.css(src,Object.merge({},{id:id},props));break}},loadScripts:function(scripts,callback){var file=scripts[scripts.length-1];Global.insertAsset("javascript",file+".js?"+BUILD_HASH,file+"_js",{onLoad:function(){scripts.pop();if(scripts.length>0){Global.loadScripts(scripts,callback)}else{callback()}}})},waitFor:function(names,callback){var i,l,found=0;for(i=0,l=names.length;i<l;i++){if(window[names[i]]){found++}}if(found===names.length){callback()}else{setTimeout(Global.waitFor,100,names,callback)}},executeFunctionsInList:function(list,withName){for(var f in list){if(typeof list[f]==="function"){if(!withName||withName.toLowerCase()===f.toLowerCase()){list[f]()}}}},player_onsite_ratings_bypass:function(clip_id,bypass_val){var request=new Request.JSON({url:"/"+clip_id+"/onsite_player_bypass/"+bypass_val,data:{token:vimeo.xsrft,action:"bypass_onsite_player"},method:"post",onSuccess:function(responseJSON){if(responseJSON.success===true){var dialogue=$$('[data-filtered-dialogue-id="'+clip_id+'"]')[0],width=dialogue.getStyle("width"),wrapper=dialogue.getParent();request=new Request.HTML({url:"/"+clip_id+"/lightbox",data:{api:1,width:width,autoplay:0,on_ready:"FauxPlayer.init"},method:"GET",update:wrapper}).send()}}});request.send()},refreshAds:function(){if(typeof googletag!=="undefined"&&typeof googletag.pubads==="function"){setTimeout(function(){googletag.pubads().refresh()},1)}},initFatalAttraction:function(){new FatalAttraction},initGlobalNotifications:function(){new vimeo.GlobalNotifications}};window.addEvent("domready",function(){Global.initialize()});(function(){"use strict";var RecentPlayLogger=new Class({initialize:function(){var self=this;self.attachEvents()},attachEvents:function(){var self=this;Signal.player.play.add(self.onPlay.bind(self))},onPlay:function(player){var self=this,clip_id=player.videoId,clips=[];if(Cookie.read("clips")){clips=Cookie.read("clips").split(",")}if(clips.unshift(clip_id.toString())>10){clips.pop()}clips=clips.unique();Cookie.write("clips",clips.join(","),{duration:1209600,domain:vimeo.domain,path:"/"})}});window.RecentPlayLogger=RecentPlayLogger})();(function(){"use strict";var GlobalController=new Class({ACCOUNT_TYPE_BASIC:"basic",ACCOUNT_TYPE_PLUS:"plus",ACCOUNT_TYPE_PRO:"pro",play_logger:null,initialize:function(){var self=this;self.createElements();self.attachEvents();self.setupFavicon()},createElements:function(){var self=this,casl_tracker;if(typeof CASLTracker!=="undefined"){casl_tracker=new CASLTracker}self.play_logger=new RecentPlayLogger},attachEvents:function(){var self=this;Signal.dom.updated.add(self.onDOMUpdated.bind(self))},getUserAccountType:function(){var self=this;if(typeof vimeo!=="undefined"&&vimeo.cur_user&&vimeo.cur_user.account_type){return vimeo.cur_user.account_type}return self.ACCOUNT_TYPE_BASIC},setupFavicon:function(){new vimeo.DynamicPlayerFavicon},onDOMUpdated:function(){var self=this;self.refresh()},refresh:function(){var self=this}});if(!window.mocha){window.addEvent("domready",function(){window.GlobalController=new GlobalController})}else{window.GlobalController=GlobalController}})();(function(){"use strict";function wrapHistoryMethod(type){var original_method=history[type];return function(){var custom_event,event_type=type.toLowerCase(),data=arguments[0],title=arguments[1],url=arguments[2];try{custom_event=new Event(event_type);custom_event.data=data;custom_event.title=title;custom_event.url=url;window.dispatchEvent(custom_event)}catch(x){try{if(document.createEventObject){custom_event=document.createEventObject();window.fireEvent("on"+event_type,custom_event)}else{custom_event=document.createEvent("HTMLEvents");custom_event.initEvent(event_type,true,true);window.dispatchEvent(custom_event)}}catch(x){if(typeof jQuery==="function"){$(window).trigger({type:event_type,data:data,title:title,url:url})}}}return original_method.apply(this,arguments)}}history.pushState=wrapHistoryMethod("pushState");history.replaceState=wrapHistoryMethod("replaceState")})();(function(window,navigator){"use strict";var FatalAttraction=new Class({initialize:function(options){var self=this;self.handleExistingFatalAttractionCookie();self.handleGlobalObject(window.__fa);self.attachEvents()},attachEvents:function(){var self=this;$$(document).addEvent("mousedown:relay([data-fatal-attraction])",self.onLinkClick.bind(self));History.addEvent("change",self.handleExistingFatalAttractionCookie.bind(self))},onLinkClick:function(e){var self=this,fa_element=self._getFatalAttractionElement(e.target);if(fa_element){self.trackClickAttraction(fa_element.getAttribute("data-fatal-attraction"),fa_element.get("href"))}},trackClickAttraction:function(custom_data,href){var self=this,current_path=window.location.pathname+window.location.search,custom_data_object={type:"click",ref_path:current_path};if(typeof href==="string"){custom_data_object.target=href}custom_data_object=Object.merge(custom_data_object,self._createObjectFromDelimitedString(custom_data));if(typeof navigator.sendBeacon==="function"){self._log(custom_data_object);return}custom_data+="|ref_path:"+current_path;if(typeof href==="string"){custom_data+="|target:"+href}Cookie.write("fatal_attraction",custom_data,{duration:.002,domain:vimeo.domain,path:"/"})},handleExistingFatalAttractionCookie:function(){var self=this,custom_data=Cookie.read("fatal_attraction"),custom_data_object={type:"click"};if(!custom_data){return}Cookie.write("fatal_attraction","",{duration:-1,domain:vimeo.domain,path:"/"});custom_data_object=Object.merge(custom_data_object,self._createObjectFromDelimitedString(custom_data));self._log(custom_data_object)},trackPageview:function(){var self=this,qs=window.location.search.substr(1).parseQueryString(),log={type:"pageview",target:window.location.pathname+window.location.search};if(!qs.vcid&&window.location.pathname.indexOf("/search")!==0&&window.location.pathname.indexOf("/ondemand")!==-1&&window.location.pathname.indexOf("/store")!==-1){return}if(qs.vcid){log.vcid=qs.vcid}self._log(log)},trackEvent:function(event_data){var self=this,data=Object.merge({type:"event"},event_data);self._log(data)},handleGlobalObject:function(arr){var self=this,push_method=function(fa_call){var self=this,method=fa_call[0];if(typeof self[method]==="function"){self[method].apply(self,fa_call.splice(1,fa_call.length))}};if(arr.constructor!==Array){throw new Error("window.__fa object must be an array.")}arr.forEach(push_method.bind(self));arr.push=function(){if(arguments.length){push_method.apply(self,arguments)}}},_getFatalAttractionElement:function(el){var self=this,fa_attribute=el.getAttribute("data-fatal-attraction"),parent_el=el.getParent();if(fa_attribute){return el}if(parent_el){return self._getFatalAttractionElement(parent_el)}},_createObjectFromDelimitedString:function(string,primary,secondary){var obj={};primary=typeof primary!=="undefined"?primary:"|";secondary=typeof secondary!=="undefined"?secondary:":";string.split(primary).each(function(str){var split=str.split(secondary);if(split.length>1){obj[split[0]]=split[1]}});return obj},_log:function(args){var parts=[],url="/ablincoln/fatal_attraction?";if(!args){throw new Error("Invalid args to log")}Object.each(args,function(value,key){parts.push(encodeURIComponent(key)+"="+encodeURIComponent(value))});url+=parts.join("&");if(typeof navigator.sendBeacon==="function"){navigator.sendBeacon(url);return}var img=new Image;img.src=url}});window.FatalAttraction=FatalAttraction})(window,navigator);namespace("vimeo");(function(window){"use strict";vimeo.GlobalNotifications=function(){var self=this;self.bound={hideNotification:self.hideNotification.bind(self)};self.showNotifications()};vimeo.GlobalNotifications.prototype.showNotifications=function(){if(typeof window.global_notifications==="undefined"){return}var self=this,wrap=document.getElementById("wrap"),topnav_wrap=document.getElementById("topnav_outer_wrap"),notifications=window.global_notifications,global_notifications;if(!wrap){return false}if(notifications.length===0){return false}global_notifications=document.createElement("ul");global_notifications.id="global_notifications";var parent=topnav_wrap||wrap;parent.insertBefore(global_notifications,parent.firstChild);for(var key in notifications){if(notifications.hasOwnProperty(key)){var element=notifications[key],notification=document.createElement("li"),links,link;notification.id="notification_"+key;notification.className="global_notifications";notification.innerHTML="<p>"+element.message+"</p>";links=[].slice.apply(notification.querySelectorAll("a"));global_notifications.appendChild(notification);if(links.length){self._setAsClicked(links,element.title||key)}link=document.createElement("a");link.className="js-dismiss_notification global_undertaker";link.innerHTML="&times;";link.setAttribute("data-fatal-attraction","container:global_notification|component:closed|keyword:"+(element.title||key));link.setAttribute("data-gtm-click","global_notification_close_clicked|title:"+(element.title||key));link.addEventListener("click",self.bound.hideNotification,false);notification.appendChild(link,notification.firstChild)}}self._notifyHeightChange()};vimeo.GlobalNotifications.prototype.hideNotification=function(e){var self=this,link=e.target,notifications=document.getElementById("global_notifications"),notification=link.parentNode,current_date=new Date;self._fadeOut(notification,function(){var key=notification.id.replace("notification_",""),cookie_value=Math.round((new Date).getTime()/1e3),cookie_options={domain:vimeo.domain,path:"/"};if($&&$.cookie){cookie_options.expires=window.global_notifications[key].ttl;$.cookie(notification.id,cookie_value,cookie_options)}else if(typeof Cookie!=="undefined"){cookie_options.duration=window.global_notifications[key].ttl;Cookie.write(notification.id,cookie_value,cookie_options)}notification.parentNode.removeChild(notification);if(notifications.querySelectorAll("li").length===0){notifications.style.display="none"}self._notifyHeightChange()});link.removeEventListener("click",self.bound.hideNotification)};vimeo.GlobalNotifications.prototype._notifyHeightChange=function(){var self=this,event;if(typeof Event==="function"){event=new Event("notification_close")}else{event=document.createEvent("Event");event.initEvent("notification_close",true,true)}window.dispatchEvent(event);if(window.AppDispatcher){window.AppDispatcher.dispatch({action_type:"PAGE_HEIGHT_CHANGE"})}else{self.notify_retries=self.notify_retries+1||0;if(self.notify_retries<5){setTimeout(self._notifyHeightChange,1e3)}}};vimeo.GlobalNotifications.prototype._setAsClicked=function(links,title){links.forEach(function(link){if(!link.hasAttribute("data-fatal-attraction")){link.setAttribute("data-fatal-attraction","container:global_notification|component:clicked|keyword:"+title)}if(!link.hasAttribute("data-gtm-click")){link.setAttribute("data-gtm-click","global_notification_clicked|title:"+title)}})};vimeo.GlobalNotifications.prototype._fadeOut=function(el,callback){var last,tick;el.style.opacity=1;el.style.display="block";last=+new Date;tick=function(){el.style.opacity=+el.style.opacity-(new Date-last)/200;last=+new Date;if(+el.style.opacity>0){return window.requestAnimationFrame&&window.requestAnimationFrame(tick)||setTimeout(tick,16)}el.style.opacity=0;el.style.display="none";if(typeof callback==="function"){callback()}};tick()}})(window);(function(){"use strict";var ATTRIBUTION_WINDOW=14,ATTRIBUTION_SOURCES={"-cj-":"cj"};function getQueryVariable(variable){var query=window.location.search.substring(1),vars=query.split("&"),total_vars=vars.length,pair,i;for(i=0;i<total_vars;i++){pair=vars[i].split("=");if(decodeURIComponent(pair[0])===variable){return decodeURIComponent(pair[1])}}return null}var source_param=getQueryVariable("utm_medium"),attribution_source=null;if(source_param!==null){source_param=source_param.toLowerCase();for(var key in ATTRIBUTION_SOURCES){if(ATTRIBUTION_SOURCES.hasOwnProperty(key)&&source_param.indexOf(key)!==-1){attribution_source=ATTRIBUTION_SOURCES[key];break}}}if(attribution_source!==null){var date=new Date,expiration,cookie_string;date.setTime(date.getTime()+ATTRIBUTION_WINDOW*24*60*60*1e3);expiration=date.toGMTString();cookie_string="attr_src="+attribution_source+"; path=/; expires="+expiration;if(typeof vimeo!=="undefined"&&"domain"in vimeo){cookie_string+="; domain="+vimeo.domain}document.cookie=cookie_string}})();(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)})([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _objectAssign=__webpack_require__(1);var _objectAssign2=_interopRequireDefault(_objectAssign);var _StorageUtils=__webpack_require__(2);var _StorageUtils2=_interopRequireDefault(_StorageUtils);var _LoginHandlers=__webpack_require__(3);var _LoginHandlers2=_interopRequireDefault(_LoginHandlers);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var app_state=null;var loginHandler=_LoginHandlers2.default.DEFAULT;var Session=function(){function Session(){_classCallCheck(this,Session)}_createClass(Session,null,[{key:"initialize",value:function initialize(){var flash_item=void 0;if(_StorageUtils2.default.isLocalStorageSupported()){flash_item=window.localStorage.getItem("flashStorage");window.localStorage.removeItem("flashStorage")}if(!flash_item){return}flash_item=JSON.parse(flash_item);if(flash_item.state){app_state=flash_item.state}var handler=Session.context_handlers[flash_item.context]||null;if(handler&&typeof handler==="function"){handler.call.apply(handler,[null].concat(_toConsumableArray(flash_item.args)))}}},{key:"create",value:function create(){var size=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"reg";var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var force_login=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if((typeof size==="undefined"?"undefined":_typeof(size))==="object"){params=size;size="reg"}if(typeof size!=="string"){size="reg"}var param_arr=[];if(params&&(typeof params==="undefined"?"undefined":_typeof(params))==="object"){for(var key in params){param_arr.push(key+"="+params[key])}}var extra_parms="";if(param_arr.length){extra_parms="&"+param_arr.join("&")}var has_logged_in=decodeURIComponent((("; "+document.cookie).split("; has_logged_in=")[1]||"").split(";")[0]);if(has_logged_in===""&&!force_login){vimeo.Modal.create({size:size,content:"/join?modal=new"+extra_parms}).then(function(response){if(!response){return}loginHandler(response);Session.initialize()});return}vimeo.Modal.create({size:size,content:"/log_in?modal=new"+extra_parms}).then(function(response){if(!response){return}loginHandler(response);Session.initialize()})}},{key:"setLoginHandler",value:function setLoginHandler(handler){if(typeof handler==="function"){loginHandler=handler}}},{key:"registerContextHandlers",value:function registerContextHandlers(handlers){Session.context_handlers=(0,_objectAssign2.default)(Session.context_handlers,handlers)}},{key:"getInitialState",value:function getInitialState(){return app_state}},{key:"requireAuth",value:function requireAuth(func,action_context,app_state){return function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(vimeo.cur_user){return Promise.resolve(func.call.apply(func,[null].concat(args)))}var session_store={args:args?[].concat(args):[],context:action_context,state:typeof app_state==="function"?app_state.call():app_state};window.localStorage.setItem("flashStorage",JSON.stringify(session_store));return new Promise(function(resolve,reject){Session.create();resolve(true)})}}}]);return Session}();Session.context_handlers={};Session.initialize();if(window.vimeo){window.vimeo.Session=Session}exports.default=Session;module.exports=exports["default"]},function(module,exports){"use strict";function ToObject(val){if(val==null){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}module.exports=Object.assign||function(target,source){var from;var keys;var to=ToObject(target);for(var s=1;s<arguments.length;s++){from=arguments[s];keys=Object.keys(Object(from));for(var i=0;i<keys.length;i++){to[keys[i]]=from[keys[i]]}}return to}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var StorageUtils=function(){function StorageUtils(){_classCallCheck(this,StorageUtils)}_createClass(StorageUtils,null,[{key:"isLocalStorageSupported",value:function isLocalStorageSupported(){if((typeof localStorage==="undefined"?"undefined":_typeof(localStorage))==="object"){try{localStorage.setItem("localStorage",1);localStorage.removeItem("localStorage");return true}catch(e){var msg='Your web browser does not support storing settings locally.\n                In Safari, the most common cause of this is using "Private Browsing Mode".\n                Some settings may not save or some features may not work properly for you';return false}}}},{key:"isSessionStorageSupported",value:function isSessionStorageSupported(){if((typeof sessionStorage==="undefined"?"undefined":_typeof(sessionStorage))==="object"){try{sessionStorage.setItem("session",1);sessionStorage.removeItem("session");return true}catch(e){var msg='Your web browser does not support storing settings locally.\n                In Safari, the most common cause of this is using "Private Browsing Mode".\n                Some settings may not save or some features may not work properly for you';return false}}}}]);return StorageUtils}();exports.default=StorageUtils;module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var LOGIN_HANDLERS={DEFAULT:function DEFAULT(){window.location.reload()},AJAX_EXPLORE:function AJAX_EXPLORE(response){vimeo.cur_user=response.vimeo_cur_user;vimeo.xsrft=response.token;vimeo.Global.XSRFProtector.setToken(vimeo.xsrft);vimeo.config.api=response.vimeo_config_api;vimeo.me=response.vimeo_me;document.querySelector("#topnav_desktop").innerHTML=response.menus.topnav;document.querySelector(".footer_v2").innerHTML=response.menus.footer;if(window.renderActivityTopNav){window.renderActivityTopNav()}vimeo.Global.XSRFProtector.refresh()}};exports.default=LOGIN_HANDLERS;module.exports=exports["default"]}]);(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)})([function(module,exports,__webpack_require__){"use strict";__webpack_require__(1);var _ModalHandler=__webpack_require__(5);var _ModalHandler2=_interopRequireDefault(_ModalHandler);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}vimeo.Modal=new _ModalHandler2.default},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(global,setImmediate){(function UMD(name,context,definition){context[name]=context[name]||definition();if(typeof module!="undefined"&&module.exports){module.exports=context[name]}else if(true){!(__WEBPACK_AMD_DEFINE_RESULT__=function $AMD$(){return context[name]}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}})("Promise",typeof global!="undefined"?global:this,function DEF(){"use strict";var builtInProp,cycle,scheduling_queue,ToString=Object.prototype.toString,timer=typeof setImmediate!="undefined"?function timer(fn){return setImmediate(fn)}:setTimeout;try{Object.defineProperty({},"x",{});builtInProp=function builtInProp(obj,name,val,config){return Object.defineProperty(obj,name,{value:val,writable:true,configurable:config!==false})}}catch(err){builtInProp=function builtInProp(obj,name,val){
obj[name]=val;return obj}}scheduling_queue=function Queue(){var first,last,item;function Item(fn,self){this.fn=fn;this.self=self;this.next=void 0}return{add:function add(fn,self){item=new Item(fn,self);if(last){last.next=item}else{first=item}last=item;item=void 0},drain:function drain(){var f=first;first=last=cycle=void 0;while(f){f.fn.call(f.self);f=f.next}}}}();function schedule(fn,self){scheduling_queue.add(fn,self);if(!cycle){cycle=timer(scheduling_queue.drain)}}function isThenable(o){var _then,o_type=typeof o;if(o!=null&&(o_type=="object"||o_type=="function")){_then=o.then}return typeof _then=="function"?_then:false}function notify(){for(var i=0;i<this.chain.length;i++){notifyIsolated(this,this.state===1?this.chain[i].success:this.chain[i].failure,this.chain[i])}this.chain.length=0}function notifyIsolated(self,cb,chain){var ret,_then;try{if(cb===false){chain.reject(self.msg)}else{if(cb===true){ret=self.msg}else{ret=cb.call(void 0,self.msg)}if(ret===chain.promise){chain.reject(TypeError("Promise-chain cycle"))}else if(_then=isThenable(ret)){_then.call(ret,chain.resolve,chain.reject)}else{chain.resolve(ret)}}}catch(err){chain.reject(err)}}function resolve(msg){var _then,self=this;if(self.triggered){return}self.triggered=true;if(self.def){self=self.def}try{if(_then=isThenable(msg)){schedule(function(){var def_wrapper=new MakeDefWrapper(self);try{_then.call(msg,function $resolve$(){resolve.apply(def_wrapper,arguments)},function $reject$(){reject.apply(def_wrapper,arguments)})}catch(err){reject.call(def_wrapper,err)}})}else{self.msg=msg;self.state=1;if(self.chain.length>0){schedule(notify,self)}}}catch(err){reject.call(new MakeDefWrapper(self),err)}}function reject(msg){var self=this;if(self.triggered){return}self.triggered=true;if(self.def){self=self.def}self.msg=msg;self.state=2;if(self.chain.length>0){schedule(notify,self)}}function iteratePromises(Constructor,arr,resolver,rejecter){for(var idx=0;idx<arr.length;idx++){(function IIFE(idx){Constructor.resolve(arr[idx]).then(function $resolver$(msg){resolver(idx,msg)},rejecter)})(idx)}}function MakeDefWrapper(self){this.def=self;this.triggered=false}function MakeDef(self){this.promise=self;this.state=0;this.triggered=false;this.chain=[];this.msg=void 0}function Promise(executor){if(typeof executor!="function"){throw TypeError("Not a function")}if(this.__NPO__!==0){throw TypeError("Not a promise")}this.__NPO__=1;var def=new MakeDef(this);this["then"]=function then(success,failure){var o={success:typeof success=="function"?success:true,failure:typeof failure=="function"?failure:false};o.promise=new this.constructor(function extractChain(resolve,reject){if(typeof resolve!="function"||typeof reject!="function"){throw TypeError("Not a function")}o.resolve=resolve;o.reject=reject});def.chain.push(o);if(def.state!==0){schedule(notify,def)}return o.promise};this["catch"]=function $catch$(failure){return this.then(void 0,failure)};try{executor.call(void 0,function publicResolve(msg){resolve.call(def,msg)},function publicReject(msg){reject.call(def,msg)})}catch(err){reject.call(def,err)}}var PromisePrototype=builtInProp({},"constructor",Promise,false);Promise.prototype=PromisePrototype;builtInProp(PromisePrototype,"__NPO__",0,false);builtInProp(Promise,"resolve",function Promise$resolve(msg){var Constructor=this;if(msg&&typeof msg=="object"&&msg.__NPO__===1){return msg}return new Constructor(function executor(resolve,reject){if(typeof resolve!="function"||typeof reject!="function"){throw TypeError("Not a function")}resolve(msg)})});builtInProp(Promise,"reject",function Promise$reject(msg){return new this(function executor(resolve,reject){if(typeof resolve!="function"||typeof reject!="function"){throw TypeError("Not a function")}reject(msg)})});builtInProp(Promise,"all",function Promise$all(arr){var Constructor=this;if(ToString.call(arr)!="[object Array]"){return Constructor.reject(TypeError("Not an array"))}if(arr.length===0){return Constructor.resolve([])}return new Constructor(function executor(resolve,reject){if(typeof resolve!="function"||typeof reject!="function"){throw TypeError("Not a function")}var len=arr.length,msgs=Array(len),count=0;iteratePromises(Constructor,arr,function resolver(idx,msg){msgs[idx]=msg;if(++count===len){resolve(msgs)}},reject)})});builtInProp(Promise,"race",function Promise$race(arr){var Constructor=this;if(ToString.call(arr)!="[object Array]"){return Constructor.reject(TypeError("Not an array"))}return new Constructor(function executor(resolve,reject){if(typeof resolve!="function"||typeof reject!="function"){throw TypeError("Not a function")}iteratePromises(Constructor,arr,function resolver(idx,msg){resolve(msg)},reject)})});return Promise})}).call(exports,function(){return this}(),__webpack_require__(2).setImmediate)},function(module,exports,__webpack_require__){var apply=Function.prototype.apply;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){if(timeout){timeout.close()}};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout(function onTimeout(){if(item._onTimeout)item._onTimeout()},msecs)}};__webpack_require__(3);exports.setImmediate=setImmediate;exports.clearImmediate=clearImmediate},function(module,exports,__webpack_require__){(function(global,process){(function(global,undefined){"use strict";if(global.setImmediate){return}var nextHandle=1;var tasksByHandle={};var currentlyRunningATask=false;var doc=global.document;var registerImmediate;function setImmediate(callback){if(typeof callback!=="function"){callback=new Function(""+callback)}var args=new Array(arguments.length-1);for(var i=0;i<args.length;i++){args[i]=arguments[i+1]}var task={callback:callback,args:args};tasksByHandle[nextHandle]=task;registerImmediate(nextHandle);return nextHandle++}function clearImmediate(handle){delete tasksByHandle[handle]}function run(task){var callback=task.callback;var args=task.args;switch(args.length){case 0:callback();break;case 1:callback(args[0]);break;case 2:callback(args[0],args[1]);break;case 3:callback(args[0],args[1],args[2]);break;default:callback.apply(undefined,args);break}}function runIfPresent(handle){if(currentlyRunningATask){setTimeout(runIfPresent,0,handle)}else{var task=tasksByHandle[handle];if(task){currentlyRunningATask=true;try{run(task)}finally{clearImmediate(handle);currentlyRunningATask=false}}}}function installNextTickImplementation(){registerImmediate=function(handle){process.nextTick(function(){runIfPresent(handle)})}}function canUsePostMessage(){if(global.postMessage&&!global.importScripts){var postMessageIsAsynchronous=true;var oldOnMessage=global.onmessage;global.onmessage=function(){postMessageIsAsynchronous=false};global.postMessage("","*");global.onmessage=oldOnMessage;return postMessageIsAsynchronous}}function installPostMessageImplementation(){var messagePrefix="setImmediate$"+Math.random()+"$";var onGlobalMessage=function(event){if(event.source===global&&typeof event.data==="string"&&event.data.indexOf(messagePrefix)===0){runIfPresent(+event.data.slice(messagePrefix.length))}};if(global.addEventListener){global.addEventListener("message",onGlobalMessage,false)}else{global.attachEvent("onmessage",onGlobalMessage)}registerImmediate=function(handle){global.postMessage(messagePrefix+handle,"*")}}function installMessageChannelImplementation(){var channel=new MessageChannel;channel.port1.onmessage=function(event){var handle=event.data;runIfPresent(handle)};registerImmediate=function(handle){channel.port2.postMessage(handle)}}function installReadyStateChangeImplementation(){var html=doc.documentElement;registerImmediate=function(handle){var script=doc.createElement("script");script.onreadystatechange=function(){runIfPresent(handle);script.onreadystatechange=null;html.removeChild(script);script=null};html.appendChild(script)}}function installSetTimeoutImplementation(){registerImmediate=function(handle){setTimeout(runIfPresent,0,handle)}}var attachTo=Object.getPrototypeOf&&Object.getPrototypeOf(global);attachTo=attachTo&&attachTo.setTimeout?attachTo:global;if({}.toString.call(global.process)==="[object process]"){installNextTickImplementation()}else if(canUsePostMessage()){installPostMessageImplementation()}else if(global.MessageChannel){installMessageChannelImplementation()}else if(doc&&"onreadystatechange"in doc.createElement("script")){installReadyStateChangeImplementation()}else{installSetTimeoutImplementation()}attachTo.setImmediate=setImmediate;attachTo.clearImmediate=clearImmediate})(typeof self==="undefined"?typeof global==="undefined"?this:global:self)}).call(exports,function(){return this}(),__webpack_require__(4))},function(module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Modal=__webpack_require__(6);var _Modal2=_interopRequireDefault(_Modal);var _HtmlModalContentHandler=__webpack_require__(13);var _HtmlModalContentHandler2=_interopRequireDefault(_HtmlModalContentHandler);var _StringModalContentHandler=__webpack_require__(14);var _StringModalContentHandler2=_interopRequireDefault(_StringModalContentHandler);var _AjaxModalContentHandler=__webpack_require__(10);var _AjaxModalContentHandler2=_interopRequireDefault(_AjaxModalContentHandler);var _IframeModalContentHandler=__webpack_require__(15);var _IframeModalContentHandler2=_interopRequireDefault(_IframeModalContentHandler);var _ReactModalContentHandler=__webpack_require__(16);var _ReactModalContentHandler2=_interopRequireDefault(_ReactModalContentHandler);var _Icons=__webpack_require__(17);var _Icons2=_interopRequireDefault(_Icons);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ModalHandler=function(){function ModalHandler(){_classCallCheck(this,ModalHandler);this.HtmlContentHandler=_HtmlModalContentHandler2.default;this.StringContentHandler=_StringModalContentHandler2.default;this.AjaxContentHandler=_AjaxModalContentHandler2.default;this.IframeContentHandler=_IframeModalContentHandler2.default;this.ReactContentHandler=_ReactModalContentHandler2.default;this.Icons=_Icons2.default;this._modal=null;this.returnData=null;this.resolvePromise=null;this.isShowing=false;this.onModalLoaded=null;this.onModalLoadedCallback=this.onModalLoadedCallback.bind(this)}_createClass(ModalHandler,[{key:"create",value:function create(){var _this=this;var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new Promise(function(resolve){if(_this._modal){_this._modal.remove()}_this.returnData=null;_this.resolvePromise=resolve;_this._modal=new _Modal2.default(options,_this.destroy.bind(_this),_this.onModalLoadedCallback);_this.isShowing=true})}},{key:"updateTitle",value:function updateTitle(){var title=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(this._modal&&title!==null){this._modal.updateTitle(title)}}},{key:"update",value:function update(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this._modal){this._modal.update(options)}}},{key:"destroy",value:function destroy(){if(this._modal){this.resolvePromise(this.returnData);this.returnData=null;this._modal.close();this._modal=null;this.isShowing=false}}},{key:"onModalLoadedCallback",value:function onModalLoadedCallback(){if(this.onModalLoaded){this.onModalLoaded()}}},{key:"isShowing",get:function get(){return this._isShowing},set:function set(val){this._isShowing=val}},{key:"returnData",get:function get(){return this._returnData},set:function set(val){this._returnData=val}}]);return ModalHandler}();exports.default=ModalHandler;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _objectAssign=__webpack_require__(7);var _objectAssign2=_interopRequireDefault(_objectAssign);var _KeyCodes=__webpack_require__(8);var _KeyCodes2=_interopRequireDefault(_KeyCodes);var _constants=__webpack_require__(9);var _AjaxModalContentHandler=__webpack_require__(10);var _AjaxModalContentHandler2=_interopRequireDefault(_AjaxModalContentHandler);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DEFAULT_OPTIONS={content_handler:_AjaxModalContentHandler2.default,size:_constants.SIZES.MEDIUM,position:_constants.POSITIONS.CENTER};var TOUCH_DELAY=50;var Modal=function(){function Modal(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var onCloseCallback=arguments[1];var onModalLoadedCallback=arguments[2];_classCallCheck(this,Modal);this._options=(0,_objectAssign2.default)({},DEFAULT_OPTIONS);(0,_objectAssign2.default)(this._options,options);this._contentHandler=new this._options.content_handler(this);this.clickCloseFunc=this.handleClickClose.bind(this);this.clickUnderlayFunc=this.handleClickUnderlay.bind(this);this.touchmoveUnderlayFunc=this.handleTouchmoveUnderlay.bind(this);this.keyupFunc=this.handleKeyup.bind(this);this.onCloseCallback=onCloseCallback;this.onModalLoadedCallback=onModalLoadedCallback;this.createElements();setTimeout(this.attachListeners.bind(this),TOUCH_DELAY)}_createClass(Modal,[{key:"update",value:function update(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};(0,_objectAssign2.default)(this._options,options);this._contentHandler.update()}},{key:"updateTitle",value:function updateTitle(title){this._options.title=title;this._contentHandler.getTitle();this._contentHandler.insertTitle()}},{key:"close",value:function close(){if(this._options.body_lock){document.body.classList.remove(_constants.CLASSES.MODAL_BODY_SCROLL_LOCK);var top=document.body.style.top.replace("-","").replace("px","");document.body.style.top="auto";document.body.scrollTop=top}this.fadeOut(this._modalWrapper).then(this.remove.bind(this))}},{key:"remove",value:function remove(){this.detachListeners();this._contentHandler.beforeDestroy(this._modalContentWrapper);document.body.removeChild(this._modal);if(this._options.on_close){this._options.on_close()}}},{key:"createElements",value:function createElements(){this.buildStructure();this.insertUnderlay();this._contentHandler.insert()}},{key:"buildStructure",value:function buildStructure(){this._modalHeaderIcon=document.createElement("span");this._modalHeaderIcon.className=_constants.CLASSES.MODAL_HEADER_ICON+" iris_ic is--24 l-hide";this._modalHeaderText=document.createElement("span");var modalCloseSvg='<svg class="iris_icp iris_icp--gray" viewBox="0 0 16 16"><path class="iris_icp-path" d="M10.8 8l4.9-4.9c.4-.4.4-1 0-1.4L14.3.3c-.4-.4-1-.4-1.4 0L8 5.2 3.1.3c-.4-.4-1-.4-1.4 0L.3 1.7c-.4.4-.4 1 0 1.4L5.2 8 .3 12.9c-.4.4-.4 1 0 1.4l1.4 1.4c.4.4 1 .4 1.4 0L8 10.8l4.9 4.9c.4.4 1 .4 1.4 0l1.4-1.4c.4-.4.4-1 0-1.4L10.8 8z"/></svg>';this._modalClose=document.createElement("button");this._modalClose.className=_constants.CLASSES.MODAL_CLOSE;this._modalClose.innerHTML=modalCloseSvg;this._modalHeader=document.createElement("h3");this._modalHeader.id="dialog-title";this._modalHeader.className=_constants.CLASSES.MODAL_HEADER;this._modalHeader.appendChild(this._modalHeaderIcon);this._modalHeader.appendChild(this._modalHeaderText);this._modalHeader.appendChild(this._modalClose);this._modalContentWrapper=document.createElement("div");this._modalContentWrapper.id="dialog-content";this._modalContentWrapper.className=_constants.CLASSES.MODAL_CONTENT;this._modalBox=document.createElement("div");this._modalBox.className=_constants.CLASSES.MODAL_BOX;switch(this._options.size){case _constants.SIZES.XSMALL:this._modalBox.className+=" "+_constants.CLASSES.MODAL_BOX_XSMALL;break;case _constants.SIZES.SMALL:this._modalBox.className+=" "+_constants.CLASSES.MODAL_BOX_SMALL;break;case _constants.SIZES.LARGE:this._modalBox.className+=" "+_constants.CLASSES.MODAL_BOX_LARGE;break;case _constants.SIZES.REGISTRATION:this._modalBox.className+=" "+_constants.CLASSES.MODAL_BOX_REGISTRATION;break;case _constants.SIZES.VOD_PRICE_PICKER:this._modalBox.className+=" "+_constants.CLASSES.MODAL_BOX_VOD_PRICE_PICKER;break;case _constants.SIZES.COLLECTION:this._modalBox.className+=" "+_constants.CLASSES.MODAL_BOX_COLLECTION;break;case _constants.SIZES.EPISODE_DETAILS:this._modalBox.className+=" "+_constants.CLASSES.MODAL_BOX_EPISODE_DETAILS;break;case _constants.SIZES.MEDIUM:default:}this._modalBox.appendChild(this._modalHeader);this._modalBox.appendChild(this._modalContentWrapper);this._modalBox.setAttribute("role","dialog");this._modalBox.setAttribute("aria-labelledby","dialog-title");this._modalBox.setAttribute("aria-describedby","dialog-content");this._modalBox.setAttribute("tabindex","-1");if(this._options.iframe_hijack){this._options.hide_header=true;this._options.content_flush=true;this._modalBox.classList.add(_constants.CLASSES.MODAL_BOX_IFRAME_HIJACK);this._modalContentWrapper.classList.add(_constants.CLASSES.MODAL_CONTENT_IFRAME_HIJACK);this._modalClose.classList.add(_constants.CLASSES.MODAL_CLOSE_IFRAME_HIJACK);this._modalBox.appendChild(this._modalClose)}if(this._options.hide_header){this._modalHeader.classList.add(_constants.CLASSES.MODAL_HEADER_HIDE)}if(this._options.content_flush){this._modalContentWrapper.className+=" "+_constants.CLASSES.MODAL_CONTENT_FLUSH}this._modalUnderlay=document.createElement("div");this._modalUnderlay.className=_constants.CLASSES.MODAL_UNDERLAY;this._modalWrapper=document.createElement("div");this._modalWrapper.className=_constants.CLASSES.MODAL_WRAPPER;switch(this._options.position){case _constants.POSITIONS.RIGHT:this._modalWrapper.className+=" "+_constants.CLASSES.MODAL_BOX_RIGHT;break;case _constants.POSITIONS.CENTER:default:}this._modalWrapper.appendChild(this._modalUnderlay);this._modal=document.createElement("div");this._modal.className=_constants.CLASSES.MODAL;this._modal.appendChild(this._modalWrapper)}},{key:"insertUnderlay",value:function insertUnderlay(){if(this._options.body_lock){var scrollTop="-"+document.body.scrollTop+"px";document.body.classList.add(_constants.CLASSES.MODAL_BODY_SCROLL_LOCK);document.body.style.top=scrollTop}document.body.appendChild(this._modal);this.fadeIn(this._modalWrapper)}},{key:"insertBox",value:function insertBox(){this._modalWrapper.appendChild(this._modalBox);this.fadeIn(this._modalBox);this._modalBox.focus()}},{key:"showLoader",value:function showLoader(){this._modalLoader=document.createElement("div");this._modalLoader.className="iris_modal-throbber iris_throbber";this._modalLoader.innerHTML='<div class="iris_throbber-dot iris_throbber-dot--blue"></div><div class="iris_throbber-dot iris_throbber-dot--green"></div><div class="iris_throbber-dot iris_throbber-dot--red"></div>';this._modalWrapper.appendChild(this._modalLoader)}},{key:"hideLoader",value:function hideLoader(){if(this._modalWrapper.contains(this._modalLoader)){this._modalWrapper.removeChild(this._modalLoader)}}},{key:"showModalBox",value:function showModalBox(){this._modalBox.classList.remove(_constants.CLASSES.MODAL_BOX_HIDE)}},{key:"hideModalBox",value:function hideModalBox(){this._modalBox.classList.add(_constants.CLASSES.MODAL_BOX_HIDE)}},{key:"fadeIn",value:function fadeIn(element){element.classList.add("iris_modal--fade-in")}},{key:"fadeOut",value:function fadeOut(element){return new Promise(function(resolve,reject){element.classList.add("iris_modal--fade-out");element.addEventListener("animationend",function(){resolve()});element.addEventListener("webkitAnimationEnd",function(){resolve()})})}},{key:"handleClickClose",value:function handleClickClose(){this.onCloseCallback()}},{key:"handleClickUnderlay",value:function handleClickUnderlay(){this.onCloseCallback()}},{key:"handleTouchmoveUnderlay",value:function handleTouchmoveUnderlay(e){e.preventDefault()}},{key:"handleKeyup",value:function handleKeyup(e){if(e.keyCode===_KeyCodes2.default.ESC){e.preventDefault();this.onCloseCallback()}}},{key:"attachListeners",value:function attachListeners(){this._modalClose.addEventListener("click",this.clickCloseFunc);this._modalUnderlay.addEventListener("click",this.clickUnderlayFunc);this._modalUnderlay.addEventListener("touchmove",this.touchmoveUnderlayFunc);document.body.addEventListener("keyup",this.keyupFunc)}},{key:"detachListeners",value:function detachListeners(){this._modalClose.removeEventListener("click",this.clickCloseFunc);this._modalUnderlay.removeEventListener("click",this.clickUnderlayFunc);this._modalUnderlay.removeEventListener("touchmove",this.touchmoveUnderlayFunc);document.body.removeEventListener("keyup",this.keyupFunc)}}]);return Modal}();exports.default=Modal;module.exports=exports["default"]},function(module,exports){"use strict";function ToObject(val){if(val==null){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}module.exports=Object.assign||function(target,source){var from;var keys;var to=ToObject(target);for(var s=1;s<arguments.length;s++){from=arguments[s];keys=Object.keys(Object(from));for(var i=0;i<keys.length;i++){to[keys[i]]=from[keys[i]]}}return to}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var KEY_CODES={ENTER:13,TAB:9,UP:38,DOWN:40,ESC:27};exports.default=KEY_CODES;module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CLASSES=exports.CLASSES={MODAL:"iris_modal",MODAL_WRAPPER:"iris_modal-wrapper",MODAL_BODY_SCROLL_LOCK:"iris_modal-body--scroll-lock",MODAL_UNDERLAY:"iris_modal-underlay",MODAL_BOX:"iris_modal-box",MODAL_BOX_XSMALL:"iris_modal-box--xsm",MODAL_BOX_SMALL:"iris_modal-box--sm",MODAL_BOX_LARGE:"iris_modal-box--lg",MODAL_BOX_RIGHT:"iris_modal-box--right",MODAL_BOX_REGISTRATION:"iris_modal-box--reg",MODAL_BOX_VOD_PRICE_PICKER:"iris_modal-box--vod-prices",MODAL_BOX_EPISODE_DETAILS:"iris_modal-box--episode-details",MODAL_BOX_COLLECTION:"iris_modal-box--collection",MODAL_BOX_HIDE:"iris_modal-box--hide",MODAL_BOX_IFRAME_HIJACK:"iris_modal-content--iframe-hijack",MODAL_HEADER:"iris_modal-header",MODAL_HEADER_ICON:"iris_modal-header-icon",MODAL_HEADER_HIDE:"iris_modal-header--hide",MODAL_CONTENT:"iris_modal-content",MODAL_CONTENT_FLUSH:"iris_modal-content--flush",MODAL_CONTENT_IFRAME_HIJACK:"iris_modal-content--iframe-hijack",MODAL_CLOSE:"iris_modal-btn--close",MODAL_CLOSE_IFRAME_HIJACK:"iris_modal-btn--close-iframe-hijack"};var SIZES=exports.SIZES={XSMALL:"xsmall",SMALL:"small",MEDIUM:"medium",LARGE:"large",REGISTRATION:"reg",VOD_PRICE_PICKER:"vod_price_picker",VOD_CHECKOUT:"vod_checkout",COLLECTION:"collection",EPISODE_DETAILS:"episode_details"};var POSITIONS=exports.POSITIONS={CENTER:"center",RIGHT:"right"};var BLOCK=exports.BLOCK="block";var NONE=exports.NONE="none";var VALIDATION=exports.VALIDATION={MODAL:"Invalid modal object",CONTENT_HANDLER:"Invalid ContentHandler class",TITLE:"Missing modal title",CONTENT:"Missing modal content",STRING:"Modal content given is not a string",HTML:"Modal content given is not a valid DOM element",REACT:"Modal content given is not a valid React component",REACT_PLUGIN:"React doesn't exist on this page"}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _constants=__webpack_require__(9);var _SerializeObject=__webpack_require__(11);var _SerializeObject2=_interopRequireDefault(_SerializeObject);var _AbstractModalContentHandler=__webpack_require__(12);var _AbstractModalContentHandler2=_interopRequireDefault(_AbstractModalContentHandler);var _Modal=__webpack_require__(6);var _Modal2=_interopRequireDefault(_Modal);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AjaxModalContentHandler=function(_AbstractModalContent){_inherits(AjaxModalContentHandler,_AbstractModalContent);function AjaxModalContentHandler(modal){_classCallCheck(this,AjaxModalContentHandler);var _this=_possibleConstructorReturn(this,(AjaxModalContentHandler.__proto__||Object.getPrototypeOf(AjaxModalContentHandler)).call(this,modal));_this._stylesLoadedCount=0;_this._stylesCount=0;return _this}_createClass(AjaxModalContentHandler,[{key:"validateOptions",value:function validateOptions(){_get(AjaxModalContentHandler.prototype.__proto__||Object.getPrototypeOf(AjaxModalContentHandler.prototype),"validateOptions",this).call(this);if(typeof this._parentModal._options.content!=="string"){throw new Error(_constants.VALIDATION.STRING)}}},{key:"insert",value:function insert(){var _this2=this;this._parentModal.showLoader();this.getIcon();this.getTitle();this.getContent().then(function(){_this2.insertIcon();_this2.insertTitle();_this2.insertContent();if(_this2._parentModal.onModalLoadedCallback){_this2._parentModal.onModalLoadedCallback()}})}},{key:"update",value:function update(){var _this3=this;this.getIcon();this.getTitle();this.getContent().then(function(){_this3.insertIcon();_this3.insertTitle();_this3.insertContent()})}},{key:"getContent",value:function getContent(){var _this4=this;return new Promise(function(resolve){_this4.getAjaxContent(_this4._parentModal._options.content,_this4._parentModal._options.post_data).then(function(response){if(response.title){_this4._title=response.title}_this4._content=response.content;_this4._scripts=response.scripts;_this4._styles=response.styles;resolve()})})}},{key:"insertContent",value:function insertContent(){var _this5=this;if(this._styles&&this._styles.length){this._stylesCount=this._styles.length;this.appendStyles(this._styles);setTimeout(function(){if(_this5._stylesLoadedCount!==_this5._stylesCount){
_this5.showModalBox()}},200)}else{this.showModalBox()}}},{key:"showModalBox",value:function showModalBox(){this._parentModal.hideLoader();this._parentModal.insertBox();this._parentModal._modalContentWrapper.innerHTML=this._content;this.appendScripts(this._scripts)}},{key:"appendScripts",value:function appendScripts(){var scripts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];for(var i=0;i<scripts.length;i++){var modalScript=document.createElement("script");modalScript.setAttribute("src",scripts[i]);this._parentModal._modal.appendChild(modalScript)}}},{key:"countStylesLoaded",value:function countStylesLoaded(){this._stylesLoadedCount++;if(this._stylesLoadedCount===this._stylesCount){this.showModalBox()}}},{key:"appendStyles",value:function appendStyles(){var styles=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];this._stylesCount=styles.length;for(var i=0;i<styles.length;i++){var modalStyle=document.createElement("link");modalStyle.setAttribute("rel","stylesheet");modalStyle.setAttribute("href",styles[i]);modalStyle.addEventListener("load",this.countStylesLoaded.bind(this));this._parentModal._modal.appendChild(modalStyle)}}},{key:"getAjaxContent",value:function getAjaxContent(url,post_data){return new Promise(function(resolve){var xhr=new XMLHttpRequest;if(post_data){xhr.open("POST",url);xhr.withCredentials=true;xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhr.send((0,_SerializeObject2.default)(post_data))}else{xhr.open("GET",url);xhr.withCredentials=true;xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send()}xhr.addEventListener("load",function(){var response=JSON.parse(xhr.responseText);if(xhr.status===200){resolve(response)}else{var error_modal={title:"Error",content:response.display_message};resolve(error_modal)}})})}}]);return AjaxModalContentHandler}(_AbstractModalContentHandler2.default);exports.default=AjaxModalContentHandler;module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function serialize(object,base){var query_string=[],result=void 0;for(var key in object){if(object.hasOwnProperty(key)){var value=object[key];if(base){key=base+"["+key+"]"}switch(Object.prototype.toString.call(value)){case"[object Object]":result=serialize(value,key);break;case"[object Array]":var temp_qs={};if(value.length===0){value=null}else{for(var i=0,limit=value.length;i<limit;i++){temp_qs[i]=value[i]}result=serialize(temp_qs,key)}break;default:result=key+"="+encodeURIComponent(value)}if(value!==null){query_string.push(result)}}}return query_string.join("&")}exports.default=serialize;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _constants=__webpack_require__(9);var _Modal=__webpack_require__(6);var _Modal2=_interopRequireDefault(_Modal);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var AbstractModalContentHandler=function(){function AbstractModalContentHandler(modal){_classCallCheck(this,AbstractModalContentHandler);if(!(modal instanceof _Modal2.default)){throw new Error(_constants.VALIDATION.MODAL)}this._parentModal=modal;this.validateOptions()}_createClass(AbstractModalContentHandler,[{key:"validateOptions",value:function validateOptions(){if(!this._parentModal._options.content){throw new Error(_constants.VALIDATION.CONTENT)}}},{key:"insert",value:function insert(){this.getAndInsertAll();this._parentModal.insertBox();if(this._parentModal.onModalLoadedCallback){this._parentModal.onModalLoadedCallback()}}},{key:"update",value:function update(){this.getAndInsertAll()}},{key:"getAndInsertAll",value:function getAndInsertAll(){this.getIcon();this.getTitle();this.getContent();this.insertIcon();this.insertTitle();this.insertContent()}},{key:"getIcon",value:function getIcon(){this._icon=this._parentModal._options.icon}},{key:"getTitle",value:function getTitle(){this._title=this._parentModal._options.title}},{key:"getContent",value:function getContent(){this._content=this._parentModal._options.content}},{key:"insertIcon",value:function insertIcon(){if(this._icon){this._parentModal._modalHeaderIcon.innerHTML=this._icon;this._parentModal._modalHeaderIcon.classList.remove("l-hide")}}},{key:"insertTitle",value:function insertTitle(){if(this._title){this._parentModal._modalHeaderText.textContent=this._title}}},{key:"insertContent",value:function insertContent(){}},{key:"beforeDestroy",value:function beforeDestroy(){}}]);return AbstractModalContentHandler}();exports.default=AbstractModalContentHandler;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _constants=__webpack_require__(9);var _AbstractModalContentHandler=__webpack_require__(12);var _AbstractModalContentHandler2=_interopRequireDefault(_AbstractModalContentHandler);var _Modal=__webpack_require__(6);var _Modal2=_interopRequireDefault(_Modal);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HtmlModalContentHandler=function(_AbstractModalContent){_inherits(HtmlModalContentHandler,_AbstractModalContent);function HtmlModalContentHandler(){_classCallCheck(this,HtmlModalContentHandler);return _possibleConstructorReturn(this,(HtmlModalContentHandler.__proto__||Object.getPrototypeOf(HtmlModalContentHandler)).apply(this,arguments))}_createClass(HtmlModalContentHandler,[{key:"validateOptions",value:function validateOptions(){_get(HtmlModalContentHandler.prototype.__proto__||Object.getPrototypeOf(HtmlModalContentHandler.prototype),"validateOptions",this).call(this);if(!this._parentModal._options.title){throw new Error(_constants.VALIDATION.TITLE)}if(!this._parentModal._options.content.nodeName){throw new Error(_constants.VALIDATION.HTML)}}},{key:"insertContent",value:function insertContent(){this._parentModal._modalContentWrapper.appendChild(this._content)}}]);return HtmlModalContentHandler}(_AbstractModalContentHandler2.default);exports.default=HtmlModalContentHandler;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _constants=__webpack_require__(9);var _AbstractModalContentHandler=__webpack_require__(12);var _AbstractModalContentHandler2=_interopRequireDefault(_AbstractModalContentHandler);var _Modal=__webpack_require__(6);var _Modal2=_interopRequireDefault(_Modal);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StringModalContentHandler=function(_AbstractModalContent){_inherits(StringModalContentHandler,_AbstractModalContent);function StringModalContentHandler(){_classCallCheck(this,StringModalContentHandler);return _possibleConstructorReturn(this,(StringModalContentHandler.__proto__||Object.getPrototypeOf(StringModalContentHandler)).apply(this,arguments))}_createClass(StringModalContentHandler,[{key:"validateOptions",value:function validateOptions(){_get(StringModalContentHandler.prototype.__proto__||Object.getPrototypeOf(StringModalContentHandler.prototype),"validateOptions",this).call(this);if(!this._parentModal._options.title){throw new Error(_constants.VALIDATION.TITLE)}if(typeof this._parentModal._options.content!=="string"){throw new Error(_constants.VALIDATION.STRING)}}},{key:"insertContent",value:function insertContent(){this._parentModal._modalContentWrapper.textContent=this._content}}]);return StringModalContentHandler}(_AbstractModalContentHandler2.default);exports.default=StringModalContentHandler;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _constants=__webpack_require__(9);var _AbstractModalContentHandler=__webpack_require__(12);var _AbstractModalContentHandler2=_interopRequireDefault(_AbstractModalContentHandler);var _Modal=__webpack_require__(6);var _Modal2=_interopRequireDefault(_Modal);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var IframeModalContentHandler=function(_AbstractModalContent){_inherits(IframeModalContentHandler,_AbstractModalContent);function IframeModalContentHandler(){_classCallCheck(this,IframeModalContentHandler);return _possibleConstructorReturn(this,(IframeModalContentHandler.__proto__||Object.getPrototypeOf(IframeModalContentHandler)).apply(this,arguments))}_createClass(IframeModalContentHandler,[{key:"validateOptions",value:function validateOptions(){_get(IframeModalContentHandler.prototype.__proto__||Object.getPrototypeOf(IframeModalContentHandler.prototype),"validateOptions",this).call(this);if(!this._parentModal._options.title){throw new Error(_constants.VALIDATION.TITLE)}if(typeof this._parentModal._options.content!=="string"){throw new Error(_constants.VALIDATION.STRING)}}},{key:"insertContent",value:function insertContent(){var _this2=this;var iframe=document.createElement("iframe");iframe.onload=function(){_this2._parentModal.showModalBox();_this2._parentModal.hideLoader()};iframe.setAttribute("src",this._parentModal._options.content);this._parentModal.showLoader();this._parentModal.hideModalBox();this._parentModal._modalContentWrapper.appendChild(iframe)}}]);return IframeModalContentHandler}(_AbstractModalContentHandler2.default);exports.default=IframeModalContentHandler;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _constants=__webpack_require__(9);var _AbstractModalContentHandler=__webpack_require__(12);var _AbstractModalContentHandler2=_interopRequireDefault(_AbstractModalContentHandler);var _Modal=__webpack_require__(6);var _Modal2=_interopRequireDefault(_Modal);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ReactModalContentHandler=function(_AbstractModalContent){_inherits(ReactModalContentHandler,_AbstractModalContent);function ReactModalContentHandler(){_classCallCheck(this,ReactModalContentHandler);return _possibleConstructorReturn(this,(ReactModalContentHandler.__proto__||Object.getPrototypeOf(ReactModalContentHandler)).apply(this,arguments))}_createClass(ReactModalContentHandler,[{key:"_getReactRenderer",value:function _getReactRenderer(){if(window.ReactDOM&&window.ReactDOM.render){return window.ReactDOM}if(window.React&&window.React.render){return window.React}return null}},{key:"validateOptions",value:function validateOptions(){_get(ReactModalContentHandler.prototype.__proto__||Object.getPrototypeOf(ReactModalContentHandler.prototype),"validateOptions",this).call(this);var options=this._parentModal._options;if(!options.title&&!options.hide_header){throw new Error(_constants.VALIDATION.TITLE)}if(!this._getReactRenderer()){throw new Error(_constants.VALIDATION.REACT_PLUGIN)}}},{key:"insertIcon",value:function insertIcon(){if(this._icon){window.ReactDOM.render(this._icon,this._parentModal._modalHeaderIcon);this._parentModal._modalHeaderIcon.classList.remove("l-hide")}}},{key:"insertTitle",value:function insertTitle(){if(this._title&&typeof this._title==="string"){_get(ReactModalContentHandler.prototype.__proto__||Object.getPrototypeOf(ReactModalContentHandler.prototype),"insertTitle",this).call(this)}else if(this._title){this._getReactRenderer().render(this._title,this._parentModal._modalHeaderText)}}},{key:"insertContent",value:function insertContent(){this._getReactRenderer().render(this._content,this._parentModal._modalContentWrapper)}},{key:"beforeDestroy",value:function beforeDestroy(modal_el){this._getReactRenderer().unmountComponentAtNode(modal_el)}}]);return ReactModalContentHandler}(_AbstractModalContentHandler2.default);exports.default=ReactModalContentHandler;module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Icons={Share:'<svg viewBox="0 0 24 24"><path d="M0 14l6.6 4.1L16.5 9 9 19.6V23l2-2 5 3 8-24"/></svg>'};exports.default=Icons;module.exports=exports["default"]}]);(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)})([function(module,exports,__webpack_require__){"use strict";__webpack_require__(1);var _Autocomplete=__webpack_require__(5);var _Autocomplete2=_interopRequireDefault(_Autocomplete);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var initAutocompleteForSearch=function initAutocompleteForSearch(config){var searchInputs=document.querySelectorAll(".js-search_autocomplete");if(vimeo_esi.config&&vimeo_esi.config.autocomplete_enabled){vimeo.autocomplete_instances=[];for(var i=0;i<searchInputs.length;i++){var vodFlag=searchInputs[i].classList.contains("js-search_vod_autocomplete");var options=config||{vod_enabled:vodFlag};var autocomplete=new _Autocomplete2.default(searchInputs[i],options);vimeo.autocomplete_instances.push(autocomplete)}}};window.initAutocompleteForSearch=initAutocompleteForSearch;initAutocompleteForSearch()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(global,setImmediate){(function UMD(name,context,definition){context[name]=context[name]||definition();if(typeof module!="undefined"&&module.exports){module.exports=context[name]}else if(true){!(__WEBPACK_AMD_DEFINE_RESULT__=function $AMD$(){return context[name]}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}})("Promise",typeof global!="undefined"?global:this,function DEF(){"use strict";var builtInProp,cycle,scheduling_queue,ToString=Object.prototype.toString,timer=typeof setImmediate!="undefined"?function timer(fn){return setImmediate(fn)}:setTimeout;try{Object.defineProperty({},"x",{});builtInProp=function builtInProp(obj,name,val,config){return Object.defineProperty(obj,name,{value:val,writable:true,configurable:config!==false})}}catch(err){builtInProp=function builtInProp(obj,name,val){obj[name]=val;return obj}}scheduling_queue=function Queue(){var first,last,item;function Item(fn,self){this.fn=fn;this.self=self;this.next=void 0}return{add:function add(fn,self){item=new Item(fn,self);if(last){last.next=item}else{first=item}last=item;item=void 0},drain:function drain(){var f=first;first=last=cycle=void 0;while(f){f.fn.call(f.self);f=f.next}}}}();function schedule(fn,self){scheduling_queue.add(fn,self);if(!cycle){cycle=timer(scheduling_queue.drain)}}function isThenable(o){var _then,o_type=typeof o;if(o!=null&&(o_type=="object"||o_type=="function")){_then=o.then}return typeof _then=="function"?_then:false}function notify(){for(var i=0;i<this.chain.length;i++){notifyIsolated(this,this.state===1?this.chain[i].success:this.chain[i].failure,this.chain[i])}this.chain.length=0}function notifyIsolated(self,cb,chain){var ret,_then;try{if(cb===false){chain.reject(self.msg)}else{if(cb===true){ret=self.msg}else{ret=cb.call(void 0,self.msg)}if(ret===chain.promise){chain.reject(TypeError("Promise-chain cycle"))}else if(_then=isThenable(ret)){_then.call(ret,chain.resolve,chain.reject)}else{chain.resolve(ret)}}}catch(err){chain.reject(err)}}function resolve(msg){var _then,self=this;if(self.triggered){return}self.triggered=true;if(self.def){self=self.def}try{if(_then=isThenable(msg)){schedule(function(){var def_wrapper=new MakeDefWrapper(self);try{_then.call(msg,function $resolve$(){resolve.apply(def_wrapper,arguments)},function $reject$(){reject.apply(def_wrapper,arguments)})}catch(err){reject.call(def_wrapper,err)}})}else{self.msg=msg;self.state=1;if(self.chain.length>0){schedule(notify,self)}}}catch(err){reject.call(new MakeDefWrapper(self),err)}}function reject(msg){var self=this;if(self.triggered){return}self.triggered=true;if(self.def){self=self.def}self.msg=msg;self.state=2;if(self.chain.length>0){schedule(notify,self)}}function iteratePromises(Constructor,arr,resolver,rejecter){for(var idx=0;idx<arr.length;idx++){(function IIFE(idx){Constructor.resolve(arr[idx]).then(function $resolver$(msg){resolver(idx,msg)},rejecter)})(idx)}}function MakeDefWrapper(self){this.def=self;this.triggered=false}function MakeDef(self){this.promise=self;this.state=0;this.triggered=false;this.chain=[];this.msg=void 0}function Promise(executor){if(typeof executor!="function"){throw TypeError("Not a function")}if(this.__NPO__!==0){throw TypeError("Not a promise")}this.__NPO__=1;var def=new MakeDef(this);this["then"]=function then(success,failure){var o={success:typeof success=="function"?success:true,failure:typeof failure=="function"?failure:false};o.promise=new this.constructor(function extractChain(resolve,reject){if(typeof resolve!="function"||typeof reject!="function"){throw TypeError("Not a function")}o.resolve=resolve;o.reject=reject});def.chain.push(o);if(def.state!==0){schedule(notify,def)}return o.promise};this["catch"]=function $catch$(failure){return this.then(void 0,failure)};try{executor.call(void 0,function publicResolve(msg){resolve.call(def,msg)},function publicReject(msg){reject.call(def,msg)})}catch(err){reject.call(def,err)}}var PromisePrototype=builtInProp({},"constructor",Promise,false);Promise.prototype=PromisePrototype;builtInProp(PromisePrototype,"__NPO__",0,false);builtInProp(Promise,"resolve",function Promise$resolve(msg){var Constructor=this;if(msg&&typeof msg=="object"&&msg.__NPO__===1){return msg}return new Constructor(function executor(resolve,reject){if(typeof resolve!="function"||typeof reject!="function"){throw TypeError("Not a function")}resolve(msg)})});builtInProp(Promise,"reject",function Promise$reject(msg){return new this(function executor(resolve,reject){if(typeof resolve!="function"||typeof reject!="function"){throw TypeError("Not a function")}reject(msg)})});builtInProp(Promise,"all",function Promise$all(arr){var Constructor=this;if(ToString.call(arr)!="[object Array]"){return Constructor.reject(TypeError("Not an array"))}if(arr.length===0){return Constructor.resolve([])}return new Constructor(function executor(resolve,reject){if(typeof resolve!="function"||typeof reject!="function"){throw TypeError("Not a function")}var len=arr.length,msgs=Array(len),count=0;iteratePromises(Constructor,arr,function resolver(idx,msg){msgs[idx]=msg;if(++count===len){resolve(msgs)}},reject)})});builtInProp(Promise,"race",function Promise$race(arr){var Constructor=this;if(ToString.call(arr)!="[object Array]"){return Constructor.reject(TypeError("Not an array"))}return new Constructor(function executor(resolve,reject){if(typeof resolve!="function"||typeof reject!="function"){throw TypeError("Not a function")}iteratePromises(Constructor,arr,function resolver(idx,msg){resolve(msg)},reject)})});return Promise})}).call(exports,function(){return this}(),__webpack_require__(2).setImmediate)},function(module,exports,__webpack_require__){var apply=Function.prototype.apply;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){if(timeout){timeout.close()}};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout(function onTimeout(){if(item._onTimeout)item._onTimeout()},msecs)}};__webpack_require__(3);exports.setImmediate=setImmediate;exports.clearImmediate=clearImmediate},function(module,exports,__webpack_require__){(function(global,process){(function(global,undefined){"use strict";if(global.setImmediate){return}var nextHandle=1;var tasksByHandle={};var currentlyRunningATask=false;var doc=global.document;var registerImmediate;function setImmediate(callback){if(typeof callback!=="function"){callback=new Function(""+callback)}var args=new Array(arguments.length-1);for(var i=0;i<args.length;i++){args[i]=arguments[i+1]}var task={callback:callback,args:args};tasksByHandle[nextHandle]=task;registerImmediate(nextHandle);return nextHandle++}function clearImmediate(handle){delete tasksByHandle[handle]}function run(task){var callback=task.callback;var args=task.args;switch(args.length){case 0:callback();break;case 1:callback(args[0]);break;case 2:callback(args[0],args[1]);break;case 3:callback(args[0],args[1],args[2]);break;default:callback.apply(undefined,args);break}}function runIfPresent(handle){if(currentlyRunningATask){setTimeout(runIfPresent,0,handle)}else{var task=tasksByHandle[handle];if(task){currentlyRunningATask=true;try{run(task)}finally{clearImmediate(handle);currentlyRunningATask=false}}}}function installNextTickImplementation(){registerImmediate=function(handle){process.nextTick(function(){runIfPresent(handle)})}}function canUsePostMessage(){if(global.postMessage&&!global.importScripts){var postMessageIsAsynchronous=true;var oldOnMessage=global.onmessage;global.onmessage=function(){postMessageIsAsynchronous=false};global.postMessage("","*");global.onmessage=oldOnMessage;return postMessageIsAsynchronous}}function installPostMessageImplementation(){var messagePrefix="setImmediate$"+Math.random()+"$";var onGlobalMessage=function(event){if(event.source===global&&typeof event.data==="string"&&event.data.indexOf(messagePrefix)===0){runIfPresent(+event.data.slice(messagePrefix.length))}};if(global.addEventListener){global.addEventListener("message",onGlobalMessage,false)}else{global.attachEvent("onmessage",onGlobalMessage)}registerImmediate=function(handle){global.postMessage(messagePrefix+handle,"*")}}function installMessageChannelImplementation(){var channel=new MessageChannel;channel.port1.onmessage=function(event){var handle=event.data;runIfPresent(handle)};registerImmediate=function(handle){channel.port2.postMessage(handle)}}function installReadyStateChangeImplementation(){var html=doc.documentElement;registerImmediate=function(handle){var script=doc.createElement("script");script.onreadystatechange=function(){runIfPresent(handle);script.onreadystatechange=null;html.removeChild(script);script=null};html.appendChild(script)}}function installSetTimeoutImplementation(){registerImmediate=function(handle){setTimeout(runIfPresent,0,handle)}}var attachTo=Object.getPrototypeOf&&Object.getPrototypeOf(global);attachTo=attachTo&&attachTo.setTimeout?attachTo:global;if({}.toString.call(global.process)==="[object process]"){installNextTickImplementation()}else if(canUsePostMessage()){installPostMessageImplementation()}else if(global.MessageChannel){installMessageChannelImplementation()}else if(doc&&"onreadystatechange"in doc.createElement("script")){installReadyStateChangeImplementation()}else{installSetTimeoutImplementation()}attachTo.setImmediate=setImmediate;attachTo.clearImmediate=clearImmediate})(typeof self==="undefined"?typeof global==="undefined"?this:global:self)}).call(exports,function(){return this}(),__webpack_require__(4))},function(module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout;
}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _KeyCodes=__webpack_require__(6);var _KeyCodes2=_interopRequireDefault(_KeyCodes);var _constants=__webpack_require__(7);var _AutocompleteApi=__webpack_require__(8);var _AutocompleteApi2=_interopRequireDefault(_AutocompleteApi);var _FADispatcher=__webpack_require__(9);var _FADispatcher2=_interopRequireDefault(_FADispatcher);var _CustomEventFactory=__webpack_require__(10);var _CustomEventFactory2=_interopRequireDefault(_CustomEventFactory);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DEFAULT_OPTIONS={autocomplete_enabled:true,suggestions_limit:5,minimum_characters:3,vod_enabled:false,async_enabled:false};var TRACKING_EVENTS={TAB:"Tab on Suggestion",ENTER:"Enter on Suggestion",CLICK:"Click on Suggestion",NO_SUGGESTION:"Search with no Suggestions",IGNORE_SUGGESTION:"Search ignoring Suggestions"};var faDispatcher=new _FADispatcher2.default;var Autocomplete=function(){function Autocomplete(search_input){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Autocomplete);this.searchInput=search_input;if(!this.searchInput){throw new Error("Autocomplete search input does not exist in the DOM")}if(this.searchInput.tagName.toLowerCase()!=="input"||this.searchInput.getAttribute("type")!=="text"){throw new Error("Autocomplete search input needs to be an input of type text")}this.searchForm=this.closest(this.searchInput,"form");if(!this.searchForm){throw new Error("No search form ancestor element found")}this.autocompleteWrapper=document.createElement("ul");this.autocompleteWrapper.className=_constants.AUTOCOMPLETE_CLASS;this.autocompleteWrapper.style.display=_constants.NONE;this.inputParent=this.searchInput.parentNode;this.inputParent.appendChild(this.autocompleteWrapper);this.suggestions=[];this.active_suggestion_index=null;this.force_hide_suggestions=false;this._suggestions_length=0;this._search_input_text="";this._clicking_suggestion=false;this._suggestions_changed=false;this._last_display_suggestions_time=0;this._requests_timing=[];this._requests_made=0;this._requests_cancelled=0;this._cachedSuggestions={vod:{},clip:{}};this._tracked=false;this._options=DEFAULT_OPTIONS;for(var i in options){this._options[i]=options[i]}this.attachListeners()}_createClass(Autocomplete,[{key:"changeContext",value:function changeContext(config){var _this=this;Object.keys(config).forEach(function(option){var value=config[option];if(typeof value==="boolean"&&_this._options.hasOwnProperty(option)){_this._options[option]=value}})}},{key:"closest",value:function closest(element,tag){var parent=element;while(parent.tagName){if(parent.tagName.toLowerCase()===tag.toLowerCase()){return parent}else{parent=parent.parentNode}}return null}},{key:"assembleListItems",value:function assembleListItems(){for(var i=0;i<this.suggestions.length;i++){var suggestionItem=document.createElement("li");var suggestionText=document.createElement("span");var suggestionLink=document.createElement("a");suggestionLink.classList.add("autocomplete_sug_link");suggestionText.classList.add("autocomplete_sug_label");suggestionLink.setAttribute("title",this.suggestions[i].text);suggestionText.textContent=this.suggestions[i].text;suggestionItem.setAttribute("data-index",i);if(i===this.active_suggestion_index){suggestionLink.classList.add("active")}if(this.suggestions[i].type==="suggestion"){suggestionItem.classList.add("reg_suggestion")}else{var vodThumb=document.createElement("img");vodThumb.classList.add("autocomplete_sug_thumb");vodThumb.setAttribute("src",this.suggestions[i].meta.thumbnail_url);suggestionLink.appendChild(vodThumb);suggestionItem.classList.add("vod_suggestion")}suggestionLink.appendChild(suggestionText);suggestionItem.appendChild(suggestionLink);this.autocompleteWrapper.appendChild(suggestionItem)}}},{key:"updateSuggestionsDisplay",value:function updateSuggestionsDisplay(){if(this.suggestions_visible){while(this.autocompleteWrapper.hasChildNodes()){this.autocompleteWrapper.removeChild(this.autocompleteWrapper.firstChild)}this.assembleListItems();if(this.autocompleteWrapper.style.display===_constants.NONE){this.searchInput.classList.add(_constants.INPUT_HAS_AUTOCOMPLETE_CLASS);this.autocompleteWrapper.style.display=_constants.BLOCK}if(this._suggestions_changed){this._last_display_suggestions_time=this.time_now;this._suggestions_changed=false}}else{this.searchInput.classList.remove(_constants.INPUT_HAS_AUTOCOMPLETE_CLASS);this.autocompleteWrapper.style.display=_constants.NONE}}},{key:"getSuggestions",value:function getSuggestions(text){var _this2=this;var request_start_time=this.time_now;var context=this._options.vod_enabled?"vod":"clip";text=text.toLowerCase();this._tracked=false;if(this._cachedSuggestions[this.cache_key][text]){this.suggestions=this._cachedSuggestions[this.cache_key][text];return}if(_AutocompleteApi2.default.pendingRequest){this._requests_cancelled++}_AutocompleteApi2.default.getSuggestions(text,context).then(function(xhr){var response=typeof xhr.response==="string"?JSON.parse(xhr.response):xhr.response;var cache_hit=parseInt(xhr.getResponseHeader("X-Varnish-Cache"),10)===1;_this2._suggestions_changed=true;_this2._requests_timing.push(_this2.time_now-request_start_time);_this2._requests_made++;if(response.options){_this2.suggestions=response.options;_this2.force_hide_suggestions=false;_this2._cachedSuggestions[_this2.cache_key][text]=_this2.suggestions}if(cache_hit){faDispatcher.trackEvent({component:"Autocomplete-cachehit",host:xhr.getResponseHeader("X-VServer")})}})}},{key:"populateWithSuggestion",value:function populateWithSuggestion(suggestion){this.searchInput.value=suggestion.text;this._search_input_text=suggestion.text;this.suggestions=[]}},{key:"navigateToSuggestion",value:function navigateToSuggestion(suggestion){this.populateWithSuggestion(suggestion);window.location.href=suggestion.meta.target_url}},{key:"searchWithSuggestion",value:function searchWithSuggestion(suggestion){this.populateWithSuggestion(suggestion);if(this._options.async_enabled){this.handleSubmitAsync(suggestion.text)}else{this.searchForm.submit()}this.searchForm.querySelector("input").blur();this.force_hide_suggestions=true}},{key:"handleSelectTextResult",value:function handleSelectTextResult(resultItem){this.searchWithSuggestion(resultItem)}},{key:"handleSelectVodResult",value:function handleSelectVodResult(vodResultItem){this.navigateToSuggestion(vodResultItem);this.force_hide_suggestions=true}},{key:"handleSelectResult",value:function handleSelectResult(resultItem){switch(resultItem.type){case _constants.TYPE_ONDEMAND:this.handleSelectVodResult(resultItem);break;case _constants.TYPE_TEXT:this.handleSelectTextResult(resultItem);break;default:throw new Error("Invalid result item selected")}}},{key:"navigateUp",value:function navigateUp(){if(this.active_suggestion_index!==null){if(this.active_suggestion_index>0){this.active_suggestion_index-=1}else{this.active_suggestion_index=null}}}},{key:"navigateDown",value:function navigateDown(){if(this.active_suggestion_index!==null){if(this.active_suggestion_index<this._suggestions_length-1){this.active_suggestion_index+=1}}else{this.active_suggestion_index=0}}},{key:"trackEvent",value:function trackEvent(action,suggestion_index){var requests_timing=0;if(this._requests_timing.length){requests_timing=this._requests_timing.reduce(function(a,b){return a+b})/this._requests_timing.length}faDispatcher.trackEvent({component:"Autocomplete",platform:"Desktop Web",action:action,input_value:this.searchInput.value,suggestions:this._suggestions_length?this.suggestions.clips:"",selected_suggestion:suggestion_index?this.suggestions[suggestion_index]:"",selected_suggestion_position:suggestion_index?suggestion_index+1:"",request_to_action_time:this.time_now-this._last_display_suggestions_time,requests_timing:requests_timing,requests_made:this._requests_made,requests_cancelled:this._requests_cancelled});this._tracked=true;this._requests_timing=[]}},{key:"isActionKey",value:function isActionKey(key_code){for(var key in _KeyCodes2.default){if(_KeyCodes2.default[key]===key_code){return true}}return false}},{key:"ensureAsciiString",value:function ensureAsciiString(string){return string.replace(/[^\x00-\x7F]/g,"")}},{key:"handleFocusSearchInput",value:function handleFocusSearchInput(){this.force_hide_suggestions=false}},{key:"handleBlurSearchInput",value:function handleBlurSearchInput(){if(this._clicking_suggestion){this._clicking_suggestion=false}else{this.force_hide_suggestions=true}}},{key:"handleKeydownSearchInput",value:function handleKeydownSearchInput(e){if(!this._options.autocomplete_enabled){return}var is_action_key=this.isActionKey(e.keyCode);if(!is_action_key){return false}switch(e.keyCode){case _KeyCodes2.default.ENTER:if(this.suggestions_visible&&this.active_suggestion_index!==null){e.preventDefault();this.trackEvent(TRACKING_EVENTS.ENTER,this.active_suggestion_index);this.handleSelectResult(this.suggestions[this.active_suggestion_index])}break;case _KeyCodes2.default.TAB:if(this.suggestions_visible&&this.active_suggestion_index!==null){e.preventDefault();this.trackEvent(TRACKING_EVENTS.TAB,this.active_suggestion_index);this.populateWithSuggestion(this.suggestions[this.active_suggestion_index])}break;case _KeyCodes2.default.UP:if(this._suggestions_length){e.preventDefault();if(this.force_hide_suggestions){this.force_hide_suggestions=false}else{this.navigateUp()}}break;case _KeyCodes2.default.DOWN:if(this._suggestions_length){e.preventDefault();if(this.force_hide_suggestions){this.force_hide_suggestions=false}else{this.navigateDown()}}break;case _KeyCodes2.default.ESC:if(this.suggestions_visible){e.preventDefault();this.force_hide_suggestions=true}else{e.preventDefault();this.populateWithSuggestion({text:""})}break}}},{key:"handleKeyupSearchInput",value:function handleKeyupSearchInput(e){if(!this._options.autocomplete_enabled){return}var is_action_key=this.isActionKey(e.keyCode);var validated_input_value=this.ensureAsciiString(e.target.value);if(!is_action_key&&validated_input_value!==this._search_input_text){this._search_input_text=validated_input_value;if(this._search_input_text.length>=this._options.minimum_characters){this.getSuggestions(this._search_input_text);this.active_suggestion_index=null;return false}this.suggestions=[]}}},{key:"handleSubmitAsync",value:function handleSubmitAsync(term){var autocompleteEvent=_CustomEventFactory2.default.createEvent("submit_search_form",{term:term});dispatchEvent(autocompleteEvent)}},{key:"handleSubmitSearchForm",value:function handleSubmitSearchForm(e){_AutocompleteApi2.default.cancelRequest();if(this._options.async_enabled){e.preventDefault();var input=e.target.querySelector("input");input.blur();this.handleSubmitAsync(input.value)}if(!this._tracked){if(!this._suggestions_length){this.trackEvent(TRACKING_EVENTS.NO_SUGGESTION)}else{this.trackEvent(TRACKING_EVENTS.IGNORE_SUGGESTION)}}this.force_hide_suggestions=true}},{key:"getSuggestionIndex",value:function getSuggestionIndex(e){if(e.target.tagName.toLowerCase()==="ul"){return}var suggestionLi=this.closest(e.target,"li");return parseInt(suggestionLi.getAttribute("data-index"),10)}},{key:"handleMouseoverSuggestion",value:function handleMouseoverSuggestion(e){var suggestion_index=this.getSuggestionIndex(e);if(suggestion_index!==this.active_suggestion_index){this.active_suggestion_index=suggestion_index}}},{key:"handleMousedownSuggestion",value:function handleMousedownSuggestion(e){this._clicking_suggestion=true}},{key:"handleMouseupSuggestion",value:function handleMouseupSuggestion(e){var suggestion_index=this.getSuggestionIndex(e);this.trackEvent(TRACKING_EVENTS.CLICK,suggestion_index);this.handleSelectResult(this.suggestions[suggestion_index])}},{key:"attachListeners",value:function attachListeners(){this.searchInput.addEventListener("focus",this.handleFocusSearchInput.bind(this));this.searchInput.addEventListener("blur",this.handleBlurSearchInput.bind(this));this.searchInput.addEventListener("keydown",this.handleKeydownSearchInput.bind(this));this.searchInput.addEventListener("keyup",this.handleKeyupSearchInput.bind(this));this.searchForm.addEventListener("submit",this.handleSubmitSearchForm.bind(this));this.autocompleteWrapper.addEventListener("mouseover",this.handleMouseoverSuggestion.bind(this));this.autocompleteWrapper.addEventListener("mousedown",this.handleMousedownSuggestion.bind(this));this.autocompleteWrapper.addEventListener("mouseup",this.handleMouseupSuggestion.bind(this))}},{key:"cache_key",get:function get(){return this._options.vod_enabled?"vod":"clip"}},{key:"suggestions",get:function get(){return this._suggestions},set:function set(){var suggestions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];this._suggestions=suggestions;this._suggestions_length=suggestions.length;this.updateSuggestionsDisplay()}},{key:"active_suggestion_index",get:function get(){return this._active_suggestion_index},set:function set(val){this._active_suggestion_index=val;this.updateSuggestionsDisplay()}},{key:"force_hide_suggestions",get:function get(){return this._force_hide_suggestions},set:function set(val){this._force_hide_suggestions=val;if(val===true){this._active_suggestion_index=null}this.updateSuggestionsDisplay()}},{key:"suggestions_visible",get:function get(){return this._suggestions_length&&!this.force_hide_suggestions}},{key:"time_now",get:function get(){return(new Date).getTime()}}]);return Autocomplete}();exports.default=Autocomplete;module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var KEY_CODES={ENTER:13,TAB:9,UP:38,DOWN:40,ESC:27};exports.default=KEY_CODES;module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var AUTOCOMPLETE_CLASS=exports.AUTOCOMPLETE_CLASS="autocomplete_wrapper";var INPUT_HAS_AUTOCOMPLETE_CLASS=exports.INPUT_HAS_AUTOCOMPLETE_CLASS="has_autocomplete_suggestions";var TYPE_ONDEMAND=exports.TYPE_ONDEMAND="ondemand";var TYPE_TEXT=exports.TYPE_TEXT="suggestion";var BLOCK=exports.BLOCK="block";var NONE=exports.NONE="none"},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var AutocompleteApi={pendingRequest:null,getSuggestions:function getSuggestions(text){var _this=this;var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"clip";return new Promise(function(resolve,reject){if(_this.pendingRequest){_this.pendingRequest.abort()}var xhr=new XMLHttpRequest;var encodedText=encodeURIComponent(text);var fetchUrl="/search/autocomplete?q="+encodedText;if(context==="vod"){fetchUrl=fetchUrl+"&type="+context}xhr.open("GET",fetchUrl);xhr.responseType="json";xhr.withCredentials=true;xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send();xhr.addEventListener("load",function(){if(xhr.status>=200&&xhr.status<400){resolve(xhr)}else{reject(new Error("getSuggestions: "+fetchUrl+" failed with status: "+xhr.status))}_this.pendingRequest=null});xhr.addEventListener("error",function(){reject(new Error("getSuggestions: "+fetchUrl+" failed with status: "+xhr.status));_this.pendingRequest=null});_this.pendingRequest=xhr})},cancelRequest:function cancelRequest(){this.pendingRequest&&this.pendingRequest.abort()}};exports.default=AutocompleteApi;module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FADispatcher=function(){function FADispatcher(){_classCallCheck(this,FADispatcher);window.__fa=window.__fa||[]}_createClass(FADispatcher,[{key:"trackEvent",value:function trackEvent(){var event_data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return window.__fa.push(["trackEvent",event_data])}}]);return FADispatcher}();exports.default=FADispatcher;module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CustomEventFactory=function(){function CustomEventFactory(){_classCallCheck(this,CustomEventFactory)}_createClass(CustomEventFactory,null,[{key:"createEvent",value:function createEvent(event_name){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var new_event=void 0;if(typeof window.CustomEvent==="function"){new_event=new CustomEvent(event_name,{detail:data})}else{new_event=document.createEvent("CustomEvent");new_event.initCustomEvent(event_name,true,true,data)}return new_event}}]);return CustomEventFactory}();exports.default=CustomEventFactory;module.exports=exports["default"]}]);(function(window,document){"use strict";window._gtm=window._gtm||[];var ATTRIBUTE_CLICK="data-gtm-click";var ATTRIBUTE_HOVER="data-gtm-hover";var ATTRIBUTE_HOVERING="data-gtm-hovering";function closest(element){while(element){if(element.hasAttribute(ATTRIBUTE_CLICK)){return element}element=element.parentElement}return null}function track(event_string){var parts=event_string.split("|"),event_name=parts.shift(),event_message={event:event_name};if(parts.length){parts.forEach(function(event_data_string){var event_data=event_data_string.split(":");event_message[event_name+"."+event_data[0]]=event_data[1]})}window._gtm.push(event_message)}function onClick(e){var element=closest(e.target);if(!element){return}track(element.getAttribute(ATTRIBUTE_CLICK))}function onHover(e){var element=e.target,event_string;if(typeof element.getAttribute!=="function"){return}event_string=element.getAttribute(ATTRIBUTE_HOVER);if(!event_string||element.hasAttribute(ATTRIBUTE_HOVERING)){return}element.setAttribute(ATTRIBUTE_HOVERING,"");element.addEventListener("mouseleave",function(){element.removeAttribute(ATTRIBUTE_HOVERING)});track(event_string)}function attachEvents(){var MOUSE_EVENTS_BLOCKED="vimeo"in window&&"mobile"in window.vimeo&&"Tramontana"in window.vimeo.mobile;var eventType=MOUSE_EVENTS_BLOCKED?"touchstart":"mousedown";document.addEventListener(eventType,onClick);if(!document.ontouchstart){document.addEventListener("mouseover",onHover)}}document.addEventListener("DOMContentLoaded",attachEvents)})(window,document);