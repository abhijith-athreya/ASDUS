var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},PostType,DataWrapper;(function(n){n[n.OnLoad=0]="OnLoad";n[n.OnBeforeUnload=1]="OnBeforeUnload";n[n.OnAbort=2]="OnAbort";n[n.Flush=3]="Flush"})(PostType||(PostType={}));DataWrapper=function(){function n(){this.hasErrors=!1;this._appErrors=null;this.hasIndicators=!1;this._indicators=null;this.hasTracepoints=!1;this._tracepoints=null}return n.prototype.addError=function(n,t){this.hasErrors||(this._appErrors={},this.hasErrors=!0);this._appErrors[n]=t},n.prototype.getErrors=function(){return this._appErrors},n.prototype.addIndicator=function(n){this.hasIndicators||(this._indicators={},this.hasIndicators=!0);for(var t in n)this._indicators[t]=n[t]},n.prototype.getIndicators=function(){return this._indicators},n.prototype.addTracepoint=function(n){this.hasTracepoints||(this._tracepoints={},this.hasTracepoints=!0);for(var t in n)this._tracepoints[t]=n[t]},n.prototype.getTracepoints=function(){return this._tracepoints},n}(),function(){var r,u,c,n;if(document.getElementById&&(window.attachEvent||window.addEventListener)){var t=parent.window,o=t.location,i=t.RProfiler,e=t.WindowEvent,l=o.protocol+"//",rt=i.version;e.Unload="unload";var s={Load:e.Load,BeforeUnload:e.BeforeUnload,Unload:e.Unload,Abort:e.Abort,Error:e.Error},h="__CG",a="test",b="v3.0.0",f={sampleRate:100,waterfallSampleRate:5,postUrl:l+"r.3gl.net/hawklogserver/r.p",sendOnLoad:!1,siteId:207,debugParameter:"GlimpseDebug",debugUrl:"g.3gl.net/jp/v3.0.0/D",waterfallParameter:"GlimpseWaterfall"};!t.__cpPostUrl||(f.postUrl=t.__cpPostUrl.trim());!t.__cpSendOnLoad||(f.sendOnLoad=t.__cpSendOnLoad==!0);r=function(){function t(){}return t.getMetricValue=function(n,t){if(n>=0&&n>=t&&t>=0)return n-t},t.addScriptTag=function(n,t){var i=t.document.createElement("script");i.type="text/javascript";i.src=l+n;t.document.body.appendChild(i)},t.getQueryStringValue=function(n){for(var u=o.search.substring(1),r=u.split("&"),t,i=0;i<r.length;i++)if(t=r[i].split("="),t[0]==n)return t[1];return""},t.stopEvents=function(){i&&i.eventManager.clear()},t.setCookie=function(n,t,i,r){var f="",u;!i||(u=new Date,u.setTime(u.getTime()+i*864e5),f="; expires="+u.toUTCString());document.cookie=n+"="+encodeURIComponent(t)+f+"; path=/; domain="+r+";"},t.getCookie=function(n){for(var t,u=document.cookie.split(";"),i=0,r=u;i<r.length;i++)if(t=r[i],n.test(t))return decodeURIComponent(t.substring(t.indexOf("=")+1,t.length));return""},t.getValue=function(i,r){switch(r){case n.DNS:return t.getMetricValue(i.domainLookupEnd,i.domainLookupStart);case n.Connect:return t.getMetricValue(i.connectEnd,i.connectStart);case n.Load:return t.getMetricValue(i.responseEnd,i.responseStart);case n.Wait:return t.getMetricValue(i.responseStart,i.requestStart);case n.Start:return i.startTime;case n.Redirect:return t.getMetricValue(i.redirectEnd,i.redirectStart);case n.Duration:return i.duration;case n.SSL:if(i.secureConnectionStart)return i.connectEnd-i.secureConnectionStart}return 0},t.PostQueryString="data",t}(),function(n){n[n.UserId="u"]="UserId";n[n.SessionId="s"]="SessionId";n[n.SessionTime="t"]="SessionTime";n[n.PageViewCount="c"]="PageViewCount";n[n.UrlCheckSum="k"]="UrlCheckSum";n[n.PostFlag="f"]="PostFlag";n[n.DomainIndex="i"]="DomainIndex"}(u||(u={})),function(n){n[n.GET=0]="GET";n[n.POST=1]="POST";n[n.HEAD=2]="HEAD";n[n.DELETE=3]="DELETE";n[n.OPTIONS=4]="OPTIONS";n[n.PUT=5]="PUT";n[n.TRACE=6]="TRACE";n[n.CONNECT=7]="CONNECT"}(c||(c={})),function(n){n[n.DNS=0]="DNS";n[n.Connect=1]="Connect";n[n.Load=2]="Load";n[n.Wait=3]="Wait";n[n.Start=4]="Start";n[n.Redirect=5]="Redirect";n[n.Duration=6]="Duration";n[n.SSL=7]="SSL"}(n||(n={}));var k=function(){function n(){this.userId=-1;this.sessionId=0;this.sessionTime=0;this.pageViewCount=0;this.pageViewId=0;this.postFlag=-1;this.sendWaterfall=!1;this.domainIndex=-1;this.exitToEntry=0}return n.prototype.getText=function(){var n=u.UserId+":"+this.userId+",";return n+=u.SessionId+":"+this.sessionId+",",n+=u.SessionTime+":"+this.sessionTime+",",n+=u.PageViewCount+":"+this.pageViewCount+",",n+=u.UrlCheckSum+":"+this.urlCheckSum+",",n+(u.PostFlag+":"+this.postFlag)},n}(),d=function(){function n(){this.cookieRegex=new RegExp("^(\\s)*"+h+"=","i");this.cookieExpire=365;this.sessionExpire=18e5;this.mainObj=null}return n.prototype.updateSessionTime=function(){if(this.mainObj){var n=(new Date).getTime();n-this.mainObj.sessionTime>this.sessionExpire&&(this.mainObj.sessionId=0);this.mainObj.sessionTime=n;this.updateCookie()}},n.prototype.updateCookie=function(){var i,e,n,t,f,o;if(this.mainObj){if(i=this.mainObj.getText(),!this.domain){if(e=this.mainObj.domainIndex,n=document.domain.split("."),e==-1){for(t=n[n.length-1],f=n.length-2;f>=0;f--)if(t=n[f]+"."+t,r.setCookie(h,i,this.cookieExpire,t),r.getCookie(this.cookieRegex)){this.mainObj.domainIndex=f;this.domain=t;break}return}if(e<n.length)for(t=n[n.length-1],o=n.length-2;o>=e;o--)t=n[o]+"."+t;this.domain=t}i=i+","+u.DomainIndex+":"+this.mainObj.domainIndex;r.setCookie(h,i,this.cookieExpire,this.domain)}},n.prototype.userIdFromCookie=function(n){var i,c,r,o,t,l,f,s,h,e;for(n===void 0&&(n=this.cookieRegex),i=-1,c=document.cookie.split(";"),r=0,o=c;r<o.length;r++)if(t=o[r],n.test(t))for(t=decodeURIComponent(t.substring(t.indexOf("=")+1,t.length)),l=t.split(","),f=0,s=l;f<s.length;f++)if(h=s[f],h.indexOf(u.UserId+":")==0){if(e=h.split(":"),e.length!=2||e[1].length<=0)break;if(i=parseInt(e[1]),!isNaN(i))return i}return isNaN(i)?-1:i},n.prototype.readCookie=function(){var h=r.getCookie(this.cookieRegex),o,i,s,c,e,n,t,l,a;if(this.mainObj=new k,h){for(o=h.split(","),i=0,s=o;i<s.length;i++)if(c=s[i],e=c.split(":"),e.length==2){n=parseInt(e[1],10);t=e[0];typeof t=="string"&&(t=t.trim());switch(t){case u.UserId:isNaN(n)||(this.mainObj.userId=n);break;case u.SessionId:isNaN(n)||(this.mainObj.sessionId=n);break;case u.SessionTime:isNaN(n)||(this.mainObj.sessionTime=n);break;case u.PageViewCount:isNaN(n)||(this.mainObj.pageViewCount=n);break;case u.PostFlag:isNaN(n)||(this.mainObj.postFlag=n);break;case u.DomainIndex:isNaN(n)||(this.mainObj.domainIndex=n);break;case u.UrlCheckSum:this.mainObj.urlCheckSum=o[1]}}this.mainObj.postFlag==1&&(l=this.getUserId(f.sampleRate/100),a=l/(100/f.waterfallSampleRate),this.mainObj.sendWaterfall=this.mainObj.userId<=a)}},n.prototype.setPostFlag=function(){var n,t;if(this.mainObj.postFlag=0,f.sampleRate<0){this.mainObj.postFlag=-1;return}n=this.getUserId(f.sampleRate/100);this.mainObj.userId<=n&&(this.mainObj.postFlag=1,t=n/(100/f.waterfallSampleRate),this.mainObj.sendWaterfall=this.mainObj.userId<=t)},n.prototype.getReferrer=function(n){for(var i=this.getHostName(n).replace(":","-"),r=n.indexOf("?"),u=0,t=i.length;t<n.length;t++)u+=n.charCodeAt(t)%t;return i+"/"+(r<0?n.length:r)+"/"+n.length+"/"+u},n.prototype.getHostName=function(n){var i=n.indexOf("//")+2,t=n.indexOf("/",i);return i<2&&t==-1?n:(t==-1&&(t=n.length),n.substring(i,t))},n.prototype.loadCookie=function(){var u=i.data.start,n;return(this.readCookie(),this.mainObj.userId==-1&&(n=this.userIdFromCookie(),n!=a&&n>-1&&(this.mainObj.userId=n,this.setPostFlag())),(this.mainObj.userId==-1||this.mainObj.userId==a)&&(this.mainObj.userId=this.getUserId(),this.setPostFlag()),this.mainObj.sessionId==0||u-this.mainObj.sessionTime>this.sessionExpire?(this.mainObj.sessionId=Math.floor(1+Math.random()*((Math.pow(2,32)-2)/2)),this.mainObj.pageViewCount=1):(this.mainObj.pageViewCount<65535&&this.mainObj.pageViewCount++,this.getReferrer(t.document.referrer)==this.mainObj.urlCheckSum&&this.mainObj.sessionTime>0&&(this.mainObj.exitToEntry=u-this.mainObj.sessionTime)),this.mainObj.sessionTime=(new Date).getTime(),this.mainObj.pageViewId=Math.floor(1+Math.random()*((Math.pow(2,16)-2)/2)),this.mainObj.urlCheckSum=this.getReferrer(t.location.href),this.updateCookie(),r.getCookie(this.cookieRegex)=="")?!1:!0},n.prototype.getUserId=function(n){return n===void 0&&(n=Math.random()),Math.floor(1+n*((Math.pow(2,64)-2)/2))},n.prototype.shouldPost=function(){return this.mainObj.postFlag==1},n}(),v=function(){function n(n){this.char=n;this.children=[]}return n}(),y=function(){function n(){this.root=new v("");this.isReversed=!0}return n.prototype.add=function(n,t){var u,i,f,e,r;for(n===void 0&&(n=this.root),u=n.children,i=0,f=u;i<f.length;i++)if(e=f[i],e.char==t)return e;return r=new v(t),u.push(r),r.parent=n,r},n.prototype.toObject=function(){var n={},t=this.isReversed;return function i(n,r){var o=n.char=="",e,u,f;if(o)e=r;else{if(u=n.char,n.children.length==1)while(n.children.length==1)n=n.children[0],u=t?n.char+u:u+n.char;r[u]=n.data||{};e=r[u]}for(f=0;f<n.children.length;f++)i(n.children[f],e)}(this.root,n),n},n}(),p=function(){function t(t){this.dns=0;this.connect=0;this.load=0;this.wait=0;this.start=0;this.duration=0;this.redirect=0;this.ssl=0;this.url=t.name;var i=r.getValue;this.dns=i(t,n.DNS);this.connect=i(t,n.Connect);this.wait=i(t,n.Wait);this.load=i(t,n.Load);this.start=i(t,n.Start);this.duration=i(t,n.Duration);this.redirect=i(t,n.Redirect);this.ssl=i(t,n.SSL)}return Object.defineProperty(t.prototype,"url",{get:function(){return this._url},set:function(n){var i,t,u,r;n.indexOf("http://")!=-1?this.protocol=0:n.indexOf("https://")!=-1&&(this.protocol=1);i=n.split("/").slice(1,3).join("");t=i.indexOf(":");t!=-1&&(u=i.substr(t+1),r=parseInt(u),isNaN(r)||(this.port=r));n=n.substr(n.indexOf(i)+i.length);t=n.indexOf("?");t!=-1&&(n=n.substr(0,t));t=n.indexOf("#");t!=-1&&(n=n.substr(0,t));n=n.substr(0,64);this._url=n},enumerable:!0,configurable:!0}),t.prototype.translateForPost=function(){var t=Math.round,i={u:this.url,pr:this.protocol},n=function(n,t){typeof t!="number"||isNaN(t)||(i[n]=t)};return n("pt",this.port),n("dn",t(this.dns)),n("fc",t(this.connect)),n("ld",t(this.load)),n("wt",t(this.wait)),n("st",t(this.start)),n("rd",t(this.redirect)),n("dr",t(this.duration)),n("ssl",t(this.ssl)),i},t}(),w=function(t){function i(n,i,r){t.call(this,i);this.responseTime=0;this.sendSize=0;this.responseSize=0;this.method=c[n.method.toUpperCase()];n.complete&&n.connectionEstablished&&(this.responseTime=n.complete-n.connectionEstablished);this.isSummary=r;r?(this.start=undefined,this.count=1):this.isAsync=n.isAsync;this.sendSize=n.sendSize||0;this.responseSize=n.responseSize||0}return __extends(i,t),i.prototype.update=function(t,i){var u=r.getValue;this.dns+=u(i,n.DNS);this.connect+=u(i,n.Connect);this.wait+=u(i,n.Wait);this.load+=u(i,n.Load);this.duration+=u(i,n.Duration);this.redirect+=u(i,n.Redirect);this.ssl+=u(i,n.SSL);this.sendSize+=t.sendSize||0;this.responseSize+=t.responseSize||0;this.count++},i.prototype.translateForPost=function(){var n=t.prototype.translateForPost.call(this);return this.isSummary?n.n=this.count:n.ia=this.isAsync?1:0,n.md=this.method,n.rp=Math.round(this.responseTime),n.ss=this.sendSize,n.rs=this.responseSize,n},i}(p),g=function(){function t(){this.count=0;this.dns=0;this.connect=0;this.load=0;this.wait=0;this.duration=0;this.redirect=0;this.ssl=0}return t.prototype.addAjaxItem=function(n,t){var i,r,u,f;if(this.update(t),i=new w(n,t,!0),typeof this._ajax=="undefined"){this._ajax=[];this._ajax.push(i);return}for(r=0,u=this._ajax;r<u.length;r++)if(f=u[r],f.url==i.url){f.update(n,t);return}this._ajax.length<10&&this._ajax.push(i)},t.prototype.update=function(t){var i=r.getValue;this.dns+=i(t,n.DNS);this.connect+=i(t,n.Connect);this.wait+=i(t,n.Wait);this.load+=i(t,n.Load);this.duration+=i(t,n.Duration);this.redirect+=i(t,n.Redirect);this.ssl+=i(t,n.SSL);this.count++},t.prototype.translateForPost=function(){var n=Math.round,u={n:this.count,dn:n(this.dns),fc:n(this.connect),ld:n(this.load),wt:n(this.wait),dr:n(this.duration),rd:n(this.redirect),ssl:n(this.ssl)},i,t,r,f;if(this._ajax){for(i=[],t=0,r=this._ajax;t<r.length;t++)f=r[t],i.push(f.translateForPost());u.ax=i}return u},t}(),nt=function(){function n(){this._resources=[]}return n.prototype.translateForPost=function(){for(var r,t=[],n=0,i=this._resources;n<i.length;n++)r=i[n],t.push(r.translateForPost());return t},n.prototype.addItem=function(n){var t=new p(n);this._resources.push(t)},n.prototype.addAjaxItem=function(n,t){var i=new w(n,t,!1);this._resources.push(i)},n}(),tt=function(n){function t(){n.apply(this,arguments);this.maxJsErrors=10;this.charCodes={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\","&":"%26"};this.strRegex=/["&\\\x00-\x1f\x7f-\x9f]/g}return __extends(t,n),t.prototype.toString=function(n){var t=this.translateForPost(n);return typeof JSON=="undefined"?this.jsonStringify(t):JSON.stringify(t)},t.prototype.strEscape=function(n){var i=this.charCodes[n],t;return i?i:(t=n.charCodeAt(0),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))},t.prototype.jsonStringify=function(n){var t=[],i,u,e,r,f;switch(typeof n){case"string":return this.strRegex.test(n)?'"'+n.replace(this.strRegex,this.strEscape)+'"':'"'+n+'"';case"number":return isFinite(n)?String(n):"null";case"boolean":return String(n);case"object":if(!n)return"null";if(n.constructor===Date,typeof n.length=="number"&&!n.propertyIsEnumerable("length")){for(i=0,u=n;i<u.length;i++)e=u[i],t.push(this.jsonStringify(e));return"["+t.join(",")+"]"}for(r in n)typeof r=="string"&&(f=this.jsonStringify(n[r]),!f||t.push(this.jsonStringify(r)+":"+f));return"{"+t.join(",")+"}"}return""},t.prototype.translateForPost=function(n){var t={},r,i,u;if(t.v=b,t.pt=this.postType,t.ui=this.userId,t.si=this.sessionId,t.di=this.siteId,t.pi=this.pageViewId,t.jsc=this.jsErrorCount||0,t.rf=this.referrer,t.pc=this.pageViewCount,t.dh=this.screenHeight,t.dw=this.screenWidth,t.rc=this.redirectCount||0,t.jsc=this.jsErrorCount||0,this.jsErrors&&this.jsErrors.length>0){for(r=[],i=0;i<Math.min(this.jsErrors.length,this.maxJsErrors);i++)r.push(this.translateErrorForPost(this.jsErrors[i]));t.jse=r}return(this.hasErrors&&(t.ae=this.getErrors()),this.hasIndicators&&(t.ind=this.getIndicators()),this.hasTracepoints&&(t.tra=this.getTracepoints()),this.isConversion&&(t.cv=this.isConversion?1:0,this.revenue&&(t.rv=this.revenue),this.revenueItems&&(t.ri=this.revenueItems)),this.pageGroup&&(t.pg=this.pageGroup),this.variation&&(t.ab=this.variation),(this.resources||this.ajaxRequests)&&(u=this.translateResources(this.resources,this.ajaxRequests),t.res=u.summary,n&&(t.wf=u.waterfall)),!this.isNewPageView)?(t.np=0,t):(t.np=1,t.dn=this.dns,t.fc=this.fullConnect,t.wt=this.wait,t.ld=this.load,t.de=this.domInteractive,t.dl=this.domLoaded,t.dc=this.docComplete,window.CPVisuallyComplete&&(t.vct=window.CPVisuallyComplete.getValue()),t.rp=this.response,t.cl=this.contentLoad,t.rd=this.redirect,t.dh=this.screenHeight,t.dw=this.screenWidth,t.rc=this.redirectCount||0,this.secureConnect&&(t.sc=this.secureConnect),this.exitToEntry&&(t.xe=this.exitToEntry),this.entryToOnLoad&&(t.el=this.entryToOnLoad),this.spdyVersion&&(t.sv=this.spdyVersion),this.prerender&&(t.pr=this.prerender),t)},t.prototype.translateErrorForPost=function(n){var t={},i,r;return t.m=n.message,t.n=n.lineNumber,t.c=n.count+1,i=n.url,r=i.indexOf("?"),r!=-1&&(i=i.substr(0,r)),t.u=i,t},t.prototype.translateResources=function(n,t){var k=!!n,d=!!t,tt,r,c,v,u,i,p,h,l,w,b,f,e,s,a;if(!k&&!d)return null;if(tt=function(n){var r,u,f,i,e;if(!k||!d)return null;for(r=0,u=t;r<u.length;r++)if(f=u[r],i=f.url,i.indexOf("http")!=0&&(e=o.href.lastIndexOf("/"),i=o.href.substring(0,e)+"/"+i),i==n.name)return f;return null},r={},n)for(c=0,v=n;c<v.length;c++)(u=v[c],u)&&(i=u.name.split("/").slice(1,3).join(""),i&&i.length!=0)&&(p=i.indexOf(":"),p!=-1&&(i=i.substr(0,p)),r.hasOwnProperty(i)||(r[i]={summary:new g,waterfall:new nt}),h=r[i],l=tt(u),l?(h.summary.addAjaxItem(l,u),h.waterfall.addAjaxItem(l,u)):(h.summary.update(u),h.waterfall.addItem(u)));w=new y;for(f in r){for(e=undefined,s=f.length-1;s>=0;s--)a=f[s],e=w.add(e,a);e.data=r[f].summary.translateForPost()}b=new y;for(f in r){for(e=undefined,s=f.length-1;s>=0;s--)a=f[s],e=b.add(e,a);e.data=r[f].waterfall.translateForPost()}return{summary:w.toObject(),waterfall:b.toObject()}},t}(DataWrapper),it=function(){function n(){var n=this,u;if(this.visitor=new d,this.postUrl=f.postUrl,this.prevPostObj=null,this.didSendInitial=!1,this.didPost=!1,this.isDebugging=!1,this.registerPageLoad=function(){if(n.isDebugging){i.debugData=n.createInitPostObject(PostType.OnLoad);r.stopEvents();r.addScriptTag(f.debugUrl,t);return}n.visitor.updateSessionTime();n.doPost(PostType.OnLoad)},this.doPost=function(t){if(n.visitor.shouldPost()&&!n.didPost){t!=PostType.OnBeforeUnload||i.data.loadFired||(t=PostType.OnAbort);var r=f.sendOnLoad&&(t==PostType.OnLoad||t==PostType.OnAbort),u=!f.sendOnLoad&&(t==PostType.OnBeforeUnload||t==PostType.OnAbort);(r||u)&&(n.didPost=!0,n.doPostReport(t))}},i&&i.data&&!this.didSendInitial){if(this.didSendInitial=!0,u=this.visitor.loadCookie(),this.isDebugging=!!r.getQueryStringValue(f.debugParameter),!this.isDebugging&&!u){r.stopEvents();return}i.data.loadFired||!t.document||(i.data.loadFired=t.document.readyState=="complete");i.data.loadFired?this.registerPageLoad():i.eventManager.add(s.Load,parent.window,this.registerPageLoad);i.eventManager.add(s.BeforeUnload,t,function(){n.doPost(PostType.OnBeforeUnload)});i.eventManager.add(s.Unload,t,function(){n.doPost(PostType.OnBeforeUnload)})}}return n.prototype.doPostReport=function(n){var t=this.createInitPostObject(n),i=this.visitor.mainObj.sendWaterfall||!!r.getQueryStringValue(f.waterfallParameter);this.makeRequest(t,i)},n.prototype.makeRequest=function(n,t){var r=n.toString(t),i;navigator&&typeof navigator.sendBeacon=="function"?navigator.sendBeacon(this.postUrl,r):(i=new XMLHttpRequest,window.XDomainRequest&&(i=new window.XDomainRequest,i.timeout=0,i.onload=function(){},i.onerror=function(){},i.ontimeout=function(){},i.onprogress=function(){}),i.open("POST",this.postUrl,!1),i.setRequestHeader?i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"):null,i.send(r),i=null)},n.prototype.createInitPostObject=function(n){var u=new tt,o,s,e,h;return u.postType=n,u.isNewPageView=!0,u.siteId=f.siteId,u.referrer=encodeURI(t.location.href),o=this.visitor.mainObj,u.userId=o.userId,u.sessionId=o.sessionId,u.pageViewId=o.pageViewId,u.pageViewCount=o.pageViewCount,u.screenHeight=screen.height,u.screenWidth=screen.width,i.data.jsCount>0&&(u.jsErrorCount=i.data.jsCount,u.jsErrors=i.data.jsErrors),o.exitToEntry>0&&(u.exitToEntry=o.exitToEntry),s=i.data.loadTime-i.data.start,s>0&&(u.entryToOnLoad=s),t.performance&&(e=t.performance.timing,u.dns=e.domainLookupEnd-e.domainLookupStart,u.fullConnect=e.connectEnd-e.connectStart,u.wait=e.responseStart-e.requestStart,u.load=e.responseEnd-e.responseStart,u.domInteractive=r.getMetricValue(e.domInteractive,e.navigationStart),u.domLoaded=r.getMetricValue(e.domContentLoadedEventStart,e.navigationStart),u.docComplete=r.getMetricValue(e.domComplete,e.navigationStart),u.response=r.getMetricValue(e.responseEnd,e.navigationStart),u.contentLoad=r.getMetricValue(e.loadEventStart,e.domLoading),u.redirect=e.redirectEnd-e.redirectStart,e.secureConnectionStart&&(u.secureConnect=e.connectEnd-e.secureConnectionStart),t.performance.navigation&&(u.redirectCount=t.performance.navigation.redirectCount),t.performance.getEntriesByType&&(u.resources=t.performance.getEntriesByType("resource"))),t.chrome&&t.chrome.loadTimes&&(h=t.chrome.loadTimes(),h.wasFetchedViaSpdy&&(u.spdyVersion=h.npnNegotiatedProtocol)),document.webkitVisibilityState==="prerender"&&(u.prerender=1),i.hasInsight&&(this.addInsightForPost(u),i.clearInfo()),i.data.ajax&&(u.ajaxRequests=i.data.ajax.slice()),u},n.prototype.addInsightForPost=function(n){var f=i.info,r,s,o,e,u,h,c,t;for(r in f)switch(r){case"appError":if(t=f[r],t&&typeof t=="object")for(e in t)(o=Number(e),isNaN(o))||(u=t[e],u&&typeof u=="string"&&(s=u,s.length>32&&(s=s.substring(0,32)),n.addError(e,s)));break;case"conversion":if(t=f[r],n.isConversion=!0,t&&typeof t=="object")for(e in t)(o=Number(e),isNaN(o))||(u=t[e],u&&typeof u=="number"&&(n.revenue=o,n.revenueItems=u));break;case"indicator":h=this.buildInsight(f[r],0);h[0]&&n.addIndicator(h[1]);break;case"tracepoint":c=this.buildInsight(f[r],"");c[0]&&n.addTracepoint(c[1]);break;case"pageGroup":t=f[r];t!==undefined&&typeof t=="string"&&(n.pageGroup=t);break;case"variation":t=f[r];t!==undefined&&typeof t=="string"&&(n.variation=t)}},n.prototype.buildInsight=function(n,t){var f={},i=!1,r,u;if(n&&typeof n=="object")for(r in n)r&&(u=n[r],u&&typeof u==typeof t&&(f[r]=u,i=!0));return i?[i,f]:[i,f]},n}(),ut=new it}}();window.CPVisuallyComplete=function(){var n,t,i;return function(n){n[n.OnUserinteracted=0]="OnUserinteracted";n[n.OnTimeOut=1]="OnTimeOut"}(n||(n={})),t=function(){function t(){var t=this;this.pageWindow=parent.window||window;this.windowEvent=this.pageWindow.WindowEvent;this.protocol=location.protocol+"//";this.resourceBasedVisuallyComplete=0;this.domChanges=[];this.total=0;this.visuallyCompleteTimeOut=2e3;this.pageLoadPercentage=90;this.isObserverAvailable=!1;this.mutationElements=[];this.initiatorType=["img","iframe","css","script","subdocument"];this.onLoad=function(){var i=function(){t.isObserverAvailable&&t.disconnect(n.OnUserinteracted);t.pageWindow.document.removeEventListener("scroll",i);t.pageWindow.document.removeEventListener("click",i)};t.pageWindow.document.addEventListener("scroll",i);t.pageWindow.document.addEventListener("click",i)};this.initWindowEvents();this.pageWindow.addEventListener("load",this.onLoad)}return t.prototype.init=function(){this.initElWatcher();this.initElVisible();this.start()},t.prototype.handleNodeAdded=function(n){this.intersectionObs.observe(n)},t.prototype.start=function(){for(var t=this,n=0;n<this.mutationElements.length;n++)this.intersectionObs.observe(this.mutationElements[n]);this.mutationElements.forEach(function(n){return t.mutationObs.observe(n,{subtree:!0,childList:!0})})},t.prototype.disconnect=function(i){var s=performance.timing.domComplete-performance.timing.navigationStart,o,f,u,e,r;if(!t.apiBasedVisuallyComplete&&i==n.OnUserinteracted&&this.intersectionObs){this.intersectionObs.disconnect();this.userInteracted=!0;return}if(!this.userInteracted&&this.intersectionObs)for(this.intersectionObs.disconnect(),o=this.pageWindow.performance.timing.navigationStart,f=0,u=0,e=this.domChanges;u<e.length;u++)r=e[u],f+=r.area,r.percentChange=100*f/this.total,r.percentChange>this.pageLoadPercentage&&(t.apiBasedVisuallyComplete=Math.round(r.timeStamp-o))},t.prototype.initElWatcher=function(){var n=this;this.currentElements=this.pageWindow.document.body.getElementsByTagName("*");this.filter();this.mutationObs=new window.MutationObserver(function(i){n.userInteracted||t.apiBasedVisuallyComplete||i.forEach(function(t){for(var u,f=t.addedNodes,i=0,r=f;i<r.length;i++){u=r[i];try{return n.handleNodeAdded(u)}catch(e){return null}}})})},t.prototype.initElVisible=function(){var n=this;this.intersectionObs=new window.IntersectionObserver(function(t){t.forEach(function(t){return n.handleVisChange(t)})},{threshold:[0,.25,.5,1]})},t.prototype.handleVisChange=function(n){var t={};t.timeStamp=Date.now();t.target=n.target;t.ratio=n.intersectionRatio;t.time=n.time;t.area=n.intersectionRect.height*n.intersectionRect.width;this.total+=t.area;this.domChanges.push(t)},t.prototype.filter=function(){for(var t,n=0;n<this.currentElements.length;n++)t=this.currentElements[n],t.tagName!="BR"&&this.mutationElements.push(t)},t.prototype.initWindowEvents=function(){var i=this,r=function(){setTimeout(function(){i.isObserverAvailable?i.disconnect(n.OnTimeOut):i.pageWindow.performance&&i.getImages()},i.visuallyCompleteTimeOut)};this.pageWindow.document.readyState=="complete"?r():this.pageWindow.addEventListener("load",r);this.pageWindow.onresize=function(){!t.apiBasedVisuallyComplete&&i.intersectionObs&&(i.intersectionObs.disconnect(),i.userInteracted=!0)}},t.prototype.getValue=function(){return t.apiBasedVisuallyComplete},t.prototype.getImages=function(){for(var r,n,f=this.pageWindow.performance.getEntriesByType("resource"),i=0,u=f;i<u.length;i++)r=u[i],this.initiatorType.indexOf(r.initiatorType)>-1&&(n=r.responseEnd,(!this.resourceBasedVisuallyComplete||n>this.resourceBasedVisuallyComplete)&&(this.resourceBasedVisuallyComplete=Math.round(n),t.apiBasedVisuallyComplete=Math.round(n)))},t}(),i=new t,{getValue:i.getValue}}();