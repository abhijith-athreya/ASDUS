var useRootDomainList=["bankofamerica.com","ml.com","merrilledge.com","bankcardservices.co.uk","tcsandbox.com"];var useRootDomain;for(var urdIndex=0;urdIndex<useRootDomainList.length;urdIndex++)if(window.location.href.indexOf(useRootDomainList[urdIndex])!==-1){useRootDomain=useRootDomainList[urdIndex];break}
var PersistentStorage=function(){var uniqueInstance;var STORAGE_EXPIRE_PREFIX="LSCACHE-";var EXPIRY_BASE=10;var COOKIE="cookie",LOCALSTORAGE="localStorage";var COOKIE_PC_NAME="inqPc";var storageCondition=null;var cookieEnabled;var readonly=null;function constructor(){var instance;if(isCookieEnabled())storageCondition=COOKIE;else if(isLSSupported())storageCondition=LOCALSTORAGE;else if(isCookieReadOnlyEnabled())storageCondition=COOKIE;if(storageCondition===COOKIE)instance=getCookieInstance();else if(storageCondition===
LOCALSTORAGE)instance=getLocalStorageInstance();else instance=null;return instance}return{getInstance:function(){if(!uniqueInstance)uniqueInstance=constructor();return uniqueInstance},isLocalStorageUsed:isLocalStorageUsed,_testHook:{getCookieInstance:getCookieInstance,getLocalStorageInstance:getLocalStorageInstance}};function isLocalStorageUsed(){return uniqueInstance&&storageCondition===LOCALSTORAGE}function isCookieEnabled(){if(typeof cookieEnabled=="undefined"){var expiry=(new Date((new Date).getTime()+
366*24*3600*1E3)).toUTCString();document.cookie=COOKIE_PC_NAME+"=1; path=/; expires="+expiry+";"+(window.location.href.indexOf(useRootDomain)!=-1?"domain="+useRootDomain+";":"");cookieEnabled=document.cookie.indexOf(COOKIE_PC_NAME)!=-1?true:false;document.cookie=COOKIE_PC_NAME+"=1; path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT"}return cookieEnabled}function isCookieReadOnlyEnabled(){if(readonly==null)if(!isCookieEnabled()&&document.cookie!=="")readonly=true;else readonly=false;return readonly}function isLSSupported(){var isSupported=
false;var uaString=window.navigator.userAgent;if(/firefox/i.test(uaString))try{if(window["localStorage"]&&!isIos7(navigator.userAgent)){localStorage.setItem(COOKIE_PC_NAME,2);isSupported=true}}catch(e){log("WARNING window.localStorage is not supported and chat may not be offered.",e)}return isSupported;function isIos7(uagent){return/(iPad|iPhone).*OS 7/i.test(uagent)}}function log(message,exception){if(message)if(window["console"]&&console["log"])if(exception)console.log(message,exception);else console.log(message)}
function getLocalStorageInstance(){var SESSION_INDICATOR="session";var localStorageHelper={setValue:function(key,value,expired){localStorage.setItem(STORAGE_EXPIRE_PREFIX+key,expired);localStorage.setItem(key,value)}};return{getAllCookies:function(){var cookieValues="";var value;var SESSION_INQCA_STR="sinqCA",sessionCA;for(f in localStorage)if(f.indexOf(STORAGE_EXPIRE_PREFIX)!==0){value=localStorage.getItem(f);if(f.indexOf("inqCA")===0){sessionCA=sessionStorage.getItem(SESSION_INQCA_STR);if(!isNaN(sessionCA)&&
sessionCA>0)value=0}cookieValues+=""+f+"="+value+";"}return cookieValues},get:function(){var obj={};for(f in localStorage)if(f.indexOf(STORAGE_EXPIRE_PREFIX)!==0)obj[f]=localStorage.getItem(f);return obj},getItem:function(key){var today=new Date;var expired=localStorage.getItem(STORAGE_EXPIRE_PREFIX+key);if(expired!==null&&expired!==SESSION_INDICATOR){expired=parseInt(expired,EXPIRY_BASE);if(!isNaN(expired)&&expired<today.getTime()){this.removeItem(key);return null}}return localStorage.getItem(key)},
setItem:function setItem(key,value,lifetime,path){if(typeof lifetime!=="undefined"&&lifetime!==""){var today=new Date;var lifetimeInMs=parseInt(lifetime,EXPIRY_BASE);if(!isNaN(lifetimeInMs))if(lifetime>0)localStorageHelper.setValue(key,value,today.getTime()+lifetime);else this.removeItem(key);else{var expired=Date.parse(lifetime);if(!isNaN(expired))if(expired>today.getTime())localStorageHelper.setValue(key,value,expired);else this.removeItem(key);else{log("ERROR: PersistentStorage.cookieInstance: lifetime has to be a number or a date string");
return}}}else localStorageHelper.setValue(key,value,SESSION_INDICATOR)},removeItem:function(key){localStorage.removeItem(STORAGE_EXPIRE_PREFIX+key);localStorage.removeItem(key)},clear:function(){localStorage.clear()},onUnload:function(){setSessionStorageTimeout()},version:"localStorage.0.0.3"};function setSessionStorageTimeout(){var today=new Date;var WAIT_PERIOD=5*60*1E3;var SESSION_TIMEOUT=today.getTime()+WAIT_PERIOD;for(f in localStorage)if(f.indexOf(STORAGE_EXPIRE_PREFIX)===0&&localStorage.getItem(f)===
SESSION_INDICATOR)localStorage.setItem(f,SESSION_TIMEOUT)}}function getCookieInstance(){return{getAllCookies:function(){return document.cookie},get:function(){var a_all_cookies=document.cookie.split(";");var a_temp_cookie="";var cookie_name="";var cookie_value=null;var retval=null;for(var i=0;i<a_all_cookies.length;i++){a_temp_cookie=a_all_cookies[i].split("=");cookie_name=a_temp_cookie[0].replace(/^\s+|\s+$/g,"");if(a_temp_cookie.length>1)cookie_value=decodeURIComponent(a_temp_cookie[1].replace(/^\s+|\s+$/g,
""));if(retval==null)retval={};retval[cookie_name]=cookie_value;a_temp_cookie=null;cookie_name=""}return retval},getItem:function(key){var keyEQ=key+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1,c.length);if(c.indexOf(keyEQ)==0)return c.substring(keyEQ.length,c.length)}return null},setItem:function(key,value,lifetime,path){var daysAsNumber,expires="";if(typeof lifetime==="undefined"||lifetime==="")expires="";else{var lifetimeInMs=
parseInt(lifetime,EXPIRY_BASE);if(!isNaN(lifetimeInMs))if(lifetimeInMs>0){var date=new Date;date.setTime(date.getTime()+lifetimeInMs);expires=";expires="+date.toUTCString()}else expires=";expires=Thu, 01 Jan 1970 00:00:01 GMT";else{var d=Date.parse(lifetime);if(!isNaN(d))expires=";expires="+lifetime;else{log("ERROR: PersistentStorage.cookieInstance: days has to be a number or a date string");return}}}document.cookie=key+"="+value+expires+"; path=/"+(window.location.href.indexOf(useRootDomain)!=-1?
";domain="+useRootDomain:"")},removeItem:function(key){this.setItem(key,"",-1)},clear:function(){},onUnload:function(){},version:"cookie.0.0.3"}}}();var ptStorage=PersistentStorage.getInstance();var bPostMessage=window["postMessage"]!=null;var hasStringSupport=false;var previousCommand="";var xHRsInProgress={};var xhrTimeoutController={};var caUnloadController;var beaconUnloadController;var KEY_ENGAGEMENT_ID_STRING="engagementID";
function simpleChatPost(xfrdata){var qIx=xfrdata.indexOf("?");if(qIx==-1)return;var url=xfrdata.substring(0,qIx);var data=xfrdata.substring(qIx+1);var xHR=getXMLHttpRequest();xHR.open("POST",url,true);xHR.setRequestHeader("Content-type","application/x-www-form-urlencoded");xHR.send(data)}
function doCommandsInClientDomain(data,clientHtml,id){var cmd=new Array;if(typeof data=="string"){cmd[0]=id;cmd[1]=data}else cmd=data;if(!bPostMessage){var divsub=window.document.createElement("DIV");var frameSrc=clientHtml+"?PRXY";var frame_id="iframe_proxy_"+id;divsub.innerHTML='<IFRAME ID="'+frame_id+'" '+'STYLE="overflow: hidden; display: block; border: none; top:0px;left:0px;width: 1px; height: 1px;" '+'NAME="'+id+"||"+"LoadMgr.handleIESuccess('"+convertArrToString(cmd)+"');\" "+'SRC="'+frameSrc+
'">\n</IFRAME>';document.body.appendChild(divsub);var iframe=document.getElementById(frame_id);var iframCallback=function(){setTimeout('removeIframeProxyNode("iframe_proxy_'+id+'")',5E3)};if(iframe.addEventListener)iframe.addEventListener("load",iframCallback,false);else if(iframe.attachEvent)iframe.attachEvent("onload",iframCallback);else iframe.onload=iframCallback}else if(hasStringSupport)parent.postMessage(convertArrToString(cmd),"*");else parent.postMessage(cmd,"*")}
function convertArrToString(arr){for(var i=0;i<arr.length;i++)arr[i]=encodeURIComponent(arr[i]);return arr.join("||")}function removeIframeProxyNode(id){try{var node=document.getElementById(id);if(!!node){var p=node.parentNode;p.removeChild(node);node=p;if(!!node){p=node.parentNode;p.removeChild(node)}}}catch(e){if(window.console)window.console.error(e.message)}}function setupSameOriginDomain(){if(!isSelfDetectionMode())document.domain="inq.com"}
function _executeCommandFromItems(data){if(data&&data.length>0)try{if(checkDataForSimplePost(data))simpleChatPost(data[0]);else try{doCommands(data)}catch(e){var clientHtml=data[3];var id=data[1];var code='if (inqFrame.Inq["proxyError"]!=null)inqFrame.Inq.proxyError("'+catchJsFormatter(e,data[0])+'");';doCommandsInClientDomain(code,clientHtml,id)}}catch(e){if(window.console)window.console.error(e.message)}}
function checkDataForSimplePost(data){var regexProtocol=/(^HTTP[s]?:).*/ig;return regexProtocol.test(data)}
function whenLoaded(){setupSameOriginDomain();if(bPostMessage){try{if(window["addEventListener"])window.addEventListener("message",whenPosted,false);else if(window["attachEvent"])window.attachEvent("onmessage",whenPosted);else window.onmessage=whenPosted}catch(e){if(window.console)window.console.log(e.message)}parseCommand()}else{window.pIntervalCnt=0;window.pIntervalId=setInterval(function(){parseCommand()},50)}}
function whenPosted(e){bPostMessage=true;var ev=e?e:event;if(ev.source===window){if(window.console)window.console.error("Source window is equal to current window, command won't be executed.");return}var data=ev.data;if(data&&data.length>0)if(typeof data==="string"){hasStringSupport=true;_executeCommandFromItems(data.split("||"))}else{hasStringSupport=false;_executeCommandFromItems(data)}return false}
function parseCommand(){var data=window.name;if(window.pIntervalId)if(typeof window.pIntervalCnt!=="undefined"&&window.pIntervalCnt++>10||data&&data.length>0)clearInterval(window.pIntervalId);if(data&&data.length>0&&data!="_none"){data=data.replace(previousCommand,"");if(data.length>0){previousCommand=data;var cmnds=data.split("&&");for(var i=0;i<cmnds.length;i++)if(cmnds[i]&&cmnds[i].length>0)_executeCommandFromItems(cmnds[i].split("||"))}}}
function setChatActiveFlag(name,value){if(caUnloadController)caUnloadController.set(value);ptStorage.setItem(name,value);setSessionChatActiveFlagPS(value)}function getChatActiveFlag(name){try{var cookieValue=parseInt(ptStorage.getItem(name));if(isNaN(cookieValue))return 0;else return cookieValue}catch(e){return 0}}
function setSessionChatActiveFlagPS(chatActive){var SESSION_INQCA_STR="sinqCA";if(typeof chatActive==="undefined"||isNaN(chatActive)){log("In setSessionChatActiveFlagPS(); requires one argument as a number");return}try{if(PersistentStorage.isLocalStorageUsed())sessionStorage.setItem(SESSION_INQCA_STR,chatActive)}catch(e){log("Error while set "+SESSION_INQCA_STR,e)}}
function checkSameProtocolOrigin(url){if(url.indexOf(window.location.protocol)===-1)return url.replace(/^http:/i,window.location.protocol);else return url}
function pepareResponseData(id,response){var responseData=new Array;if(typeof response.status!="unknown"){responseData[0]=id;responseData[1]=response.responseText;responseData[2]=response.status;responseData[3]=response.getResponseHeader("Cache-Control")||"";responseData[4]=response.getResponseHeader("Content-Type")||""}else responseData=[id,"","","",""];return responseData}function doAbortCommand(items){var id=items[1];if(xHRsInProgress&&xHRsInProgress[id])xHRsInProgress[id].abort()}
function doPostChatCommand(items){var code="";var cmd=items[0];var id=items[1];var clientHtml=items[3];var xfrdest=items[4];var data=items[5];var timeout=parseInt(items[6])||0;try{var xHR=getXMLHttpRequest();xHRsInProgress[id]=xHR;xHR.open(data?"POST":"GET",xfrdest,true);if(xHR.timeout!=undefined)xHR.timeout=timeout;else xhrTimeoutController[id]=setTimeoutXHR(timeout,id,xHRsInProgress);xHR.onreadystatechange=function(){if(xHR.readyState!=4)return;if(xhrTimeoutController[id]){clearTimeout(xhrTimeoutController[id]);
delete xhrTimeoutController[id]}delete xHRsInProgress[id];if(typeof xHR.status!="unknown"&&xHR.status==0&&beaconUnloadController&&beaconUnloadController.complete)return;doCommandsInClientDomain(pepareResponseData(id,xHR),clientHtml,id)};if(data){xHR.setRequestHeader("Content-type","application/x-www-form-urlencoded");xHR.send(decodeURIComponent(data))}else xHR.send()}catch(e){code='if (inqFrame.Inq["proxyError"]!=null)inqFrame.Inq.proxyError("'+catchJsFormatter(e,cmd)+'");'+code;doCommandsInClientDomain(code,
clientHtml,id)}}
function doSCBR3PMCommand(items){var code="";var cmd=items[0];var id=items[1];var siteID=items[2];var clientHtml=items[3];try{var cookieName=items[4];var cookieValue=items[5];var path=items[6];var expiry=items[7];setupSameOriginDomain();ptStorage.setItem(cookieName+"_"+siteID,cookieValue,expiry);code="inqFrame.Inq.FlashPeer.set3rdPartyCookieFromQueue();\n";doCommandsInClientDomain(code,clientHtml,id)}catch(e){code='if (inqFrame.Inq["proxyError"]!=null)inqFrame.Inq.proxyError("'+catchJsFormatter(e,cmd)+
'");'+"inqFrame.Inq.FlashPeer.set3rdPartyCookieFromQueue();\n";doCommandsInClientDomain(code,clientHtml,id)}}
function doGCBR3Command(items){var code="";var cmd=items[0];var id=items[1];var param=items[2];var clientHtml=items[3];if(!ptStorage){doCommandsInClientDomain("no-cookie",clientHtml,id);return}try{if(param){var cookieValue=ptStorage.getItem(param);code='{"'+param+'": '+cookieValue+"}"}else{var cookieValues=ptStorage.getAllCookies();if(cookieValues==="")cookieValues="inqPc=1";code=cookieValues}doCommandsInClientDomain(code,clientHtml,id)}catch(e){code='if (inqFrame.Inq["proxyError"]!=null)inqFrame.Inq.proxyError("'+
catchJsFormatter(e,cmd)+'");'+code;doCommandsInClientDomain(code,clientHtml,id)}}
function doCommitPointCommand(items){var code="";var cmd=items[0];var id=items[1];var siteID=items[2];var clientHtml=items[3];try{var cookieValues=unescape(ptStorage.getItem("inqVital_"+siteID));var vcntarr=/\bvcnt:([0-9]+)/.exec(cookieValues);var vcnt=vcntarr.length==2?vcntarr[1]:0;code="inqFrame.Inq.FlashPeer.when3rdPartyCookieCommitted("+vcnt+");";doCommandsInClientDomain(code,clientHtml,id)}catch(e){code='if (inqFrame.Inq["proxyError"]!=null)inqFrame.Inq.proxyError("'+catchJsFormatter(e,cmd)+
'");'+code;doCommandsInClientDomain(code,clientHtml,id)}}
function doDumpCommand(items){var code="";var cmd=items[0];var id=items[1];var clientHtml=items[3];try{var url=decodeURIComponent(items[4]);var data="_rand="+Math.round(Math.random()*0xe8d4a51001).toString(36)+"&level=info&line=document.cookie: "+encodeURIComponent(""+document.cookie);var xHR=getXMLHttpRequest();xHRsInProgress[id]=xHR;xHR.open("POST",url,true);xHR.onreadystatechange=function(){if(xHR.readyState!=4)return;delete xHRsInProgress[id];doCommandsInClientDomain("",clientHtml,id)};xHR.setRequestHeader("Content-type",
"application/x-www-form-urlencoded");xHR.send(data)}catch(e){code='if (inqFrame.Inq["proxyError"]!=null)inqFrame.Inq.proxyError("'+catchJsFormatter(e,cmd)+'");'+code;doCommandsInClientDomain(code,clientHtml,id)}}
function doPOSTBR30Command(items){var code="";var cmd=items[0];var id=items[1];var clientHtml=items[3];try{var xfrdata=decodeURIComponent(items[4]);var qIx=xfrdata.indexOf("?");var url=xfrdata.substring(0,qIx);url=checkSameProtocolOrigin(url);var data=xfrdata.substring(qIx+1);var xHR=getXMLHttpRequest();xHRsInProgress[id]=xHR;xHR.open("POST",url,true);xHR.onreadystatechange=function(){if(xHR.readyState!=4)return;delete xHRsInProgress[id];doCommandsInClientDomain(pepareResponseData(id,xHR),clientHtml,
id)};xHR.setRequestHeader("Content-type","application/x-www-form-urlencoded");xHR.send(data)}catch(e){code='if (inqFrame.Inq["proxyError"]!=null)inqFrame.Inq.proxyError("'+catchJsFormatter(e,cmd)+'");'+code;if(console&&console.error)console.error("Error on post operation: "+code,e);doCommandsInClientDomain(code,clientHtml,id)}}
function doCobrowseCommand(items){var code="";var cmd=items[0];var id=items[1];var siteID=items[2];var clientHtml=items[3];var fullUrl=items[4];var data;if(items.length>6){items.splice(0,5);data=items.join("||")}else data=items[5];try{var xHR=getXMLHttpRequest();xHRsInProgress[id]=xHR;xHR.open("POST",fullUrl,true);xHR.onreadystatechange=function(){if(xHR.readyState!=4)return;delete xHRsInProgress[id];var data="(window.Inq.CBC).ackReceived('"+encodeURIComponent(toJsString(xHR.responseText))+"',\""+
id+'");\n';doCommandsInClientDomain(data,clientHtml,id)};xHR.setRequestHeader("Content-type","application/octet-stream");xHR.send(data)}catch(e){code='(window.Inq.CBC).callBackProxyError("'+cmd+'","'+id+'","'+catchJsFormatter(e,cmd)+'");';doCommandsInClientDomain(code,clientHtml,id)}}
function doCBAUTHCommand(items){var code="";var cmd=items[0];var id=items[1];var siteID=items[2];var clientHtml=items[3];try{var cookieName=items[4];var cookieValue=items[5];var path=items[6];var expiry=items[7];setupSameOriginDomain();ptStorage.setItem(cookieName+"_"+siteID,cookieValue,expiry);cookieValue=ptStorage.getItem(cookieName+"_"+siteID);code="(window.Inq.CBC).callBackAuthorized("+toJsString(cookieValue,'"')+',"'+id+'");\n';doCommandsInClientDomain(code,clientHtml,id)}catch(e){code='(window.Inq.CBC).callBackProxyError("'+
cmd+'","'+id+'","'+catchJsFormatter(e,cmd)+'");';doCommandsInClientDomain(code,clientHtml,id)}}
function doCBCheckCommand(items){var code="";var cmd=items[0];var id=items[1];var siteID=items[2];var clientHtml=items[3];try{var cookieCrumb=ptStorage.getItem("cobrowse_"+siteID);code="(window.Inq.CBC).callBackAuthorized("+toJsString(cookieCrumb,'"')+',"'+id+'");\n';doCommandsInClientDomain(code,clientHtml,id)}catch(e){code='(window.Inq.CBC).callBackProxyError("'+cmd+'","'+id+'","'+catchJsFormatter(e,cmd)+'");';doCommandsInClientDomain(code,clientHtml,id)}}
function doChatActiveCommand(items){try{var siteID=items[2];var isPersistWin=parseStringToBoolean(items[3]);var v3TO=parseInt(items[4])*1E3;var cookieName="inqCA_"+siteID;var cookieValue=isPersistWin?2:1;setChatActiveFlag(cookieName,cookieValue);if(!caUnloadController)caUnloadController=new UnloadController(function(e){var inqCA=caUnloadController.get();var curCA=getChatActiveFlag(cookieName);if(inqCA!=0&&curCA==inqCA){setChatActiveFlag(cookieName,0);ptStorage.setItem("inqLT_"+siteID,""+(new Date).getTime(),
v3TO);ptStorage.onUnload()}},null,cookieValue);caUnloadController.activate()}catch(e){}}function chatDeactivate(items){var action=items[1];var siteID=items[2];var cookieName="inqCA_"+siteID;if(caUnloadController)caUnloadController.deactivate();if(action!=="UNLOAD_HANDLER")try{setChatActiveFlag(cookieName,0)}catch(e){}}
function doBeaconCommand(items){var action=items[1];if(!beaconUnloadController)beaconUnloadController=new UnloadController(function(e){parseCommand();if(!beaconUnloadController.complete){var url=beaconUnloadController.url;url+="?"+KEY_ENGAGEMENT_ID_STRING+"="+beaconUnloadController[KEY_ENGAGEMENT_ID_STRING];url+="&timestamp="+(new Date).getTime();sendBeacon(url,beaconUnloadController.get());beaconUnloadController.complete=true}});if(action=="ACTIVATE"){beaconUnloadController.activate();beaconUnloadController.set(items[2]);
beaconUnloadController.url=items[3];beaconUnloadController[KEY_ENGAGEMENT_ID_STRING]=items[4];beaconUnloadController.complete=false}else if(action=="DEACTIVATE")beaconUnloadController.deactivate();else if(action=="DATA")beaconUnloadController.set(items[2])}
function doCommands(items){var code="";var cmd=items[0];switch(cmd){case "ABORT":doAbortCommand(items);break;case "POSTCHAT":doPostChatCommand(items);break;case "SCBR3_PM":doSCBR3PMCommand(items);break;case "GCBR3":doGCBR3Command(items);break;case "COMMITPOINT":doCommitPointCommand(items);break;case "DUMP":doDumpCommand(items);break;case "POSTBR30":doPOSTBR30Command(items);break;case "COBROWSE":doCobrowseCommand(items);break;case "CBAUTH":doCBAUTHCommand(items);break;case "CBCHECK":doCBCheckCommand(items);
break;case "CHATACTIVE":doChatActiveCommand(items);break;case "CHATDEACTIVATE":chatDeactivate(items);break;case "BEACON":doBeaconCommand(items);break;case "POSTSYNC":doPostSyncCommand(items);break;default:var id=items[1];var clientHtml=items[3];var err=new Error("Undefined Request for ["+cmd+"] command");try{err.name="Syntax Error";throw err;}catch(e){code='if (inqFrame.Inq["proxyError"]!=null)inqFrame.Inq.proxyError("'+catchJsFormatter(e,cmd)+'");';doCommandsInClientDomain(code,clientHtml,id)}break}}
function doPostSyncCommand(items){var code="";var cmd=items[0];var id=items[1];var clientHtml=items[3];try{var xfrdata=decodeURIComponent(items[4]);var qIx=xfrdata.indexOf("?");var url=xfrdata.substring(0,qIx);url=checkSameProtocolOrigin(url);var data=xfrdata.substring(qIx+1);var xHR=getXMLHttpRequest();xHRsInProgress[id]=xHR;xHR.open("POST",url,false);xHR.setRequestHeader("Content-type","application/x-www-form-urlencoded");xHR.send(data);delete xHRsInProgress[id];doCommandsInClientDomain(pepareResponseData(id,
xHR),clientHtml,id)}catch(e){code='if (inqFrame.Inq["proxyError"]!=null)inqFrame.Inq.proxyError("'+catchJsFormatter(e,cmd)+'");'+code;if(console&&console.error)console.error("Error on post operation: "+code,e);doCommandsInClientDomain(code,clientHtml,id)}}function isSelfDetectionMode(){return window.location.href.toLowerCase().indexOf("posttoserver.htm")==-1}whenLoaded();function getXMLHttpRequest(){if(window.XMLHttpRequest)return new XMLHttpRequest;else if(window.ActiveXObject)return new ActiveXObject("Microsoft.XMLHTTP");else throw new Error("Impossible to create XMLHttpRequest object.");}function setTimeoutXHR(timeout,xhrId,xhrController){if(timeout>0&&xhrController)return setTimeout(function(){if(xhrController[xhrId])xhrController[xhrId].abort()},timeout)}
function toJsString(val,quote){if(typeof val=="string"){var value=val;value=value.split("\\").join("\\\\");value=value.split('"').join('\\"');value=value.split("'").join("\\'");value=value.split("\n").join("\\n");value=value.split("\r").join("\\r");value=value.split("\t").join("\\t");if(quote)value=quote+value+quote;return value}return val}function log(message,exception){if(message)if(window["console"]&&console["log"])if(exception)console.log(message,exception);else console.log(message)}
function formatArgument(arg){try{var type="[unknown]";try{type=typeof arg=="object"?arg["constructor"]!=null?arg.constructor.toString():""+arg:"("+typeof arg+")"}catch(e){type=""+arg}if(type.indexOf("function")!=-1)type=type.split("\n").join(" ").replace(/^\s*function (\w+)\s*\(\)[^\n]*/g,"[object $1]");if(type=="(boolean)"||type=="[object Boolean]")type=arg?"true":"false";if(type=="(string)"||type=="[object String]")type=toJsString(arg,'"');if(type=="(array)"||type=="[object Array]"){type="";for(var ix=
0;ix<arg.length;ix++){type+=(type.length!=0?",":"")+formatArgument(arg[ix]);if(type.length>128)break}if(type.length>128)type=type.substr(0,128-3)+"...";return"["+type+"]"}return type}catch(e){return"[argument]"}}
function getStackTrace(err){try{var callstack=[];try{i.dont.exist+=0}catch(e){if(e.stack);else if(window.opera&&e.message){var lines=e.message.split("\n");for(var i=0,len=lines.length;i<len;i++)if(lines[i].match(/^\s*[A-Za-z0-9\-_\$]+\(/)){var entry=lines[i];if(lines[i+1]){entry+=" at "+lines[i+1];i++}callstack.push(entry)}callstack.shift();callstack.shift();return callstack.join("\n\t\t")}}if(arguments&&arguments.callee&&arguments.callee.caller){var fnctn=arguments.callee.caller.caller;while(fnctn){var fn=
""+fnctn.toString();var fnameIx=fn.indexOf("function ")+9;var fnameEnd=fn.indexOf("(",fnameIx);var fname=fn.substring(fnameIx,fnameEnd)||"anonymous function";var args="";if(fnctn.arguments.length)for(var ix=0;ix<fnctn.arguments.length;ix++){var arg=fnctn.arguments[ix];args+=(args.length!=0?",":"")+formatArgument(arg)}callstack.push(fname+"("+args+")");fnctn=fnctn.caller}return"stack trace:\n\t\t"+callstack.join("\n\t\t")}return""}catch(e){return""}}
function catchJsFormatter(err,command){try{var desc="\tERROR while processing "+command+": ";for(var itm in err)desc+="\n\t"+itm+": "+(""+err[itm]).split("\n").join("\n\t\t");desc+="\n\t"+getStackTrace(err);return toJsString(desc)}catch(e){return""}}function parseStringToBoolean(val){if(typeof val=="string")return val=="true";else return val}
function _addEventListener(object,eventName,handler,useCapture){if(!useCapture)useCapture=false;if(window["addEventListener"])object.addEventListener(eventName,handler,useCapture);else if(window["attachEvent"])object.attachEvent("on"+eventName,handler)}function sendBeacon(url,data){if(navigator.sendBeacon)navigator.sendBeacon(url,data);else sendBeaconByXHR(url,data)}
function sendBeaconByXHR(url,data){var xHR=getXMLHttpRequest();xHR.open("POST",url,false);xHR.setRequestHeader("Content-Type","text/plain;charset=UTF-8");xHR.send(data)};function UnloadController(handler,params,initValue){this.active=false;this.handler=handler;this._value=initValue||null;if(params)for(var k in params)this[k]=params[k]}UnloadController.prototype.activate=function(){if(!this.onunload){this.onunload=function(e){if(this.isActive()){this.handler(e);this.deactivate()}};var self=this;this._addUnloadHandler(function(e){e=e||window.event;self.onunload(e)})}this.active=true};UnloadController.prototype.deactivate=function(){this.active=false};
UnloadController.prototype.isActive=function(){return this.active};UnloadController.prototype.set=function(value){this._value=value};UnloadController.prototype.get=function(){return this._value};UnloadController.prototype._addUnloadHandler=function(handler,useCapture){_addEventListener(window,"unload",handler,useCapture);_addEventListener(window,"beforeunload",handler,useCapture);_addEventListener(window,"pagehide",handler,useCapture)};
